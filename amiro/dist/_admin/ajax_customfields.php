<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       3973 xkqwrzxzkytqpsmxkmztlimkprmqmttuxtilpuuwrkwuriguwytxzwyglzwuliknpzqqpnir
 */ ?><?php foreach(array(20114=>'IHSuJQ|nZIQ',20115=>'~;*Z+A&*Z+A&$~',20116=>'~[?zim`zlzX`qrrHr}WuDtHIfMQJSD{%?MnvZJMS?IHSuJQ|nZIQ?Hr?SZtZ|JZnPuZPQ?[~',20117=>'~;*0+9Z+A|&-$~',20118=>".?",20119=>"FRhi?.WID|IHSuJQD|SZtZDQtD.?",20120=>"coqRq?.IHSuJQ|nZIQ.?=?'",20121=>'MS',20122=>"'?zNs?.IHSuJQ|nZIQ.?=?'",20123=>"jmimT?1",20124=>"FRhi?.WID|IHSuJQD|WuDtHI|fMQJSD.?",20125=>"coqRq?IHSuJQ|nZIQ?=?'",20126=>"'?",20127=>'unKnHCn',20128=>'SQfZuJt|WZGtMHn') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} if( empty($_GET[I20114]) || empty($_GET['data_language']) || !preg_match('/^[0-9a-z_]+$/', $_GET[I20114]) || !preg_match(I20115, $_GET['data_language']) ){die(I20116); }$l1IIlL1 =json_encode(isset($_GET['object_id']) ?TlITlT1($db) :TlITlIT($db)); function TlITlT1($db){ $objectId =(int)$_GET['object_id']; if(!$objectId || empty($_GET['table']) || !preg_match(I20117, $_GET['table'])){ die; }$datasetId =0; $sql ="SELECT `id_dataset` " ."FROM `" .mysql_real_escape_string($_GET['table']) .I20118 ."WHERE `id` = " .$objectId; $db->query($sql); if($record =$db->nextRecord()){ $datasetId =(int)$record['id_dataset']; }if(!$datasetId){ $sql ="SELECT `id` " .I20119 .I20120 .mysql_real_escape_string($_GET[I20114]) ."' AND `is_sys` = 1"; $db->query($sql); if($record =$db->nextRecord()){ $datasetId =(int)$record[I20121]; }else{ $datasetId =0; }}return $datasetId; }function TlITlIT($db){ $aCustomFields =array(); $lang =mysql_real_escape_string($_GET['data_language']); $l1IILI1 =array(); $sql ="SELECT `fields_shared` " .I20119 ."WHERE `lang` = '" .$lang .I20122 .mysql_real_escape_string($_GET[I20114]) ."' " .I20123; $db->query($sql); if($record =$db->nextRecord()){ $l1IILI1 =trim($record['fields_shared'], ';'); $l1IILI1 =mb_strlen($l1IILI1) ?explode(';', $l1IILI1) :array(); }$sql ="SELECT `id`, `name`, `default_caption` " .I20124 .I20125 .mysql_real_escape_string($_GET[I20114]) .I20126 ."ORDER BY `id` ASC"; $db->query($sql); while($record =$db->nextRecord()){ foreach(array('name', 'default_caption') as $fieldName){ $record[$fieldName] =unserialize($record[$fieldName]); $record[$fieldName] =isset($record[$fieldName][$lang]) ?$record[$fieldName][$lang] :''; if(!mb_strlen($record[$fieldName])){ $record[$fieldName] =I20127; }}$record['name'] =unhtmlentities($record['name']); $record['is_shared'] =(int)in_array($record[I20121], $l1IILI1); $aCustomFields[] =array( $record[I20121], $record['name'], $record[I20128], 0, $record['is_shared'], 1, 1, 0 );}return $aCustomFields; }