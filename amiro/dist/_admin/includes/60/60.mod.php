<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    Module  $Id$ 
 * @since      5.12.0 
 * @version    $Id$ 
 * @size       9221 xkqwlykqxkrgxmktyrrirgxuxwxuulpszgsxziqqqmgswmnztmlipnukllxsymqrpzrmpnir
 */ ?><?php foreach(array(22938=>'oTTg~1`1',22939=>'ZIM|fuJJ',22940=>'ZSv|GJZWQD',22941=>'QDOHG|WurrQnWB',22942=>'DSQYuP',22943=>'GHGuG',22944=>'zsimN',22945=>'fJt|MS|GZPQ',22946=>'Qnv~WHHKMQ',22947=>'',22948=>"mnvZJMS?IHSuJQ?mS?'",22949=>'SMDZYJQ|QrrHr|IZMJ',22950=>"dqjqwT?.GJuPMn|IHSuJQ.?FRhi?.WID|GJuPMnD.?",22951=>'zim|zjjhc|jhwzj|ihsUjqd',22952=>'GZtO~OBGQr|JHWZJ',22953=>'GHrtfHJMH|WZt',22954=>'~IHSuJQ~WHntrHJJQr~ZSI',22955=>'QxtSQY',22956=>'Du',22957=>'SQfZuJt|SZtZ|JZnP',22958=>'PuMzSIMn`GOG',22959=>'DKMnD~',22960=>'Qn',22961=>'ihsUjq|gmwTURqd|gzTo',22962=>'GZtO~rHHt',22963=>"iHSuJQ?'",22964=>"'?MDn't?MnDtZJJQS",22965=>'UDQr?OZvMnP?MS?',22966=>'"?IHSuJQ',22967=>'DMSQ',22968=>'ZIM|IHSuJQ|GZPQ') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $SERVER_PROTOCOL =getenv('SERVER_PROTOCOL'); if($SERVER_PROTOCOL == ''){ $SERVER_PROTOCOL =I22938; }if(!empty($_REQUEST['ami_full']) && $_REQUEST['ami_full'] !== '1'){ trigger_error("Invalid 'ami_full' request parameter value '" .$_REQUEST[I22939] ."'", E_USER_WARNING); $oRequest->set(I22939, null); unset($_REQUEST[I22939]); }$aInstalledModules =array( 'start', 'pages', 'users', I22940, 'ce', 'common_settings', 'rating', 'eshop_home', I22941, 'kb_home', 'portfolio_home', );$l1IlL1I =false; if(!is_null($oRequest->get('sdebug', null)) || isset($_COOKIE['sdebug'])){ $l1IlL1l =$oRequest->get(I22942, null); if(is_null($l1IlL1l)){ $l1IlL1l =$_COOKIE[I22942]; }if($l1IlL1l == 'detail' || $l1IlL1l == 'simple'){ $l1IlL1I =$l1IlL1l; }DB_si::globalAttr('debug', $l1IlL1I); }if($oRequest->get('mode', false) == I22943){ AMI_Registry::set('popup_mode', true); }AMI::getSingleton('db', array('ami_db' => new DB_si())); $oResponse =AMI::getSingleton('response', array($AMI_MICROTIME_STARTED)) ->setBenchType( I22944 .($oRequest->get(I22939, FALSE) !== 1 ?'-ENV-FAST' :'') );if($oRequest->get('flt_id_page', false) !== false){ $oRequest->set('id_page', $oRequest->get(I22945)); }AMI_Registry::set('modId', $oRequest->get('mod_id', false)); AMI_Registry::set('modEngine', '60'); AMI::getSingleton(I22946)->getVarsCookie(true); if(!is_null($oRequest->get(I22942, null))){ if($l1IlL1I === false || $l1IlL1I != 'detail' || $l1IlL1I != 'simple'){ SetLocalCookie(I22942, '', time()-3600, '', true); }else{ SetLocalCookie(I22942, $l1IlL1I, 0, I22947, true); }}unset($l1IlL1I); if(is_object($Core) && $Core instanceof CMS_Core){ AMI_Registry::set('ami_allow_model_save', true); }unset($l1IIlI1); $modId =$oRequest->get('mod_id', false); if(!$modId || !AMI::validateModId($modId)){ if(!$modId){ AMI_Registry::push('disable_error_mail', TRUE); }trigger_error(I22948 .$modId ."'", E_USER_ERROR); if(!$modId){ AMI_Registry::pop(I22949); }}$l1IllLL =false; $oQuery =DB_Query::getSnippet( I22950 ."WHERE `plugin_id` = %s LIMIT 1" )->q($modId); $pluginId =AMI::getSingleton('db')->fetchValue($oQuery); if($pluginId){ $pluginId =CMS_InstallablePlugin::GetPluginName($pluginId); $aInstalledModules[] =$pluginId; $l1IllLL =true; }unset($oQuery); require_once $HOST_PATH .'_shared/code/const/init_simple.php'; if( empty($sys['disable_user_scripts']) || defined(I22951) ){AMI_Service::addAutoloadPath(AMI_Registry::get(I22952) .'code'); }$modAction =$oRequest->get('mod_action', FALSE); $l1IlL1L =!$l1IllLL && $modId && $modAction; if(empty($_REQUEST[I22939])){ if( !$l1IllLL && !$modAction && in_array($modId, array('eshop_cat', 'kb_cat', I22953)) ){$l1IlL1L =TRUE; }$Core =AMI::getSingleton('core', array($aInstalledModules)); $path =AMI_Registry::get(I22952) .'declaration/declares.php'; if(file_exists($path)){ $oDeclarator =AMI_ModDeclarator::getInstance(); require $path; $oDeclarator->validate(); unset($oDeclarator); $modId =AMI_Registry::get('modId'); }unset($path); if($l1IlL1L){ $class =AMI::getResourceClass($modId .I22954); $aClassInfo =AMI_Service::getClassInfo($class); if(is_array($aClassInfo)){ $l1IlL1L =$aClassInfo[0]; }unset($aClassInfo, $class); }$Core->init($l1IlL1L ?I22947 :($l1IllLL ?$pluginId :$modId)); if(!empty($sys['err'][I22955]) && !empty($sys['err']['read_templates_from_disk'])){ define('TEMPLATES_FROM_DISK', TRUE); }if($Core->issetOption('su') && $Core->getOption(I22956)){ AMI::getSingleton('db')->getCoreDB()->setAttr('multi_user', TRUE); }}AMI_Registry::set('lang_data', AMI::getSingleton(I22946)->get('lang_data', ($Core->issetOption(I22957) ?$Core->getOption(I22957) :'en'))); if($l1IllLL){ $Core->renameModOptions($pluginId, $modId); $l1IlL11 =AMI::getOption($modId, 'admin'); $oRequest->set('controller_res_id', $pluginId); $l1Il1II =AMI::getPluginPath($modId) .'code/'; AMI_Service::addAutoloadPath($l1Il1II); }require_once $CLASSES_PATH .I22958; if(!isset($GLOBALS['CURRENT_SKIN'])) {$GLOBALS['CURRENT_SKIN'] =AMI::getSingleton(I22946)->get('user_skin2', 'vanilla'); }$CURRENT_SKIN_PATH =I22959 .$CURRENT_SKIN .'/'; $oTpl =new gui($ROOT_PATH_WWW, I22947, true, false); $lang =$oRequest->getCookie('user_lang', $Core->issetOption('default_gui_lang') ?$Core->getOption('default_gui_lang') :I22960); AMI_Registry::set('lang', $lang); $oTpl->_setLang($lang); AMI_Registry::set('oGUI', $oTpl); AMI_Registry::set('CUSTOM_PICTURES_HTTP_PATH', "_mod_files/ce_images/"); AMI_Registry::set(I22961, AMI_Registry::get(I22962)."_mod_files/"); AMI_Registry::set('LOCAL_FILES_REL_PATH', "_local/"); $oTpl->setSkinPath($CURRENT_SKIN_PATH); $vGlobVars['root_path_www'] =$ROOT_PATH_WWW; unset($oTpl); if(!AMI::isModInstalled($modId)){ trigger_error(I22963 .$modId .I22964, E_USER_ERROR); }elseif(empty($_REQUEST[I22939]) && $Core->issetOption(I22956) && $Core->getOption(I22956) && !$Core->hasModAccess($l1IllLL ?$pluginId :$modId)){ trigger_error(I22965 .$Core->getUserId() .' has no rights to access to the "' .($l1IllLL ?'plugins_wizard' :$modId) .I22966, E_USER_ERROR); }if($l1IllLL){ if(is_file($l1Il1II .$l1IlL11) && is_readable($l1Il1II .$l1IlL11)){ require $l1Il1II .$l1IlL11; }else{ trigger_error("Cannot include plugin admin file '" .$l1IlL11 ."'", E_USER_ERROR); }}$oResponse->start(); if($modId && $modAction){ AMI_GlobalFilters::setGlobalFilter(I22967); if(in_array($modAction, array('list_view', 'form_save'))){ $oResponse->setType('JSON'); }$oController =AMI::getResource($modId .I22954, array($oRequest, $oResponse)); $oController->init(); $aEvent =array(); AMI_Event::fire('dispatch_request', $aEvent, $modId); $aViews =$oController->getViews(); foreach($aViews as $oView){ $oResponse->write($oView->get()); }}else{ AMI_Registry::set(I22968, true); new AMI_PageAdm($oRequest, $oResponse); }if(!empty($_REQUEST[I22939])){ $Core->Cache->End(); }AMI::getSingleton(I22946)->save(); $oResponse->send(); 