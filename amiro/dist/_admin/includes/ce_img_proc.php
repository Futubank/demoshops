<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       33113 xkqwwrrmpikuywrnlkstnpgwwiiwuylyyggwqskzqqxuqliwylyktpuqpmslpmmlpnxspnir
 */ ?><?php foreach(array(20651=>'wjzddqd|gzTo',20652=>"FUNw|mNwjUsqd|gzTo",20653=>'wHrQ',20654=>'wURRqNT|dkmN|gzTo',20655=>"",20656=>"YrHCDQ|HGQn",20657=>"IZMn|fMQJS",20658=>"WZt",20659=>'Qnv~WHHKMQ',20660=>"DQt|WZt",20661=>"~",20662=>'YPHYL',20663=>'HYL',20664=>'DMIGJQ',20665=>"MIZPQtZGQ",20666=>"IHSQ",20667=>"fMJtQr",20668=>"OMSSQn",20669=>'ZWtMHn',20670=>"rQfrQDO",20671=>"WrQZtQ|WZt",20672=>'SMDZYJQ|QrrHr|IZMJ',20673=>"IHvQ",20674=>"ZWtMHn",20675=>"nZIQ",20676=>"WuDtHI|OQMPOt",20677=>"SQJQtQ|HrMP",20678=>'CZtQrIZrKD~',20679=>'CZtQrIZrK|ZJGOZ',20680=>"DtZtuD|MIP|QxMDtD",20681=>"|",20682=>'IHSuJQ',20683=>"DtZtuD|ZSS",20684=>'ZJGOZ',20685=>"rQS",20686=>"Wurr|MIP",20687=>"Wurr|MIP|urJ",20688=>'txtgHGuGFMJQNZIQ',20689=>"|GrQvMQC|OQMPOt",20690=>"fHJSQrD",20691=>"SMr|WHIIHn|nZIQ",20692=>"SMr|MtQID",20693=>"GZtO",20694=>"YPWHJHr",20695=>"MIZPQ%SMr|MtQI|DQJ",20696=>"tQIGJZtQD~fHrI`tGJ",20697=>"nH|MIZPQ",20698=>"MIP|Qxt|ZrrZB",20699=>"MIZPQ%",20700=>']<',20701=>'[',20702=>"WQ|MIP|GZPQ|",20703=>"IHSuJQ",20704=>"DQJf|urJ",20705=>"YrHCDQ|IHSQ|JMDt",20706=>"YrHCDQ|IHSQ|MWHnD",20707=>"'",20708=>"DMAQ",20709=>"CMStO",20710=>"OQMPOt",20711=>"HnWJMWK",20712=>"MIP|nZIQ",20713=>"WOQWKQS",20714=>"DCf",20715=>'JMDt',20716=>"nuI",20717=>"GZPQr",20718=>"DtZtuD",20719=>"GZPQr|HSL",20720=>'rQDMAQ|fHrI',20721=>"SMI|Dtr",20722=>"rQDMAQ|fHrI",20723=>"0",20724=>'CZtQrIZrKD',20725=>'nZIQ',20726=>'uGrMPOt',20727=>'CZtQrIZrK|IQtOHS|',20728=>"MIZPQ%fHrI|uGJHZS") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $l1Il1L1 =100; $l1Il11I =100; $init_filter =1; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. 'init.php'; AMI_Service::hideDebug(); require_once $GLOBALS[I20651] .'IMG_Proc.php'; require_once $GLOBALS[I20651] .'DataSource.php'; require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_file_system.php"); require_once($GLOBALS[I20652]."func_translit.php"); require_once($GLOBALS[I20652]."func_format.php"); $IllIlII =$GLOBALS['Core']->IssetOption('images_generator_lib') ?$GLOBALS[I20653]->GetOption('images_generator_lib') :'php'; $IllIlIl =new IMG_PROC($IllIlII); $l1Il11l =false; if (sizeof($IllIlIl->TIT1TlT()) >0){ $l1Il11l =true; }$l1Il11L =new DataSourceFS(); $adm->Gui->delStyle(); if($adm->Core->IssetOption('admin_external_css')) {$list =$adm->Core->GetOption('admin_external_css'); foreach($list as $path) {$adm->Gui->addStyle($path); }}$adm->Gui->addStyle($GLOBALS[I20654]."_css/scroll_bars.css"); $adm->Gui->addStyle($GLOBALS[I20654]."_css/style.css"); $l1Il111 ="images/no-image-".$adm->lang_data.".png"; $l1ILIII["txtFileName_img_url"] =$l1Il111; $l1ILIII["txtPopupFileName_img_url"] =$l1Il111; $l1ILIII["txtImageOver_img_url"] =$l1Il111; $l1ILIIl["txtFileName_img_url"] =$l1Il111; $l1ILIIl["txtPopupFileName_img_url"] =$l1Il111; $l1ILIIl["txtImageOver_img_url"] =$l1Il111; $adm->Words =$adm->Gui->ParseLangFile("templates/lang/main.lng"); $l1ILIIL =&$adm->Core->GetModule("ce_img_proc"); $l1ILII1 =$l1ILIIL->GetOption("upload_img_sizes"); $l1ILIlI =$l1ILIIL->GetOption("force_upload_img_resize"); $l1ILIll =I20655; $l1ILIlL =I20655; $cat =I20655; if(isset($adm->VarsGet["browse_open"]) && $adm->VarsGet["browse_open"] != I20655 ){$l1ILIl1 =$adm->VarsGet["browse_open"]; }if(isset($adm->VarsPost["browse_open"]) && $adm->VarsPost[I20656] != I20655 ){$l1ILIl1 =$adm->VarsPost[I20656]; }$l1ILILI ="txtFileName"; if(isset($adm->VarsGet["main_field"]) && $adm->VarsGet["main_field"] != I20655 ){$l1ILILI =$adm->VarsGet["main_field"]; }if(isset($adm->VarsPost[I20657]) && $adm->VarsPost[I20657] != I20655 ){$l1ILILI =$adm->VarsPost[I20657]; }if(isset($adm->VarsGet["cat"]) && $adm->VarsGet["cat"] != I20655 ){$cat =$adm->VarsGet["cat"]; }if(isset($adm->VarsPost["cat"]) && $adm->VarsPost[I20658] != I20655 ){$cat =$adm->VarsPost[I20658]; }if(AMI::getSingleton('env/cookie')->get("ce_img_cat", I20655) != I20655) {$cat =AMI::getSingleton('env/cookie')->get("ce_img_cat"); }if(AMI::getSingleton(I20659)->get("ce_img_mode", I20655) != I20655) {$mode =AMI::getSingleton(I20659)->get("ce_img_mode"); }else{ $mode ='list'; }if(!$l1Il11L->TT1lIlI($CUSTOM_PICTURES_PATH.$cat) || !AMI_Lib_FS::validatePath($CUSTOM_PICTURES_PATH.$cat, FALSE)){ $cat =I20655; }$l1ILILl =null; if(isset($adm->VarsGet["set_cat"])) {$l1ILILl =$adm->VarsGet[I20660]; }if(isset($adm->VarsPost[I20660])) {$l1ILILl =$adm->VarsPost[I20660]; }if( !$l1Il11L->TT1lIlI($CUSTOM_PICTURES_PATH .(is_null($l1ILILl) ?'' :$l1ILILl)) || !AMI_Lib_FS::validatePath($CUSTOM_PICTURES_PATH .(is_null($l1ILILl) ?'' :$l1ILILl), FALSE) ){$l1ILILl =''; }if (!is_null($l1ILILl)){ $l1ILIlL =($l1ILILl==I20655)?I20655:$l1ILILl."/"; $l1ILILL =$l1ILILl; }else{ $l1ILIlL =($cat==I20655)?I20655:$cat.I20661; $l1ILILL =$cat; $l1ILILl =$cat; }SetLocalCookie("ce_img_cat", $l1ILILL, time()+30*24*3600); $form_type ='simple'; $obj_name =$l1ILIL1 =$l1ILI1I =$l1ILI1l =$l1ILI1L =null; if (!empty($adm->Vars["bgobj"])){ $obj_name =$adm->Vars["bgobj"]; $l1ILI1l =$obj_name; $l1ILIll =I20662; $form_type ='bg'; $l1ILIL1 =$adm->Vars["obj_mode"]; }if (!empty($adm->Vars["obj"])){ $obj_name =$adm->Vars["obj"]; $l1ILI1I =$obj_name; $l1ILIll =I20663; $form_type ='advanced'; }if (!empty($adm->Vars["fld"])){ $l1ILI11 =$adm->Vars["fld"]; $l1ILIll ='img'; $form_type =I20664; }if (!empty($adm->Vars["img"])){ $obj_name =$adm->Vars["img"]; $l1ILI1L =$obj_name; $l1ILIll ='img'; $form_type =I20664; }$l1ILlII =$l1ILIIL->GetProperty("img_extensions_".$form_type); if (!empty($adm->Vars[I20665])){ $form_type ='imagetape'; $l1ILlII =$l1ILIIL->GetProperty("img_extensions_simple"); }if ($l1ILIll==I20655) {exit; }$l1ILIIl["img_display"] ='none'; if (isset($adm->VarsGet[I20666]) && $adm->VarsGet[I20666] != ''){ $mode =$adm->VarsGet[I20666]; }if (isset($adm->VarsPost[I20666]) && $adm->VarsPost[I20666] != ''){ $mode =$adm->VarsPost[I20666]; }SetLocalCookie("ce_img_mode", $mode, time()+30*24*3600); $adm->Gui->addBlock("image","templates/ce_img_proc.tpl"); $flt_name =I20655; if(isset($adm->Vars["flt_name"])) {$flt_name =urldecode(removeSpecial($adm->Vars["flt_name"])); }$l1ILIII["flt_name"] =$flt_name; $l1ILIIl["flt_name"] =$flt_name; $l1ILIIl[I20667] =$adm->Gui->get("image:filter",$l1ILIIl); $adm->Filter->AddField("flt_name", "hidden", urlencode($flt_name)); $adm->Filter->TITIll1("flt_name"); $adm->Filter->AddField(I20658.$cat, I20668, $l1ILILl); $adm->Filter->TITIll1(I20658.$cat); $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_ce_img_proc_msgs.lng")); $l1ILlIl =$adm->Gui->ParseLangFile("templates/lang/_ce_img_proc_items.lng"); $l1ILlIL =$l1ILlIl["size_splitter"]; $l1ILlI1 =false; $l1ILllI =Array(); $l1ILlll =array(); if(!isset($adm->VarsPost['action'])){ $adm->VarsPost[I20669] =null; }if(!isset($adm->VarsPost['files'])){ $adm->VarsPost['files'] =null; }if (isset($adm->Vars["action"]) && ($adm->Vars["action"]==I20670)){ TlTl1TI($CUSTOM_PICTURES_PATH.$l1ILIlL, "KILLINDEX"); }else if (!empty($adm->VarsPost["create_cat"])){ $l1ILllL =preg_replace('/[^А-ЯЁа-яёA-Za-z0-9\-_]/us', '', unhtmlentities($adm->VarsPost[I20671])); $l1ILllL =$adm->TTITI11($l1ILllL); $l1ILllL =str_replace(" ", "_", $l1ILllL); if (!$l1Il11L->TT1lIlI($CUSTOM_PICTURES_PATH.$l1ILllL) && !$l1Il11L->mkDir($CUSTOM_PICTURES_PATH.$l1ILllL,0777,true)){ }else {$l1ILIlL =$l1ILILl =$l1ILllL; }@$l1Il11L->chmod($CUSTOM_PICTURES_PATH.$l1ILllL,0777); }else if (!empty($adm->VarsPost["delete_cat"])){ $l1ILll1 =$adm->TTITI11($adm->VarsPost["delete_cat"]).I20661; AMI_Registry::push(I20672, true); AMI_ErrorHandler::getInstance()->log('CLIENT INFORMATION:' .var_export($adm->VarsPost, true)); if (!$l1Il11L->TT1lIll($CUSTOM_PICTURES_PATH.$l1ILll1)){ }AMI_Registry::pop(I20672); TlTl1TI($CUSTOM_PICTURES_PATH, "KILLINDEX"); }else if (is_array($adm->VarsPost["files"]) && ($adm->VarsPost["action"]==I20673)){ AMI_ErrorHandler::getInstance()->log('CLIENT INFORMATION:' .var_export($adm->VarsPost, true)); foreach($adm->VarsPost["files"] as $key => $value){ if ($l1Il11L->fileExists($CUSTOM_PICTURES_PATH.$cat.I20661.$value)){ if ($l1Il11L->copy($CUSTOM_PICTURES_PATH.$cat.I20661.$value, $CUSTOM_PICTURES_PATH.$l1ILIlL.$value)){ @$l1Il11L->chmod($CUSTOM_PICTURES_PATH.$l1ILIlL.$value,0666); $l1Il11L->unlink($CUSTOM_PICTURES_PATH.$cat.I20661.$value); }else{ }}else{ }}TlTl1TI($CUSTOM_PICTURES_PATH.$cat, "KILLINDEX"); TlTl1TI($CUSTOM_PICTURES_PATH.$l1ILIlL, "KILLINDEX"); }else if ($adm->VarsPost[I20674]=="move_all"){ $d =TlTl1TI($CUSTOM_PICTURES_PATH.$cat); AMI_ErrorHandler::getInstance()->log('CLIENT INFORMATION:' .var_export($adm->VarsPost, true)); foreach($d as $item=>$entry) {if ($l1Il11L->fileExists($CUSTOM_PICTURES_PATH.$cat.I20661.$entry["name"])){ if ($l1Il11L->copy($CUSTOM_PICTURES_PATH.$cat.I20661.$entry["name"], $CUSTOM_PICTURES_PATH.$l1ILIlL.$entry[I20675])){ @$l1Il11L->chmod($CUSTOM_PICTURES_PATH.$l1ILIlL.$entry[I20675],0666); $l1Il11L->unlink($CUSTOM_PICTURES_PATH.$cat.I20661.$entry[I20675]); }else{ }}else{ }}TlTl1TI($CUSTOM_PICTURES_PATH.$cat, "KILLINDEX"); TlTl1TI($CUSTOM_PICTURES_PATH.$l1ILIlL, "KILLINDEX"); }else if (is_array($adm->VarsPost["files"]) && ($adm->VarsPost[I20674]=="delete")){ AMI_ErrorHandler::getInstance()->log('CLIENT INFORMATION:' .var_export($adm->VarsPost, true)); foreach($adm->VarsPost["files"] as $key => $value){ if ($l1Il11L->TT1lIlT($CUSTOM_PICTURES_PATH.$l1ILIlL.I20661.$value)){ $l1Il11L->unlink($CUSTOM_PICTURES_PATH.$l1ILIlL.I20661.$value); }else{ }}TlTl1TI($CUSTOM_PICTURES_PATH.$l1ILIlL, "KILLINDEX"); }else{ if ($l1Il11l && is_array($adm->VarsPost)){ foreach ($adm->VarsPost as $key=>$value){ if ((mb_substr($key, 0, 6) == "resize") && ($value=="1")){ $l1ILllI[] =mb_split($l1ILlIL, mb_substr($key, 6)); }}if ($l1ILIIL->GetOption("upload_img_allow_custom_size")){ $cw =isset($adm->VarsPost["custom_width"]) ?$adm->VarsPost["custom_width"] :''; $ch =isset($adm->VarsPost["custom_height"]) ?$adm->VarsPost[I20676] :''; if ($cw != '' || $ch != ''){ $l1ILllI[] =array($cw, $ch); }}$l1ILlLI =intval(!empty($adm->VarsPost["keep_ratio"])); $l1ILlLl =!empty($adm->VarsPost[I20677]); }if(!empty($adm->VarsPost['watermark_source']) && is_file($CUSTOM_PICTURES_PATH.'watermarks/'.$adm->VarsPost['watermark_source'])){ $l1ILlll['layer'] =$CUSTOM_PICTURES_PATH.I20678.$adm->VarsPost['watermark_source']; $l1ILlll['orient'] =$adm->VarsPost['watermark_method']; $l1ILlll['alpha'] =max(0, min(127, intval($adm->VarsPost[I20679]*1.27))); }}foreach($adm->VarsPost as $key => $value){ if(!is_array($value)){ $l1ILIII[$key] =htmlspecialchars($value); }}$l1ILlLL =I20655; $l1ILlL1 =true; if (is_array($_FILES) && (sizeof($_FILES) >0)){ foreach ($_FILES as $key=>$value){ if (!empty($_FILES[$key]['name'])){ $l1ILl1I =($l1Il11L->fileExists($CUSTOM_PICTURES_PATH.$l1ILIlL.$_FILES[$key]['name'])>0); if( $l1ILl1I && $adm->Vars["force_owerwrite"]!="1"){ $adm->AddStatusMsg(I20680, "red", I20655,I20655, Array(I20675=>$_FILES[$key]['name'])); }else{ $filename =stripslashes($_FILES[$key]['name']); $filename =cms_transliterate($filename, $adm->lang_data); $filename =mb_strtolower(str_replace(" ", I20681, $filename)); $filename =$adm->TTITI11($filename); if($l1Il11L->fileSize($_FILES[$key]['tmp_name'])>0 ){if (empty($l1ILlLL) && !$l1ILlLl){ $l1ILlLL =$filename; }if( $adm->doUploadImage($_FILES[$key], $CUSTOM_PICTURES_PATH.$l1ILIlL.$filename) ){if ($l1ILl1I){ $adm->AddStatusMsg("status_add_over", "blue", I20655, I20655, Array(I20675=>$filename)); if($picSubPath =$adm->Vars[I20682]){ if(($pos =mb_strpos($picSubPath, I20681)) !== false) $picSubPath =mb_substr($picSubPath, 0, $pos); $l1ILl1l =$GLOBALS["ROOT_PATH"].$GLOBALS["CUSTOM_PICTURES_HTTP_PATH"].$picSubPath."/generated/"; $mask =$_FILES[$key]['name']; if(($pos =mb_strpos($mask, '.')) !== false) $mask =mb_substr($mask, 0, $pos); if(is_dir($l1ILl1l)){ $list =getDirFileList($l1ILl1l,$mask.'*'); foreach($list as $file){ @unlink($l1ILl1l.$file); }}}}else{ $adm->AddStatusMsg(I20683, "blue", I20655, I20655, Array(I20675=>$filename)); }$size =imageGetSize($CUSTOM_PICTURES_PATH.$l1ILIlL.$filename); if ($l1Il11l){ foreach($l1ILllI as $key=>$value){ if(!$IllIlIl->TIT1IT1($CUSTOM_PICTURES_PATH.$l1ILIlL.$filename, $CUSTOM_PICTURES_PATH.$l1ILIlL, $value[0], $value[1], $l1ILlLI, 0, $l1ILlll)){ $adm->AddStatusMsg("status_resize_fail", "red", I20655, I20655, Array("size"=>$value[0].$l1ILlIL.$value[1], I20675=>$filename)); }}if ((sizeof($l1ILllI) >0) && $l1ILlLl){ $l1Il11L->unlink($CUSTOM_PICTURES_PATH.$l1ILIlL.$filename); }else{ if ($l1ILIIL->GetOption("upload_img_allow_custom_size") && (($size[0]>$l1ILIlI[0]) || ($size[1]>$l1ILIlI[1]))){ if(!$IllIlIl->TIT1IT1($CUSTOM_PICTURES_PATH.$l1ILIlL.$filename, $CUSTOM_PICTURES_PATH.$l1ILIlL.$filename, $l1ILIlI[0], $l1ILIlI[1], true, 0, $l1ILlll)){ $adm->AddStatusMsg("status_force_resize_fail", "red", I20655, I20655, Array("size"=>$l1ILIlI[0].$l1ILlIL.$l1ILIlI[1], I20675=>$filename)); }}else{ if(sizeof($l1ILlll) >0){ if(!$IllIlIl->TIT1TII($CUSTOM_PICTURES_PATH.$l1ILIlL.$filename, $l1ILlll['layer'], $CUSTOM_PICTURES_PATH.$l1ILIlL.$filename, $l1ILlll[I20684], $l1ILlll['orient'])){ $adm->AddStatusMsg("status_set_watermark_fail", "red"); }}}}}$l1ILlI1 =true; }else{ $adm->AddStatusMsg("status_add_fail", I20685, I20655, I20655, Array(I20675=>$filename)); $l1ILlL1 =false; }}else{ $adm->AddStatusMsg("status_add_fail", I20685, I20655, I20655, Array(I20675=>$filename)); $l1ILlL1 =false; }}}}if ($l1ILlL1){ $l1ILIII["load_form"] ="1"; if(!empty($l1ILlLL)){ $l1ILIII["curr_img"] =$CUSTOM_PICTURES_HTTP_PATH.$l1ILIlL.$l1ILlLL; $l1ILIII[$l1ILILI] =$l1ILIII[I20686]; $l1ILIII[$l1ILILI."_img"] =$l1ILIII[I20686]; $l1ILIII[$l1ILILI."_img_url"] =$l1ILIII["curr_img_url"] =$lLI1I1L.$l1ILIlL.$l1ILlLL; $l1ILIIl[$l1ILILI."_img_url"] =$l1ILIIl[I20687] =$lLI1I1L.$l1ILIlL.$l1ILlLL; $l1ILIIl[$l1ILILI."_img_url_enc"] =htmlspecialchars(urlencode($l1ILIIl[I20687])); $size =imageGetSize($CUSTOM_PICTURES_PATH.$l1ILIlL.$l1ILlLL); if($l1ILILI=='txtFileName'){ $l1ILIII["txtWidth"] =$size[0]; $l1ILIII["txtHeight"] =$size[1]; }if($l1ILILI==I20688){ $l1ILIII["txtPopupWidth"] =$size[0]; $l1ILIII["txtPopupHeight"] =$size[1]; }$l1ILIII[$l1ILILI."_preview_width"] =$l1ILIII["curr_width"]; $l1ILIII[$l1ILILI.I20689] =$l1ILIII["curr_height"]; }}TlTl1TI($CUSTOM_PICTURES_PATH.$l1ILIlL, "KILLINDEX"); }$adm->Gui->delScript(); $adm->Gui->addScript("jsapi.php"); $adm->Gui->addScript($GLOBALS[I20654]."_js/ami.admin.js"); $path =$CUSTOM_PICTURES_PATH.$l1ILIlL; clearstatcache(); if (!$l1Il11L->TT1lIlI($path) || (isset($l1ILll1)&&(isset($l1ILll1)==$l1ILILL))){ $l1ILILl =I20655; $l1ILIlL =I20655; $l1ILILL =I20655; $path =$CUSTOM_PICTURES_PATH; }$files =TlTl1TI($CUSTOM_PICTURES_PATH, I20690); $l1ILl1L["path"] =I20655; $l1ILl1L["name_plain"] =$l1ILl1L[I20675] =$adm->Words["dir_common"]; $l1ILl1L["descr"] =$adm->Words[I20691]; $l1ILIIl["dir_items"] =''; if ($l1ILILl==I20655){ $l1ILl1L["selected"] ="selected"; $l1ILIIl[I20692] .= $adm->Gui->get("image:dir_item_sel",$l1ILl1L); }else{ $l1ILl1L["selected"] =I20655; $l1ILIIl[I20692] .= $adm->Gui->get("image:dir_item",$l1ILl1L); }$j=0; foreach($files as $Illl11I=>$I1llllL){ if(mb_strpos($I1llllL[I20675], "'") !== false){ continue; }$l1ILl1L[I20693] =$I1llllL[I20675]; if (!empty($l1ILlIl["dir_".$I1llllL[I20675]])){ $l1ILl1L["descr"] =$l1ILlIl["dir_".$I1llllL[I20675]]; }else{ $l1ILl1L["descr"] =I20655; }$l1ILl1L[I20675] =$I1llllL[I20675]; if ((floor($j/2) *2 == $j)){ $l1ILl1L[I20694] ='#F8F8F8'; }else{ $l1ILl1L[I20694] =''; }if ($I1llllL[I20675] == $l1ILILl){ $l1ILl1L["selected"] ="selected"; $l1ILIIl[I20692] .= $adm->Gui->get(I20695,$l1ILl1L); }else{ $l1ILl1L["selected"] =I20655; $l1ILIIl[I20692] .= $adm->Gui->get("image:dir_item",$l1ILl1L); }$j++; }$adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_ce_img_proc_msgs.lng")); $adm->Gui->addBlock("img_form",I20696); $l1ILIII["fld_name"] =$l1ILI11; $l1ILIII["obj_name"] =$obj_name; $l1ILIII["obj_type"] =$l1ILIll; $l1ILIII["obj_mode"] =$l1ILIL1; $l1ILIII[I20666] =$mode; $l1ILIII[I20658] =$l1ILILL; $l1ILIII[I20697] =$l1Il111; $l1ILl11 =$adm->Gui->get("image:form_".$form_type,$l1ILIII); $l1ILLII =$adm->Gui->get("image:js_".$l1ILIll,$l1ILIII); $l1ILIIl["js_functions"] =$l1ILLII; $l1ILIIl["form"] =$l1ILl11; $l1ILIIl[I20698] ="'".implode("','",$l1ILlII)."'"; $l1ILLIl["images"] =$adm->Gui->getAbs(I20699.$mode."_header",I20655); $l1ILLIl["images"] .= $adm->Gui->getAbs(I20699.$mode."_splitter",I20655); if(FALSE !== mb_strpos($adm->Vars['flt_name'], I20700)){ $adm->Vars['flt_name'] =rawurldecode(unhtmlentities($adm->Vars['flt_name'], TRUE)); }$files =TlTl1TI($path, "files", trim(rawurldecode($adm->Vars['flt_name'])) .I20701, '', $l1ILlII); if ($l1ILlI1 && !empty($filename)) {$adm->Pager->Position =array_search($filename, $files); }if($adm->Vars[I20674] == "search") {$adm->Pager->Position =0; }if ($adm->Vars[I20674] == "rsrtme"){ SetLocalCookie("ce_img_page_".$l1ILILL, $adm->Pager->Position, time()+30*24*3600); }else{ if(AMI::getSingleton(I20659)->get(I20702.$l1ILILL, I20655) != I20655) {$adm->Pager->Position =AMI::getSingleton(I20659)->get(I20702.$l1ILILL); }}$adm->Pager->MaxCount =sizeof($files); $adm->Pager->TI1TT1I(); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml($lll1lII, "javascript:go_page('[START]');"); if(isset($adm->Vars[I20703]) && ($adm->Vars[I20703] != I20655)) {$l1ILIII[I20703] =$adm->Vars[I20703]; $l1ILIIl[I20703] =$adm->Vars[I20703]; }$l1ILIII["pager_offset"] =$adm->Pager->Position; $l1ILIII["pager_limit"] =$adm->Pager->PageSize; $l1ILLIL =$adm->Gui->get("image:self_url",$l1ILIII); $l1ILLI1[I20704] =$l1ILLIL; $l1ILLlI =$adm->Gui->ParseLangFile("templates/lang/_ce_img_proc_items.lng"); $l1ILLI1[I20666] ="list"; $l1ILLI1["mode_descr"] =$l1ILLlI["browse_as_list"]; $l1ILLIl[I20705] =$adm->Gui->get("image:browse_mode",$l1ILLI1); $l1ILLI1[I20666] ="icons"; $l1ILLI1["mode_descr"] =$l1ILLlI["browse_as_icons"]; $l1ILLIl[I20706] =$adm->Gui->get("image:browse_mode",$l1ILLI1); $l1ILLI1[I20666] =$mode; $l1ILLI1["mode_descr"] =$l1ILLlI["browse_as_".$mode]; $l1ILLIl["browse_mode_".$mode] =$adm->Gui->get("image:browse_mode_active",$l1ILLI1); $l1ILLIl["browse_mode"] =$l1ILLIl[I20705]; $l1ILLIl["browse_mode"] .= $adm->Gui->getAbs("image:browse_mode_splitter"); $l1ILLIl["browse_mode"] .= $l1ILLIl[I20706]; if(sizeof($files) >0) {for ($i=$adm->Pager->TI1TTll()-1;$i<=$adm->Pager->TI1TTl1()-1;$i++){ if(mb_strpos($path.$files[$i][I20675], I20707) !== false){ continue; }$l1ILLll =TlITI11($files[$i]["ext"]); $fsize =@$l1Il11L->fileSize($path.$files[$i][I20675]); if ($fsize >99999){ $l1ILLlL["size"] =FormatNumber(floor($fsize/1024)+1, 0, 0); $l1ILLlL["size_post"] =$adm->Words["kilobyte"]; }else{ $l1ILLlL[I20708] =FormatNumber($fsize, 0, 0); $l1ILLlL["size_post"] =$adm->Words["byte"]; }$size =imageGetSize($path.$files[$i][I20675]); if (empty($size)){ continue; }$l1ILLlL["width"] =$size[0]; $l1ILLlL["height"] =$size[1]; if ($l1ILLlL[I20709] <= $l1Il1L1 && $l1ILLlL["height"] <= $l1Il11I ){$l1ILLlL["src_width"] =$l1ILLlL[I20709]; $l1ILLlL["src_height"] =$l1ILLlL["height"] ;}else{ if ($l1ILLlL[I20709] >$l1ILLlL[I20710]){ $l1ILLlL["src_width"] =$l1Il1L1; $l1ILLlL["src_height"] =round(($l1ILLlL[I20710]) /($l1ILLlL[I20709] /$l1Il1L1 ));}else{ $l1ILLlL["src_height"] =$l1Il11I; $l1ILLlL["src_width"] =round(($l1ILLlL[I20709]) /($l1ILLlL[I20710] /$l1Il11I ));}}$l1ILLlL[I20711]=I20707.$CUSTOM_PICTURES_HTTP_PATH.$l1ILIlL.$files[$i][I20675].I20707; $l1ILLlL["set_img_src"] =$lLI1I1L.$l1ILIlL.$files[$i][I20675]; if ($mode == "list") $l1ILLlL["img_name_short"] =$adm->stripLine($files[$i][I20675], 35); else $l1ILLlL["img_name_short"] =$adm->stripLine($files[$i][I20675], 25); $l1ILLlL[I20712] =$files[$i][I20675]; if (is_array($adm->VarsPost["files"]) && in_array($files[$i][I20675], $adm->VarsPost["files"])){ $l1ILLlL["checked"] ="checked"; }else{ $l1ILLlL[I20713] =I20655; }if ($l1ILLll[I20675] == "SWF"){ $l1ILLlL["img_src"] =$lLI1ILl.$l1ILLll["icon"]; $l1ILLlL["img_type"] =I20714; $l1ILLlL["src_height"] =I20655; $l1ILLlL["src_width"] =I20655; }else{ $l1ILLlL["img_type"] =I20655; $l1ILLlL["img_src"] =$lLI1I1L.$l1ILIlL.$files[$i][I20675]; }if ((floor($i/2) *2 == $i) && ($mode==I20715)){ $l1ILLlL[I20694] ='#F8F8F8'; }else {$l1ILLlL[I20694] =''; }if ($l1ILLlL[I20709] >I20655 && $l1ILLlL[I20710] >I20655) $l1ILLlL["size_splitter"] =$l1ILlIL; else $l1ILLlL["size_splitter"] =I20655; $l1ILLlL[I20704] =$l1ILLIL; $l1ILLlL[I20716] =$i; $l1ILLIl["images"] .= $adm->Gui->get(I20699.$mode."_item",$l1ILLlL); if ((floor(($i+1)/2) *2 == ($i+1)) || ($mode==I20715)){ $l1ILLIl["images"] .= $adm->Gui->getAbs(I20699.$mode."_splitter",I20655); }}$l1ILLIl[I20717] =$pager; $l1ILLIl[I20704] =$l1ILLIL; $l1ILIIl['images_list'] =$adm->Gui->get("image:images_list",$l1ILLIl); }else {$l1ILLIl[I20704] =$l1ILLIL; $l1ILIIl['images_list'] =$adm->Gui->get("image:images_list_empty", $l1ILLIl); }$l1ILIIl[I20718] =$adm->GetStatusMessages(); $l1ILIIl[I20704] =$l1ILLIL; $l1ILIIl["pager_limit"] =$adm->Pager->PageSize; $l1ILIIl["pager_offset"] =$adm->Pager->Position; $l1ILIIl[I20656] =$l1ILIl1; $l1ILIIl[I20657] =$l1ILILI; $l1ILIIl["pager_cat"] =$cat; $l1ILIIl["pager_set_cat"] =$l1ILILl; $l1ILIIl[I20719] =$l1ILI1I; $l1ILIIl["pager_bgodj"] =$l1ILI1l; $l1ILIIl["pager_fld"] =$l1ILI11; $l1ILIIl["pager_img"] =$l1ILI1L; $l1ILIIl["pager_mode"] =$mode; $l1ILIIl[I20720] =''; foreach($l1ILII1 as $key=>$value){ $l1ILLl1["dim"] =$value["0"].$l1ILlIL.$value["1"]; $l1ILLl1[I20721] =$value["0"]." ".$l1ILlIL." ".$value["1"]; $l1ILIIl[I20722] .= $adm->Gui->get("image:resize_item",$l1ILLl1); }$l1ILIIl["upload_allow_cusotm_size"] =($l1ILIIL->GetOption("upload_img_allow_custom_size"))?"1":I20723; $l1ILIIl["resize_options"] =$adm->Gui->get("image:resize_options",$l1ILIIl); if($l1ILILl != 'watermarks' && $l1Il11L->TT1lIlI($CUSTOM_PICTURES_PATH.'watermarks')){ $l1ILLLI =TlTl1TI($CUSTOM_PICTURES_PATH.I20724, 'files', I20701, '', $l1ILlII); if(sizeof($l1ILLLI) >0){ $I1IL1lI =array(); $I1IL1lI['watermark_sources'] .= $adm->Gui->getAbs("image:watermark_source_item", array( I20725 => $l1ILlIl['watermark_dont_use'], 'value' => '' ));for($ii =0; $ii <sizeof($l1ILLLI); $ii++){ $I1IL1lI['watermark_sources'] .= $adm->Gui->getAbs("image:watermark_source_item", array( I20725 => $l1ILLLI[$ii][I20725], 'value' => $l1ILLLI[$ii][I20725] ));}$l1ILLLl =array('downright', 'downleft', 'center', I20726, 'upleft', 'tile'); for($ii =0; $ii <sizeof($l1ILLLl); $ii++){ $I1IL1lI['watermark_methods'] .= $adm->Gui->getAbs("image:watermark_method_item", array( I20725 => $l1ILlIl[I20727.$l1ILLLl[$ii]], 'value' => $l1ILLLl[$ii] ));}$l1ILIIl["watermark_block"] =$adm->Gui->get("image:watermark_block", $I1IL1lI); }}$l1ILIIl["upload_form"] =$adm->Gui->get(I20728,$l1ILIIl); $l1ILIIl["metas"] =$adm->Gui->getMetas(); $l1ILIIl["scripts"] =$adm->Gui->getScripts(); $l1ILIIl["styles"] =$adm->Gui->getStyles(); $l1ILIIl["server_images"] =$adm->Gui->get("image:server_images",$l1ILIIl); $html =$adm->Gui->get("image",$l1ILIIl); $adm->Filter->TITIlll(); echo $html; $conn->Out(); 