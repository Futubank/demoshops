<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       15752 xkqwutryxlinkgwzplnrsqsxlixmzuiswqytpqnpqrtsuiuiiqpxsgisulktxqwltqirpnir
 */ ?><?php foreach(array(20764=>"GZPQD",20765=>"HYL",20766=>"MS",20767=>"",20768=>"IHSQ",20769=>"Wurr|rQf|urJ",20770=>"fMJQD|HffDQt",20771=>"MIZPQD|HffDQt",20772=>"rQf%DQJf|urJ",20773=>"LD|funWtMHnD",20774=>"ZJMPn=WQntQr",20775=>"LDZGM`GOG",20776=>'wURRqNT|dkmN|gzTo',20777=>"QxGZnS",20778=>'SQfZuJt|MSD',20779=>"fMJQD|JMIMt",20780=>"'{?ZD?SZtQ!?",20781=>"?",20782=>"fSQDWrMGtMHn",20783=>"ISZtQ",20784=>"WftGMWHn",20785=>"~",20786=>"fMJQDMAQ",20787=>"GuYJMW",20788=>"vMQC|JMnK",20789=>"fMJQD|JMDt",20790=>"`",20791=>"SMr|",20792=>"SMr|MtQID",20793=>"MIZPQD",20794=>"DMAQ",20795=>"MIZPQD|JMIMt",20796=>"h2w",20797=>"DrW|CMStO",20798=>"OQMPOt",20799=>"HnWJMWK",20800=>"nZIQ",20801=>"MWHn",20802=>"DQt|MIP|DrW",20803=>'',20804=>"DQJf|urJ",20805=>"|DGJMttQr",20806=>"MIZPQD|SMDGJZB",20807=>"rQf%tZY|nHrIZJ",20808=>"rQf%YrHCDQ|IHSQ",20809=>"IHSQ|SQDWr",20810=>"GZPQr|HSL",20811=>"YrHCDQ|IHSQ|JMDt",20812=>"IQtZD") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $ILlIlIl =1; $init_filter =1; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. 'init.php'; AMI_Service::hideDebug(); $adm->Words =$adm->Gui->ParseLangFile("templates/lang/main.lng"); $l1ILIll =""; $page_id=""; $cat =""; $l1ILIlL =""; $type =I20764; $mode ="list"; if (isset($adm->VarsGet["obj"]) && $adm->VarsGet["obj"] != ""){ $obj_name =$adm->VarsGet[I20765]; }else exit; if (isset($adm->VarsGet["type"]) && $adm->VarsGet["type"] != ""){ $type =$adm->VarsGet["type"]; }if (isset($adm->VarsGet[I20766])){ $page_id =$adm->VarsGet[I20766]; }if (isset($adm->VarsGet["cat"]) && $adm->VarsGet["cat"] != "" ){$cat =$adm->VarsGet["cat"]; $l1ILIlL =$cat; if ($cat !=I20767 )$l1ILIlL =$l1ILIlL."/"; }if (isset($adm->VarsGet["old_cat"]) && $adm->VarsGet["old_cat"] != I20767 ){$l1IL1LI =$adm->VarsGet["old_cat"]; }if (isset($adm->VarsGet[I20768])){ $mode =$adm->VarsGet[I20768]; $l1IL1Ll["img_display"] ='block'; }if (isset($adm->VarsGet["ref_url"]) && ($adm->VarsGet["ref_url"] !=I20767) ){$ref_form[I20769] =$adm->VarsGet["ref_url"]; }if($type == "files") {$l1IL1LL =$adm->VarsGet["offset"]; $l1IL1L1 =$adm->VarsGet["limit"]; }else {$l1IL1LL =$adm->VarsGet[I20770]; $l1IL1L1 =$adm->Vars["files_limit"]; }if($type == "images") {if($cat == $l1IL1LI) {$l1IL11I =$adm->Vars["offset"]; }else {$l1IL11I =0; }$l1IL11l =$adm->VarsGet["limit"]; }else {$l1IL11I =$adm->VarsGet[I20771]; $l1IL11l =$adm->Vars["images_limit"]; }$adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_ce_url_proc_msgs.lng")); $l1ILlIl =$adm->Gui->ParseLangFile("templates/lang/_ce_url_proc_items.lng"); $adm->Gui->addBlock("ref","templates/ce_url_proc.tpl"); $l1IL1Ll["obj_name"] =$obj_name; $l1IL1Ll["type"] =$type; $l1IL1Ll[I20768] =$mode; $l1IL1Ll["cat"] =$cat; $l1IL1Ll["www_root"] =$ROOT_PATH_WWW; $l1ILLIL =$adm->Gui->get(I20772,$l1IL1Ll); $adm->Gui->addBlock("ref_form","templates/form.tpl"); $l1IL11L =$adm->Gui->get("ref:form",$l1IL1Ll); $l1ILLII =$adm->Gui->get("ref:js",$l1IL1Ll); $l1IL1Ll[I20773] =$l1ILLII; $l1IL111["header"] =$adm->Words["ref_form_header"]; $l1IL111["content"] =$l1IL11L; $l1IL111["form_align"] =I20774; $l1IL1Ll["form"] =$adm->Gui->get("ref_form",$l1IL111); $l1IL1Ll["status"] =$adm->GetStatusMessages(); $l1IL1Ll["self_url"] =$l1ILLIL; $l1I1III =$adm->Pager->MaxCount; $adm->Gui->delScript(); $adm->Gui->addScript(I20775); $adm->Gui->addScript($GLOBALS['CURRENT_SKIN_PATH']."_js/tree.js"); $adm->Gui->addScript($GLOBALS['CURRENT_SKIN_PATH']."_js/ami.admin.js"); $adm->Gui->addStyle($GLOBALS[I20776]."_css/tree.css"); $adm->Gui->addBlock("tree", "templates/url_proc_tree.tpl"); $tree =&Tree::getInstance($adm); $tree->lang_data =$lang_data; $tree->ll1Il1l =$adm->DFMT["db_dtime"]; $tree->ll1IlLL =false; $variables[I20777] ="0"; if($adm->VarsGet[I20777] == "1"){ $tree->ll1IlLL =true; $variables[I20777] ="1"; }$tree->lang_data =$lang_data; $tree->ll1Il1l =$adm->DFMT["db_dtime"]; $tree->ll1IlLL =true; $tree->UseModLinks =true; $tree->UseScriptLinks =true; $tree->ForcePageIdWithScriptLinks =false; $lLLL1LI =$adm->Core->GetOption(I20778); $tree->TI11TT1($lLLL1LI[$adm->lang_data], $page_id, I20767); $l1IL1Ll["tree"]= $tree->table; $modFiles =$adm->Core->GetModule("files"); if($modFiles && $modFiles->IsInstalled()) {$adm->Gui->addBlock("files_list","templates/files_list_small.tpl"); $l1I1IIl =$adm->Gui->ParseLangFile("templates/lang/_files_items.lng"); $adm->Pager->InitPager($l1IL1LL, $l1IL1L1, $l1I1III); $adm->Filter->AddField("files_limit", "hidden", $l1IL1L1); $adm->Filter->TITIll1("files_limit"); $sql ="select count(id) as max_count from cms_files where lang='$lang_data'"; $db->query($sql); if($db->next_record()) {$adm->Pager->MaxCount =$db->Record["max_count"]; }else {$adm->Pager->MaxCount =0; }$adm->Pager->TI1TT1I(); $l1IL1Ll[I20770] =$adm->Pager->Position; $l1IL1Ll[I20779] =$adm->Pager->PageSize; $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml($lll1lII, "javascript:go_page('[START]');"); $modFiles->PushPager($adm->Pager); $modFiles->InitPager($adm->Pager); $l1I1IIL =$adm->Pager->TI1TTlT(); $modFiles->PopPager($adm->Pager); if($adm->Pager->MaxCount>0){ $sql ="select cf.id as id, cf.public as public, cf.name as name, cf.description as description, ". "date_format(cf.cdate, '".$adm->DFMT["db_dtime"].I20780. "date_format(cf.mdate, '".$adm->DFMT["db_dtime"]."') as mdate, ". "filesize as filesize, ". "cf.ftype as ftype, ". "cft.name as cftname, ". "cft.icon as cftpicon ". "from cms_files as cf ". "left join cms_ftypes as cft on cft.id=cf.ftype ". "where lang='$lang_data' ORDER BY cf.".$l1I1IIL.I20781.$adm->Pager->TI1TTlI(); $db->query($sql); $i =1; while($db->next_record()) {$l1I1II1[I20766] =$db->Record[I20766]; $id =$db->Record[I20766]; $l1I1II1["fname"] =$db->Record["name"]; $l1I1II1["j_fname"] =jparse($l1I1II1["fname"]); $l1I1II1[I20782] =$db->Record["description"]; $l1I1II1["fcdate"] =$db->Record["date"]; $l1I1II1["fmdate"] =$db->Record[I20783]; $l1I1II1["date"] =$db->Record["date"]; $l1I1II1["ftype"] =$db->Record["cftname"]; $l1I1IlI =$db->Record[I20784]; $l1I1II1["ficon"] ="<img src=\"".$GLOBALS["ROOT_PATH_WWW"].$modFiles->GetOption("icons_path").I20785.$l1I1IlI."\" border=0 alt=\"".$db->Record["cftname"]."\">"; $l1I1II1["fsize"] =number_format($db->Record[I20786]/1024,0,I20767,I20781); $links["del_id"] =$links["edit_id"] =$links["pub_id"] =$id; if($db->Record["public"] == 1) $l1I1II1[I20787] =$adm->Gui->get("files_list:public_on",$links); else $l1I1II1[I20787] =$adm->Gui->get("files_list:public_off",$links); $style ="row2"; if($i%2) $style="row1"; $l1I1II1[I20788] ="ftpgetfile.php?id=".$db->Record[I20766]; $actions =$adm->Gui->get("files_list:icons_edit_del",$links); $l1I1II1["actions"] =$actions; $l1I1II1["style"] =$style; $l1I1Ill[I20789] .= $adm->Gui->get("files_list:row",$l1I1II1); $i++; }}$l1I1Ill["pager"] =$pager; $l1IL1Ll["list_table"] .= $adm->Gui->get(I20789,$l1I1Ill); $l1IL1Ll["TAB_FILES_EXISTS"] =1; }$path =$CUSTOM_PICTURES_PATH.$l1ILIlL; if (!is_dir($path)){ $cat =I20767; $l1ILIlL =I20767; $path =$CUSTOM_PICTURES_PATH; }$files =Array(); $d =dir($CUSTOM_PICTURES_PATH); if(!is_object($d)) {trigger_error("Unable to find directory $CUSTOM_PICTURES_PATH", E_USER_ERROR); }$i=0; while (false !== ($entry =$d->read())) {$files[$i] =$entry; $i++; }sort($files); for ($i=0;$i<sizeof($files);$i++){ if (($files[$i] != I20790 && $files[$i] != "..") && is_dir($ROOT_PATH.$CUSTOM_PICTURES_HTTP_PATH.$files[$i])){ $l1ILl1L["path"] =$files[$i]; if (!empty($l1ILlIl["dir_".$files[$i]])) $l1ILl1L["name"] =$l1ILlIl[I20791.$files[$i]]; else $l1ILl1L["name"] =$files[$i]; if ($files[$i] == $cat) $l1ILl1L["selected"] ="selected"; else $l1ILl1L["selected"] =I20767; $l1IL1Ll[I20792] .= $adm->Gui->get("ref:dir_item",$l1ILl1L); }}$d =dir($path); if(!is_object($d)) {trigger_error("Unable to find directory $path", E_USER_ERROR); }$i =0; $l1I1IlL =120; $l1I1Il1 =90; $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_ce_img_proc_msgs.lng")); $adm->Gui->addBlock("img_form","templates/form.tpl"); $l1IL1Ll[I20793] =$adm->Gui->getAbs("ref:".$mode."_header",I20767); $l1IL1Ll[I20793] .= $adm->Gui->getAbs("ref:".$mode."_splitter",I20767); $i=0; $files =Array(); while (false !== ($entry =$d->read())) {$l1I1ILI =get_file_ext($entry); $l1ILLll =TlITI11($l1I1ILI); $fsize =@filesize ($path.$entry); $l1ILLlL[I20794] =round($fsize/1024); $size =is_file($path .$entry) ?imageGetSize($path .$entry) :array(0, 0, 0); if ($l1ILLll["name"] == "SWF"){ if (($size[0] == 0 && $size[1] == 0) || (($size[2] != 4) && ($size[2] != 13))) {continue; }}else if ($l1ILLll["name"] == "O2C"){ }else{ if (($size[0] == 0 && $size[1] == 0) || ($size[2] >3)) {continue; }}$files[$i] =$entry; $i++; }sort($files); $adm->Pager->InitPager($l1IL11I, $l1IL11l, $l1I1III); $adm->Filter->AddField(I20795, "hidden", $l1IL11l); $adm->Filter->TITIll1(I20795); $adm->Pager->MaxCount =sizeof($files); $adm->Pager->TI1TT1I(); $l1IL1Ll[I20771] =$adm->Pager->Position; $l1IL1Ll[I20795] =$adm->Pager->PageSize; $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml($lll1lII, "javascript:go_page('[START]');"); $l1IL1Ll["pager"] =$pager; for ($i=$adm->Pager->TI1TTll()-1;$i<=$adm->Pager->TI1TTl1()-1;$i++){ $l1I1ILI =get_file_ext($files[$i]); $l1ILLll =TlITI11($l1I1ILI); $fsize =@filesize ($path.$files[$i]); $l1ILLlL[I20794] =round($fsize/1024); $l1ILLlL[I20794] =round($fsize/1024); if ($l1ILLll["name"] == I20796){ $size[0] =400; $size[1] =400; }else{ $size =imageGetSize($path.$files[$i]); }$l1ILLlL["width"] =$size[0]; $l1ILLlL["height"] =$size[1]; if ($l1ILLlL["width"] <= $l1I1IlL && $l1ILLlL["height"] <= $l1I1Il1 ){$l1ILLlL[I20797] =$l1ILLlL["width"]; $l1ILLlL["src_height"] =$l1ILLlL["height"] ;}else{ if ($l1ILLlL["width"] >$l1ILLlL[I20798]){ $l1ILLlL[I20797] =$l1I1IlL; $l1ILLlL["src_height"] =round(($l1ILLlL[I20798]) /($l1ILLlL["width"] /$l1I1IlL ));}else{ $l1ILLlL["src_height"] =$l1I1Il1; $l1ILLlL[I20797] =round(($l1ILLlL["width"]) /($l1ILLlL[I20798] /$l1I1Il1 ));}}$l1ILLlL[I20799]="'$CUSTOM_PICTURES_HTTP_PATH$l1ILIlL$files[$i]'"; if ($mode == "list") $l1ILLlL["img_name_short"] =$adm->stripLine($files[$i], 160); else $l1ILLlL["img_name_short"] =$adm->stripLine($files[$i], 25); $l1ILLlL["img_name"] =$files[$i]; if ($l1ILLll[I20800] == "SWF"){ $l1ILLlL["img_name"] =$files[$i]; $l1ILLlL["img_src"] =$lLI1ILl.$l1ILLll["icon"]; $l1I1ILl =imageGetSize($lLI1ILl.$l1ILLll[I20801]); $l1ILLlL["src_height"] =$l1I1ILl[1]; $l1ILLlL[I20797] =$l1I1ILl[0]; $l1ILLlL["set_img_src"] =$lLI1I1L.$l1ILIlL.$files[$i]; }else{ $l1ILLlL["img_name"] =$files[$i]; $l1ILLlL["img_src"] =$lLI1I1L.$l1ILIlL.$files[$i]; $l1ILLlL[I20802] =$lLI1I1L.$l1ILIlL.$files[$i]; }if ((floor($i/2) *2 == $i) && ($mode=='list')){ $l1ILLlL["bgcolor"] ='#F0F0F0'; }else{ $l1ILLlL["bgcolor"] =I20803; }if ($l1ILLlL["width"] >I20767 && $l1ILLlL[I20798] >I20767) $l1ILLlL["size_splitter"] =$adm->Gui->getAbs("ref:size_splitter",I20767); else $l1ILLlL["size_splitter"] =I20767; $l1ILLlL[I20804] =$l1ILLIL; $l1IL1Ll[I20793] .= $adm->Gui->get("ref:".$mode."_item",$l1ILLlL); if ((floor(($i+1)/5) *5 == ($i+1)) || ($mode=='list')){ $l1IL1Ll[I20793] .= $adm->Gui->getAbs("ref:".$mode.I20805,I20767); }}$d->close(); $l1IL1Ll["pages_display"] =$adm->Gui->getAbs("ref:display_no",I20767); $l1IL1Ll["files_display"] =$adm->Gui->getAbs("ref:display_no",I20767); $l1IL1Ll[I20806] =$adm->Gui->getAbs("ref:display_no",I20767); $l1IL1Ll[$type."_display"] =$adm->Gui->getAbs("ref:display_yes",I20767); $l1IL1Ll["tab_pages"] =$adm->Gui->getAbs(I20807,I20767); $l1IL1Ll["tab_files"] =$adm->Gui->getAbs(I20807,I20767); $l1IL1Ll["tab_images"] =$adm->Gui->getAbs(I20807,I20767); $l1IL1Ll["tab_".$type] =$adm->Gui->getAbs("ref:tab_sel",I20767); $l1ILLlI =$adm->Gui->ParseLangFile("templates/lang/_ce_url_proc_items.lng"); $l1ILLI1[I20804] =$l1ILLIL; $l1ILLI1[I20768] ="list"; $l1ILLI1["mode_descr"] =$l1ILLlI["browse_as_list"]; $l1IL1Ll["browse_mode_list"] =$adm->Gui->get(I20808,$l1ILLI1); $l1ILLI1[I20768] ="icons"; $l1ILLI1["mode_descr"] =$l1ILLlI["browse_as_icons"]; $l1IL1Ll["browse_mode_icons"] =$adm->Gui->get(I20808,$l1ILLI1); $l1ILLI1[I20768] =$mode; $l1ILLI1[I20809] =$l1ILLlI["browse_as_".$mode]; $l1IL1Ll["browse_mode_".$mode] =$adm->Gui->get("ref:browse_mode_active",$l1ILLI1); $l1IL1Ll["pager_type"] =$type; $l1IL1Ll[I20810] =$obj_name; $l1IL1Ll["pager_id"] =$page_id; $l1IL1Ll["pager_cat"] =$cat; $l1IL1Ll["pager_mode"] =$mode; $l1IL1Ll["browse_mode"] =$l1IL1Ll[I20811]; $l1IL1Ll["browse_mode"] .= $adm->Gui->getAbs("ref:browse_mode_splitter"); $l1IL1Ll["browse_mode"] .= $l1IL1Ll["browse_mode_icons"]; $l1IL1Ll[I20812] =$adm->Gui->getMetas(); $l1IL1Ll["scripts"] =$adm->Gui->getScripts(); $html =$adm->Gui->get("ref",$l1IL1Ll); $adm->Filter->TITIlll(); echo $html; $conn->Out(); 