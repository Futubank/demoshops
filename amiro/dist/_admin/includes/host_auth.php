<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       17745 xkqwwsnwnulmpuzttttukwrntprxrsrtzliwtgttyqqyqtwtlwkwgwstgrksiruzigwmpnir
 */ ?><?php foreach(array(21227=>'|O',21228=>"OHDt|SZtZ",21229=>"GHDtfMx",21230=>"uDQrnZIQ",21231=>"uMS",21232=>'zsi|gRqF',21233=>"",21234=>"ZSI|WHGB|urJ",21235=>"Hn",21236=>'fuJJ|DDJ',21237=>"MnSQx`GOG",21238=>'DDJ|HnJB',21239=>"JHPMn`GOG",21240=>'wURRqNT|dkmN|gzTo',21241=>"yUmjsqR|VqRdmhN",21242=>"nHMnSQx!?nHfHJJHC",21243=>'IQtZ',21244=>"fZWtMHn",21245=>'',21246=>"SQfZuJt|SHIZMn",21247=>"QIZMJ",21248=>'JHPMn|tBGQ',21249=>'DtZtuD',21250=>'OttGD%~~',21251=>'fZWtMHn',21252=>'YJHWK',21253=>'WQ|MIP|WZt',21254=>"JHPMnnZIQ",21255=>'SQfZuJt',21256=>']<037^',21257=>'ODMS',21258=>'OttG%~~',21259=>'JHPMnnZIQ',21260=>'DDJ|QnZYJQS',21261=>'0',21262=>"SHIZMn",21263=>"HGtMHnD|fZMJ",21264=>'IHSQ',21265=>"fHrPHt",21266=>"DMtQ|nHt|fHunS",21267=>'QIZMJ',21268=>"'?",21269=>"fuJJnZIQ",21270=>'RqihTq|zssR',21271=>"DtZtuD",21272=>"IHSQ",21273=>'SHIZMn') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} function TlIT1ll($loginName){ $loginName =htmlspecialchars($loginName); $loginName =str_replace(Array('%%'), Array('&#037;&#037;'), $loginName); return $loginName; }function __fillLoginInfo() {global $oSess; if($GLOBALS[I21227]["mode"]=='shared') {$GLOBALS[I21227]["user_domain"] =$oSess->Data["user"][I21228]["domain"]; $GLOBALS[I21227]["user_dir"] =$oSess->Data["user"][I21228]["home_dir"].$GLOBALS[I21227][I21229]; }else {$GLOBALS[I21227]["user_domain"] ='default'; }$GLOBALS[I21227]["user_name"] =$oSess->Data["user"][I21230]; $GLOBALS[I21227]["auth"] =true; $GLOBALS[I21227]["sys_user"] =$oSess->Data["user"]["sys_user"]; $GLOBALS[I21227][I21231] =$oSess->Data["user"]["id"]; }$logout =defined('ADMIN_DO_LOGOUT') && ADMIN_DO_LOGOUT === true; $adm_pref =DEFAULT_ADM_PREF; if(!empty($_POST["adm_pref"])){ $adm_pref =$_POST["adm_pref"]; }elseif(defined(I21232)){ $adm_pref =ADM_PREF; }$_h["adm_pref"] =$adm_pref; $ADM_COPY_PREF =""; $ADM_COPY_MAIL =""; $ADM_COPY_URL =""; $ADM_COPY_NAME =I21233; if(!empty($l1IIll1[$adm_pref]["adm_copy_pref"])){ $ADM_COPY_PREF =$l1IIll1[$adm_pref]["adm_copy_pref"]; }if(!empty($l1IIll1[$adm_pref]["adm_copy_mail"])){ $ADM_COPY_MAIL =$l1IIll1[$adm_pref]["adm_copy_mail"]; }if(!empty($l1IIll1[$adm_pref][I21234])){ $ADM_COPY_URL =$l1IIll1[$adm_pref][I21234]; }if(!empty($l1IIll1[$adm_pref]["adm_copy_pref"])){ $ADM_COPY_NAME =$l1IIll1[$adm_pref]["adm_copy_name"]; }$oSess->Start(empty($l1IIlLl) ?false :$l1IIlLl); $l1lllLL =isset($_SERVER["HTTPS"]) && (($_SERVER["HTTPS"] == I21235) || ($_SERVER["HTTPS"] == "https")); if($oSess->IsLoggedIn() && !$logout && empty($_POST['hsid']) && !isset($_POST["faction"])) {$oSess->TlIITT1(); if($l1lllLL && ADMIN_REQUIRE_SSL != I21236){ $oSess->Location("http://" .$_SERVER["HTTP_HOST"] .$_SERVER["REQUEST_URI"]); }__fillLoginInfo(); }else if(!isset($l1IIlLL) || !$l1IIlLL) {$email ="support@amiro.ru"; $script_link =$ADMIN_PATH_WWW.I21237; require_once $l1IlIlI .'template.php'; require_once $l1IlIlI .'guiAdmin.php'; require_once $l1IlIlI .'Mailer.php'; $l1lllL1 =false; if(isset($_POST['allow_ssl']) || (ADMIN_REQUIRE_SSL == I21238)){ $l1lllL1 =true; }if($l1lllL1 && !$l1lllLL){ $l1lll1I ="https://" .$_SERVER["HTTP_HOST"] .$_SERVER["REQUEST_URI"]; $oSess->Location($l1lll1I); }$l1lll1l =TlITlll(); $l1lll1L =pathinfo($l1lll1l); if(!empty($l1lll1l) && !in_array($l1lll1L["basename"], array(I21239, "custom_login.php"))){ $script_link =$l1lll1l; }if(mb_strpos($script_link, 'http') !== 0){ $script_link ='http://' .$_SERVER['HTTP_HOST'] .$script_link; }$GLOBALS[I21240] ='skins/vanilla/'; $Gui =new gui(); $Gui->_setLang($l1IlIl1); $Gui->setSkinPath($GLOBALS[I21240]); $Gui->addStyle($GLOBALS[I21240]."_css/style.css"); $Gui->AddGlobalVars(Array("BUILDER_VERSION" => isset($GLOBALS["BUILDER_VERSION"]) ?$GLOBALS[I21241] :1)); $Gui->addBlock("login", "_host/login.tpl"); $Gui->AddMeta("name", "robots", I21242); $Il11lIL =array ('ADM_COPY_PREF' => $ADM_COPY_PREF, 'ADM_COPY_MAIL' => $ADM_COPY_MAIL, 'ADM_COPY_URL' => $ADM_COPY_URL, 'ADM_COPY_NAME' => $ADM_COPY_NAME, I21243 => $Gui->getMetas() );$Gui->addGlobalVars($Il11lIL); $mess =$Gui->parseLangFile("_host/_login.lng"); $action =I21233; $fform ="login"; $l1lll11 =array ('login', 'forgot'); if(isset($_POST[I21244]) && in_array($_POST[I21244], $l1lll11)) $fform =$action =$_POST[I21244]; if(isset($_GET["fform"]) && in_array($_GET["fform"], $l1lll11)) $fform =$_GET["fform"]; if($logout){ $oSess->Stop(); $action =I21233; }$loginname =empty($_GET['loginname']) ?I21245 :$_GET['loginname'];; if(empty($loginname)) $loginname =empty($_COOKIE["hst_username"]) ?I21245 :$_COOKIE["hst_username"]; $domain =(empty($_COOKIE["hst_domain"]))?$mess[I21246]:addslashes($_COOKIE["hst_domain"]); if(!empty($_POST["domain"])) $domain =addslashes(mb_strtolower(trim($_POST["domain"]))); if(!empty($_POST["email"])) $l1llLII =addslashes(trim($_POST[I21247])); if (mb_substr($domain, 0, 7) == "http://"){ $domain =mb_substr($domain, 7); }if (mb_substr($domain, 0, 4) == "www."){ $domain =mb_substr($domain, 4); }$loginType =isset($_GET['login_type'])? $_GET['login_type']: (isset($_POST[I21248])? $_POST[I21248]: 'domain'); $l1llLIl =array( 'domain' => $domain, 'loginname' => $loginname, 'loginpwd' => I21245, I21249 => I21245, 'email' => $email, 'script_link' => $script_link, 'script_link_https' => str_replace('http://', I21250, $script_link), 'ssl_checked' => isset($_COOKIE['ssl_enabled']) ?$_COOKIE['ssl_enabled'] :TRUE, 'ADMIN_REQUIRE_SSL' => ADMIN_REQUIRE_SSL, I21251 => $fform, 'fform' => $fform, I21248 => $loginType, 'domain_display_style' => $loginType == 'client' ?'none': I21252 );switch ($action){ case "login": SetLocalCookie('cookieid', I21245, -1, I21245, true); SetLocalCookie('cookieidbr', I21245, -1, I21245, true); SetLocalCookie('ce_img_mode', I21245, -1, I21245, true); SetLocalCookie(I21253, I21245, -1, I21245, true); SetLocalCookie('cookie_data', I21245, -1, I21245, true); SetLocalCookie('lang_data', I21245, -1, I21245, true); SetLocalCookie('user_skin2', I21245, -1, I21245, true); sleep(1); $l1llLIL =false; $UA =getenv("HTTP_USER_AGENT"); $l1llLIl[I21254] =trim($_POST[I21254]); if($_h["mode"] == "shared") $l1llLIl["domain"] =$domain; else $l1llLIl["domain"] =I21255; $pwd =str_replace(array('#', '%', '\''), array('&#035;', I21256, '&#039;'), htmlspecialchars(trim($_POST['loginpwd']))); $l1llLIL =$oSess->TlIIT11( $l1llLIl["domain"],$l1llLIl[I21254], $pwd, $_POST['tstamp'], $_POST[I21257],$_POST['backurl']); if(is_string($l1llLIL)) {$l1llLIl['password'] =htmlspecialchars($_POST['loginpwd']); $l1llLIl['url'] =($l1lllLL ?str_replace(I21258, I21250, $l1llLIL) :$l1llLIL ).'index.php'; $l1llLIl['domain'] =TlIT1ll($l1llLIl['domain']); $l1llLIl['loginname'] =TlIT1ll($l1llLIl[I21259]); echo $Gui->get('login:redirect_login',$l1llLIl); exit; }if(ADMIN_REQUIRE_SSL == 'allow_ssl'){ if(isset($_POST['allow_ssl'])){ $oSess->SetLocalCookie('ssl_enabled', 1, 3600*24*365); }else{ $oSess->SetLocalCookie(I21260, 0, 3600*24*365); }}$oSess->hiddenIP =Array('192.168.2.%', '192.168.240.%'); $oSess->TlIIITT($l1llLIl[I21254], $l1llLIl["domain"], $l1llLIL); if($l1llLIL){ __fillLoginInfo(); smartSetCookie(false, 'amiAdmMessages', I21261, time() -3600*24*12, null, null); if(!empty($pwd) && empty($_POST[I21257])) {$oSess->SetLocalCookie("hst_username", $l1llLIl[I21254], 3600*24*12); if($l1llLIl["domain"] != '_client_') {$oSess->SetLocalCookie("hst_domain", $l1llLIl[I21262], 3600*24*12); }}do {if(!empty($oSess->Data['locked'])) {$l1llLIl["status"] =$mess["domain_locked"]; break; }$oSess->Location($script_link); }while(false); }else {if($l1llLI1){ $l1llLIl["status"] =$mess[I21263]; }elseif($oSess->TlIITTT()) {$l1llLIl["status"] =$mess["db_failed"]; }else $l1llLIl["status"] =$mess["wrong_login" .($_h[I21264] != 'shared' ?'_single' :I21245)]; }break; case "forgot": $l1llLIl["fform"] =I21265; if($oSess->hostMode == "shared") {$sql ="SELECT status, admin_status ". "FROM cms_host_users ". "WHERE domain_orig='$domain'"; $res =$oSess->TlIITTI($sql); $host_data =@mysql_fetch_array($res); if($host_data===false){ $l1llLIl["status"] =$mess[I21266]; break; }}$l1llLlI =array(); $l1llLll ="SELECT m.* FROM cms_members m,cms_host_users u ". "WHERE m.email LIKE '%$l1llLII%' AND m.id=u.id_member AND u.sys_user=1"; $res =$oSess->TlIITTI($l1llLll,TlITllI('get',$domain)); $aData =@mysql_fetch_array($res); $l1llLlI =preg_split('/[,\s]/s', $aData['email'], -1, PREG_SPLIT_NO_EMPTY); $l1llLlI[] =$aData[I21267]; $l1llLlL =$aData[I21267]; if (!in_array(mb_strtolower($l1llLII), array_map('mb_strtolower', $l1llLlI))) {$l1llLIl["status"] =$mess["wrong_data"]; break; }$password =GeneratePassword(8); $sql ="UPDATE cms_members SET password='".md5($password).I21268. "WHERE id='".$aData["id"]."'"; $oSess->TlIITTl($sql,TlITllI('get',$domain)); $IllI1ll[I21269] =$aData["firstname"]." ".$aData["lastname"]; $IllI1ll[I21230] =$aData[I21230]; $IllI1ll['ip'] =$_SERVER[I21270]; if($oSess->hostMode == "shared"){ $IllI1ll["adminurl"] ="http://$domain/_admin/"; }else{ $IllI1ll["adminurl"] =$ADMIN_PATH_WWW; }$IllI1ll["password"] =$password; $body =nl2br($Gui->get("login:reset_password_".$oSess->lang, $IllI1ll)); require_once($l1IlIlI."Mailer.php"); $oMail =new Mailer(); $oMail->Subject =$mess["forgot_subject"]; $oMail->Body =$body; $oMail->RecipientAddress =$l1llLlL; $oMail->SenderAddress =$ADM_COPY_MAIL; $oMail->BodyFormat ="html"; $oMail->Encoding ="UTF-8"; $oMail->Prepare(); if($oMail->Send()){ $l1llLIl[I21271] =$mess["password_sent"]; $l1llLIl["fform"] =$l1llLIl[I21251] ="login"; }else{ $l1llLIl[I21271] =$mess["password_send_fail"]; }break; }if($_h[I21272] == "shared") $l1llLIl["host_mode"] =1; if($l1llLIl['domain'] == '_client_') {$l1llLIl[I21273] =I21245; }$l1llLIl[I21273] =TlIT1ll($l1llLIl[I21273]); $l1llLIl[I21259] =TlIT1ll($l1llLIl[I21259]); $HtmlBody =$Gui->get("login", $l1llLIl); $oSess->Stop(); ob_start('ob_gzhandler'); header('Content-Type: text/html; charset=UTF-8'); echo $HtmlBody; exit; }else{ exit; }