<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       8728 xkqwmmrgygkympxzulrwzrnyxgpxqgxwniiqigwsrpqnlllgtzimyimxtxmnlzsuwrkrpnir
 */ ?><?php foreach(array(21886=>'MnMt`GOG',21887=>'',21888=>"nZIQ",21889=>"DtZrt",21890=>"DtZtuD|ZSS|fZMJ",21891=>"QnS",21892=>"coqRq?MS='",21893=>"DtZtuD|ZGGJB|fZMJ",21894=>"SQJ",21895=>'MS',21896=>"ZWtMHn",21897=>"DQJQWtQS",21898=>"MS",21899=>"ZGGJB",21900=>"tQxt",21901=>"SZtQfrHI",21902=>"coqRq?1?",21903=>"ZrQZ",21904=>"rHC3",21905=>"MGJMDt|JMDt",21906=>"JQPQnS",21907=>"MGJMDt|JMDt%QIGtB",21908=>"JMDt|tZYJQ",21909=>"tQIGJZtQD~fHrI`tGJ",21910=>"MGJMDt|DuYfHrI",21911=>"WHntQnt",21912=>"",21913=>"fHrI|ZJMPn") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl ="services"; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. I21886; $l1lL1l1 =&$adm->Core->GetModule("iplist"); if(!$adm->Core->GetOption("allow_ip_limits")) {}else {$adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_iplist_msgs.lng")); $adm->AddStatusMsg('your_ip', I21887, I21887, I21887, Array('ip' => getenv("REMOTE_ADDR"))); if($adm->Vars['action'] == "add") {$name =$adm->VarsPost[I21888]; $start =ip2long($adm->VarsPost["start"]); $end =ip2long($adm->VarsPost["end"]); $area =$adm->VarsPost["visible_area"]; if($name != "") {$asql =Array( I21888=>$name, I21889=>$start, "end"=>$end, "area"=>$area );$sql =$db->GenInsertSQL("cms_iplist", $asql); $db->query($sql); $lid =$db->lastInsertId(); $applied_id =$lid; $adm->AddStatusMsg("status_add"); }else{ $adm->AddStatusMsg(I21890, "red"); }}if($adm->Vars['id']>0 && $adm->Vars['action'] == "apply" ){$name =$adm->VarsPost[I21888]; $start =ip2long($adm->VarsPost[I21889]); $end =ip2long($adm->VarsPost[I21891]); $area =$adm->VarsPost["visible_area"]; if($name != "") {$asql =Array( I21888=>$name, I21889=>$start, I21891=>$end, "area"=>$area );$sql =$db->GenUpdateSQL("cms_iplist", $asql, I21892.$adm->Vars['id']."'"); $db->query($sql); $applied_id =$adm->Vars['id']; $adm->AddStatusMsg("status_apply"); }else{ $adm->AddStatusMsg(I21893, "red"); }unset($adm->Vars['id']); }if($adm->Vars['id']>0 && $adm->Vars['action'] == I21894) {$sql ="DELETE FROM cms_iplist WHERE id='".$adm->Vars['id']."'"; $db->query($sql); $adm->AddStatusMsg("status_del"); unset($adm->Vars[I21895]); }$form["date"] =date($adm->DFMT["php"]); $form["apply"] ="disabled"; $form[I21896] ="add"; $form["public"] ="checked"; $form["right"] =I21897; if( $adm->Vars['action'] == "edit" && $adm->Vars[I21895]>0) {$sql ="SELECT id, start, end, name, area FROM cms_iplist ". I21892.$adm->Vars[I21895]."'"; $db->query($sql); if($db->next_record()) {$form[I21898] =$db->Record[I21898]; $form[I21889] =long2ip($db->Record[I21889]); $form[I21891] =long2ip($db->Record[I21891]); $form[I21888] =$db->Record[I21888]; $form["area_".$db->Record["area"]] =I21897; $form["add"] ="disabled"; $form[I21896] =I21899; $form[I21899] =""; }}$adm->Gui->addBlock("iplist_list","templates/iplist_list.tpl"); $adm->Filter->AddField("flt_name", I21900, stripslashes(unhtmlentities($adm->Vars["flt_name"])), "", " like ", I21888); $adm->Filter->MoveField("flt_name",_MOVE_PREV); if($adm->Filter->issetField(I21901)) $adm->Filter->TITI1l1(I21901); if($adm->Filter->issetField("dateto")) $adm->Filter->TITI1l1("dateto"); $adm->Pager->InitSQL( "a.id, a.name, a.is_default ", "FROM cms_ip_area a ", I21902.$adm->Filter->GetFilterSql(), "", I21888, "a.id asc", Array() );if(isset($applied_id) && $applied_id>0){ $adm->Pager->ArrangePosSQL($db, $applied_id, 'a.id'); }$adm->Pager->ProcessSQL($db); if($db->num_rows()){ $i=1; while($db->next_record()) {$lid =$db->Record[I21898]; $l1lL1LI[I21888] =$adm->stripLine($db->Record[I21888], 50); $l1lL1LI[I21889] =long2ip($db->Record[I21889]); $l1lL1LI[I21891] =long2ip($db->Record[I21891]); $l1lL1LI["area"] =$db->Record[I21903]; $links["del_id"] =$links["edit_id"] =$lid; $style ="row2"; if($i%2) $style="row1"; if($adm->Vars[I21895]>0 && $adm->Vars[I21895] == $lid) $style =I21904; if($lid == $applied_id) $style ="row4"; $actions =$adm->Gui->get("iplist_list:icons_edit_del",$links); $l1lL1LI["actions"] =$actions; $l1lL1LI["style"] =$style; $l1lL1Ll[I21905] .= $adm->Gui->get("iplist_list:row",$l1lL1LI); $i++; }$l1lL1Ll["legend"] .= $adm->Gui->getAbs("iplist_list:leg_yellow",""); $l1lL1Ll[I21906] .= $adm->Gui->getAbs("iplist_list:leg_blue",""); $l1lL1Ll[I21906] .= $adm->Gui->getAbs("iplist_list:leg_edit",""); $l1lL1Ll[I21906] .= $adm->Gui->getAbs("iplist_list:leg_del",""); $l1lL1Ll["pager"] =$pager; $html["list_table"] =$adm->Gui->get(I21905,$l1lL1Ll); }else {$html["list_table"] =$adm->Gui->getAbs(I21907,""); $html["list_table"] .= $adm->Gui->getAbs("spacer",""); }$html[I21908] .=$adm->Gui->getAbs("spacer",""); $form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); $adm->Gui->addBlock("iplist_form",I21909); $adm->Gui->addBlock("iplist_subform", "templates/iplist_form.tpl"); if($form["add"] != "disabled") {$l1lL1Ll =$adm->Gui->get(I21910, $form); $html["form"] =$adm->Gui->getAbs("iplist_form",Array("header"=>$adm->Words["iplist_add"],I21911=>$l1lL1Ll,"form_align"=>"align=center")); }else {if($form[I21896] == I21899) {$form["cancel"] =$adm->Gui->getAbs("iplist_subform:cancel", I21912); }$l1lL1Ll =$adm->Gui->get(I21910, $form); $html["form"] =$adm->Gui->getAbs("iplist_form",Array("header"=>$adm->Words["iplist_apply"],I21911=>$l1lL1Ll,I21913=>"align=center")); }}require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; ?>