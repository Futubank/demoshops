<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       57216 xkqwkiuklktwgingnrqlrtggkmmxkgyqyzixzqmnxsnluqxspuxxququnmwzgpklxxqqpnir
 */ ?><?php foreach(array(21980=>"DMIGJQ",21981=>'QxGHrt',21982=>"GIZnZPQr",21983=>"JZB|YHSB|tBGQ",21984=>"JZB|f",21985=>"|tBGQ",21986=>"|YHSB",21987=>"",21988=>'tZ|GHDMtMHn',21989=>'tZ|OMPOJMPOt',21990=>'tZ|PJY|OMPOJMPOt',21991=>'',21992=>"WHIIHn`WDD",21993=>"JZBHutD|JMDt",21994=>'WDD|fMJQ|YHSB',21995=>'MIGHrt',21996=>'RhhT|gzTo',21997=>'QxGHrt|',21998=>'fHrI',21999=>'WHIIHn|LD',22000=>'fZMJ',22001=>'~',22002=>'~JZBHutD~',22003=>'WZGtMHn',22004=>'WHntQnt',22005=>'rHCD',22006=>'nZIQ',22007=>'MIGHrt|fHrI',22008=>'SQDMPn|rHCD',22009=>'zUTohR',22010=>'SQDMPn|vQrDMHn',22011=>'WHIIHn|DQttMnPD',22012=>'SIoM',22013=>"MS",22014=>"WDD|fMJQ",22015=>'ffMJQnZIQ',22016=>"WHntQnt",22017=>"JZB|IZMn",22018=>"nZIQ",22019=>"DtZtuD|ZSS|fZMJ",22020=>'C',22021=>"fMJQ",22022=>"rQS",22023=>"WID|JZBHutD",22024=>"QSMt",22025=>"FUNw|mNwjUsqd|gzTo",22026=>'?}',22027=>'MD|SQfZuJt',22028=>'JZB|YHSB|tBGQ',22029=>'OtIJ|OQZS|tZMJ',22030=>"DtZtuD|WHGB|fZMJ",22031=>"WDD|fMJQ|WrQZtQ",22032=>'\\\\',22033=>'"',22034=>"QrrHr|WHSQ",22035=>"coqRq?MS='",22036=>"|YHSB!'",22037=>"ZWtMHn",22038=>"DtZtuD|ZGGJB|fZMJ",22039=>"DtZtuD|WDD|IMDDMnP",22040=>"MD|SQfZuJt",22041=>"DtZtuD|ZGGJB",22042=>"|YHSB|HrMPMnZJ",22043=>"JZB|IZMn|YHSB",22044=>"WID|GZPQD",22045=>"DtZtuD|YZWKuG",22046=>'fHrWQ|MS',22047=>'nQC|MS',22048=>'JZB|MS',22049=>"'",22050=>'JZBHutD',22051=>'SQJQtQ|JZBHut',22052=>"WHnfMrI%fHrI",22053=>"ZIM|JZBHut",22054=>"SMDZYJQS",22055=>"JZB|YHSB|vZJuQ",22056=>'|tBGQ',22057=>'JZB|f|tBGQ|CZrn',22058=>"YHSB",22059=>"dqjqwT?[?",22060=>"ZGGJB",22061=>"JZB|f|nuI",22062=>'JZnPD|',22063=>'tZ|WurrQnt',22064=>'Qnv~WHHKMQ',22065=>"GZtO",22066=>'WDD|MtQID',22067=>"DtBJQD|YHSB|JMDt",22068=>"WDD|fMJQD|rQDQrvQS",22069=>"GOG",22070=>"uSZtQfrHI",22071=>"fJt|IHSQ",22072=>"?JMKQ?",22073=>'SZtQtH',22074=>"HffDQt",22075=>'JZBHutD|JMDt',22076=>"QSMt|MS",22077=>"GZPQ|MS",22078=>"JZBHutD|JMDt%rHC",22079=>"JQPQnS",22080=>"JMDt|tZYJQ",22081=>"JZBHutD|DuYfHrI",22082=>"fHrI|ZJMPn",22083=>"ZJMPn=WQntQr",22084=>"fHrI") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} if ((isset($_GET["flt_mode"]) && $_GET["flt_mode"] == I21980) || (isset($_POST["flt_mode"]) && $_POST["flt_mode"] == I21980) || (isset($_GET["action"]) && in_array($_GET["action"], array(I21981, 'export_form', 'import', 'import_form', 'import_params'))) ){$I11I1LI =1; }$lLIlIIl =I21982; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath .'init.php'; AMI::getSingleton('env/async50')->init("layouts", $adm); function TlIIITI(&$asql, &$isError, $exitOnError) {global $adm; if (isset($adm->VarsPost[I21983])) {if ($adm->VarsPost[I21983] != "") {$asql[I21983] =$adm->VarsPost[I21983]; }else {$isError =true; if ($exitOnError) {return; }}}for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {if (isset($adm->VarsPost["lay_f" .$i ."_type"])) {if ($adm->VarsPost[I21984 .$i ."_type"] != "") {$asql[I21984 .$i ."_type"] =$adm->VarsPost[I21984 .$i ."_type"]; }else {$isError =true; if ($exitOnError) {return; }}}else {$asql[I21984 .$i .I21985] =""; }}}function TlIIITl(&$I1ll1II) {global $adm, $db, $lang_data; $asql =Array(); for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {if ($I1ll1II[I21984 .$i .I21985] != "") {$asql[I21984 .$i ."_body"] =$I1ll1II[I21984 .$i .I21986]; $asql[I21984 .$i .I21986] ="=|IF( block_mask & ( 1 << (" .$i ."-1)),lay_f" .$i ."_body,'" .$I1ll1II[I21984 .$i .I21986] ."')"; }else {$asql[I21984 .$i .I21986] =I21987; }}$sql =$db->GenUpdateSQL("cms_pages", $asql, "WHERE lang='$lang_data' AND lay_id='" .$adm->Vars["id"] ."'"); $db->query($sql); if ($db->affected_rows() >0) {$adm->Core->Cache->ClearAdd("all"); }}function TlIIIT1() {global $adm; if (isset($adm->VarsPost[I21988])) {SetLocalCookie('ta_position_' .($adm->lang_data ?'langs_' :'') .$adm->Vars["id"], $adm->VarsPost[I21988], time() +3600); }if (isset($adm->VarsPost[I21989])) {SetLocalCookie('ta_highlight_layouts', $adm->VarsPost[I21989], time() +3600); }if (isset($adm->VarsPost['ta_css_highlight'])) {SetLocalCookie('ta_highlight_css_layouts', $adm->VarsPost['ta_css_highlight'], time() +3600); }if (isset($adm->VarsPost[I21990])) {SetLocalCookie('ta_highlight_glb_layouts', $adm->VarsPost[I21990], time() +3600); }if (isset($adm->VarsPost['ta_current'])) {SetLocalCookie('ta_current_' .($adm->lang_data ?'langs_' :I21991) .$adm->Vars["id"], $adm->VarsPost['ta_current'], time() +3600); }}require_once $GLOBALS['CLASSES_PATH'] .'Layouts.php'; $l1lL11l =I21992; $l1lL11L ="ami_custom.css"; $l1lL111 =&$adm->Core->GetModule("layouts"); $Layout =new Layouts($adm); $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_layouts_msgs.lng")); $adm->LayoutWords =$adm->Gui->ParseLangFile("templates/lang/layouts.lng"); $adm->Gui->addBlock(I21993, "templates/layouts_list.tpl"); $adm->Gui->addBlock("layouts_form", "templates/form.tpl"); $adm->Gui->addBlock("layouts_subform", "templates/layouts_form.tpl"); $adm->Gui->addBlock("default_layout", "templates/_default_layout.tpl"); $adm->Gui->addBlock("default_css_file", "templates/_default_css_file.tpl"); $adm->Vars[I21994] =isset($adm->Vars[I21994]) ?stripslashes($adm->Vars[I21994]) :I21991; $adm->Vars['common_css_file_body'] =isset($adm->Vars['common_css_file_body']) ?stripslashes($adm->Vars['common_css_file_body']) :I21991; $adm->Vars['custom_css_file_body'] =isset($adm->Vars['custom_css_file_body']) ?stripslashes($adm->Vars['custom_css_file_body']) :I21991; if( isset($adm->Vars["action"]) && in_array($adm->Vars["action"], array(I21981, 'export_form', I21995, 'import_form', 'import_params')) ){require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_file_system.php"); $basePath =$GLOBALS[I21996] .'/_mod_files/_upload'; $l1l1III =$adm->Gui->getAbs("layouts_subform:popup_common_js"); switch($adm->Vars["action"]) {case I21981: $params =array(); foreach($adm->Vars as $key => $val) {if(mb_strpos($key, 'export_') === 0) {$params[substr($key, mb_strlen(I21997))] =$val; }}$link =$Layout->export($params); if(!empty($link)) {$html['form'] =$adm->Gui->getAbs("layouts_subform:export_done", array('download_link' => $link, 'common_js' => $l1l1III)); }else {$html[I21998] =$adm->Gui->getAbs("layouts_subform:export_fail", array('common_js' => $l1l1III)); }break; case 'export_form': $html[I21998] =$adm->Gui->getAbs("layouts_subform:export_form", array(I21999 => $l1l1III)); break; case I21995: $params =array(); foreach($adm->Vars as $key => $val) {if(mb_strpos($key, 'import_') === 0) {$params[substr($key, mb_strlen('import_'))] =$val; }}$result =$Layout->import($params); $html[I21998] =$adm->Gui->getAbs('layouts_subform:import_' .($result ?'done' :I22000), array(I21999 => $l1l1III)); break; case 'import_params': if(empty($adm->Vars["import_design"]) || !file_exists($basePath .'/' .$adm->Vars["import_design"])) {$html[I21998] =$adm->Gui->getAbs("layouts_subform:import_params_empty"); break; }$II1l1Il =$basePath .'/tmp/tmp-' .rand(1000, 9999) .'-' .rand(1000, 9999); mkdir($II1l1Il); require_once $GLOBALS['CLASSES_PATH'] .'PHPTar.php'; $IIlILL1 =new PHPTar($basePath .I22001 .$adm->Vars["import_design"]); $IIlILL1->extract($II1l1Il); $I1llL1l =array(); if(is_dir($II1l1Il)) {$dir =opendir($II1l1Il .'/layouts'); while(($filePath =readdir($dir)) !== false) {if($filePath == '.' || $filePath == '..') {continue; }$l1l1IIl =file_get_contents($II1l1Il .I22002 .$filePath); $vars =array(); $I1lllL1 =$Layout->TIT1l1l($l1l1IIl, $vars); if($I1lllL1 >0) {trigger_error('LAYOUT PARSE ERROR ' .$I1lllL1 .' PATH: ' .$filePath); continue; }$vars['name'] =$vars['lay_main'][I22003]; $vars['path'] =$filePath; $I1llL1l[] =$vars; }closedir($dir); TT1lIll($II1l1Il); }if(count($I1llL1l) == 0) {$html[I21998] =$adm->Gui->getAbs("layouts_subform:import_params_empty", array(I21999 => $l1l1III)); break; }$l1l1IIL =I21991; $db =new DB_Si(); $rs =$db->select('select `id`, `name`, `css_file` from `cms_layouts` where `lang` = "' .$GLOBALS['lang_data'] .'" order by `id` desc'); while($record =$rs->nextRecord()) {foreach($I1llL1l as $idx => $vars) {if( $vars['name'] == $record['name'] || (!isset($l1l1II1) && is_array($vars['css_file']) && $vars['css_file'][I22004] == $record['css_file']) ){$l1l1II1 =$idx; }}$l1l1IlI =I21991; foreach($I1llL1l as $idx => $vars) {$local =array( 'selected' => ($idx === $l1l1II1 ?'selected' :I21991) );$l1l1IlI .= $adm->Gui->getAbs("layouts_subform:import_params_external_option_row", $vars +$local); }$l1l1IIL .= $adm->Gui->getAbs( "layouts_subform:import_params_external_row", array( 'id' => $record['id'], 'name' => $record['name'], I22005 => $l1l1IlI, 'allow_empty' => empty($adm->Vars["import_delete_layouts"]) ));unset($l1l1II1); }$hiddens =I21991; foreach($adm->Vars as $key => $val) {if(mb_strpos($key, 'import_') === 0) {$hiddens .= $adm->Gui->getAbs( "layouts_subform:import_params_external_hidden_row", array( I22006 => $key, 'value' => $val ));}}$html[I21998] =$adm->Gui->getAbs("layouts_subform:import_params", array('layout_rows' => $l1l1IIL, 'hiddens' => $hiddens, I21999 => $l1l1III)); break; case I22007: $I1lLIll =array(I21999 => $l1l1III); if(empty($adm->Vars['design'])) {$I1lLIll['design_rows'] =I21991; $dir =opendir($basePath); while(($filePath =readdir($dir)) !== false) {if(mb_strpos($filePath, 'tar.gz') !== false) {$l1l1Ill =$Layout->TIT11IT($basePath .I22001 .$filePath); if(!empty($l1l1Ill['CMSVer'])) {$I1lLIll[I22008] .= $adm->Gui->getAbs( "layouts_subform:import_form_design_row", array( 'version' => $l1l1Ill['CMSVer'], 'author' => $l1l1Ill[I22009], I22006 => $l1l1Ill['NAME'], 'filename' => basename($filePath), 'checked' => (mb_strlen($I1lLIll[I22008]) ?I21991 :'checked') ));}}}closedir($dir); }else {if(file_exists($GLOBALS[I21996] .'/_mod_files/_upload/' .basename($adm->Vars['design']))) {$filePath =basename($adm->Vars['design']); $meta =$Layout->TIT11IT($basePath .I22001 .$filePath); if(!empty($meta['CMSVer'])) {$I1lLIll['design'] =$filePath; $I1lLIll[I22010] =$meta['CMSVer']; $I1lLIll['design_author'] =$meta[I22009]; $I1lLIll['design_name'] =$meta['NAME']; }}}$html[I21998] =$adm->Gui->getAbs( 'layouts_subform:import_form' .(empty($I1lLIll[I22008]) && empty($I1lLIll['design']) ?'_empty' :I21991), $I1lLIll );break; }unset($adm->Filter); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; }function TlIIIIT() {if (AMI::issetOption(I22011, 'css_js_version')) {$I1LllII =AMI::getOption(I22011, 'css_js_version'); list($I1LllIl, $I1LllIL) =explode('-', $I1LllII); $I1LllIl =sprintf("%04d", (int) $I1LllIl +1); $I1LllIL =date(I22012); $I1LllII =$I1LllIl .'-' .$I1LllIL; AMI::setOption(I22011, 'css_js_version', $I1LllII); $GLOBALS['Core']->SaveOptions(I22011, false); $oFileCache =AMI::getResource('env/file_cache'); $oFileCache->reset(); return true; }return false; }if (!intval($adm->Vars[I22013]) && ($adm->Vars["action"] == "add" || $adm->Vars["action"] == "save")) {$css_file =$adm->VarsPost[I22014]; $l1l1IlL =$adm->VarsPost["css_file_create"]; $body =$adm->VarsPost["body"]; $lay_body_type =$adm->VarsPost[I21983]; $bOk =false; $l1l1Il1 =$adm->VarsPost["name"]; $tmpFileName =$_FILES['ffilename'][I22006]; $l1l1ILI =$_FILES[I22015]['tmp_name']; if (!empty($tmpFileName) && filesize($l1l1ILI)) {$l1l1ILl =false; $l1l1ILL =file_get_contents($l1l1ILI); $adm->TTITlTT($l1l1ILI); if (!empty($l1l1ILL)) {$I1llI1L =array(); $I1lllL1 =$Layout->TIT1l1l($l1l1ILL, $I1llI1L); if ($I1lllL1 >0) {$adm->AddStatusMsg("status_parse_fail", "red", I21987, I21987, array("error_code" => "$I1lllL1")); $Layout->TIT1l1T($I1lllL1); }else {$css_file =$I1llI1L[I22014][I22016]; if (file_exists($lLI1IlI .$css_file)) {$l1l1ILl =true; }else {$adm->AddStatusMsg("status_css_missing", "red", I21987, I21987, array("file" => $css_file)); }}}if ($l1l1ILl) {$fileName =mb_substr($tmpFileName, 0, mb_strrpos($tmpFileName, ".")); $name =$I1llI1L[I22017]["caption"]; if (!empty($l1l1Il1)) {$name =$l1l1Il1; }$isError =false; $sql ="SELECT count(*) AS num FROM cms_layouts WHERE lang='$lang_data'"; $db->query($sql); $db->next_record(); if ($db->Record["num"] == 0) {$is_default =1; }else {$sql ="SELECT name FROM cms_layouts WHERE name='$name' AND lang='$lang_data' limit 1"; $db->query($sql); $isError =$db->next_record(); }if (!$isError) {$asql =array( "lang" => $lang_data, "filename" => $fileName); $asql += $Layout->TIT1l11($I1llI1L, 1); if (!empty($l1l1Il1)) {$asql[I22018] =$l1l1Il1; }$sql =$db->GenInsertSQL("cms_layouts", $asql); $db->query($sql); $lid =$db->lastInsertId(); $adm->Vars[I22013] =$lid; $adm->AddStatusMsg("status_add"); }else {$adm->AddStatusMsg("status_add_fail_dup", "red", I21987, I21987, array(I22018 => $name)); $adm->AddStatusMsg(I22019, "red"); }}else {$adm->AddStatusMsg(I22019, "red"); }}else {if (!empty($l1l1Il1)) {$l1l1IlL =$adm->TTITI11(stripslashes($l1l1IlL)); if (!empty($l1l1IlL)) {if (mb_substr($l1l1IlL, mb_strlen($l1l1IlL) -4) != ".css") {$l1l1IlL =$l1l1IlL .".css"; }if (!file_exists($lLI1I1I .$l1l1IlL)) {$file_name =$l1l1IlL; $fp =@fopen($lLI1I1I .$file_name, I22020); if ($fp) {if (@fwrite($fp, unhtmlentities($adm->Vars["css_file_body"])) <0) {$adm->AddStatusMsg("status_css_write_error", "red", I21987, I21987, array("file" => $file_name)); }fclose($fp); @chmod($lLI1I1I .$file_name, 0666); $bOk =true; }else {$adm->AddStatusMsg("status_css_create_error", "red", I21987, I21987, array("file" => $file_name)); }}else {$adm->AddStatusMsg("status_css_already_exists", "red", I21987, I21987, array(I22021 => $l1l1IlL)); }}else {if (file_exists($lLI1I1I .$css_file)) {$bOk =true; $file_name =$css_file; $fp =@fopen($lLI1I1I .$file_name, I22020); if ($fp) {if (@fwrite($fp, unhtmlentities($adm->Vars["css_file_body"])) <0) {$adm->AddStatusMsg("status_css_write_error", "red", I21987, I21987, array(I22021 => $file_name)); }@fclose($fp); }else {$adm->AddStatusMsg("status_css_write_error", I22022, I21987, I21987, array(I22021 => $file_name)); }}else {$adm->AddStatusMsg("status_css_missing", I22022, I21987, I21987, array(I22021 => $css_file)); }}if ($bOk) {if (!empty($body)) {$I1lllL1 =$Layout->TIT1l1I($body); if ($I1lllL1) {$bOk =false; $Layout->TIT1l1T($I1lllL1); }}}if ($bOk) {$asql =array( I22018 => $l1l1Il1, I22014 => $file_name, "lay_main_body" => $body, I21983 => $body, "lang" => $lang_data, "filename" => isset($fileName) ?$fileName :I21991 );$isError =false; TlIIITI($asql, $isError, true); if (!$isError) {$sql =$db->GenInsertSQL(I22023, $asql); $db->query($sql); $lid =$db->lastInsertId(); $adm->Vars[I22013] =$lid; $applied_id =$adm->Vars[I22013]; $adm->AddStatusMsg("status_add"); }}$adm->Core->Cache->ClearCacheNow(); }if (!$bOk || $isError) {$adm->AddStatusMsg(I22019, I22022); }}if ($adm->Vars["action"] == "save" && $adm->Vars[I22013]) {TlIIIT1(); $adm->Vars["action"] =I22024; }else {$adm->Vars["action"] ="none"; }TlIIIIT(); }if ($adm->Vars["action"] == "copy" && $adm->Vars[I22013] >0) {require_once($GLOBALS[I22025] ."func_format.php"); $sql ="SELECT * FROM cms_layouts WHERE id='" .$adm->Vars[I22013] ."' AND lang='$lang_data'"; $db->query($sql); if ($db->next_record()) {$copy =$adm->LayoutWords["copy"]; $name =TlTl1ll($db->Record[I22018], $copy); $aNames =Array(); $db2 =new DB_si; $sql ="SELECT name FROM cms_layouts WHERE name LIKE '" .addslashes($name .I22026 .$copy .'%') ."' AND lang='$lang_data'"; $db2->query($sql); while ($db2->next_record()) {$aNames[] =$db2->Record[I22006]; }$name =TlTl1l1($aNames, $name, $copy); $asql =array( 'lang' => $lang_data, 'hidden' => addslashes($db->Record['hidden']), I22006 => addslashes($name), I22027 => '0', 'css_file' => addslashes($db->Record['css_file']), 'lay_body_type' => addslashes($db->Record[I22028]), 'lay_main_body' => addslashes($db->Record['lay_main_body']), 'lay_main_body_original' => addslashes($db->Record['lay_main_body']), I22029 => addslashes($db->Record[I22029]) );for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$asql += array( I21984 .$i .I21985 => addslashes($db->Record[I21984 .$i .I21985]), I21984 .$i .I21986 => addslashes($db->Record[I21984 .$i .I21986]), I21984 .$i ."_body_original" => addslashes($db->Record[I21984 .$i .I21986]) );}$sql =$db->GenInsertSQL(I22023, $asql); $db->query($sql); $lid =$db->lastInsertId(); $adm->Vars[I22013] =$lid; $adm->Vars["action"] =I22024; $adm->AddStatusMsg("status_copy"); }else {$adm->AddStatusMsg(I22030, I22022); }TlIIIIT(); }if ($adm->Vars[I22013] >0 && ($adm->Vars["action"] == "apply" || $adm->Vars["action"] == "save")) {$name =$adm->VarsPost[I22018]; $css_file =$adm->VarsPost[I22014]; $l1l1IlL =$adm->VarsPost[I22031]; $body =$adm->VarsPost["body"]; $is_default =intval(!empty($adm->VarsPost[I22027])); $html_head_tail =unhtmlentities($adm->VarsPost[I22029]); if($GLOBALS['AMI_ESCAPE_REQUEST']){ $html_head_tail =str_replace('\\\\', '\\', $html_head_tail); }else{ $html_head_tail =str_replace( array(I22032, "\\'", '\\"'), array('\\', "'", I22033), $html_head_tail );}$bOk =false; $tmpFileName =$_FILES[I22015][I22006]; $l1l1ILI =$_FILES[I22015]['tmp_name']; if ($adm->Vars["action"] == "save") {TlIIIT1(); }if (!empty($tmpFileName) && filesize($l1l1ILI)) {$l1l1ILl =false; $l1l1ILL =file_get_contents($l1l1ILI); $adm->TTITlTT($l1l1ILI); if (!empty($l1l1ILL)) {$I1llI1L =array(); $I1lllL1 =$Layout->TIT1l1l($l1l1ILL, $I1llI1L); if ($I1lllL1 >0) {$adm->AddStatusMsg("status_parse_fail", I22022, I21987, I21987, array(I22034 => "$I1lllL1")); $Layout->TIT1l1T($I1lllL1); }else {$css_file =$I1llI1L[I22014][I22016]; if (file_exists($lLI1IlI .$css_file)) {$l1l1ILl =true; }else {$adm->AddStatusMsg("status_css_missing", I22022, I21987, I21987, array(I22021 => $css_file)); }}}if ($l1l1ILl) {$fileName =mb_substr($tmpFileName, 0, mb_strrpos($tmpFileName, ".")); $name =$I1llI1L[I22017]["caption"]; $sql ="SELECT name FROM cms_layouts WHERE name='$name' AND lang='$lang_data' AND id<>" .$adm->Vars[I22013]; $db->query($sql); if (!$db->next_record()) {$asql =array( I22027 => $is_default, 'filename' => $fileName, I22029 => $html_head_tail );$I1ll1II =$Layout->TIT1l11($I1llI1L, 1); $asql += $I1ll1II; if (!empty($name)) {$asql[I22018] =$name; }if (!empty($css_file) && file_exists($lLI1IlI .$css_file)) {$asql[I22014] =$css_file; }$isError =false; $aTypes =Array(); TlIIITI($aTypes, $isError, false); $asql += $aTypes; $sql =$db->GenUpdateSQL(I22023, $asql, I22035 .$adm->Vars[I22013] ."'"); $db->query($sql); TlIIITl($I1ll1II); $asql =Array(); for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {if ($I1ll1II[I21984 .$i .I21985] != I21987) {$asql[I21984 .$i .I21986] =$I1ll1II[I21984 .$i .I21986]; $asql[I21984 .$i .I21986] ="=|IF( block_mask & ( 1 << (" .$i ."-1)),lay_f" .$i .I22036 .addslashes($I1ll1II[I21984 .$j .I21986]) ."')"; }else {$asql[I21984 .$i .I21986] =I21987; }}$sql =$db->GenUpdateSQL("cms_pages", $asql, "WHERE lang='$lang_data' AND lay_id='" .$adm->Vars[I22013] ."'"); $db->query($sql); if ($db->affected_rows() >0) {$adm->Core->Cache->ClearAdd("all"); }$adm->Vars[I22037] ="none"; $applied_id =$adm->Vars[I22013]; $adm->AddStatusMsg("status_apply"); }else {$adm->AddStatusMsg("status_apply_fail_dup", I22022, I21987, I21987, array(I22018 => $name)); $adm->AddStatusMsg("status_apply_fail", I22022); }}else {$adm->AddStatusMsg(I22038, I22022); }}else {$bOk =false; if (!empty($name)) {if (file_exists($lLI1I1I .$l1lL11l)) {$fp =@fopen($lLI1I1I .$l1lL11l, I22020); if ($fp) {if (@fwrite($fp, unhtmlentities($adm->Vars["common_css_file_body"])) <0) {$adm->AddStatusMsg("status_common_css_write_error", I22022, I21987, I21987, array(I22021 => $l1lL11l)); }fclose($fp); @chmod($lLI1I1I .$l1lL11l, 0666); }}if (!file_exists($lLI1I1I .$l1lL11L)) {$fp =@fopen($lLI1I1I .$l1lL11L, 'w+'); @fwrite($fp, I21991); fclose($fp); @chmod($lLI1I1I .$l1lL11L, 0666); }if (file_exists($lLI1I1I .$l1lL11L)) {$fp =@fopen($lLI1I1I .$l1lL11L, I22020); if ($fp) {if (@fwrite($fp, unhtmlentities($adm->Vars["custom_css_file_body"])) <0) {$adm->AddStatusMsg("status_common_css_write_error", I22022, I21987, I21987, array(I22021 => $l1lL11L)); }fclose($fp); @chmod($lLI1I1I .$l1lL11L, 0666); }}$l1l1IlL =$adm->TTITI11(stripslashes($l1l1IlL)); if (!empty($l1l1IlL)) {if (mb_substr($l1l1IlL, mb_strlen($l1l1IlL) -4) != ".css") {$l1l1IlL =$l1l1IlL .".css"; }if (!file_exists($lLI1I1I .$l1l1IlL)) {$file_name =$l1l1IlL; $fp =@fopen($lLI1I1I .$file_name, I22020); if ($fp) {if (@fwrite($fp, unhtmlentities($adm->Vars["css_file_body"])) <0) {$adm->AddStatusMsg("status_css_write_error", I22022, I21987, I21987, array(I22021 => $file_name)); }fclose($fp); @chmod($lLI1I1I .$file_name, 0666); $bOk =true; }else {$adm->AddStatusMsg("status_css_create_error", I22022, I21987, I21987, array(I22021 => $file_name)); }}else {$adm->AddStatusMsg("status_css_already_exists", I22022, I21987, I21987, array(I22021 => $l1l1IlL)); }}else {if (file_exists($lLI1I1I .$css_file)) {$bOk =true; $file_name =$css_file; $fp =@fopen($lLI1I1I .$file_name, I22020); if ($fp) {if (@fwrite($fp, unhtmlentities($adm->Vars["css_file_body"])) <0) {$adm->AddStatusMsg("status_css_write_error", I22022, I21987, I21987, array(I22021 => $file_name)); }@fclose($fp); }else {$adm->AddStatusMsg("status_css_write_error", I22022, I21987, I21987, array(I22021 => $file_name)); }}else {$adm->AddStatusMsg(I22039, I22022, I21987, I21987, array(I22021 => $css_file)); }}if ($bOk) {if (!empty($body)) {$I1lllL1 =$Layout->TIT1l1I($body); if ($I1lllL1) {$bOk =false; $Layout->TIT1l1T($I1lllL1); }}}$fileName =mb_substr($file_name, 0, mb_strrpos($file_name, ".")); if ($bOk) {$asql =array( I22006 => $name, 'css_file' => $file_name, 'filename' => $fileName, 'lay_main_body' => $body, I22029 => addslashes($html_head_tail) );$isError =false; TlIIITI($asql, $isError, true); if (!$isError) {if ($is_default == 1) {$l1l1IL1 =Array(I22040 => "0"); $sql =$db->GenUpdateSQL(I22023, $l1l1IL1, "WHERE lang='$lang_data'"); $db->query($sql); $asql[I22027] ="1"; }$sql =$db->GenUpdateSQL(I22023, $asql, I22035 .$adm->Vars[I22013] ."'"); $db->query($sql); if ($db->affected_rows() >0) {$adm->Core->Cache->ClearAdd("all"); }$applied_id =$adm->Vars[I22013]; $adm->AddStatusMsg(I22041); }}$adm->Core->Cache->ClearCacheNow(); }if (!$bOk || $isError) {$adm->AddStatusMsg(I22038, I22022); }}if ($adm->Vars[I22037] == "save") {$adm->Vars[I22037] =I22024; }else {$adm->Vars[I22013] =0; }TlIIIIT(); }if ($adm->Vars[I22013] >0 && $adm->Vars[I22037] == "restore") {$fields =I21987; for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$fields .= ",lay_f" .$i .I22042; }$sql ="SELECT id" .$fields ." FROM cms_layouts WHERE lang='$lang_data' AND id=" .$adm->Vars[I22013]; $db->query($sql); if ($db->next_record()) {$asql =Array(); for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$l1l1I1I[I21984 .$i .I21986] ="=|'" .addslashes($db->Record[I21984 .$i .I22042]) ."'"; }$asql =Array( I22043 => "=|lay_main_body_original"); for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$asql += array(I21984 .$i .I21986 => "=|lay_f" .$i .I22042); }$sql =$db->GenUpdateSQL(I22023, $asql, I22035 .$adm->Vars[I22013] ."'"); $db->query($sql); $sql =$db->GenUpdateSQL(I22044, $l1l1I1I, "WHERE lang='$lang_data' AND lay_id='" .$adm->Vars[I22013] ."'"); $db->query($sql); $applied_id =$adm->Vars[I22013]; $adm->AddStatusMsg("status_restore"); }else {$adm->AddStatusMsg("status_restore_fail", I22022); }TlIIIIT(); }if ($adm->Vars[I22013] >0 && $adm->Vars[I22037] == "backup") {$asql =Array( "lay_main_body_original" => "=|lay_main_body"); for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$asql += array(I21984 .$i .I22042 => "=|lay_f" .$i .I21986); }$sql =$db->GenUpdateSQL(I22023, $asql, I22035 .$adm->Vars[I22013] ."'"); $db->query($sql); $applied_id =$adm->Vars[I22013]; $adm->AddStatusMsg(I22045); }if ($adm->Vars[I22013] >0 && $adm->Vars[I22037] == "del") {$sql ="SELECT id FROM cms_pages WHERE lay_id='" .$adm->Vars[I22013] ."'"; $db->query($sql); $l1l1I1l =$db->num_rows(); if ((isset($adm->VarsGet['force_id']) && $adm->VarsGet[I22046] == $adm->Vars['id'])) {if (!$adm->Core->GetOption('demo_mode')) {$sql ="SELECT is_default FROM cms_layouts WHERE id='" .$adm->Vars[I22013] ."'"; $db->query($sql); $db->next_record(); if ($db->Record[I22040] == 0) {$l1l1I1L =true; $l1l1I11 =intval($adm->VarsGet[I22047]); if ($l1l1I1l >0) {$l1l1lII =',html_head_tail'; for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$l1l1lII .= ",lay_f" .$i .I21986; }$sql ="SELECT name $l1l1lII FROM cms_layouts WHERE id='$l1l1I11' AND lang='$lang_data'"; $db->query($sql); if ($db->next_record() && $l1l1I11 != $adm->Vars[I22013]) {$adm->AddStatusMsg("status_update_pages", I21987, I21987, I21987, array(I22006 => $db->Record[I22006])); $aSql =Array( I22048 => $l1l1I11 );for ($i =$adm->PManager->GetProperty("template_blocks_number"); $i >0; $i--) {$aSql += array(I21984 .$i .I21986 => addslashes($db->Record[I21984 .$i .I21986])); }$aSql["block_mask"] ='0'; $sql =$db->GenUpdateSQL(I22044, $aSql, "WHERE lay_id='" .$adm->Vars[I22013] .I22049); $db->query($sql); }else {$l1l1I1L =false; }}if ($l1l1I1L) {$sql ="DELETE FROM cms_layouts WHERE id='" .$adm->Vars[I22013] .I22049; $db->query($sql); $adm->AddStatusMsg("status_del"); }else {$adm->AddStatusMsg("status_del_fail", I22022); }}else {$adm->AddStatusMsg("status_del_fail", I22022); }}else {$adm->AddStatusMsg("status_del_demo_mode", I22022); }$adm->Vars[I22013] =0; TlIIIIT(); }else {AMI_Service::hideDebug(); if ($l1l1I1l == 0) {$form["text"] =$adm->Gui->getAbs("layouts_subform:del_warning_text_no_pages", I21987); }else {$l1l1lIl =Array(); $l1l1lIl['cnt'] =$l1l1I1l; $l1l1lIl['layouts'] =I21991; $sql ="SELECT id, name, is_default FROM cms_layouts " ."WHERE lang='$lang_data' AND id<>'" .$adm->Vars[I22013] ."' ORDER BY " .$adm->Pager->TI1TTlT(I22018) .", id asc "; $db->query($sql); while ($db->next_record()) {$l1l1lIL =$db->Record; $l1l1lIL['selected'] =($db->Record[I22027]) ?'selected' :I21991; $l1l1lIl[I22050] .= $adm->Gui->get("layouts_subform:layout_row", $l1l1lIL); }$form["text"] =$adm->Gui->get("layouts_subform:del_warning_text", $l1l1lIl); }$adm->Gui->addBlock("confirm", "templates/confirm.tpl"); $aWords =$adm->Gui->ParseLangFile("templates/lang/layouts.lng"); $aFormData =Array(); $html["admin_root"] =$ADMIN_PATH_WWW; $html["metas"] =$adm->Gui->getMetas(); $html["header"] =$aWords[I22051]; $form["callback"] =$adm->Gui->getAbs("layouts_subform:del_callback", I22013, $adm->Vars['id']); $html["form"] =$adm->Gui->get(I22052, $form); echo($adm->Gui->get("confirm", $html)); $conn->Out(); exit; }}if ($adm->Vars[I22013] >0 && $adm->Vars[I22037] == "default") {$sql ="UPDATE cms_layouts SET is_default='0' WHERE lang='$lang_data'"; $db->query($sql); $sql ="UPDATE cms_layouts SET is_default='1' WHERE id='" .$adm->Vars[I22013] .I22049; $db->query($sql); $applied_id =$adm->Vars[I22013]; $adm->AddStatusMsg("status_default"); $adm->Vars[I22013] =0; }$files =Array(); $d =dir($lLI1I1I); if (!is_object($d)) {trigger_error("Unable to find directory $lLI1I1I", E_USER_ERROR); }$i =0; while (false !== ($entry =$d->read())) {$files[$i] =$entry; $i++; }sort($files); $l1l1lI1 =1; $l1l1llI =I22053 .$l1l1lI1 .".css"; while (in_array($l1l1llI, $files)) {$l1l1lI1++; $l1l1llI =I22053 .$l1l1lI1 .".css"; }$form["new_css_name"] =$l1l1llI; $form[I22031] =$l1l1llI; $form["apply"] =I22054; $form[I22037] ="add"; $form[I22040] =" disabled"; $form[I22014] =$form[I22031]; $form["body_tab_disabled"] =I21987; $ILl1I1I =$adm->Gui->lang; $adm->setLang($adm->lang_data); $l1lIlLl =$adm->Gui->ParseLangFile("templates/lang/layouts.lng"); $adm->setLang($ILl1I1I); $form[I22055] =$l1lIlLl["default_lay_body_type"]; $l1l1lll =I21987; $l1l1llL =I21987; for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$l1l1ll1 =array( 'lay_f_value' => isset($l1lIlLl['default_lay_f' .$i .I22056]) ?$l1lIlLl['default_lay_f' .$i .I22056] :I21991, 'lay_f_num' => $i, 'lay_f_type_warn' => str_replace('_num_', $i, $adm->LayoutWords[I22057]) );$l1l1lll .= $adm->Gui->getAbs("layouts_subform:lay_f_type_field", $l1l1ll1 +$form); $l1l1llL .= $adm->Gui->get("layouts_subform:lay_f_type_script", $l1l1ll1); }$form["lay_f_type_items"] =$l1l1lll; $form["lay_f_type_scripts"] =$l1l1llL; $form[I22058] =$adm->Gui->getAbs("default_layout:simple_layout", I21987); $form["css_file_body"] =$adm->Gui->getAbs("default_css_file:simple_css_file", I21987); $form[I22029] =I21991; if (($adm->Vars[I22037] == I22024 || $adm->Vars[I22037] == "save") && $adm->Vars[I22013] >0) {$sql =I22059 ."FROM cms_layouts " .I22035 .$adm->Vars[I22013] ."' AND lang='$lang_data'"; $db->query($sql); if ($db->next_record()) {$form[I22031] =I21987; $form[I22013] =$db->Record[I22013]; if ($db->Record[I22040] == 1) {$form[I22040] ="checked disabled"; }$form[I22018] =$db->Record[I22018]; $form[I22014] =$db->Record[I22014]; $form[I22058] =$adm->htmlchars($db->Record[I22043]); $form["add"] =I22054; $form[I22037] ="apply"; $form[I22060] =I21987; $form["body_tab_disabled"] =I21987; for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$l1l1lLI[I21984 .$i .I21985] =$db->Record[I21984 .$i .I21985]; }$l1l1lll =I21987; $l1l1llL =I21987; for ($i =1; $i <= $adm->PManager->GetProperty("template_blocks_number"); $i++) {$l1l1ll1 =Array(); $l1l1ll1["lay_f_value"] =$db->Record[I21984 .$i .I21985]; $l1l1ll1[I22061] =$i; $l1l1ll1["lay_f_type_warn"] =str_replace("_num_", $i, $adm->LayoutWords["lay_f_type_warn"]); $l1l1lll .= $adm->Gui->getAbs("layouts_subform:lay_f_type_field", $l1l1ll1 +$form); $l1l1llL .= $adm->Gui->get("layouts_subform:lay_f_type_script", $l1l1ll1); }$form["lay_f_type_items"] =$l1l1lll; $form["lay_f_type_scripts"] =$l1l1llL; $form[I22055] =$db->Record[I21983]; $form[I22029] =$adm->htmlchars($db->Record[I22029]); if (file_exists($lLI1I1I .$form[I22014])) {$form["css_file_body"] =@file_get_contents($lLI1I1I .$form[I22014]); }$IllL111 ='ta_position_' .($adm->lang_data ?I22062 :I21991) .$adm->Vars['id']; $form[I21988] =AMI::getSingleton('env/cookie')->get($IllL111, null); $IllL111 ='ta_current_' .($adm->lang_data ?I22062 :I21991) .$adm->Vars['id']; $form[I22063] =AMI::getSingleton('env/cookie')->get($IllL111, null); }}$IllL111 ='ta_highlight_layouts'; $form[I21989] =AMI::getSingleton('env/cookie')->get($IllL111, "yes"); $IllL111 ='ta_highlight_css_layouts'; $form['ta_css_highlight'] =AMI::getSingleton('env/cookie')->get($IllL111, "no"); $IllL111 ='ta_highlight_glb_layouts'; $form[I21990] =AMI::getSingleton(I22064)->get($IllL111, "yes"); if (file_exists($lLI1I1I .$l1lL11l)) {$form["common_css_file_body"] =@file_get_contents($lLI1I1I .$l1lL11l); }$form["custom_css_file_body"] =I21991; if (file_exists($lLI1I1I .$l1lL11L)) {$form["custom_css_file_body"] =@file_get_contents($lLI1I1I .$l1lL11L); }$l1ILl1L[I22065] =I21987; $l1ILl1L[I22018] =$adm->LayoutWords["create_css"]; $l1ILl1L["selected"] ="selected"; $l1ILl1L[I22058] =jparse($form["css_file_body"]); if (!isset($form[I22066])) {$form[I22066] =I21991; }if (!isset($form['styles_body_list'])) {$form['styles_body_list'] =I21991; }$form["css_items"] .= $adm->Gui->get("layouts_subform:css_item", $l1ILl1L); $form[I22067] .= $adm->Gui->get("layouts_subform:styles_body_item", $l1ILl1L); for ($i =0; $i <sizeof($files); $i++) {if (($files[$i] != "." && $files[$i] != "..") && !is_dir($lLI1I1I .$files[$i]) && mb_substr($files[$i], -4) === '.css') {if (in_array($files[$i], $adm->Core->GetProperty(I22068))) {continue; }$l1ILl1L[I22065] =$files[$i]; if ($files[$i] == $form[I22014]) {$l1ILl1L["selected"] ="selected"; }else {$l1ILl1L["selected"] =I21987; }$l1ILl1L[I22018] =$files[$i]; $l1ILl1L[I22058] =jparse(@file_get_contents($lLI1I1I .$files[$i])); $form["css_items"] .= $adm->Gui->get("layouts_subform:css_item", $l1ILl1L); $form[I22067] .= $adm->Gui->get("layouts_subform:styles_body_item", $l1ILl1L); }}$l1l1lLl =$adm->TTITI1T(I21993); if (isset($applied_id) && $applied_id >0) {$result =DateTools::TT1lI11($udate, $adm->Vars["udatefrom"], $adm->Vars["udateto"]); if ($result !== false) {$adm->Vars["datefrom"] =date($adm->DFMT[I22069], $adm->Vars["udatefrom"]); $adm->Vars["dateto"] =date($adm->DFMT[I22069], $adm->Vars["udateto"]); $adm->Filter->UpdateField("datefrom", $adm->Vars[I22070]); $adm->Filter->UpdateField("dateto", $adm->Vars["udateto"]); }}$adm->Filter->AddField("flt_mode", "hidden", isset($adm->Vars[I22071]) ?$adm->Vars[I22071] :I21991); $adm->Filter->AddField("flt_name", "text", isset($adm->Vars["flt_name"]) ?stripslashes(unhtmlentities($adm->Vars["flt_name"])) :I21991, I21987, I22072, I22018); $adm->Filter->MoveField("flt_name", _MOVE_PREV); if ($adm->Filter->issetField('datefrom')) {$adm->Filter->TITI1l1('datefrom'); }if ($adm->Filter->issetField('dateto')) {$adm->Filter->TITI1l1(I22073); }$adm->Filter->IL11l1L =array('limit'); $filter ="WHERE 1 "; $filter .="AND lang='$lang_data' " .$adm->Filter->GetFilterSql(); $filter .= "ORDER BY " .$adm->Pager->TI1TTlT(I22018) .", id asc "; $sql ="SELECT id from cms_layouts $filter "; $db->query($sql); $adm->Pager->MaxCount =$db->num_rows(); if (isset($applied_id) && $applied_id >0) {$adm->Pager->Position =$adm->Pager->TI1TT1l($db, I22013, $applied_id); }$adm->Pager->TI1TT1I(); $adm->Filter->UpdateField(I22074, $adm->Pager->Position); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml($lll1lII, "javascript:go_page('[START]');"); if ($adm->Pager->MaxCount >0) {$sql ="SELECT id, name, is_default, css_file " ."from cms_layouts $filter " .$adm->Pager->TI1TTlI(); $db->query($sql); $i =1; require_once($GLOBALS["CLASSES_PATH"] .files_subpath ."Page.php"); $tmpPage =new Page($adm); $tmpPage->tree->UseHidden =false; $tmpPage->tree->UseLang =true; if (!isset($l1l1lLl[I22075])) {$l1l1lLl[I22075] =I21991; }while ($db->next_record()) {$lid =$db->Record[I22013]; $l1l1lLL[I22013] =$db->Record[I22013]; $l1l1lLL[I22018] =$adm->stripLine($db->Record[I22018], 80); $l1l1lLL[I22014] =$db->Record[I22014]; $links =array(); $links["del_id"] =$links["copy_id"] =$links["restore_id"] =$links["backup_id"] =$links[I22076] =$links["def_id"] =$lid; $links["page_id"] =$tmpPage->TTlllIl($lid); if ($links["page_id"]) {$links["view_link"] =$ROOT_PATH_WWW .$tmpPage->TTll1Tl($links[I22077]); $aLink =array($adm->Core->GetOption("layouts_export_flag") => "1"); TlT1IT1($links["view_link"], $aLink); }if ($db->Record[I22040] == 1) $l1l1lLL[I22040] =$adm->Gui->get("layouts_list:is_default_on", $links); else $l1l1lLL[I22040] =$adm->Gui->get("layouts_list:is_default_off", $links); $style ="row2"; if ($i %2) $style ="row1"; if ($adm->Vars[I22013] >0 && $adm->Vars[I22013] == $lid) $style ="row3"; if (isset($applied_id) && $lid == $applied_id) {$style ="row4"; }$actions =$adm->Gui->get("layouts_list:icons_layouts", $links); if ($db->Record[I22040] == 1) $actions .= $adm->Gui->get("layouts_list:icon_layout_del_default", $links); else $actions .= $adm->Gui->get("layouts_list:icon_layout_del", $links); $l1l1lLL["actions"] =$actions; $l1l1lLL["style"] =$style; $l1l1lLl[I21993] .= $adm->Gui->get(I22078, $l1l1lLL); $i++; }if (!isset($l1l1lLl['legend'])) {$l1l1lLl['legend'] =I21991; }$l1l1lLl["legend"] .= $adm->Gui->getAbs("layouts_list:leg_yellow", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_blue", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_is_default_on", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_edit", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_view", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_copy", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_restore", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_backup", I21987); $l1l1lLl[I22079] .= $adm->Gui->getAbs("layouts_list:leg_del", I21987); $l1l1lLl["pager"] =$pager; $html[I22080] =$adm->Gui->get(I21993, $l1l1lLl); }else {$html[I22080] =$adm->Gui->getAbs("layouts_list:empty", I21987); $html[I22080] .= $adm->Gui->getAbs("spacer", I21987); }$html[I22080] .=$adm->Gui->getAbs("spacer", I21987); $form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); $form["template_blocks_number"] =$adm->PManager->GetProperty("template_blocks_number"); if (empty($form['add']) || $form['add'] != 'disabled') {$l1l1lLl =$adm->Gui->get(I22081, $form); $html["form"] =$adm->Gui->getAbs("layouts_form", Array("header" => $adm->Words["layouts_add"], I22016 => $l1l1lLl, I22082 => "align=center", 'width' => '100%')); }else {if ($form[I22037] == I22060) {$form["cancel"] =$adm->Gui->getAbs("layouts_subform:cancel", I21987); }$l1l1lLl =$adm->Gui->get(I22081, $form); $html["form"] =$adm->Gui->getAbs("layouts_form", Array("header" => $adm->Words["layouts_apply"], I22016 => $l1l1lLl, I22082 => I22083)); }$l1l1lL1 =$adm->Core->GetModule('ami_market'); if(is_object($l1l1lL1) && $l1l1lL1->IsInstalled() && $l1l1lL1->IsAdminAllowed()) {$form['market_link'] =$l1l1lL1->getAdminLink() .'&link=' .$adm->Core->GetModOption(I22050, 'market_root_cat'); }$html[I22084] =$adm->Gui->get("layouts_subform:lay_migration_buttons", $form) .$html[I22084]; unset($adm->Filter); AMI::getSingleton('env/async50')->finalize($adm, $l1lL111, $html); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; 