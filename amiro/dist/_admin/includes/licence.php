<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       10058 xkqwxstpmuwmppppqusukmwxknwxgzpgttygxqsgqkmqupygzgtptzgisrsuwtulglitpnir
 */ ?><?php foreach(array(22085=>"ZSI|GrQf",22086=>"ZSI|WHGB|GrQf",22087=>"ZSI|WHGB|urJ",22088=>'wURRqNT|dkmN|gzTo',22089=>"uDQr|JZnP",22090=>"zsi|whgb|Nziq",22091=>"tQIGJZtQD~JZnP~JMWQnWQ`JnP",22092=>"++++%%?yqpmN?hF?jmwqNdq?kqb?%%++++\r\n",22093=>"++++%%?qNs?hF?jmwqNdq?kqb?%%++++",22094=>"JMWQnWQ`GOG",22095=>"++++%%?yqpmN?hF?jmwqNdq?kqb?%%++++\\r\\n",22096=>"JMWQnWQ",22097=>"JMW|GCS",22098=>"Qrr",22099=>"yUmjsqR|VqRdmhN",22100=>"DBD|uDQr",22101=>"DtZtuD",22102=>"ZWtMHn",22103=>"",22104=>'DBD|uDQr',22105=>"uGSZtQ?WID|OHDt|uDQrD?DQt?JMWQnWQ='",22106=>"MS",22107=>'DEJ|DZfQtB|WOQWK',22108=>"UGSZtQ?JMWQnWQ?fZMJ```",22109=>"rQEurQ|rQYuMJS|IHSuJQD",22110=>"dqRR",22111=>"oTTg|ohdT",22112=>"GZtO",22113=>"jMWQnDQ?MD?nHt?vZJMS,?#Yr@\n",22114=>"jMWQnDQ?HCnQr%?",22115=>"jMWQnDQ?DtZtuD%?",22116=>"?#Yr@\n",22117=>"jMWQnDQ?KQB?uGSZtQS,\n\n?oHDt%?",22118=>"?\n?wnf?oHDt%?",22119=>"\n?NQC?JMWQnDQ?KQB%\n",22120=>"RqihTq|zssR",22121=>"\n?HCnQr?=?",22122=>"jMWQnDQ?KQB?uGSZtQS?fHr?",22123=>"wRw?Hf?JMWQnWQ?fZMJ```",22124=>"Qrr|4",22125=>'DQJQWt?JMWQnWQ?frHI?WID|OHDt|uDQrD?COQrQ?MS|IQIYQr=',22126=>'DQJQWt?JMW|KQB?ZD?JMWQnWQ?frHI?WID|ODt|rQD|WID|MnDt?COQrQ?MS|ZSIMn=',22127=>"tQIGJZtQD~JMWQnWQ`tGJ",22128=>"uDQr|SHIZMn",22129=>"uGPrZSQ|IQDDZPQ|trMZJ",22130=>"fHrI%DQrvQr|nZIQ",22131=>"WID|vQrDMHn",22132=>"DuGGHrt|IDP",22133=>'QSMtMHn') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $adm_pref ="wm"; if(!empty($_h["adm_pref"])){ $adm_pref =$_h[I22085]; }$ADM_COPY_PREF =""; $ADM_COPY_MAIL =""; $ADM_COPY_NAME =""; $ADM_COPY_URL =""; if(!empty($l1IIll1[$adm_pref][I22086])){ $ADM_COPY_PREF =$l1IIll1[$adm_pref][I22086]; }if(!empty($l1IIll1[$adm_pref]["adm_copy_mail"])){ $ADM_COPY_MAIL =$l1IIll1[$adm_pref]["adm_copy_mail"]; }if(!empty($l1IIll1[$adm_pref]["adm_copy_name"])){ $ADM_COPY_NAME =$l1IIll1[$adm_pref]["adm_copy_name"]; }if(!empty($l1IIll1[$adm_pref][I22087])){ $ADM_COPY_URL =$l1IIll1[$adm_pref][I22087]; }require_once $FUNC_INCLUDES_PATH .'function.php'; require_once $CLASSES_PATH .'template.php'; require_once $CLASSES_PATH .'guiAdmin.php'; if(isset($GLOBALS['CURRENT_SKIN'])) {$GLOBALS[I22088] ='skins/' .$GLOBALS['CURRENT_SKIN'] .'/'; }else {$GLOBALS[I22088] ='skins/vanilla/'; }$Gui =new gui(); $Gui->_setLang(isset($_COOKIE[I22089])? $_COOKIE[I22089]: $Core->GetOption("default_gui_lang")); $Gui->setSkinPath($GLOBALS[I22088]); $Gui->addStyle($GLOBALS[I22088]."_css/style.css"); $Il11lIL =array(); $Il11lIL["ADM_COPY_PREF"] =$ADM_COPY_PREF; $Il11lIL["ADM_COPY_MAIL"] =$ADM_COPY_MAIL; $Il11lIL[I22090] =$ADM_COPY_NAME; $Gui->addGlobalVars($Il11lIL); $mess =$Gui->parseLangFile(I22091); $lLLL1Ll =I22092; $sEnd =I22093; $aData =$_POST; $l1llLIl =array("script_link" =>I22094); $l1llLIl["start_string"] =I22095; $l1llLIl["end_string"] =I22093; $l1llLIl[I22096] =stripslashes($aData[I22096]); $l1llLIl["lic_pwd"] =stripslashes($aData[I22097]); $l1llLIl["welcome"] =$mess["welcome"]; $l1llLIl["status"] =""; if(isset($_GET[I22098])){ $l1llLIl["status"] .= $mess["err_".$_GET[I22098]]."<br>\n"; }$bodyType ="input_form"; if($GLOBALS[I22099] <2){ $sql ='select id, sys_user from cms_host_users where id_member=' .$_h['sys_user']; }else{ $sql ='select is_sys as sys_user from cms_hst_res_cms_inst where id_admin=' .$_h['sys_user']; }$db->query($sql,DBC_SYS_QUERY); if(!$db->next_record() || $db->Record[I22100]!="1"){ trigger_error("No access rights to update key for user [".$_h["user_name"]."]...", E_USER_WARNING); $l1llLIl[I22101] .= $mess["err_5"]."<br>\n"; $bodyType ="denied"; }if($bodyType!="denied"){ if(isset($aData[I22102]) && $aData[I22102]==I22096){ $lllllll =$aData[I22096]; $l1l1l1I =ltrim($lllllll, " \r\n"); if(mb_substr($l1l1l1I, 0, 4) == "FREE") {$aData[I22096] =$l1l1l1I; $l1l1l1l =(mb_substr($l1l1l1I, -2) == "-="); }else {$l1l1l1L =true; if(defined("files_subpath") && files_subpath != I22103) {$l1l1l1L =false; $l1lLIL1 ="a".date("Y-m-d"); if(file_exists($GLOBALS['DEFAULT_INCLUDES_PATH']. 'init.php')) {require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .'init.php'; if($l1lLIL1 == "b".date("d-m-Y")) {$l1l1l1L =true; }}}$l1l1l1l =false; if($l1l1l1L) {$lLlI11I =mb_strpos($lllllll, $lLLL1Ll)+mb_strlen($lLLL1Ll)+3; $ePos =mb_strpos($lllllll, $sEnd); $l1l1l11 =chr(mb_substr($lllllll, $lLlI11I-3, 3)); $lllllll =mb_substr($lllllll, $lLlI11I, $ePos-$lLlI11I); $l1l1LII =0; for($i=0;$i<mb_strlen($lllllll);$i++){ $l1l1LII ^= ord($lllllll[$i]); }$l1l1LII =chr($l1l1LII); $l1l1l1l =($l1l1LII == $l1l1l11); }}if($l1l1l1l){ if($GLOBALS[I22099] <2){ $sql ='select id from cms_host_users where id_member=' .$_h[I22104] ." and sys_user='1'"; }else{ $sql ='select id from cms_hst_res_cms_inst where id_admin=' .$_h[I22104] ." and is_sys='1'"; }$db->query($sql,DBC_SYS_QUERY); if($db->next_record()){ if($GLOBALS[I22099] <2){ $sql =I22105.$aData[I22096]."' where id='".$db->Record[I22106]."'"; }else{ $sql ="update cms_hst_res_cms_inst set lic_key='".$aData[I22096]."' where id='".$db->Record[I22106]."'"; }$db->setAttr(I22107,false); if(!$db->query($sql,DBC_SYS_QUERY)){ trigger_error(I22108, E_USER_WARNING); $l1llLIl[I22101] .= $mess["update_fail"]; }else{ $Core->WriteOption("core", I22109, 1); $Core->WriteOption("core", strrev("ecnatsni"), 2 -intval((mb_substr($l1l1l1I, 0, 4) == str_rot13(I22110)))); $Core->Cache->ClearAdd("all"); $Core->Cache->ClearCacheNow(); $bodyType ="refresh"; $l1llLIl["welcome"] =$mess["welcome_ready"]; $l1l1LIl =parse_url(mb_strtolower(trim(getenv(I22111)))); $lLlIL11=$l1l1LIl["host"]; $l1l1LIL =parse_url($ROOT_PATH_WWW); $lLlI1II =$l1l1LIL["host"]; $l1l1LI1=parse_url($_SERVER[I22111]); $lLlI1Il =$l1l1LI1["host"]; if(empty($lLlIL11)) $lLlIL11 =$l1l1LIl["path"]; if(empty($lLlI1II)) $lLlI1II =$l1l1LIL[I22112]; if(empty($lLlI1Il)) $lLlI1Il =$l1l1LI1[I22112]; $lLllL1I =I22113.I22114 .$ILlLLlL ." <br>\n".I22115.$lLlI1IL[I22101]." <br>\n"."Host: ".$lLlI1IL["host"]. I22116."Expire date: ".$lLlI1IL["expired"]." <br><br>\n". " (c) Protected <br>\n"; $msg =I22117.$lLlI1Il.I22118.$lLlI1II. "\n Login user: ".$_h["user_name"]."\n Login domain: ".$_h["user_domain"]."\n System user ID: ".$_h[I22100]. "\n Customer Key: ".$IIlILlI."\n". I22119.$aData[I22096]." \n"; $msg =$msg."\n client_ip = ".getenv(I22120)."\n host_ip = ".$_SERVER["SERVER_ADDR"].",".@getenv("LOCAL_ADDR").I22121 .$ILlLLlL ." \n conf = $ROOT_PATH_WWW "."\n companyname = $COMPANY_NAME "."\n companyurl = $COMPANY_URL"."\n companyemail = $COMPANY_EMAIL"; @mail("reports.dev@locmail.amiro.ru", I22122.$lLlIL11." :: Cnf Host: ".$lLlI1II, $msg); $Core->UpdateRightsVersion(); $c =NULL; doRedirect($Gui, 'start.php?action=refresh&step=1&key='.mt_rand(0,100000), $c); }}else{ $l1llLIl[I22101] .= $mess["sys_user_fail"]; }}else {trigger_error(I22123, E_USER_WARNING); $l1llLIl[I22101] .= $mess[I22124]."<br>\n"; }}else{ if($GLOBALS[I22099] <2){ $sql =I22125 .$_h[I22104] ." and sys_user='1'"; }else{ $sql =I22126 .$_h[I22104] ." and is_sys='1'"; }$db->query($sql,DBC_SYS_QUERY); if($db->next_record()){ $l1llLIl[I22096] =$db->Record[I22096]; }}}$Gui->addBlock("form", I22127); $l1lLLIl =$_h[I22128]; if($l1lLLIl == "default"){ $l1lLlLl =@parse_url($ROOT_PATH_WWW); $l1lLLIl =$l1lLlLl["host"]; }if(defined("files_subpath") && files_subpath != I22103) {if(mb_substr($l1llLIl[I22096], 0, 4) == "FREE") {$l1l1LlI =$mess["upgrade_message_free"]; }else {$l1l1LlI =$mess[I22129]; }$l1llLIl["upgrade_message"] =$Gui->getAbs("form:upgrade_message", Array("upgrade_message" => $l1l1LlI)); }$l1llLIl["server_name"] =$Gui->getAbs(I22130, array("server"=>$l1lLLIl, "username"=>$_h["user_name"], "front_link"=>$ROOT_PATH_WWW)); $l1llLIl[I22131] =$CMS_VERSION; $l1llLIl["cms_major_version"] =$lLI1Ll1; if($ADM_COPY_URL != I22103) {$l1llLIl["support_msg"] =str_replace("_support_url_", $ADM_COPY_URL, $mess["support_msg_url"]); }else {$l1llLIl[I22132] =$mess[I22132]; }$l1llLIl["form"] =$Gui->get("form:".$bodyType, $l1llLIl); $l1llLIl['meta'] =$Gui->getMeta('content-type'); $l1llLIl[I22133] =AMI::getEdition(); $HtmlBody =$Gui->get("form", $l1llLIl); echo $HtmlBody; exit; 