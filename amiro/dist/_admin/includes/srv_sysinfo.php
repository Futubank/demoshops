<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       16714 xkqwmnnppnlkwrnpgwyirrimzlrslunprrkwxrznytnplxrtqnitwrtqugugspzktrxypnir
 */ ?><?php foreach(array(22522=>'MnMt`GOG',22523=>"wjzddqd|gzTo",22524=>"Drv|DBDMnfH|fHrI",22525=>'SY',22526=>"JHPMnD|DuWWQDD",22527=>'DtZtuD',22528=>'ms%',22529=>'RhhT|gzTo',22530=>'tx`JHP',22531=>'#~YHSB@#~OtIJ@',22532=>'MDqrrHr',22533=>'IDP',22534=>'WHnn',22535=>'rQS',22536=>'DEJ',22537=>'#tZYJQ?YHrSQr=1@',22538=>'#tS?vZJMPn=tHG@',22539=>'#~tZYJQ@',22540=>'',22541=>'dBDtQI?iQnu',22542=>"630Gx",22543=>"OQZSQr",22544=>"CMStO",22545=>"SHIZMn",22546=>"SY",22547=>"?SY|DMAQ!?ftG|DtZtuD!?JMWQnWQ|tBGQ!?",22548=>"?szTq|FhRizT}JMWQnWQ|QxG|SZtQ!'",22549=>"'{?zd?JMWQnWQ|QxG|SZtQ?",22550=>"SMDK|EuHtZ",22551=>'ftG|DtZtuD',22552=>'JMWQnWQ|QxGMrQD',22553=>'JMWQnWQ|tBGQ',22554=>'trMZJ',22555=>"JMWQnWQ|QxGMrQ|SZtQ",22556=>'JMWQnWQ|QxG|SZtQ',22557=>'zsimN|ihsq',22558=>'SZBD',22559=>'MnSQx|SZtQ',22560=>"QIZMJ|EuHtZ",22561=>"nuI|ftGuDQrD",22562=>"SMDK|DGZWQ",22563=>"SMDK|frQQ|DGZWQ",22564=>"ZSIMn|DuIIZrB",22565=>"DGZWQr",22566=>"fHrI|ZJMPn") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl ="services"; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. I22522; require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_gui.php"); require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_components.php"); require_once($GLOBALS[I22523]."MboxClient.php"); $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/srv_sysinfo.lng")); $adm->Gui->addBlock("srv_sysinfo_subform","templates/srv_sysinfo_form.tpl"); $adm->Gui->addBlock(I22524,"templates/form.tpl"); $adm->Words += $adm->Gui->ParseLangFile("templates/lang/srv_sysinfo.lng"); $l1LIL11 =&$adm->Core->GetModule("srv_sysinfo"); function TlIIIlT(&$db,$domain=false) {$adm =&$GLOBALS['adm']; $db =&$GLOBALS[I22525]; if(!$adm->Core->IsInstalled("srv_login_history")) return ''; $l1LIILI =&$adm->Core->GetModule("srv_login_history"); $form =array(); $form["login_link"] =$l1LIILI->GetAdminLink(); $form[I22526] =0; $form["logins_fail"] =0; $where =$domain===false ?'' :"WHERE domain='$domain'"; $sql ="SELECT status, count(id) as stat_cnt FROM cms_host_login_history $where ". "GROUP BY status"; $db->query($sql); while($db->next_record()) {$form["logins_".$db->Record[I22527]] =$db->Record['stat_cnt']; }return $adm->Gui->get("srv_sysinfo_subform:login_info", $form); }function TlIIIlI(){ global $adm; if(!$adm->Core->issysuser())return false; $text =false; if(!empty($adm->Vars['sys_menu'])){ if(!empty($adm->Vars['exec'])){ echo I22528.exec('ls').'<br>'.'ls -la DOCROOT:'.nl2br(exec('ls -lah '.$GLOBALS[I22529])); die; }elseif(!empty($adm->Vars['phpinfo'])){ phpinfo(); die; }elseif(!empty($adm->Vars['errlog']) || !empty($adm->Vars['txlog'])){ $logFile =empty($adm->Vars['errlog']) ?I22530 :'err.log'; if(!empty($adm->Vars['noreverse'])){ $str =nl2br(htmlentities(file_get_contents($GLOBALS[I22529] .'_admin/_logs/'. $logFile))); echo '<html><body><font size="-1" face="Courier New">'. preg_replace('/\[[\s\-\:\d\.]+\]/',"<br><span style='color:blue;font-weight:bold;'>$0</span>",$str); die; }$l1LI1II =htmlentities(file_get_contents($GLOBALS[I22529] .'_admin/_logs/'. $logFile)); $l1LI1Il =preg_split('/(\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\])/i', $l1LI1II, -1, PREG_SPLIT_DELIM_CAPTURE); echo '<html><body><font size="-1" face="Courier New">'; for($l1LI1IL =sizeof($l1LI1Il) -1; $l1LI1IL >0;){ echo "<br><span style='color:blue;font-weight:bold;'>" .$l1LI1Il[$l1LI1IL -1] ."</span>"; if(substr_count($l1LI1Il[$l1LI1IL], "['USER: ERROR']") >0){ $l1LI1Il[$l1LI1IL] ="<span style='color:red;font-weight:bold;'>" .$l1LI1Il[$l1LI1IL] ."</span>"; }echo $l1LI1Il[$l1LI1IL]; $l1LI1IL -= 2; }echo I22531; die; }elseif(!empty($adm->Vars['errlog']) || !empty($adm->Vars['verify'])){ $GLOBALS['conn']->TT1I1lT(); AMI_Service::addAutoloadPath(AMI_Registry::get('path/root') .'_shared/code/lib/crypt/'); $AMI_Crypt =new AMI_Crypt(); $aFiles =$AMI_Crypt->getFiles(AMI_Registry::get('path/root')); $count =(int)$adm->Vars['count']; $offset =(int)$adm->Vars['offset']; $aFiles =array_slice($aFiles, $offset, ($count ?$count :null)); $l1LI1I1 =$AMI_Crypt->verifyFiles($aFiles, true); $errorsCount =0; $filesCount =count($aFiles); foreach($l1LI1I1 as $fileName => $res){ @set_time_limit(29); echo "<br><span style='color:" .($res[I22532] ?'red' :'green') ."'>" .$fileName ."--" .$res[I22533] ."</span>"; for($i =0; $i <1024; $i++) echo " "; if($res[I22532]) $errorsCount++; }if(!$l1LI1I1) echo "All files are verified"; echo "<br>----<br>"; echo "Resume: checked files count $filesCount . Unverified files $errorsCount"; die(); $GLOBALS[I22534]->TT1I1lT(); AMI_Service::addAutoloadPath(AMI_Registry::get('path/root') .'_shared/code/lib/crypt/'); $AMI_Crypt =new AMI_Crypt(); $aFiles =$AMI_Crypt->getFiles(AMI_Registry::get('path/root')); $l1LI1I1 =$AMI_Crypt->verifyFiles($aFiles, true); foreach($l1LI1I1 as $fileName => $res){ echo "<br><span style='color:" .($res[I22532] ?I22535 :'green') ."'>" .$fileName ."--" .$res[I22533]; }if(!$l1LI1I1) echo "All files are verified"; die(); }elseif(isset($adm->Vars[I22536])){ global $db; $sql =rtrim(stripslashes(html_entity_decode($adm->Vars[I22536],ENT_QUOTES)),'; '); trigger_error('Sys Menu SQL: ' .$sql, E_USER_NOTICE); $res =$db->query($sql, DBC_RAW_QUERY); if(is_resource($res)){ $content =$db->numRows() ." row(s), " .$db->TT1lTlT() ."s<br />\n" .I22537; $l1LI1lI =true; while($record =$db->nextRecord()){ $content .= '<tr>'; if($l1LI1lI){ foreach($record as $name => $value){ $content .= '<td bgcolor=#eeeeeee>'.$name.'</td>'; }$content .= '</tr><tr>'; $l1LI1lI =false; }foreach($record as $name => $value){ $content .= I22538.($value?nl2br(htmlentities($value,ENT_COMPAT,'UTF-8')):'&nbsp;').'</td>';} $content .= '</tr>'; }$content .= I22539; }elseif($res){ $content .= "Affected rows: " .$db->affectedRows(); }else{ $db->TT1lTT1(); $db->TT1lTIT(); $content ='[ ' .$db->ILlI1Ll .'] ' .$db->ILlI1LL; }echo $content; die; }else{ $text ='';$content =I22540; $text .= $adm->Gui->getAbs("spacer",""); $content ='
            <div style="width:160px;float:left;border:1px #FFFFFF solid;cursor:pointer;padding:2px;font-family:Tahoma;"
            onclick="window.open(\'?sys_menu=1&phpinfo=1\',\'gmp\',\'width=800,height=700,scrollbars\');" onmouseover="this.style.border=\'1px #c0c0c0 solid\';" onmouseout="this.style.border=\'1px #FFFFFF solid\';">
            <nobr><img src="images/faq_icon.gif" border=0 width=34 height=34 align=absmiddle>phpinfo()</nobr></div>

            <div style="width:160px;float:left;border:1px #FFFFFF solid;cursor:pointer;padding:2px;font-family:Tahoma;"
            onclick="window.open(\'?sys_menu=1&errlog=1\',\'gme\',\'width=800,height=700,scrollbars\');" onmouseover="this.style.border=\'1px #c0c0c0 solid\';" onmouseout="this.style.border=\'1px #FFFFFF solid\';">
            <nobr><img src="images/srv_sysinfo_icon.gif" border=0 width=34 height=34 align=absmiddle>err.log</nobr></div>

            <div style="width:160px;float:left;border:1px #FFFFFF solid;cursor:pointer;padding:2px;font-family:Tahoma;"
            onclick="window.open(\'?sys_menu=1&txlog=1\',\'gme\',\'width=800,height=700,scrollbars\');" onmouseover="this.style.border=\'1px #c0c0c0 solid\';" onmouseout="this.style.border=\'1px #FFFFFF solid\';">
            <nobr><img src="images/srv_sysinfo_icon.gif" border=0 width=34 height=34 align=absmiddle>tx.log</nobr></div>

            <div style="width:160px;float:left;border:1px #FFFFFF solid;cursor:pointer;padding:2px;font-family:Tahoma;"
            onclick="window.open(\'?sys_menu=1&verify=1&count=200&offset=0\');" onmouseover="this.style.border=\'1px #c0c0c0 solid\';" onmouseout="this.style.border=\'1px #FFFFFF solid\';">
            <nobr><img src="images/srv_sysinfo_icon.gif" border=0 width=34 height=34 align=absmiddle>Verify sources<br />(use params count and offset)</nobr></div>

            <div style="width:160px;float:left;border:1px #FFFFFF solid;cursor:pointer;padding:2px;font-family:Tahoma;"
            onclick="window.open(\'engine.php?mod_id=options_data\');" onmouseover="this.style.border=\'1px #c0c0c0 solid\';" onmouseout="this.style.border=\'1px #FFFFFF solid\';">
            <nobr><img src="images/eshop_price_list_icon.gif" border=0 width=34 height=34 align=absmiddle>Options History</nobr></div>
            '; $text .= $adm->Gui->getAbs(I22524,Array( "header"=>I22541, "content"=>$content, "form_align"=>"align=center", "width" => I22542, )).$adm->Gui->getAbs("spacer",""); $content ='
            <form method=POST action="?sys_menu=1" onsubmit="window.open(\'?sys_menu=1\',\'sql_result\',\'width=800,height=700,scrollbars\')" target="sql_result">
                <textarea name="sql" rows=10 style="width:600px;">' .(isset($adm->Vars[I22536]) ?$adm->Vars[I22536] :I22540) .'</textarea><br>
                <table width=100%><tr><td align=right>
                    <input type="submit" name="apply" value="OK" class="but" style="width:100px">
                </td></tr></table>
            </form>'; $text .= $adm->Gui->getAbs(I22524,Array( I22543=>'SQL Query', "content"=>$content, "form_align"=>"align=center", I22544 => I22542, ));}}return $text; }$l1LI1ll =TlIIIlI(); $sql ="SELECT m.id id_sys_user, m.username, m.firstname, m.lastname, m.email " ."FROM `cms_host_users` hu " ."LEFT JOIN `cms_members` m ON m.id = hu.id_member " ."WHERE hu.sys_user = 1"; $form =$db->getRecord($sql); list($domain,$I1LLILl,$lL1lI1L) =TlTllTl(); $form[I22545] =$domain; $form["alias_domain"] =$I1LLILl; $form['add_alias_href'] =$lL1lI1L; $l1LI1lL =getBytesAsText(disk_free_space($ROOT_PATH), $adm->Words, 2, 3); if($adm->Core->HostMode() &HOSTMODE_SHARED) {$adb =&DB_si::admInstance(); if (!defined('INDEX_DISALLOW_DAYS')) {$days =0; }else {$days =INDEX_DISALLOW_DAYS; }$sql ="SELECT disk_space,disk_quota, DATE_FORMAT(date_registered,'".$adm->DFMT[I22546]."') AS rdate,". " DATE_FORMAT(DATE_ADD(date_registered, INTERVAL ".$days." DAY),'".$adm->DFMT[I22546]."') AS index_date,". " IF(NOW() > DATE_ADD(date_registered, INTERVAL ".$days." DAY), 1, 0) AS index_can_be_enabled,". I22547. I22548.$adm->DFMT[I22546].I22549. "FROM cms_host_users WHERE domain_orig='$domain'"; $adb->query($sql); $adb->next_record(); $form["SHARED_MODE"] =1; $form["disk_space"] =getBytesAsText($adb->Record['disk_space'], $adm->Words, 2, 2); $form[I22550] =$adb->Record['disk_quota']; $form["db_size"] =getBytesAsText($adb->Record['db_size'], $adm->Words, 2, 2); $form['ftp_enabled'] =$adb->Record[I22551] ?$adm->Words['yes'] :$adm->Words['no']; $form["date_registered"] =$adb->Record['rdate']; $form[I22552] =$adb->Record[I22553]==I22554 ?1 :0; $form[I22555] =$adb->Record[I22556]; $form[I22557] =0; if(isset($adm->Vars['enable_index']) and $adm->Vars['enable_index'] and $adb->Record['index_can_be_enabled']) {unlink($ROOT_PATH.'/_admin/_logs/forbidden_robots.txt'); }$form[I22558] =$days; $l1LI1l1 =!file_exists($ROOT_PATH.'/_admin/_logs/forbidden_robots.txt'); $form['index_enabled'] =$l1LI1l1 ?$adm->Words['yes'] :$adm->Words['no']; if (!$l1LI1l1) {$form['index_can_be_enabled'] =$adb->Record['index_can_be_enabled']; $form['index_can_not_be_enabled'] =!$form['index_can_be_enabled']; $form['index_enable_date'] =$adb->Record[I22559]; }$lILL11l =&MboxClient::TT1I1Il($domain); $form["email_quota"] ="N/A"; $form["email_space_used"] ="N/A"; if(is_object($lILL11l)) {$lILL11l->useDomain($domain); $info =$lILL11l->domainInfo(); if(($info)!==false) {$form[I22560] =getBytesAsText(intval($info[I22550])*1024, $adm->Words, 2, 2); }$l1LIlL1 =$lILL11l->listMailboxes(true); $lILL11l->TI1Tlll(); if(is_array($l1LIlL1)) {$size =0; foreach($l1LIlL1 as $i => $info) $size += $info['size']; $form["email_space_used"] =getBytesAsText($size*1024, $adm->Words, 2, 2); }}$form['login_info'] =TlIIIlT($adb,$domain); if($adm->Core->HostMode() &HOSTMODE_ADMIN) {$sql ="SELECT COUNT(id) as num_ftpusers FROM cms_host_users WHERE ftp_status!=0"; $l1LI1LI[I22561] =$db->getValue($sql); $sql ="SELECT status,count(id) as num_domain FROM cms_host_users ". "WHERE (status='active' OR status='suspend') GROUP BY status"; $db->query($sql); while($db->next_record()) {$l1LI1LI["num_domain_".$db->Record[I22527]] =$db->Record['num_domain']; }$sql ="SELECT DATE_FORMAT(MAX(date_registered),'".$adm->DFMT[I22546]."') AS max_date, ". "DATE_FORMAT(MIN(date_registered),'".$adm->DFMT[I22546]."') AS min_date, ". "SUM(disk_space) AS disk_space, SUM(db_size) AS db_size ". "FROM cms_host_users"; $db->query($sql); if($db->next_record()) {$l1LI1LI["max_reg_date"] =$db->Record['max_date']; $l1LI1LI["min_reg_date"] =$db->Record['min_date']; $l1LI1LI[I22562] =getBytesAsText($db->Record['disk_space'], $adm->Words, 2, 3); $l1LI1LI["db_size"] =getBytesAsText($db->Record['db_size'], $adm->Words, 2, 3); }$l1LI1LI['login_summary'] =TlIIIlT($db); $l1LI1LI[I22563] =$l1LI1lL; $form[I22557] =1; $form["admin_summary"] =$adm->Gui->get("srv_sysinfo_subform:admin_summary", $l1LI1LI); }else {$form["admin_summary"] =I22540; }$form["domain_info"] =$adm->Gui->get("srv_sysinfo_subform:domain_info", $form); }else {$form['login_info'] =TlIIIlT($db); $form[I22563] =$l1LI1lL; $form["domain_info"] =$adm->Gui->get("srv_sysinfo_subform:domain_info", $form); $form['SINGLE_MODE'] =1; $form[I22564] =I22540; }unset($adb); $form["form_items"] =$adm->Gui->get("srv_sysinfo_subform:form_items", $form); $lIl1I11 =$adm->Gui->get("srv_sysinfo_subform", $form); $html["form"] =$adm->Gui->getAbs(I22565,""); $html["form"] .= $adm->Gui->getAbs(I22524,Array(I22543=>$adm->Words["form_header"],"content"=>$lIl1I11,I22566=>"align=center")); if($l1LI1ll){ $html["form"] .= $l1LI1ll; }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; 