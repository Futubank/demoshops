<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       32746 xkqwuwsytkxqnrrgpttlnxgspxkwtgrsrzgtpxxpqwnupmmupknitxnmqgxpmgkuykuppnir
 */ ?><?php foreach(array(22359=>'MnMt`GOG',22360=>"DtQG",22361=>"3",22362=>"tQIGJZtQD~JMWQnWQ`tGJ",22363=>"fHrI%uGSZtQS",22364=>"WHntQnt",22365=>"",22366=>'ZWtMvQ',22367=>"OHDt|SZtZ",22368=>"DtZtuD|SZtQ",22369=>"ZWtMvQ",22370=>"IDP",22371=>"ZSIMn|DtZtuD",22372=>"SZtQ",22373=>'IHSuJQ|JMnK',22374=>'GJuPMn|MS',22375=>'~',22376=>'GZrQnt',22377=>"Drv|uGSZtQD",22378=>'SZtQ|IHSMfMQS',22379=>'qRRhR',22380=>'100',22381=>'b+I+S?o%M%D',22382=>'vZJuQ',22383=>"S",22384=>'ZIMUGSZtQD',22385=>"SQDWrMGtMHn",22386=>'ZSIMn|JMnK',22387=>"WZGtMHn",22388=>"IHSuJQD",22389=>'JMnK',22390=>'IHSuJQ|MWHn',22391=>'IHSmS',22392=>'frQQ',22393=>'IHSuJQD|SZtZDQtD',22394=>'IHSuJQD|WuDtHI|fMQJSD',22395=>'tMtJQ|SMDZYJQS',22396=>'GJuPMn|',22397=>"DtZrt%IHSuJQ",22398=>"DtZrt%IHSuJQ|SQDWr",22399=>'nHt|DuDGQnS',22400=>"UGSZtQ|tMIQ",22401=>'SZtQfHrIZt|IBDEJ',22402=>'GZPQD',22403=>'GZPQD|WHunt|ZJJ',22404=>'QDOHG|HrSQr',22405=>'7?SZB',22406=>'HrSQrD|WHunt|',22407=>'tHtZJ',22408=>'SMDWuDDMHn',22409=>'SZtQ|WrQZtQS',22410=>'WOMJS',22411=>'MS|tOrQZS',22412=>'DOZrQS',22413=>'WID|vQrDMHn',22414=>"vZJMS|tMJJ",22415=>'Drv|JHPMn|OMDtHrB',22416=>'JZDt|JHPMn|MG',22417=>'Drv|YZWKuGD',22418=>'tDtZIG',22419=>'Drv|OHDt|GZBIQntD',22420=>'nHtQ',22421=>'YZJZnWQ|ZIHunt|IMn',22422=>'IZMn|WurrQnWB',22423=>"'{?zd?rSZtQ!",22424=>"?SY|DMAQ!?ftG|DtZtuD!?JMWQnWQ|tBGQ!?",22425=>"?szTq|FhRizT}JMWQnWQ|QxG|SZtQ!'",22426=>"'{?zd?JMWQnWQ|QxG|SZtQ?",22427=>"'",22428=>'OHDtMnP|SMDK|EuHtZ',22429=>"N~z",22430=>'DMAQ',22431=>'nQCD',22432=>'MnDtZnWQ',22433=>'IHSuJQD',22434=>'QDOHG',22435=>"DtZrt%YJHWK|",22436=>'Drv|OHDt|DuGGHrt',22437=>'LDHn|SQWHSQ',22438=>'ru',22439=>'',22440=>']IHSuJQ=nQCD]HrSQr=MS]SMr=s]JMIMt=3]MS|GZPQ=',22441=>'SZtZ',22442=>'urJ',22443=>'nQCD|JZDt|WOQWK',22444=>"DtZrt%IHSuJQ|SQDWr|SQfZuJt",22445=>"tQIGJZtQD~IQnu|IHSuJQD`tGJ",22446=>"IHSuJQ",22447=>"+",22448=>"MtQI",22449=>"MtQID",22450=>"IQnu",22451=>"YHSB",22452=>'WHntQnt',22453=>"fHrI") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $l1I1IL1 =1; $l1I1ILL =1; $l1I1I1I =1; $l1I1I1l =1; $lLIlIIl ="system"; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath .I22359; if(isset($adm->VarsGet["action"]) && $adm->VarsGet["action"] == "refresh"){ if(isset($adm->VarsGet["step"]) && $adm->VarsGet[I22360] == "1"){ $c =NULL; doRedirect($adm->Gui, 'start.php?action=refresh&step=2&key=' .mt_rand(0, 100000), $c); }if(isset($adm->VarsGet[I22360]) && $adm->VarsGet[I22360] == "2"){ $c =NULL; doRedirect($adm->Gui, 'add_new_options.php?from_lic=1&step=2&key=' .mt_rand(0, 100000), $c); }if(isset($adm->VarsGet[I22360]) && $adm->VarsGet[I22360] == I22361){ $Core->TTllT11(); $adm->Gui->addBlock("form", I22362); $l1llLIl['meta'] =$adm->Gui->getMeta('content-type'); $l1llLIl["form"] =$adm->Gui->get(I22363, $l1llLIl); $HtmlBody =$adm->Gui->get("form", $l1llLIl); echo $HtmlBody; exit; }}$l1LII1I =&$adm->Core->GetModule("start"); $adm->Gui->AddBlock("start", "templates/start.tpl"); $l1LII1l =array(I22364 => ""); $l1LII1L =$adm->Gui->ParseLangFile("templates/lang/start.lng"); $mess =$adm->Gui->ParseLangFile("templates/lang/_start_msgs.lng"); $adm->InitMessages($mess); $l1LII11 =""; $l1LIlII =I22365; $l1lLl1L =false; if($adm->Core->HostMode() &HOSTMODE_SHARED){ $oSess =admSession(); $l1lLl1L =($oSess->loginType() == 'plain') && ($oSess->Data['user']['host_data']['admin_status'] != I22366 || $oSess->Data['user']['host_data']['status'] != I22366); if($l1lLl1L){ $l1LIlIl =$oSess->Data["user"][I22367]["status_comment"]; $l1LIlIl =(!empty($l1LIlIl)) ?$l1LIlIl :$mess["no_reason"]; $l1LIlIL =date($adm->DFMT["php"], $oSess->Data["user"][I22367][I22368]); if(isset($oSess->Data["user"][I22367]["status"]) && $oSess->Data["user"][I22367]["status"] != I22369){ $adm->AddStatusMsg("domain_susp", 'red', '', '', array(I22370 => $l1LIlIl, "date" => $l1LIlIL)); }else if(isset($oSess->Data["user"][I22367]["admin_status"]) && $oSess->Data["user"][I22367][I22371] != I22369){ $adm->AddStatusMsg("admin_susp", 'red', '', '', array(I22370 => $l1LIlIl, I22372 => $l1LIlIL)); }}}$vOwners =&$adm->Core->GetOwnersList(); $lllILlL =false; foreach($vOwners as $vName => $vData){ if($vName ="pmanager"){ $lllILlL =true; break; }}if($lllILlL){ $lllILLI =array("pmanager" => $vOwners["pmanager"]); $vOwners =$lllILLI +$vOwners; }$IIL111L =&$adm->Core->GetAllModules(); $aLinks =array(); foreach($IIL111L as $vModName => $vData){ $vMod =&$IIL111L[$vModName]; if($vMod->issetOption(I22373)){ $link =$vMod->GetOption(I22373); if(isset($link['owner']) && $vMod->issetOption(I22374)){ $aLinks[$vModName] =array( 'link' => $link =$vMod->GetOption(I22373), 'icon' => $GLOBALS['ROOT_PATH_WWW'] .'_local/_admin/images/' .$vMod->GetOption(I22374) .I22375 .$vMod->GetOption('icon') );$vMod->Owner =$link['owner']; $Core->SetOwnerInstalled($link['owner'], true); if($aLinks[$vModName]['link'][I22376] != ''){ unset($aLinks[$vModName]); }}}}if(!($adm->Core->HostMode() &HOSTMODE_SHARED)){ $vMod =&$IIL111L['srv_updates']; if( is_object($vMod) && $vMod->IsInstalled() && $vMod->IsAdminAllowed() && $vMod->issetAndTrueOption('valid_check') && (!$l1lLl1L || $vMod->IssetProperty('not_suspend')) ){$link =$vMod->GetAdminLink(); $lllll1l =$adm->Core->ReadOption($lllll1L, I22377, "valid_till"); $aCookie =array( 'validTill' => 'ERROR', 'lastUpdated' => $lllll1L[I22378] );if(!$lllll1l){ $adm->Core->WriteOption(I22377, "valid_till", 'ERROR', '100'); $lllll1L =array('value' => I22379); }elseif($lllll1L['big_value'] == 100 and strtotime($lllll1L[I22378]) +24 *60 *60 <time()){ $l1LIlI1 =&$adm->Core->GetModule(I22377); $l1LIlI1->InitEngine($adm, $db); $aTemplates =array( 'srv_updates_list' => 'templates/srv_updates_list.tpl', 'srv_updates_subform' => 'templates/srv_updates_form.tpl', 'srv_updates_form' => 'templates/form.tpl', 'site_locks' => 'templates/site_locks.tpl' );$l1LIlI1->Engine->Init($aTemplates, 'templates/lang/_srv_updates_msgs.lng', 'templates/lang/srv_updates.lng'); $date =$l1LIlI1->Engine->TIl1lIT(true); if($date){ $date =strtotime($date) +60*60*24*30; $date =date('Y-m-d H:i:s', $date); $aCookie['validTill'] =$date; }else{ $adm->Core->WriteOption(I22377, "valid_till", I22379, I22380); $aCookie['lastUpdated'] =$date; }}else{ $lllll1L['value'] =strtotime($lllll1L['value']) +60*60*24*30; $lllll1L['value'] =date(I22381, $lllll1L['value']); $aCookie['validTill'] =$lllll1L['value']; }if($vMod->GetOption("valid_notify")){ if($lllll1l and $lllll1L[I22382] != I22379){ $llllllL =strtotime($lllll1L[I22382]) +60*60*24*0; $l1LIllI =intval(($llllllL -time()) /60 /60 /24) +1; $aCookie['daysLeft'] =$l1LIllI; if($l1LIllI <0) {$aCookie['validTill'] ='EXPIRED'; }elseif($l1LIllI <= 60){ if(!$adm->Core->ReadOption($popup_shown, I22377, "popup_shown") or $popup_shown[I22382] != date(I22383)){ $adm->Core->WriteOption(I22377, "popup_shown", date(I22383), ''); $l1LII1l["valid_notify"] =$link; }}}}$l1LIlll =AMI::getSingleton('env/cookie'); $l1LIlll->set(I22384, $aCookie, time() +60 *60 *24 *365, I22375); $l1LIlll->save(); }}if(AMI::getSingleton('env/cookie')->get('startPageMode', 'dashboard') == 'menu') {$lllILl1 =AMI_ModDeclarator::getInstance()->getRegistered(); foreach($vOwners as $vName => $vData){ $lllILLl =I22365; $lllILLL =array(); $lllILLL[I22385] =I22365; if(!$adm->Core->IsOwnerInstalled($vName)){ continue; }$l1lLL1L =100000; $l1lLL11 =''; foreach($adm->Core->GetModulesByOwner($vName) as $oModule){ if($oModule->Ill1I1I){ continue; }$l1lL1II =$oModule->GetProperty('taborder', 0); if(isset($l1lL1II) && $l1lL1II <$l1lLL1L){ $l1lLL11 =$oModule->Name; $l1lLL1L =$l1lL1II; }}if($l1lLL11){ $vMod =&$adm->Core->GetModule($l1lLL11); $vData['admin_link'] =$vMod->GetAdminLink(); }if(isset($vData['admin_link'])){ $lllIlLL =$vData[I22386]; }elseif(isset($vData['first_mod_id'])){ $vMod =&$adm->Core->GetModule($vData['first_mod_id']); $lllIlLL =$vMod->GetAdminLink(); }if(empty($lllIlLL)){ continue; }$l1LIllL[$vName ."_link"] =$lllIlLL; $lllILLL["link"] =$lllIlLL; $lllILLL[I22387] =$vData["menu_name"]; $lllILLL["name"] =$vName; if(EventApplyVars($adm, "start_menu", $lllILLL)){ $i =$col =$row =0; $lllILLL[I22388] =I22365; foreach($IIL111L as $vModName => $vData){ $vItemData =array(); $vMod =&$IIL111L[$vModName]; if($l1lLl1L && !$vMod->IssetProperty("not_suspend")){ continue; }if(isset($aLinks[$vModName])){ if($vName != $aLinks[$vModName][I22389]['owner']){ continue; }$vItemData[I22390] =$aLinks[$vModName]['icon']; }elseif( !$vMod->IsInstalled() || !$vMod->IsAdminAllowed() || $vName != $vMod->GetOwnerName() || $vMod->issetAndTrueOption("start_disable") ){continue; }if(in_array($vModName, $lllILl1)){ $vItemData[I22390] =AMI_Service::getModResourceURL( 'mod_icon', array(I22391 => $vModName) );}$lllILL1 =I22365; $vItemData[I22385] =I22365; $vItemData["link"] =$vMod->GetAdminLink(); $vItemData["name"] =$vModName; $vItemData[I22387] =$adm->GetModHeader($vMod); if(empty($vItemData["link"]) || $vMod->GetParentName() != I22365){ continue; }if(EventApplyVars($adm, "start_menu", $vItemData)){ if(I22392 === $adm->Gui->edition){ $vItemData['class_disabled'] =in_array($vModName, array(I22393, I22394)) ?' disabled' :''; if($vItemData['class_disabled']){ $vItemData[I22395] =' title="' .$adm->MenuItemsAll['unavailable_functionality'] .'"'; }}if('plugins_wizard' === $vModName || I22396 === mb_substr($vModName, 0, 7)){ $vItemData['class_disabled'] =' disabled'; }$lllILLL[I22388] .= $adm->Gui->get(I22397 .$lllILL1, $vItemData); if(isset($l1LII1L[$vModName])){ $vItemData[I22385] =$l1LII1L[$vModName] .$vItemData[I22385]; $l1LII11 .= $adm->Gui->get(I22398, $vItemData); }}}if($lllILLL[I22388] != I22365){ $l1LII1l[I22364] .= $adm->Gui->get("start:owner" .$lllILLl, $lllILLL); if(isset($l1LII1L[$vName])){ $lllILLL[I22385] =$l1LII1L[$vName] .$lllILLL[I22385]; $l1LII11 .= $adm->Gui->get(I22398, $lllILLL); }}}}}else {$aCommonData =array(); foreach($IIL111L as $modId => $oModule) {$l1LIll1 =''; if( $oModule->isInstalled() && $oModule->IsAdminAllowed()&& (!$l1lLl1L || $oModule->IssetProperty(I22399)) ){$l1LIll1 =$oModule->GetAdminLink(); }if(!empty($l1LIll1)) {$aCommonData['link_' .$modId] =$l1LIll1; $aCommonData['caption_' .$modId] =$adm->GetModHeader($oModule); }}$l1LIlLI =array(); $db->query('SHOW TABLE STATUS'); while($db->next_record()){ $l1LIlLI[$db->Record['Name']] =$db->Record[I22400]; }foreach(array('pages', 'eshop_item') as $modId) {if( isset($IIL111L[$modId]) && $IIL111L[$modId]->isInstalled() && $IIL111L[$modId]->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[$modId]->IssetProperty(I22399)) ){$table =$IIL111L[$modId]->GetTableName(); if(!empty($table) && isset($l1LIlLI[$table])) {$aCommonData[$modId .'_last_update'] =date( $cms->DFMT["php_dtime"], DateTools::getCorrectUDate($l1LIlLI[$table], $cms->Core->GetProperty(I22401)) );}}}if($cms->Core->ReadOption($aTmp, I22365, "reindex")) {$aCommonData['last_reindex'] =date($cms->DFMT["php_dtime"], $aTmp[I22382]); }if( isset($IIL111L['pages']) && $IIL111L[I22402]->isInstalled() && $IIL111L[I22402]->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[I22402]->IssetProperty(I22399)) ){$db->query("SELECT count(*) as count FROM " .$IIL111L[I22402]->getTableName() ." WHERE lang='$lang_data' AND public = true"); if ($db->next_record()) {$aCommonData['pages_count_public'] =$db->Record['count']; }$db->query("SELECT count(*) as `count` FROM " .$IIL111L[I22402]->getTableName() ." WHERE lang='$lang_data'"); if ($db->next_record()) {$aCommonData[I22403] =$db->Record['count']; }}if( isset($IIL111L['eshop_order']) && $IIL111L['eshop_order']->isInstalled() && $IIL111L['eshop_order']->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[I22404]->IssetProperty(I22399)) ){$oEshop =AMI::getSingleton('eshop'); foreach(array('day' => '1 day', 'week' => I22405) as $name => $interval) {foreach(array('confirmed', 'accepted') as $status) {$db->query( "SELECT count(*) as `count`, sum(total) as `total` FROM " .$IIL111L[I22404]->getTableName() .' ' ."WHERE lang='$lang_data' AND status = '$status' && order_date >= DATE_SUB(CURDATE(), INTERVAL $interval)" );if ($db->next_record()) {$aCommonData[I22406 .$status .'_per_' .$name] =$db->Record['count']; $aCommonData['orders_total_' .$status .'_per_' .$name] =$oEshop->formatMoney($db->Record[I22407]); }}}}foreach(array('feedback', 'jobs_employer', 'jobs_history', 'classifieds', I22408, 'faq', 'forum', 'guestbook') as $modId) {if( isset($IIL111L[$modId]) && $IIL111L[$modId]->isInstalled() && $IIL111L[$modId]->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[$modId]->IssetProperty(I22399)) ){$oModule =AMI::getResourceModel($modId .'/table'); foreach(array(I22409, 'date_start') as $l1LIlLl) {if($oModule->hasField($l1LIlLl)) {$aRemap =$oModule->getFieldsRemap(); if(isset($aRemap[$l1LIlLl])) {$l1LIlLl =$aRemap[$l1LIlLl]; }$db->query( "SELECT count(*) as `count` FROM " .$oModule->getTableName() ." WHERE lang='$lang_data' AND $l1LIlLl >= DATE_SUB(CURDATE(), INTERVAL 1 DAY)" );if ($db->next_record()) {$aCommonData[$modId .'_activity_per_day'] =$db->Record['count']; }$l1LIlLL =array(); foreach( array( I22410 => array('count_children', 'msg_answers'), 'parent_id' => array('id_parent', I22411) )as $key => $params ){foreach($params as $name) {if($oModule->hasField($name)) {if(isset($aRemap[$name])) {$l1LIlLL[$key] =$aRemap[$name]; }else {$l1LIlLL[$key] =$name; }break; }}}if(!empty($l1LIlLL[I22410]) && !empty($l1LIlLL['parent_id'])) {$db->query( "SELECT count(*) as `count` FROM " .$oModule->getTableName() ." WHERE lang='$lang_data' AND " .$l1LIlLL[I22410] ." = 0 AND " .$l1LIlLL['parent_id'] ." = 0 AND $l1LIlLl >= DATE_SUB(CURDATE(), INTERVAL 1 DAY)" );if ($db->next_record()) {$aCommonData[$modId .'_new_activity_per_day'] =$db->Record['count']; }}break; }}}}require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_components.php"); $aCommonData['hostmode'] =($adm->Core->HostMode() &HOSTMODE_SHARED) ?I22412 :'single'; $aCommonData['edition'] =AMI::getEdition(); list($aCommonData['domain'], $aCommonData['domain_alias']) =TlTllTl(); $aCommonData[I22413] =$CMS_VERSION; if( !($adm->Core->HostMode() &HOSTMODE_SHARED) && isset($IIL111L['srv_updates']) && $IIL111L['srv_updates']->isInstalled() && $IIL111L['srv_updates']->IsAdminAllowed() && (!$l1lLl1L || $IIL111L['srv_updates']->IssetProperty(I22399)) && $adm->Core->ReadOption($lllll1L, I22377, I22414) ){$date =$lllll1L[I22382]; if($date != I22379) {$aCommonData['updates_valid_till'] =date( $cms->DFMT["php"], DateTools::getCorrectUDate($date, $cms->Core->GetProperty(I22401)) );}}if( isset($IIL111L['srv_login_history']) && $IIL111L['srv_login_history']->isInstalled() && $IIL111L[I22415]->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[I22415]->IssetProperty(I22399)) ){$db->query("SELECT date, ip FROM cms_host_login_history ORDER BY date desc LIMIT 1"); if ($db->next_record()) {$aCommonData['last_login_date'] =date( $cms->DFMT["php_dtime"], DateTools::getCorrectUDate($db->Record['date'], $cms->Core->GetProperty(I22401)) );$aCommonData[I22416] =$db->Record['ip']; }}if( isset($IIL111L['srv_backups']) && $IIL111L['srv_backups']->isInstalled() && $IIL111L['srv_backups']->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[I22417]->IssetProperty(I22399)) ){$db->query("SELECT tstamp FROM " .$IIL111L[I22417]->getTableName() ." ORDER BY tstamp desc LIMIT 1"); if ($db->next_record()) {$aCommonData['last_backup_date'] =date( $cms->DFMT["php_dtime"], DateTools::getCorrectUDate($db->Record[I22418], $cms->Core->GetProperty(I22401)) );}}if(($adm->Core->HostMode() &HOSTMODE_SHARED)) {require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_format.php"); require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_gui.php"); $IIIlLl1 =AdmModule::TTTTI1l($cms->Core); $lI11Ll1 =DB_si::admInstance(); $oSession =admSession(); if( isset($oSession) && isset($IIL111L[I22419]) && $IIL111L[I22419]->isInstalled() && $IIL111L[I22419]->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[I22419]->IssetProperty(I22399)) ){$lI11Ll1->query( "SELECT note, last_payment_amount, last_payment_date, amount, amount_min, amount_month FROM " .$IIL111L[I22419]->getTableName() ." WHERE id_user = " .$oSession->UserId() ." ORDER BY id desc LIMIT 1"); if ($lI11Ll1->next_record()) {$aCommonData['hosting_note'] =$lI11Ll1->Record[I22420]; if($lI11Ll1->Record['last_payment_amount'] >0) {$aCommonData['last_payment_date'] =$lI11Ll1->Record['last_payment_date']; $aCommonData['last_payment_amount'] =FormatMoney($cms, $lI11Ll1->Record['last_payment_amount'],$IIIlLl1['main_currency'],2,2,true,false); }$aCommonData['balance_amount'] =FormatMoney($cms, $lI11Ll1->Record['amount'],$IIIlLl1['main_currency'],2,2,true,false); $aCommonData[I22421] =FormatMoney($cms, $lI11Ll1->Record['amount_min'],$IIIlLl1['main_currency'],2,2,true,false); $aCommonData['payment_amount_month'] =FormatMoney($cms, $lI11Ll1->Record['amount_month'],$IIIlLl1[I22422],2,2,true,false); }}if(isset($oSession)) {$lI11Ll1->query( 'select p.active as is_active, p.type as type, p.name as name '. 'from cms_host_payments_props p, cms_host_users u where ( p.id_user=u.id and u.id= "' .$oSession->UserId() .'" ) ' .'order by p.id desc, name asc limit 1' );if ($lI11Ll1->next_record()) {$aCommonData['hosting_client_name'] =$lI11Ll1->Record['name']; }}if (!defined('INDEX_DISALLOW_DAYS')) {$days =0; }else {$days =INDEX_DISALLOW_DAYS; }$sql ="SELECT disk_space,disk_quota, DATE_FORMAT(date_registered,'".$adm->DFMT["db"].I22423. " DATE_FORMAT(DATE_ADD(date_registered, INTERVAL ".$days." DAY),'".$adm->DFMT["db"]."') AS index_date,". " IF(NOW() > DATE_ADD(date_registered, INTERVAL ".$days." DAY), 1, 0) AS index_can_be_enabled,". I22424. I22425.$adm->DFMT["db"].I22426. "FROM cms_host_users WHERE domain_orig='". $aCommonData['domain'] .I22427; $lI11Ll1->query($sql); if($lI11Ll1->next_record()) {foreach($lI11Ll1->Record as $name => $value) {$aCommonData['hosting_' .$name] =$value; }$aCommonData['hosting_disk_space'] =getBytesAsText(intval($aCommonData['hosting_disk_space']) ,$adm->Words, 2, 2); $aCommonData['hosting_disk_quota'] =getBytesAsText(intval($aCommonData[I22428]) *1024 *1024, $adm->Words, 2, 2); $aCommonData['hosting_db_size'] =getBytesAsText(intval($aCommonData['hosting_db_size']), $adm->Words, 2, 2); }$lILL11l =&MboxClient::TT1I1Il($aCommonData['domain']); $aCommonData['hosting_email_quota'] =I22429; $aCommonData['hosting_email_space_used'] =I22429; if(is_object($lILL11l)) {$lILL11l->useDomain($aCommonData['domain']); $info =$lILL11l->domainInfo(); if(($info)!==false) {$aCommonData['hosting_email_quota'] =getBytesAsText(intval($info["disk_quota"])*1024, $adm->Words, 2, 2); }$l1LIlL1 =$lILL11l->listMailboxes(true); $lILL11l->TI1Tlll(); if(is_array($l1LIlL1)) {$size =0; foreach($l1LIlL1 as $i => $info) $size += $info[I22430]; $aCommonData['hosting_email_space_used'] =getBytesAsText($size*1024, $adm->Words, 2, 2); }}}$l1LIl1I =array(); $oDeclarator =AMI_ModDeclarator::getInstance(); foreach($IIL111L as $modId => $oMod) {if( $oDeclarator->isRegistered($modId) && $oMod->isInstalled() && $oMod->IsAdminAllowed() && (!$l1lLl1L || $oMod->IssetProperty(I22399)) ){$hyperData =$oDeclarator->getHyperData($modId); if( in_array($hyperData[0], array('ami_multifeeds', 'ami_multifeeds5')) && in_array($hyperData[1], array('articles', I22431, 'blog', 'photoalbum')) && mb_substr($modId, -4) != '_cat' ){$caption =$adm->GetModHeader($oMod); $l1LIl1I[$caption] =array( I22389 => $oMod->GetAdminLink(), 'caption' => $caption, I22432 => $hyperData[1] );}}}ksort($l1LIl1I); $aCommonData['multifeeds'] =''; foreach($l1LIl1I as $modData) {$aCommonData["multifeeds"] .= $adm->Gui->getAbs("start:multifeed_row", $modData); }foreach(array(I22402, I22433, I22434, 'feed', 'templates', 'system', 'hosting') as $block) {$l1LII1l[I22364] .= $adm->Gui->getAbs(I22435 .$block, $aCommonData); }}$l1LIl1l =array('quick_start' => $adm->Gui->getAbs("start:quick_start", $l1LIllL)); foreach(array('members', 'sys_groups', I22436) as $modId) {if( isset($IIL111L[$modId]) && $IIL111L[$modId]->isInstalled() && $IIL111L[$modId]->IsAdminAllowed() && (!$l1lLl1L || $IIL111L[$modId]->IssetProperty(I22399)) ){$l1LIl1l['link_' .$modId] =$IIL111L[$modId]->GetAdminLink(); }}$l1LIl1l += AMI::getResourceModel('members/table')->find($lLILLll['uid'])->getData(); if(function_exists('curl_init') && function_exists(I22437)) {$l1LIl1l['external_informer'] =''; $vMod =$IIL111L['start']; $l1LIl1L =$vMod->GetOption('news_base_url'); $l1LIl11 =($lang == I22438 ?$lang :'en'); $l1LILII =$vMod->GetOption('news_check_interval'); $l1LILIl =$vMod->GetOption('news_last_check'); $l1LILIL =$vMod->GetOption('news_last_data'); if(is_array($l1LILIl) && isset($l1LILIl[$l1LIl11]) && $l1LILIl[$l1LIl11] +$l1LILII >= time()) {if(is_array($l1LILIL) && is_array($l1LILIL[$l1LIl11])) {foreach($l1LILIL[$l1LIl11] as $block => $content) {$rows =I22439; foreach($content as $I1III1I) {$rows .= $adm->Gui->getAbs("start:external_informer_row", $I1III1I); }$l1LIl1l['external_informer'] .= $adm->Gui->getAbs("start:external_informer_" .$block, array('rows' => $rows)); }}}else {$ch =curl_init(); if($ch) {curl_setopt($ch, CURLOPT_HEADER, false); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $l1LILIL[$l1LIl11] =array(); foreach($vMod->GetOption('news_blocks_sources') as $block => $sourcePageId) {$l1LILIl[$l1LIl11] =time(); $l1LILIL[$l1LIl11][$block] =array(); curl_setopt( $ch, CURLOPT_URL, $l1LIl1L .'ami_resp.php?id_plugin=ami_ajax_responder&locale=' .$l1LIl11 .I22440 .$sourcePageId );$content =json_decode(curl_exec($ch), true); if(is_array($content) && is_array($content['data']) && is_array($content['data']['list'])) {$rows =I22439; foreach($content[I22441]['list'] as $item) {$aParams =array( 'header' => $item['header'], 'announce' => preg_replace('/(href|src)\s?=\s?(\'|")(?!http|\/\/)([^\'"]*)(\'|")/ui', '$1=$2' .$l1LIl1L .'$3$4', $item['announce']), 'url' => $l1LIl1L .$item[I22442], 'fdate' => $item['fdate'], 'ftime' => $item['ftime'] );$rows .= $adm->Gui->getAbs("start:external_informer_row", $aParams); $l1LILIL[$l1LIl11][$block][] =$aParams; }}$l1LIl1l['external_informer'] .= $adm->Gui->getAbs("start:external_informer_" .$block, array('rows' => $rows)); $vMod->SetOption('news_last_data', $l1LILIL); }curl_close($ch); }$vMod->SetOption(I22443, $l1LILIl); $Core->saveOptions('start'); }}$l1LII11 =$adm->Gui->getAbs(I22444, $l1LIl1l) .$l1LII11; if(isset($l1I1IL1) && ($l1I1IL1 == 1)){ $l1Il1Ll["menu"] =I22365; }else{ $aMenu =$adm->TTTTllT(); $adm->Gui->addBlock("menu", I22445); $l1lL1Il["items"] =I22365; foreach($aMenu as $aItem){ if($aItem[I22446] == I22447){ $l1lL1Il["items"] .= $adm->Gui->getAbs("menu:splitter", I22365); continue; }$level =($aItem["level"] >1) ?"subitem" :I22448; $style ="standart"; if($aItem[I22369]){ $style =I22369; }if($aItem["opened"] && $aItem["level"] <= 1){ $style ="opened"; }$l1lL1Il[I22449] .= $adm->Gui->get("menu:" .$style ."_" .$level, $aItem); }EventApplyVars($adm, "items_menu", $l1lLLL1); $html["menu"] =$adm->Gui->get(I22450, $l1lL1Il); }$adm->Gui->addBlock("win_left", "templates/left_subwindow.tpl"); $adm->Gui->addBlock("win_left_content", "templates/left_subwindow_content.tpl"); $l1lLLL1 =array(I22451 => $l1LII11); EventApplyVars($adm, "info_area", $l1lLLL1); $html["submenu"] =$l1LII11; $l1LII1l['meta'] =$adm->Gui->getMeta('content-type'); $l1LII1l[I22452] =$adm->Gui->getAbs("start:display_" .AMI::getSingleton('env/cookie')->get('startPageMode', 'dashboard'), $l1LII1l); $html[I22453] =$adm->Gui->get("start", $l1LII1l); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; 