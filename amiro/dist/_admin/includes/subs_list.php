<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       17752 xkqwyzytssypgniptwiurwwxwtulqrptiutxgmpnslkqytismsgztnppsulrgsziggwipnir
 */ ?><?php foreach(array(22603=>"IHSuJQD",22604=>"",22605=>"DuYDWrMYQ",22606=>'wjzddqd|gzTo',22607=>"IQIYQrD",22608=>"Thgmwd",22609=>'tHGMWD',22610=>"ZGGJB",22611=>'rQS',22612=>'IQIYQrD',22613=>"SQJ",22614=>"ZWtMHn",22615=>"MS",22616=>"Hn",22617=>"tMS",22618=>"CQYDMtQ",22619=>"1",22620=>"WOQWK|fHrI",22621=>"IQIYQr|fHrI",22622=>"DuYDWrMYQ|fHrI",22623=>"uSZtQfrHI",22624=>"GOG",22625=>'fJt|IHSuJQ|YHSB|HnJB',22626=>"fJt|IHSuJQ|YHSB|HnJB",22627=>"OMSSQn",22628=>'fJt|QIZMJ',22629=>"tHGMWD",22630=>"tHGMW|MS",22631=>"nZIQ",22632=>"tHGMWD|JMDt",22633=>"SZtQ",22634=>"SY|StMIQ",22635=>"\"",22636=>"QxGHrt|rHCD",22637=>'zdwmm',22638=>"HffDQt",22639=>"fSZtQ",22640=>"JZDtnZIQ",22641=>"SQJ|MS",22642=>"#nHYr@",22643=>"rHC3",22644=>"DuYDWrMYQ|JMDt",22645=>"JQPQnS",22646=>"JZnP|SZtZ",22647=>"DGZWQr",22648=>'',22649=>"WHntQnt") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl =I22603; if(isset($special) && $special==1) {require_once $GLOBALS['CLASSES_PATH'] .'Subscriber.php'; $none =I22604; $oSubscriber =new Subscriber($none); if($id>0 && isset($action) && $action=="del") {$oSubscriber->TI1ll1l($cms, $db, $id); }}else {require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. 'init.php'; AMI::getSingleton('env/async50')->init(I22605, $adm); require_once $GLOBALS['CLASSES_PATH'] .'CMS_Member.php'; require_once $GLOBALS['CLASSES_PATH'] .'Subscriber.php'; require_once $GLOBALS[I22606] .'billing.php'; require_once $GLOBALS[I22606] .$GLOBALS['lLIll1I']['BASE_DRIVER'] .'.php'; $ll1IILL =&$adm->Core->GetModule(I22605); $mMembers =&$adm->Core->GetModule(I22607); $none =I22604; $oSubscriber =new Subscriber($none); $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_subscribe_msgs.lng")); $l1LI11I =isset($adm->Vars['topic_id']) ?(int)$adm->Vars['topic_id'] :0; if($ll1IILL->GetOption("topics")) {$adm->Gui->addGlobalVars(Array(I22608 => "1")); }$lLL1lIl =";"; if ($ll1IILL->GetOption("topics")) {$topics =!empty($adm->Vars['topics']) ?$adm->Vars[I22609] :null; if(is_array($topics)) {foreach($topics as $key => $value) {$lLL1lIl .= $value.";"; }}}if($adm->Vars["id"]>0 && isset($adm->Vars["action"]) && $adm->Vars["action"] == I22610) {$member_data =$adm->VarsPost; $member_data["topics"] =$lLL1lIl; $applied_id =$oSubscriber->TI1ll1I($adm, $db, $adm->Vars["id"], $member_data, true); if($applied_id >0) {$adm->AddStatusMsg("status_apply"); }else {$adm->AddStatusMsg('status_found', I22611, '', '', array('login_field' => $adm->Messages['login_field_' .$adm->Core->GetModOption(I22612, 'login_field')])); }}if($adm->Vars["id"]>0 && isset($adm->Vars["action"]) && $adm->Vars["action"]==I22613) {$oSubscriber->TI1ll1l($adm, $db, $adm->Vars["id"]); $adm->AddStatusMsg("status_del"); unset ($adm->Vars["id"]); }if($adm->Vars["id"]>0 && $adm->Vars[I22614] == "reset") {$oSubscriber->TTI1lIl($adm, $db, $adm->Vars["id"], true); $adm->AddStatusMsg("status_reset"); $applied_id =$adm->Vars["id"]; unset($adm->Vars[I22615]); }if($adm->Vars[I22615]>0 && isset($adm->Vars[I22614]) && $adm->Vars[I22614] == "activate") {$active="0"; if (isset($adm->VarsGet["activate"]) && $adm->VarsGet["activate"] == I22616) {$active="1"; }if($oSubscriber->TI1ll11($db, $adm->Vars[I22615], $active)) {$adm->AddStatusMsg("status_activate"); }else {$adm->AddStatusMsg("status_activate_fail", "red"); }$applied_id =$adm->Vars[I22615]; unset($adm->Vars[I22615]); }$form[I22617] =$l1LI11I; $showForm =false; if(isset($adm->Vars[I22615]) && $adm->Vars[I22615]>0 && isset($adm->Vars[I22614]) && $adm->Vars[I22614] == "edit") {$sql ="SELECT cm.*, csm.topics FROM cms_members cm, cms_subs_members csm ". "WHERE lang='$lang_data' AND cm.id='".$adm->Vars[I22615]."' AND cm.id=csm.id_member"; $db->query($sql); if($db->next_record()) {$form[I22615] =$db->Record[I22615]; $l1LI11l =$db->Record["topics"]; $member_data =$db->Record; $member_data[I22618] =$member_data["companyweb"]; $adm->Gui->AddGlobalVars(Array('FORM_MODE' => 'EDIT')); $adm->Gui->AddGlobalVars(Array("EMPTY_PASSWORD" => I22619)); $oSubscriber->setObligatory($ll1IILL->GetOption('admin_required_fields'), true,true); $I1lLIl1 =$oSubscriber->getScripts($adm, I22605); $form["header_memeber_script"] =$I1lLIl1["header"]; $form["check_member_script"] =$I1lLIl1[I22620]; $form["on_change_member_script"] =$I1lLIl1["on_change"]; $adm->Gui->AddGlobalVars(array( 'EDIT_USERNAME' => (string)(int)(!empty($IlllLll->cms->Vars['flt_edit_username'])) ));$form[I22621] =$oSubscriber->getForm($adm, $db, $member_data); $form["add"] ="disabled"; $form[I22614] =I22610; $form[I22610] =I22604; $showForm =true; }}$adm->Gui->addBlock("subscribe_list","templates/subscribe_list.tpl"); $adm->Gui->addBlock(I22622,"templates/form.tpl"); $adm->Gui->addBlock("subscribe_subform", "templates/subscribe_form.tpl"); $l1LI11L =$adm->TTITI1T("subscribe_list"); if(isset($applied_id) && $applied_id>0){ $result =DateTools::TT1lI11($udate, $adm->Vars[I22623], $adm->Vars["udateto"]); if($result !== false){ $adm->Vars["datefrom"] =date($adm->DFMT["php"], $adm->Vars[I22623]); $adm->Vars["dateto"] =date($adm->DFMT[I22624], $adm->Vars["udateto"]); $adm->Filter->UpdateField("datefrom", $adm->Vars[I22623]); $adm->Filter->UpdateField("dateto", $adm->Vars["udateto"]); }}if(!empty($adm->Vars[I22625])){ $adm->Filter->AddField(I22626, I22627, '1', '', I22604, I22604, I22604, 0, 0); }$adm->Filter->AddField( "flt_email", "text", isset($adm->Vars[I22628]) ?stripslashes(unhtmlentities($adm->Vars[I22628])) :'', I22604, " like ", "email" );$adm->Filter->MoveField("flt_email", _MOVE_START); if($ll1IILL->GetOption(I22629)){ $l1LI111 =&$adm->Core->GetModule("subs_topic"); $l1LI111->PushPager($adm->Pager); $l1LI111->InitPager($adm->Pager); $sql ="SELECT id, name FROM cms_subs_topic WHERE lang='$lang_data' ORDER BY ".$adm->Pager->TI1TTlT("name"); $db->query($sql); $aTopics =$adm->Filter->TITIl11($db, I22615, "name", 35); $aTopics =$adm->Filter->TITI1TT($aTopics, Array($adm->Words["all"]=>0), 35); $adm->Filter->AddField(I22630, "select", ";$l1LI11I;", I22604, " like ", I22629, $aTopics); $adm->Filter->MoveField(I22630, _MOVE_START); if($db->num_rows() >0) $db->seek(); $form['topics_list'] =''; while($db->next_record()) {$topic_form =Array(); $topic_form[I22615] =$db->Record[I22615]; $topic_form[I22631] =$adm->stripLine(strip_tags($db->Record[I22631]), 45); $topic_form["selected"] =!isset($l1LI11l) || mb_strpos($l1LI11l, ";".$topic_form[I22615].";") === false ?I22604 :"selected"; $form[I22632] .= $adm->Gui->get("subscribe_subform:topic_row", $topic_form); }$l1LlIII[I22632] =$adm->Gui->get("subscribe_subform:topics_list", $topics_list); $l1LI111->PopPager($adm->Pager); $l1LI111->TTlITlT(); if($l1LI11I==0) $adm->Filter->DisableFieldSQL(I22630); }$filter ="WHERE 1 "; $filter .= "AND lang='$lang_data' ".$adm->Filter->GetFilterSql(); $filter .= "ORDER BY ".$adm->Pager->TI1TTlT(I22633).", cm.date desc, cm.id asc "; if(isset($adm->Vars[I22614]) && $adm->Vars[I22614]=="export") {$sql ="SELECT cm.*, csm.topics ". ", date_format(cm.date,'".$adm->DFMT[I22634]."') as fdate ". ", date_format(csm.date_stop,'".$adm->DFMT[I22634]."') as fdate_stop ". "FROM cms_members cm INNER JOIN cms_subs_members csm ON csm.id_member=cm.id ". "$filter"; $db->query($sql); while($db->next_record()) {@set_time_limit(29); $l1LlIIl =$db->Record; foreach ($l1LlIIl as $key=>$value) {$value =unhtmlentities($value); if(mb_strpos($value, I22635)!==false || mb_strpos($value, $ll1IILL->GetOption("export_delimiter"))!==false) {$value =I22635.str_replace(I22635, "\"\"", $value).I22635; }$l1LlIIl[$key] =$value; }$l1LlIIl["delim"] =$ll1IILL->GetOption("export_delimiter"); $l1LlIIL[I22636] .= $adm->Gui->get("subscribe_list:export_row", $l1LlIIl); }$sql ="SELECT name FROM cms_subs_topic WHERE id='$l1LI11I'"; $db->query($sql); $db->next_record(); $l1LlIIL["topic_name"] =$db->Record[I22631]; $fbody =$adm->Gui->get("subscribe_list:export", $l1LlIIL); $fbody =mb_convert_encoding($fbody, 'Windows-1251'); $fsize =mb_strlen($fbody, I22637); Header("Content-disposition: filename=".$ll1IILL->GetOption("export_filename")); Header("Content-type: application/octet-stream"); Header("Content-length: $fsize"); echo $fbody; die; }$sql ="SELECT cm.id, (cm.active & csm.active) as active ". "FROM cms_members cm INNER JOIN cms_subs_members csm ON csm.id_member=cm.id $filter"; $db->query($sql); $adm->Pager->MaxCount =$db->num_rows(); if(isset($applied_id) && $applied_id>0){ $adm->Pager->Position =$adm->Pager->TI1TT1l($db, I22615, $applied_id); }$adm->Pager->TI1TT1I(); $adm->Filter->UpdateField(I22638, $adm->Pager->Position); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml( $lll1lII, "javascript:go_page('[START]');"); $html['list_table'] =''; if($adm->Pager->MaxCount>0){ $aTopics =Array(); $sql ="SELECT id, name FROM cms_subs_topic WHERE lang='$lang_data'"; $db->query($sql); while($db->next_record()) {$aTopics[$db->Record[I22615]] =$db->Record[I22631]; }$sql ="SELECT cm.id, cm.username, cm.email, cm.firstname, cm.lastname, cm.ip ". ", date_format(cm.date,'".$adm->DFMT[I22634]."') as fdate ". ", date_format(csm.date_stop,'".$adm->DFMT[I22634]."') as fdate_stop ". ", (cm.active & csm.active) as active, csm.topics ". "FROM cms_members cm INNER JOIN cms_subs_members csm ON csm.id_member=cm.id ". "$filter ".$adm->Pager->TI1TTlI(); $db->query($sql); $i =1; while($db->next_record()) {$l1LlII1 =Array(); $l1LlII1[I22615] =$db->Record[I22615]; $lid =$db->Record[I22615]; $l1LlII1["username"] =$db->Record["username"]; $l1LlII1["email"] =$db->Record["email"]; $l1LlII1[I22633] =$db->Record[I22639]; $l1LlII1["date_stop"] =$db->Record["fdate_stop"]; $l1LlII1["firstname"] =$db->Record["firstname"]; $l1LlII1[I22640] =$db->Record[I22640]; $l1LlII1["ip"] =$db->Record["ip"]; $links["act_id"] =$links["edit_id"] =$links[I22641] =$links["reset_id"] =$lid; $l1LlIlI =explode(";", $db->Record[I22629]); $cnt =0; foreach($l1LlIlI as $key) {if(!empty($key) && !empty($aTopics[$key]) && $cnt<=$ll1IILL->GetOption("topics_in_list")) {if($cnt++ <$ll1IILL->GetOption("topics_in_list")) {$l1LlII1[I22629] .= I22642.$adm->stripLine($aTopics[$key], 45)."</nobr><br>"; }else {$l1LlII1[I22629] .= "..."; }}}if($db->Record["active"] == 1) $l1LlII1["active"] =$adm->Gui->get("subscribe_list:active_on",$links); else $l1LlII1["active"] =$adm->Gui->get("subscribe_list:active_off",$links); $style ="row2"; if($i%2) $style="row1"; if($adm->Vars[I22615]>0 && $adm->Vars[I22615] == $lid) $style =I22643; if($lid == $applied_id) $style ="row4"; $actions =$adm->Gui->get("subscribe_list:icons_edit_reset_del",$links); $l1LlII1["actions"] =$actions; $l1LlII1["style"] =$style; $l1LI11L[I22644] .= $adm->Gui->get("subscribe_list:row",$l1LlII1); $i++; }$l1LI11L["legend"] .= $adm->Gui->getAbs("subscribe_list:onactive",I22604); $l1LI11L["legend"] .= $adm->Gui->getAbs("subscribe_list:notactive",I22604); $l1LI11L["legend"] .= $adm->Gui->getAbs("subscribe_list:leg_yellow",I22604); $l1LI11L["legend"] .= $adm->Gui->getAbs("subscribe_list:leg_blue",I22604); $l1LI11L[I22645] .= $adm->Gui->getAbs("subscribe_list:leg_edit",I22604); $l1LI11L[I22645] .= $adm->Gui->getAbs("subscribe_list:leg_reset",I22604); $l1LI11L[I22645] .= $adm->Gui->getAbs("subscribe_list:leg_del",I22604); $l1LI11L["pager"] =$pager; $l1LI11L[I22646] =$lang_data; $html["list_table"] .= $adm->Gui->get(I22644,$l1LI11L); }else {$html["list_table"] .= $adm->Gui->get("subscribe_list:empty",$l1LI11L); }$html["list_table"] .=$adm->Gui->getAbs(I22647,I22604); if($ll1IILL->GetOption(I22629)){ $adm->Filter->UpdateField(I22630, $l1LI11I); }$form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); if($showForm) {$adm->Gui->AddGlobalVars(Array('SHOW_FORM' => '1')); }else {$adm->Gui->AddGlobalVars(Array('SHOW_FORM' => I22648)); }if(isset($form['action']) && $form['action'] == 'apply'){ $form["cancel"] =$adm->Gui->get("subscribe_subform:cancel", $form); }$l1LI11L =$adm->Gui->get("subscribe_subform", $form); if($showForm) {$html["form"] .= $adm->Gui->getAbs(I22622,Array("header"=>$adm->Words["subscribe_apply"],I22649=>$l1LI11L,"form_align"=>"align=center")); }else {$html["form"] =$l1LI11L; }unset($adm->Filter); AMI::getSingleton('env/async50')->finalize($adm, $ll1IILL, $html); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; }?>
