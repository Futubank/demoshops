<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       10915 xkqwgnknumtsyinwkxrxtgprglsgxktgzsnrplmigmqkqytskxinlgppgqxszupyugtlpnir
 */ ?><?php foreach(array(22741=>"IHSuJQD",22742=>'Qnv~ZDBnW50',22743=>'JjmJJ1m',22744=>'IZnuZJ|GrMWQ',22745=>"ZSS",22746=>"SQDWrMGtMHn",22747=>'GrMWQ',22748=>"DtZtuD|ZSS",22749=>"ZGGJB",22750=>'frQQ',22751=>'ZJMZD',22752=>"'",22753=>"MS",22754=>"0",22755=>"SMDZYJQS",22756=>"coqRq?MS='",22757=>"GrMWQ",22758=>"tHGMW|JMDt",22759=>"uSZtQfrHI",22760=>"SZtQtH",22761=>'fJt|IHSuJQ|YHSB|HnJB',22762=>"fJt|IHSuJQ|YHSB|HnJB",22763=>"",22764=>"nZIQ",22765=>"hRsqR?yb?",22766=>"SQJ|MS",22767=>"ZWtMvQ",22768=>"rHC4",22769=>"ZWtMHnD",22770=>"JQPQnS",22771=>"tHGMW|JMDt%QIGtB",22772=>"tHGMW|DuYfHrI",22773=>"WHntQnt",22774=>"ZWtMHn",22775=>"OQZSQr",22776=>'SHnQ`GOG') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl =I22741; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. 'init.php'; AMI::getSingleton(I22742)->init("subs_topic", $adm); require_once $GLOBALS['CLASSES_PATH'] .'billing.php'; require_once $GLOBALS['CLASSES_PATH'] .$GLOBALS[I22743]['BASE_DRIVER'] .'.php'; $ll1IILL =&$adm->Core->GetModule("subscribe"); $l1LI111 =&$adm->Core->GetModule("subs_topic"); $lLL1llI =$l1LI111->GetOption(I22744); if($lLL1llI) {$adm->Gui->AddGlobalVars(Array('MANUAL_PRICE' => '1')); }$adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_subscribe_topic_msgs.lng")); if($adm->Vars["action"] == I22745) {$name =$adm->VarsPost["name"]; $desc =$adm->VarsPost["desc"]; if($name != "") {$asql =Array( "name"=>$name, I22746=>$desc, "active"=>"1", "lang"=>$lang_data );if($lLL1llI) {$price =intval($adm->VarsPost['price']); if($price >0) {$asql[I22747] =$price; $asql['free'] =0; }}$sql =$db->GenInsertSQL("cms_subs_topic", $asql); $db->query($sql); $lid =$db->lastInsertId(); if($lLL1llI && $price >0) {$asql =Array( 'alias' => $lid );$sql =$db->GenUpdateSQL("cms_subs_topic", $asql, "WHERE id='$lid'"); $db->query($sql); }$applied_id =$lid; $adm->AddStatusMsg(I22748); }else{ $adm->AddStatusMsg("status_add_fail", "red"); }}if($adm->Vars["id"]>0 && $adm->Vars["action"] == I22749 ){$desc =$adm->VarsPost["desc"]; $name =$adm->VarsPost["name"]; if(!empty($name)) {$asql =Array( I22746=>$desc, "lang"=>$lang_data, "name"=>$name );if($lLL1llI) {$price =intval($adm->VarsPost[I22747]); if($price >0) {$asql[I22747] =$price; $asql[I22750] =0; }else {$asql[I22747] =0; $asql[I22750] =1; }}$sql =$db->GenUpdateSQL("cms_subs_topic", $asql, "WHERE id='".$adm->Vars["id"]."'"); $db->query($sql); if($lLL1llI && $price >0) {$asql =Array( I22751 => $adm->Vars["id"] );$sql =$db->GenUpdateSQL("cms_subs_topic", $asql, "WHERE id='".$adm->Vars["id"].I22752); $db->query($sql); }$applied_id =$adm->Vars["id"]; $adm->AddStatusMsg("status_apply"); $sql ="UPDATE cms_subs_sent SET topic='".$name."' WHERE id_topic='".$adm->Vars[I22753].I22752; $db->query($sql); }else{ $adm->AddStatusMsg("status_apply_fail", "red"); }unset($adm->Vars[I22753]); }if($adm->Vars[I22753]>0 && $adm->Vars["action"] == "del") {$sql ="DELETE FROM cms_subs_topic WHERE id='".$adm->Vars[I22753].I22752; $db->query($sql); $adm->AddStatusMsg("status_del"); unset($adm->Vars[I22753]); }if($adm->Vars[I22753]>0 && isset($adm->Vars["action"]) && $adm->Vars["action"] == "activate") {$active=I22754; if (isset($adm->VarsGet["activate"]) && $adm->VarsGet["activate"] == "on") $active="1"; $sql ="UPDATE cms_subs_topic SET active='".intval($active)."' WHERE id='".$adm->Vars[I22753].I22752; $db->query($sql); $applied_id =$adm->Vars[I22753]; $adm->AddStatusMsg("status_activate"); unset($adm->Vars[I22753]); }$form["date"] =date($adm->DFMT["php"]); $form[I22749] =I22755; $form["action"] =I22745; if( $adm->Vars["action"] == "edit" && $adm->Vars[I22753]>0) {$sql ="SELECT id, name, price, description FROM cms_subs_topic ". I22756.$adm->Vars[I22753]."' AND lang='$lang_data'"; $db->query($sql); if($db->next_record()) {$form[I22753] =$db->Record[I22753]; $form["name"] =$db->Record["name"]; $form["desc"] =$db->Record[I22746]; $form["price"] =$db->Record[I22757]; $form[I22745] =I22755; $form["action"] =I22749; $form[I22749] =""; }}$adm->Gui->addBlock("topic_list","templates/subscribe_topic_list.tpl"); $lLL1LII =$adm->TTITI1T(I22758); if(isset($applied_id) && $applied_id>0){ $result =DateTools::TT1lI11($udate, $adm->Vars["udatefrom"], $adm->Vars["udateto"]); if($result !== false){ $adm->Vars["datefrom"] =date($adm->DFMT["php"], $adm->Vars[I22759]); $adm->Vars["dateto"] =date($adm->DFMT["php"], $adm->Vars["udateto"]); $adm->Filter->UpdateField("datefrom", $adm->Vars[I22759]); $adm->Filter->UpdateField(I22760, $adm->Vars["udateto"]); }}if(!empty($adm->Vars[I22761])){ $adm->Filter->AddField(I22762, "hidden", '1', '', I22763, I22763, I22763, 0, 0); }$adm->Filter->AddField("flt_name", "text", stripslashes(unhtmlentities($adm->Vars["flt_name"])), I22763, " like ", I22764); $adm->Filter->MoveField("flt_name",_MOVE_PREV); if($adm->Filter->issetField("datefrom")) $adm->Filter->TITI1l1("datefrom"); if($adm->Filter->issetField(I22760)) $adm->Filter->TITI1l1(I22760); $filter ="WHERE 1 "; $filter .= "AND lang='$lang_data' ".$adm->Filter->GetFilterSql(); $filter .= I22765.$adm->Pager->TI1TTlT(I22764).", id asc "; $sql ="SELECT id $l1LlLI1 from cms_subs_topic $filter "; $db->query($sql); $adm->Pager->MaxCount =$db->num_rows(); if(isset($applied_id) && $applied_id>0){ $adm->Pager->Position =$adm->Pager->TI1TT1l($db, I22753, $applied_id); }$adm->Pager->TI1TT1I(); $adm->Filter->UpdateField("offset", $adm->Pager->Position); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml( $lll1lII, "javascript:go_page('[START]');"); if($adm->Pager->MaxCount>0){ $sql ="SELECT id, name, active, free $l1LlLI1". "from cms_subs_topic $filter ".$adm->Pager->TI1TTlI(); $db->query($sql); $i=1; while($db->next_record()) {$lid =$db->Record[I22753]; $l1LlLlI[I22764] =$adm->stripLine($db->Record[I22764], 50); $links["act_id"] =$links[I22766] =$links["edit_id"] =$lid; if($db->Record["active"] == 1) $l1LlLlI["active"] =$adm->Gui->get("topic_list:active_on",$links); else $l1LlLlI[I22767] =$adm->Gui->get("topic_list:active_off",$links); $style ="row2"; if($i%2) $style="row1"; if($adm->Vars[I22753]>0 && $adm->Vars[I22753] == $lid) $style ="row3"; if($lid == $applied_id) $style =I22768; $l1LlLlI["paid"] =($db->Record["free"]!=1) ?$adm->Gui->getAbs("topic_list:icon_paid",I22763) :I22763; $actions =$adm->Gui->get("topic_list:icons_edit_del",$links); $l1LlLlI[I22769] =$actions; $l1LlLlI[I22753] =$lid; $l1LlLlI["style"] =$style; $lLL1LII[I22758] .= $adm->Gui->get("topic_list:row",$l1LlLlI); $i++; }$lLL1LII["legend"] .= $adm->Gui->getAbs("topic_list:onactive",I22763); $lLL1LII[I22770] .= $adm->Gui->getAbs("topic_list:notactive",I22763); $lLL1LII[I22770] .= $adm->Gui->getAbs("topic_list:leg_chargeable",I22763); $lLL1LII[I22770] .= $adm->Gui->getAbs("topic_list:leg_yellow",I22763); $lLL1LII[I22770] .= $adm->Gui->getAbs("topic_list:leg_blue",I22763); $lLL1LII[I22770] .= $adm->Gui->getAbs("topic_list:leg_edit",I22763); $lLL1LII[I22770] .= $adm->Gui->getAbs("topic_list:leg_del",I22763); $lLL1LII["pager"] =$pager; $html["list_table"] =$adm->Gui->get(I22758,$lLL1LII); }else {$html["list_table"] =$adm->Gui->getAbs(I22771,I22763); $html["list_table"] .= $adm->Gui->getAbs("spacer",I22763); }$html["list_table"] .=$adm->Gui->getAbs("spacer",I22763); $form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); $adm->Gui->addBlock("topic_form","templates/form.tpl"); $adm->Gui->addBlock("topic_subform", "templates/subscribe_topic_form.tpl"); if($form[I22745] != I22755) {$lLL1LII =$adm->Gui->get(I22772, $form); $html["form"] =$adm->Gui->getAbs("topic_form",Array("header"=>$adm->Words["subscribe_topic_add"],I22773=>$lLL1LII,"form_align"=>"align=center", 'width' => '100%')); }else {if($form[I22774] == I22749) {$form["cancel"] =$adm->Gui->getAbs("topic_subform:cancel", I22763); }$lLL1LII =$adm->Gui->get(I22772, $form); $html["form"] =$adm->Gui->getAbs("topic_form",Array(I22775=>$adm->Words["subscribe_topic_apply"],I22773=>$lLL1LII,"form_align"=>"align=center")); }unset($adm->Filter); AMI::getSingleton(I22742)->finalize($adm, $l1LI111, $html); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .I22776; ?>