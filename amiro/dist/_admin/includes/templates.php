<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       9265 xkqwswisutuuqnmnuprqslrsmxzuurqumnmmrrxnttlmmsqumpitlsixqtqtmuqsululpnir
 */ ?><?php foreach(array(22792=>'MnMt`GOG',22793=>"ZSS",22794=>"YHSB",22795=>"DtZtuD|ZSS",22796=>"ZGGJB",22797=>"SZtQ",22798=>'MS',22799=>'ZWtMHn',22800=>"GOG",22801=>"QSMt",22802=>"MS",22803=>"ZWtMHn",22804=>"uSZtQfrHI",22805=>"SZtQfrHI",22806=>"fJt|nZIQ",22807=>"coqRq?1?",22808=>'JQPQnS',22809=>"SQJ|MS",22810=>"rHC3",22811=>"tQIGJZtQD|JMDt",22812=>"JQPQnS",22813=>"JMDt|tZYJQ",22814=>"tQIGJZtQD|DuYfHrI",22815=>"tQIGJZtQD|fHrI",22816=>"ZJMPn=WQntQr",22817=>"",22818=>"fHrI|ZJMPn") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl ="pmanager"; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. I22792; AMI::getSingleton('env/async50')->init("templates", $adm); $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_templates_msgs.lng")); if($adm->Vars['action'] == I22793) {$name =$adm->VarsPost["name"]; $udate =DateTools::getCorrectUDate($adm->VarsPost["date"], $adm->DFMT["conf"]); $date =date($adm->DFMT["php"], $udate); $body =$adm->VarsPost[I22794]; if(!empty($name) && !empty($body)) {$asql =Array( "date"=>DateTools::toMysqlDate($udate), "name"=>$name, I22794=>$body, "lang"=>$lang_data );$sql =$db->GenInsertSQL("cms_templates", $asql); $db->query($sql); $lid =$db->lastInsertId(); $applied_id =$lid; $adm->AddStatusMsg(I22795); }else{ $adm->AddStatusMsg("status_add_fail", "red"); }}if($adm->Vars['id']>0 && $adm->Vars['action'] == I22796 ){$name =$adm->VarsPost["name"]; $udate =DateTools::getCorrectUDate($adm->VarsPost["date"], $adm->DFMT["conf"]); $date =date($adm->DFMT["php"], $udate); $body =$adm->VarsPost[I22794]; if(!empty($name) && !empty($body)) {$asql =Array( I22797=>DateTools::toMysqlDate($udate), "name"=>$name, "lang"=>$lang_data, I22794=>$body, );$sql =$db->GenUpdateSQL("cms_templates", $asql, "WHERE id='".$adm->Vars[I22798]."'"); $db->query($sql); $applied_id =$adm->Vars[I22798]; $adm->AddStatusMsg("status_apply"); }else{ $adm->AddStatusMsg("status_apply_fail", "red"); }unset($adm->Vars[I22798]); }if(!empty($adm->Vars[I22798]) && $adm->Vars[I22799] == "del") {$sql ="DELETE FROM cms_templates WHERE id='".$adm->Vars[I22798]."'"; $db->query($sql); $adm->AddStatusMsg("status_del"); unset($adm->Vars[I22798]); }$form[I22797] =date($adm->DFMT[I22800]); $form[I22796] ="disabled"; $form["action"] =I22793; $form["right"] ="selected"; if( $adm->Vars[I22799] == I22801 && $adm->Vars[I22798]>0) {$sql ="SELECT *, DATE_FORMAT(date,'".$adm->DFMT["db"]."') AS fdate FROM cms_templates ". "WHERE id='".$adm->Vars[I22798]."' AND lang='$lang_data'"; $db->query($sql); if($db->next_record()) {$form[I22802] =$db->Record[I22802]; $form[I22797] =$db->Record["fdate"]; $form["name"] =$db->Record["name"]; $form[I22794] =$adm->htmlchars($db->Record[I22794]); $form[I22793] ="disabled"; $form[I22803] =I22796; $form[I22796] =""; }}$adm->Gui->addBlock("templates_list","templates/templates_list.tpl"); $l1LlLLL =$adm->TTITI1T("templates_list"); if(isset($applied_id) && $applied_id>0){ $result =DateTools::TT1lI11($udate, $adm->Vars[I22804], $adm->Vars["udateto"]); if($result !== false){ $adm->Vars["datefrom"] =date($adm->DFMT[I22800], $adm->Vars[I22804]); $adm->Vars["dateto"] =date($adm->DFMT[I22800], $adm->Vars["udateto"]); $adm->Filter->UpdateField(I22805, $adm->Vars[I22804]); $adm->Filter->UpdateField("dateto", $adm->Vars["udateto"]); }}$adm->Filter->AddField("flt_name", "text", isset($adm->Vars[I22806]) ?stripslashes(unhtmlentities($adm->Vars[I22806])) :'', "", " like ", "name"); $adm->Filter->MoveField(I22806,_MOVE_PREV); $filter =I22807; $filter .="AND lang='$lang_data' ".$adm->Filter->GetFilterSql(); $filter .= "ORDER BY ".$adm->Pager->TI1TTlT(I22797).", date desc, id asc "; $sql ="SELECT id, date FROM cms_templates $filter "; $db->query($sql); $adm->Pager->MaxCount =$db->num_rows(); if(isset($applied_id) && $applied_id>0){ $adm->Pager->Position =$adm->Pager->TI1TT1l($db, I22802, $applied_id); }$adm->Pager->TI1TT1I(); $adm->Filter->UpdateField("offset", $adm->Pager->Position); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml( $lll1lII, "javascript:go_page('[START]');"); if($adm->Pager->MaxCount>0){ $sql ="SELECT id, name, date_format(date,'".$adm->DFMT["db"]."') as fdate ". "from cms_templates $filter ".$adm->Pager->TI1TTlI(); $db->query($sql); $i=1; $l1LlLLL['templates_list'] =''; $l1LlLLL[I22808] =''; while($db->next_record()) {$lid =$db->Record[I22802]; $l1LlLL1[I22797] =$db->Record["fdate"]; $l1LlLL1["name"] =strip_tags($db->Record["name"]); $links[I22809] =$links["edit_id"] =$links["pub_id"] =$lid; $style ="row2"; if($i%2) $style="row1"; if(!empty($adm->Vars[I22798]) && $adm->Vars[I22798] == $lid) $style =I22810; if(isset($applied_id) && $lid == $applied_id) $style ="row4"; $actions =$adm->Gui->get("templates_list:icons_edit_del",$links); $l1LlLL1["actions"] =$actions; $l1LlLL1["style"] =$style; $l1LlLLL[I22811] .= $adm->Gui->get("templates_list:row",$l1LlLL1); $i++; }$l1LlLLL["legend"] .= $adm->Gui->getAbs("templates_list:leg_yellow",""); $l1LlLLL[I22812] .= $adm->Gui->getAbs("templates_list:leg_blue",""); $l1LlLLL[I22812] .= $adm->Gui->getAbs("templates_list:leg_edit",""); $l1LlLLL[I22812] .= $adm->Gui->getAbs("templates_list:leg_del",""); $l1LlLLL["pager"] =$pager; $html["list_table"] =$adm->Gui->get(I22811,$l1LlLLL); }else {$html["list_table"] =$adm->Gui->getAbs("templates_list:empty",""); $html["list_table"] .= $adm->Gui->getAbs("spacer",""); }$html[I22813] .=$adm->Gui->getAbs("spacer",""); $adm->Gui->addBlock("templates_form","templates/form.tpl"); $adm->Gui->addBlock(I22814, "templates/templates_form.tpl"); $form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); if(!isset($form[I22793]) || $form[I22793] != "disabled") {$l1LlLLL =$adm->Gui->get(I22814, $form); $html["form"] =$adm->Gui->getAbs(I22815,Array("header"=>$adm->Words["templates_add"],"content"=>$l1LlLLL,"form_align"=>I22816, 'width' => '100%')); }else {if($form[I22803] == I22796) {$form["cancel"] =$adm->Gui->getAbs("templates_subform:cancel", I22817); }$l1LlLLL =$adm->Gui->get(I22814, $form); $html["form"] =$adm->Gui->getAbs(I22815,Array("header"=>$adm->Words["templates_apply"],"content"=>$l1LlLLL,I22818=>I22816)); }unset($adm->Filter); $mTemplates =&$adm->Core->GetModule("templates"); AMI::getSingleton('env/async50')->finalize($adm, $mTemplates, $html); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; 