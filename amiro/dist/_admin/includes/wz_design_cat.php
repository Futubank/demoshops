<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       8633 xkqwsktkmktzwpiwykttqistzgwrrninninprwrqqnlixilqilkknutiummqgurxukuppnir
 */ ?><?php foreach(array(22824=>'MnMt`GOG',22825=>"nZIQ",22826=>"ZnnHunWQ",22827=>"DtZtuD|ZSS|fZMJ",22828=>"GuYJMW",22829=>"DtZtuD|ZGGJB|fZMJ",22830=>"ZWtMHn",22831=>"Hn",22832=>"ZGGJB",22833=>"YHSB",22834=>"",22835=>"SZtQtH",22836=>"HffDQt",22837=>"GuY|MS",22838=>"rHC3",22839=>"WZt|JMDt",22840=>"JQPQnS",22841=>"JMDt|tZYJQ",22842=>"WZt|fHrI",22843=>"SMDZYJQS",22844=>"WHntQnt",22845=>"WZt|DuYfHrI",22846=>"ZJMPn=WQntQr") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl ="wizard"; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. I22824; $id =intval($adm->Vars["id"]); $adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_wz_cat_msgs.lng")); if($adm->Vars["action"] == "add") {$name =$adm->VarsPost[I22825]; $body =$adm->VarsPost["body"]; $announce =$adm->VarsPost["announce"]; $public =$adm->VarsPost["public"]; if(!empty($name)) {$asql =Array( I22825=>$name, "public"=>$public, I22826=>$announce, "body"=>$body, "lang"=>$lang_data );$sql =$db->GenInsertSQL("cms_articles_cat", $asql); $db->query($sql); $lid =$db->lastInsertId(); $applied_id =$lid; $adm->AddStatusMsg("status_add"); }else{ $adm->AddStatusMsg(I22827, "red"); }}if($id>0 && $adm->Vars["action"] == "apply" ){$announce =$adm->VarsPost[I22826]; $body =$adm->VarsPost["body"]; $name =$adm->VarsPost[I22825]; $public =$adm->VarsPost[I22828]; if(!empty($name)) {$asql =Array( I22826=>$announce, "body"=>$body, "lang"=>$lang_data, I22828=>intval($public), I22825=>$name );$sql =$db->GenUpdateSQL("cms_articles_cat", $asql, "WHERE id='$id'"); $db->query($sql); $applied_id =$id; $adm->AddStatusMsg("status_apply"); }else{ $adm->AddStatusMsg(I22829, "red"); }unset($id); }if($id>0 && $adm->Vars["action"] == "del") {$sql ="UPDATE cms_articles set id_cat='0' WHERE id_cat='$id' and lang='$lang_data'"; $db->query($sql); $sql ="DELETE FROM cms_articles_cat WHERE id='$id' and lang='$lang_data'"; $db->query($sql); $adm->AddStatusMsg("status_del"); unset($id); }if($id>0 && $adm->Vars[I22830] == "publish") {$public="0"; if (isset($adm->VarsGet["publish"]) && $adm->VarsGet["publish"] == I22831) $public="1"; $sql ="UPDATE cms_articles SET public='".intval($public)."' WHERE id_cat='$id' and lang='$lang_data'"; $db->query($sql); $sql ="UPDATE cms_articles_cat SET public='".intval($public)."' WHERE id='$id' and lang='$lang_data'"; $db->query($sql); $applied_id =$id; $adm->AddStatusMsg("status_publish"); unset($id); }$form[I22832] ="disabled"; $form[I22830] ="add"; $form[I22828] ="checked"; if( $adm->Vars[I22830] == "edit" && $id>0) {$sql ="SELECT * FROM cms_articles_cat ". "WHERE id='$id' AND lang='$lang_data'"; $db->query($sql); if($db->next_record()) {$form["id"] =$db->Record["id"]; if($db->Record[I22828] == 1) $form[I22828] ="checked"; $form[I22825] =$db->Record[I22825]; $form[I22826] =$adm->htmlchars($db->Record[I22826]); $form["body"] =$adm->htmlchars($db->Record[I22833]); $form["add"] ="disabled"; $form[I22830] =I22832; $form[I22832] =""; }}$adm->Gui->addBlock("cat_list","templates/articles_cat_list.tpl"); $l1LlL1I =$adm->TTITI1T("cat_list"); $adm->Filter->AddField("flt_name", "text", stripslashes(unhtmlentities($adm->Vars["flt_name"])), I22834, " like ", I22825); $adm->Filter->MoveField("flt_name",_MOVE_PREV); if($adm->Filter->issetField("datefrom")) $adm->Filter->TITI1l1("datefrom"); if($adm->Filter->issetField(I22835)) $adm->Filter->TITI1l1(I22835); $filter ="WHERE 1 "; $filter .="AND lang='$lang_data' ".$adm->Filter->GetFilterSql(); $filter .= "ORDER BY ".$adm->Pager->TI1TTlT(I22825).", id asc "; $sql ="SELECT id from cms_wz_design_cat $filter "; $db->query($sql); $adm->Pager->MaxCount =$db->num_rows(); if(isset($applied_id) && $applied_id>0){ $adm->Pager->Position =$adm->Pager->TI1TT1l($db, "id", $applied_id); }$adm->Pager->TI1TT1I(); $adm->Filter->UpdateField(I22836, $adm->Pager->Position); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml( $lll1lII, "javascript:go_page('[START]');"); if($adm->Pager->MaxCount>0){ $sql ="SELECT id, name, public $l1LlLI1". "from cms_wz_design_cat $filter ".$adm->Pager->TI1TTlI(); $db->query($sql); $i=1; while($db->next_record()) {$lid =$db->Record["id"]; $cat_item[I22825] =$adm->stripLine($db->Record[I22825], 50); $links["del_id"] =$links["edit_id"] =$links[I22837] =$lid; if($db->Record[I22828] == 1) $cat_item[I22828] =$adm->Gui->get("cat_list:public_on_multi",$links); else $cat_item[I22828] =$adm->Gui->get("cat_list:public_off_multi",$links); $style ="row2"; if($i%2) $style="row1"; if($id>0 && $id == $lid) $style =I22838; if($lid == $applied_id) $style ="row4"; $actions =$adm->Gui->get("cat_list:icons_edit_del_multi",$links); $cat_item["actions"] =$actions; $cat_item["style"] =$style; $l1LlL1I[I22839] .= $adm->Gui->get("cat_list:row",$cat_item); $i++; }$l1LlL1I["legend"] .= $adm->Gui->getAbs("cat_list:published",I22834); $l1LlL1I["legend"] .= $adm->Gui->getAbs("cat_list:notpublished",I22834); $l1LlL1I["legend"] .= $adm->Gui->getAbs("cat_list:leg_yellow",I22834); $l1LlL1I["legend"] .= $adm->Gui->getAbs("cat_list:leg_blue",I22834); $l1LlL1I[I22840] .= $adm->Gui->getAbs("cat_list:leg_edit",I22834); $l1LlL1I[I22840] .= $adm->Gui->getAbs("cat_list:leg_del",I22834); $l1LlL1I["pager"] =$pager; $html["list_table"] =$adm->Gui->get(I22839,$l1LlL1I); }else {$html[I22841] =$adm->Gui->getAbs("cat_list:empty",I22834); $html[I22841] .= $adm->Gui->getAbs("spacer",I22834); }$html[I22841] .=$adm->Gui->getAbs("spacer",I22834); $form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); $adm->Gui->addBlock(I22842,"templates/form.tpl"); $adm->Gui->addBlock("cat_subform", "templates/articles_cat_form.tpl"); if($form["add"] != I22843) {$l1LlL1I =$adm->Gui->get("cat_subform", $form); $html["form"] =$adm->Gui->getAbs(I22842,Array("header"=>$adm->Words["articles_cat_add"],I22844=>$l1LlL1I,"form_align"=>"align=center")); }else {if($form[I22830] == I22832) {$form["cancel"] =$adm->Gui->getAbs("cat_subform:cancel", I22834); }$l1LlL1I =$adm->Gui->get(I22845, $form); $html["form"] =$adm->Gui->getAbs(I22842,Array("header"=>$adm->Words["articles_cat_apply"],I22844=>$l1LlL1I,"form_align"=>I22846)); }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; ?>