<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       15878 xkqwtigitsmguzgytkukinyzgnznlkqrrswtptqmwxszgkkyqxrzuniksunnlltirxtxpnir
 */ ?><?php foreach(array(22847=>'MnMt`GOG',22848=>"Nh|zRTmwjqd|wzTd",22849=>"1",22850=>"ZnnHunWQ",22851=>"ZutOHr",22852=>"ZrWOMvQ",22853=>"nZIQ",22854=>"JZnP",22855=>"DHurWQ",22856=>"DtZtuD|ZSS|fZMJ",22857=>"ZGGJB",22858=>"YHSB",22859=>"'",22860=>"WID|ZrtMWJQD|WZt",22861=>"MS|WZt",22862=>"DtZtuD|ZGGJB",22863=>"MS",22864=>"ZWtMHn",22865=>"Hn",22866=>"ZrWO",22867=>"GOG",22868=>"rMPOt",22869=>"fSZtQ",22870=>"OQZSQr",22871=>"",22872=>"ZrtMWJQD|DuYfHrI",22873=>"WZt|MS",22874=>"WZtQPHrMQD|JMDt",22875=>"uSZtQfrHI",22876=>"SZtQfrHI",22877=>"SZtQ",22878=>"HffDQt",22879=>"ZrWOMvQ!?",22880=>"QSMt|MS",22881=>"rHC4",22882=>"ZrtMWJQD|JMDt%rHC",22883=>"JQPQnS",22884=>"JMDt|tZYJQ",22885=>"ZrtMWJQD|ZSS",22886=>"fHrI|ZJMPn") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} $lLIlIIl ="wizard"; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .files_subpath. I22847; $l1Il1lL =&$adm->Core->GetModule("articles"); $adm->Gui->addGlobalVars(Array("NO_ARTICLES_CATS"=>"0")); if(!$l1Il1lL->GetOption("multicat")){ $adm->Gui->addGlobalVars(Array(I22848=>"1")); }$I1LIIlL =($l1Il1lL->GetOption("archive_type")=="manual"); if($I1LIIlL){ $adm->Gui->addGlobalVars(Array("ARTICLES_MANUAL_ARCHIVE"=>I22849)); }$adm->InitMessages($adm->Gui->ParseLangFile("templates/lang/_articles_msgs.lng")); $cid =intval($adm->Vars["cat_id"]); if($adm->Vars["action"] == "add") {$announce =$adm->VarsPost[I22850]; $udate =DateTools::getCorrectUDate($adm->VarsPost["date"], $adm->DFMT["conf"]); $date =date($adm->DFMT["php"], $udate); $cat =intval($adm->VarsPost["category"]); $author =$adm->VarsPost[I22851]; $source =$adm->VarsPost["source"]; $body =$adm->VarsPost["body"]; $I1LIlII =$adm->VarsPost["header"]; $public =$adm->VarsPost["public"]; $archive =intval($adm->VarsPost[I22852]); $catname =$adm->VarsPost["catname"]; if(!empty($catname)) {$sql ="SELECT id FROM cms_articles_cat WHERE name='".$catname."'"; $db->query($sql); $db->next_record(); $cat =$db->Record["id"]; if(empty($cat)) {$asql =Array( I22853=>$catname, "public"=>1, I22850=>"", "body"=>"", I22854=>$lang_data );$sql =$db->GenInsertSQL("cms_articles_cat", $asql); $db->query($sql); $cat =$db->lastInsertId(); }}if(!empty($announce) && !empty($I1LIlII)) {$asql =Array( "id_cat"=>$cat, "date"=>DateTools::toMysqlDate($udate), I22850=>$announce, "body"=>$body, I22851=>$author, I22855=>$source, I22854=>$lang_data, "header"=>$I1LIlII, "public"=>$public, I22852=>$archive );$sql =$db->GenInsertSQL("cms_articles", $asql); $db->query($sql); $lid =$db->lastInsertId(); if($cid>0) {$cid =$cat; }$applied_id =$lid; $adm->AddStatusMsg("status_add"); }else{ $adm->AddStatusMsg(I22856, "red"); }}if(isset($adm->Vars["id"]) && $adm->Vars["id"]>0 && $adm->Vars["action"] == I22857 ){$announce =$adm->VarsPost[I22850]; $udate =DateTools::getCorrectUDate($adm->VarsPost["date"], $adm->DFMT["conf"]); $date =date($adm->DFMT["php"], $udate); $cat =intval($adm->VarsPost["category"]); $body =$adm->VarsPost[I22858]; $I1LIlII =$adm->VarsPost["header"]; $public =$adm->VarsPost["public"]; $archive =intval($adm->VarsPost[I22852]); $catname =$adm->VarsPost["catname"]; if(!empty($catname)) {$sql ="SELECT id FROM cms_articles_cat WHERE name='".$catname.I22859; $db->query($sql); $db->next_record(); $cat =$db->Record["id"]; if(empty($cat)) {$asql =Array( I22853=>$catname, "public"=>1, I22850=>"", I22858=>"", I22854=>$lang_data );$sql =$db->GenInsertSQL(I22860, $asql); $db->query($sql); $cat =$db->lastInsertId(); }}if(!empty($announce) && !empty($I1LIlII)) {$asql =Array( "date"=>DateTools::toMysqlDate($udate), I22850=>$announce, I22858=>$body, I22851=>$author, I22855=>$source, I22854=>$lang_data, "header"=>$I1LIlII, "public"=>intval($public), );if($l1Il1lL->GetOption("multicat")){ $asql[I22861]=$cat; }if($I1LIIlL) {$asql[I22852]=$archive; }if($cid>0) {$cid =$cat; }$sql =$db->GenUpdateSQL("cms_articles", $asql, "WHERE id='".$adm->Vars["id"].I22859); $db->query($sql); $applied_id =$adm->Vars["id"]; $adm->AddStatusMsg(I22862); }else{ $adm->AddStatusMsg("status_apply_fail", "red"); }unset($adm->Vars["id"]); }if(isset($adm->Vars["id"]) && $adm->Vars[I22863]>0 && $adm->Vars["action"] == "del") {$sql ="DELETE FROM cms_articles WHERE id='".$adm->Vars[I22863].I22859; $db->query($sql); $adm->AddStatusMsg("status_del"); unset($adm->Vars[I22863]); }if(isset($adm->Vars[I22863]) && $adm->Vars[I22863]>0 && $adm->Vars[I22864] == "publish") {$public="0"; if (isset($adm->VarsGet["publish"]) && $adm->VarsGet["publish"] == I22865) $public=I22849; $sql ="UPDATE cms_articles SET public='".intval($public)."' WHERE id='".$adm->Vars[I22863].I22859; $db->query($sql); $applied_id =$adm->Vars[I22863]; $adm->AddStatusMsg("status_publish"); unset($adm->Vars[I22863]); }if(isset($adm->Vars[I22863]) && $adm->Vars[I22863]>0 && $adm->Vars[I22864] == I22852 && $I1LIIlL) {$archive="0"; if (isset($adm->VarsGet[I22866]) && $adm->VarsGet[I22866] == I22865) $archive=I22849; $sql ="UPDATE cms_articles SET archive='".intval($archive)."' WHERE id='".$adm->Vars[I22863].I22859; $db->query($sql); $applied_id =$adm->Vars[I22863]; $adm->AddStatusMsg("status_archive"); unset($adm->Vars[I22863]); }$form["date"] =date($adm->DFMT[I22867]); $form[I22857] ="disabled"; $form[I22864] ="add"; $form["public"] ="checked"; $form[I22868] ="selected"; if(isset($adm->Vars[I22863]) && $adm->Vars[I22864] == "edit" && $adm->Vars[I22863]>0) {$sql ="SELECT *, DATE_FORMAT(date,'".$adm->DFMT["db"]."') AS fdate FROM cms_articles ". "WHERE id='".$adm->Vars[I22863]."' AND lang='$lang_data'"; $db->query($sql); if($db->next_record()) {$form[I22863] =$db->Record[I22863]; $form["public"] =""; $form["date"] =$db->Record[I22869]; if($db->Record["public"] == 1) $form["public"] ="checked"; $form[I22851] =$db->Record[I22851]; $form[I22855] =$db->Record[I22855]; $form["header"] =$db->Record[I22870]; $form[I22850] =$adm->htmlchars($db->Record[I22850]); $form[I22858] =$adm->htmlchars($db->Record[I22858]); if($I1LIIlL) {$form[I22852] =($db->Record[I22852]==I22849) ?"checked" :""; }$form["add"] ="disabled"; $form[I22864] =I22857; $form[I22857] =I22871; $l1LlL1l =$db->Record[I22861]; }}$adm->Gui->addBlock("articles_list","templates/articles_list.tpl"); $adm->Gui->addBlock("articles_form","templates/form.tpl"); $adm->Gui->addBlock(I22872, "templates/articles_form.tpl"); if($l1Il1lL->GetOption("multicat")){ $l1Il1l1 =&$adm->Core->GetModule("articles_cat"); $l1Il1l1->PushPager($adm->Pager); $l1Il1l1->InitPager($adm->Pager); $sql ="SELECT id, name FROM cms_articles_cat WHERE lang='$lang_data' order by ".$adm->Pager->TI1TTlT(I22853); $db->query($sql); $aCats =$adm->Filter->TITIl11($db, I22863, I22853, 35); $aCats =$adm->Filter->TITI1TT($aCats, Array($adm->Words["all"]=>0), 35); $adm->Filter->AddField(I22873, "select", $cid, I22871, "=", I22861, $aCats); $adm->Filter->MoveField(I22873, _MOVE_START); if($db->num_rows() >0) $db->seek(); while($db->next_record()) {$cat_form =Array(); $cat_form[I22863] =$db->Record[I22863]; $cat_form[I22853] =$adm->stripLine($db->Record[I22853], 35); $cat_form["selected"] =($cat_form[I22863]==$l1LlL1l || (empty($l1LlL1l) && $cat_form[I22863]==$cid)) ?"selected" :I22871; $form[I22874] .= $adm->Gui->get("articles_subform:category_row", $cat_form); }$l1LlL1L["cat_list"] =$adm->Gui->get("articles_list:categories_list",$l1LlL11); $l1Il1l1->PopPager($adm->Pager); $l1Il1l1->TTlITlT(); }$l1LlL1L =$adm->TTITI1T("articles_list"); if(isset($applied_id) && $applied_id>0){ $result =DateTools::TT1lI11($udate, $adm->Vars[I22875], $adm->Vars["udateto"]); if($result !== false){ $adm->Vars["datefrom"] =date($adm->DFMT[I22867], $adm->Vars[I22875]); $adm->Vars["dateto"] =date($adm->DFMT[I22867], $adm->Vars["udateto"]); $adm->Filter->UpdateField(I22876, $adm->Vars[I22875]); $adm->Filter->UpdateField("dateto", $adm->Vars["udateto"]); }}if($cid==0) $adm->Filter->DisableFieldSQL(I22873); $filter ="WHERE 1 "; $filter .="AND ar.lang='$lang_data' ".$adm->Filter->GetFilterSql(); $filter .= "ORDER BY ".$adm->Pager->TI1TTlT(I22877).", date desc, id desc "; $sql ="SELECT ar.id, ar.public, ac.name as cname, ar.announce ". "from cms_articles as ar ". "left join cms_articles_cat as ac on ac.id=ar.id_cat ". "$filter"; $db->query($sql); $adm->Pager->MaxCount =$db->num_rows(); if(isset($applied_id) && $applied_id>0){ $adm->Pager->Position =$adm->Pager->TI1TT1l($db, I22863, $applied_id); }$adm->Pager->TI1TT1I(); $adm->Filter->UpdateField(I22878, $adm->Pager->Position); $lll1lII =$adm->Pager->GetPager(); $pager =$adm->Pager->GetPagerHtml( $lll1lII, "javascript:go_page('[START]');" );if($adm->Pager->MaxCount>0){ $sql ="SELECT ar.id as id, ar.public as public, header, ar.announce as announce, date_format(date,'".$adm->DFMT["db"]."') as fdate, ". (($I1LIIlL) ?I22879 :"(archive or (date < '".DateTools::toMysqlDate(strtotime($l1Il1lL->GetOption("archive_period")))."'))as archive,"). "ac.name as cname ". "from cms_articles as ar ". "left join cms_articles_cat as ac on ac.id=ar.id_cat ". "$filter ".$adm->Pager->TI1TTlI(); $db->query($sql); $i=1; while($db->next_record()) {$lid =$db->Record[I22863]; $l1Ll1II[I22877] =$db->Record[I22869]; $l1Ll1II["cname"] =$adm->stripLine($db->Record["cname"], 35); $l1Ll1II[I22851] =$adm->stripLine($db->Record[I22851], 35); $l1Ll1II[I22855] =$adm->stripLine($db->Record[I22855], 35); $l1Ll1II[I22870] =$adm->stripLine($db->Record[I22870], 35); $l1Ll1II[I22850] =$adm->stripLine(strip_tags($db->Record[I22850]), 145); $links["del_id"] =$links[I22880] =$links["pub_id"] =$links["arch_id"] =$lid; if($db->Record["public"] == 1) $l1Ll1II["public"] =$adm->Gui->get("articles_list:public_on",$links); else $l1Ll1II["public"] =$adm->Gui->get("articles_list:public_off",$links); if($db->Record[I22852] == 1) $l1Ll1II[I22852] =($I1LIIlL) ?$adm->Gui->get("articles_list:archive_on",$links): $adm->Gui->getAbs("articles_list:icon_archive_on",I22871); else $l1Ll1II[I22852] =($I1LIIlL) ?$adm->Gui->get("articles_list:archive_off",$links): $adm->Gui->getAbs("articles_list:icon_archive_off",I22871); $style ="row2"; if($i%2) $style="row1"; if($adm->Vars[I22863]>0 && $adm->Vars[I22863] == $lid) $style ="row3"; if($lid == $applied_id) $style =I22881; $actions =$adm->Gui->get("articles_list:icons_edit_del",$links); $l1Ll1II["actions"] =$actions; $l1Ll1II["style"] =$style; $l1LlL1L["articles_list"] .= $adm->Gui->get(I22882,$l1Ll1II); $i++; }$l1LlL1L["legend"] .= $adm->Gui->getAbs("articles_list:published",I22871); $l1LlL1L["legend"] .= $adm->Gui->getAbs("articles_list:notpublished",I22871); $l1LlL1L[I22883] .= $adm->Gui->getAbs("articles_list:onarchive",I22871); $l1LlL1L[I22883] .= $adm->Gui->getAbs("articles_list:notarchive",I22871); $l1LlL1L[I22883] .= $adm->Gui->getAbs("articles_list:leg_yellow",I22871); $l1LlL1L[I22883] .= $adm->Gui->getAbs("articles_list:leg_blue",I22871); $l1LlL1L[I22883] .= $adm->Gui->getAbs("articles_list:leg_edit",I22871); $l1LlL1L[I22883] .= $adm->Gui->getAbs("articles_list:leg_del",I22871); $l1LlL1L["pager"] =$pager; $html["list_table"] =$adm->Gui->get("articles_list",$l1LlL1L); }else {$html[I22884] =$adm->Gui->get("articles_list:empty",$l1LlL1L); $html[I22884] .= $adm->Gui->getAbs("spacer",I22871); }$html[I22884] .=$adm->Gui->getAbs("spacer",I22871); $form["cid"] =$cid; $form["filter_hidden_fields"] =$adm->Filter->GetFieldsAsHidden(); if($form["add"] != "disabled") {$l1LlL1L =$adm->Gui->get(I22872, $form); $html["form"] =$adm->Gui->getAbs("articles_form",Array(I22870=>$adm->Words[I22885],"content"=>$l1LlL1L,"form_align"=>"align=center")); }else {if($form[I22864] == I22857) {$form["cancel"] =$adm->Gui->getAbs("articles_subform:cancel", I22871); }$l1LlL1L =$adm->Gui->get(I22872, $form); $html["form"] =$adm->Gui->getAbs("articles_form",Array(I22870=>$adm->Words["articles_apply"],"content"=>$l1LlL1L,I22886=>"align=center")); }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; ?>