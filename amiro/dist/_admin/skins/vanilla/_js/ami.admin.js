var currentParentWindow=window;var currentActiveWindow=window;var _cms_log_form_changes=false;var _cms_form_init_manual_start=false;bIsIE=document.swapNode;if(AMI.$.browser.msie&&AMI.$.browser.version<=7){var tableShowStyle="block";var tableRowShowStyle="block";var tableCellShowStyle="block"}else{var tableShowStyle="table";var tableRowShowStyle="table-row";var tableCellShowStyle="table_cell"}var cmD_NONE=0;var cmD_TMP=1;var cmD_IMG=2;var cmD_STB=4;var cmD_CSS=8;var cmF_FULL_URLS=16;var delayOnScroll=300;var ceOnResize;var helpOnResize;var poopupOnResize;var helpOnScroll;var poopupOnScroll;var timeoutOnScroll;var globalPopupMove=false;var globalPopupOffsetX=0;var globalPopupOffsetY=0;var submenuOwner;var _cms_track_form_changes=true;var oCurrentRow;var globalCookieData;var errFunc;var aFormChangedHandlers=new Array();var lastSelectdTabName="";var dont_show_request_progress=0;Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};function setRuntimeStyle(c,b,a){if(c!=null){if(c.runtimeStyle){c.runtimeStyle[b]=a}else{if(typeof(c.runtimeStyles)=="undefined"){c.backupStyles=new Object();c.runtimeStyles=new Object()}if(a!=""){if(!c.runtimeStyles[b]||c.runtimeStyles[b]==""){c.backupStyles[b]=c.style[b]}c.runtimeStyles[b]=a;c.style[b]=a}else{if(c.runtimeStyles&&c.runtimeStyles[b]!=""){if(typeof(c.backupStyles[b])!="undefined"){c.style[b]=c.backupStyles[b];c.backupStyles[b]=""}c.runtimeStyles[b]=""}}}}}function getRuntimeStyle(c,b){if(c.runtimeStyle){return c.runtimeStyle[b]}else{if(c.runtimeStyles){if(b=="_count"){var a=0;for(styleNameVar in c.runtimeStyles){if(c.runtimeStyles[styleNameVar]!=""){a++}}return a}else{if(c.runtimeStyles[b]){return c.runtimeStyles[b]}}}}return""}function clearRuntimeStyle(a){if(a.runtimeStyle){a.runtimeStyle.cssText=""}else{if(a.backupStyles){for(styleName in a.backupStyles){a.style[styleName]=a.backupStyles[styleName]}a.backupStyles=new Object()}if(a.runtimeStyles){a.runtimeStyles=new Object()}}}function getSrcElement(a){return a.srcElement?a.srcElement:a.target}function fireEvent2(c,b,a){var d=document;if(typeof(a)!="undefined"){d=a}if(document.createEventObject){var f=d.createEventObject();c.fireEvent("on"+b,f)}else{if(document.createEvent){var f=d.createEvent("HTMLEvents");f.initEvent(b,false,false);c.dispatchEvent(f)}else{return false}}}function textareaFindAndSelect(b,c,g){if(typeof(b.selectionStart)!="undefined"){objValue=b.value;if(g){aValueStrings=objValue.split("\n");var k=false;var l=0;var a=0;var f=0;var h=0;for(i=0;i<aValueStrings.length;i++){h=Math.max(h,aValueStrings[i].length);if(!k){if((a=aValueStrings[i].indexOf(c))>=0){l+=a;f++;k=true}else{f++;l+=aValueStrings[i].length+1}}}if(k){b.selectionStart=l;b.selectionEnd=l+c.length;b.scrollLeft=Math.max(0,parseInt(b.scrollWidth*a/h)-30);b.scrollTop=Math.max(0,parseInt(b.scrollHeight*f/aValueStrings.length)-30);b.focus()}}else{if((l=objValue.indexOf(c))>=0){b.selectionStart=l;b.selectionEnd=l+c.length;b.focus()}}}else{if(b.createTextRange){var d=b.createTextRange();if(d.findText(c)){d.select()}}}}function makeElementVisible(c,a){if(c!=null){if(a=="none"){c.style.display="none"}else{if(a=="block"){var b=c.tagName.toLowerCase();if(b=="table"){c.style.display=tableShowStyle}else{if(b=="tr"){c.style.display=tableRowShowStyle}else{if(b=="td"||b=="th"){c.style.display=tableCellShowStyle}else{c.style.display="block"}}}}else{c.style.display=a}}}}function getObjectsByName(c,a){if(bIsIE){var d=document.getElementsByTagName(c);var b=new Array();for(i=0;i<d.length;i++){if(d[i].getAttribute("name")==a){b.push(d[i])}}return b}else{return document.getElementsByName(a)}}function crossSwapNodesBeforeMove(c){var a=c.getElementsByTagName("input");for(var b=0;b<a.length;b++){if(a[b].type=="checkbox"){a[b].stateBeforeMove=a[b].checked}}}function crossSwapNodesAfterMove(c){var a=c.getElementsByTagName("input");for(var b=0;b<a.length;b++){if(a[b].type=="checkbox"&&a[b].stateBeforeMove){a[b].checked=a[b].stateBeforeMove}}}function crossSwapNodes(d,c){var b=d.parentNode;var a=c.nextSibling;crossSwapNodesBeforeMove(d);crossSwapNodesBeforeMove(c);b.insertBefore(c,d);b.insertBefore(d,a);crossSwapNodesAfterMove(d);crossSwapNodesAfterMove(c)}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b,d){if(typeof(d)!="number"){d=0}for(var c=d,a=this.length;c<a;c++){if(this[c]==b){return c}}return -1}}function _funcName(c){var a=c.toString();var b=/^function\s+([a-z0-9_A-Z]+)\s*\([\s\S]*$/;if(a.match(b)){return a.replace(b,"$1")}b=/^[\s\S]*errFunc\s*=\s*this\.([a-z0-9_A-Z]+)[\s\S]*$/;return"Class::"+a.replace(b,"$1")}function errorHandler(c,a,f){var l="";var m=errFunc;if(typeof(m)=="function"){var b=_funcName(m);while(b!="anonymous"){if(l.length>0){l+=" <- "}l+=b+"("+arrayToStr(m.arguments)+")";if(typeof(m.caller)!="function"){break}m=m.caller;b=_funcName(m)}}var k="   "+window.navigator.userAgent+"\n   "+editorBaseHref+"\n   "+cms_version+"\n   "+module_name+"\n   "+l+"\n   "+c+"\n   "+a+"\n   "+f;if(confirm(msgErrorReport.replace("_error_report_",k))){var h=new Image;var g=new Date();h.src="errorreport.php?useragent="+window.navigator.userAgent+"&domain="+editorBaseHref+"&cms_version="+cms_version+"&module_name="+module_name+"&trace="+encodeURIComponent(l)+"&msg="+c+"&url="+encodeURIComponent(a)+"&lno="+f+"&"+g.getSeconds()+""+g.getMilliseconds()}return true}if(typeof(safeCookie)=="undefined"){safeCookie=true}var topEvents=true;try{top.oAssistant=null}catch(e){topEvents=false}function BodyOnLoad(){errFunc=BodyOnLoad;if(document.getElementById("page_loading")){document.getElementById("page_loading").style.display="none"}if(document.getElementById("page_content")){document.getElementById("page_content").style.display="block"}if(typeof(PriceTableInit)=="function"){PriceTableInit()}if(typeof(InitForm)=="function"&&!_cms_form_init_manual_start){InitForm()}if(typeof(OnPMLoad)=="function"){OnPMLoad()}if(typeof(OnHelpLoad)=="function"){OnHelpLoad()}if(typeof(InitFormCustom)=="function"){InitFormCustom()}if(typeof(LocalBodyOnLoad)=="function"){LocalBodyOnLoad()}window.onresize=topWindowOnResize;window.onscroll=function(a){return function(){if(timeoutOnScroll){window.clearTimeout(timeoutOnScroll)}timeoutOnScroll=window.setTimeout(function(){topWindowOnScroll(a)},delayOnScroll)}};if(topEvents){window.document.body.onclick=topWindowOnClick;window.document.body.onkeypress=topWindowOnKeyPress;window.document.body.onkeydown=topWindowOnKeyDown;window.document.body.onmouseup=topWindowOnMouseUp;window.document.body.onmousemove=topWindowOnMouseMove;window.onunload=topWindowOnUnload}}function topWindowOnUnload(){errFunc=topWindowOnUnload;if(typeof(closeWord)=="function"){closeWord()}}function topWindowOnClick(a){a=amiCommon.getValidEvent(a);evtElement=amiCommon.getEventTarget(a);if(!AMI.$(evtElement).hasClass("submenu_area")){AMI.$("#submenu_block").hide()}}function topWindowOnMouseUp(a){errFunc=topWindowOnMouseUp;if(typeof(stopSmResize)=="function"){stopSmResize(a)}if(typeof(stopPopupMove)=="function"){stopPopupMove(a)}}function topWindowOnMouseMove(a){errFunc=topWindowOnMouseMove;if(typeof(smResize)=="function"){smResize(a)}if(typeof(popupMove)=="function"){popupMove(a)}}function topWindowOnResize(a){errFunc=topWindowOnResize;if(typeof(ceOnResize)=="function"){ceOnResize(a)}if(typeof(popupOnResize)=="function"){popupOnResize(a)}if(typeof(helpOnResize)=="function"){helpOnResize(a)}if(typeof(excelOnResize)=="function"){excelOnResize(a)}}function topWindowOnScroll(){errFunc=topWindowOnScroll;if(typeof(popupOnScroll)=="function"){popupOnScroll(evt)}if(typeof(helpOnScroll)=="function"){helpOnScroll(evt)}}function topWindowOnKeyPress(b,a){errFunc=topWindowOnKeyPress;if(typeof(a)!="undefined"){b=amiCommon.getValidEvent(b,a)}else{b=amiCommon.getValidEvent(b)}if(b.keyCode==27){if(typeof(top.helpIsOpen)=="function"&&top.helpIsOpen()){top.helpWindowClose();amiCommon.stopEvent(b);return}if(typeof(top.popupIsOpen)=="function"&&top.popupIsOpen()){top.popupClose();amiCommon.stopEvent(b);return}}}function topWindowOnKeyDown(b,a){errFunc=topWindowOnKeyDown;if(typeof(a)!="undefined"){b=amiCommon.getValidEvent(b,a)}else{b=amiCommon.getValidEvent(b)}if(b.ctrlKey&&b.keyCode==53){return false}}function getElementAttribute(a,c,b){errFunc=getElementAttribute;if(!a){return""}if((typeof(b)!="undefined")&&b){while(a.parentElement){value=a.getAttribute(c);if(typeof(value)!=undefined&&value>""){return value}a=a.parentElement}}else{return a.getAttribute(c)}}function InitForm(a){errFunc=InitForm;if(_cms_track_form_changes&&(typeof(_cms_document_form)=="string")&&(typeof(document.forms[_cms_document_form])!="undefined")){_cms_document_form_changed=false;_cms_log_form_changes=false;if(document.getElementById("stModified")){document.getElementById("stModified").style.display="none"}oForm=document.forms[_cms_document_form];if(typeof(a)=="undefined"){a=false}oForm.isReadOnly=a;oForm.onreset=OnResetForm;window.onbeforeunload=WindowOnUnload;var d="";var c=oForm.elements;for(var b=0;b<c.length;b++){if(c[b].tagName=="FIELDSET"||c[b].tagName=="BUTTON"){continue}if(getElementAttribute(c[b],"unselectable")=="on"){continue}if(getElementAttribute(c[b],"detectchanges")=="off"){continue}if(c[b].tagName=="INPUT"&&c[b].type=="hidden"&&getElementAttribute(c[b],"detectchanges")!="on"){continue}if(c[b].name&&c[b].name.substr(0,9)!="_spec_opt"){c[b].title="";clearRuntimeStyle(c[b]);if(oForm.isReadOnly){if(c[b].tagName=="INPUT"&&c[b].type=="checkbox"){c[b].onclick=function(){return false};c[b].oldValue=c[b].checked}else{c[b].onchange=function(){this.value=this.oldValue;return false};c[b].onkeydown=function(){return false};c[b].oldValue=c[b].value}}else{if(c[b].tagName=="INPUT"&&c[b].type=="checkbox"){c[b].onclick=FormChanged;c[b].oldValue=c[b].checked}else{if(!c[b].onchange){c[b].onchange=FormChanged}c[b].onkeydown=OnFieldKeyDown;c[b].onkeyup=function(f){OnFieldKeyUp(this,f)};c[b].oldValue=c[b].value}if(((c[b].tagName=="INPUT"&&c[b].type=="text")||c[b].tagName=="TEXTAREA")&&getElementAttribute(c[b],"prop")=="on"){showInputProperties(c[b]);c[b].onblur=function(){showInputProperties(this,true)};c[b].onkeyup=function(){showInputProperties(this)};c[b].onclick=function(){showInputProperties(this)}}}}}aTables=document.getElementsByTagName("TABLE");for(b=0;b<aTables.length;b++){if(aTables[b].className=="tabs"){aTables[b].onmouseover=function(f){tabOver(f,true)};aTables[b].onmouseout=function(f){tabOver(f,false)}}}if(oForm.apply){oForm.apply.disabled=oForm.isReadOnly}if(oForm.save){oForm.save.disabled=oForm.isReadOnly}_cms_log_form_changes=true}}function ResetFormChanges(){errFunc=ResetFormChanges;_cms_document_form_changed=false;_cms_log_form_changes=false;oForm=document.forms[_cms_document_form];if(document.getElementById("stModified")){document.getElementById("stModified").style.display="none"}var b=oForm.elements;for(var a=0;a<b.length;a++){if(b[a].tagName=="FIELDSET"||b[a].tagName=="BUTTON"){continue}if(getElementAttribute(b[a],"unselectable")=="on"){continue}if(b[a].tagName=="INPUT"&&b[a].type=="hidden"&&getElementAttribute(b[a],"detectchanges")!="on"){continue}if(b[a].name&&(b[a].name.substr(0,9)=="_spec_opt")){continue}if(b[a].tagName=="SELECT"||b[a].tagName=="INPUT"||b[a].tagName=="TEXTAREA"){clearRuntimeStyle(b[a]);b[a].oldValue="";b[a].title=""}}_cms_log_form_changes=true}function addFormChangedHandler(a){if(aFormChangedHandlers.indexOf(a)<0){aFormChangedHandlers.push(a)}}function FormChanged(m,b,d){errFunc=FormChanged;m=amiCommon.getValidEvent(m);if(b==undefined){b=false}if(d==undefined){d=false}else{if(document.forms[_cms_document_form].elements[d]){document.forms[_cms_document_form].elements[d].isModified=true}}if(!_cms_log_form_changes&&!b){return}var g=_cms_log_form_changes;var h=!_cms_document_form_changed;_cms_log_form_changes=false;if(d==false&&m){d=amiCommon.getEventTarget(m).name}var n=false;for(var f=0,c=aFormChangedHandlers.length;f<c;f++){n=n||!aFormChangedHandlers[f](d,h,m)}if(n){_cms_log_form_changes=g;return false}if(m&&!b){d=amiCommon.getEventTarget(m);if(d.tagName=="INPUT"&&d.type=="checkbox"){var a=(d.oldValue?"On":"Off");if(d.checked==d.oldValue){clearRuntimeStyle(d);a=""}else{}}else{var a=d.oldValue;if(d.value==d.oldValue){clearRuntimeStyle(d);a=""}else{if(d.tagName!="TEXTAREA"){setRuntimeStyle(d,"color","#990000")}}}if(d.tagName!="TEXTAREA"&&typeof(a)!="undefined"){d.title=a}}_cms_document_form_changed=true;var k=document.getElementById("stModified");if(k&&k.style.display=="none"){k.style.display="block"}if(h){blinkElement("stModified","display","none",200)}_cms_log_form_changes=g}function OnResetForm(){errFunc=OnResetForm;return false}function OnFieldKeyDown(a){errFunc=OnFieldKeyDown;a=amiCommon.getValidEvent(a);eventElement=amiCommon.getEventTarget(a);if(a.keyCode==27){if(eventElement.tagName=="INPUT"&&eventElement.type=="checkbox"){eventElement.checked=eventElement.oldValue;fireEvent2(eventElement,"change")}else{if(eventElement.value!=eventElement.oldValue){eventElement.value=eventElement.oldValue;fireEvent2(eventElement,"change");amiCommon.stopEvent(eventElement)}}clearRuntimeStyle(eventElement)}}function processRequest(){errFunc=processRequest;AMI.Cookie.save(true,true);if(dont_show_request_progress>0){dont_show_request_progress--;return}var a=new Array("submenu_block","favorites_block","calendar_block");for(var b=0;b<a.length;b++){var c=document.getElementById(a[b]);if(c!=null){c.style.display="none"}}popupWindow.closeAll();showProcessingDiv("request_processing")}function showProcessingDiv(h){if(document.getElementById("body_content")){var c=getx(document.getElementById("body_content"));var b=gety(document.getElementById("body_content"));var m=document.getElementById("processingRequestShadow");var d=document.getElementById("processingRequestShadowDiv");if(m==null||d==null){var m=document.createElement("IFRAME");m.className="processingRequestShadow";m.id="processingRequestShadow";m.style.left="0px";m.style.top=b+"px";m.style.width="100%";m.style.height=document.getElementById("body_content").offsetHeight+"px";m.src="about:blank";m.frameborder="no";m.scrolling="no";m.style.zIndex=100;m.setAttribute("frameborder","0");var l=document.body.appendChild(m);var m=document.createElement("DIV");m.className="processingRequestShadow";m.id="processingRequestShadowDiv";m.style.left="0px";m.style.top=b+"px";m.style.width="100%";m.style.height=document.getElementById("body_content").offsetHeight+"px";m.style.zIndex=100;var g=document.body.appendChild(m);amiCommon.setEventHandler("resize",window,function(n,o){return function(){n.style.height=document.getElementById("body_content").offsetHeight+"px";o.style.height=document.getElementById("body_content").offsetHeight+"px"}}(l,g))}else{m.style.display="block";d.style.display="block"}var k=document.getElementById(h);if(k!=null){var f=250;var a=90;k.style.left=c+(amiCommon.getDocumentClientWidth()-c-f)/2+"px";k.style.top=(amiCommon.getDocumentClientHeight()-a)/2+"px";k.style.zIndex=101;k.style.display="block"}}}function hideProcessingDiv(){if(document.getElementById("body_content")){AMI.$("#processingRequestShadow").hide();AMI.$("#processingRequestShadowDiv").hide();AMI.$("#request_processing").hide();AMI.$("#loading_module").hide()}}function processRequestStop(){var a=document.getElementById("request_processing");a.style.display="none";var b=document.getElementById("processingRequestShadow");if(b!=null){b.style.display="none"}b=document.getElementById("processingRequestShadowDiv");if(b!=null){b.style.display="none"}}function WindowOnUnload(){errFunc=WindowOnUnload;if(document.forms[_cms_document_form]&&typeof(_cms_document_form_changed_discrad_confirmation)=="undefined"){oForm=document.forms[_cms_document_form];if(_cms_document_form_changed==true){var a=AMI.Message.send("ON_PAGE_UNLOAD_FORM_CHANGED");if((typeof(a)=="string")&&a.length){return a}}}processRequest()}var _editor_images_url="skins/vanilla/images/";function up_menu_go(a){errFunc=up_menu_go;document.location="ModuleGo.php?mid="+a;return false}function SwitchFileControls(b,a){errFunc=SwitchFileControls;if(a){b.ffilename.disabled=true;b.npicposition.disabled=true}else{b.ffilename.disabled=false;b.npicposition.disabled=false}return true}function collect_link(f,b,d,a){errFunc=collect_link;var k="",h=1,g="";if(typeof(b)=="undefined"){b=false}if(typeof(a)=="undefined"){a=""}if(a!=""){k=a;h=0}for(var c=0;c<f.length;c++){el=f.elements[c];if(getElementAttribute(el,"collect_link_ignore")!=1){if(el.type=="hidden"&&el.id!="_ce_special_hidden_field"&&el.id.substr(0,5)!="lay_f"){delim=(h)?"":"&";if(getElementAttribute(el,"enc_type",false)!="encoded"){k+=delim+el.name+"="+encodeURIComponent(el.value)}else{if(el.name.substr(0,4)=="enc_"){k+=delim+el.name.substr(4)+"="+el.value}}h=0}else{if(b){if(!el.disabled){value="";out=false;switch(el.type){case"checkbox":case"radio":if(el.checked){value=el.value;out=true}break;case"select-one":case"text":value=el.value;out=true;break}if(out){delim=(h)?"":"&";h=0;k=k+delim+el.name+"="+encodeURIComponent(value)}}}}}}if((typeof(module60compatible)!="undefined")&&module60compatible){g=document.location.hash}else{if(typeof(d)!="undefined"){g=d}}k+=a+g;return k}function get_user_click_link(c,a,d){errFunc=get_user_click_link;var b,l,g="#anchor";if(typeof(d)=="undefined"){d={}}if(typeof(_cms_document_form)!="undefined"&&AMI.countProperties(d)==0){b=document.forms[_cms_document_form]}else{b=document.createElement("FORM");var m=document.createElement("INPUT");m.type="hidden";m.name="id";b.appendChild(m);var h=document.createElement("INPUT");h.type="hidden";h.name="action";b.appendChild(h);for(var f in d){var k=document.createElement("INPUT");k.type="hidden";k.name=f;k.value=d[f];b.appendChild(k)}}l=(typeof(_cms_script_link)!="undefined")?_cms_script_link:(document.location.href+"?");if(c!="edit"&&c!="reply"&&c!="result"){g=""}b.action.value=c;b.id.value=a;return l+collect_link(b,false,g)}function user_click(c,d){errFunc=user_click;if(c=="none"&&typeof(_cms_document_form_changed)!="undefined"&&_cms_document_form_changed&&typeof(_cms_form_changed_alert)!="undefined"&&!confirm(_cms_form_changed_alert)){return false}var b=get_user_click_link(c,d);if((typeof(module60compatible)!="undefined")&&module60compatible){var a=document.forms[_cms_document_form];if((c==module50action)&&(d==currentElementId)){if(c!="copy"&&c!="grp_special_advanced"){if(typeof(a.scrollIntoView)!="undefined"){a.scrollIntoView(true);return false}}}}document.location.href=b;return false}function user_click_blank(c,d,b){errFunc=user_click_blank;if(typeof(b)=="undefined"){b={}}var a=get_user_click_link(c,d,b);window.open(a)}function go_page(c){errFunc=go_page;var a=document.forms[_cms_document_form];var b=_cms_script_link;a.action.value="rsrtme";a.offset.value=c;if(typeof(a.enc_offset)=="object"){a.enc_offset.value=c}document.location=b+collect_link(a);return false}function go_pagesize(b){errFunc=go_pagesize;var a=document.forms[_cms_document_form];var c=_cms_script_link;a.action.value="rsrtme";a.limit.value=b;if(typeof(a.enc_limit)=="object"){a.enc_limit.value=b}document.location=c+collect_link(a);return false}function resort(b,d){errFunc=resort;var a=document.forms[_cms_document_form];var c=_cms_script_link;a.action.value="rsrtme";a.sort.value=b;if(typeof(a.enc_sort)=="object"){a.enc_sort.value=b}a.sdim.value=d;if(typeof(a.enc_sdim)=="object"){a.enc_sdim.value=d}document.location=c+collect_link(a);return false}function publish(d,a){errFunc=publish;var b=document.forms[_cms_document_form];var c=_cms_script_link;b.action.value="publish";b.publish.value=a;b.id.value=d;document.location=c+collect_link(b);return false}function lock(d,a){errFunc=lock;var b=document.forms[_cms_document_form];var c=_cms_script_link;b.action.value="lock";b.lock.value=a;b.id.value=d;document.location=c+collect_link(b);return false}function activate(d,a){errFunc=activate;var b=document.forms[_cms_document_form];var c=_cms_script_link;b.action.value="activate";b.activate.value=a;b.id.value=d;document.location=c+collect_link(b);return false}function activate2(d,a){errFunc=activate2;var b=document.forms[_cms_document_form];var c=_cms_script_link;b.action.value="activate2";b.activate2.value=a;b.id.value=d;document.location=c+collect_link(b);return false}function archive(d,a){errFunc=archive;var b=document.forms[_cms_document_form];var c=_cms_script_link;b.action.value="archive";b.arch.value=a;b.id.value=d;document.location=c+collect_link(b);return false}function special(d,a){errFunc=special;var b=document.forms[_cms_document_form];var c=_cms_script_link;b.action.value="special_confirm";b.special.value=a;b.id.value=d;document.location=c+collect_link(b);return false}function getfiletype(c){errFunc=getfiletype;var a=1000;var b=c.substring(c.lastIndexOf(".")+1,c.length);switch(b.toLowerCase()){case"jpe":a=4;break;case"gif":a=4;break;case"jpg":a=4;break;case"bmp":a=4;break;case"tiff":a=4;break;case"png":a=4;break;case"swf":a=10;break;case"mov":a=5;break;case"avi":a=5;break;case"htm":a=9;break;case"html":a=9;break;case"wav":a=12;break;case"rm":a=13;break;case"mp3":a=14;break;case"doc":a=3;break;case"pdf":a=6;break;case"xls":a=8;break;case"txt":a=7;break;case"ppt":a=15;break;case"pps":a=15;break;case"zip":a=1;break;case"rar":a=1;break;case"ace":a=1;break;case"exe":a=2;break}return a}function setcheckbox(a,c,f){errFunc=setcheckbox;var d=false;for(var b=0;b<a.options.length;b++){if(a.options[b].value==c){a.options[b].selected=true;d=true}}if(!d&&typeof(f)!="undefined"){a.options[f].selected=true}}function show_picture(h,g,c,a,f){errFunc=show_picture;var d=40+parseInt(c);var b=100+parseInt(a);if(b>window.screen.availHeight){b=window.screen.availHeight}if(d>window.screen.availWidth){d=window.screen.availWidth}if(f){window.open(h,"pic","resizable=yes, status=yes, scrollbars=yes, width="+d+", height="+b)}else{h=encodeURIComponent(h);h=h.replace(/\//g,"%2F");window.open("show_pic.php?src="+h+"&alt="+g+"&width="+c+"&height="+a,"pic","resizable=yes, status=yes, scrollbars=yes, width="+d+", height="+b)}}function tabOver(a,c){a=amiCommon.getValidEvent(a);var b=amiCommon.getEventTarget(a);if(b.tagName=="TD"){if((b.className=="normal")){if(c){setRuntimeStyle(document.getElementById("tab_"+b.id.substr(4)+"_"),"backgroundColor","#FFB84B");setRuntimeStyle(document.getElementById("tab_"+b.id.substr(4)),"borderTop","0px")}else{clearRuntimeStyle(document.getElementById("tab_"+b.id.substr(4)+"_"));clearRuntimeStyle(document.getElementById("tab_"+b.id.substr(4)))}}}}function editor_setfocus(b,a){if(baseTabs){baseTabs.showTab(b)}if(alternativeEditors[b].currentMode=="editor"){alternativeEditors[b].editorObject.focus()}else{alternativeEditors[b].textareaObject.focus()}return true}function blinkElement(d,g,h,b,f){errFunc=blinkElement;if(document.getElementById(d)){if(typeof(f)=="undefined"){f=3}var a=b;var c=document.getElementById(d);for(i=0;i<f;i++){setTimeout(function(){setRuntimeStyle(c,g,h)},a);a+=b;setTimeout(function(){clearRuntimeStyle(c)},a);a+=b}}}function none(){errFunc=none}function Dialog(c,b,a){this.title=c;this.width=b;this.height=a;this.left=-1;this.top=-1;this.resizeable=false;this.forceWindow=false;this.durl="dialog.php?_cv="+cms_version+"&lang="+interface_lang;this.url=false;this.form=null;this.waitLoad=true;this.warnOnClose=false;this.altKeyAction="forceWindow";this.show=function(){errFunc=this.show;if(this.width==undefined||this.width<=0){this.width=Math.max(800,window.document.body.offsetWidth-40)}if(this.height==undefined||this.height<=0){this.height=Math.max(450,window.document.body.offsetHeight-40)}if(this.left==undefined||this.left<0){this.left=(window.document.body.clientWidth-this.width)/2}if(this.top==undefined||this.top<0){this.top=(window.document.body.clientHeight-this.height)/2}if(this.title==undefined){this.title=""}var f=new Object();f.oWindow=window.self;f.sURL=this.url;f.oForm=this.form;f.sTitle=this.title;f.bWarnOnClose=this.warnOnClose;f.bWaitLoad=this.waitLoad;var h=window.event&&window.event.altKey;var g=this.forceWindow;if(!g&&this.altKeyAction=="forceWindow"&&h){g=true}if(g){return window.open(this.url,"debug","resizable="+(this.resizeable?"yes":"no")+", location=yes, status=yes, scrollbars=yes, width="+this.width+", height="+this.height+", top="+this.top+", left="+this.left)}else{var d=this.durl;if(this.altKeyAction=="forceReload"&&h){d+="&nocache="+Math.random()}return window.showModalDialog(d,f,"dialogHeight: "+this.height+"px; dialogWidth: "+this.width+"px; dialogTop: "+this.top+"; dialogLeft: "+this.left+"px; edge: raised; center: yes; help: no; resizable: "+(this.resizeable?"yes":"no")+"; status: no; unadorned: yes; scroll: no;")}};this.showForm=function(d){errFunc=this.showForm;this.form=d;this.url=false;this.show()};this.showURL=function(d){errFunc=this.showURL;this.form=null;this.url=d;this.show()}}function openDialog(k,c,d,a,g,h,f,b){errFunc=openDialog;if(d==undefined||d<=0){d=Math.max(800,window.document.body.offsetWidth-40)}if(a==undefined||a<=0){a=Math.max(450,window.document.body.offsetHeight-40)}return top.popupWindow.open(f||window,c,k,d,a,false,b)}function openExtDialog(m,a,f,h,b,o,c,n,p,d,l,g,k){errFunc=openExtDialog;if(b==undefined||b<=0){b=window.document.body.offsetWidth-40}if(o==undefined||o<=0){o=window.document.body.offsetHeight-40}return top.popupWindow.open(window,a,m,b,o,d,l,g,k)}function ValidateCookieData(){errFunc=ValidateCookieData}function StoreCookieData(){errFunc=StoreCookieData}function GetExpireDate(d,a,b){errFunc=GetExpireDate;var c=new Date();if(typeof(d)=="undefined"&&typeof(a)=="undefined"){d=30}if(typeof(d)!="undefined"){c.setDate(c.getDate()+d)}if(typeof(a)!="undefined"){c.setHours(c.getHours()+a)}if(typeof(b)!="undefined"){c.setMinutes(c.getMinutes()+b)}return c}function set_cookie(g,k,f,h,a,b){errFunc=set_cookie;var d=GetExpireDate(h,a,b);var c="";if(typeof(f)!="undefined"&&f!=""){c="; path="+f}delCookie(g);if(k.length){document.cookie=g+"="+encodeURIComponent(k)+c+"; expires="+d.toGMTString()}}function setCookie(f,k,m,l,h,c){errFunc=setCookie;if(typeof(editorBaseHref)=="undefined"||!safeCookie){set_cookie(f,k,m,l,h,c)}else{var g=GetExpireDate(l,h,c);var a=Math.floor(g.getTime()/1000);var b=Math.round(new Date().getTime()/1000);var d=a-b;if(m==undefined){m="/"}AMI.Cookie.set(f,k,d,m)}}function del_cookie(a){errFunc=del_cookie;sValue=getCookie(a);if(sValue!=null){document.cookie=a+"="+encodeURIComponent(sValue)+"; expires=Fri, 31 Dec 1999 23:59:59 GMT;"}}function delCookie(b,a){errFunc=delCookie;if(typeof(editorBaseHref)=="undefined"||!safeCookie){del_cookie(b)}else{AMI.Cookie.del(b)}}function get_cookie(f){errFunc=get_cookie;var b=document.cookie.split("; ");var d="";for(var c=0;c<b.length;c++){var a=b[c].split("=");if(f==a[0]){if(typeof(a[1])=="undefined"){d=null}else{d=decodeURIComponent(a[1])}return d}}return null}function getCookie(a){errFunc=getCookie;if(typeof(editorBaseHref)=="undefined"||!safeCookie){return get_cookie(a)}else{return AMI.Cookie.get(a)}}function syncWithSelect(b,f,a){errFunc=syncWithSelect;b=amiCommon.getValidEvent(b);if(typeof(f)=="object"&&f.options.length>0){if(b.keyCode>=37&&b.keyCode<=40){return}f.disabled=true;if(typeof(document.getElementById("select_page"))=="object"&&document.getElementById("select_page")!=null){var h=document.getElementById("select_page");makeElementVisible(h,"block")}var d=a.value.length;if(bIsIE&&d>0){for(var c=0;c<f.options.length;c++){if(f.options[c].text.substring(0,d)==a.value){f.options[c].selected=1;a.value=f.options[c].innerText;var g=a.createTextRange();if(d<f.options[c].innerText.length){g.findText(f.options[c].innerText.substring(d,f.options[c].innerText.length));g.select()}return}}}else{f.disabled=false}}}function addParameterToUrl(c,a,d){errFunc=addParameterToUrl;var b="?";if(c.indexOf("?")>0){b="&"}c=c+b+a+"="+d;return c}function getx(a){errFunc=getx;x=0;do{x+=a.offsetLeft}while((a=a.offsetParent)!=null);return x}function gety(a){errFunc=gety;y=0;do{y+=a.offsetTop}while((a=a.offsetParent)!=null);return y}function checkMoneyValue(d,a){errFunc=checkMoneyValue;var c;var b;c=d.replace(/^\+| /g,"").replace(/,/,".");if(c.length==0){b=false}else{b=!isNaN(1*c)}if(b&&a){b=((1*c)>=0)}return b}function formatMoney(a){a=formatNumber(a);if(typeof(currencyPrefix)!="undefined"&&currencyPrefix!=""){a=currencyPrefix+" "+a}if(typeof(currencyPostfix)!="undefined"&&currencyPostfix!=""){a=a+" "+currencyPostfix}return a}function formatNumber(g){var c,b,d,f,a;if(typeof(numberDecimals)=="undefined"){numberDecimals=2}if(isNaN(numberDecimals=Math.abs(numberDecimals))){numberDecimals=2}if(typeof(decimalPoint)=="undefined"){decimalPoint="."}if(typeof(thousandsSeparator)=="undefined"){thousandsSeparator=","}c=parseInt(g=(+g||0).toFixed(numberDecimals))+"";if((b=c.length)>3){b=b%3}else{b=0}d=(b?c.substr(0,b)+thousandsSeparator:"");f=c.substr(b).replace(/(\d{3})(?=\d)/g,"$1"+thousandsSeparator);a=(numberDecimals?decimalPoint+Math.abs(g-c).toFixed(numberDecimals).replace(/-/,0).slice(2):"");return d+f+a}function tree_reload(){errFunc=tree_reload;if(_cms_document_form_changed){if(!confirm(_cms_form_changed_alert)){return}}document.getElementById("status-msgs").innerHTML="";document.getElementById("status-block").style.display="none";treeframe.location.reload();document.getElementById("sm_tool_bar").style.display="none";document.getElementById("loading_msg").style.display="block";enableForm(false)}function extRound(b,a){errFunc=extRound;return(Math.round(b*Math.pow(10,a))/Math.pow(10,a))}function showInputProperties(a,b){errFunc=showInputProperties;if(!document.getElementById(a.name+"_prop")){return}if(typeof(b)=="undefined"){b=false}sMsg=a.value.length;cursorPos=-1;if(!b&&a.offsetHeight>0){if(typeof(a.selectionStart)=="number"){cursorPos=a.selectionStart}else{if(document.selection){if(document.selection.type!="Control"){selRange=document.selection.createRange();objRange=a.createTextRange();if(objRange.inRange(selRange)){selRange.setEndPoint("StartToStart",objRange);cursorPos=selRange.text.length}}}}}if(cursorPos>=0&&a.name!="html_keywords"&&a.name!="html_description"){sColor="#00a000";if(cursorPos>60){sColor="#e02000"}else{if(cursorPos>30){sColor="#DBA02D"}}sMsg='<font color="'+sColor+'">'+cursorPos+"</font>:"+a.value.length}document.getElementById(a.name+"_prop").innerHTML=sMsg}function isEmail(a){errFunc=isEmail;if(a.search(/^(\w+[\w.-]*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+(;|,|$))+$/)!=-1){return true}else{return false}}function fromHTMLToText(a){a=a.replace(/<\/?[\w][^>]*?>/g,"");return a}function isClickableTag(a){var b=["TD","DIV","HEADER","NAV","FOOTER","ARTICLE","ASIDE","SECTION"];return !(b.indexOf(a)<0)}function prepareLayoutHTML(g){errFunc=prepareLayoutHTML;var l=g;var d=l.getElementsByTagName("*");for(var c=d.length-1;c>=0;c--){var h=["CENTER","DIV","SPAN","TABLE","TBODY","TH","TD","TR","INPUT"];var a=["HEADER","NAV","FOOTER","ARTICLE","ASIDE","SECTION"];if(typeof(d[c])!="undefined"){if((h.indexOf(d[c].tagName)<0)&&(a.indexOf(d[c].tagName)<0)&&d[c].className!="block_check"){d[c].parentNode.removeChild(d[c])}else{if((d[c].className!="block_check")&&(d[c].innerHTML=="")){d[c].parentNode.removeChild(d[c])}else{if(d[c].id.substr(0,4)=="lay_"){d[c].style.cssText="padding:3px 5px;margin:0px;"}else{d[c].style.cssText="padding:0px;margin:0px;"}}}}}var k=l.getElementsByTagName("TABLE");for(var c=0;c<k.length;c++){if(k[c].getAttribute("width")!=null&&parseInt(k[c].getAttribute("width"))>0&&k[c].getAttribute("width").search("%")<0){k[c].setAttribute("width","100%")}if(k[c].getAttribute("width")!=null&&parseInt(k[c].getAttribute("height"))>0&&k[c].getAttribute("height").search("%")<0){k[c].setAttribute("height","100%")}k[c].removeAttribute("bgcolor","");k[c].removeAttribute("background","");k[c].cellSpacing=0;k[c].cellPadding=0}for(elemI=0;elemI<2;elemI++){var m=(elemI==0?l.getElementsByTagName("TD"):l.getElementsByTagName("DIV"));for(var c=0;c<m.length;c++){m[c].modified=false;var b=m[c].getAttribute("width");var f=m[c].getAttribute("height");if(b==null||parseInt(b)>0&&b.search("%")<0){m[c].removeAttribute("width")}if(f==null||parseInt(f)>0&&f.search("%")<0){m[c].removeAttribute("height")}m[c].removeAttribute("bgcolor","");m[c].removeAttribute("background","");if(m[c].id=="lay_body"){if(m[c].tagName=="TD"){m[c].setAttribute("width","100%")}m[c].removeAttribute("align");m[c].removeAttribute("valign")}else{if(m[c].tagName=="TD"){m[c].setAttribute("align","left");m[c].setAttribute("valign","top");m[c].valign="top"}m[c].style.textAlign="left"}}}}function highLightRow(a,c){errFunc=highLightRow;if(a.tagName=="TR"){var b=a.getElementsByTagName("TD");for(i=0;i<b.length;i++){if(c==1){b[i].bgColor="#DDF8E4"}else{b[i].bgColor=""}}}if(c==1){oCurrentRow=a}else{}}function updateCurrentRow(){errFunc=updateCurrentRow;if(oCurrentRow!=null&&oCurrentRow.tagName=="TR"){highLightRow(oCurrentRow,1)}}function grpRowChangeItem(c,b){b=b?b:window.event;errFunc=grpRowChangeItem;if(getSrcElement(b).tagName&&getSrcElement(b).tagName=="TD"&&typeof(grpChangeItem)=="function"){var a=document.forms[_cms_group_operations_form];a.elements["group_id_"+c].checked=!a.elements["group_id_"+c].checked;grpChangeItem(c);if(!a.elements["group_id_"+c].checked){updateCurrentRow()}}}function changePath(c){errFunc=changePath;var a=document.forms[_cms_document_form];var b=_cms_script_link;if(typeof(a.original_sublink)!="undefined"){a.original_sublink.value=""}if(typeof(a.original_html_keywords)!="undefined"){a.original_html_keywords.value=""}if(typeof(a.original_html_description)!="undefined"){a.original_html_description.value=""}a.action.value="";document.location=b+collect_link(a)+"&cat_id="+c;return false}function OnFieldKeyUp(c,a){a=amiCommon.getValidEvent(a);errFunc=OnFieldKeyUp;var b=true;if(typeof(OnObjectKeyUp)=="function"){if(a){b=OnObjectKeyUp(c,a)}return b}}function clearHTMLFields(a){errFunc=clearHTMLFields;a.html_title.value="";fireEvent2(a.html_title,"change");showInputProperties(a.html_title,true);a.html_keywords.value="";fireEvent2(a.html_keywords,"change");showInputProperties(a.html_keywords,true);a.html_description.value="";fireEvent2(a.html_description,"onchange");showInputProperties(a.html_description,true)}function translit(a){return a}function arrayToStr(b){if(b==null){return""}var a="";if(b.length){for(i=0;i<b.length;i++){if(a.length>0){a+=", "}a+="'"+b[i]+"'"}}return a}function showPicture(c,b,d){if(b.length>0){c=amiCommon.getValidEvent(c);var a=amiCommon.getMousePosition(c);if(document.getElementById("img_preview_block")==null){var f=document.createElement("IMG");f.id="img_preview_block";f.className="img_preview";f.style.zIndex="1";f=document.body.insertBefore(f,document.body.firstChild)}document.getElementById("img_preview_block").style.top=a[1]-40+"px";document.getElementById("img_preview_block").style.left=a[0]+30+"px";if(d){document.getElementById("img_preview_block").src=editorBaseHref+b;document.getElementById("img_preview_block").style.display="block"}else{document.getElementById("img_preview_block").src="skins/vanilla/images/empty.gif";document.getElementById("img_preview_block").style.display="none"}}}function getSubmenuItemsHtml(f){var d,c={},b,g="",h,k,a=aAllModData[f];if(a instanceof Object&&a.items instanceof Object){for(d in a.items){k=a.items[d].parentId;if(k&&-1!==aMainModules.indexOf(k)){if("undefined"===typeof c[k]){c[k]=1}else{c[k]++}}}for(d in a.items){h=(-1!==aMainModules.indexOf(d));g+=getSubmenuItemHtml(d,a.items[d],h,a.caption);if(h){if("string"!==typeof a.items[d].caption){a.items[d].caption=""}b=a.items[d].caption.split(":").shift().trim();if("undefined"!==typeof c[d]){g+=getSubmenuItemHtml(d,a.items[d],false)}}}}return g}function getSubmenuItemHtml(l,b,k,g){var h,d,c,f,a;if((typeof(b.link)=="undefined")||!b.link.length){return""}if("string"!==typeof b.caption){b.caption=""}if(k){d=b.caption.split(":").shift().trim();if(g===d){d=b.caption.split(":").pop().trim()}h="menu-item";a=amiCommon.getModResourceURL("mod_icon",{modId:l,locale:interface_lang})}else{d=b.caption.split(":").pop().trim();h="menu-subitem"}if((typeof(b.disabled)!="undefined")&&b.disabled){h+=" disabled"}if(l.indexOf("plugin")===0){h+=" disabled"}if((typeof(b.title)!="undefined")){f=' title="'+b.title+'"'}c='<tr class="submenu_'+l+'" '+f+'><td class="'+h+'"><a href="'+b.link+'" onclick="window.top.hideSubMenu()" target="_top">'+d+"</a></td></tr>\n";return c}function rollDownSubmenu(a){var b=parseInt(top.document.getElementById("resultTable").offsetHeight);if((a<b)&&(parseInt(top.document.getElementById("submenu_block").style.top)+a+60<top.getScrollTop()+parseInt(top.document.body.clientHeight))){a+=30;top.document.getElementById("submenu_block").style.height=a+2+"px";window.setTimeout(function(){rollDownSubmenu(a)},10)}else{document.getElementById("links").style.height=a+"px"}}function initSubmenu(){var a=Math.min(115,parseInt(document.getElementById("resultTable").offsetHeight));if(a<parseInt(top.document.getElementById("submenu_block").style.height)){top.document.getElementById("submenu_block").style.height=parseInt(top.document.getElementById("resultTable").offsetHeight)+2+"px"}else{top.document.getElementById("links").style.overflow="auto";rollDownSubmenu(a)}setTimeout(function(){var d,b,c;if(top.module_name!="start"&&aAllModData[submenuOwner]&&aAllModData[submenuOwner].items[top.module_name]){d=top.document.getElementsByClassName("submenu_"+top.module_name);if(d.length){for(b=0;b<d.length;b++){d[b].childNodes[0].childNodes[0].style.fontWeight="bold"}}if(aAllModData[submenuOwner].items[top.module_name].parentId){c=top.document.getElementsByClassName("submenu_"+aAllModData[submenuOwner].items[top.module_name].parentId);if(c.length){c[0].childNodes[0].childNodes[0].style.fontWeight="bold";top.document.getElementById("links").scrollTop=c[0].offsetTop}}else{top.document.getElementById("links").scrollTop=d[0].offsetTop}}},300)}function showSubMenu(d,a,f){var c=top.document.getElementById("submenu_block"),b=top.document.getElementById("submenu-items");c.style.height="115px";document.getElementById("links").style.height="auto";if(c.style.display!="block"||(submenuOwner!=d)){submenuOwner=d;b.innerHTML=getSubmenuItemsHtml(d);c.style.left=a+"px";c.style.top=f+"px";c.style.display="block";window.setTimeout(initSubmenu,0)}else{c.style.display="none";b.innerHTML=""}}function hideSubMenu(){document.getElementById("submenu_block").style.display="none"}function showSubMenuCalc(c,d){var b=getx(document.getElementById(d))+document.getElementById(d).offsetWidth-1;var a=gety(document.getElementById(d))-1;showSubMenu(c,b,a)}function getCaretPos(d){var f=document.getElementById(d);var g=0;f.focus();if(typeof(f.selectionStart)!="undefined"){g=f.selectionStart}else{if(document.selection&&document.selection.createRange){var h=document.selection.createRange();var b=h.duplicate();var a=200;var c=0;while(1){c=-b.move("character",-a);if(c>0&&b.parentElement()==f){g+=c}else{if(b.parentElement()!=f){h.move("character",-g);while(h.move("character",-1)<0&&h.parentElement()==f){g+=1}break}else{break}}}}}return g+"|"+f.scrollTop}function setCaretPos(b,g){var a=-1;if((a=g.indexOf("|"))>0){var f=g.substr(a+1);g=g.substr(0,a);var c=document.getElementById(b);c.focus();if(typeof(c.selectionStart)!="undefined"){c.selectionStart=g;c.selectionEnd=g;c.scrollTop=f;c.scrollIntoView(true);c.focus()}else{if(c.createTextRange){var d=c.createTextRange();d.move("character",g);d.select();c.scrollTop=f;c.scrollIntoView(true)}}}}function replaceDateTitle(d){var a=document.getElementById(d);if(a){var b=a.innerHTML;var c=new RegExp(DATE_CONVERTION[2].replace(/\./,"\\."));var f=new RegExp(DATE_CONVERTION[3].replace(/\./,"\\."));b=b.replace(c,DATE_CONVERTION[0]);b=b.replace(f,DATE_CONVERTION[1]);a.innerHTML=b}}function selectUnshift(d,f,a,c){var h=d.options.length;for(var b=0;b<h;b++){if(d.options[b].value==f){d.selectedIndex=b;d=null;return false}}if(h){d.options.remove(0)}var g=typeof(c)=="undefined"?document.createElement("OPTION"):c.createElement("OPTION");g.text=a;g.value=f;d.add(g);d.selectedIndex=d.options.length-1;d.focus();d=null;g=null;return false}function submitFormOnEnter(a,b){a=amiCommon.getValidEvent(a);if(a.keyCode==13){fireEvent2(b,"submit");b.submit()}}function onPositionCtrlClick(a,f,b,d){a=amiCommon.getValidEvent(a);var c=amiCommon.getEventTarget(a);if(c.className=="posLeftTop"){if(b){posShowWarn("top")}else{user_click("top",f)}}else{if(c.className=="posRightTop"){if(b){posShowWarn("up")}else{user_click("up",f)}}else{if(c.className=="posLeftBottom"){if(d){posShowWarn("bottom")}else{user_click("bottom",f)}}else{if(c.className=="posRightBottom"){if(d){posShowWarn("down")}else{user_click("down",f)}}}}}}function parseLocalDate(n,a){if(typeof(a)=="undefined"){var a="00:00"}tmp_format=top.calendarFormat;year_len=2;if(tmp_format.indexOf("YYYY")>=0){year_len=4}tmp_yOffset=tmp_format.indexOf("Y");tmp_mOffset=tmp_format.indexOf("M");tmp_dOffset=tmp_format.indexOf("D");year_pref="20";if(year_len==4){year_pref=""}if(year_len==2){var f=n.substring(tmp_yOffset,tmp_yOffset+year_len);if(f>69){year_pref="19"}}var h=year_pref+n.substring(tmp_yOffset,tmp_yOffset+year_len);var g=n.substring(tmp_mOffset,tmp_mOffset+2)-1;var l=n.substring(tmp_dOffset,tmp_dOffset+2);var k=h+"-"+g+"-"+l+" "+a+":00";var b=a.split(":");var m=b[0];var d=typeof(b[1]!="undefined")?b[1]:0;var o=new Date(h,g,l,m,d);var c=o.getTime();if((c=="Invalid Date")||(isNaN(c))){return false}return c}function formatStyleSize(a){if(/\%$/.test(a)){return a}else{return parseInt(a)+"px"}}function getScrollLeft(){return(document.documentElement&&document.documentElement.scrollLeft)?document.documentElement.scrollLeft:document.body.scrollLeft}function getScrollTop(){return(document.documentElement&&document.documentElement.scrollTop)?document.documentElement.scrollTop:document.body.scrollTop}function TrimStr(a){a=a.replace(/^\s+/g,"");return a.replace(/\s+$/g,"")}function setOpacity(a,b){if(typeof(a.style.MozOpacity)!="undefined"){a.style.MozOpacity=b}else{if(typeof(a.style.opacity)!="undefined"){a.style.opacity=b}else{if(typeof(a.style.KhtmlOpacity)!="undefined"){a.style.KhtmlOpacity=b}else{a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+(b*100)+");"}}}}function leftAreaRoll(a,b){if(b==0){document.getElementById("left_area_big").style.overflow="hidden"}b++;document.getElementById("left_area_td").style.width=((a==0)?5-b:b)*40+"px";if(b==5){if(a==0){if(navigator.appName=="Microsoft Internet Explorer"){document.getElementById("left_area_td").style.display="none"}else{document.getElementById("left_area_td").style.marginLeft=-document.getElementById("left_area_big").offsetWidth+"px"}document.getElementById("left-menu-tab").className="left-menu-tab-open";setCookie("gShowLeftArea","0","",0,2)}else{document.getElementById("left-menu-tab").className="left-menu-tab-close";setCookie("gShowLeftArea","1","",0,2)}}else{window.setTimeout(function(){leftAreaRoll(a,b)},5)}}function switchLeftArea(a){if(typeof(a)=="undefined"){if(AMI.$("#left_area_td").hasClass("module-menu__hide")){a=1}else{a=0}}AMI.$(".htmlEditorFrame").each(function(){if($(this).width()>200){AMI.$(".htmlEditorFrame").eq(0).attr("data-editor-width",$(this).width())}});AMI.$("#content_wrapper").attr("data-editor-width",AMI.$("#content_wrapper").width());AMI.$(".hover-left-menu .submenu a, .module-menu__item, #tree_tool_bar #sitemap, #tree_tool_bar a, #treeframe, .tree-block form, .tree-block div").css("visibility","visible");if(a==0){AMI.$("#left_area_big, #left-menu-block").animate({width:"34"});AMI.$("#left-menu-tab").animate({left:35});AMI.$("#left-menu-block").css("border","none");AMI.$("#left-menu-tab").attr("class","left-menu-tab-open");AMI.$("#left-menu-block .menu").nextAll().fadeOut();AMI.$(".module-menu__submenu").css({width:0,display:"block"});AMI.$("#left_area_td").addClass("module-menu__hide");AMI.$("#left_area_td").parent().addClass("module-menu__hide-block");AMI.Cookie.set("gShowLeftArea","0",3600*24,"/",true);AMI.$(".module-menu__item").attr("id","submenu_btn");AMI.$(".htmlEditorFrame").animate({width:parseInt(AMI.$(".htmlEditorFrame").eq(0).attr("data-editor-width"))+parseInt(AMI.$("#left_area_big").attr("data-width-default"))-32+"px"});AMI.$(".htmlEditorFrame").parent().animate({width:parseInt(AMI.$(".htmlEditorFrame").eq(0).attr("data-editor-width"))+parseInt(AMI.$("#left_area_big").attr("data-width-default"))-32+"px"});AMI.$("#content_wrapper, .CodeMirror, .CodeMirror-scroll").animate({width:parseInt(AMI.$("#content_wrapper").attr("data-editor-width"))+parseInt(AMI.$("#left_area_big").attr("data-width-default"))-32+"px"})}else{AMI.$("#left_area_big").animate({width:parseInt(AMI.$("#left_area_big").attr("data-width-default"))+4});AMI.$("#left-menu-block").animate({width:AMI.$("#left_area_big").attr("data-width-default")});AMI.$("#left-area__block").animate({width:parseInt(AMI.$("#left_area_big").attr("data-width-default"))});AMI.$("#left-menu-tab").animate({left:parseInt(AMI.$("#left_area_big").attr("data-width-default"))+1});AMI.$("#left-menu-block").css("border-right","1px #E0E0E0 solid");AMI.$("#left-menu-tab").attr("class","left-menu-tab-close");AMI.$("#left-menu-block .menu").nextAll().fadeIn();AMI.$(".module-menu__submenu").removeAttr("style");AMI.$("#left_area_td").removeAttr("class");AMI.$("#left_area_big").removeAttr("class");AMI.$("#left_area_td").parent().removeAttr("class");AMI.Cookie.set("gShowLeftArea","1",3600*24,"/",true);AMI.$(".htmlEditorFrame").animate({width:parseInt(AMI.$(".htmlEditorFrame").eq(0).attr("data-editor-width"))-parseInt(AMI.$("#left_area_big").attr("data-width-default"))+32+"px"});AMI.$(".htmlEditorFrame").parent().animate({width:parseInt(AMI.$(".htmlEditorFrame").eq(0).attr("data-editor-width"))-parseInt(AMI.$("#left_area_big").attr("data-width-default"))+32+"px"});AMI.$("#content_wrapper, .CodeMirror, .CodeMirror-scroll").animate({width:parseInt(AMI.$("#content_wrapper").attr("data-editor-width"))-parseInt(AMI.$("#left_area_big").attr("data-width-default"))+32+"px"})}}var flyPopupTimout=null;function flyPopup(m,d,h,c,o,l,k,g){var f=25;var l=l||(bIsIE?6:8);if(typeof(k)=="undefined"){var k=[100,100,10,10];var n=amiCommon.getValidEvent(globalEvent);if(n){var b=amiCommon.getEventTarget(n);if(b){var a=amiCommon.getElementPosition(b);k=[a[0],a[1],b.offsetWidth,b.offsetHeight]}}globalEvent=null;flyPopupTimout=(new Date()).getTime()+300}var p=document.getElementById("idFlyFrame");if(p==null){p=document.createElement("DIV");p.id="idFlyFrame";p.className="flyFrame";p=document.body.appendChild(p)}if(l>1&&(new Date()).getTime()<flyPopupTimout){p.style.left=k[0]+parseInt((d-k[0])/(l))+"px";p.style.top=k[1]+parseInt((h-k[1])/(l))+"px";p.style.width=k[2]+parseInt((c-k[2])/(l))+"px";p.style.height=k[3]+parseInt((o-k[3])/(l))+"px";l--;window.setTimeout(function(){flyPopup(m,d,h,c,o,l,k,g)},f)}else{setTimeout(m,1);p.style.left=d+"px";p.style.top=h+"px";p.style.width=c+"px";p.style.height=o+"px"}}function flyPopupClose(){var a=document.getElementById("idFlyFrame");if(a!=null){a.parentNode.removeChild(a)}}function switchFavorites(){var b=90;var a=document.getElementById("favorites_block");if(a.style.display=="none"){if(typeof(window.favoritesLoaded)=="undefined"){document.getElementById("favorites_block_frm").src=document.getElementById("favorites_block_link").value;window.favoritesLoaded=true}flyPopup(function(){flyPopupClose();document.getElementById("favorites_block").style.left=b+"px";document.getElementById("favorites_block").style.display="block"},b,60,362,515)}else{a.style.display="none"}}var oProcessingImage=new Image();oProcessingImage.src="skins/vanilla/images/request_bg.png";function groupOperationsCreateIdPage(){var a=document.getElementsByName("flt_id_page");if(a.length>0){var b=a[0].cloneNode(true);b.options[1]=null;b.options[0].value=0;b.selectedIndex=0;b.name="grp_id_page";var c=document.getElementById("idPageSelectPlace");if(c!=null){c.parentNode.insertBefore(b,c)}}}function groupOperationsCreateParentCat(){var a=document.getElementsByName("cat_id");if(a.length>0){var b=a[0].cloneNode(true);b.options[0]=null;b.selectedIndex=0;b.name="grp_id_cat";var c=document.getElementById("idCatSelectPlace");if(c!=null){c.parentNode.insertBefore(b,c)}}}function focusedAlert(c,b,a){if(typeof(a)=="undefined"){a=false}c?c.focus():editor_setfocus(a);alert(b);c?c.focus():editor_setfocus(a);return false}var betaVersionPopup=null;function closeBetaVersion(){AMI.$(".beta_version_popup").css("margin-top","-25px")}function openBetaVersion(){AMI.$(".beta_version_popup").css("margin-top","0px")}function hideBetaPopup(b){var a=parseInt(b)*24*3600;AMI.Cookie.set("dont_show_beta_version_dialog",1,a,"/",true);if(betaVersionPopup){betaVersionPopup.close();AMI.$(".beta_block_new").hide()}}function betaPopupOpen(){betaVersionPopup=new AMI.UI.Popup("",{id:"beta_popup_open",header:"",width:715,height:385,animation:{open:"fadein",close:"fadeout"}})}function isInRaw(h,g){h=String(h);var c="[RAW]",k="[/RAW]",a=h.lastIndexOf(c,g),b=h.lastIndexOf(k,g),f=h.indexOf(c,g),d=h.indexOf(k,g);if(a>b&&(f>-1&&d>-1&&f>d||d>-1)){return true}return false}if(typeof(AMI.$)!="undefined"){if(typeof(window.interface_lang)=="undefined"||window.interface_lang=="ru"){if(AMI.Cookie.get("ami_engine")!="6"){window.setTimeout(function(){if(!AMI.Cookie.get("dont_show_beta_version_dialog")||window.module_name=="start"){AMI.$(".beta_block_new").show();AMI.$(document).ready(openBetaVersion)}},3000)}else{AMI.$(document).ready(function(){var a=AMI.$(".beta_block_old");a.css("transition","none");a.css("-moz-transition","none");a.css("-webkit-transition","none");a.css("-o-transition","none");a.show()})}}var aOwnersSubmenues={};var submenuCheckInterval=null;AMI.$(document).ready(function(){if(typeof(aAllModData)=="undefined"){return}if(a60Modules.indexOf(module_name)<0){AMI.$("#footerTR").show()}for(var d in aAllModData){aOwnersSubmenues[d]=false}if(typeof(startTypeModName)=="undefined"){return}function b(k){return k}var h={title:"",notFound:modulesSelectNotFound,selected:module_name,button:"",onInit:function(k){},onListOpen:function(m,l){var k=AMI.$("[data-ami-select-item-value="+module_name+"]");if(k.length){l.scrollTop(l.scrollTop()+k.position().top);k.find("SPAN").css("font-weight","bold")}},onAddItem:function(q,A,l,w,u,v){l=b(l);var m=l.replace(/\<b\>/ig,"").replace(/\<\/b\>/ig,"");v.attr("data-ami-select-item-full",m);if(q.getOpt("selected","")===w){AMI.$("#"+q.name+"-viewed").text(m)}var o=adminBaseURL+"skins/vanilla/images/empty.gif";var s='class="submoduleImage"';if(aMainModules.indexOf(w)>=0){s="";o=amiCommon.getModResourceURL("mod_icon",{modId:w,locale:interface_lang})}if(w.indexOf("plugin")===0){v.addClass("disabled")}v.html('<span style="vertical-align:middle">'+v.html()+"</span>");for(var z in window.aAllModData){if(window.aAllModData[z].caption==A){var k=u.find("div:first");k.addClass(z);for(var t in window.aAllModData[z].items){if(t==w){for(var p in q.highlighted){var n=new RegExp("("+p+")","ig");if(n.test(t)){v.html(v.html()+" ["+t.replace(n,"<b>$1</b>")+"]")}}}}break}}},onSelect:function(l,n,m,p){if(m==l.getOpt("selected")){itemContainer.addClass("selected_option");groupContainer.addClass("ami-select__group-selected")}for(var k in window.aAllModData){for(var o in window.aAllModData[k].items){if(o==m){document.location.href=window.aAllModData[k].items[o].link;return}}}},onEmptySearch:function(k){return true},onSearch:function(o,n,m,l,k){if(!l.length){o.highlighted={"Fake String That Never Be Found":true};return true}return false},onAfterInit:function(l){AMI.$("#"+l.name+"-resultrow input").attr("placeholder",window.startTypeModName);if(window.module_name!="start"){AMI.$("#"+l.name+"-resultrow input").val("")}if(AMI.$("#"+l.name+"-viewed").text()!==""){AMI.$("#"+l.name+"-viewed").show();AMI.$("#"+l.name+"-resultrow input").hide()}var k=window.activePageHeader;if(window.module_name=="start"){k=window.startPageHeader}AMI.$("#"+l.name+"-viewed").text(b(k));AMI.$("#"+l.name+"-viewed").show();AMI.$("#"+l.name+"-rolloverbutton").show()}};var c=AMI.$.extend(true,{},window.aAllModData);for(var a in c){for(var g in c[a].items){if((typeof(c[a].items[g].link)=="undefined")||(!c[a].items[g].link.length)){delete c[a].items[g]}}}oModules=new amiAdminSelect("header-select-module",c,h);oModules.init("select_module");if((typeof(aAllModData.services)=="undefined")||(typeof(aAllModData.services.items.srv_options)=="undefined")){AMI.$(".amiro-header__control-option").fadeTo(1,0.3);AMI.$(".amiro-header__control-option-search").hide();AMI.$(".amiro-header__control-option").removeAttr("onclick");AMI.$(".amiro-header__control-option").click(function(k){alert(srvOptionsNotInstalled);k.preventDefault();return});return}if(AMI.$("#amiro-header__setting-form").length==1){window.currentOptionsCount=0;window.totalOptionsCount=0;window.aOptionsData={};window.aOptions={};var f="srv_options.php?_cv="+top.cms_version+"&_rv="+top.rights_version+"&lang="+top.interface_lang+"&_ah="+top.amiAccessHash+"&json=1";AMI.$.getJSON(f,{},function(m){AMI.Cookie.set("options_cache",top.cms_version,3600*24*365,"/",true);aOptions=m;var p={title:srvOptionsStratTypeOptName,maxCount:30,notFound:srvOptionsNotFound,tooMuch:srvOptionsTooMuch,renderDataOnStart:false,listAlign:"right",onInit:function(o){o.isCached=AMI.Cookie.get("options_cache")==top.cms_version;o.addedGroups={};o.searchInDescription=AMI.Cookie.get("search_in_description");o.searchInCurrentModule="no";o.moveObj=function(u,t){for(var s in u){t[s]=u[s]}};o.fromCurMod=function(s){return function(){s.aData=AMI.$.extend(true,{},s.aCurModData)}}(o);o.fromAllMod=function(s){return function(){s.aData=AMI.$.extend(true,{},s.aAllModData)}}(o);if(!o.searchInDescription){o.searchInDescription="yes"}if(!o.searchInCurrentModule){o.searchInCurrentModule="no"}o.popupInitialized=false},onAfterInit:function(u){var v=srvOptionsSearchThisModule;var s=srvOptionsSearchInDescriptions;var o=(u.searchInCurrentModule=="no")?"":'checked="checked"';var t=(u.searchInDescription=="no")?"":'checked="checked"';u.settingsPopup=AMI.$("#select-options-rolloverbutton").after('<div id="srv_options_search_settings"><br><label><input type="checkbox" value="1" id="search_current" '+o+">"+v+'</label><br><label><input type="checkbox" value="1" id="search_description" '+t+">"+s+"</label></div>");u.popupInitialized=true;AMI.$("#search_current").click(function(w){l.lastStr="";l.searchInCurrentModule=(this.checked)?"yes":"no";AMI.Cookie.set("search_in_current",l.searchInCurrentModule,36000,"/50/srv_options/");if(l.searchInCurrentModule=="yes"){l.fromCurMod()}else{l.fromAllMod()}});AMI.$("#search_description").click(function(w){l.searchInDescription=(this.checked)?"yes":"no";AMI.Cookie.set("search_in_description",l.searchInDescription,36000,"/50/srv_options/")})},onButtonClick:function(o){if(AMI.$("#srv_options_search_settings").css("height")=="0px"){AMI.$("#srv_options_search_settings").animate({height:"60px"})}else{AMI.$("#srv_options_search_settings").animate({height:"0"})}return true},onAddItem:function(B,w,O,H,t,o){var N=module_name;for(var z in aOptions){if(aOptions[z].caption==w){if(z==N){t.addClass("ami-select__group-selected")}}}for(var z in aOptions){if(aOptions[z].caption==w){var L=t.find(".ami-select__grouptitle");for(var D in B.highlighted){var u=new RegExp("("+D+")","ig");if((z.indexOf(D)>=0)&&(L.text().toLowerCase().indexOf(D)<0)){var M=L.html()+" ["+z.replace(u,"<b>$1</b>")+"]";L.html(M)}}for(var s in aOptions[z].items){if(s==H){var E=B.clearName(aOptions[z].items[s].group);var K=H.split("|");var J=K[0]+"|"+K[1];if(E&&typeof(B.addedGroups[J])=="undefined"){var A=AMI.$("<DIV>");A.addClass("select-options-subgroup");A.attr("data-ami-select-item-full",E);var C=E;for(var D in B.highlighted){var u=new RegExp("("+D+")","ig");C=C.replace(u,"<b>$1</b>")}A.html(C);A.click(function(P){return function(){AMI.$("#"+l.name+"-resultrow input, #"+l.name+"-list").hide();l.tooMuch(false);AMI.$("#"+l.name+"-viewed, #"+l.name+"-rolloverbutton").show();AMI.$("#"+l.name+"-viewed").text(AMI.$(this).attr("data-ami-select-item-full"));var T=P.split("|");var W=T[0];var V=P+"|";if(N==W){document.location.hash=V;navigateByHash()}else{var U=AMI.$('INPUT[name="flt_mode"]').val();var Q=getModOwner(W);var R="srv_options.php?flt_module="+W+"&flt_owner="+Q+"&flt_mode="+U+"#"+V;var S=AMI.$('<FORM action="'+R+'" method="POST">');AMI.$("body").append(S);S.submit();S.remove()}}}(J));B.addedGroups[J]=1}var F=B.clearName(aOptions[z].items[s].description);if(F!=""){for(var D in B.highlighted){var u=new RegExp("("+D+")","ig");F=F.replace(u,"<b>$1</b>")}F='<br><span style="font-size:9px;color:#000;"><i>'+F+"</i></span>"}o.attr("original-text",o.text());var G=s.split("|");var v=(typeof(G[2])!="undefined")&&G[2].length?G[2]:"";var I=false;for(var D in B.highlighted){var u=new RegExp("("+D+")","ig");E=E.replace(u,"<b>$1</b>");if(v.length&&(v.indexOf(D)>=0)){v=" ["+v.replace(u,"<b>$1</b>")+"]";I=true}}if(!I){v=""}o.html('<div style="padding-left:16px;">'+o.html().replace(E+":","")+v+F+"</div>")}}break}}t.append(A)},onBeforeHighlight:function(o){o.addedGroups={}},onSearch:function(w,v,t,s,o){if(w.searchInDescription=="no"){return false}var u=w.clearName(w.aData[v].items[t].description);if(u&&w.searchItems(u,o)){return true}return false},onEmptySearch:function(o){o.closeList(null,true)},onListClick:function(o){if(AMI.$("#"+o.name+"-resultrow > input").val()===""){o.closeList(null,true);return true}return false},onSelect:function(t,v,u,w){var s=u.split("|")[0];var o=aOptions[s].owner;openExtDialog(srvOptionsPopupTitle,"srv_options.php?flt_mode=simple&flt_owner="+o+"&flt_module="+s+"&_mt=1382939789&_rv="+top.rights_version+"&_mtloc="+top._mtloc+"&_cv="+top.cms_version+"#"+u,1,1);if(t.lastStr.length){AMI.$("#"+t.name+"-viewed").text(t.lastStr)}}};var l=new amiAdminSelect("select-options",m,p);l.tooMuch=function(o){return function(A,v,u){var t=AMI.$("#"+o.name+"-tooMuchMaches");if(A){t.html(o.getOpt("tooMuch","Not all mathes shown").replace("__count__",v).replace("__total__",u))}if(!A&&(typeof(v)!="undefined")&&(typeof(u)!="undefined")&&(parseInt(u)>0)){A=true;t.html("")}o.showTooMuch=A;if(A){t.css("top",o.getListObject().position().top+o.getListObject().height()+4);var s=(o.searchInCurrentModule=="yes")?currentOptionsCount:totalOptionsCount;var z=(s.toString()[s.toString().length-1]=="1");var w=z?srvOptionsCountMsg1:srvOptionsCountMsg2;w=w.replace("__count__",s);t.append('<DIV class="ami-select__optCounter">'+w+"</DIV>");t.show()}else{t.html("");t.hide()}}}(l);l.aAllModData=AMI.$.extend(true,{},aOptions);l.aData=AMI.$.extend(true,{},aOptions);l.aCurModData={};l.aCurModData[module_name]={};var k=(module_name=="start")?"core_module":module_name;for(var q in aOptions){if(q==k){l.aCurModData[k]=AMI.$.extend(true,{},aOptions[q])}for(var n in m[q].items){if(q==k){currentOptionsCount++}totalOptionsCount++}}l.init("amiro-header__setting-form")})}})}Number.prototype.formatMoney=function(l,h,f){var k=this,l=isNaN(l=Math.abs(l))?2:l,h=h==undefined?",":h,f=f==undefined?".":f,g=k<0?"-":"",b=parseInt(k=Math.abs(+k||0).toFixed(l))+"",a=(a=b.length)>3?a%3:0;return g+(a?b.substr(0,a)+f:"")+b.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+f)+(l?h+Math.abs(k-b).toFixed(l).slice(2):"")};function patchFrontLinkHRef(g){if(!document.getElementById("amiro-header__control__view-page")){return}var d=document.getElementById("amiro-header__control__view-page"),c=AMI.HTTPRequest.parseURLQuery(d.search),b="",f=[];if(!AMI.$(d).prop("savedHRef")){AMI.$(d).prop("savedHRef",d.href)}if(g){if(!d.pathname.match("ami_strict.php$")){b=d.pathname.substr(1);d.href=editorBaseHref+"ami_strict.php";c={ami_svc:"ami_lookup",ami_env:"fast"}}c.lookup_mod_id=module_name;c.lookup_id=g;for(var a in c){f.push(a+"="+c[a])}d.search=f.join("&")}else{d.href=AMI.$(d).prop("savedHRef")}}var amiPath={adminBaseURL:(topEvents&&typeof(top.adminBaseURL)!="undefined")?top.adminBaseURL:window.adminBaseURL,interfaceSkin:(topEvents&&typeof(top.interface_skin)!="undefined")?top.interface_skin:window.interface_skin,editorBaseHref:(topEvents&&typeof(top.editorBaseHref)!="undefined")?top.editorBaseHref:window.editorBaseHref,};var amiCommon={objectPool:{},oResourceURLs:{mod_icon:{oldenv:amiPath.adminBaseURL+"skins/"+amiPath.interfaceSkin+"/images/{$modId}_icon.gif",shared:amiPath.adminBaseURL+"skins/"+amiPath.interfaceSkin+"/images/hyper/{$hyper}_{$cfg}_icon.gif",local:amiPath.editorBaseHref+"_local/_admin/images/icons/{$modId}.gif"},mod_icon_plugin:{local:amiPath.editorBaseHref+"_local/_admin/images/{$plgId}/{$icon}"},mod_specblock:{oldenv:amiPath.adminBaseURL+"skins/"+amiPath.interfaceSkin+"/images/specblocks/{$locale}/spec_{$block}.gif",shared:amiPath.adminBaseURL+"skins/"+amiPath.interfaceSkin+"/images/hyper/{$hyper}_{$cfg}{$entity}_{$locale}.gif",local:"_local/_admin/images/icons/{$block}_specblock_{$locale}.gif"},ext_icon:{oldenv:amiPath.adminBaseURL+"skins/"+amiPath.interfaceSkin+"/images/extensions/{$modId}.gif",shared:amiPath.adminBaseURL+"skins/"+amiPath.interfaceSkin+"/images/extensions/{$modId}.gif",local:amiPath.editorBaseHref+"_local/_admin/images/icons/{$modId}.gif"}},resetObjectPool:function(){this.objectPool={}},getElementById:function(a,b){if(b||typeof(this.objectPool[a])=="undefined"||this.objectPool[a]==null){this.objectPool[a]=document.getElementById(a)}return this.objectPool[a]},getDocumentClientWidth:function(){return document.body.clientWidth},getDocumentClientHeight:function(){return document.body.clientHeight},getDocumentFullWidth:function(){return Math.max(this.getDocumentClientWidth(),document.body.scrollWidth)},getDocumentFullHeight:function(){return Math.max(this.getDocumentClientHeight(),document.body.scrollHeight)},getClientLeftPosition:function(){return getScrollLeft()},getClientTopPosition:function(){return getScrollTop()},getClientRightPosition:function(){return this.getClientLeftPosition()+document.body.clientWidth},getMousePosition:function(b){var a=new Array(0,0);if(b.pageX||b.pageY){a[0]=b.pageX;a[1]=b.pageY}else{if(b.clientX||b.clientY){a[0]=b.clientX+getScrollLeft()-document.documentElement.clientLeft;a[1]=b.clientY+getScrollTop()-document.documentElement.clientTop}}return a},getElementPosition:function(b){var a=new Array(0,0);pStopObj=null;do{a[0]+=b.offsetLeft;a[1]+=b.offsetTop}while((b=b.offsetParent)!=null);return a},getCaretPosition:function(c){var a=0;c.focus();if(c.selectionStart){a=c.selectionStart}else{if(document.selection){var b=document.selection.createRange();b.collapse(true);var d=c.createTextRange();if(d.inRange(b)){d.setEndPoint("EndToEnd",b);a=d.text.length}}}return a},setCaretPosition:function(b,a){b.focus();if(b.selectionStart){b.selectionStart=a;b.selectionEnd=a}else{if(document.selection){var c=b.createTextRange();c.move("character",a);c.select()}}},getValidEvent:function(a,b){return a?a:(typeof(b)=="undefined"?window.event:b.event)},getEventTarget:function(a){return a.srcElement||a.target},fireEvent:function(b,a){if(document.createEventObject){var c=document.createEventObject();b.fireEvent("on"+a,c)}else{if(document.createEvent){var c=document.createEvent("HTMLEvents");c.initEvent(a,false,false);b.dispatchEvent(c)}else{return false}}},stopEvent:function(a){this.stopPropagation(a);if(typeof(a.preventDefault)!="undefined"){a.preventDefault()}else{a.returnValue=false}},stopPropagation:function(a){if(typeof(a.stopPropagation)!="undefined"){a.stopPropagation()}else{if(typeof(a.cancelBubble)!="undefined"){a.cancelBubble=true}}},setEventHandler:function(a,b,c){if(typeof(b.addEventListener)!="undefined"){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}}},removeEventHandler:function(a,b,c){if(typeof(b.removeEventListener)!="undefined"){b.removeEventListener(a,c,false)}else{if(b.detachEvent){b.detachEvent("on"+a,c)}else{}}},decodeHTMLSpecialChars:function(a){return a.replace(/&(.{2,4});/gi,function(c,b){var d={"#039":"'","#037":"%","#035":"#",quot:'"',lt:"<",gt:">",amp:"&"};if(d[b]){return d[b]}else{return b}})},log:function(a,b){if("object"===typeof(console)){if("undefined"!==typeof(b)&&b){console.warn(a)}else{console.log(a)}}},getModResourceURL:function(b,a){if("undefined"===typeof(aAllModData)){amiCommon.log("aAllModData is undefined",true);return""}var f=a.modId;if("ext_icon"!=b){for(var d in top.aAllModData){if(("object"!==typeof(top.aAllModData[d]))||("undefined"===typeof(top.aAllModData[d]["items"]))){continue}if("undefined"!==typeof(top.aAllModData[d]["items"][f])){return amiCommon._getModResourceURL(b,top.aAllModData[d]["items"][f],a)}}amiCommon.log('Cannot find "'+f+'" module info in aAllModData',true)}else{var c="undefined"!=typeof(aExtModes[f])?aExtModes[f]:"oldenv";return amiCommon._getModResourceURL(b,{resMode:c},a)}return""},_getModResourceURL:function(f,c,b){var g="undefined"!==typeof(c.resMode)?c.resMode:"oldenv",d={};for(var a in c){d[a]=c[a]}for(var a in b){d[a]=b[a]}if("undefined"!==typeof(d.force)){g="oldenv";if(0===d.modId.indexOf("plugin_")&&"mod_icon"===f){f="mod_icon_plugin";g="local"}}return amiCommon._parseTpl(amiCommon.oResourceURLs[f][g],d)},_parseTpl:function(c,a){for(var b in a){c=c.replace("{$"+b+"}",a[b])}return c}};var globalEvent=null;function storeGlobalEvent(a){globalEvent=a}if(topEvents&&typeof(top.storeGlobalEvent)!="undefined"){amiCommon.setEventHandler("mousedown",window,function(a){return top.storeGlobalEvent(a)})}var amiCookies={getDate:function(c,a){var b=new Date();if(typeof(c)=="undefined"&&typeof(a)=="undefined"){c=30}if(typeof(c)!="undefined"){b.setDate(b.getDate()+c)}if(typeof(a)!="undefined"){b.setHours(b.getHours()+a)}return b},set:function(d,h,l,k,g){var f=this.getDate(k,g);var a=Math.floor(f.getTime()/1000);var b=Math.round(new Date().getTime()/1000);var c=a-b;if(l==undefined){l=""}AMI.Cookie.set(d,h,c,l)},get:function(a){return AMI.Cookie.get(a)},del:function(b,a){if(a==undefined){a=""}AMI.Cookie.del(b,a)},store:function(){},load:function(){}};var oEvents={stopEvent:function(a){a=a?a:window.event;if(typeof(a.stopPropagation)!="undefined"){a.stopPropagation()}else{if(typeof(a.cancelBubble)!="undefined"){a.cancelBubble=true}}if(typeof(a.preventDefault)!="undefined"){a.preventDefault()}else{a.returnValue=false}}};var amiSpin={mousewheelevt:(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel",addFields:function(f,d,a,g,h,b){for(var c=0;c<f.length;c++){amiCommon.setEventHandler(this.mousewheelevt,f[c],function(n,k,m,o,l){return function(p){amiSpin.spin(p,n,k,m,o,l)}}(d,a,g,h,b));amiCommon.setEventHandler("keydown",f[c],function(n,k,m,o,l){return function(p){return amiSpin.spin(p,n,k,m,o,l)}}(d,a,g,h,b));amiCommon.setEventHandler("focus",f[c],function(k){return function(l){k.className="spin-control-active";k.select();k.hasFocus=true}}(f[c]));amiCommon.setEventHandler("blur",f[c],function(k){return function(l){k.className="spin-control";k.hasFocus=false}}(f[c]))}},spin:function(n,o,f,d,a,k){if(typeof(d)=="undefined"){var d=1}if(typeof(o)=="undefined"){var o=100000}if(typeof(f)=="undefined"){var f=-100000}if(typeof(k)=="undefined"){k=null}n=top.amiCommon.getValidEvent(n);var g=top.amiCommon.getEventTarget(n);if(typeof(n.which)!="undefined"){n.keyCode=n.which}if(n.keyCode>57){amiCommon.stopEvent(n);return true}if(g.value!=""&&isNaN(parseInt(g.value))){amiCommon.stopEvent(n);return true}var m=g.value==""?0:parseInt(g.value);var l=g.value.substr((m+"").length);l=((l=="")&&(typeof(a)!="undefined"))?a:l;var h=false;if(g.hasFocus){if(n.wheelDelta){var c=Math.round(n.wheelDelta/120)}else{if(n.detail){var c=Math.round(-n.detail/3)}}var b=m+c*d;if(typeof(c)!="undefined"&&b>=f&&b<=o){g.value=b+l;g.select();h=true}}if(n.keyCode==38&&m<o){g.value=m+d+l;g.select();h=true}if(n.keyCode==40&&m>f){g.value=m-d+l;g.select();h=true}if(n.keyCode==33){if(m<o-10){g.value=m+10*d+l;g.select()}else{g.value=o;g.select()}h=true}if(n.keyCode==34){if(m>f+10){g.value=m-10*d+l;g.select()}else{g.value=f+l;g.select()}h=true}if(k!=null){k()}if(h){amiCommon.stopEvent(n)}}};amiAjax={requests:new Array(),variables:{},urlHash:"",_initObjectRequest:function(c){try{this.requests[c]["transport"]=new XMLHttpRequest()}catch(b){this.requests[c]["transport"]=null}if(this.requests[c]["transport"]==null){for(var a=0;a<2;a++){activeXName=a==0?"Msxml2.XMLHTTP":"Microsoft.XMLHTTP";try{this.requests[c]["transport"]=new ActiveXObject(activeXName)}catch(b){this.requests[c]["transport"]=null}if(this.requests[c]["transport"]!=null){break}}}return(this.requests[c]["transport"]!=null)},_getRequestVariables:function(b){var c="";for(var a in this.requests[b]["variables"]){c+=c.length>0?"&":"";c+=encodeURIComponent(a)+"="+encodeURIComponent(this.requests[b]["variables"][a])}return c},_prepeareUrl:function(b){var a=this.requests[b]["url"];if(this.requests[b]["method"]=="GET"){var c=this._getRequestVariables(b);if(c.length>0){a=a+"?"+c}if(this.requests[b]["hash"].length>0){a=a+"#"+encodeURIComponent(this.requests[b]["hash"])}}else{if(this.requests[b]["method"]=="POST"){var c=this._getRequestVariables(b);this.requests[b]["transport"].send(c)}}return a},_request:function(a){if(this._initObjectRequest(a)){this.requests[a]["transport"].open(this.requests[a]["method"],this._prepeareUrl(a),true);if(this.requests[a]["method"]=="GET"){this.requests[a]["transport"].setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");this.requests[a]["transport"].send(null)}else{this.requests[a]["transport"].setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.requests[a]["transport"].send(this._getRequestVariables(a))}setTimeout("amiAjax._checkResponse("+a+")",10)}else{alert("Problem with XML HTTP initialization")}},_checkResponse:function(a){if(this.requests[a]["transport"].readyState==4){if(this.requests[a]["transport"].status==200){this.requests[a]["status"]=1;this.requests[a]["content"]=this.requests[a]["transport"].responseText}else{this.requests[a]["status"]=2}if(this.requests[a]["callback"]!=null){this.requests[a]["callback"](this.requests[a]["status"],this.requests[a]["content"])}this.requests[a]["transport"]=null;this.requests[a]=null}else{setTimeout("amiAjax._checkResponse("+a+")",10)}},resetRequestVariables:function(){this.variables={}},addVariable:function(a,b){this.variables[decodeURIComponent(a)]=decodeURIComponent(b)},setUrlHash:function(a){this.urlHash=decodeURIComponent(a)},addVariablesFromString:function(d){this.resetRequestVariables();d=d.replace(/^[\s?]*(.*?)[\s]*$/g,"$1");var b=d.split("#");if(typeof(b[1])!="undefined"){d=b[0];this.setUrlHash(b[1])}else{this.setUrlHash("")}var c=d.split("&");for(var a=0;a<c.length;a++){aPair=c[a].split("=");if(aPair[0]!=""){this.addVariable(aPair[0],aPair[1])}}},getContent:function(f,b,d,a){var c=this.requests.length;this.requests[c]={};this.requests[c]["status"]=0;this.requests[c]["callback"]=typeof(a)=="function"?a:null;this.requests[c]["transport"]=null;this.requests[c]["method"]=f.toUpperCase();this.requests[c]["url"]=b;if(typeof(d)!="undefined"){this.addVariablesFromString(d)}this.requests[c]["variables"]=this.variables;this.requests[c]["hash"]=this.urlHash;this.requests[c]["content"]="";this._request(c)}};progressDownloaderTimeout=null;function startProgressDownloader(a){progressDownloaderTimeout=setTimeout('amiAjax.getContent("GET", "get_progress_status.php?id='+a+'", "", receiveProgressData)',2000)}function stopProgressDownloader(){clearTimeout(progressDownloaderTimeout)}function resetProgressDownloader(a){stopProgressDownloader();startProgressDownloader(a)}function receiveProgressData(b,a){var c=false;if(b==1){c=!a.match(/^OK/);if(!c){setProgressData(a.substr(2))}}}function amiPopupWindow(){this.currentInstance=0;this.numOpened=0;this.currentMoved=-1;this.currentMovedDeltaX=0;this.currentMovedDeltaY=0;this.closedDialogs=new Object();this.loadedDialogs=new Object();this.dialogsWindows={};this.windowParameters=new Object();this.onCloseCallbacks=new Object();this.onBeforeCloseCallbacks=new Object();this.isIE=document.swapNode;this.aMobileIntervals=[];this.open=function(c,a,m,b,p,d,n,k,l){var o=amiCommon.getDocumentClientWidth();var f=amiCommon.getDocumentClientHeight();b=Math.min(b,o-40);p=Math.min(p,f-40);var h=Math.max(0,Math.round((o-b)/2)+amiCommon.getClientLeftPosition());var g=Math.max(0,Math.round((f-p)/2)+amiCommon.getClientTopPosition());flyPopup(function(B,t,s,C,u,v,A,w,z,q){return function(){B.openFast(t,s,C,u,v,A,w,z,q)}}(this,c,a,m,b,p,d,n,k,l),h+15,g+15,b-30,p-40)};this.openFast=function(C,f,F,o,n,m,w,a,k){this.loadedDialogs[this.currentInstance]=false;this.closedDialogs[this.currentInstance]=false;this.windowParameters[this.currentInstance]=typeof(a)=="object"?a:null;this.onCloseCallbacks[this.currentInstance]=typeof(w)=="function"?w:null;this.onBeforeCloseCallbacks[this.currentInstance]=typeof(k)=="function"?k:null;if(typeof(m)=="undefined"){m=false}var v=amiCommon.getDocumentClientWidth();var g=amiCommon.getDocumentClientHeight();o=Math.min(o,v-40);n=Math.min(n,g-40);var E=Math.max(0,Math.round((v-o)/2));var B=Math.max(0,Math.round((g-n)/2));if(this.numOpened>0){document.getElementById("popupWindowShadowFrame").style.zIndex=10000+(this.numOpened+1)*3;document.getElementById("popupWindowShadow").style.zIndex=10000+(this.numOpened+1)*3+1}else{if(document.getElementById("popupWindowShadowFrame")!=null){document.getElementById("popupWindowShadowFrame").style.display="block";document.getElementById("popupWindowShadow").style.display="block";document.getElementById("popupWindowShadowFrame").style.zIndex=10000+(this.numOpened+1)*3;document.getElementById("popupWindowShadow").style.zIndex=10000+(this.numOpened+1)*3+1}else{var d=document.createElement("IFRAME");d.id="popupWindowShadowFrame";d.className="popupWindowShadow";d.src="about:blank";d.frameborder="0";d.scrolling="no";document.body.appendChild(d);var s=document.createElement("DIV");s.id="popupWindowShadow";s.className="popupWindowShadow";document.body.appendChild(s)}}var D=document.createElement("DIV");D.className="popupWindowTitle";D.innerHTML="<nobr>"+F+"</nobr>";var t=document.createElement("DIV");t.className="popupWindowMove";t.instance=this.currentInstance;t.onmousedown=function(G){popupWindow.initMove(G,this.instance)};t.ondblclick=function(G){popupWindow.initDoubleClick(G,this.instance)};var p=document.createElement("DIV");p.className="popupWindowClose";p.instance=this.currentInstance;p.onclick=function(){if(typeof(top.amiPopupOnClose)=="function"){top.amiPopupOnClose()}popupWindow.close(this.instance)};var u=document.createElement("DIV");u.className="popupWindowContent";u.style.height=n-40+"px";var A=document.createElement("DIV");A.id="popupWindow_"+this.currentInstance;A.className="popupWindow";A.style.left=E+"px";A.style.top=B+"px";A.style.width=o+"px";A.style.height=n+"px";A.style.zIndex=10000+(this.numOpened+1)*3+2;if(AMI.Browser.isSensor||AMI.Browser.isLowResolution){A.style.position="absolute";A.style.left=AMI.Browser.getDocumentLeft()+E+"px";A.style.top=AMI.Browser.getDocumentTop()+B+"px"}var c=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";amiCommon.setEventHandler(c,A,function(){return function(G){amiCommon.stopEvent(G)}}());u=A.appendChild(u);u.appendChild(D);u.appendChild(t);u.appendChild(p);document.body.appendChild(A);var q=u.offsetWidth;var h=u.offsetHeight-40;if(!m){var b=document.createElement("IFRAME");b.className="popupWindowFrame";b.width=q;b.height=h;b.src="dialog.php?ver=4";b.frameborder="0";b.scrolling="yes";b=u.appendChild(b)}var z=document.createElement("IFRAME");z.setAttribute("frameborder",0);z.id="popupWindowFrame_"+this.currentInstance;z.name="popupWindowFrameName"+this.currentInstance;z.className="popupWindowFrame";if(typeof(f)=="object"){f.src="javascript:;"}else{z.src=f}z.width=q;z.height=h;z.frameborder="0";z.scrolling="yes";if(!m){z.style.display="none"}this.dialogsWindows[this.currentInstance]=z=u.appendChild(z);if(typeof(f)=="object"){if(f.tagName=="FORM"){f.target="popupWindowFrameName"+this.currentInstance;if(document.swapNode){f.submit()}else{setTimeout(function(G){return function(){G.submit()}}(f),1)}}else{setTimeout(function(G,H){return function(){G.fillContent(H)}}(f,z),1)}}if(!m){amiCommon.setEventHandler("load",z,function(H,G,I,K,J,M,L){return function(){I.style.display="none";G.style.display="block";G.contentWindow.popupInstanceId=K;G.contentWindow.oParameters=J;G.contentWindow.closeDialogWindow=function(){top.popupWindow.close(K)};G.contentWindow.clientAreaWidth=M;G.contentWindow.clientAreaHeight=L;G.contentWindow.parentWindow=H;if(typeof(G.contentWindow.onWindowShown)=="function"){setTimeout(function(N){return function(){N()}}(G.contentWindow.onWindowShown),0)}if(typeof(top.popupWindow.loadedDialogs[K])!="undefined"&&!top.popupWindow.loadedDialogs[K]){top.currentParentWindow=top.currentActiveWindow;top.currentActiveWindow=G.contentWindow;top.popupWindow.loadedDialogs[K]=true}}}(C,z,b,this.currentInstance,this.windowParameters[this.currentInstance],q,h))}else{amiCommon.setEventHandler("load",z,function(H,G,J,I,L,K){return function(){G.contentWindow.popupInstanceId=J;G.contentWindow.oParameters=I;G.contentWindow.closeDialogWindow=function(){top.popupWindow.close(J)};G.contentWindow.clientAreaWidth=L;G.contentWindow.clientAreaHeight=K;G.contentWindow.parentWindow=H;if(typeof(G.contentWindow.onWindowShown)=="function"){G.contentWindow.onWindowShown()}if(typeof(top.popupWindow.loadedDialogs[J])!="undefined"&&!top.popupWindow.loadedDialogs[J]){top.currentParentWindow=top.currentActiveWindow;top.currentActiveWindow=G.contentWindow;top.popupWindow.loadedDialogs[J]=true}}}(C,z,this.currentInstance,this.windowParameters[this.currentInstance],q,h))}var l=document.createElement("DIV");l.id="popupWindowFrameCover_"+this.currentInstance;l.className="popupWindowFrameCover";l.style.width=q+"px";l.style.height=h+"px";l.style.display="none";u.appendChild(l);flyPopupClose();if(AMI.Browser.isSensor||AMI.Browser.isLowResolution){this.aMobileIntervals[this.currentInstance]=setInterval(function(L,G,J,K,I,H){return function(){if(I.contentWindow){var N=I.offsetHeight;var M=Math.max(H,AMI.Browser.getDocumentHeight(I.contentWindow));if(M>H){I.style.height=M+"px";K.style.height=M+"px";J.style.height=M+"px";G.style.height=M+"px";L.style.height=M+40+"px"}}}}(A,oShadowLeft,oShadowRight,u,z,h),1500)}this.currentInstance++;this.numOpened++;return(this.currentInstance-1)};this.close=function(a){if((AMI.Browser.isSensor||AMI.Browser.isLowResolution)&&typeof(this.aMobileIntervals[a])!="undefined"&&this.aMobileIntervals[a]!=null){clearInterval(this.aMobileIntervals[a]);this.aMobileIntervals[a]=null}if(this.onBeforeCloseCallbacks[a]!=null){if(!this.onBeforeCloseCallbacks[a](this.loadedDialogs[a])){return}}document.getElementById("popupWindow_"+a).style.display="none";this.numOpened--;if(this.numOpened<0){this.numOpened=0}top.currentParentWindow=top;if(this.numOpened>0){document.getElementById("popupWindowShadowFrame").style.zIndex=10000+this.numOpened*3;document.getElementById("popupWindowShadow").style.zIndex=10000+this.numOpened*3+1;var f=1;for(var b=a-1;b>=0;b--){if(!this.closedDialogs[b]){if(f==1){top.currentActiveWindow=this.dialogsWindows[b].contentWindow;f++}else{if(f==2){top.currentParentWindow=this.dialogsWindows[b].contentWindow;break}}}}}else{document.getElementById("popupWindowShadow").style.display="none";document.getElementById("popupWindowShadowFrame").style.display="none";top.currentActiveWindow=window}this.closedDialogs[a]=true;this.dialogsWindows[a]=null;if(this.onCloseCallbacks[a]!=null){var c=document.getElementById("popupWindowFrame_"+a).contentWindow;if(typeof(c.returnValue)!="undefined"){c=c.returnValue}else{c=null}this.onCloseCallbacks[a](c,this.windowParameters[a])}var d=document.getElementById("popupWindowFrame_"+a);if(d!=null){d.parentNode.removeChild(d)}};this.closeAll=function(){for(var a in this.closedDialogs){if(!this.closedDialogs[a]){this.close(a)}}};this.initDoubleClick=function(g,a){this.currentMoved=a;g=amiCommon.getValidEvent(g);var c=g.ctrlKey;var b=g.shiftKey;var f=g.altKey;var d=0;if(c&&f){d=1;if(b){d=2}}if(d==0){return true}var k=document.getElementById("popupWindowFrame_"+a);var h=k.contentWindow.document.location.href;if(h.indexOf("srv_options.php")>=0){k.contentWindow.document.location.href=h+"&flt_god_mode="+(d==1?"1":"0")}amiCommon.stopEvent(g);return false};this.initMove=function(c,a){this.currentMoved=a;c=amiCommon.getValidEvent(c);var f=document.getElementById("popupWindow_"+a);var b=amiCommon.getMousePosition(c);var d=amiCommon.getElementPosition(f);this.currentMovedDeltaX=b[0]-d[0];this.currentMovedDeltaY=b[1]-d[1];document.getElementById("popupWindowFrameCover_"+this.currentMoved).style.display="block";amiCommon.setEventHandler("mousemove",document,popupWindowHandlerMove);amiCommon.setEventHandler("mouseup",document,popupWindowHandlerUp);amiCommon.stopEvent(c)};this.processMove=function(b){b=amiCommon.getValidEvent(b);if(b){if(this.currentMoved>=0){var d=document.getElementById("popupWindow_"+this.currentMoved);var a=amiCommon.getMousePosition(b);var c=amiCommon.getElementPosition(d);d.style.left=Math.max(22-d.offsetWidth,a[0]-this.currentMovedDeltaX)+"px";d.style.top=Math.max(-10,a[1]-this.currentMovedDeltaY)+"px"}amiCommon.stopEvent(b)}};this.stopMove=function(a){a=amiCommon.getValidEvent(a);amiCommon.removeEventHandler("mousemove",document,popupWindowHandlerMove);amiCommon.removeEventHandler("mouseup",document,popupWindowHandlerUp);document.getElementById("popupWindowFrameCover_"+this.currentMoved).style.display="none";this.currentMoved=-1;this.currentMovedDeltaX=0;this.currentMovedDeltaY=0;amiCommon.stopEvent(a)};this.isDialogClosed=function(a){if(typeof(this.closedDialogs[a])=="undefined"||this.closedDialogs[a]){return true}else{return false}}}popupWindow=new amiPopupWindow();function popupWindowHandlerMove(a){popupWindow.processMove(a)}function popupWindowHandlerUp(a){popupWindow.stopMove(a)}function amiUserDialog(){this.aTexts=null;this.aButtonCaptions=null;this.open=function(h,d,a,g,c,b,f){this.aTexts=g;this.aButtonCaptions=c;popupWindow.open(top.window,this,h,d,a,true,b,f)};this.fillContent=function(g){var f;var k="";for(f=0;f<this.aTexts.length;f++){var h=this.aTexts[f];var b=false;if(h.indexOf("[]")==0){h=h.replace(/^\[\]/i,'<input type="checkbox" class="userDialogCheckbox" name="check_choice[]" value="'+f+'" id="check_choice_'+f+'"><label for="check_choice_'+f+'">');b=true}else{if(h.indexOf("[*]")==0){h=h.replace(/^\[\*\]/i,'<input type="checkbox" class="userDialogCheckbox" name="check_choice[]" value="'+f+'" id="check_choice_'+f+'" checked><label for="check_choice_'+f+'">');b=true}else{if(h.indexOf("()")==0){h=h.replace(/^\(\)/i,'<input type="radio" class="userDialogRadio" name="radio_choice[]" value="'+f+'" id="radio_choice_'+f+'"><label for="radio_choice_'+f+'">');b=true}else{if(h.indexOf("(*)")==0){h=h.replace(/^\(\*\)/i,'<input type="radio" class="userDialogRadio" name="radio_choice[]" value="'+f+'" id="radio_choice_'+f+'" checked><label for="radio_choice_'+f+'">');b=true}}}}if(b){h+="</label>"}k+=h+"<br>"}var d="";for(f=0;f<this.aButtonCaptions.length;f++){d+=(d==""?"":" ")+'<input type="button" value="'+this.aButtonCaptions[f]+'" class="but" onClick="onButtonClick('+f+')">'}var a='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="content-type" content="text/html; charset='+documentCharset+'"><link rel="stylesheet" href="'+adminCSSFile+'" type="text/css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css"><script type="text/javascript">    var returnValue = new Array(new Array(), -1);    for(i = 0; i < '+this.aTexts.length+'; i++){ returnValue[0][i] = 0; }    function onButtonClick(isButton){        returnValue[1] = isButton;        var oForm = document.forms.variants;        for(var i = 0; i < oForm.elements.length; i++){            if((oForm.elements[i].type == "checkbox" || oForm.elements[i].type == "radio") && oForm.elements[i].checked){                returnValue[0][oForm.elements[i].value] = 1;            }        }        window.closeDialogWindow();    }<\/script></head><body class="userDialogBody"><div class="userDialogTexts"><form name="variants" style="margin: 0px; padding: 0px">'+k+'</form></div><br><div class="userDialogButtons" align="center">'+d+"</div></body></html>";var c=g.contentWindow.document;c.open();c.write(a);c.close()}}userDialog=new amiUserDialog();function amiFilledPopup(){this.sContent=null;this.open=function(d,c,a,b){this.sContent=b;popupWindow.open(top.window,this,d,c,a,true)};this.fillContent=function(b){var c='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="content-type" content="text/html; charset='+documentCharset+'"><link rel="stylesheet" href="'+adminCSSFile+'" type="text/css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css"></head><body class="userDialogBody"><div class="userDialogTexts">'+this.sContent+'</div><br><div class="userDialogButtons" align="center"></div></body></html>';var a=b.contentWindow.document;a.open();a.write(c);a.close()}}filledPopup=new amiFilledPopup();var cTabs=function(c,a,b){this.oBlock=null;this.aBlockTabs=new Array();this.aTabs=new Array();this.aActiveTabs=new Object();this.bAttachSupported=false;this.bAttachBreaks=new Object();this.tabLineBreak=null;this.initialized=false;this.init=function(n,m,q){this.initialized=false;this.oBlock=document.getElementById(n);if(typeof(q)=="undefined"){var q=true}if(this.oBlock!=null){var o=false;var p=null;var g=-1;for(idTab in m){g++}for(idTab in m){if(idTab==""){continue}this.aTabs[this.aTabs.length]=idTab;var f=document.createElement("div");f.id="tab-control-"+idTab;f.setAttribute("idTab",idTab);if(m[idTab][2]){f.setAttribute("title",m[idTab][2])}f.innerHTML='<div class="tab-caption"><div class="tab-left-side"></div><div class="tab-label" id="tab-control-'+idTab+'-label">'+m[idTab][0]+'</div><div class="tab-right-side"></div></div>';f.onmouseover=function(){if(this.className!="tab-active"&&this.className!="tab-disabled"){this.className="tab-over"}};f.onmouseout=function(){if(this.className=="tab-over"){this.className="tab-normal"}};f=this.oBlock.appendChild(f);f.onclick=function(u,v){return function(){u.selectTab(v,true,true)}}(this,f);var h=true;var t=false;if(q&&(g>1)){var k=true;if(k){this.bAttachSupported=true;var d=document.createElement("div");d.id="tab-attached-"+idTab;d.onclick=function(u,v){return function(w){u.attachTab(v);oEvents.stopEvent(w)}}(this,f);f.appendChild(d);if(m[idTab][3]){h=false;this.attachTabOn(f)}else{this.attachTabOff(f)}}}this.aBlockTabs.push(f);if(m[idTab][1]=="active"){if(!this.selectTab(f)){f.className="tab-normal";this.onTabSelected(idTab,false)}else{t=true;this.onTabSelected(idTab,true)}}else{this.onTabSelected(idTab,false)}f.className="tab-"+m[idTab][1];if(this.bAttachSupported){var s=amiCookies.get(this.getTabAttachCookieName(idTab));if(s!=null){this.attachTab(f,s==1?"on":"off");if(s==1){h=false;t=false}}}if(h&&p==null){p=f}if(t){o=true}}var l=document.createElement("br");l.setAttribute("clear","all");this.tabLineBreak=this.oBlock.appendChild(l);var d=document.createElement("div");d.className="tab-bottom";this.oBlock.appendChild(d);if(!o&&p!=null){this.selectTab(p,false)}}this.reloadForm();this.initialized=true};this.parseHashBangArgs=function(g){g=g||window.location.hash;var k={};var d=g.slice(g.indexOf("#")+1).split("&");for(var f=0;f<d.length;f++){var h=d[f].split("=");if(h.length>1){k[h[0]]=h[1]}else{k[h[0]]=null}}return k};this.saveTab=function(d){var g=this.parseHashBangArgs();if(typeof(g.id)!="undefined"){var f=AMI.Cookie.getModPath();AMI.Cookie.set("ami_tab",d,3600,f,true);AMI.Cookie.save(true,true)}};this.reloadForm=function(){if(typeof(window.listernerAdded)=="undefined"){AMI.Message.addListener("ON_COMPONENT_CONTENT_PLACED",function(d){return function(f){if(f.componentType=="form"){d.restoreTab()}return true}}(this),true);window.listernerAdded=true}};this.restoreTab=function(){if(typeof(baseTabs)=="undefined"){return}var h=baseTabs.parseHashBangArgs();if((typeof(h.id)!="undefined")&&(h.id!="")){if(AMI.Cookie.get("ami_tab")!=null){var f=AMI.Cookie.get("ami_tab");var d=baseTabs.aTabs.indexOf(f);if(d>=0){var g=AMI.$("#"+baseTabs.aBlockTabs[d].id).attr("attached");if(g!="on"){baseTabs.selectTab(baseTabs.aBlockTabs[d])}}}}};this.getTabAttachCookieName=function(f){var d=module_name||"notmodule";return"bTabAttached."+d+"."+f};this.selectTab=function(o,f,p){if(typeof(p)=="undefined"){p=false}if(typeof(f)=="undefined"){f=true}if(this.oBlock!=null){if(o.className!="tab-disabled"){var d=o.getAttribute("idTab");var m=0;for(var k in this.aActiveTabs){m++}if(o.className=="tab-active"){if(m>1){var h=true;var n=-1;for(var k=0;k<this.aTabs.length;k++){if(this.aTabs[k]==d){n=k}else{var g=document.getElementById("tab-control-"+this.aTabs[k]);if(g.className!="tab-disabled"&&g.getAttribute("attached")!="on"&&this.isTabActive(this.aTabs[k])){h=false;break}}}if(!h||n<0){if(!this.onTabSelected(d,false)){return false}o.className="tab-normal";delete this.aActiveTabs[d]}this.attachTabOff(o);return false}}else{if(!this.onTabSelected(d,true)){return false}var l=new Object();for(var k in this.aActiveTabs){if(this.aActiveTabs[k]&&(this.aActiveTabs[k].getAttribute("attached")!="on")){if(f&&this.onTabSelected(this.aActiveTabs[k].getAttribute("idTab"),false)){this.aActiveTabs[k].className="tab-normal"}else{l[this.aActiveTabs[k].getAttribute("idTab")]=this.aActiveTabs[k]}}else{l[this.aActiveTabs[k].getAttribute("idTab")]=this.aActiveTabs[k]}}this.aActiveTabs=l;o.className="tab-active";this.aActiveTabs[d]=o;if(p){this.saveTab(d)}return true}}}};this.showTab=function(d){this.setTabState(d,"active")};this.isTabActive=function(d){for(var f in this.aActiveTabs){if(this.aActiveTabs[f].getAttribute("idTab")==d){return true}}return false};this.setTabState=function(d,f){for(i=0;i<this.aBlockTabs.length;i++){if(this.aBlockTabs[i].getAttribute("idTab")==d){if(f=="active"){this.selectTab(this.aBlockTabs[i])}else{if(f=="normal"){this.attachTabOff(this.aBlockTabs[i]);this.aBlockTabs[i].className="tab-normal";delete this.aActiveTabs[d]}else{if(f=="disabled"){this.attachTabOff(this.aBlockTabs[i]);this.aBlockTabs[i].className="tab-disabled";delete this.aActiveTabs[d]}}}}}};this.attachTab=function(d,g){if(this.oBlock!=null&&this.bAttachSupported){var f=d.getAttribute("attached")!="on";if(typeof(g)!="undefined"){f=g=="on"}if(!f){this.attachTabOff(d);amiCookies.set(this.getTabAttachCookieName(d.getAttribute("idTab")),"0","/",1,0);if(d.className!="tab-normal"){this.selectTab(d,false)}}else{this.attachTabOn(d);amiCookies.set(this.getTabAttachCookieName(d.getAttribute("idTab")),"1","/",1,0);if(d.className!="tab-active"){this.selectTab(d,false)}}}};this.attachTabOn=function(o){if(this.oBlock!=null&&this.bAttachSupported){o.setAttribute("attached","on");document.getElementById("tab-attached-"+o.getAttribute("idTab")).className="tab-attached tab-attached-on";var d=o.getAttribute("idTab");var h=this.isTabActive(d);var m=document.getElementById("tab-page-"+d);var p=null;var f=false;for(var k=0;k<this.aTabs.length;k++){if(this.aTabs[k]==d){f=true}else{if(f){var g=document.getElementById("tab-control-"+this.aTabs[k]);if(g.getAttribute("attached")=="on"){p=g;break}}}}var l=this.fixIframeBugBeforeMoving(m);if(p){m=p.parentNode.insertBefore(m,p)}else{m=m.parentNode.appendChild(m)}m.parentNode.insertBefore(o,m);if(l!=null){if(this.initialized){l.reInitIframe()}}var n=document.createElement("br");n.setAttribute("clear","all");this.bAttachBreaks[d]=m.parentNode.insertBefore(n,m);if(h){iCurrentTabIndex=-1;for(var k=0;k<this.aTabs.length;k++){if(this.aTabs[k]==d){iCurrentTabIndex=k}else{if(iCurrentTabIndex>=0){var g=document.getElementById("tab-control-"+this.aTabs[k]);if(!this.isTabActive(this.aTabs[k])&&g.className!="tab-disabled"){this.setTabState(this.aTabs[k],"active");this.saveTab(this.aTabs[k]);iCurrentTabIndex=-1;break}}}}if(iCurrentTabIndex!=-1&&iCurrentTabIndex!=0){for(var k=iCurrentTabIndex-1;k>=0;k--){var g=document.getElementById("tab-control-"+this.aTabs[k]);if(!this.isTabActive(this.aTabs[k])&&g.className!="tab-disabled"){this.setTabState(this.aTabs[k],"active");this.saveTab(this.aTabs[k]);iCurrentTabIndex=-1;break}}}}}};this.attachTabOff=function(o){if(this.oBlock!=null&&this.bAttachSupported){o.setAttribute("attached","off");var f=document.getElementById("tab-attached-"+o.getAttribute("idTab"));if(f!=null){f.className="tab-attached tab-attached-off";var d=o.getAttribute("idTab");var p=this.tabLineBreak;var g=false;for(var k=0;k<this.aTabs.length;k++){if(this.aTabs[k]==d){g=true}else{if(g){var h=document.getElementById("tab-control-"+this.aTabs[k]);if(h.getAttribute("attached")!="on"){p=h;break}}}}if(p!=null){try{this.oBlock.insertBefore(o,p)}catch(n){}}if(this.bAttachBreaks[d]){this.bAttachBreaks[d].parentNode.removeChild(this.bAttachBreaks[d]);this.bAttachBreaks[d]=null}var m=document.getElementById("tab-page-"+d);var l=this.fixIframeBugBeforeMoving(m);m=m.parentNode.insertBefore(m,m.parentNode.firstChild);if(l!=null){if(this.initialized){l.reInitIframe()}}}}};this.fixIframeBugBeforeMoving=function(d){var k=null;if(!bIsIE||(bIsIE&&parseInt(navigator.appVersion.match(/MSIE ([\d.]+)/)[1])>=9)){var g=d.getElementsByTagName("iframe");if(g.length==1&&g[0].id){var f=g[0].id.indexOf("_editor");if(f>0){var h=document.getElementById(g[0].id.substr(0,f));if(h!=null&&h.editorAttached){k=h.editorObject;if(k.currentMode=="editor"&&h.editorInitialized){k.transportTextFromEditorToTextarea(true)}}}}}return k};this.onTabSelected=function(d,g){if(typeof(onTabSelectedCustom)=="function"){if(!onTabSelectedCustom(d,g)){return false}}var f=document.getElementById("tab-page-"+d);if(f!=null){f.style.display=g?"block":"none"}return true};this.init(c,a,b)};function amiSuggestions(b,a,c){this.minimumFieldTextLength=3;this.fillRowsTimeout=400;this.htmlEncoding="autodetect";this.fieldId=b;this.fieldObject=null;this.suggestionId=b+"_suggestion";this.suggestionObject=null;this.suggestionObjectShown=false;this.useSuggestionIframe=document.swapNode;this.suggestionIframeObject=null;this.allowProcessing=true;this.showCauseOfArrows=false;this.rowObjects=new Array();this.currentRow=-1;this.fillTimeout=null;this.dataType=a;this.itemsSplitter=typeof(c)!="undefined"?c:"";this.lastFieldValueLength=0;this.doStoreFieldValue=true;this.isFieldValueModified=false;this.storedFieldValue="";this.fieldLeadingSpaces="";this.itemInitialCaretPosition=0;this.itemEndCaretPosition=0;this.init=function(){this.fieldObject=document.getElementById(this.fieldId);this.storedFieldValue=this.fieldObject.value;this.lastFieldValueLength=this.storedFieldValue.length;amiCommon.setEventHandler("mousedown",this.fieldObject,function(d){return function(f){d.onFieldMouseDown(f)}}(this));amiCommon.setEventHandler("keydown",this.fieldObject,function(d){return function(f){d.onFieldKeyDown(f)}}(this));amiCommon.setEventHandler("keyup",this.fieldObject,function(d){return function(f){d.onFieldKeyUp(f)}}(this));amiCommon.setEventHandler("blur",this.fieldObject,function(d){return function(f){d.onFieldBlur(f)}}(this))};this.onFieldMouseDown=function(d){if((this.showCauseOfArrows||this.allowProcessing)&&this.suggestionObjectShown&&this.itemsSplitter!=""){this.hideSuggestionObject()}return true};this.onFieldKeyDown=function(d){d=amiCommon.getValidEvent(d);if(d.keyCode==38||d.keyCode==40){amiCommon.stopEvent(d)}if(!this.allowProcessing&&!this.showCauseOfArrows){return true}if(this.suggestionObjectShown){if(d.keyCode==38||d.keyCode==40){if(this.doStoreFieldValue){this.storedFieldValue=this.fieldObject.value;this.doStoreFieldValue=false}var f=this.currentRow+(d.keyCode==40?1:-1);if(f>this.rowObjects.length-1){f=-1}else{if(f<-1){f=this.rowObjects.length-1}}this.selectRow(f,true)}else{if(d.keyCode==27){this.resetFieldText();this.closeSuggestionObject();amiCommon.setCaretPosition(this.fieldObject,this.itemInitialCaretPosition);amiCommon.stopEvent(d)}else{if(d.keyCode==13){this.doStoreFieldValue=true;this.hideSuggestionObject();amiCommon.setCaretPosition(this.fieldObject,this.itemEndCaretPosition);amiCommon.stopEvent(d)}else{if(this.itemsSplitter!=""&&(d.keyCode==35||d.keyCode==36||d.keyCode==37||d.keyCode==39)){this.hideSuggestionObject()}}}}}return true};this.onFieldKeyUp=function(g){g=amiCommon.getValidEvent(g);var f=false;if(!this.showCauseOfArrows){this.showCauseOfArrows=(!this.suggestionObjectShown&&(g.keyCode==38||g.keyCode==40));f=this.showCauseOfArrows}if(!this.allowProcessing&&!this.showCauseOfArrows){return true}if(g.keyCode==27||g.keyCode==13){return false}if(this.lastFieldValueLength!=this.fieldObject.value.length){this.doStoreFieldValue=true;this.lastFieldValueLength=this.fieldObject.value.length}else{if(!f){return false}}var d=this.getEditedItemText();if(d.length>=this.minimumFieldTextLength){this.itemInitialCaretPosition=amiCommon.getCaretPosition(this.fieldObject);if(this.suggestionObject==null){this.createSuggestionObject()}clearTimeout(this.fillTimeout);if(f){this.fillRows()}else{this.fillTimeout=setTimeout(function(h){return function(){h.fillRows()}}(this),this.fillRowsTimeout)}}else{this.hideSuggestionObject()}return true};this.onFieldBlur=function(d){if(!this.allowProcessing&&!this.showCauseOfArrows){return true}this.hideSuggestionObject();return true};this.onSuggestionObjectClick=function(d){d=amiCommon.getValidEvent(d);var f=amiCommon.getEventTarget(d);if(f.tagName){if(f.tagName=="A"&&f.className=="suggestionClose"){this.resetFieldText();this.closeSuggestionObject();amiCommon.setCaretPosition(this.fieldObject,this.itemInitialCaretPosition);amiCommon.stopEvent(d)}else{if(f.tagName=="DIV"&&f.className.indexOf("suggestionRow")==0){currentIndex=f.getAttribute("rowIndex");this.selectRow(currentIndex,true);this.hideSuggestionObject()}}}return true};this.createSuggestionObject=function(){contentDiv=document.createElement("div");contentDiv.id=this.suggestionId;contentDiv.className="suggestionDiv";var d=amiCommon.getElementPosition(this.fieldObject);contentDiv.style.left=d[0]+"px";contentDiv.style.top=d[1]+this.fieldObject.offsetHeight+"px";contentDiv.style.height="12px";contentDiv.onmousedown=function(f){return function(g){f.onSuggestionObjectClick(g)}}(this);this.suggestionObject=document.body.appendChild(contentDiv)};this.adjustHeight=function(){this.suggestionObject.style.height=(this.rowObjects.length*15+15+7)+"px"};this.adjustIframeHeight=function(){if(this.useSuggestionIframe){this.suggestionIframeObject.style.height=this.suggestionObject.offsetHeight}};this.showSuggestionObject=function(){if(!this.suggestionObjectShown&&this.suggestionObject!=null){this.selectRow(-1,false);this.suggestionObject.style.display="block";this.suggestionObjectShown=true;if(this.useSuggestionIframe){if(this.suggestionIframeObject==null){this.suggestionIframeObject=document.createElement("iframe");this.suggestionIframeObject.src="javascript:;";this.suggestionIframeObject.className="suggestionIframe";this.suggestionIframeObject.style.left=this.suggestionObject.style.left;this.suggestionIframeObject.style.top=this.suggestionObject.style.top;this.suggestionIframeObject.style.width=this.suggestionObject.offsetWidth+"px";this.suggestionIframeObject.style.height=this.suggestionObject.offsetHeight+"px";this.suggestionIframeObject=document.body.appendChild(this.suggestionIframeObject)}else{this.suggestionIframeObject.style.display="block"}}}};this.hideSuggestionObject=function(){this.showCauseOfArrows=false;clearTimeout(this.fillTimeout);if(this.suggestionObjectShown&&this.suggestionObject!=null){this.suggestionObject.style.display="none";this.suggestionObjectShown=false;if(this.useSuggestionIframe){this.suggestionIframeObject.style.display="none"}}};this.closeSuggestionObject=function(){this.allowProcessing=false;this.hideSuggestionObject()};this.fillRows=function(){amiAjax.getContent("GET",ajaxProcessURL+"?html_encoding="+encodeURIComponent(this.getHTMLEncoding())+"&type=suggest&data_type="+this.dataType+"&data_language="+dataLanguage+"&current_value="+encodeURIComponent(this.getEditedItemText()),"",function(d){return function(g,f){d.fillRowsCallback(g,f)}}(this))};this.fillRowsCallback=function(g,m){var q=false;if(g==1){var v=m.charAt(0);if(v=="0"||v=="1"){var n=m.charAt(1);var s=m.charAt(2);m=m.substr(3);var p=this.getEditedItemText();var t=new Array();var l=new Array();var f=new Array();if(m.length){var h=m.split(n);for(i=0;i<h.length;i++){if(v){var d=h[i].split(s);t[t.length]=d[0];l[l.length]=d[1]}else{t[t.length]=h[i];l[l.length]=""}f[f.length]=t[i]==p}}this.currentRow=-1;this.rowObjects=new Array();this.suggestionObject.innerHTML="";if(t.length>0){for(i=0;i<t.length;i++){this.appendRow(t[i],l[i],f[i],v)}var k=document.createElement("a");k.className="suggestionClose";k.href="javascript:void(0)";k.innerHTML=staticJSTranslations.suggestionCloseLink;var o=document.createElement("div");o.className="suggestionClose";o.appendChild(k);this.suggestionObject.appendChild(o);var u=document.createElement("div");u.className="suggestionMinWidth";u.style.width=this.fieldObject.offsetWidth-3+"px";this.suggestionObject.appendChild(u);this.adjustHeight();this.showSuggestionObject();this.adjustIframeHeight()}else{this.hideSuggestionObject()}}}};this.appendRow=function(f,h,l,g){var d=this.rowObjects.length;var k=document.createElement("div");k.id=this.fieldId+"_suggestionItem_"+d;k.className="suggestionRow"+(l?" suggestionRowExact":"");if(g){k.innerHTML='<div class="suggestionRowText">'+f+'</div><font class="suggestionCounter">'+h+"</font>"}else{k.innerHTML='<div class="suggestionRowTextOnly">'+f+"</div>"}k.setAttribute("rowIndex",d);k.setAttribute("rowValue",f);k.setAttribute("rowExact",l?"1":"0");k.onmouseover=function(m,n){return function(){m.selectRow(n,false)}}(this,d);this.rowObjects[d]=this.suggestionObject.appendChild(k)};this.selectRow=function(f,d){if(this.currentRow>=0){this.rowObjects[this.currentRow].className="suggestionRow"+(this.rowObjects[this.currentRow].getAttribute("rowExact")=="1"?" suggestionRowExact":"")}if(f>=0){this.rowObjects[f].className="suggestionRowSelected"+(this.rowObjects[f].getAttribute("rowExact")=="1"?" suggestionRowExact":"")}if(d){if(f>=0){this.setItemText(this.rowObjects[f].getAttribute("rowValue"));this.lastFieldValueLength=this.fieldObject.value.length;this.isFieldValueModified=true}else{this.resetFieldText()}}this.currentRow=f};this.resetFieldText=function(){if(this.isFieldValueModified){var d=amiCommon.getCaretPosition(this.fieldObject);this.fieldObject.value=this.storedFieldValue;amiCommon.setCaretPosition(this.fieldObject,d);this.lastFieldValueLength=this.fieldObject.value.length}};this.getEditedItemText=function(){var f="";if(this.itemsSplitter!=""){var k=this.itemsSplitter.length;var l=amiCommon.getCaretPosition(this.fieldObject);var d=this.fieldObject.value.split(this.itemsSplitter);var h=0;for(var g=0;g<d.length;g++){h+=d[g].length+(g>0?k:0);if(h>=l){f=d[g];break}}}else{f=this.fieldObject.value}f=f.replace(/^( *)(.*) *$/,function(m){return function(o,n,p){m.fieldLeadingSpaces=n;return p}}(this));return f};this.setItemText=function(f){if(this.itemsSplitter!=""){var k=this.itemsSplitter.length;var n=amiCommon.getCaretPosition(this.fieldObject);var l=this.fieldObject.value.split(this.itemsSplitter);var h=0;var m=false;var o="";for(var g=0;g<l.length;g++){h+=l[g].length+(g>0?k:0);var d=l[g];if(!m&&h>=n){d=this.fieldLeadingSpaces+amiCommon.decodeHTMLSpecialChars(f);m=true;this.itemEndCaretPosition=h+d.length-l[g].length}o+=(o!=""?this.itemsSplitter:"")+d}this.fieldObject.value=o;amiCommon.setCaretPosition(this.fieldObject,n)}else{this.fieldObject.value=this.fieldLeadingSpaces+amiCommon.decodeHTMLSpecialChars(f);this.itemEndCaretPosition=this.fieldObject.value.length}};this.getHTMLEncoding=function(){if(this.htmlEncoding=="autodetect"){this.htmlEncoding="";var f=document.getElementsByTagName("meta");for(i=0;i<f.length;i++){if(f[i].httpEquiv&&f[i].content&&f[i].httpEquiv.toLowerCase()=="content-type"){var d=f[i].content.match(/charset=\s*([^ ]*)/i);if(d!=null&&d.length>=2){this.htmlEncoding=d[1]}}}}return this.htmlEncoding};this.init()}var aCEInstances=[];var aCEInitialized=[];function addCE(b){var a=getCE(b.textareaName,false);if(a==null){aCEInstances.push(b)}else{aCEInstances[a]=b}}function getCE(c,a){if(typeof(a)=="undefined"){a=true}for(var b=0;b<=aCEInstances.length;b++){if(typeof(aCEInstances[b])!="undefined"&&aCEInstances[b].textareaName==c){return a?aCEInstances[b]:b}}return null}Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};amiHTMLEditor=function(textareaName,options,visible,width,height,modes){this.cmInitialized=false;this.currentElementId=0;this.useSpecialCharsFeature=true;this.cePageBreakActivated=false;this.cookieLifeTime=36000;this.textareaName=textareaName;this.options=typeof(options)=="undefined"?0:options;this.visible=visible;this.width=width;this.height=height;this.content="";this.currentMode="textarea";this.editorObject=null;this.textareaObject=null;this.editorDocument=null;this.lastToolbarPath="";this.lastToolbarActiveButtonsHash="";this.allowedModes=(typeof(modes)=="undefined"||!modes.length)?["editor","bb","textarea"]:modes;this.noModeCookies=false;this.storedBookmark=null;this.sessionData=new Object();this.buttonSimple=null;this.buttonArrow=null;this.buttons=new Object();this.buttonStates=new Object();this.foreColor=null;this.backColor=null;this.language=interface_lang=="en"?"en":"ru";this.isWebKit=false;this.isIE=false;this.isFF=false;this.isOpera=false;this.highlighter=null;this.javascriptContent=new Array();this.flashContent=new Array();this.gadgetContent=new Array();this.hasInitQueue=false;this.reInitIndex=0;this.selStartMark="SPEC_HTML_EDITOR_SELECTION_START";this.selEndMark="SPEC_HTML_EDITOR_SELECTION_END";this.contentChanged=false;this.skipChanges=false;this.originalHTML="";this.prevValues={textarea:null,bb:null,editor:null};this.init=function(){this.isWebKit=/WebKit/.test(navigator.userAgent);this.isFF=!this.isWebKit&&/Gecko/.test(navigator.userAgent);this.isIE=typeof(document.swapNode)!="undefined";this.isOpera=AMI.Browser.isOpera;this.textareaObject=document.getElementById(textareaName);this.textareaObject.className="htmlEditorTextarea";this.prepareGadgetsCode();this.originalHTML=this.textareaObject.value;this.content=this.parseHTMLCode(this.textareaObject.value,false);if(!this.width){if(this.textareaObject.style.width){this.width=this.textareaObject.style.width}else{if(this.textareaObject.cols){this.width=this.textareaObject.cols*8+22}else{this.width="100%"}}}if(!this.height){if(this.textareaObject.style.height){this.height=this.textareaObject.style.height}else{if(this.textareaObject.rows){this.height=this.textareaObject.rows*12}else{if(this.textareaObject.offsetHeight){this.height=this.textareaObject.offsetHeight}else{this.height="300px"}}}}this.width=formatStyleSize(this.width);this.height=this.getOpt("height",formatStyleSize(this.height));this.textareaObject.style.width=this.width;this.textareaObject.style.height=this.height;this.bindGadgetCopyPaste(this.textareaObject);var changeMode=document.createElement("DIV");changeMode.className="htmlEditorModes";if(this.allowedModes.indexOf("editor")>=0){var modeEditor=document.createElement("BUTTON");modeEditor.className="htmlEditorModeBtn ce_visual";modeEditor.innerHTML=editorTranslation.modeEditor;AMI.Browser.Event.addHandler(modeEditor,"click",function(_this){return function(e){_this.actionEditorMode(true,e)}}(this));AMI.Browser.Event.addHandler(modeEditor,"mouseover",function(button){return function(e){AMI.addClass(button,"mouseover")}}(modeEditor));AMI.Browser.Event.addHandler(modeEditor,"mouseout",function(button){return function(e){AMI.removeClass(button,"mouseover")}}(modeEditor));this.modeEditorButton=modeEditor;changeMode.appendChild(modeEditor)}if(this.allowedModes.indexOf("bb")>=0){var modeBB=document.createElement("BUTTON");modeBB.className="htmlEditorModeBtn ce_bb";modeBB.innerHTML=editorTranslation.modeBB;AMI.Browser.Event.addHandler(modeBB,"click",function(_this){return function(e){_this.actionBBMode(true,e)}}(this));AMI.Browser.Event.addHandler(modeBB,"mouseover",function(button){return function(e){AMI.addClass(button,"mouseover")}}(modeBB));AMI.Browser.Event.addHandler(modeBB,"mouseout",function(button){return function(e){AMI.removeClass(button,"mouseover")}}(modeBB));this.modeBBButton=modeBB;changeMode.appendChild(modeBB)}if(this.allowedModes.indexOf("textarea")>=0){var modeTextarea=document.createElement("BUTTON");modeTextarea.className="htmlEditorModeBtn ce_html";modeTextarea.innerHTML=editorTranslation.modeTextarea;AMI.Browser.Event.addHandler(modeTextarea,"click",function(_this){return function(e){_this.actionTextareaMode(true,e)}}(this));AMI.Browser.Event.addHandler(modeTextarea,"mouseover",function(button){return function(e){AMI.addClass(button,"mouseover")}}(modeTextarea));AMI.Browser.Event.addHandler(modeTextarea,"mouseout",function(button){return function(e){AMI.removeClass(button,"mouseover")}}(modeTextarea));this.modeTextareaButton=modeTextarea;changeMode.appendChild(modeTextarea)}this.changeModeDiv=changeMode;this.textareaObject.parentNode.insertBefore(this.getToolbar(),this.textareaObject);this.bbObject=document.createElement("DIV");this.bbObject.id=this.textareaName+"_bb_wrapper";this.bbObject.style.display="none";this.editorObject=document.createElement("iframe");this.editorObject.src="about:blank";this.editorObject.id=this.textareaName+"_editor";this.editorObject.className="htmlEditorFrame";this.editorObject.width=this.width;this.editorObject.height=this.height;this.editorObject.setAttribute("frameborder","0");this.opacityBg=document.createElement("DIV");this.opacityBg.className="editor_opacity_bg";this.hlHTML=(this.getOpt("hlHTML","on")=="on");this.hlBB=(this.getOpt("hlBB","on")=="on");if(AMI.Browser.isIE){var version=parseFloat(navigator.appVersion.split("MSIE")[1]);if(version<9){this.hlHTML=false;this.hlBB=false}}this.wrHTML=(this.getOpt("wrHTML","off")=="on");this.wrBB=(this.getOpt("wrBB","off")=="on");this.addHighlighterCheckboxes();this.wrapper=document.createElement("DIV");this.wrapper.style.width=this.width;this.wrapper.style.height=this.height;this.wrapper.style.position="relative";this.wrapper.style.marginBottom="14px";this.wrapper=this.textareaObject.parentNode.insertBefore(this.wrapper,this.textareaObject);this.wrapper.appendChild(this.editorObject);this.wrapper.appendChild(this.textareaObject);this.wrapper.appendChild(this.bbObject);this.txtEd=initializeBBEditor(this.bbObject.id,this.textareaName+"_bb");this.txtEd.toolbarObj.style.display="none";this.txtEd.editorObj.style.width=this.width;this.txtEd.editorObj.style.height=this.height;this.txtEd.editorDiv.style.width="100%";this.txtEd.setCEMode(this);this.bindGadgetCopyPaste(this.txtEd.editorObj);this.addBBToolbarButtons();this.resizer=document.createElement("DIV");this.resizer.id=this.textareaName+"_editor";this.resizer.className="ce_resize_corner";AMI.Browser.Event.addHandler(this.resizer,"mousedown",function(_this){return function(e){_this.startResize(e)}}(this));this.wrapper.appendChild(this.resizer);this.bottomSpace=document.createElement("DIV");this.bottomSpace.className="ce_bottom_space";this.wrapper.appendChild(this.bottomSpace);this.wrapperSizeAdjusted=false;this.wrapperAdjustCounter=0;this.wrapperAdjuster=setInterval(function(_this){return function(){_this.wrapperAdjustCounter++;if(!_this.wrapperSizeAdjusted&&_this.cmInitialized){var offsetWidth=_this.wrapper.offsetWidth;if(offsetWidth){_this.wrapper.style.width=offsetWidth+"px";_this.wrapperSizeAdjusted=true;clearInterval(_this.wrapperAdjuster);if(_this.wrapperAdjustCounter>30){if(_this.currentMode=="bb"){_this.hlBBEditor(false,true);_this.hlBBEditor(true,true)}if(_this.currentMode=="textarea"){_this.hlTextarea(false,true);_this.hlTextarea(true,true)}}}}}}(this),50);this.loader=document.createElement("DIV");this.loader.style.zIndex=10000;this.loader.style.position="absolute";this.loader.style.background="url(images/custom_/loading.gif) 50% 50% no-repeat white";this.loader.style.top="0px";this.loader.style.left="0px";this.loader.style.width=this.wrapper.style.width;this.loader.style.height=this.wrapper.style.height;this.loader.style.display="block";this.wrapper.appendChild(this.loader);this.lastScrollPosition=0;this.scrollPositionChanged=false;this.showFrames=this.getOpt("htmlEditorShowBorders",1);this.framesCorrected=false;this.txtEd.editorObj.style.resize="none";this.textareaObject.style.resize="none";this.textareaObject.style.display="none";this.textareaObject.editorAttached=true;this.textareaObject.editorObject=this;this.ceIndex=aCEInstances.length+1;addCE(this);this.initInterval=setInterval(function(_this){return function(){if((_this.ceIndex==1)||aCEInitialized.indexOf(_this.ceIndex-1)>=0){setTimeout(function(__this){return function(){__this.setEditorContent()}}(_this),150);clearInterval(_this.initInterval)}}}(this),50);AMI.Browser.Event.addHandler(document.body,"click",function(_this){return function(){_this.hideSpecblockMenu()}}(this));var oTreeFrame=document.getElementById("treeframe");if(oTreeFrame!=null&&oTreeFrame.contentWindow){AMI.Browser.Event.addHandler(oTreeFrame.contentWindow,"mousedown",function(_this){return function(){_this.hideSpecblockMenu()}}(this))}};this.reInitIframe=function(){this.hasInitQueue=true;if(!this.textareaObject.editorInitialized){this.reInitIndex++;if(this.reInitIndex>10){this.reInitIndex=0;this.textareaObject.editorInitialized=true}setTimeout(function(){this.reInitIframe()}.bind(this),100)}else{this.reInitIndex=0;this.hasInitQueue=false;this.editorObject.src="about:blank";this.textareaObject.editorInitialized=false;this.content=this.parseHTMLCode(this.textareaObject.value,false);setTimeout(function(){this.setEditorContent()}.bind(this),20)}};this.setEditorContent=function(){var bInitialized=false;if(this.editorObject!=null){if(this.editorObject.contentWindow!=null){this.editorDocument=this.editorObject.contentWindow.document;var editorReadyState=this.editorDocument.readyState||"complete";if(editorReadyState=="uninitialized"){this.editorDocument.location.href="about:blank"}if(editorReadyState=="complete"){setTimeout(function(_this){return function(){var skelHTMLCode='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="content-type" content="text/html; charset='+documentCharset+'"><base href="'+editorBaseHref+'">'+(!(_this.options&cmD_CSS)?'<link id=ce_front_css rel="stylesheet" href="'+addParameterToUrl(frontCSSFile,"_cv",cms_version)+'" type="text/css"><link id=ce_custom_css rel="stylesheet" href="'+addParameterToUrl(frontCustomCSSFile,"_cv",cms_version)+'" type="text/css">':"")+'<link id=ce_dynamic_css rel="stylesheet" href="'+addParameterToUrl(ceDynamicCSSFile,"_cv",cms_version)+'" type="text/css"><link id=ce_spec_css rel="stylesheet" href="'+addParameterToUrl(specCSSFile,"_cv",cms_version)+'" type="text/css"><link rel="stylesheet" href="'+addParameterToUrl(ceCSSFile,"_cv",cms_version)+'" type="text/css"></head><body topmargin=1 leftmargin=1 id="'+(typeof(_cms_selected_layout_block)!="undefined"?_cms_selected_layout_block:_this.textareaName)+'" onload="window.parent.getCE(\''+_this.textareaName+'\').finalizeInit();" contenteditable="true">'+_this.content+"</body></html>";if(_this.editorObject.contentWindow!=null){_this.editorDocument=_this.editorObject.contentWindow.document}_this.editorDocument.open();_this.editorDocument.write(skelHTMLCode);_this.editorDocument.close()}}(this),!this.cmInitialized?300*this.ceIndex:1);bInitialized=true}}}if(!bInitialized){setTimeout(function(){this.setEditorContent()}.bind(this),50)}};this.finalizeInit=function(){this.editorDocument.designMode="on";if(AMI.Browser.isSensor){setTimeout(function(_this){return function(){if(_this.currentMode=="editor"){_this.actionSwitchMode(false)}}}(this),300)}this.checkEditor();if(!this.cmInitialized){this.skipChanges=true;var parentDisplay=AMI.$(this.textareaObject).parents(".tab-page").css("display");var currentMode=this.getOpt("mode",this.allowedModes[0]);this.noModeCookies=true;var oldHlHTML=this.hlHTML;this.hlHTML=false;this.editorObject.style.display="none";this.textareaObject.style.display="none";this.bNoFocus=true;this.prevValues.textarea=this.textareaObject.value;this.actionBBMode(false);this.prevValues.bb=this.txtEd.editorObj.value;this.skipChanges=true;this.bNoFocus=false;this.hlHTML=oldHlHTML;this.noModeCookies=false;setTimeout(function(_this,_currentMode){return function(){_this.prevValues.editor=_this.editorDocument.body.innerHTML;_this.bNoFocus=true;_this.currentMode="";_this.noModeCookies=true;switch(_currentMode){case"bb":break;case"textarea":_this.actionTextareaMode(false);break;default:_this.actionEditorMode(false);break}_this.skipChanges=true;_this.textareaObject.value=_this.originalHTML;if(_this.currentMode=="textarea"){if(_this.highlighter.oEditor){_this.highlighter.oEditor.setValue(_this.originalHTML)}}_this.editorDocument.body.innerHTML=_this.prevValues.editor;_this.noModeCookies=false;_this.bNoFocus=false;_this.restoreScrollPosition();_this.skipChanges=false;_this.loader.style.display="none"}}(this,currentMode),200);this.cmInitialized=true;aCEInitialized.push(this.ceIndex)}else{this.textareaObject.editorInitialized=true}setInterval(function(_this){return function(){_this.saveLastScrollPosition()}}(this),5000);setTimeout(function(){this.initEditorToolbar()}.bind(this),5)};this.hlTextarea=function(state,nofocus){this.checkEditor();if(this.currentMode!="textarea"){return}if(this.hlHTML){if(typeof(state)=="undefined"){state=true}if(typeof(nofocus)=="undefined"){nofocus=this.bNoFocus}if(state){this.highlighter.highlight(true,nofocus?true:false);var cmWrapper=this.highlighter.oEditor.getWrapperElement();cmWrapper.style.marginTop="0px";cmWrapper.style.border="0px none transparent";if((this.highlighter!=null)&&this.highlighter.oEditor){this.highlighter.setSize(this.wrapper.offsetWidth+"px",this.wrapper.offsetHeight+"px");if(!nofocus){this.highlighter.oEditor.focus()}}}else{this.highlighter.highlight(false,nofocus?true:false);this.textareaObject.style.width=this.wrapper.style.width;this.textareaObject.style.height=this.wrapper.style.height}if(this.highlighter.oEditor){this.bindGadgetCopyPaste(this.highlighter.oEditor.getInputField())}}};this.hlBBEditor=function(state,nofocus){this.checkEditor();if(this.currentMode!="bb"){return}if(this.hlBB){if(typeof(state)=="undefined"){state=true}if(typeof(nofocus)=="undefined"){nofocus=this.bNoFocus}if(state){this.highlighter.highlight(true,nofocus?true:false);var cmWrapper=this.highlighter.oEditor.getWrapperElement();cmWrapper.style.marginTop="0px";cmWrapper.style.border="0px none transparent";if((this.highlighter!=null)&&this.highlighter.oEditor){this.highlighter.setSize(this.wrapper.offsetWidth+"px",this.wrapper.offsetHeight+"px");if(!nofocus){this.highlighter.oEditor.focus()}}}else{this.highlighter.highlight(false,nofocus?true:false);this.txtEd.editorObj.style.width=this.wrapper.style.width;this.txtEd.editorObj.style.height=this.wrapper.style.height}if(this.highlighter.oEditor){this.bindGadgetCopyPaste(this.highlighter.oEditor.getInputField())}}};this.focusWindow=function(){this.editorObject.contentWindow.focus()};this.formChanged=function(evt){if(this.skipChanges){return}this.contentChanged=true;this.adjustEditorSize();if(_cms_document_form){var oForm=document.forms[_cms_document_form];if(_cms_selected_layout_block&&typeof(oForm.elements[_cms_selected_layout_block+"_body"])!="undefined"){if(oLayout&&!document.getElementById(_cms_selected_layout_block).modified){FormChanged(evt,true,_cms_selected_layout_block)}}else{if(!_cms_document_form_changed){FormChanged(evt,true,this.textareaName)}}}};this.adjustEditorSize=function(){if(AMI.Browser.isSensor&&this.currentMode!="textarea"){this.editorObject.style.width=Math.max(this.editorObject.offsetWidth,AMI.Browser.getDocumentWidth(this.editorObject.contentWindow))+"px";this.editorObject.style.height=Math.max(this.editorObject.offsetHeight,AMI.Browser.getDocumentHeight(this.editorObject.contentWindow))+"px"}};this.getToolbar=function(){var toolbarButtonOver=function(currentEvent){currentEvent=amiCommon.getValidEvent(currentEvent);currentTarget=amiCommon.getEventTarget(currentEvent);if(!currentTarget.disabled&&currentTarget.controlProperties&&(currentTarget.controlProperties.type=="simpleButton"||currentTarget.controlProperties.type=="arrowButton"||currentTarget.controlProperties.type=="smallButton")){if(currentTarget.className!=currentTarget.controlProperties.type+"HTMLEditorSet"){currentTarget.className=currentTarget.controlProperties.type+"HTMLEditorActive"}}};var toolbarButtonOut=function(currentEvent){currentEvent=amiCommon.getValidEvent(currentEvent);currentTarget=amiCommon.getEventTarget(currentEvent);if(!currentTarget.disabled&&currentTarget.controlProperties&&(currentTarget.controlProperties.type=="simpleButton"||currentTarget.controlProperties.type=="arrowButton"||currentTarget.controlProperties.type=="smallButton")){if(currentTarget.className!=currentTarget.controlProperties.type+"HTMLEditorSet"){currentTarget.className=currentTarget.controlProperties.type+"HTMLEditor"}}};var toolbarButtonDown=function(currentEvent){currentEvent=amiCommon.getValidEvent(currentEvent);currentTarget=amiCommon.getEventTarget(currentEvent);if(!currentTarget.disabled&&currentTarget.controlProperties){if(currentTarget.controlProperties.type=="simpleButton"){currentTarget.style.backgroundPosition=(currentTarget.controlProperties.bgx+1)+"px "+(currentTarget.controlProperties.bgy+1)+"px"}else{if(currentTarget.controlProperties.type=="arrowButton"){currentTarget.style.backgroundPosition="80% 20%"}else{if(currentTarget.controlProperties.type=="smallButton"){currentTarget.style.backgroundPosition="1px 1px"}}}}};var toolbarButtonUp=function(currentEvent){currentEvent=amiCommon.getValidEvent(currentEvent);currentTarget=amiCommon.getEventTarget(currentEvent);if(!currentTarget.disabled&&currentTarget.controlProperties){if(currentTarget.controlProperties.type=="simpleButton"){currentTarget.style.backgroundPosition=currentTarget.controlProperties.bgx+"px "+currentTarget.controlProperties.bgy+"px"}else{if(currentTarget.controlProperties.type=="arrowButton"){currentTarget.style.backgroundPosition="50% 50%"}else{if(currentTarget.controlProperties.type=="smallButton"){currentTarget.style.backgroundPosition="0px 0px"}}}}};var toolbarButtonClick=function(currentEvent){currentEvent=amiCommon.getValidEvent(currentEvent);currentTarget=amiCommon.getEventTarget(currentEvent);if(!currentTarget.disabled&&currentTarget.tagName=="BUTTON"){if(currentTarget.controlProperties&&(currentTarget.controlProperties.type=="simpleButton"||currentTarget.controlProperties.type=="arrowButton"||currentTarget.controlProperties.type=="smallButton")){this.processButtonAction(currentTarget.id,currentEvent,currentTarget)}return false}}.bind(this);this.buttonSimple=document.createElement("button");this.buttonSimple.className="simpleButtonHTMLEditor";this.buttonArrow=document.createElement("button");this.buttonArrow.className="arrowButtonHTMLEditor";var toolbarGroup=document.createElement("div");toolbarGroup.className="htmlEditorToolbarGroup";var toolbarObject=document.createElement("div");toolbarObject.id="htmlEditorToolbar"+this.textareaName;toolbarObject.className="htmlEditorToolbar";toolbarObject.onmouseover=toolbarButtonOver;toolbarObject.onmouseout=toolbarButtonOut;toolbarObject.onmousedown=toolbarButtonDown;toolbarObject.onmouseup=toolbarButtonUp;toolbarObject.onclick=toolbarButtonClick;toolbarObject.style.width="100%";this.toolbarObject=toolbarObject;var selectFormat=document.createElement("select");selectFormat.id=this.textareaName+"_fontSelect";selectFormat.className="htmlEditorSelect";selectFormat.style.width="192px";selectFormat.tabIndex="-1";selectFormat.options[0]=new Option(editorTranslation.FormatNoFormat,"",true,true);selectFormat.options[1]=new Option(editorTranslation.FormatH1,"<H1>",false,false);selectFormat.options[2]=new Option(editorTranslation.FormatH2,"<H2>",false,false);selectFormat.options[3]=new Option(editorTranslation.FormatH3,"<H3>",false,false);selectFormat.options[4]=new Option(editorTranslation.FormatH4,"<H4>",false,false);selectFormat.options[5]=new Option(editorTranslation.FormatH5,"<H5>",false,false);selectFormat.options[6]=new Option(editorTranslation.FormatP,"<P>",false,false);selectFormat.options[7]=new Option(editorTranslation.FormatDiv,"<DIV>",false,false);selectFormat.options[8]=new Option(editorTranslation.FormatPre,"<PRE>",false,false);selectFormat.onchange=function(currentEvent){this.actionFormatText(currentEvent);return false}.bind(this);this.selectFormat=selectFormat;var formatSelectBox=document.createElement("div");formatSelectBox.className="htmlEditorSelectBox";formatSelectBox.style.width="198px";formatSelectBox.elementWidth=198;formatSelectBox.appendChild(selectFormat);var selectFontSize=document.createElement("select");selectFontSize.id=this.textareaName+"_fontSize";selectFontSize.className="htmlEditorSelect";selectFontSize.style.width="38px";selectFontSize.tabIndex="-1";selectFontSize.options[0]=new Option("","",true,true);selectFontSize.options[1]=new Option("8","8",false,false);selectFontSize.options[2]=new Option("10","10",false,false);selectFontSize.options[3]=new Option("12","12",false,false);selectFontSize.options[4]=new Option("14","14",false,false);selectFontSize.options[5]=new Option("16","16",false,false);selectFontSize.options[6]=new Option("18","18",false,false);selectFontSize.options[7]=new Option("20","20",false,false);selectFontSize.options[8]=new Option("22","22",false,false);selectFontSize.options[9]=new Option("24","24",false,false);selectFontSize.options[10]=new Option("26","26",false,false);selectFontSize.options[11]=new Option("28","28",false,false);selectFontSize.options[12]=new Option("30","30",false,false);selectFontSize.onchange=function(currentEvent){this.actionFontSizeText(currentEvent);return false}.bind(this);var fontSelectBox=document.createElement("div");fontSelectBox.className="htmlEditorSelectBox";fontSelectBox.style.width="40px";fontSelectBox.elementWidth=40;fontSelectBox.appendChild(selectFontSize);var buttonEditor=this.addSimpleButton("Editor",-232,-81);var buttonBB=this.addSimpleButton("BB",-232,-81);var buttonTextarea=this.addSimpleButton("Textarea",-232,-81);var buttonInlineStyle=this.addSimpleButton("InlineStyle",-232,0);var buttonBold=this.addSimpleButton("Bold",0,0,"skins/vanilla/images/ed_format_bold_"+this.language+".gif");var buttonItalic=this.addSimpleButton("Italic",0,0,"skins/vanilla/images/ed_format_italic_"+this.language+".gif");var buttonUnderline=this.addSimpleButton("Underline",0,0,"skins/vanilla/images/ed_format_underline_"+this.language+".gif");var buttonStrikeThrough=this.addSimpleButton("StrikeThrough",0,0,"skins/vanilla/images/ed_format_strike_"+this.language+".gif");var buttonSubScript=this.addSimpleButton("SubScript",0,0);var buttonSuperScript=this.addSimpleButton("SuperScript",-22,0);var buttonRemoveFormat=this.addSimpleButton("RemoveFormat",-43,0);var buttonPasteAsText=this.addSimpleButton("PasteAsText",-85,0);var buttonPasteFromMSOffice=this.addSimpleButton("PasteFromMSOffice",-127,-61);var buttonPasteSpecial=this.addSimpleButton("PasteSpecial",-148,-61);var buttonSetForeColor=this.addSimpleButton("SetForeColor",-106,0);var buttonSelectForeColor=this.addArrowButton("SelectForeColor");var buttonSetBackColor=this.addSimpleButton("SetBackColor",-127,0);var buttonSelectBackColor=this.addArrowButton("SelectBackColor");var buttonJustifyLeft=this.addSimpleButton("JustifyLeft",-148,0);var buttonJustifyCenter=this.addSimpleButton("JustifyCenter",-169,0);var buttonJustifyRight=this.addSimpleButton("JustifyRight",-190,0);var buttonJustifyFull=this.addSimpleButton("JustifyFull",-211,0);var buttonInsertOrderedList=this.addSimpleButton("InsertOrderedList",0,-21);var buttonInsertUnorderedList=this.addSimpleButton("InsertUnorderedList",-22,-21);var buttonOutdent=this.addSimpleButton("Outdent",-43,-21);var buttonIndent=this.addSimpleButton("Indent",-64,-21);var buttonUndo=this.addSimpleButton("Undo",-85,-21);var buttonRedo=this.addSimpleButton("Redo",-106,-21);var buttonInsertHorizontalRule=this.addSimpleButton("InsertHorizontalRule",-127,-21);var buttonInsertPageBreak=this.addSimpleButton("InsertPageBreak",0,0,"skins/vanilla/images/ed_page_split.gif");var buttonCreateAnchor=this.addSimpleButton("CreateAnchor",-190,-21);var buttonCreateLink=this.addSimpleButton("CreateLink",-148,-21);var buttonUnLink=this.addSimpleButton("UnLink",-169,-21);var buttonInsertImage=this.addSimpleButton("InsertImage",-211,-21);var buttonBackgroundImage=this.addSimpleButton("BackgroundImage",-232,-21);var buttonGadget=this.addSimpleButton("InsertGadget",-209,-61);var buttonInsertSmiles=this.addSimpleButton("InsertSmiles",-190,-61);var buttonInsertSpecialChars=this.addSimpleButton("InsertSpecialChars",-169,-61);var buttonShowSpecBlocks=this.addSimpleButton("ShowSpecBlocks",0,-41);var buttonApplyTemplate=this.addSimpleButton("ApplyTemplate",-22,-41);var buttonShowTableBorders=this.addSimpleButton("ShowTableBorders",-43,-41);var buttonEditTable=this.addSimpleButton("EditTable",-64,-41);var buttonInsertTable=this.addArrowButton("InsertTable");var buttonTdAlignTop=this.addSimpleButton("TdAlignTop",-85,-41);var buttonTdAlignMiddle=this.addSimpleButton("TdAlignMiddle",-106,-41);var buttonTdAlignBottom=this.addSimpleButton("TdAlignBottom",-127,-41);var buttonTdAlignLeft=this.addSimpleButton("TdAlignLeft",-148,-41);var buttonTdAlignCenter=this.addSimpleButton("TdAlignCenter",-169,-41);var buttonTdAlignRight=this.addSimpleButton("TdAlignRight",-190,-41);var buttonInsertRow=this.addSimpleButton("InsertRow",-211,-41);var buttonAddRow=this.addSimpleButton("AddRow",-232,-41);var buttonDelRow=this.addSimpleButton("DelRow",0,-61);var buttonInsertCell=this.addSimpleButton("InsertCell",-22,-61);var buttonDelCell=this.addSimpleButton("DelCell",-43,-61);var buttonAddCol_L=this.addSimpleButton("AddCol_L",-64,-61);var buttonAddCol_R=this.addSimpleButton("AddCol_R",-85,-61);var buttonDelCol=this.addSimpleButton("DelCol",-106,-61);var buttonShowSearch=this.addSimpleButton("ShowSearch",0,0,"skins/vanilla/images/ed_search.gif",27);var buttonResize=this.addSimpleButton("Resize",-21,-80);var buttonQuotes=this.addSimpleButton("Quotes",1,-80);var toolbarFullsize=document.createElement("div");toolbarFullsize.className="htmlEditorToolbarFullsize";buttonResize.setAttribute("doNotDisable","true");toolbarFullsize.appendChild(buttonResize);toolbarObject.appendChild(toolbarFullsize);var toolbarRight=document.createElement("div");toolbarRight.className="htmlEditorToolbarRight";toolbarRight.appendChild(this.changeModeDiv);var groupFormat=toolbarGroup.cloneNode(false);this.addToGroup(groupFormat,formatSelectBox);this.addToGroup(groupFormat,buttonInlineStyle);toolbarObject.appendChild(groupFormat);var groupFont=toolbarGroup.cloneNode(false);this.addToGroup(groupFont,fontSelectBox);this.addToGroup(groupFont,buttonBold);this.addToGroup(groupFont,buttonItalic);this.addToGroup(groupFont,buttonUnderline);this.addToGroup(groupFont,buttonStrikeThrough);toolbarObject.appendChild(groupFont);this.groupFont=groupFont;var groupSupSub=toolbarGroup.cloneNode(false);this.addToGroup(groupSupSub,buttonSubScript);this.addToGroup(groupSupSub,buttonSuperScript);toolbarObject.appendChild(groupSupSub);var groupRemoveFormat=toolbarGroup.cloneNode(false);this.addToGroup(groupRemoveFormat,buttonRemoveFormat);toolbarObject.appendChild(groupRemoveFormat);var groupPaste=toolbarGroup.cloneNode(false);this.addToGroup(groupPaste,buttonPasteAsText);this.addToGroup(groupPaste,buttonPasteFromMSOffice);this.addToGroup(groupPaste,buttonPasteSpecial);toolbarObject.appendChild(groupPaste);var groupColor=toolbarGroup.cloneNode(false);this.addToGroup(groupColor,buttonSetForeColor);this.addToGroup(groupColor,buttonSelectForeColor);this.addToGroup(groupColor,buttonSetBackColor);this.addToGroup(groupColor,buttonSelectBackColor);toolbarObject.appendChild(groupColor);var groupJustify=toolbarGroup.cloneNode(false);this.addToGroup(groupJustify,buttonJustifyLeft);this.addToGroup(groupJustify,buttonJustifyCenter);this.addToGroup(groupJustify,buttonJustifyRight);this.addToGroup(groupJustify,buttonJustifyFull);toolbarObject.appendChild(groupJustify);var groupList=toolbarGroup.cloneNode(false);this.addToGroup(groupList,buttonInsertOrderedList);this.addToGroup(groupList,buttonInsertUnorderedList);this.addToGroup(groupList,buttonOutdent);this.addToGroup(groupList,buttonIndent);toolbarObject.appendChild(groupList);var groupUndo=toolbarGroup.cloneNode(false);this.addToGroup(groupUndo,buttonUndo);this.addToGroup(groupUndo,buttonRedo);toolbarObject.appendChild(groupUndo);var groupRule=toolbarGroup.cloneNode(false);groupRule.className+=" htmlEditorToolbarGroup_Rule";this.addToGroup(groupRule,buttonInsertHorizontalRule);if(_cePageBreakAllowed&&this.textareaName!="form_announce"&&this.textareaName!="announce"){this.addToGroup(groupRule,buttonInsertPageBreak);this.cePageBreakActivated=true}toolbarObject.appendChild(groupRule);var groupLink=toolbarGroup.cloneNode(false);this.addToGroup(groupLink,buttonCreateLink);this.addToGroup(groupLink,buttonUnLink);toolbarObject.appendChild(groupLink);this.bbBreak=document.createElement("br");this.bbBreak.style.clear="both";this.bbBreak.style.display="none";toolbarObject.appendChild(this.bbBreak);var groupImage=toolbarGroup.cloneNode(false);if((this.options&cmD_IMG)==0){this.addToGroup(groupImage,buttonInsertImage)}this.addToGroup(groupImage,buttonBackgroundImage);this.addToGroup(groupImage,buttonGadget);this.addToGroup(groupImage,buttonInsertSmiles);this.addToGroup(groupImage,buttonInsertSpecialChars);this.addToGroup(groupImage,buttonQuotes);toolbarObject.appendChild(groupImage);this.groupInsertSpecial=groupImage;if((this.options&cmD_STB)==0||(this.options&cmD_TMP)==0){var groupSpec=toolbarGroup.cloneNode(false);if((this.options&cmD_STB)==0){this.addToGroup(groupSpec,buttonShowSpecBlocks)}if((this.options&cmD_TMP)==0){this.addToGroup(groupSpec,buttonApplyTemplate)}toolbarObject.appendChild(groupSpec)}var groupTable=toolbarGroup.cloneNode(false);this.addToGroup(groupTable,buttonShowTableBorders);this.addToGroup(groupTable,buttonEditTable);this.addToGroup(groupTable,buttonInsertTable);toolbarObject.appendChild(groupTable);var groupTableVAlign=toolbarGroup.cloneNode(false);this.addToGroup(groupTableVAlign,buttonTdAlignTop);this.addToGroup(groupTableVAlign,buttonTdAlignMiddle);this.addToGroup(groupTableVAlign,buttonTdAlignBottom);toolbarObject.appendChild(groupTableVAlign);var groupTableAlign=toolbarGroup.cloneNode(false);this.addToGroup(groupTableAlign,buttonTdAlignLeft);this.addToGroup(groupTableAlign,buttonTdAlignCenter);this.addToGroup(groupTableAlign,buttonTdAlignRight);toolbarObject.appendChild(groupTableAlign);var groupTableRow=toolbarGroup.cloneNode(false);this.addToGroup(groupTableRow,buttonInsertRow);this.addToGroup(groupTableRow,buttonAddRow);this.addToGroup(groupTableRow,buttonDelRow);toolbarObject.appendChild(groupTableRow);var groupTableCell=toolbarGroup.cloneNode(false);this.addToGroup(groupTableCell,buttonInsertCell);this.addToGroup(groupTableCell,buttonDelCell);toolbarObject.appendChild(groupTableCell);var groupTableCol=toolbarGroup.cloneNode(false);this.addToGroup(groupTableCol,buttonAddCol_L);this.addToGroup(groupTableCol,buttonAddCol_R);this.addToGroup(groupTableCol,buttonDelCol);toolbarObject.appendChild(groupTableCol);buttonShowSearch.setAttribute("doNotDisable","true");var groupSearch=toolbarGroup.cloneNode(false);this.addToGroup(groupSearch,buttonShowSearch);toolbarObject.appendChild(groupSearch);toolbarObject.appendChild(toolbarRight);var finalBreak=document.createElement("div");finalBreak.style.clear="both";if(this.isIE){finalBreak.style.marginTop="-2px"}toolbarObject.appendChild(finalBreak);var toolbarSearchObject=document.createElement("div");toolbarSearchObject.id=this.textareaName+"_toolBarSearch";toolbarSearchObject.className="htmlEditorSearchPath";toolbarObject.appendChild(toolbarSearchObject);this.searchPanel=toolbarSearchObject;var toolbarPathObject=document.createElement("div");toolbarPathObject.id=this.textareaName+"_toolBarPath";toolbarPathObject.className="htmlEditorToolbarPath";toolbarObject.appendChild(toolbarPathObject);this.toolbarPathObject=toolbarPathObject;return toolbarObject};this.addPageBreakButton=function(){if(!_cePageBreakAllowed||this.textareaName=="form_announce"||this.cePageBreakActivated){return}var toolbarObject=document.getElementById("htmlEditorToolbar"+this.textareaName);if(toolbarObject!==null){var toolbarGroup=toolbarObject.getElementsByClassName("htmlEditorToolbarGroup_Rule")[0];var buttonInsertPageBreak=this.addSimpleButton("InsertPageBreak",0,0,"skins/vanilla/images/ed_page_split.gif");toolbarGroup.appendChild(buttonInsertPageBreak)}};this.addBBToolbarButtons=function(){this.buttonBBQuote=this.addSimpleButton("bbQuote",0,0,this.txtEd.insertQuoteBtn.src);this.buttonBBCode=this.addSimpleButton("bbCode",0,0,this.txtEd.insertCodeBtn.src);this.sizeSelectionBox=this.txtEd.sizeSelectionBox;this.colorSelectionBox=this.txtEd.colorSelectionBox;var sizeSelectionDiv=document.createElement("DIV");sizeSelectionDiv.className="htmlEditorSelectBox";sizeSelectionDiv.appendChild(this.sizeSelectionBox);var colorSelectionDiv=document.createElement("DIV");colorSelectionDiv.className="htmlEditorSelectBox";colorSelectionDiv.appendChild(this.colorSelectionBox);this.sizeSelectionBox.className="htmlEditorSelect";this.colorSelectionBox.className="htmlEditorSelect";this.addToGroup(this.groupInsertSpecial,this.buttonBBQuote);this.addToGroup(this.groupInsertSpecial,this.buttonBBCode);this.addToGroup(this.groupFont,sizeSelectionDiv);this.addToGroup(this.groupFont,colorSelectionDiv)};this.updateToolBar=function(){this.checkEditor();var pathObject=document.getElementById(this.textareaName+"_toolBarPath");var pathStr="";var pathArray=new Array();var activeButtonsHash="";if(pathObject!=null){if(this.currentMode!="editor"){pathObject.innerHTML=""}else{var selectedNode=this.getSelectedAnchorNode();if(selectedNode==null){pathStr="BODY"}else{var currentFormat="";do{if(selectedNode.tagName){var tagName=selectedNode.tagName.toUpperCase();if(currentFormat==""&&(tagName=="H1"||tagName=="H2"||tagName=="H3"||tagName=="H4"||tagName=="H5"||tagName=="P"||tagName=="DIV"||tagName=="PRE")){currentFormat=tagName}var buttonTagName=tagName;if(this.isWebKit&&buttonTagName=="SPAN"){tagName=buttonTagName=this.safariGetTag(selectedNode)}else{if(!this.isWebKit&&!this.isIE&&buttonTagName=="SPAN"){tagName=buttonTagName=this.fixBackgroundTag(selectedNode)}}if(tagName=="STRONG"){tagName=="B";buttonTagName="B"}else{if(tagName=="EM"){tagName=="I";buttonTagName="I"}}if(tagName=="A"&&selectedNode.href){var linkHref=this.fixI18nDomainName(selectedNode.href);tagName=tagName+" [";if(linkHref.substr(0,editorBaseHref.length)==editorBaseHref){tagName+=linkHref.substr(editorBaseHref.length)}else{tagName+=linkHref}tagName=tagName+"]"}else{if(tagName=="IMG"&&selectedNode.className.substr(0,15)=="editorSpecBlock"){buttonTagName="SPECBLOCK";var specNum=selectedNode.getAttribute("spec_num");tagName=selectedNode.id.toUpperCase()+(specNum?" ["+selectedNode.getAttribute("spec_num")+"]":"")}else{if(tagName=="IMG"&&selectedNode.className.substr(0,15)=="ui_script"){buttonTagName="";tagName="JAVASCRIPT"}else{if(tagName=="IMG"&&selectedNode.className.substr(0,15)=="ui_flash"){buttonTagName="";tagName="OBJECT"}else{if(tagName=="IMG"&&selectedNode.className.substr(0,15)=="ui_gadget"){buttonTagName="";tagName="GADGET"}else{if(tagName=="IMG"&&selectedNode.className.substr(0,15)=="body_page_break"){buttonTagName="";tagName="PAGE BREAK"}}}}}}if(buttonTagName!=""){pathArray.push(buttonTagName);activeButtonsHash+=buttonTagName}pathStr=tagName+(pathStr.length>0?" - ":"")+pathStr;if(tagName=="BODY"){break}}}while(selectedNode=selectedNode.parentNode)}try{var justfyVariants=new Array("Full","Right","Center","Left");for(var ji=0;ji<justfyVariants.length;ji++){var cmdJustify=this.editorDocument.queryCommandValue("Justify"+justfyVariants[ji]);if(cmdJustify==true||cmdJustify==(justfyVariants[ji]=="Full"?"justify":justfyVariants[ji].toLowerCase())){pathArray.push("JUSTFY_"+justfyVariants[ji].toUpperCase());activeButtonsHash+="JUSTFY_"+justfyVariants[ji].toUpperCase();break}}}catch(ex){}if(this.lastToolbarPath!=pathStr){this.lastToolbarPath=pathStr;pathObject.innerHTML=pathStr}if(this.lastToolbarActiveButtonsHash!=activeButtonsHash){this.updateToolBarButtons(pathArray);this.lastToolbarActiveButtonsHash=activeButtonsHash}var fontSelect=document.getElementById(this.textareaName+"_fontSelect");if(fontSelect!=null){if(currentFormat!=""){for(i=0;i<fontSelect.options.length;i++){if(fontSelect.options[i].value=="<"+currentFormat+">"){fontSelect.options[i].selected=true;break}}}else{fontSelect.options[0].selected=true}}try{var fontSize=this.editorDocument.queryCommandValue("FontSize");var fontSizeObject=document.getElementById(this.textareaName+"_fontSize");fontSizeObject.value=fontSize}catch(ex){}}}};this.updateToolBarButtons=function(pathArray){this.checkEditor();for(i=0;i<pathArray.length;i++){var setButtonName="";if(pathArray[i]=="B"||pathArray[i]=="STRONG"){setButtonName="Bold"}else{if(pathArray[i]=="IMG"){setButtonName="InsertImage"}else{if(pathArray[i]=="I"||pathArray[i]=="EM"){setButtonName="Italic"}else{if(pathArray[i]=="STRIKE"){setButtonName="StrikeThrough"}else{if(pathArray[i]=="U"){setButtonName="Underline"}else{if(pathArray[i]=="SUB"){setButtonName="SubScript"}else{if(pathArray[i]=="SUP"){setButtonName="SuperScript"}else{if(pathArray[i]=="TABLE"){setButtonName="EditTable"}else{if(pathArray[i]=="SPECBLOCK"){setButtonName="ShowSpecBlocks"}else{if(pathArray[i]=="JUSTFY_LEFT"){setButtonName="JustifyLeft"}else{if(pathArray[i]=="JUSTFY_CENTER"){setButtonName="JustifyCenter"}else{if(pathArray[i]=="JUSTFY_RIGHT"){setButtonName="JustifyRight"}else{if(pathArray[i]=="JUSTFY_FULL"){setButtonName="JustifyFull"}}}}}}}}}}}}}if(setButtonName!=""){var setButton=this.getButton(setButtonName);if(setButton!=null){setButton.className="simpleButtonHTMLEditorSet";this.buttonStates[setButtonName]=2}}}for(setButtonName in this.buttonStates){if(this.buttonStates[setButtonName]==1){var setButton=this.getButton(setButtonName);if(setButton!=null){setButton.className="simpleButtonHTMLEditor";this.buttonStates[setButtonName]=0}}else{if(this.buttonStates[setButtonName]==2){this.buttonStates[setButtonName]=1}}}};this.addToGroup=function(oGroup,oElement){oGroup.appendChild(oElement)};this.addSimpleButton=function(actionName,backgroundOffsetX,backgroundOffsetY,backgroundImage,customWidth){if(typeof(backgroundImage)=="undefined"){backgroundImage="skins/vanilla/images/ed_icons.gif"}var button=this.buttonSimple.cloneNode(true);button.setAttribute("type","button");button.controlProperties={type:"simpleButton",bgx:backgroundOffsetX,bgy:backgroundOffsetY};button.id=this.textareaName+"TB"+actionName;button.onfocus=function(){this.blur()};button.style.backgroundImage="url("+backgroundImage+")";button.style.backgroundPosition=backgroundOffsetX+"px "+backgroundOffsetY+"px";button.elementWidth=27;if(typeof(customWidth)!="undefined"){button.style.width=customWidth+2+"px";button.elementWidth=customWidth+6}if(typeof(editorTranslation[actionName])!="undefined"){button.title=editorTranslation[actionName]}if(actionName=="Switch"){button.setAttribute("doNotDisable",true)}return button};this.addSmallButton=function(actionName,backgroundImage){var button=document.createElement("button");button.setAttribute("type","button");button.className="smallButtonHTMLEditor";button.controlProperties={type:"smallButton"};button.id=this.textareaName+"TB"+actionName;button.onfocus=function(){this.blur()};button.style.backgroundImage="url("+backgroundImage+")";button.elementWidth=15;if(actionName=="FullScreen"){button.setAttribute("doNotDisable",true)}return button};this.addArrowButton=function(actionName){var button=this.buttonArrow.cloneNode(true);button.setAttribute("type","button");button.controlProperties={type:"arrowButton"};button.id=this.textareaName+"TB"+actionName;button.onfocus=function(){this.blur()};button.style.backgroundImage="url(skins/vanilla/images/ed_ex_button.gif)";button.elementWidth=9;return button};this.getButton=function(actionName){if(!this.buttons[actionName]){this.buttons[actionName]=document.getElementById(this.textareaName+"TB"+actionName)}return this.buttons[actionName]};this.switchBBToolbar=function(state){var hidePanelIdx=[3,4,5,6,9,10,13,14,15,16,17,18,19];var toolbarGroups=this.toolbarObject.getElementsByTagName("DIV");var idx=0;for(var i=0;i<toolbarGroups.length;i++){if(AMI.hasClass(toolbarGroups[i],"htmlEditorToolbarGroup")){idx++;if(hidePanelIdx.indexOf(idx)>=0){toolbarGroups[i].style.display=(state)?"none":"inline-block"}}}};this.disableToolBarButtons=function(state){var aNotDisable=["Bold","Italic","Underline","StrikeThrough","InsertUnorderedList","InsertOrderedList","CreateLink","UnLink","InsertImage","Outdent","Indent","JustifyLeft","JustifyCenter","JustifyRight","JustifyFull","InsertSmiles","InsertSpecialChars","bbCode","bbQuote","Quotes","ShowSearch"];var aBBHideButtons=["BackgroundImage","InsertGadget"];var aBBShowButtons=["bbCode","bbQuote","Quotes","ShowSearch"];this.bbBreak.style.display=(this.currentMode=="bb")?"inline-block":"none";var toolbar=document.getElementById("htmlEditorToolbar"+this.textareaName);var buttons=toolbar.getElementsByTagName("button");for(i=0;i<buttons.length;i++){if(AMI.hasClass(buttons[i],"htmlEditorModeBtn")){continue}var doNotDisable=buttons[i].getAttribute("doNotDisable");var buttonState=state;var buttonAction=buttons[i].id.substr((this.textareaName+"TB").length);if(this.currentMode=="bb"){if(AMI.hasClass(buttons[i],"simpleButtonHTMLEditorSet")){AMI.removeClass(buttons[i],"simpleButtonHTMLEditorSet");AMI.addClass(buttons[i],"simpleButtonHTMLEditor")}if(aNotDisable.indexOf(buttonAction)>=0){doNotDisable=true}}if(doNotDisable){buttonState=false}if(aBBHideButtons.indexOf(buttonAction)>=0){buttons[i].style.display=(this.currentMode=="bb")?"none":"inline-block"}if(aBBShowButtons.indexOf(buttonAction)>=0){buttons[i].style.display=(this.currentMode=="bb")?"inline-block":"none"}if(buttonAction=="ShowSearch"){buttons[i].style.display="inline-block"}buttons[i].disabled=buttonState;buttons[i].style.opacity=buttonState?0.3:1;buttons[i].style.filter=buttonState?"alpha(opacity=30)":"alpha(opacity=100)"}var selects=toolbar.getElementsByTagName("select");for(i=0;i<selects.length;i++){var disable=state;if(this.currentMode=="bb"){if(selects[i].id==(this.textareaName+"_fontSelect")){disable=false}}selects[i].disabled=disable;selects[i].style.display=((this.currentMode=="bb")&&(selects[i].id!=(this.textareaName+"_fontSelect")))?"none":"block";selects[i].parentNode.style.display=((this.currentMode=="bb")&&(selects[i].id!=(this.textareaName+"_fontSelect")))?"none":"inline-block";if(selects[i].name!=undefined){var aBBNames=["amiroTEdit_selcolor","amiroTEdit_selsize"];if(aBBNames.indexOf(selects[i].name)>=0){if(this.currentMode=="bb"){selects[i].disabled=!disable;selects[i].style.display="block";selects[i].parentNode.style.display="inline-block"}else{selects[i].disabled=disable;selects[i].style.display="none";selects[i].parentNode.style.display="none"}}}}if(!this.isOpera){var btnShowSearch=this.getButton("ShowSearch");if(btnShowSearch){btnShowSearch.className=(this.searchPanel.style.display=="block")?"simpleButtonHTMLEditorSet":"simpleButtonHTMLEditor";if(document.getElementById("_spec_opt_"+this.textareaName+"_search_word_whole")){document.getElementById("_spec_opt_"+this.textareaName+"_search_word_whole").disabled=(this.currentMode!="editor")}}}else{var highlighted=((this.currentMode=="textarea")&&this.hlHTML)||((this.currentMode=="bb")&&this.hlBB);var btnShowSearch=this.getButton("ShowSearch");if(highlighted){btnShowSearch.className=(this.searchPanel.style.display=="block")?"simpleButtonHTMLEditorSet":"simpleButtonHTMLEditor";if(document.getElementById("_spec_opt_"+this.textareaName+"_search_word_whole")){document.getElementById("_spec_opt_"+this.textareaName+"_search_word_whole").disabled=(this.currentMode!="editor")}btnShowSearch.disabled=false;btnShowSearch.style.opacity=1;btnShowSearch.style.filter="alpha(opacity=100)"}else{this.searchPanel.style.display="none";btnShowSearch.disabled=true;btnShowSearch.style.opacity=0.3;btnShowSearch.style.filter="alpha(opacity=30)"}}};this.initEditorToolbar=function(){if(this.editorDocument&&this.editorDocument.body){this.textareaObject.editorInitialized=true;amiCommon.setEventHandler("drop",this.editorDocument.body,function(currentEvent){this.processEditorDocumentDrop(currentEvent)}.bind(this));amiCommon.setEventHandler("cut",this.editorDocument.body,function(currentEvent){this.processEditorDocumentCut(currentEvent)}.bind(this));amiCommon.setEventHandler("paste",this.editorDocument.body,function(currentEvent){this.processEditorDocumentPaste(currentEvent)}.bind(this));amiCommon.setEventHandler("mousedown",this.editorDocument,function(currentEvent){this.processEditorDocumentMouseDown(currentEvent)}.bind(this));amiCommon.setEventHandler("mouseup",this.editorDocument,function(currentEvent){this.processEditorDocumentMouseUp(currentEvent)}.bind(this));amiCommon.setEventHandler("keyup",this.editorDocument,function(currentEvent){this.processEditorDocumentKeyUp(currentEvent)}.bind(this));amiCommon.setEventHandler("click",this.editorDocument,function(currentEvent){this.processEditorDocumentClick(currentEvent)}.bind(this));amiCommon.setEventHandler("dblclick",this.editorDocument,function(currentEvent){this.processEditorDocumentDoubleClick(currentEvent)}.bind(this));amiCommon.setEventHandler("resize",window,function(currentEvent){this.actionUpdateEditorSize(currentEvent)}.bind(this));amiCommon.setEventHandler("contextmenu",this.editorDocument,function(_this){return function(evt){return _this.processContextMenu(evt)}}(this));this.updateToolBar();this.actionShowTableBorders(this.showFrames);setTimeout(function(_this){return function(){_this.correctFrames()}}(this),300);setTimeout(function(){this.adjustEditorSize()}.bind(this),700)}else{if(this.hasInitQueue){this.textareaObject.editorInitialized=true}else{setTimeout(function(){this.initEditorToolbar()}.bind(this),10)}}};this.processEditorDocumentDrop=function(currentEvent){this.formChanged(currentEvent)};this.processEditorDocumentCut=function(currentEvent){this.formChanged(currentEvent)};this.processEditorDocumentPaste=function(currentEvent){this.actionPaste(currentEvent,false,true)};this.processEditorDocumentKeyUp=function(currentEvent){this.updateToolBar();var keyCode=currentEvent.keyCode;var isCtrlKey=currentEvent.ctrlKey;var isShiftKey=currentEvent.shiftKey;if(isCtrlKey&&keyCode==83){setTimeout(function(){submitEditForm()},10);return false}if(isCtrlKey&&(keyCode==83||keyCode>=49&&keyCode<=58||keyCode==67||keyCode==90||keyCode==89)||keyCode==27||keyCode==20||keyCode>=112&&keyCode<=123||keyCode>=33&&keyCode<=40||keyCode>=16&&keyCode<=18){return false}this.formChanged(currentEvent)};this.processEditorDocumentMouseUp=function(currentEvent){this.updateToolBar()};this.processEditorDocumentMouseDown=function(currentEvent){this.updateToolBar();this.hideSpecblockMenu()};this.processEditorDocumentClick=function(currentEvent){var target=amiCommon.getEventTarget(amiCommon.getValidEvent(currentEvent));if(target!=null&&target.tagName){if(target.tagName=="IMG"&&this.isWebKit){this.selectElement(target)}if(target.tagName=="IMG"&&target.className.substr(0,15)=="editorSpecBlock"){var aPointerPos=AMI.Browser.getPointerPosition(currentEvent);var aSBPos=AMI.Browser.getObjectPosition(target);if(aPointerPos[0]-aSBPos[0]>=target.offsetWidth-15&&aPointerPos[1]-aSBPos[1]>=target.offsetHeight-15){this.showSpecblockMenu(currentEvent,target)}}}this.updateToolBar()};this.processEditorDocumentDoubleClick=function(currentEvent){var target=amiCommon.getEventTarget(amiCommon.getValidEvent(currentEvent));if(target.tagName&&target.tagName.toLowerCase()=="img"){if(this.isWebKit){this.selectElement(target)}if(target.className!="ui_script"&&target.className!="ui_flash"){if(target.className.substr(0,15)=="editorSpecBlock"){this.actionSpecblockClick(target)}else{if(target.className.substr(0,9)=="ui_gadget"){var gadgetID=target.id.substr(12,target.id.length-12);edShowGadgetFormPopup(this.gadgetContent[gadgetID]["gadgettype"],textareaName,true,gadgetID,this.gadgetContent)}else{this.actionImageClick(target)}}}}};this.processContextMenu=function(currentEvent){this.checkEditor();var target=AMI.Browser.Event.getTarget(currentEvent);if(target!=null&&target.tagName&&target.tagName=="IMG"&&target.className.substr(0,15)=="editorSpecBlock"){if(this.isWebKit){this.selectElement(target)}AMI.Browser.Event.stopProcessing(currentEvent);this.showSpecblockMenu(currentEvent,target)}};this.processButtonAction=function(idButton,currentEvent,currentTarget){this.checkEditor();this.focusWindow();isChangesApplied=false;var action=idButton.substr((this.textareaName+"TB").length);switch(action){case"Editor":case"BB":case"Textarea":this["action"+action+"Mode"]();break;case"InlineStyle":edEditInlineStyles(this.textareaName);break;case"ShowSpecBlocks":this.actionSpecblockClick();break;case"ApplyTemplate":this.actionApplyTemplate();break;case"InsertPageBreak":this.actionInsertPageBreak();break;case"InsertImage":if(this.currentMode=="bb"){this.txtEd.procAction("addimg")}else{this.actionImageClick()}break;case"BackgroundImage":this.actionBackgroundImageClick();break;case"InsertGadget":this.actionGadgetClick();break;case"InsertSmiles":this.actionSmiles(currentTarget);break;case"InsertSpecialChars":this.actionSpecialChars(currentTarget);break;case"PasteAsText":this.actionPasteAsText(currentEvent);break;case"PasteFromMSOffice":this.actionPaste(currentEvent,true,false);break;case"PasteSpecial":this.actionPaste(currentEvent,false,false);break;case"SetForeColor":case"SelectForeColor":this.actionSetColor(currentEvent,"ForeColor",action=="SetForeColor");break;case"SetBackColor":case"SelectBackColor":this.actionSetColor(currentEvent,"BackColor",action=="SetBackColor");break;case"CreateLink":if(this.currentMode=="bb"){this.txtEd.procAction("addlink")}else{this.actionCreateLink()}break;case"ShowTableBorders":this.actionShowTableBorders();this.updateToolBar();break;case"InsertTable":case"EditTable":this.actionTable(currentTarget,action=="InsertTable");break;case"TdAlignTop":this.actionTDAlign(true,"top");isChangesApplied=true;break;case"TdAlignMiddle":this.actionTDAlign(true,"middle");isChangesApplied=true;break;case"TdAlignBottom":this.actionTDAlign(true,"bottom");isChangesApplied=true;break;case"TdAlignLeft":this.actionTDAlign(false,"left");isChangesApplied=true;break;case"TdAlignCenter":this.actionTDAlign(false,"center");isChangesApplied=true;break;case"TdAlignRight":this.actionTDAlign(false,"right");isChangesApplied=true;break;case"InsertRow":this.actionTableAddRow(true);isChangesApplied=true;break;case"AddRow":this.actionTableAddRow(false);isChangesApplied=true;break;case"DelRow":this.actionTableDelRow();isChangesApplied=true;break;case"InsertCell":this.actionTableInsertCell();isChangesApplied=true;break;case"DelCell":this.actionTableDelCell();isChangesApplied=true;break;case"AddCol_L":this.actionTableAddCol("left");isChangesApplied=true;break;case"AddCol_R":this.actionTableAddCol("right");isChangesApplied=true;break;case"DelCol":this.actionTableDelCol();isChangesApplied=true;break;case"Resize":this.actionResizeToFitScreen();break;case"ShowSearch":this.actionShowSearch();break;case"Bold":if(this.currentMode=="bb"){this.txtEd.procAction("bold");break}case"Italic":if(this.currentMode=="bb"){this.txtEd.procAction("italic");break}case"Underline":if(this.currentMode=="bb"){this.txtEd.procAction("underlined");break}case"StrikeThrough":if(this.currentMode=="bb"){this.txtEd.procAction("strike");break}case"InsertUnorderedList":if(this.currentMode=="bb"){this.txtEd.procAction("ulist");break}case"InsertOrderedList":if(this.currentMode=="bb"){this.txtEd.procAction("olist");break}case"UnLink":if(this.currentMode=="bb"){this.txtEd.procAction("dellink");break}case"Outdent":if(this.currentMode=="bb"){this.txtEd.procAction("outdent");break}case"Indent":if(this.currentMode=="bb"){this.txtEd.procAction("indent");break}case"JustifyLeft":if(this.currentMode=="bb"){this.txtEd.procAction("align","left");break}case"JustifyCenter":if(this.currentMode=="bb"){this.txtEd.procAction("align","center");break}case"JustifyRight":if(this.currentMode=="bb"){this.txtEd.procAction("align","right");break}case"JustifyFull":if(this.currentMode=="bb"){this.txtEd.procAction("align","justify");break}case"bbCode":if(this.currentMode=="bb"){this.txtEd.procAction("code");break}case"bbQuote":if(this.currentMode=="bb"){this.txtEd.procAction("quote");break}case"Quotes":if(this.currentMode=="bb"){var text=this.txtEd._getSelectedText();this.txtEd._replaceSelection(eval('"\\u00AB'+text+'\\u00BB"'),1,1,false);break}default:try{if(action=="JustifyRight"||action=="JustifyLeft"||action=="JustifyCenter"||action=="JustifyFull"){this.setUseCSS(true)}else{this.setUseCSS(false)}var needSplit=false;if(AMI.Browser.isWebKit){if(action=="InsertOrderedList"||action=="InsertUnorderedList"){var parentBlock=this.getSelectedAnchorNode();parentBlock=(typeof(parentBlock.parentNode)!="undefined")&&parentBlock.parentNode?parentBlock.parentNode:parentBlock;var aUnsupportedNodes=["H1","H2","H3","H4","H5","P","SPAN"];var isSupported=!(aUnsupportedNodes.indexOf(parentBlock.tagName)>=0);if(!isSupported){needSplit=true}}}if(action=="InsertHorizontalRule"){this.editorDocument.execCommand(action,false,null)}else{this.editorDocument.execCommand(action,false,false);this.cleanupWebKitExcessStylesOnPaste();if(AMI.Browser.isWebKit&&needSplit){function splitNode(node,nodeParent){var parent=nodeParent.parentNode;var parentOffset=getNodeIndex(parent,nodeParent);var doc=node.ownerDocument;var leftRange=doc.createRange();leftRange.setStart(parent,parentOffset);leftRange.setEnd(node,0);var nodeClone=node.cloneNode(true);var left=leftRange.extractContents();parent.insertBefore(left,nodeParent);parent.insertBefore(nodeClone,nodeParent);node.parentNode.removeChild(node);var nodeRange=doc.createRange();nodeRange.selectNodeContents(nodeClone);var sel=doc.getSelection();sel.removeAllRanges();sel.addRange(nodeRange)}function getNodeIndex(parent,node){var index=parent.childNodes.length;while(index--){if(node===parent.childNodes[index]){break}}return index}var sel=this.editorDocument.getSelection();if(sel&&sel.anchorNode){var node=sel.anchorNode;if(node.nodeType==3){node=node.parentNode}if(node.nodeName=="LI"){var list=node.parentNode;if(list.parentNode.tagName!="BODY"){splitNode(list,list.parentNode)}var items=this.editorDocument.getElementsByTagName("*");for(var i=items.length;i--;){if((items[i].nodeType!=3)&&items[i].nodeName=="P"){if(items[i].childNodes.length==0){items[i].parentNode.removeChild(items[i])}else{if(items[i].childNodes.length==1){if((items[i].childNodes[0].tagName=="UL")||(items[i].childNodes[0].tagName=="OL")){if(items[i].childNodes[0].childNodes.length==0){items[i].parentNode.removeChild(items[i])}}}}}}}}}}this.setUseCSS(false);this.updateToolBar();isChangesApplied=true}catch(e){}}if(isChangesApplied){this.formChanged(currentEvent);this.focusWindow()}};this.transportTextFromTextareaToEditor=function(workType){this.checkEditor();if(workType==2){this.prepareGadgetsCode()}if(this.currentMode=="editor"){var prevStyle=null;var cssLinks=this.editorDocument.getElementsByTagName("link");if(cssLinks){for(var i=0;i<cssLinks.length;i++){if(cssLinks[i].id=="ce_custom_css"){prevStyle=cssLinks[i];break}}}if(prevStyle==null||prevStyle!=null&&prevStyle.href!=frontCustomCSSFile){var newStyle=this.editorDocument.createElement("link");if(newStyle){newStyle.rel="stylesheet";newStyle.type="text/css";newStyle.href=frontCustomCSSFile;if(prevStyle==null){newStyle=this.editorDocument.getElementsByTagName("head")[0].appendChild(newStyle)}else{prevStyle.parentNode.insertBefore(newStyle,prevStyle);prevStyle.parentNode.removeChild(prevStyle)}newStyle.id="ce_custom_css"}}this.editorDocument.body.id=typeof(_cms_selected_layout_block)!="undefined"?_cms_selected_layout_block:this.textareaName;this.editorDocument.body.innerHTML=this.parseHTMLCode(this.adjustSelection(this.textareaObject.value,"editor"),false);this.updateToolBar()}};this.transportTextFromBBToEditor=function(workType){this.checkEditor();if(workType==2){this.prepareGadgetsCode()}if(this.currentMode=="editor"){this.editorDocument.body.id=typeof(_cms_selected_layout_block)!="undefined"?_cms_selected_layout_block:this.textareaName;this.txtEd.editorObj.value=this.adjustSelection(this.txtEd.editorObj.value,"bb");this.editorDocument.body.innerHTML=this.parseHTMLCode(this.adjustSelection(this.txtEd.getHTMLContent(),"editor"),false);this.updateToolBar()}};this.transportTextFromBBToTextarea=function(){this.checkEditor();this.hlTextarea(false,true);this.txtEd.editorObj.value=this.adjustSelection(this.txtEd.editorObj.value,"bb");this.textareaObject.value=this.txtEd.getHTMLContent();this.textareaObject.value=this.textareaObject.value.replace(/\#\#([^\r\n]+?)\#\#/g,function(string){string=string.replace(/\&amp;/g,"&");string=string.replace(/\&gt;/g,">");string=string.replace(/\&lt;/g,"<");return string});this.hlTextarea(true)};this.transportTextFromEditorToTextarea=function(isForced){this.checkEditor();if(typeof(isForced)=="undefined"){isForced=false}var resultText="";if(this.currentMode=="textarea"||isForced){this.fixHTMLCode();this.hlTextarea(false,true);textareaValue=this.parseHTMLCode(this.editorDocument.body.innerHTML,true);textareaValue=textareaValue.replace(/\#\#[^\r\n]+?\#\#/g,function(string){string=string.replace(/\&amp;/g,"&");string=string.replace(/\&gt;/g,">");string=string.replace(/\&lt;/g,"<");return string});this.textareaObject.value=textareaValue;this.hlTextarea(true)}if(this.currentMode=="textarea"){this.flashContent=new Array();this.javascriptContent=new Array()}return resultText};this.prepareGadgetsCode=function(){this.checkEditor();var content=this.textareaObject.value;this.gadgetContent=new Array();var re=/\<span[^\>]*? class=\"gadget\"?([^\>]*?)\>((.|\r?\n)*?)\<\/span class=\"gadget\"\>/ig;content=content.replace(re,function(editorObject){return function(allstr,firstSpanParams){var pr=/(\w+)=\"([^\"]+)\"/gi;var params=new Array();var gadgetParams=new Array();while((params=pr.exec(firstSpanParams))!=null){if(params[1]=="gadgettype"){var gadgetType=params[2]}if(params[1]!="class"&&params[1]!="indexOf"){gadgetParams[params[1]]=params[2]}}if(gadgetParams.gadgetType==0||gadgetParams.gadgetType==1||gadgetParams.gadgetType==2){if(gadgetParams.gcontent!=undefined){gadgetParams.gadgetType="imagetape"}if(gadgetParams.goriginal_url!=undefined){if(gadgetParams.goriginal_url.indexOf("youtube")>0){gadgetParams.gadgetType="youtube"}if(gadgetParams.goriginal_url.indexOf("rutube")>0){gadgetParams.gadgetType="rutube"}}}var gadgetIndex=editorObject.gadgetContent.length;editorObject.gadgetContent[gadgetIndex]=new Array();editorObject.gadgetContent[gadgetIndex]=gadgetParams;return"##gadget"+gadgetIndex+"##"}}(this));this.textareaObject.value=content};this.packGadgets=function(str){var gadget,prop;str=str.replace(/##gadget([0-9]+)##/g,function(tag,gadgetId){if("undefined"!==typeof this.gadgetContent[gadgetId]){gadget={};for(prop in this.gadgetContent[gadgetId]){gadget[prop]=this.gadgetContent[gadgetId][prop]}return"##gadget"+JSON.stringify(gadget)+"##"}return""}.bind(this));return str};this.unpackGadgets=function(str){str=String(str).replace(/##gadget({.+?})##/g,function(gadget,gadgetData){try{gadgetData=JSON.parse(gadgetData);this.gadgetContent.push(gadgetData);return"##gadget"+(this.gadgetContent.length-1)+"##"}catch(e){return gadget}}.bind(this));return str};this.parseHTMLCode=function(parsedText,isFromEditor){this.checkEditor();if(isFromEditor){for(var i=0;i<SpecBlocks.length;i++){var regTpl='<img[^>]*? id="?[NAME](?:"| )"?[^>]*?( spec_num="?([0-9]+)"?)[^>]*?>';for(var i=0;i<SpecBlocks.length;i++){var reg=regTpl.replace(/\[NAME\]/,SpecBlocks[i]["name"]);var re=new RegExp(reg,"ig");parsedText=parsedText.replace(re,function(allstr,digAttribute,dig){return"##"+SpecBlocks[i]["name"]+(typeof(dig)!="undefined"&&dig!=""?"_"+dig:"")+"##"})}var regTpl='<img[^>]*? id="?[NAME]"?[^>]*?>';for(var i=0;i<SpecBlocks.length;i++){var reg=regTpl.replace(/\[NAME\]/,SpecBlocks[i]["name"]);var re=new RegExp(reg,"ig");parsedText=parsedText.replace(re,function(allstr,digAttribute,dig){return"##"+SpecBlocks[i]["name"]+"##"})}}var reg='<nobr double-hash="">(.+?)</nobr>';var re=new RegExp(reg,"ig");parsedText=parsedText.replace(re,function(string,nobrContent){return nobrContent.replace(/#/g,"&#035;")});if((typeof(_cePageBreakTag)!="undefined"&&_cePageBreakTag.length)&&_cePageBreakAllowed){parsedText=parsedText.replace(/\<img\sclass\=\"body_page_break\"\ssrc=\"_admin\/skins\/vanilla\/images\/empty\.gif\"\>/gi,_cePageBreakTag)}var reg='<img[^>]*? id="?editorGadget([0-9]+)"?[^>]*?>';var re=new RegExp(reg,"ig");parsedText=parsedText.replace(re,function(allstr,gadgetID){var result="##gadget"+gadgetID+"##";return result});var reg='<img[^>]*? id="?editorJavascript([0-9]+)"?[^>]*?>';var re=new RegExp(reg,"ig");window.javascriptContent=this.javascriptContent;parsedText=parsedText.replace(re,function(allstr,scriptIndex){var result="<script"+window.javascriptContent[scriptIndex]+"<\/script>";return result});window.javascriptContent=new Array();parsedText=parsedText.replace(/(<param\s+name=(?:"|')?play[^>]*?value=(?:"|')?)0/i,"$11");if(this.isFF){var reg='<img[^>]*? id="?editorFLASH([0-9]+)"?[^>]*?>';var re=new RegExp(reg,"ig");window.flashContent=this.flashContent;parsedText=parsedText.replace(re,function(allstr,flashIndex){var result="<object"+window.flashContent[flashIndex]+"</object>";return result});window.flashContent=new Array()}parsedText=parsedText.replace(/<(\/?)strong/gi,"<$1b");parsedText=parsedText.replace(/<(\/?)em([^bB])/gi,"<$1i$2");parsedText=parsedText.replace(/<ul><\/ul>/gi,"");parsedText=parsedText.replace(/<ol><\/ol>/gi,"");parsedText=parsedText.replace(/<p><\/p>/gi,"");var replacementFunc=function(_this){return function(wholeString,part1,part2){part2=_this.fixI18nDomainName(part2);if(_this.options&cmF_FULL_URLS){if(part2.substr(0,7)!="http://"&&part2.substr(0,8)!="https://"&&part2.substr(0,7)!="mailto:"&&part2.substr(0,6)!="ftp://"){part2=editorBaseHref+part2}}part2=part2.replace(/&amp;/g,"&");return part1+part2}}(this);parsedText=parsedText.replace(/(<a[^>]*?href="?'?)([^>]*?>)/ig,replacementFunc);parsedText=parsedText.replace(/(<(?:img|input|embed|iframe)[^>]*?[^a-zA-Z\-]src="?'?)([^>]*?>)/ig,replacementFunc);parsedText=parsedText.replace(/(<param[^>]*?name="?movie[^>]*?value="?'?)([^>]*?>)/ig,replacementFunc);if(!(this.options&cmF_FULL_URLS)){var tplHref=editorBaseHref.replace(/\//gi,"\\/");var rxReplaceLinks=new RegExp("(<\\w[^>]*?)"+tplHref,"gi");parsedText=parsedText.replace(rxReplaceLinks,"$1")}parsedText=parsedText.replace(/<link[^>]*?(?:_css\/(?:common\.css|dynamic\.css|spec\.css|ce\.css)|ce_custom_css)[^>]*?>/ig,"");var parsedText=parsedText.replace("<!--SPEC_HTML_EDITOR_SELECTION_START-->","").replace("<!--SPEC_HTML_EDITOR_SELECTION_END-->","").replace("<!--SPEC_HTML_EDITOR_SELECTION_STARTSPEC_HTML_EDITOR_SELECTION_END-->","");var stringToTest=parsedText.replace("SPEC_HTML_EDITOR_SELECTION_START","").replace("SPEC_HTML_EDITOR_SELECTION_END","").replace("/>",">").replace(" >",">").toLowerCase();if(stringToTest=="<br>"){parsedText=""}parsedText=parsedText.replace("<!---->","");parsedText=parsedText.replace(/ style=""/gi,"");parsedText=parsedText.replace(/ class=""/gi,"");parsedText=parsedText.replace(/ target="_self"/gi,"");if(this.isWebKit){var noscriptFix=function(_this){return function(wholeString,tagContent){return"<noscript>"+_this.unHtmlEntities(tagContent)+"</noscript>"}};parsedText=parsedText.replace(/<noscript>(.*)?<\/noscript>/ig,noscriptFix(this))}}else{parsedText=parsedText.replace(/\#\#[^\r\n]+?\#\#/g,function(string){string=string.replace(/\>/g,"&gt;");string=string.replace(/\</g,"&lt;");return string});var ss="(<!--SPEC_HTML_EDITOR_SELECTION_(START|END)-->){0,2}";var reg=ss+"(&"+ss+"#"+ss+"0"+ss+"3"+ss+"5"+ss+";"+ss+"){2}";var re=new RegExp(reg,"g");parsedText=parsedText.replace(re,function(string){return'<nobr double-hash="">'+string.replace(/[&035;]/g,"")+"</nobr>"});for(var i=0;i<SpecBlocks.length;i++){var reg="##"+SpecBlocks[i]["name"]+"(_([0-9]+))?##";var re=new RegExp(reg,"ig");window.amiCurrentLanguage=this.language;parsedText=parsedText.replace(re,function(allstr,postf,dig){var img="_img/spacer.gif";if((typeof(aHyperModulesInstances)!="undefined")&&(aHyperModulesInstances.indexOf(SpecBlocks[i]["module"])>=0)){var psName=SpecBlocks[i]["name"].replace("spec_","").replace("small_","");img=amiCommon.getModResourceURL("mod_specblock",{modId:SpecBlocks[i]["module"],locale:interface_lang,entity:"_specblock",block:psName})}var res1='<img src="'+img+'" title="[CAPTION] [NUM]" alt="[NAME] [NUM]" class="editorSpecBlock '+window.amiCurrentLanguage+'_[CLASSNAME]" id="[NAME]"{spec_num=[NUM]}>';res1=res1.replace(/\[CLASS\]/g,"spec_"+SpecBlocks[i]["group"]);res1=res1.replace(/\[NAME\]/g,SpecBlocks[i]["name"]);res1=res1.replace(/\[CLASSNAME\]/g,SpecBlocks[i]["name"].indexOf("spec_small_plugin")==0?"spec_small_plugin":SpecBlocks[i]["name"]);res1=res1.replace(/\[CAPTION\]/g,SpecBlocks[i]["caption"]);if(dig!=undefined){res1=res1.replace(/\{([^{]*?)=\[NUM\]\}/g," $1="+dig);res1=res1.replace(/\[NUM\]/g,dig)}else{res1=res1.replace(/\{([^{]*?)=\[NUM\]\}/g,"");res1=res1.replace(/\[NUM\]/g,"")}return res1})}if((typeof(_cePageBreakTag)!="undefined"&&_cePageBreakTag.length)&&_cePageBreakAllowed){var re=new RegExp(_cePageBreakTag,"gi");parsedText=parsedText.replace(re,'<img class="body_page_break" src="_admin/skins/vanilla/images/empty.gif">')}var re=/\#\#gadget([\d]+)\#\#/ig;parsedText=parsedText.replace(re,function(editorObject){return function(allstr,gadgetID){if(typeof(editorObject.gadgetContent[gadgetID])!="undefined"){var gadgetType=editorObject.gadgetContent[gadgetID]["gadgettype"];var gadgetParams=editorObject.gadgetContent[gadgetID];if(gadgetType==0||gadgetType==1||gadgetType==2){if(gadgetParams.gcontent!=undefined){gadgetType="imagetape"}if(gadgetParams.goriginal_url!=undefined){if(gadgetParams.goriginal_url.indexOf("youtube")>0){gadgetType="youtube"}if(gadgetParams.goriginal_url.indexOf("rutube")>0){gadgetType="rutube"}}editorObject.gadgetContent[gadgetID]["gadgettype"]=gadgetType}return'<img class="ui_gadget" src="'+(aGadgets[gadgetType][5]!=""?aGadgets[gadgetType][5]:"path/to/default/gadget/image")+'" id="editorGadget'+gadgetID+'">'}else{return allstr}}}(this));var reg="<script((.|\r?\n)*?)<\/script>";var re=new RegExp(reg,"ig");window.javascriptContent=new Array();parsedText=parsedText.replace(re,function(allstr,scriptContent){jsIndex=window.javascriptContent.length;window.javascriptContent[jsIndex]=scriptContent;var result='<img src="_img/spacer.gif" title="JavaScript" alt="JavaScript" class="ui_script" id="editorJavascript'+jsIndex+'">';return result});this.javascriptContent=window.javascriptContent;window.javascriptContent=new Array();if(this.isFF){var reg="<object((.|\r?\n)*?)</object>";var re=new RegExp(reg,"ig");window.flashContent=new Array();parsedText=parsedText.replace(re,function(allstr,flashContent){flashIndex=window.flashContent.length;window.flashContent[flashIndex]=flashContent;var result='<img src="_img/spacer.gif" title="FLASH" alt="FLASH" class="ui_flash" id="editorFLASH'+flashIndex+'">';return result});this.flashContent=window.flashContent;window.flashContent=new Array()}parsedText=parsedText.replace(/<(\/?)strong/gi,"<$1b");parsedText=parsedText.replace(/<(\/?)em([^bB])/gi,"<$1i$2")}return parsedText};this.hasMode=function(mode){return(this.allowedModes.indexOf(mode)>=0)};this.setMode=function(mode){this.checkEditor();if(!this.hasMode(mode)){return}if(this.hasMode("textarea")){AMI.removeClass(this.modeTextareaButton,"selected")}if(this.hasMode("editor")){AMI.removeClass(this.modeEditorButton,"selected")}if(this.hasMode("bb")){AMI.removeClass(this.modeBBButton,"selected")}switch(mode){case"textarea":AMI.addClass(this.modeTextareaButton,"selected");break;case"bb":AMI.addClass(this.modeBBButton,"selected");break;default:AMI.addClass(this.modeEditorButton,"selected")}this.toolbarPathObject.style.display="none";this.hlTxtSwitcher.style.display="none";this.hlBBSwitcher.style.display="none";this.editorObject.style.display="none";this.textareaObject.style.display="none";this.bbObject.style.display="none";var width=this.wrapper.style.width;var height=this.wrapper.style.height;this.currentMode=mode;switch(mode){case"editor":this.editorObject.style.width=width;this.editorObject.style.height=height;this.editorObject.style.display="block";this.toolbarPathObject.style.display="block";this.switchBBToolbar(false);this.disableToolBarButtons(false);break;case"textarea":this.hlTxtSwitcher.style.display="block";this.textareaObject.style.width=width;this.textareaObject.style.height=height;this.textareaObject.style.display="inline-block";if(!this.hlHTML){if(this.highlighter&&this.highlighter.oEditor){this.highlighter.oEditor.getWrapperElement().style.display="none"}if(!this.bNoFocus){this.textareaObject.focus()}}this.switchBBToolbar(false);this.disableToolBarButtons(true);break;case"bb":this.hlBBSwitcher.style.display="block";this.bbObject.style.display="block";this.txtEd.editorObj.style.width=width;this.txtEd.editorObj.style.height=height;if(!this.hlBB){if(this.highlighter&&this.highlighter.oEditor){this.highlighter.oEditor.getWrapperElement().style.display="none"}if(!this.bNoFocus){this.txtEd.editorObj.focus()}}this.switchBBToolbar(true);this.disableToolBarButtons(true);break}this.highlight();if(!this.noModeCookies){this.setOpt("mode",mode)}this.checkEditor();this.updateToolBar()};this.actionEditorMode=function(bTransportSelection,evt){var oldMode=this.currentMode,oldValue,newValue;this.skipChanges=true;this.checkEditor();if(typeof bTransportSelection=="undefined"){bTransportSelection=true}if(bTransportSelection){if(this.currentMode!="editor"){this.placeSelectionMarks()}}this.modeBeforeEditor=this.currentMode;this.setMode("editor");if(!oldMode||(oldMode=="textarea")){oldValue=this.prevValues.textarea;newValue=this.textareaObject.value.replace(this.selStartMark,"").replace(this.selEndMark,"");if(oldValue!==newValue){this.skipChanges=false;this.prevValues.textarea=newValue;this.formChanged(evt)}this.transportTextFromTextareaToEditor()}if(oldMode=="bb"){oldValue=this.prevValues.bb;newValue=this.txtEd.editorObj.value.replace(this.selStartMark,"").replace(this.selEndMark,"");if(oldValue!==newValue){this.skipChanges=false;this.prevValues.bb=newValue;this.formChanged(evt)}this.transportTextFromBBToEditor()}if(bTransportSelection){var comments=this.getCommentNodes(this.editorDocument.body);var startNode=null;var endNode=null;if(comments&&comments.length){for(var i=0;i<comments.length;i++){if(comments[i].nodeValue==this.selStartMark){startNode=comments[i]}if(comments[i].nodeValue==this.selEndMark){endNode=comments[i]}}}if(startNode&&endNode){if(this.isIE){var tRange1=this.editorDocument.body.createTextRange();var tRange2=tRange1.duplicate();tRange1.moveToElementText(startNode);tRange2.moveToElementText(endNode);tRange1.setEndPoint("EndToEnd",tRange2);tRange1.select()}else{var range=null;var sel=this.getEditorSelection();sel.removeAllRanges();range=this.editorDocument.createRange();range.setStart(startNode,0);range.setEnd(endNode,0);sel.addRange(range)}startNode.parentNode.removeChild(startNode);endNode.parentNode.removeChild(endNode)}}this.skipChanges=false;if(!this.bNoFocus){this.focusWindow()}};this.actionTextareaMode=function(bTransportSelection,evt){var oldValue,newValue;this.skipChanges=true;this.checkEditor();var oldMode=this.currentMode;if(typeof bTransportSelection=="undefined"){bTransportSelection=true}if(bTransportSelection){this.placeSelectionMarks()}this.setMode("textarea");if(oldMode=="bb"){oldValue=this.prevValues.bb;newValue=this.txtEd.editorObj.value.replace(this.selStartMark,"").replace(this.selEndMark,"");if(oldValue!==newValue){this.skipChanges=false;this.prevValues.bb=newValue}this.transportTextFromBBToTextarea()}if(oldMode=="editor"){oldValue=this.prevValues.editor;newValue=this.editorDocument.body.innerHTML;newValue=newValue.replace(this.selStartMark,"").replace(this.selEndMark,"");if(oldValue!==newValue){this.skipChanges=false;this.prevValues.editor=newValue}this.transportTextFromEditorToTextarea()}if(bTransportSelection){this.markSelection(this.textareaObject)}if(!this.hlHTML&&!this.bNoFocus){this.textareaObject.focus()}this.skipChanges=false};this.actionBBMode=function(bTransportSelection,evt){this.checkEditor();var oldValue="",newValue="";this.skipChanges=true;if(this.currentMode=="bb"){if(!this.hlBB){this.txtEd.editorObj.focus()}return}var oldMode=this.currentMode;if(typeof bTransportSelection=="undefined"){bTransportSelection=true}if(bTransportSelection){this.placeSelectionMarks()}var value="";if((oldMode=="editor")&&this.editorDocument){oldValue=this.prevValues.editor;newValue=this.editorDocument.body.innerHTML.replace(this.selStartMark,"").replace(this.selEndMark,"");if(oldValue!==newValue){this.prevValues.editor=newValue;this.skipChanges=false}value=this.replaceStoredTags(this.txtEd.fromHTMLContent(this.adjustHTMLforBB(this.parseHTMLCode(this.editorDocument.body.innerHTML,true))))}if(oldMode=="textarea"){if(this.hlHTML&&this.highlighter){this.highlighter.save()}oldValue=this.prevValues.textarea;newValue=this.textareaObject.value.replace(this.selStartMark,"").replace(this.selEndMark,"");if(oldValue!==newValue){this.prevValues.textarea=newValue;this.skipChanges=false}value=this.replaceStoredTags(this.txtEd.fromHTMLContent(this.adjustHTMLforBB(this.textareaObject.value)));if(!value){this.textareaObject.value=this.adjustSelection(this.textareaObject.value,"textarea");value=this.replaceStoredTags(this.txtEd.fromHTMLContent(this.adjustHTMLforBB(this.textareaObject.value)));this.prevValues.bb=value}}if(oldMode==""){this.textareaObject.value=this.adjustSelection(this.textareaObject.value,"textarea");value=this.replaceStoredTags(this.txtEd.fromHTMLContent(this.adjustHTMLforBB(this.textareaObject.value)))}this.setMode("bb");this.hlBBEditor(false,true);this.txtEd.editorObj.value=value;this.hlBBEditor(true);if(bTransportSelection){this.markSelection(this.txtEd.editorObj)}this.skipChanges=false};this.adjustHTMLforBB=function(html){this.checkEditor();this.aBBTags=[];var i=0;var bbReg=/\[\/?(B|S|P|I|U|H1|H2|H3|H4|H5|DIV|LEFT|RIGHT|CENTER|JUSTIFY|INDENT|URL|IMG|OL|LIST|\*|Q|CODE|SIZE|COLOR)(\=[^\]]*?)?\]/img;this.skipChanges=false;this.aBBTags=html.match(bbReg);if(this.aBBTags){for(var i=0;i<this.aBBTags.length;i++){html=html.replace(this.aBBTags[i],"{__CE_BB_TAG_"+i+"}")}}return html};this.replaceStoredTags=function(html){this.checkEditor();var bbReg=/\[\/?(B|S|P|I|U|H1|H2|H3|H4|H5|DIV|LEFT|RIGHT|CENTER|JUSTIFY|INDENT|URL|IMG|OL|LIST|\*|Q|CODE|SIZE|COLOR)/img;var aBBTags=html.match(bbReg);if(aBBTags){for(var i=0;i<aBBTags.length;i++){html=html.replace(aBBTags[i],aBBTags[i].toString().toUpperCase())}}if(this.aBBTags){for(var i=0;i<this.aBBTags.length;i++){html=html.replace("{__CE_BB_TAG_"+i+"}",function(match,offset,str){if(isInRaw(str,offset)){return this.aBBTags[i]}return"[RAW]"+this.aBBTags[i]+"[/RAW]"}.bind(this))}}return html};this.placeSelectionMarks=function(){this.checkEditor();this.skipChanges=true;switch(this.currentMode){case"editor":this.placeSelectionMarksEditor();break;case"bb":this.placeSelectionMarksBB(this.hlBB);break;case"textarea":this.placeSelectionMarksTextarea(this.hlHTML);break}this.skipChanges=false};this.placeSelectionMarksEditor=function(){this.checkEditor();if(this.isIE){var tURange=this.getEditorRange();var tUSel=this.getEditorSelection();var tRange=tURange;if(tUSel.type=="Control"){var tRange=tURange.item(0).parentTextEdit.createTextRange();tRange.moveToElementText(tURange.item(0));if(tURange.item(0).tagName=="SPAN"||tURange.item(0).tagName=="DIV"||tURange.item(0).tagName=="P"||tURange.item(0).tagName=="TABLE"){tRange.moveStart("character",-1);tRange.moveEnd("character",1)}}var eRange=this.editorDocument.body.createTextRange();if(eRange.inRange(tRange)){this.storedBookmark=tRange.getBookmark();eRange=tRange.duplicate();tRange.collapse(1);tRange.pasteHTML(this.selStartMark);eRange.collapse(0);eRange.pasteHTML(this.selEndMark)}}else{if(!this.isOpera){var selectionStart=this.editorDocument.createTextNode(this.selStartMark);var selectionEnd=this.editorDocument.createTextNode(this.selEndMark);var Range=this.getEditorRange();if(Range){if(this.isFF){var startOffset=Range.startOffset;var endOffset=Range.endOffset;var endEl=null;if(Range.endContainer.tagName=="BODY"){endEl=Range.endContainer.childNodes[endOffset]}if(Range.startContainer.tagName!="BODY"){if(Range.startContainer.nodeType==3){var data=Range.startContainer.data;Range.startContainer.data=data.substr(0,startOffset)+this.selStartMark+data.substr(startOffset,data.length)}else{Range.startContainer.parentNode.insertBefore(selectionStart,Range.startContainer)}}else{var children=Range.startContainer.childNodes;if(children&&children[startOffset]){Range.startContainer.insertBefore(selectionStart,children[startOffset])}else{Range.startContainer.appendChild(selectionStart)}}if(Range.endContainer.tagName!="BODY"){if(Range.endContainer.nodeType==3){var data=Range.endContainer.data;if(data.indexOf(this.selStartMark)>=0){endOffset+=this.selStartMark.length}Range.endContainer.data=data.substr(0,endOffset)+this.selEndMark+data.substr(endOffset,data.length)}else{Range.endContainer.parentNode.insertBefore(selectionEnd,Range.endContainer)}}else{var children=Range.endContainer.childNodes;if(endEl&&((endEl.nodeType==3)||!endEl.getAttribute("_moz_editor_bogus_node"))){Range.endContainer.insertBefore(selectionEnd,endEl)}else{Range.endContainer.appendChild(selectionEnd)}}}else{try{var rng=Range.cloneRange();var rngEnd=rng.cloneRange();rngEnd.collapse(false);rngEnd.insertNode(selectionEnd);var rngStart=rng.cloneRange();rngStart.collapse(true);rngStart.insertNode(selectionStart)}catch(e){}}}}else{}}};this.placeSelectionMarksSource=function(oTextarea,highlighted){this.checkEditor();if(highlighted){var selectedText=this.highlighter.oEditor.getSelection();this.highlighter.oEditor.replaceSelection(this.selStartMark+selectedText+this.selEndMark,"")}else{oTextarea.focus();if(document.selection&&document.selection.createRange){var sRange=document.selection.createRange();sRange.text=this.selStartMark+sRange.text+this.selEndMark}else{if(typeof(oTextarea.selectionStart)!=undefined){var sStart=parseInt(oTextarea.selectionStart);var sEnd=parseInt(oTextarea.selectionEnd);var begin=oTextarea.value.substr(0,sStart);var selectedText=oTextarea.value.substr(sStart,sEnd-sStart);var end=oTextarea.value.substr(sEnd,oTextarea.value.length);oTextarea.value=begin+this.selStartMark+selectedText+this.selEndMark+end}}}};this.placeSelectionMarksTextarea=function(highlighted){this.checkEditor();this.placeSelectionMarksSource(this.textareaObject,highlighted)};this.placeSelectionMarksBB=function(highlighted){this.checkEditor();this.placeSelectionMarksSource(this.txtEd.editorObj,highlighted)};this.adjustSelection=function(value,mode){this.checkEditor();if(this.isOpera){return value.replace(this.selStartMark,"").replace(this.selEndMark,"")}var noMarksValue=value.replace(this.selStartMark,"").replace(this.selEndMark,"");var startIndex=value.indexOf(this.selStartMark);var endIndex=value.replace(this.selStartMark,"").indexOf(this.selEndMark);if((startIndex<0)||(endIndex<0)){return noMarksValue}var gadgetRegexp=new RegExp("##gadget(\\d+)##","ig");var specblRegexp=new RegExp("##spec(.*?)##","ig");var txareaRegexp=new RegExp("<textarea((?:.|\r|\n)*?)<\\/textarea>","ig");var aRegexps=[gadgetRegexp,specblRegexp,txareaRegexp];if(typeof(_cePageBreakTag)!="undefined"){aRegexps.push(new RegExp(_cePageBreakTag,"ig"))}if(mode=="bb"){aRegexps.push(new RegExp(":([a-zA-Z]*?):","ig"))}for(var r=0;r<aRegexps.length;r++){var aMatches=noMarksValue.match(aRegexps[r]);if(aMatches){var needChanges=false;for(var i=0;i<aMatches.length;i++){var gadgetStartIndex=noMarksValue.indexOf(aMatches[i]);var gadgetEndIndex=gadgetStartIndex+aMatches[i].length;if((startIndex>gadgetStartIndex)&&(startIndex<gadgetEndIndex)){needChanges=true;startIndex=gadgetStartIndex}if((endIndex>gadgetStartIndex)&&(endIndex<gadgetEndIndex)){needChanges=true;endIndex=gadgetEndIndex}}if(needChanges){value=noMarksValue.substr(0,startIndex)+this.selStartMark+noMarksValue.substr(startIndex,endIndex-startIndex)+this.selEndMark+noMarksValue.substr(endIndex,noMarksValue.length)}}}var startTag=(mode=="bb")?"[":"<";var endTag=(mode=="bb")?"]":">";var startMarker=(mode=="editor")?"<!--"+this.selStartMark+"-->":this.selStartMark;var endMarker=(mode=="editor")?"<!--"+this.selEndMark+"-->":this.selEndMark;value=value.replace(this.selStartMark,"");var iteration=0;var newIndex=startIndex;var moveCursorToTheEndOfTag=false;if(startIndex>0){while(true){newIndex--;if(value.charAt(newIndex)==endTag){break}if(value.charAt(newIndex)==startTag){if(startIndex==endIndex){moveCursorToTheEndOfTag=true}else{startIndex=newIndex}break}if(newIndex==0){break}iteration++;if(iteration==5000){break}}}if(!moveCursorToTheEndOfTag){var start=value.substr(0,startIndex);var end=value.substr(startIndex,value.length);value=start+startMarker+end}var endIndex=value.indexOf(this.selEndMark);value=value.replace(this.selEndMark,"");var iteration=0;var newIndex=endIndex-1;if(endIndex<value.length){while(true){newIndex++;if(value.charAt(newIndex)==endTag){endIndex=newIndex+1;break}if(value.charAt(newIndex)==startTag){break}if(newIndex==value.length){break}iteration++;if(iteration==5000){break}}}var start=value.substr(0,endIndex);var end=value.substr(endIndex,value.length);if(!moveCursorToTheEndOfTag){value=start+endMarker+end}else{value=start+startMarker+endMarker+end}return value};this.markSelection=function(textareaObject){this.checkEditor();this.skipChanges=true;var highlighted=((this.currentMode=="textarea")&&this.hlHTML)||((this.currentMode=="bb")&&this.hlBB);if(highlighted){var cursor=this.highlighter.oEditor.getSearchCursor(this.selStartMark,false);cursor.findNext();var startPos=cursor.from();cursor.replace("");cursor=this.highlighter.oEditor.getSearchCursor(this.selEndMark,false);cursor.findNext();var endPos=cursor.from();cursor.replace("");if(!startPos&&endPos){startPos=endPos}if(startPos&&!endPos){endPos=startPos}if(startPos&&endPos){this.highlighter.oEditor.setSelection(startPos,endPos)}}else{textareaObject.focus();if(this.isIE){var tRange=textareaObject.createTextRange();var sRange=tRange.duplicate();if(sRange.findText(this.selStartMark)){sRange.text="";var eRange=tRange.duplicate();if(eRange.findText(this.selEndMark)){eRange.text="";tRange.setEndPoint("StartToStart",sRange);tRange.setEndPoint("EndToEnd",eRange);tRange.select()}}}else{var taValue=textareaObject.value;var selStart=taValue.indexOf(this.selStartMark);var selEnd=taValue.indexOf(this.selEndMark);if(selStart>=0&&selEnd>=0){if(selStart>selEnd){var oldSelStart=selStart;selStart=selEnd;selEnd=oldSelStart;oldSelStart=this.selStartMark;this.selStartMark=this.selEndMark;this.selEndMark=oldSelStart}textareaObject.value=taValue.substr(0,selStart)+taValue.substr(selStart+this.selStartMark.length,selEnd-selStart-this.selStartMark.length)+taValue.substr(selEnd+this.selEndMark.length);textareaObject.selectionStart=selStart;textareaObject.selectionEnd=selEnd-this.selStartMark.length;textareaObject.scrollTop=Math.max(0,parseInt(textareaObject.scrollHeight*selStart/textareaObject.value.length)-50)}}}this.skipChanges=false};this.actionFormatText=function(currentEvent){this.checkEditor();var objectSelect=amiCommon.getEventTarget(amiCommon.getValidEvent(currentEvent));var selectedFormat=objectSelect.value;if(this.currentMode=="editor"){if(selectedFormat==""){var parentBlock=this.getSelectedAnchorNode();var aLastParentNodes=["H1","H2","H3","H4","H5","P","DIV","SPAN"];var isLastParentNode=(aLastParentNodes.indexOf(parentBlock.tagName)>=0);while(parentBlock.parentNode&&!isLastParentNode){parentBlock=parentBlock.parentNode;isLastParentNode=(aLastParentNodes.indexOf(parentBlock.tagName)>=0)}if(isLastParentNode){if(this.isIE){parentBlock.removeNode(false)}else{var firstCh;while(firstCh=parentBlock.firstChild){parentBlock.parentNode.insertBefore(firstCh,parentBlock)}parentBlock.parentNode.removeChild(parentBlock)}}}else{this.editorDocument.execCommand("FormatBlock",false,selectedFormat)}this.formChanged(currentEvent);this.updateToolBar();this.focusWindow()}else{if(this.currentMode=="bb"){var translationTable={"<H1>":"h1","<H2>":"h2","<H3>":"h3","<H4>":"h4","<H5>":"h5","<P>":"paragraph","<DIV>":"div","<PRE>":"code"};if((selectedFormat!="")&&(typeof(translationTable[selectedFormat])!="undefined")){var action=translationTable[selectedFormat];this.txtEd.procAction(action);this.formChanged(currentEvent);this.txtEd.editorObj.focus();AMI.$(this.selectFormat).val("")}}}};this.actionFontSizeText=function(currentEvent){if(this.currentMode=="editor"){var objectFontSize=amiCommon.getEventTarget(amiCommon.getValidEvent(currentEvent));var selectedFontSize=objectFontSize.value;this.setStyleForSelected("fontSize",selectedFontSize+"px");this.formChanged(currentEvent);this.updateToolBar();this.focusWindow()}};this.actionPasteAsText=function(currentEvent){this.checkEditor();if(this.isIE){var rng=this.getEditorRange();rng.collapse();var pasteText=window.clipboardData.getData("Text");rng.pasteHTML(pasteText.replace(/\n/g,"\n<br>"));rng.select();this.formChanged(currentEvent);this.updateToolBar();this.focusWindow()}else{this.sessionData.rng=this.getEditorRange();this.sessionData.evt=currentEvent;edOpenPasteTextDialog(this.textareaName)}};this.actionPaste=function(currentEvent,saveFormatting,isDirectPaste){this.checkEditor();if(this.isIE){var clipObj=document.getElementById("htmlEditorClipboardContent");if(clipObj==null){var clipObj=document.createElement("div");clipObj.id="htmlEditorClipboardContent";clipObj.className="htmlEditorClipboard";clipObj=document.body.appendChild(clipObj)}var tRange=document.body.createTextRange();var tBookmark=tRange.getBookmark();tRange.moveToElementText(clipObj);tRange.execCommand("Paste");sHTML=clipObj.innerHTML;clipObj.innerHTML="";if(checkHTML(sHTML)>0){sHTML=cleanHTML(sHTML,saveFormatting?"MSOffice":"")}sHTML=sHTML.replace(wordPasteReplaceRx,"$1=$2");tRange=this.getEditorRange();tSel=this.getEditorSelection();if(tSel.type=="Control"){tRange.item(0).removeNode();tRange=this.getEditorRange()}tRange.pasteHTML(sHTML);amiCommon.stopEvent(currentEvent)}else{if(!isDirectPaste){this.sessionData.rng=this.getEditorRange();this.sessionData.evt=currentEvent;if(saveFormatting){edOpenPasteHtmlFormattedDialog(this.textareaName)}else{edOpenPasteHtmlDialog(this.textareaName)}}else{if(this.isWebKit&&isDirectPaste){setTimeout(function(){this.cleanupWebKitExcessStylesOnPaste()}.bind(this),1)}}}};this.saveLastScrollPosition=function(){var highlighted=(this.currentMode=="textarea"&&this.hlHTML)||(this.currentMode=="bb"&&this.hlBB);var scrollPosition=0;var id=this.getElementId();if(!id){return}if(highlighted&&this.currentMode!="editor"){if(this.highlighter&&this.highlighter.oEditor){scrollPosition=this.highlighter.oEditor.getScrollerElement().scrollTop}}if(this.currentMode=="editor"){if(this.editorObject.contentWindow&&this.editorObject.contentWindow.document){scrollPosition=(this.isFF)?this.editorObject.contentWindow.document.body.parentNode.scrollTop:this.editorObject.contentWindow.document.body.scrollTop}}if(!highlighted&&this.currentMode=="bb"){scrollPosition=this.txtEd.editorObj.scrollTop}if(!highlighted&&this.currentMode=="textarea"){scrollPosition=this.textareaObject.scrollTop}if(this.lastScrollPosition!=scrollPosition){this.lastScrollPosition=scrollPosition;this.scrollPositionChanged=true;var scrollValue=this.currentMode+"|"+(highlighted?"1":"0")+"|"+id+"|"+scrollPosition;this.setOpt("scrollPosition",scrollValue)}else{if(this.scrollPositionChanged){this.scrollPositionChanged=false}}this.checkEditor()};this.restoreScrollPosition=function(){var highlighted=(this.currentMode=="textarea"&&this.hlHTML)||(this.currentMode=="bb"&&this.hlBB);var pos=this.getOpt("scrollPosition",-1);if(pos==-1){return}if(!this.getElementId()){return}var aPos=pos.toString().split("|");var mode=aPos[0];var hl=aPos[1]=="1"?true:false;var id=aPos[2];var position=aPos[3];if((this.currentMode==mode)&&(highlighted==hl)&&(this.getElementId()==id)){if(!hl){switch(this.currentMode){case"editor":if(this.isFF){this.editorObject.contentWindow.document.body.parentNode.scrollTop=position}else{this.editorObject.contentWindow.document.body.scrollTop=position}break;case"bb":this.txtEd.editorObj.scrollTop=position;break;case"textarea":this.textareaObject.scrollTop=position;break}}else{if(this.highlighter&&this.highlighter.oEditor){this.highlighter.oEditor.getScrollerElement().scrollTop=position}}}this.checkEditor()};this.cleanupWebKitExcessStylesOnPaste=function(){parsedTextOriginal=parsedText=this.editorDocument.body.innerHTML;window.tmpDefaultBGColor=this.editorDocument.queryCommandValue("BackColor");window.tmpDefaultForeColor=this.editorDocument.queryCommandValue("ForeColor");window.tmpDefaultFontName=this.editorDocument.queryCommandValue("FontName");window.tmpDefaultFontSize=this.editorDocument.queryCommandValue("FontSize");var specWebKitReplaceCB=function(wholeString,part1,part2){part2=part2.replace(/(margin-(top|right|bottom|left): (5|0|12)px;)|(padding-(top|right|bottom|left): 0px;)|(border-(top|right|bottom|left)-width: 1px;)|(border-(top|right|bottom|left)-color: rgb\((153, 153, 185|153, 185, 153|185, 153, 153)\);)|(border-(top|right|bottom|left)-style: solid;)|(background-image: url\([^\)]*?\/ed_tag_(div|p|pre|h|span)\.gif\);)|(background-(attachment|origin|clip|color): initial;)|(background-position: 100% 0%;)|(background-repeat: no-repeat no-repeat;)/ig,"");if(window.tmpDefaultForeColor!=""){var rx=new RegExp("color: "+window.tmpDefaultForeColor.replace("(","\\(").replace(")","\\)")+";","ig");part2=part2.replace(rx,"")}if(window.tmpDefaultFontName!=""){rx=new RegExp("font-family: "+window.tmpDefaultFontName+";","ig");part2=part2.replace(rx,"")}if(window.tmpDefaultFontSize!=""){rx=new RegExp("font-size: "+window.tmpDefaultFontSize+";","ig");part2=part2.replace(rx,"")}part2=part2.replace(/\s+/g," ").replace(/^\s+/,"").replace(/\s+$/,"");if(part2!=""&&part2!=" "){return part1+'style="'+part2+'"'}else{return part1}};parsedText=parsedText.replace(/(<(?:div|span|pre|p|h\d+)\s+[^>]*)style="([^"]*?ed_tag_(?:div|p|pre|h|span)\.gif[^"]*?)"/ig,specWebKitReplaceCB);var rx=new RegExp('(<(?:div|span|pre|p|h\\d+)\\s+[^>]*)style="[^"]*?background-color: '+window.tmpDefaultBGColor.replace("(","\\(").replace(")","\\)")+';[^"]*?color: '+window.tmpDefaultForeColor.replace("(","\\(").replace(")","\\)")+';[^"]*?font-family: '+window.tmpDefaultFontName.replace("(","\\(").replace(")","\\)")+';[^"]*?font-size: '+window.tmpDefaultFontSize.replace("(","\\(").replace(")","\\)")+';[^"]*?"',"ig");parsedText=parsedText.replace(rx,"$1");var specWebKitReplace2CB=function(wholeString,part1,part2){part2=part2.replace(/[a-z\-]: initial(?: initial)?;/ig,"");return part1+part2+'"'};parsedText=parsedText.replace(/(\sstyle=")(.*?)"/ig,specWebKitReplace2CB);if(parsedTextOriginal.length!=parsedText.length){this.editorDocument.body.innerHTML=parsedText}parsedText=parsedText.replace(/<span style="(.*?)display: inline \!important;">(.*?)<\/span>/ig,"$2");if(parsedTextOriginal.length!=parsedText.length){$(this.editorDocument).find("*").contents().filter(function(){return this.nodeType==3}).each(function(i,el){var testSpan=el.parentNode;var nodeName=testSpan.nodeName;var nodeStyle=AMI.$(testSpan).attr("style");if(nodeName=="SPAN"&&nodeStyle.indexOf("display: inline !important")>=0){AMI.$(el).unwrap()}})}};this.documentPaste=function(textValue){this.checkEditor();this.setEditorSelection(this.sessionData.rng);this.insertContent(textValue);this.formChanged(this.sessionData.evt);this.updateToolBar()};this.actionSpecblockClick=function(specBlockObject,dataType){dataType=dataType||"auto";var isEditorMode=false;var editorSelectedObject=null;if(this.currentMode=="editor"){isEditorMode=true;if(typeof(specBlockObject)=="undefined"){var selectedObj=this.getSelectedNode();if(selectedObj!=null&&selectedObj.className&&selectedObj.className.substr(0,15)=="editorSpecBlock"){editorSelectedObject=selectedObj}}else{editorSelectedObject=specBlockObject}this.sessionData.rng=this.getEditorRange();edShowSpecblocksPopup(textareaName,isEditorMode,editorSelectedObject,dataType)}};this.actionApplyTemplate=function(){this.sessionData.rng=this.getEditorRange();edShowApplyTemplatePopup(this.textareaObject.name,this.currentMode=="editor")};this.actionImageClick=function(imageObject){if(this.currentMode=="editor"){this.sessionData.rng=this.getEditorRange();this.sessionData.selectedNode=this.getSelectedNode();edShowImagePopup(this.textareaName,this.currentMode,null)}};this.actionBackgroundImageClick=function(){if(this.currentMode=="editor"){var nearestObj=this.getNearestObject();var parentFound=false;do{if(nearestObj.tagName&&(nearestObj.tagName=="TABLE"||nearestObj.tagName=="TR"||nearestObj.tagName=="TD"||nearestObj.tagName=="TH"||nearestObj.tagName=="DIV")){parentFound=true;break}}while(nearestObj=nearestObj.parentNode);if(nearestObj){this.sessionData.selectedNode=this.getSelectedNode();this.sessionData.getEditorFirstSelectedItem=this.getEditorFirstSelectedItem();edShowBackgroundImagePopup(this.textareaName,this.currentMode,null)}}};this.actionGadgetClick=function(gadgetObject){var isEditorMode=false;var editorSelectedObject=null;if(this.currentMode=="editor"){isEditorMode=true;if(typeof(gadgetObject)=="undefined"){var selectedObj=this.getSelectedNode();if(selectedObj!=null&&selectedObj.className&&selectedObj.className.substr(0,15)=="editorGadget"){editorSelectedObject=selectedObj}}else{editorSelectedObject=gadgetObject}this.sessionData.rng=this.getEditorRange();edShowGadgetSelectPopup(textareaName,isEditorMode,editorSelectedObject)}};this.inArray=function(needle,haystack){for(var i=0;i<haystack.length;i++){if(haystack[i]==needle){return true}}return false};this.actionInsertPageBreak=function(){if(this.currentMode=="editor"&&typeof(_cePageBreakTag)!="undefined"){var _allowed=true;if(typeof(_cePageBreakForbiddenBoundTags)!="undefined"){var el=this.getSelectedAnchorNode();var tags=[];do{if(el.tagName){tags[tags.length]=el.tagName.toUpperCase()}}while(el=el.parentNode);var forbidden_tags=_cePageBreakForbiddenBoundTags.split(";");for(var i=0;i<forbidden_tags.length;i++){if(forbidden_tags[i]!=""&&this.inArray(forbidden_tags[i].toUpperCase(),tags)){_allowed=false;break}}}if(_allowed){this.insertContent('<img class="body_page_break" src="_admin/skins/vanilla/images/empty.gif">')}}};this.actionSmiles=function(currentTarget){if(this.currentMode=="editor"){this.sessionData.rng=this.getEditorRange();edShowSmilesPopup(this.textareaName,currentTarget)}if(this.currentMode=="bb"){edShowSmilesPopup(this.textareaName,currentTarget)}};this.actionSpecialChars=function(currentTarget){if(this.currentMode=="editor"){this.sessionData.rng=this.getEditorRange();edShowSpecialCharsPopup(this.textareaName,currentTarget)}if(this.currentMode=="bb"){edShowSpecialCharsPopup(this.textareaName,currentTarget)}};this.correctFrames=function(){if(!this.framesCorrected){if(this.editorDocument.styleSheets.length){this.actionShowTableBorders(this.showFrames)}else{setTimeout(function(_this){return function(){_this.correctFrames()}}(this),300)}}};this.actionShowTableBorders=function(state){this.showFrames=state;for(var i=0;i<this.editorDocument.styleSheets.length;i++){var oStyleSheet=this.editorDocument.styleSheets[i];if(!oStyleSheet.href){this.setOpt("htmlEditorShowBorders",typeof(state)=="undefined"?(oStyleSheet.disabled?"0":"1"):(state=="0"?"0":"1"));return}if(oStyleSheet.href.indexOf(ceDynamicCSSFile)>=0){oStyleSheet.disabled=(typeof(state)=="undefined"?!oStyleSheet.disabled:(state=="0"));var setButton=this.getButton("ShowTableBorders");if(setButton!=null){setButton.className="simpleButtonHTMLEditor"+(oStyleSheet.disabled?"":"Set")}this.setOpt("htmlEditorShowBorders",typeof(state)=="undefined"?(oStyleSheet.disabled?"0":"1"):(state=="0"?"0":"1"));this.framesCorrected=true}}};this.actionTDAlign=function(isVertical,alignment){var td=this.getNearestObjectByTagName("td");if(td!=null){if(isVertical){td.style.verticalAlign=alignment}else{td.style.textAlign=alignment}}};this.actionTableAddRow=function(isBeforeCurrent){var table=this.getNearestObjectByTagName("table");if(table!=null){var tBodies=table.tBodies[0];var newRow=null;if(isBeforeCurrent){var tr=this.getNearestObjectByTagName("tr");if(tr!=null){newRow=tr.cloneNode(true);newRow=tBodies.insertBefore(newRow,tr)}}if(newRow==null){newRow=tBodies.rows[tBodies.rows.length-1].cloneNode(true);newRow=tBodies.appendChild(newRow)}for(i=0;i<newRow.cells.length;i++){newRow.cells[i].innerHTML="&nbsp;"}}};this.actionTableDelRow=function(){var table=this.getNearestObjectByTagName("table");if(table!=null){if(confirm(editorTranslation.DelRowConfirm)){var tBodies=table.tBodies[0];var tr=this.getNearestObjectByTagName("tr");if(tr!=null){tBodies.removeChild(tr)}}}};this.actionTableInsertCell=function(){var cell=this.getNearestObjectByTagName("td");if(cell!=null){var newCell=this.editorDocument.createElement("td");newCell.innerHTML="&nbsp;";cell.parentNode.insertBefore(newCell,cell)}};this.actionTableDelCell=function(){var cell=this.getNearestObjectByTagName("td");if(cell!=null&&confirm(editorTranslation.DelCellConfirm)){cell.parentNode.removeChild(cell)}};this.actionTableAddCol=function(where){var table=this.getNearestObjectByTagName("table");var cell=this.getNearestObjectByTagName("td");if(table!=null&&cell!=null){var cellTr=cell.parentNode;for(cellIndex=0;cellIndex<cellTr.cells.length;cellIndex++){if(cellTr.cells[cellIndex]==cell){break}}for(i=0;i<table.rows.length;i++){if(where=="left"){var newCell=table.rows[i].insertCell(cellIndex);newCell.innerHTML="&nbsp;"}else{var newCell=table.rows[i].insertCell(cellIndex+1);newCell.innerHTML="&nbsp;"}}}};this.actionTableDelCol=function(){var table=this.getNearestObjectByTagName("table");var cell=this.getNearestObjectByTagName("td");if(table!=null&&cell!=null&&confirm(editorTranslation.DelColConfirm)){var cellTr=cell.parentNode;for(cellIndex=0;cellIndex<cellTr.cells.length;cellIndex++){if(cellTr.cells[cellIndex]==cell){break}}for(i=0;i<table.rows.length;i++){var newCell=table.rows[i].deleteCell(cellIndex)}}};this.actionTable=function(currentTarget,doInsertTable){if(!doInsertTable){this.sessionData.nearestTable=this.getNearestObjectByTagName("table");if(this.sessionData.nearestTable!=null){this.sessionData.nearestObject=this.getNearestObject();edEditTable(this.textareaName);return}}this.sessionData.rng=this.getEditorRange();edShowTableCreatePopup(this.textareaName,currentTarget)};this.insertTable=function(currentEvent,cols,rows){this.focusWindow();this.setEditorSelection(this.sessionData.rng);var oNewTable=this.editorDocument.createElement("table");oNewTable.border="0";oNewTable.cellSpacing="0";oNewTable.cellPadding="0";oNewTable.borderColor="";oNewTable.width="100%";for(i=0;i<rows;i++){var oRow=this.editorDocument.createElement("TR");oNewTable.appendChild(oRow);for(j=0;j<cols;j++){var oCol=this.editorDocument.createElement("TD");oCol.innerHTML="&nbsp;";oRow.appendChild(oCol)}}oNewDiv=this.editorDocument.createElement("div");oNewDiv.appendChild(oNewTable);this.insertContent(oNewDiv.innerHTML);this.actionShowTableBorders("1");this.formChanged(currentEvent);this.updateToolBar()};this.actionSetColor=function(evt,type,doNotShowPopup,color){var doNotFill=true;var selectedObj=null;if(type=="BackColor"){if(this.isSelectedObject()){selectedObj=this.getSelectedNode();if(!selectedObj.tagName){selectedObj=null}}else{if(this.isCollapsed()){var firstItem=this.getEditorFirstSelectedItem();if(firstItem!=null){if(!firstItem.tagName){selectedObj=firstItem.parentNode}else{selectedObj=firstItem}}}else{doNotFill=false}}if(doNotFill){var so=selectedObj;if(so!=null&&so.tagName&&(so.tagName=="TD"||so.tagName=="TH"||so.tagName=="TR"||so.tagName=="TABLE"||so.tagName=="DIV"||so.tagName=="IMG"||so.tagName=="INPUT")){doNotFill=false}}}else{if(!this.isCollapsed()){doNotFill=false}}if(!doNotFill){var isColorApplied=false;if(doNotShowPopup){if(typeof(color)!="undefined"){if(type=="ForeColor"){var setButton=this.getButton("SetForeColor");this.foreColor=color}else{var setButton=this.getButton("SetBackColor");this.backColor=color}setButton.style.backgroundColor=color}else{color=null;if(type=="ForeColor"&&this.foreColor){color=this.foreColor}else{if(type=="BackColor"&&this.backColor){color=this.backColor}}}if(color!=null){if(selectedObj!=null){if(selectedObj=="TABLE"||selectedObj=="TR"||selectedObj=="TH"||selectedObj=="TD"){selectedObj.bgColor=color}else{selectedObj.style.backgroundColor=color}}else{if(!this.isIE&&!this.isWebKit&&type=="BackColor"){this.setUseCSS(true);this.editorDocument.execCommand("hilitecolor",false,color);this.fixBackColorSpans()}else{this.setUseCSS(false);this.editorDocument.execCommand(type,false,color)}}isColorApplied=true}this.formChanged(evt==null?this.sessionData.lastEvent:evt);this.updateToolBar()}if(!isColorApplied){this.sessionData.rng=this.getEditorRange();this.sessionData.selectedObject=selectedObj;this.sessionData.lastEvent=evt;this.setUseCSS(true);if(this.sessionData.selectedObject!=null){var so=this.sessionData.selectedObject;if(so=="TABLE"||so=="TR"||so=="TH"||so=="TD"){resultColor=so.bgColor?so.bgColor:"#ffffff"}else{resultColor=so.style.backgroundColor}}else{if(!this.isIE&&!this.isWebKit&&type=="BackColor"){var resultColor=this.editorDocument.queryCommandValue("hilitecolor")}else{var resultColor=this.editorDocument.queryCommandValue(type)}}this.setUseCSS(false);edSelectElementColor(textareaName,type,this.colorToRGB(resultColor))}}};this.actionCreateLink=function(){this.focusWindow();if(this.currentMode=="editor"){var nearestAnchor=this.getNearestObjectByTagName("a");if(!this.isCollapsed()||nearestAnchor!=null){this.sessionData.rgn=this.getEditorRange();this.sessionData.nearestAnchor=nearestAnchor;edCreateLink(this.textareaName)}}};this.actionResizeToFitScreen=function(){var scrollTo=this.toolbarObject;var spacesHeight=150;var tabsControls=AMI.$(this.toolbarObject).parents(".tabs-container").prev(".tab-control");if(tabsControls.length){scrollTo=tabsControls[0];spacesHeight=190}if(this.searchPanel){spacesHeight+=this.searchPanel.offsetHeight}var windowHeight=window.document.body.clientHeight;var newHeight=windowHeight-spacesHeight;var newWidth=this.wrapper.offsetWidth;this.wrapper.style.height=newHeight+"px";var resizeObj=null;switch(this.currentMode){case"editor":resizeObj=this.editorObject;break;case"textarea":resizeObj=(this.hlHTML)?this.highlighter.oEditor.getWrapperElement():this.textareaObject;break;case"bb":resizeObj=(this.hlBB)?this.highlighter.oEditor.getWrapperElement():this.txtEd.editorObj;break}this.wrapper.style.height=newHeight+"px";this.setOpt("height",this.wrapper.style.height);if((this.currentMode=="textarea")&&this.hlHTML){this.highlighter.setSize(newWidth,newHeight)}else{if((this.currentMode=="bb")&&this.hlBB){this.highlighter.setSize(newWidth,newHeight)}else{resizeObj.style.width=newWidth+"px";resizeObj.style.height=newHeight+"px"}}AMI.scrollTo(scrollTo)};this.actionFullScreen=function(){var tb=document.getElementById("htmlEditorToolbar"+this.textareaName);if(tb.style.position!="absolute"){window.document.body.style.overflow="hidden";window.scrollTo(0,0);var selectBoxes=document.getElementsByTagName("select");if(bIsIE){for(i=0;i<selectBoxes.length;i++){if(selectBoxes[i].className!="htmlEditorSelect"&&selectBoxes[i].className!="htmlEditorSelectNoM"){selectBoxes[i].prevDisplay=selectBoxes[i].style.display;selectBoxes[i].style.display="none"}}}tb.style.position="absolute";this.actionUpdateEditorSize();document.getElementById(this.textareaName+"TBFullScreen").style.backgroundImage="url(skins/vanilla/images/ed_restorescreen_icon.gif)"}else{tb.style.position="static";tb.style.width="100%";this.editorObject.style.position="static";this.editorObject.style.width=this.width;this.editorObject.style.height=this.height;this.textareaObject.style.position="static";this.textareaObject.style.width=this.width;this.textareaObject.style.height=this.height;if(bIsIE){var selectBoxes=document.getElementsByTagName("select");for(i=0;i<selectBoxes.length;i++){if(selectBoxes[i].style.display=="none"){selectBoxes[i].style.display=selectBoxes[i].prevDisplay?selectBoxes[i].prevDisplay:"inline"}}}window.document.body.style.overflow="auto";document.getElementById(this.textareaName+"TBFullScreen").style.backgroundImage="url(skins/vanilla/images/ed_fullscreen_icon.gif)";document.location.hash="htmlEditorToolbar"+this.textareaName}};this.actionUpdateEditorSize=function(){this.checkEditor();var tb=document.getElementById("htmlEditorToolbar"+this.textareaName);if(tb.style.position=="absolute"){var clientWidth=amiCommon.getDocumentClientWidth();var clientHeight=amiCommon.getDocumentClientHeight();tb.style.left="0px";tb.style.top="0px";tb.style.width=clientWidth+"px";var tbHeight=tb.offsetHeight;var editor=document.getElementById(this.textareaName+"_editor");editor.style.position="absolute";editor.style.left="0px";editor.style.top=tbHeight+"px";editor.style.height=clientHeight-tbHeight+"px";editor.style.width=clientWidth+"px";this.editorObject.style.position="absolute";this.editorObject.style.left="0px";this.editorObject.style.top=tbHeight+"px";this.editorObject.style.height=clientHeight-tbHeight+"px";this.editorObject.style.width=clientWidth+"px";this.textareaObject.style.position="absolute";this.textareaObject.style.left="0px";this.textareaObject.style.top=tbHeight+"px";this.textareaObject.style.height=clientHeight-tbHeight+"px";this.textareaObject.style.width=clientWidth+"px"}};this.actionShowSearch=function(){var searchDiv=document.getElementById(this.textareaName+"_toolBarSearch");if(searchDiv.innerHTML==""){searchDiv.innerHTML=getSearchBarHTML(this.textareaName)}var showButton=this.getButton("ShowSearch");if(searchDiv.style.display=="block"){searchDiv.style.display="none";if(showButton!=null){showButton.className="simpleButtonHTMLEditor"}}else{searchDiv.style.display="block";if(showButton!=null){showButton.className="simpleButtonHTMLEditorSet"}}this.actionUpdateEditorSize();if(document.getElementById("_spec_opt_"+this.textareaName+"_search_word_whole")){document.getElementById("_spec_opt_"+this.textareaName+"_search_word_whole").disabled=(this.currentMode!="editor")}};this.actionSearchReplace=function(type,isCase,isWhole,sSearch,sReplace){var continueSearch=true;var highlighted=(this.currentMode=="textarea"&&this.hlHTML)||(this.currentMode=="bb"&&this.hlBB);if(highlighted){switch(type){case"search":this.highlighter.search(sSearch,!isCase);break;case"replace":var question=editorTranslation.ReplaceConfirm+' "'+sReplace+'"';this.highlighter.replace(sSearch,sReplace,question,!isCase);break;case"replaceall":var question=editorTranslation.ReplaceConfirm1+' "'+sSearch+'" '+editorTranslation.ReplaceConfirm2+' "'+sReplace+'" (%d)?';this.highlighter.replaceAll(sSearch,sReplace,question,!isCase);break}if(this.highlighter.marked.length==0){alert(editorTranslation.SearchNotFound)}return}if(this.currentMode=="textarea"){this.textareaObject.focus()}else{if(this.currentMode=="bb"){this.txtEd.editorObj.focus()}else{this.focusWindow()}}if(sSearch.length==0){return}if(this.isIE){var searchOptions=(isCase?4:0)|(isWhole?2:0);var sel=this.getEditorSelection();if(sel.type=="Control"){return}if(this.currentMode=="textarea"){var editorRange=document.body.createTextRange();editorRange.moveToElementText(this.textareaObject);var rng=document.selection.createRange();if(!editorRange.inRange(rng)){rng=editorRange.duplicate()}}else{if(this.currentMode=="bb"){var editorRange=document.body.createTextRange();editorRange.moveToElementText(this.txtEd.editorObj);var rng=document.selection.createRange();if(!editorRange.inRange(rng)){rng=editorRange.duplicate()}}else{var rng=this.getEditorRange();var editorRange=rng.duplicate();editorRange.expand("textedit")}}if(type=="search"){while(continueSearch){continueSearch=false;if(rng.text.toLowerCase()==sSearch.toLowerCase()){rng.collapse(false)}rng.setEndPoint("EndToEnd",editorRange);if(!rng.findText(sSearch,0,searchOptions)){if(confirm(editorTranslation.SearchNotFoundContinue)){rng.expand("textedit");continueSearch=true}rng.collapse()}rng.select()}}else{if(type=="replace"){while(continueSearch){continueSearch=false;rng.setEndPoint("EndToEnd",editorRange);if(rng.findText(sSearch,0,searchOptions)){rng.select();if(confirm(editorTranslation.ReplaceConfirm+' "'+sReplace+'"')){rng.text=sReplace}}else{if(confirm(editorTranslation.SearchNotFoundContinue)){rng.expand("textedit");continueSearch=true}rng.collapse()}rng.select()}}else{if(type=="replaceall"){if(confirm(editorTranslation.ReplaceConfirm1+' "'+sSearch+'" '+editorTranslation.ReplaceConfirm2+' "'+sReplace+'"?')){rng.setEndPoint("StartToStart",editorRange);rng.setEndPoint("EndToEnd",editorRange);var i=0;while(rng.findText(sSearch,0,searchOptions)){rng.text=sReplace;rng.setEndPoint("EndToEnd",editorRange);i++}alert(editorTranslation.ReplaceAllFinished+" - "+i+" )")}}}}}else{if(this.currentMode=="editor"){var sel=this.getEditorSelection();var rng=this.getEditorRange();if(sSearch.length>0){if(type!="replaceall"||confirm(editorTranslation.ReplaceConfirm1+' "'+sSearch+'" '+editorTranslation.ReplaceConfirm2+' "'+sReplace+'"?')){if(type=="replaceall"){this.editorDocument.execCommand("SelectAll",false,null);var rngAll=this.getEditorRange();rngAll.collapse(true);this.setEditorSelection(rngAll)}var replacedCount=0;while(continueSearch){continueSearch=false;if(!this.editorObject.contentWindow.find(sSearch,isCase,false,false,isWhole,false,false)){if(type!="replaceall"&&confirm(editorTranslation.SearchNotFoundContinue)){this.editorDocument.execCommand("SelectAll",false,null);var rngAll=this.getEditorRange();rngAll.collapse(true);this.setEditorSelection(rngAll)}else{if(type=="replaceall"){alert(editorTranslation.ReplaceAllFinished+" - "+replacedCount+" )")}}}else{if(type!="search"){if(type=="replaceall"||confirm(editorTranslation.ReplaceConfirm+' "'+sReplace+'"')){this.editorDocument.execCommand("Delete",false,null);this.insertContent(sReplace);replacedCount++}if(type=="replaceall"){continueSearch=true}}}}}}}if(this.currentMode!="editor"){var textarea=(this.currentMode=="bb")?this.txtEd.editorObj:this.textareaObject;var searchContext=(isCase)?textarea.value:textarea.value.toLowerCase();var sCaseSearch=(isCase)?sSearch:sSearch.toLowerCase();var searchRegexp=new RegExp(sCaseSearch,(isCase?"g":"gi"));var searchResults=searchContext.match(searchRegexp);if(searchResults){if(type!="replaceall"){var lastPos=(textarea.selectionEnd)?textarea.selectionEnd:0;var selStart=searchContext.indexOf(sCaseSearch,lastPos);if(selStart<0){if(confirm(editorTranslation.SearchNotFoundContinue)){selStart=searchContext.indexOf(sCaseSearch)}else{textarea.selectionStart=0;textarea.selectionEnd=0;return}}var selEnd=selStart+sSearch.length;textarea.selectionStart=selStart;textarea.selectionEnd=selEnd;if(type=="replace"){var question=editorTranslation.ReplaceConfirm+' "'+sReplace+'"';if(confirm(question)){textarea.value=textarea.value.substr(0,selStart)+sReplace+textarea.value.substr(selEnd,searchContext.length);selEnd=selStart+sReplace.length;textarea.selectionStart=selStart;textarea.selectionEnd=selEnd}}}else{var question=editorTranslation.ReplaceConfirm1+' "'+sSearch+'" '+editorTranslation.ReplaceConfirm2+' "'+sReplace+'"?';var replacedCount=searchResults.length;if(confirm(question)){textarea.value=textarea.value.replace(searchRegexp,sReplace);alert(editorTranslation.ReplaceAllFinished+" - "+replacedCount+" )");textarea.selectionStart=0;textarea.selectionEnd=0}}}else{alert(editorTranslation.SearchNotFound)}}}};this.oSpecblockMenu=null;this.oSpecblockMenuOptions=null;this.oSpecblockMenuData=null;this.oSpecblockMenuItem=null;this.showSpecblockMenu=function(oEvent,oSpecblock){if(this.oSpecblockMenu==null){var self=this;this.oSpecblockMenu=AMI.Browser.DOM.create("DIV","","specblockMenu","",document.body);AMI.Browser.Event.addHandler(this.oSpecblockMenu,"click",function(_oEvent){AMI.Browser.Event.stopProcessing(_oEvent);return false});this.oSpecblockMenuData=AMI.Browser.DOM.create("A","","","",this.oSpecblockMenu);this.oSpecblockMenuData.href="javascript:void(0)";this.oSpecblockMenuData.innerHTML=editorTranslation.specblockOpenData;AMI.Browser.Event.addHandler(this.oSpecblockMenuData,"click",function(_oEvent){self.actionSpecblockClick(self.oSpecblockMenuItem,"data");self.hideSpecblockMenu();return false});this.oSpecblockMenuOptions=AMI.Browser.DOM.create("A","","","",this.oSpecblockMenu);this.oSpecblockMenuOptions.href="javascript:void(0)";this.oSpecblockMenuOptions.innerHTML=editorTranslation.specblockOpenOptions;AMI.Browser.Event.addHandler(this.oSpecblockMenuOptions,"click",function(_oEvent){self.actionSpecblockClick(self.oSpecblockMenuItem,"options");self.hideSpecblockMenu();return false})}this.oSpecblockMenuItem=oSpecblock;var specblockName=oSpecblock.id;var dataLink="";var bHasOptions=false;if(specblockName=="spec_module_body"){if(document.forms[_cms_document_form].elements.module_name.value==document.forms[_cms_document_form].elements.module_name.oldValue){dataLink=typeof(window.moduleAdminLink)!="undefined"?window.moduleAdminLink:"";bHasOptions=typeof(window.moduleHasOptions)!="undefined"&&window.moduleHasOptions=="1"}}else{for(var i=0;i<SpecBlocks.length;i++){if(SpecBlocks[i]["name"]==specblockName){dataLink=SpecBlocks[i]["link"];if(dataLink.match(/^(plugin_|engine\.php)/i)){dataLink=""}bHasOptions=SpecBlocks[i]["hasOptions"]=="1"&&SpecBlocks[i]["group"]!="common";break}}}this.oSpecblockMenuData.style.display=dataLink!=""?"block":"none";this.oSpecblockMenuOptions.style.display=bHasOptions?"block":"none";if(bHasOptions||dataLink!=""){var aPointerPos=AMI.Browser.getPointerPosition(oEvent);var aEditorPos=AMI.Browser.getObjectPosition(this.editorObject);aPointerPos[0]+=aEditorPos[0];aPointerPos[1]+=aEditorPos[1];if(this.isIE){aPointerPos[0]-=AMI.Browser.getDocumentLeft();aPointerPos[1]-=AMI.Browser.getDocumentTop()}else{aPointerPos[0]-=AMI.Browser.getDocumentLeft(this.editorObject.contentWindow);aPointerPos[1]-=AMI.Browser.getDocumentTop(this.editorObject.contentWindow)}this.oSpecblockMenu.style.left=aPointerPos[0]+16+"px";this.oSpecblockMenu.style.top=aPointerPos[1]+16+"px";this.oSpecblockMenu.style.display="block"}};this.hideSpecblockMenu=function(){if(this.oSpecblockMenu!=null){this.oSpecblockMenu.style.display="none"}};this.insertContent=function(htmlContent){this.checkEditor();this.focusWindow();var sel=this.getEditorSelection();var rng=this.getEditorRange();if(this.isIE){rng.collapse();rng.pasteHTML(htmlContent);rng.select()}else{if(rng.insertNode){htmlContent+='<span id="htmlEditoCaretPos">_</span>';sel.collapseToEnd();rng=this.getEditorRange();var insNode=rng.createContextualFragment(htmlContent);rng.insertNode(insNode);caretObj=this.editorDocument.getElementById("htmlEditoCaretPos");rng=this.editorDocument.createRange();rng.setStartBefore(caretObj);rng.setEndAfter(caretObj);this.setEditorSelection(rng);this.editorDocument.execCommand("Delete",false,null);caretObj=this.editorDocument.getElementById("htmlEditoCaretPos");if(caretObj!=null){caretObj.parentNode.removeChild(caretObj)}}else{rng=this.editorDocument.selection.createRange();rng.pasteHTML(htmlContent);this.setEditorSelection(rng)}}this.updateToolBar()};this.insertFLASHContent=function(htmlContent){if(this.currentMode=="editor"){if(this.isFF){var reg="<object((.|\n)*?)</object>";var re=new RegExp(reg,"ig");window.flashContent=this.flashContent;htmlContent=htmlContent.replace(re,function(allstr,flashContent){flashIndex=window.flashContent.length;window.flashContent[flashIndex]=flashContent;var result='<img src="_img/spacer.gif" title="FLASH" alt="FLASH" class="ui_flash" id="editorFLASH'+flashIndex+'">';return result});this.flashContent=window.flashContent;window.flashContent=new Array()}this.insertContent(htmlContent)}};this.getSelectedNode=function(){if(this.isIE){this.focusWindow();var sel=this.getEditorSelection();var rng=this.getEditorRange();if(!sel||!rng){return null}if(sel.type=="Control"){return rng.item(0)}else{return rng.parentElement()}}else{var sel=this.getEditorSelection();var rng=this.getEditorRange();if(!rng){return null}if(rng.collapsed&&sel.anchorNode&&sel.anchorNode.length>0&&sel.anchorNode.nodeType==1){if(typeof(sel.anchorNode.childNodes[sel.anchorOffset].tagName)!="undefined"){return sel.anchorNode.childNodes[sel.anchorOffset]}}else{var ac=rng.commonAncestorContainer;if(rng.startContainer==rng.endContainer){if(rng.startOffset-rng.endOffset<2){if(rng.startContainer.hasChildNodes()){return rng.startContainer.childNodes[rng.startOffset]}}}else{var el=this.getSelectedAnchorNode();if(el.nodeType==1){return el}el=rng.startContainer;while(el){if(el.nodeType==1){return el}el=el.nextSibling}}}}return null};this.getSelectedAnchorNode=function(){var resultNode=null;if(this.isIE){resultNode=this.getSelectedNode()}else{var sel=this.getEditorSelection();if(sel!=null){var elm=sel.anchorNode;if(sel.anchorNode&&sel.anchorNode.childNodes.length>0){elm=sel.anchorNode.childNodes[sel.anchorOffset]}if(typeof(elm)=="undefined"){elm=sel.focusNode}if(typeof(elm)!="undefined"&&elm!=null){resultNode=elm}}}return resultNode};this.getNearestObject=function(){currentNode=null;if(this.isIE){currentNode=this.getSelectedNode()}else{var sel=this.editorObject.contentWindow.getSelection();if(sel!=null){var elm=sel.anchorNode;if(sel.anchorNode&&sel.anchorNode.childNodes.length>0){elm=sel.anchorNode.childNodes[sel.anchorOffset]}if(typeof(elm)=="undefined"){elm=sel.focusNode}if(typeof(elm)!="undefined"&&elm!=null){currentNode=elm}}}return currentNode};this.getNearestObjectByTagName=function(requiredTagName){var currentNode=this.getNearestObject();if(currentNode!=null){do{if(currentNode.tagName){var tagName=currentNode.tagName.toLowerCase();if(tagName==requiredTagName){return currentNode}}}while(currentNode=currentNode.parentNode)}return null};this.getEditorFirstSelectedItem=function(){var sel=this.getEditorSelection();if(this.isIE){return this.getSelectedNode()}else{if(sel.anchorNode){return sel.anchorNode}else{return null}}};this.selectElement=function(element){if(this.isIE){}else{rng=this.editorDocument.createRange();rng.setStartBefore(element);rng.setEndAfter(element);this.setEditorSelection(rng)}};this.getEditorSelection=function(){if(this.isIE){try{var sel=this.editorDocument.selection}catch(e){var sel=null}}else{var sel=this.editorObject.contentWindow.getSelection()}return sel};this.setEditorSelection=function(rng){if(this.isIE){rng.select()}else{if(rng.select){try{r.select()}catch(e){}}else{sel=this.getEditorSelection();if(sel){sel.removeAllRanges();sel.addRange(rng)}}}};this.getEditorRange=function(){if(this.isIE){return this.editorDocument?this.editorDocument.selection.createRange():null}else{var sel=this.getEditorSelection();if(sel.anchorNode){var rng=this.editorDocument.createRange();try{var rng1=this.editorDocument.createRange();rng1.setStart(sel.anchorNode,sel.anchorOffset);rng1.collapse(1);var rng2=this.editorDocument.createRange();rng2.setStart(sel.focusNode,sel.focusOffset);rng2.collapse(1);var cmp=rng1.compareBoundaryPoints(rng1.START_TO_END,rng2)<0;rng.setStart(cmp?sel.anchorNode:sel.focusNode,cmp?sel.anchorOffset:sel.focusOffset);rng.setEnd(cmp?sel.focusNode:sel.anchorNode,cmp?sel.focusOffset:sel.anchorOffset);var res=rng}catch(ex){}}return rng||res}};this.getSelection=function(){var selection="";if(window.getSelection){selection=window.getSelection()}else{if(document.selection&&document.selection.type!=="Control"){selection=document.selection.createRange()}else{throw new Error("Your browser doesn't support selection")}}return selection};this.getSelectedText=function(){var selectedText="",actElem;if(window.getSelection&&document.activeElement){if(document.activeElement.nodeName.toLowerCase()==="textarea"||(document.activeElement.nodeName.toLowerCase()==="input"&&document.activeElement.getAttribute("type").toLowerCase()==="text")){actElem=document.activeElement;selectedText=actElem.value.substring(actElem.selectionStart,actElem.selectionEnd)}else{selectedText=window.getSelection().toString()}}else{if(document.getSelection){selectedText=document.getSelection().toString()}else{if(document.selection){selectedText=document.selection.createRange().text}}}return selectedText};this.isCollapsed=function(){var rng=this.getEditorRange();if(this.isIE){var sel=this.getEditorSelection();return !rng.text&&sel.type!="Control"}else{return rng.collapsed}};this.isSelectedObject=function(){var sel=this.getEditorSelection();if(this.isIE){return sel.type=="Control"}else{return sel.anchorNode&&sel.anchorNode.nodeType==1}};this.getSelectedNodesState=0;this.getSelectedNodes=function(){var oRange=this.getEditorRange();this.getSelectedNodesState=0;return this.getSelectedNodesRC(oRange,oRange.commonAncestorContainer,false)};this.getSelectedNodesRC=function(oRange,oRoot,bHasSelectionContainer){var aResult=[];var oParent=oRoot;var counter=0;for(var oNode=oRoot;oNode&&this.getSelectedNodesState<2;oNode=oNode.nextSibling){var startOffset=0;if(this.getSelectedNodesState==0&&(oRange.startContainer.nodeType==1&&oRange.startContainer==oParent&&oRange.startOffset==counter||oRange.startContainer.nodeType!=1&&oRange.startContainer==oNode)){this.getSelectedNodesState=1;if(oRange.startContainer.nodeType!=1){startOffset=oRange.startOffset}}var endOffset=-1;var bIsLastNode=false;if(this.getSelectedNodesState<2&&(oRange.endContainer.nodeType==1&&oRange.endContainer==oParent&&oRange.endOffset==counter+1||oRange.endContainer.nodeType!=1&&oRange.endContainer==oNode)){bIsLastNode=true;if(oRange.endContainer.nodeType!=1){endOffset=oRange.endOffset}}if(this.getSelectedNodesState==1){if(oNode.nodeType!=1&&!bHasSelectionContainer&&oNode.parentNode.childNodes.length==1&&startOffset==0&&(endOffset==-1||endOffset==oNode.nodeValue.length)){var bAlreadyFound=false;for(var i=0;i<aResult.length;i++){if(oNode==aResult[i].node){bAlreadyFound=true;break}break}if(!bAlreadyFound){aResult.push({node:oNode.parentNode,start:0,end:0,styleRequired:true})}}else{if(endOffset!=0){aResult.push({node:oNode,start:startOffset,end:endOffset,styleRequired:!bHasSelectionContainer||oNode.nodeType==1&&oNode.tagName=="TD"})}}}if(bIsLastNode){this.getSelectedNodesState=2;break}if(oNode.nodeType==1&&oNode.firstChild!=null){aResult=aResult.concat(this.getSelectedNodesRC(oRange,oNode.firstChild,this.getSelectedNodesState==1))}counter++}return aResult};this.setStyleForSelected=function(styleName,styleValue){if(this.getEditorSelection()&&!this.isIE){var aObjects=this.getSelectedNodes();for(var i=0;i<aObjects.length;i++){if(aObjects[i].node.nodeType==1){if(aObjects[i].node.tagName!="BR"&&aObjects[i].node.tagName!="IMG"&&aObjects[i].node.tagName!="TABLE"&&aObjects[i].node.tagName!="TR"&&aObjects[i].node.tagName!="TBODY"){if(aObjects[i].styleRequired||aObjects[i].node.style[styleName]!=""){aObjects[i].node.style[styleName]=styleValue}}}else{if(aObjects[i].node.nodeType==3&&aObjects[i].styleRequired&&styleValue!=""){var oRange=this.editorDocument.createRange();oRange.setStart(aObjects[i].node,aObjects[i].start);oRange.setEnd(aObjects[i].node,aObjects[i].end<=0?aObjects[i].node.nodeValue.length:aObjects[i].end);var oSpan=this.editorDocument.createElement("SPAN");oSpan.style[styleName]=styleValue;oRange.surroundContents(oSpan)}}}}else{this.editorDocument.execCommand("ForeColor",false,"#001122");var oFonts=this.editorDocument.getElementsByTagName("FONT");for(var i=oFonts.length-1;i>=0;i--){if(oFonts[i].getAttribute("color")=="#001122"){var oSpan=this.editorDocument.createElement("SPAN");oSpan.innerHTML=oFonts[i].innerHTML;oSpan.style[styleName]=styleValue;oFonts[i].parentNode.replaceChild(oSpan,oFonts[i])}}}};this.setUseCSS=function(state){try{this.editorDocument.execCommand("styleWithCSS",false,state);this.editorDocument.execCommand("useCSS",false,!state)}catch(e){}};this.colorToRGB=function(color){color=color.toString();var hex_string="";if(color.indexOf("#")==0){hex_string=color.substr(1)}else{if(aParts=color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\s*\)/i)){for(var i=1;i<=3;i++){var val=parseInt(aParts[i]).toString(16);if(val.length==1){val="0"+val}hex_string+=val}}else{if(aParts=color.match(/^\d+$/i)){for(var hexpair=0;hexpair<3;hexpair++){var colbyte=color&255;color>>=8;var nybble2=colbyte&15;var nybble1=(colbyte>>4)&15;hex_string+=nybble1.toString(16);hex_string+=nybble2.toString(16)}}}}if(hex_string==""){hex_string="000000"}return hex_string.toLowerCase()};this.safariTagsData=[["b","fontWeight","bold"],["i","fontStyle","italic"],["u","textDecoration","underline"],["strike","textDecoration","line-through"],["sub","verticalAlign","sub"],["sup","verticalAlign","super"]];this.safariGetTag=function(element){var tagName="";if(element.className=="Apple-style-span"){for(i=0;i<this.safariTagsData.length;i++){if(element.style[this.safariTagsData[i][1]]==this.safariTagsData[i][2]){tagName=this.safariTagsData[i][0];break}}if(tagName==""){tagName="font"}}else{tagName=element.tagName}return tagName.toUpperCase()};this.fixBackColorSpans=function(){var spans=this.editorDocument.getElementsByTagName("span");for(i=0;i<spans.length;i++){if(spans[i].className!="Amiro-span-to-font"&&spans[i].style.backgroundColor!=""){spans[i].className="Amiro-span-to-font"}}};this.fixBackgroundTag=function(element){var tagName="";if(element.className=="Amiro-span-to-font"){tagName="FONT"}else{tagName=element.tagName}return tagName.toUpperCase()};this.fixHTMLCode=function(){if(!this.isIE){var spans=this.editorDocument.body.getElementsByTagName("span");for(var i=0;i<spans.length;i++){var tagName="font";var cssText="";var doReplace=false;if(spans[i].className=="Amiro-span-to-font"){doReplace=true;cssText=spans[i].style.cssText}else{if(spans[i].className=="Apple-style-span"){doReplace=true;for(var ii=0;ii<this.safariTagsData.length;ii++){if(spans[i].style[this.safariTagsData[ii][1]]==this.safariTagsData[ii][2]){tagName=this.safariTagsData[ii][0];break}}if(tagName=="font"){cssText=spans[i].style.cssText}}}if(doReplace){var newTag=document.createElement(tagName);if(cssText!=""){newTag.style.cssText=cssText}newTag.innerHTML=spans[i].innerHTML;var pNode=spans[i].parentNode;spans[i].parentNode.replaceChild(newTag,spans[i]);i--}}}};this.fixI18nDomainName=function(link){link=link.replace(/(https?:\/\/)([^\/]*)/i,function(allstr,prefix,domain){if(domain.indexOf("%")>=0){domain=decodeURIComponent(domain)}return prefix+domain});return link};this.startResize=function(currentEvent){currentEvent=amiCommon.getValidEvent(currentEvent);this.isResizing=true;var resizeObj=null;switch(this.currentMode){case"editor":resizeObj=this.editorObject;break;case"textarea":resizeObj=(this.hlHTML)?this.highlighter.oEditor.getWrapperElement():this.textareaObject;break;case"bb":resizeObj=(this.hlBB)?this.highlighter.oEditor.getWrapperElement():this.txtEd.editorObj;break}var positionMouse=amiCommon.getMousePosition(currentEvent);var positionFrame=amiCommon.getElementPosition(resizeObj);this.divResizePositionDeltaX=positionMouse[0]-positionFrame[0]-resizeObj.offsetWidth;this.divResizePositionDeltaY=positionMouse[1]-positionFrame[1]-resizeObj.offsetHeight;AMI.Browser.Event.addHandler(window.document,"mouseup",function(_this){return function(e){_this.stopResize(e)}}(this));AMI.Browser.Event.addHandler(window.document,"mousemove",function(_this){return function(e){_this.resize(e)}}(this));if(this.currentMode=="editor"){AMI.Browser.Event.addHandler(this.editorObject.contentWindow,"mouseup",function(_this){return function(e){_this.stopResize(e)}}(this));AMI.Browser.Event.addHandler(this.editorObject.contentWindow,"mousemove",function(_this){return function(e){_this.iframeResize(e)}}(this))}amiCommon.stopEvent(currentEvent)};this.resize=function(currentEvent){if(this.isResizing){currentEvent=amiCommon.getValidEvent(currentEvent);var resizeObj=null;switch(this.currentMode){case"editor":resizeObj=this.editorObject;break;case"textarea":resizeObj=(this.hlHTML)?this.highlighter.oEditor.getWrapperElement():this.textareaObject;break;case"bb":resizeObj=(this.hlBB)?this.highlighter.oEditor.getWrapperElement():this.txtEd.editorObj;break}var positionFrame=amiCommon.getElementPosition(resizeObj);var positionMouse=amiCommon.getMousePosition(currentEvent);var newWidth=Math.max(0,positionMouse[0]-positionFrame[0]-this.divResizePositionDeltaX);if(newWidth<200){newWidth=200}var newHeight=Math.max(0,positionMouse[1]-positionFrame[1]-this.divResizePositionDeltaY);if(newHeight<100){newHeight=100}this.wrapper.style.width=newWidth+"px";this.wrapper.style.height=newHeight+"px";if((this.currentMode=="textarea")&&this.hlHTML){this.highlighter.setSize(newWidth,newHeight)}else{if((this.currentMode=="bb")&&this.hlBB){this.highlighter.setSize(newWidth,newHeight)}else{resizeObj.style.width=newWidth+"px";resizeObj.style.height=newHeight+"px"}}amiCommon.stopEvent(currentEvent)}};this.iframeResize=function(currentEvent){if(this.isResizing){currentEvent=amiCommon.getValidEvent(currentEvent);var positionFrame=amiCommon.getElementPosition(this.editorObject);var positionMouse=amiCommon.getMousePosition(currentEvent);var newWidth=Math.max(0,positionMouse[0]-AMI.Browser.getDocumentLeft(this.editorObject.contentWindow)-this.divResizePositionDeltaX);if(newWidth>200){this.wrapper.style.width=newWidth+"px";this.editorObject.style.width=newWidth+"px"}var newHeight=Math.max(0,positionMouse[1]-AMI.Browser.getDocumentTop(this.editorObject.contentWindow)-this.divResizePositionDeltaY);if(newHeight>100){this.wrapper.style.height=newHeight+"px";this.editorObject.style.height=newHeight+"px"}amiCommon.stopEvent(currentEvent)}};this.stopResize=function(currentEvent){if(this.isResizing){this.isResizing=false;if(this.wrapper.style.width.length>0){}if(this.wrapper.style.height.length>0){this.setOpt("height",this.wrapper.style.height)}currentEvent=amiCommon.getValidEvent(currentEvent);amiCommon.stopEvent(currentEvent)}};this.getElementId=function(){if(typeof(AMI.Page)!="undefined"){for(var moduleId in AMI.Page.aModules){break}if(moduleId){var hashData=AMI.Page.getHashData(moduleId);if(hashData.id){this.currentElementId=hashData.id}}}else{if((typeof(window.currentElementId)=="undefined")||!window.currentElementId){this.currentElementId=AMI.$(this.textareaObject).parents("FORM:eq(0)").find("INPUT[name=id]").val()}else{this.currentElementId=window.currentElementId}}return this.currentElementId};this.setOpt=function(name,value){var path="/50/"+window.module_name+"/";if(typeof(AMI.Page)!="undefined"){for(var moduleId in AMI.Page.aModules){break}if(moduleId){if(typeof(module60compatible)!="undefined"){path="/PA/"+moduleId+"/"}else{path="/60/"+moduleId+"/"}}}AMI.Cookie.set("CE_"+this.textareaName+"_"+name,value,this.cookieLifeTime,path)};this.getOpt=function(name,defaultValue){var res=false;res=AMI.Cookie.get("CE_"+this.textareaName+"_"+name);if(!res&&typeof(defaultValue)!="undefined"){res=defaultValue}return res};this.setValue=function(value){this.skipChanges=true;this.originalHTML=value;this.prevValues.editor="";this.prevValues.bb="";this.prevValues.textarea="";var mode=this.currentMode;this.textareaObject.value=value;this.prepareGadgetsCode();this.prevValues.textarea=this.textareaObject.value;var savedValue=this.textareaObject.value;this.currentMode="textarea";this.actionBBMode(false);this.hlBBEditor(false);this.prevValues.textarea=savedValue;this.prevValues.bb=this.txtEd.editorObj.value;this.currentMode="textarea";this.textareaObject.value=this.prevValues.textarea;this.actionEditorMode(false);this.prevValues.editor=this.editorDocument.body.innerHTML;if(mode=="bb"){this.setMode("bb")}if(mode=="textarea"){this.setMode("textarea");this.skipChanges=true;if(this.highlighter.oEditor){this.highlighter.oEditor.setValue(this.prevValues.textarea)}}this.currentMode=mode;this.skipChanges=false};this.highlight=function(){this.checkEditor();if(typeof(this.bNoFocus)=="undefined"){this.bNoFocus=true}if(this.highlighter&&this.highlighter.oEditor){this.highlighter.save();this.highlighter.highlight(false,true);this.highlighter=null}if(this.currentMode=="editor"){this.textareaObject.style.display="none"}if(this.currentMode=="bb"){this.textareaObject.style.display="none";var extraKeys={"Ctrl-B":function(_this){return function(){_this.txtEd.procAction("bold")}}(this),"Ctrl-U":function(_this){return function(){_this.txtEd.procAction("underlined")}}(this),"Ctrl-I":function(_this){return function(){_this.txtEd.procAction("italic")}}(this),"Ctrl-S":function(_this){return function(){_this.txtEd.procAction("strike")}}(this),"Ctrl-F":function(_this){return function(){if(!_this.searchPanel||_this.searchPanel.style.display!="block"){_this.actionShowSearch()}if(_this.searchPanel.style.display=="block"){if(document.getElementById("_spec_opt_"+_this.textareaName+"_search_text_value")){document.getElementById("_spec_opt_"+_this.textareaName+"_search_text_value").focus()}}}}(this)};if(this.useSpecialCharsFeature){extraKeys.Enter=function(_this){return function(){if(_this.useSpecialCharsFeature){_this.txtEd.procAction("br")}}}(this)}var options={mode:"amitplbb",tabMode:"shift",indentUnit:4,lineWrapping:this.wrBB,onChange:function(_this){return function(){_this.formChanged(window.event)}}(this),extraKeys:extraKeys};this.highlighter=new AMI.TextEditor("id"+this.textareaObject.id+"_bb",false,options,true,true);this.hlBBEditor(true,this.bNoFocus)}if(this.currentMode=="textarea"){var options={mode:"amitpl",tabMode:"shift",indentUnit:4,lineWrapping:this.wrHTML,onChange:function(_this){return function(){_this.formChanged(window.event)}}(this),extraKeys:{"Ctrl-F":function(_this){return function(){_this.actionShowSearch();if(_this.searchPanel.style.display=="block"){document.getElementById("_spec_opt_"+_this.textareaName+"_search_value").focus()}}}(this)}};this.highlighter=new AMI.TextEditor(this.textareaObject.id,false,options,true,true);this.hlTextarea(true,this.bNoFocus)}};this.addHighlighterCheckboxes=function(){this.hlTxtSwitcher=document.createElement("DIV");this.hlTxtSwitcher.className="htmlEditorHighlighter";this.hlTxtSwitcher.style.display="none";var hlTxtLabel=document.createElement("LABEL");var hlTxtLabelText=document.createElement("SPAN");hlTxtLabelText.innerHTML=editorTranslation.syntaxHighlight;this.hlTxtSwitcher.appendChild(hlTxtLabel);this.hlTxtCb=document.createElement("INPUT");this.hlTxtCb.setAttribute("type","checkbox");this.hlTxtCb.checked=this.hlHTML;AMI.Browser.Event.addHandler(this.hlTxtCb,"change",function(_this,cb){return function(e){_this.placeSelectionMarks();if(cb.checked){_this.hlHTML=true;_this.hlTextarea();_this.setOpt("hlHTML","on");_this.hlTxtCbWrap.disabled=false}else{_this.hlTextarea(false,true);_this.hlHTML=false;_this.setOpt("hlHTML","off");_this.hlTxtCbWrap.disabled=true}_this.markSelection(_this.textareaObject)}}(this,this.hlTxtCb));hlTxtLabel.appendChild(this.hlTxtCb);hlTxtLabel.appendChild(hlTxtLabelText);var hlTxtLabel=document.createElement("LABEL");hlTxtLabel.style.paddingLeft="10px";var hlTxtLabelText=document.createElement("SPAN");hlTxtLabelText.innerHTML=editorTranslation.wrapLines;this.hlTxtSwitcher.appendChild(hlTxtLabel);this.hlTxtCbWrap=document.createElement("INPUT");this.hlTxtCbWrap.setAttribute("type","checkbox");this.hlTxtCbWrap.checked=this.wrHTML;this.hlTxtCbWrap.disabled=!this.hlHTML;AMI.Browser.Event.addHandler(this.hlTxtCbWrap,"change",function(_this,cb){return function(e){if(cb.checked){if(_this.hlHTML){_this.hlTextarea(false,true);_this.highlighter.options.lineWrapping=true;_this.hlTextarea();_this.setOpt("wrHTML","on");_this.wrHTML=true}}else{if(_this.hlHTML){_this.hlTextarea(false,true);_this.highlighter.options.lineWrapping=false;_this.hlTextarea();_this.setOpt("wrHTML","off");_this.wrHTML=false}}}}(this,this.hlTxtCbWrap));hlTxtLabel.appendChild(this.hlTxtCbWrap);hlTxtLabel.appendChild(hlTxtLabelText);this.toolbarPathObject.parentNode.appendChild(this.hlTxtSwitcher);this.hlBBSwitcher=document.createElement("DIV");this.hlBBSwitcher.className="htmlEditorHighlighter";this.hlBBSwitcher.style.display="none";var hlBBLabel=document.createElement("LABEL");var hlBBLabelText=document.createElement("SPAN");hlBBLabelText.innerHTML=editorTranslation.syntaxHighlight;this.hlBBSwitcher.appendChild(hlBBLabel);this.hlBBCb=document.createElement("INPUT");this.hlBBCb.setAttribute("type","checkbox");this.hlBBCb.checked=this.hlBB;AMI.Browser.Event.addHandler(this.hlBBCb,"click",function(_this,cb){return function(e){_this.placeSelectionMarks();if(cb.checked){_this.hlBB=true;_this.hlBBEditor();_this.setOpt("hlBB","on");_this.hlBBCbWrap.disabled=false}else{_this.hlBBEditor(false,true);_this.hlBB=false;_this.setOpt("hlBB","off");_this.hlBBCbWrap.disabled=true}_this.markSelection(_this.txtEd.editorObj)}}(this,this.hlBBCb));hlBBLabel.appendChild(this.hlBBCb);hlBBLabel.appendChild(hlBBLabelText);var hlTxtLabel=document.createElement("LABEL");hlTxtLabel.style.paddingLeft="10px";var hlTxtLabelText=document.createElement("SPAN");hlTxtLabelText.innerHTML=editorTranslation.wrapLines;this.hlBBSwitcher.appendChild(hlTxtLabel);this.hlBBCbWrap=document.createElement("INPUT");this.hlBBCbWrap.setAttribute("type","checkbox");this.hlBBCbWrap.checked=this.wrBB;this.hlBBCbWrap.disabled=!this.hlBB;AMI.Browser.Event.addHandler(this.hlBBCbWrap,"change",function(_this,cb){return function(e){if(cb.checked){if(_this.hlBB){_this.hlBBEditor(false,true);_this.highlighter.options.lineWrapping=true;_this.hlBBEditor();_this.setOpt("wrBB","on");_this.wrBB=true}}else{if(_this.hlBB){_this.hlBBEditor(false,true);_this.highlighter.options.lineWrapping=false;_this.hlBBEditor();_this.setOpt("wrBB","off");_this.wrBB=false}}}}(this,this.hlBBCbWrap));hlTxtLabel.appendChild(this.hlBBCbWrap);hlTxtLabel.appendChild(hlTxtLabelText);this.toolbarPathObject.parentNode.appendChild(this.hlBBSwitcher)};this.getCommentNodes=function(oBody){this.checkEditor();function traverseDom(curr_element){var comments=new Array();if(curr_element.nodeName=="#comment"||curr_element.nodeType==8){comments[comments.length]=curr_element}else{if(curr_element.childNodes.length>0){for(var i=0;i<curr_element.childNodes.length;i++){comments=comments.concat(traverseDom(curr_element.childNodes[i]))}}}return comments}return traverseDom(oBody)};this.checkEditor=function(){};this.htmlEntities=function(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/#/g,"&#035;")};this.unHtmlEntities=function(s){return String(s).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#035;/g,"#")};this.copySelMarks=function(src,dst){var startIndex,endIndex;src=String(src);dst=String(dst);startIndex=src.indexOf(this.selStartMark);endIndex=src.indexOf(this.selEndMark);if(startIndex>-1&&endIndex>-1){dst=dst.replace(this.selStartMark,"").replace(this.selEndMark,"");endIndex-=this.selStartMark.length;dst=dst.slice(0,endIndex)+this.selEndMark+dst.slice(endIndex);dst=dst.slice(0,startIndex)+this.selStartMark+dst.slice(startIndex)}return dst};this.bindGadgetCopyPaste=function(elem){elem.oncopy=function(e){var selection=this.getSelection(),selectedText=this.getSelectedText(),formattedText,tmpElem;if(this.currentMode=="editor"){if(elem.nodeType==9){if(!window.getSelection){return}var selection=this.editorDocument.getSelection();var selectedText="";if(selection.rangeCount>0){var range=selection.getRangeAt(0);var clonedSelection=range.cloneContents();var div=document.createElement("div");div.appendChild(clonedSelection);selectedText=div.innerHTML;var reg='<img[^>]*? id="?editorGadget([0-9]+)"?[^>]*?>';var re=new RegExp(reg,"ig");if(re.test(selectedText)){selectedText=selectedText.replace(re,function(allstr,gadgetID){var result="##gadget"+gadgetID+"##";return result})}else{return}}}else{return}}formattedText=this.packGadgets(selectedText);if(selectedText!==formattedText){if(e.clipboardData&&e.clipboardData.setData&&null!==e.clipboardData.types){e.stopPropagation();e.preventDefault();e.clipboardData.setData("Text",formattedText);return false}tmpElem=document.createElement("div");tmpElem.style.position="absolute";tmpElem.style.left="-99999px";if("undefined"!==typeof tmpElem.innerText){tmpElem.innerText=formattedText}else{if("undefined"!==typeof tmpElem.textContent){tmpElem.textContent=formattedText}else{tmpElem.innerHTML=formattedText}}document.body.appendChild(tmpElem);selection.selectAllChildren(tmpElem);window.setTimeout(function(){tmpElem.parentElement.removeChild(tmpElem)},0);return true}}.bind(this);elem.onpaste=function(e){setTimeout(function(){if(this.currentMode=="editor"){e.target.innerHTML=this.htmlDecode(this.unpackGadgets(e.target.innerHTML));this.actionTextareaMode(false);this.actionEditorMode(false)}else{e.target.value=this.unpackGadgets(e.target.value)}}.bind(this),0)}.bind(this)};this.htmlDecode=function(html){var a=document.createElement("a");a.innerHTML=html;return a.textContent};this.init()};function amiCustomFields(oDictionary){this.htmlEncoding="autodetect";this.oDictionary=oDictionary;this.loadedModules={};this.lastModule="";this.attempts=0;this.skipFieldsTableClearing=false;this.oSourceObject=null;this.fieldName="stub";this.objectId="stub";this.loadFields=function(moduleName,skipFieldsTableClearing){this.skipFieldsTableClearing=skipFieldsTableClearing;if(this.loadedModules[moduleName]){this.setModuleData(this.loadedModules[moduleName]);this.oSourceObject.oForm.module_name.disabled=false;this.oSourceObject.oForm.module_name.options[0].disabled=true;this.oSourceObject.oForm.module_name.selectedIndex=newModuleNameIndex}else{this.lastModule=moduleName;amiAjax.getContent("GET",ajaxProcessURL+"?html_encoding="+encodeURIComponent(this.getHTMLEncoding())+"&type=customfields&data_language="+dataLanguage+"&module_name="+moduleName,"",function(currentObject){return function(state,content){currentObject.loadFieldsCallback(state,content)}}(this))}};this.loadFieldsCallback=function(state,content){if(state==1){var res=eval(content);if(res){this.loadedModules[this.lastModule]=res;this.oSourceObject.oForm.module_name.disabled=false;this.oSourceObject.oForm.module_name.options[0].disabled=true;this.oSourceObject.oForm.module_name.selectedIndex=newModuleNameIndex}this.lastModule="";this.setModuleData(res)}else{this.attempts++;if(this.attempts<4){this.loadFields(this.lastModule,this.skipFieldsTableClearing)}else{this.attempts=0;alert(oDictionary.get("cannot_load_custom_fields"))}}};this.setModuleData=function(data){this.oSourceObject.freeFields=[];if(!this.skipFieldsTableClearing){this.oSourceObject.deleteAllFields()}if(data){var fieldsMap=";";if(this.skipFieldsTableClearing){for(var i=1,q=this.oSourceObject.realFieldsObj.rows.length;i<q;i++){fieldsMap+=this.oSourceObject.realFieldsObj.rows[i].getAttribute("clearid")+";"}}for(var i in data){if(typeof(data[i])=="function"||this.skipFieldsTableClearing&&fieldsMap.indexOf(";"+data[i][0]+";")>-1){continue}data[i][3]=0;this.oSourceObject.freeFields.push(data[i]);if(data[i][4]){this.oSourceObject.insertFieldRow(data[i][0])}}}for(var i in this.oSourceObject.hcFields){if(typeof(this.oSourceObject.hcFields[i])=="function"){continue}this.oSourceObject.freeFields.push(this.oSourceObject.hcFields[i])}this.skipFieldsTableClearing=false;this.oSourceObject.fillFreeFields();this.oSourceObject.watchRealFieldsDiv()};this.getHTMLEncoding=function(){if(this.htmlEncoding=="autodetect"){this.htmlEncoding="";var metas=document.getElementsByTagName("meta");for(i=0;i<metas.length;i++){if(metas[i].httpEquiv&&metas[i].content&&metas[i].httpEquiv.toLowerCase()=="content-type"){var matches=metas[i].content.match(/charset=\s*([^ ]*)/i);if(matches!=null&&matches.length>=2){this.htmlEncoding=matches[1]}}}}return this.htmlEncoding};this.loadDatasetId=function(moduleName,fieldName,tableName,objectId){this.fieldName=fieldName;this.objectId=objectId;amiAjax.getContent("GET",ajaxProcessURL+"?html_encoding="+encodeURIComponent(this.getHTMLEncoding())+"&type=customfields&data_language="+dataLanguage+"&module_name="+moduleName+"&table="+tableName+"&object_id="+objectId,"",function(currentObject){return function(state,content){currentObject.loadDatasetIdCallback(state,content)}}(this))};this.loadDatasetIdCallback=function(state,content){this.oSourceObject.oForm.elements[this.fieldName].disabled=false;if(state==1){var datasetId=eval(content);this.oSourceObject.datasets[this.objectId]=datasetId;for(var i=0,q=this.oSourceObject.oForm.elements[this.fieldName].options.length;i<q;i++){if(this.oSourceObject.oForm.elements[this.fieldName].options[i].value==this.objectId){this.oSourceObject.oForm.elements[this.fieldName].selectedIndex=i;break}}if(typeof(this.oSourceObject.is60)=="undefined"){this.oSourceObject.cbOnFormChange(this.fieldName,false,null,true)}else{this.oSourceObject.cbOnFormChange({target:this.oSourceObject.oForm.elements[this.fieldName],name:this.fieldName,isFirstTime:false,evt:null,skipAjax:true})}return}this.oSourceObject.datasets[this.objectId]="stub";this.oSourceObject.cbOnFormChange(this.fieldName,false,null,true);if(typeof(this.oSourceObject.is60)=="undefined"){this.oSourceObject.cbOnFormChange(this.fieldName,false,null,true)}else{this.oSourceObject.cbOnFormChange({target:this.oSourceObject.oForm.elements[this.fieldName],name:this.fieldName,isFirstTime:false,evt:null,skipAjax:true})}}}function amiDictionary(a){this.dictionary=typeof(a)=="object"?a:{};this.set=function(c,b){this.dictionary[c]=b};this.append=function(c){for(var b in c){if(typeof(this.dictionary[b])=="undefined"){this.dictionary[b]=c[b]}}};this.megre=function(c){for(var b in c){this.dictionary[b]=c[b]}};this.get=function(b){if(typeof(this.dictionary[b])=="undefined"){if(typeof(console)=="object"&&typeof(console.warn)=="function"){console.warn("Undefined dictionary key '"+b+"'")}return null}else{return this.dictionary[b]}};this.parse=function(d,f){var b=this.get(d);if(b){for(var c in f){b=b.replace("_"+c+"_",f[c])}}return b}}AMI.TextEditor=function(k,d,c,g,b){this.fromCE=(typeof(b)=="undefined")?false:b;this.bFixResize=(typeof(d)=="undefined")?true:d;this.highlighted=false;this.textareaId=k;this.cookieLifeTime=36000;if(typeof(c)=="undefined"){this.options={mode:"amitpl",tabMode:"shift",indentUnit:4,lineWrapping:false}}else{this.options=c}this.useParentSize=(typeof(g)=="undefined")?false:g;this.setOpt=function(l,n){var o="/50/"+window.module_name+"/";if(typeof(AMI.Page)!="undefined"){for(var m in AMI.Page.aModules){break}if(m){if(typeof(module60compatible)!="undefined"){o="/PA/"+m+"/"}else{o="/60/"+m+"/"}}}AMI.Cookie.set("CM_"+this.textareaId+"_"+l,n,this.cookieLifeTime,o)};this.getOpt=function(m,l){var n=false;n=AMI.Cookie.get("CM_"+this.textareaId+"_"+m);if(!n&&typeof(l)!="undefined"){n=l}return n};this.oTextarea=AMI.find("#"+k);if(!this.fromCE){this.oTextarea.style.resize="none";this.wrapper=document.createElement("DIV");this.wrapper.id=k+"_wrapper";this.wrapper.style.position="relative";this.wrapper.style.marginBottom="14px";AMI.$(this.oTextarea).wrap(AMI.$(this.wrapper));this.wrapper=AMI.find("#"+k+"_wrapper");this.resizer=document.createElement("DIV");this.resizer.id=k+"_editor";this.resizer.className="ce_resize_corner";AMI.Browser.Event.addHandler(this.resizer,"mousedown",function(l){return function(m){l.startResize(m)}}(this));this.wrapper.appendChild(this.resizer);this.bottomSpace=document.createElement("DIV");this.bottomSpace.className="ce_bottom_space";this.wrapper.appendChild(this.bottomSpace);var h="border-box";this.oTextarea.style.boxSizing=h;this.oTextarea.style.MozBoxSizing=h;this.oTextarea.style.webkitBoxSizing=h;this.wrapper.style.boxSizing=h;this.wrapper.style.MozBoxSizing=h;this.wrapper.style.webkitBoxSizing=h;var f=(typeof(this.oTextarea.style.width)=="undefined")||(this.oTextarea.style.width=="100%")?"100%":AMI.$(this.oTextarea).outerWidth();var a=AMI.$(this.oTextarea).height();a=this.getOpt("height",a);if(parseInt(a)==0){a="400px"}AMI.$(this.wrapper).width(f);AMI.$(this.wrapper).height(a);AMI.$(this.oTextarea).height(a)}this.oEditor=null;this.lastPos=null;this.lastQuery=null;this.marked=[];this.lastWidth=0;if(this.bFixResize){AMI.Browser.Event.addHandler(window,"resize",function(l){return function(){if(l.oEditor){if(document.body.clientWidth!=this.lastWidth){l.highlight(false);l.highlight(true);this.lastWidth=document.body.clientWidth}}}}(this))}this.startResize=function(m){m=amiCommon.getValidEvent(m);this.isResizing=true;var o=(this.highlighted)?this.oEditor.getWrapperElement():this.oTextarea;var l=amiCommon.getMousePosition(m);var n=amiCommon.getElementPosition(o);this.divResizePositionDeltaX=l[0]-n[0]-o.offsetWidth;this.divResizePositionDeltaY=l[1]-n[1]-o.offsetHeight;AMI.Browser.Event.addHandler(window.document,"mouseup",function(p){return function(q){p.stopResize(q)}}(this));AMI.Browser.Event.addHandler(window.document,"mousemove",function(p){return function(q){p.resize(q)}}(this));amiCommon.stopEvent(m)};this.resize=function(n){if(this.isResizing){n=amiCommon.getValidEvent(n);var q=(this.highlighted)?this.oEditor.getWrapperElement():this.oTextarea;var p=amiCommon.getElementPosition(q);var m=amiCommon.getMousePosition(n);var o=Math.max(0,m[0]-p[0]-this.divResizePositionDeltaX);if(o<200){o=200}var l=Math.max(0,m[1]-p[1]-this.divResizePositionDeltaY);if(l<100){l=100}this.wrapper.style.width=o+"px";this.wrapper.style.height=l+"px";if(this.highlighted){this.setSize(o,l)}else{q.style.width=o+"px";q.style.height=l+"px"}amiCommon.stopEvent(n)}};this.stopResize=function(l){if(this.isResizing){this.isResizing=false;if(this.wrapper.style.width.length>0){}if(this.wrapper.style.height.length>0){this.setOpt("height",this.wrapper.style.height)}l=amiCommon.getValidEvent(l);amiCommon.stopEvent(l)}};this.unmark=function(){for(var l=0;l<this.marked.length;++l){try{this.marked[l].clear()}catch(m){}}this.marked.length=0};this.mark=function(n,l){if(typeof(l)=="undefined"){l=false}this.unmark();for(var m=this.oEditor.getSearchCursor(n,false,l);m.findNext();){this.marked.push(this.oEditor.markText(m.from(),m.to(),"searched"))}};this.search=function(n,l){if(typeof(l)=="undefined"){l=false}if(!n){return}this.mark(n,l);if(this.lastQuery!=n){this.lastPos=null}var m=this.oEditor.getSearchCursor(n,this.lastPos||this.oEditor.getCursor(),l);if(!m.findNext()){m=this.oEditor.getSearchCursor(n,false,l);if(!m.findNext()){return}}this.oEditor.setSelection(m.from(),m.to());this.lastQuery=n;this.lastPos=m.to()};this.replace=function(p,m,l,n){if(typeof(n)=="undefined"){n=false}if(!p){return}this.mark(p,n);for(var o=this.oEditor.getSearchCursor(p,false,n);o.findNext();){this.oEditor.setSelection(o.from(),o.to());if(confirm(l)){o.replace(m);this.mark(p)}else{return}}};this.replaceAll=function(o,m,l,n){if(typeof(n)=="undefined"){n=false}if(!o){return}this.mark(o,n);if(!this.marked.length){return}if(!confirm(l.replace("%d",this.marked.length))){return}o=o.replace(new RegExp("\\\\","g"),"\\\\");o=o.replace(new RegExp("\\^","g"),"\\^");o=o.replace(new RegExp("\\*","g"),"\\*");o=o.replace(new RegExp("\\$","g"),"\\$");o=o.replace(new RegExp("\\+","g"),"\\+");o=o.replace(new RegExp("\\.","g"),"\\.");o=o.replace(new RegExp("\\(","g"),"\\(");o=o.replace(new RegExp("\\)","g"),"\\)");o=o.replace(new RegExp("\\[","g"),"\\[");o=o.replace(new RegExp("\\]","g"),"\\]");o=o.replace(new RegExp("\\/","g"),"\\/");o=o.replace(new RegExp("\\?","g"),"\\?");o=o.replace(new RegExp("\\|","g"),"\\|");o=o.replace(new RegExp("\\{","g"),"\\{");o=o.replace(new RegExp("\\}","g"),"\\}");this.oTextarea.value=this.oEditor.getValue();this.oTextarea.value=this.oTextarea.value.replace(new RegExp(o,((n)?"gi":"g")),m);this.oEditor.setValue(this.oTextarea.value);this.oEditor.refresh();this.unmark()};this.highlight=function(z,s){s=s?true:false;if(z&&this.oEditor==null){if(!s&&(this.oTextarea.offsetHeight)>0&&(this.oTextarea.value)){var n=AMI.Browser.getCaretPosition(this.oTextarea)}else{n=""}var t=this.oTextarea.offsetWidth;var m,u=-1;var w=0,q=-1;while((m=this.oTextarea.value.indexOf("\n",u+1))!=-1){w++;if(m>=n){q=n-(u+1);break}u=m}this.oEditor=CodeMirror.fromTextArea(this.oTextarea,this.options);this.setSize(t,0);if(q>=0){this.oEditor.setCursor(w-1,q);if(!s&&(this.oTextarea.value)){this.oEditor.focus()}}if(!this.fromCE){var l=this.oEditor.getWrapperElement();var p="border-box";l.style.boxSizing=p;l.style.MozBoxSizing=p;l.style.webkitBoxSizing=p}this.highlighted=true}else{if(!z&&this.oEditor!=null){var o=this.oEditor.getWrapperElement().scrollTop;var v=this.oEditor.getCursor(true);this.oEditor.toTextArea();this.oEditor=null;if(!s){this.oTextarea.focus();var m,u=-1;var w=0;while((m=this.oTextarea.value.indexOf("\n",u+1))!=-1){if(w++==v.line){setCaretPos(this.oTextarea.getAttribute("id"),(u+v.ch+1)+"|"+o);break}u=m}}if(!this.fromCE){AMI.$(this.oTextarea).width(AMI.$(this.wrapper).outerWidth());AMI.$(this.oTextarea).height(AMI.$(this.wrapper).outerHeight())}this.highlighted=false}}};this.getEditorScroll=function(){if(this.oEditor){var l=this.oEditor.getWrapperElement();return AMI.$(l).find(".CodeMirror-scroll")[0]}return AMI.$(this.oTextarea).find(".CodeMirror-scroll")[0]};this.setSize=function(o,m){if(o=="100%"){o=0}o=parseInt(o);m=parseInt(m);var n=this.oEditor.getWrapperElement();var l=this.getEditorScroll();if(l&&n){if(o>0){n.style.width=o+"px";l.style.width=o+"px"}else{if(this.oTextarea.style.width!=""&&this.oTextarea.style.width!="100%"){l.style.width=this.oTextarea.style.width;n.style.width=this.oTextarea.style.width}else{if(this.useParentSize){l.style.width=this.oTextarea.parentNode.style.width;n.style.width=this.oTextarea.parentNode.style.width}}}if(m>0){n.style.height=m+"px";l.style.height=m+"px"}else{if(this.oTextarea.style.height!=""){l.style.height=this.oTextarea.style.height;n.style.height=this.oTextarea.style.height}}}};this.save=function(){if(this.oEditor!=null){this.oEditor.save();var p=this.oEditor.getWrapperElement().scrollTop;var m=this.oEditor.getCursor(true);var n="";var o,l=-1;var q=0;while((o=this.oTextarea.value.indexOf("\n",l+1))!=-1){if(q++==m.line){n=(l+m.ch+1)+"|"+p;break}l=o}return n}return false}};var AmiExcel={debug:false,container:null,table:null,orig:{},data:{},possibleUndoData:null,undoData:[],undoStep:0,needSaveUndo:false,prevChangedRows:[],changedRows:[],redrawInProgress:false,options:{colHeaders:false,rowHeaders:false,excelDelimiter:"\t",maxRows:500,events:{},columnTypes:[],highlightChanged:false,changeRowOnMoveLR:false},cols:5,rows:20,edited:false,editor:{object:null,input:null,blank:false,originalValue:null,start:function(){AmiExcel.edited=true;AmiExcel.prepareUndo();var a=AmiExcel.editor;a.show()},show:function(){var f=AmiExcel.editor;var g=AmiExcel.cursor;var b=AmiExcel.getCell(g.row,g.col);if(f.object==null){var d=AMI.$("<DIV>");var c=AMI.$("<INPUT>");d.addClass("editor");d.append(c);AmiExcel.container.append(d);f.object=d;f.input=c;f.input.bind("keydown",AmiExcel.onEditorKeyDown)}else{var d=f.object;var c=f.input}if(AmiExcel.selection.active){AmiExcel.selection.clear()}var a=b.position();d.css("top",a.top+2);d.css("left",a.left+2);d.width(b.outerWidth()-3);d.height(b.outerHeight()-3);c.width(b.outerWidth()-14);c.height(b.outerHeight()-5);if(!f.blank){if(typeof(AmiExcel.data[g.row])!="undefined"&&typeof(AmiExcel.data[g.row][g.col])!="undefined"){c.val(AmiExcel.data[g.row][g.col])}}else{c.val("");f.blank=false}d.show();c.focus()},stop:function(c){AmiExcel.edited=false;var a=AmiExcel.editor;var f=AmiExcel.cursor;var d=a.input.val();var b={row:f.row,col:f.col,val:d,cancel:(typeof(c)=="undefined"?false:c)};AmiExcel.fire("on_edit",b);d=b.val;c=b.cancel;a.input.val("");a.input.blur();a.object.hide();if(!c){AmiExcel.updateCell(f.row,f.col,d)}},cancel:function(){AmiExcel.editor.stop(true)}},clipboard:{object:null,input:null,init:function(){var a=AmiExcel.clipboard;a.object=AMI.$("<DIV>");a.object.addClass("clipboard");a.input=AMI.$("<TEXTAREA>");a.object.append(a.input);AmiExcel.container.append(AmiExcel.clipboard.object);a.input.bind("paste",a.process)},copy:function(g){if(typeof(g)=="undefined"){g=false}if(AmiExcel.debug){console.log("------------------------------------------");console.log(g?"CUT":"COPY")}var b=AmiExcel.clipboard;var l=AmiExcel.cursor;var h=AmiExcel.selection;var f="";if(h.active&&h.object){for(var c=h.rowStart;c<=h.rowEnd;c++){for(var a=h.colStart;a<=h.colEnd;a++){if(typeof(AmiExcel.data[c][a])!="undefined"){f+=AmiExcel.data[c][a]}if(a<h.colEnd){f+=AmiExcel.options.excelDelimiter}}if(c<h.rowEnd){f+="\n"}}if(g){h.del()}}else{if(typeof(AmiExcel.data[l.row][l.col])!="undefined"){f=AmiExcel.data[l.row][l.col]}if(g){AmiExcel.updateCell(l.row,l.col,"")}}var k=AmiExcel.getCell(l.row,l.col);var d=k.position();b.object.css("top",d.top+2);b.object.css("left",d.left+2);b.object.show();b.input.focus();b.input.val(f);b.input.focus();b.input.select();if(AmiExcel.debug){console.log("Copied: "+f);console.log("------------------------------------------")}},paste:function(){var c=AmiExcel.clipboard;var d=AmiExcel.cursor;if(d.active){var b=AmiExcel.getCell(d.row,d.col);var a=b.position();c.object.css("top",a.top+2);c.object.css("left",a.left+2);c.object.show();c.input.focus()}},process:function(a){setTimeout(AmiExcel.clipboard.finish,0)},finish:function(){var g=AmiExcel.clipboard.input.val();var m=AmiExcel.cursor;AmiExcel.clipboard.input.val("");AmiExcel.clipboard.input.blur();AmiExcel.clipboard.object.hide();var o=g.split("\n");var h=o.length;if(AmiExcel.debug){console.log("------------------------------------------");console.log("PASTE");console.log(h+" rows to paste");var c=new Date().getTime()/1000}var p=m.row+(h-1);if(p>=AmiExcel.rows){AmiExcel.addRows(p-AmiExcel.rows+1)}AmiExcel.cursor.active=false;for(var k=0;k<h;k++){var n=o.shift();var l=n.split(AmiExcel.options.excelDelimiter);var a=l.length;for(var f=0;f<a;f++){var b=l.shift();if(typeof(AmiExcel.data[m.row+k])=="undefined"){if(m.row+k<AmiExcel.rows){AmiExcel.data[m.row+k]=[]}}if(((m.row+k)<AmiExcel.rows)&&((m.col+f)<AmiExcel.cols)){AmiExcel.updateCell(m.row+k,m.col+f,b)}}}AmiExcel.cursor.active=true;AmiExcel.cursor.show();if(AmiExcel.debug){var d=new Date().getTime()/1000;console.log((d-c)+" seconds total");console.log("------------------------------------------")}}},cursor:{object:null,active:false,row:0,col:0,position:function(c,a){var b=AmiExcel.cursor;b.row=c;b.col=a},move:function(a,b){var c=AmiExcel.cursor;var d={row:c.row,col:c.col};if(a!=0){if(a==-1&&c.row>0){c.row--}if(a==1){if(c.row==(AmiExcel.rows-1)){AmiExcel.addRow()}if(c.row<(AmiExcel.rows-1)){c.row++}}}if(b!=0){if(b==-1){if(c.col>0){c.col--}else{if(c.row>0){if(AmiExcel.options.changeRowOnMoveLR){c.col=AmiExcel.cols-1;c.row--}}}}if(b==1){if(c.col<(AmiExcel.cols-1)){c.col++}else{if(c.row==(AmiExcel.rows-1)){if(AmiExcel.options.changeRowOnMoveLR){AmiExcel.addRow()}}if(c.row<(AmiExcel.rows-1)){if(AmiExcel.options.changeRowOnMoveLR){c.col=0;c.row++}}}}}if(c.col!=d.col||c.row!=d.row){c.show()}},show:function(){AmiExcel.textarea.focus();var f=AmiExcel.cursor;if(f.active){var c=AmiExcel.getCell(f.row,f.col);var b=c.position();f.object.css("top",b.top);f.object.css("left",b.left);var d=(f.col==(AmiExcel.cols-1))?2:1;var g=(f.row==(AmiExcel.rows-1))?2:1;f.object.width(c.outerWidth()+d);f.object.height(c.outerHeight()+g);f.object.show();if(!f.isVisible()){f.scrollTo()}if(AmiExcel.selection.active){AmiExcel.selection.clear()}else{AmiExcel.table.find("TH").removeClass("selected")}if(AmiExcel.options.rowHeaders){var a=(AmiExcel.options.colHeaders)?f.row+1:f.row;AmiExcel.table.find("TR:eq("+a+") TH:eq(0)").addClass("selected")}if(AmiExcel.options.colHeaders){var a=(AmiExcel.options.rowHeaders)?f.col+1:f.col;AmiExcel.table.find("TR:eq(0) TH:eq("+a+")").addClass("selected")}}},hide:function(){var a=AmiExcel.cursor;a.active=false;a.object.hide()},isVisible:function(){var h=AmiExcel.cursor;var f=h.object;var g=f.offset();var d=g.top;var a=f.height();var c=AMI.$(window).scrollTop();var b=AMI.$(window).height();return(d>c&&d+a<c+b)},scrollTo:function(){AMI.$(window).scrollTop(AmiExcel.container.position().top+AmiExcel.cursor.object.position().top)}},selection:{active:false,mouse:false,object:null,rowStart:null,rowEnd:null,colStart:null,colEnd:null,activate:function(){var a=AmiExcel.selection;var b=AmiExcel.cursor;a.active=true;a.rowStart=b.row;a.colStart=b.col;a.rowEnd=b.row;a.colEnd=b.col},selectColumn:function(a){if(AmiExcel.edited){AmiExcel.editor.cancel()}var b=AmiExcel.selection;var c=AmiExcel.cursor;c.active=true;c.position(0,a);c.show();if(!b.active){b.activate()}b.rowStart=0;b.rowEnd=AmiExcel.rows-1;b.colStart=a;b.colEnd=a;b.redraw()},selectRow:function(c){if(AmiExcel.edited){AmiExcel.editor.cancel()}var a=AmiExcel.selection;var b=AmiExcel.cursor;b.active=true;b.position(c,0);b.show();if(!a.active){a.activate()}a.rowStart=c;a.rowEnd=c;a.colStart=0;a.colEnd=AmiExcel.cols-1;a.redraw()},setStart:function(c,a){var b=AmiExcel.selection;if(!b.active){b.activate()}b.rowStart=c;b.colStart=a},setEnd:function(c,a){var b=AmiExcel.selection;if(!b.active){b.activate()}b.rowEnd=c;b.colEnd=a},move:function(a,b){var c=AmiExcel.selection;var d=AmiExcel.cursor;if(!c.active){c.activate()}if(b>0){if(c.colStart<d.col&&c.colEnd==d.col){c.colStart++}else{if(c.colEnd>=d.col&&c.colStart==d.col){if(c.colEnd<AmiExcel.cols-1){c.colEnd++}}}}if(b<0){if(c.colStart<=d.col&&c.colEnd==d.col){if(c.colStart>0){c.colStart--}}else{if(c.colEnd>d.col&&c.colStart==d.col){c.colEnd--}}}if(a>0){if(c.rowStart<d.row&&c.rowEnd==d.row){c.rowStart++}else{if(c.rowEnd>=d.row&&c.rowStart==d.row){if(c.rowEnd<AmiExcel.rows-1){c.rowEnd++}}}}if(a<0){if(c.rowStart<=d.row&&c.rowEnd==d.row){if(c.rowStart>0){c.rowStart--}}else{if(c.rowEnd>d.row&&c.rowStart==d.row){c.rowEnd--}}}},redraw:function(){var n=AmiExcel.selection;if(n.active){if(!n.object){n.object=AMI.$("<DIV>");n.object.addClass("selection");var s=AMI.$("<DIV>");var b=AMI.$("<DIV>");var o=AMI.$("<DIV>");var k=AMI.$("<DIV>");s.addClass("selectionBorderRight");b.addClass("selectionBorderLeft");o.addClass("selectionBorderTop");k.addClass("selectionBorderBottom");n.object.append(s);n.object.append(b);n.object.append(o);n.object.append(k);n.object.find("DIV").addClass("selectionBorder");AmiExcel.container.append(n.object)}var f=AmiExcel.getCell(n.rowStart,n.colStart);var l=f.position();var g=AmiExcel.getCell(n.rowEnd,n.colEnd);var c=g.position();var a=c.left-l.left+g.outerWidth();var p=c.top-l.top+g.outerHeight();var q=(n.colEnd==(AmiExcel.cols-1))?2:1;var h=(n.rowEnd==(AmiExcel.rows-1))?2:1;n.object.css("top",l.top);n.object.css("left",l.left);n.object.width(a+q);n.object.height(p+h);n.object.show();AmiExcel.table.find("TH.selected").removeClass("selected");if(AmiExcel.options.rowHeaders){for(var d=n.rowStart;d<=n.rowEnd;d++){var m=(AmiExcel.options.colHeaders)?d+1:d;AmiExcel.table.find("TR:eq("+m+") TH:eq(0)").addClass("selected")}}if(AmiExcel.options.colHeaders){for(var d=n.colStart;d<=n.colEnd;d++){var m=(AmiExcel.options.rowHeaders)?d+1:d;AmiExcel.table.find("TR:eq(0) TH:eq("+m+")").addClass("selected")}}}},del:function(){for(var b=AmiExcel.selection.rowStart;b<=AmiExcel.selection.rowEnd;b++){for(var a=AmiExcel.selection.colStart;a<=AmiExcel.selection.colEnd;a++){AmiExcel.updateCell(b,a,"")}}AmiExcel.selection.clear()},clear:function(){var a=AmiExcel.selection;if(a.active&&a.object){AmiExcel.table.find("TH.selected").removeClass("selected");a.object.remove();a.active=false;a.object=null}}},globalEventsInitialized:false,keyListener:null,resizeHandler:null,storedWidth:0,handleResize:function(){if(AmiExcel.table.outerWidth()!=AmiExcel.storedWidth){AmiExcel.storedWidth=AmiExcel.table.outerWidth();if(AmiExcel.cursor.active){AmiExcel.cursor.show()}}},init:function(d,c,a){AmiExcel.container=AMI.$("#"+d);AmiExcel.data=c;AmiExcel.orig=AMI.$.extend(true,[],c);if(typeof(a)=="object"){for(var b in a){AmiExcel.options[b]=a[b]}}if(typeof(a.rows)!="undefined"){AmiExcel.rows=a.rows}if(typeof(a.cols)!="undefined"){AmiExcel.cols=a.cols}AmiExcel.cursor.object=AMI.$("<DIV>");AmiExcel.cursor.object.addClass("cursor");AmiExcel.cursor.object.click(function(){if(!AmiExcel.edited){AmiExcel.editCell(AmiExcel.cursor.row,AmiExcel.cursor.col)}});AmiExcel.cursor.object.bind("mousedown",AmiExcel.onMouseDown);AmiExcel.cursor.object.bind("mousemove",AmiExcel.onMouseMove);AmiExcel.cursor.object.bind("mouseup",AmiExcel.onMouseUp);AmiExcel.container.append(AmiExcel.cursor.object);AmiExcel.redraw();if(AmiExcel.resizeHandler==null){AmiExcel.resizeHandler=setInterval(AmiExcel.handleResize,500)}AmiExcel.clipboard.init();AmiExcel.initTextarea();AmiExcel.initEvents()},initEvents:function(){if(!AmiExcel.globalEventsInitialized){AmiExcel.globalEventsInitialized=true}},textarea:null,copypaste:false,initTextarea:function(){var a=$('<DIV style="width:0px; height:0px; overflow:hidden;">');AmiExcel.textarea=$("<TEXTAREA>");a.append(AmiExcel.textarea);AmiExcel.container.append(a);AmiExcel.textarea.bind("blur",function(b){if(!AmiExcel.edited&&!AmiExcel.copypaste){AmiExcel.cursor.hide()}});AmiExcel.textarea.bind("keydown",AmiExcel.onKeyDown)},isPrintableChar:function(a){return((a==32)||(a>=48&&a<=57)||(a>=96&&a<=111)||(a>=186&&a<=192)||(a>=219&&a<=222)||(a>=226)||(a>=65&&a<=90))},onKeyDown:function(a){var c=AmiExcel.edited;var h=AmiExcel.cursor;var d=20;if(!h.active){return}if(c){return}var g=(a.ctrlKey||a.metaKey)&&!a.altKey;var b=a.shiftKey;var l=a.keyCode;if(!c&&!g&&AmiExcel.isPrintableChar(l)){AmiExcel.editor.blank=true;AmiExcel.editCell(h.row,h.col);return}var f=false;var k={bs:8,tab:9,enter:13,escape:27,pgup:33,pgdown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46,a:65,c:67,v:86,x:88,y:89,z:90,f2:113};switch(l){case k.left:if(b){AmiExcel.selection.move(0,-1);AmiExcel.selection.redraw()}else{AmiExcel.cursor.move(0,-1)}break;case k.right:if(b){AmiExcel.selection.move(0,1);AmiExcel.selection.redraw()}else{AmiExcel.cursor.move(0,1)}break;case k.up:if(b){AmiExcel.selection.move(-1,0);AmiExcel.selection.redraw()}else{AmiExcel.cursor.move(-1,0)}break;case k.down:if(b){AmiExcel.selection.move(1,0);AmiExcel.selection.redraw()}else{AmiExcel.cursor.move(1,0)}break;case k.pgup:if((h.row-d)>0){h.row-=d}else{h.row=0}h.show();break;case k.pgdown:if((h.row+d)<AmiExcel.rows){h.row+=d}else{h.row=AmiExcel.rows-1}h.show();break;case k.home:if(b){AmiExcel.selection.setStart(AmiExcel.cursor.row,0);AmiExcel.selection.setEnd(AmiExcel.cursor.row,AmiExcel.cursor.col);AmiExcel.selection.redraw()}else{if(g){AmiExcel.cursor.row=0}AmiExcel.cursor.col=0;AmiExcel.cursor.show()}break;case k.end:if(b){AmiExcel.selection.setStart(AmiExcel.cursor.row,AmiExcel.cursor.col);AmiExcel.selection.setEnd(AmiExcel.cursor.row,AmiExcel.cols-1);AmiExcel.selection.redraw()}else{if(g){AmiExcel.cursor.row=AmiExcel.rows-1}AmiExcel.cursor.col=AmiExcel.cols-1;AmiExcel.cursor.show()}break;case k.f2:AmiExcel.editCell(h.row,h.col);break;case k.enter:AmiExcel.cursor.move((b)?-1:1,0);break;case k.tab:AmiExcel.cursor.move(0,(b)?-1:1);break;case k.del:case k.bs:AmiExcel.prepareUndo();if(!AmiExcel.selection.active){AmiExcel.updateCell(h.row,h.col,"")}else{AmiExcel.selection.del()}break;case k.escape:if(h.active){}break;case k.a:if(g){AmiExcel.cursor.position(0,0);AmiExcel.cursor.show();AmiExcel.selection.setStart(0,0);AmiExcel.selection.setEnd(AmiExcel.rows-1,AmiExcel.cols-1);AmiExcel.selection.redraw()}break;case k.c:if(g){AmiExcel.copypaste=true;AmiExcel.clipboard.copy();if(AMI.$.browser.opera){AmiExcel.clipboard.input.triggerHandler("copy")}setTimeout(function(){AmiExcel.cursor.show()},0);AmiExcel.copypaste=false;f=true}break;case k.x:AmiExcel.prepareUndo();if(g){AmiExcel.copypaste=true;AmiExcel.clipboard.copy(true);if(AMI.$.browser.opera){AmiExcel.clipboard.input.triggerHandler("cut")}setTimeout(function(){AmiExcel.cursor.show()},0);AmiExcel.copypaste=false;f=true}break;case k.v:AmiExcel.prepareUndo();if(g){AmiExcel.copypaste=true;AmiExcel.clipboard.paste();if(AMI.$.browser.opera){AmiExcel.clipboard.input.triggerHandler("paste")}AmiExcel.copypaste=false;f=true}break;case k.y:if(g){AmiExcel.redo();AmiExcel.needSaveUndo=false}break;case k.z:if(g){AmiExcel.undo();AmiExcel.needSaveUndo=false}break;default:if(AmiExcel.debug){}break}if(AmiExcel.needSaveUndo){AmiExcel.saveUndo();AmiExcel.needSaveUndo=false}if(!f){a.preventDefault()}},onEditorKeyDown:function(d){var k=AmiExcel.edited;var h=AmiExcel.cursor;var b=20;if(!h.active){return}if(!k){return}var g=(d.ctrlKey||d.metaKey)&&!d.altKey;var a=d.shiftKey;var f=d.keyCode;var c={tab:9,enter:13,escape:27,up:38,down:40,f2:113};switch(f){case c.up:AmiExcel.editor.stop();AmiExcel.cursor.move(-1,0);d.preventDefault();break;case c.down:AmiExcel.editor.stop();AmiExcel.cursor.move(1,0);d.preventDefault();break;case c.f2:d.preventDefault();AmiExcel.editor.stop();AmiExcel.cursor.move((a)?-1:1,0);break;case c.enter:d.preventDefault();AmiExcel.editor.stop();AmiExcel.cursor.move((a)?-1:1,0);break;case c.tab:d.preventDefault();AmiExcel.editor.stop();AmiExcel.cursor.move(0,(a)?-1:1);break;case c.escape:AmiExcel.editor.cancel();break}if(AmiExcel.needSaveUndo){AmiExcel.saveUndo();AmiExcel.needSaveUndo=false}},redraw:function(){AmiExcel.redrawInProgress=true;if(AmiExcel.table){AmiExcel.table.empty()}else{AmiExcel.table=AMI.$("<TABLE>")}AmiExcel.table.attr("onselectstart","return false;");AmiExcel.table.attr("cellspacing","0");AmiExcel.table.attr("cellpadding","0");if(AmiExcel.options.colHeaders){AmiExcel.addHeadersRow()}for(var a=0;a<AmiExcel.rows;a++){AmiExcel.addRow()}AmiExcel.container.append(AmiExcel.table);AmiExcel.fill();AmiExcel.table.bind("mousedown",AmiExcel.onMouseDown);AmiExcel.table.bind("mousemove",AmiExcel.onMouseMove);AmiExcel.table.bind("mouseup",AmiExcel.onMouseUp);AmiExcel.redrawInProgress=false},onMouseDown:function(c){if(AmiExcel.edited){AmiExcel.editor.stop()}var d=false;var a=false;if(typeof(c.srcElement)=="undefined"){if(typeof(c.originalEvent)!="undefined"){var b=c.originalEvent;if(typeof(b.explicitOriginalTarget)!="undefined"){a=b.explicitOriginalTarget}}}else{a=c.srcElement}if(!a){c.preventDefault();return}if(a.nodeName=="TD"){d=AmiExcel.getCellPosition(a);AmiExcel.cursor.position(d.row,d.col);AmiExcel.cursor.active=true;AmiExcel.cursor.show()}else{if(a.nodeName=="DIV"){d={row:AmiExcel.cursor.row,col:AmiExcel.cursor.col}}}if(d){AmiExcel.selection.clear();AmiExcel.selection.mouse=true;AmiExcel.selection.setStart(d.row,d.col)}c.preventDefault()},onMouseMove:function(f){if(AmiExcel.selection.mouse){var a=false;if(typeof(f.srcElement)=="undefined"){if(typeof(f.originalEvent)!="undefined"){var d=f.originalEvent;if(typeof(d.explicitOriginalTarget)!="undefined"){a=d.explicitOriginalTarget}}}else{a=f.srcElement}if(!a){f.preventDefault();return}var k=false;if(a.nodeName=="TD"){k=AmiExcel.getCellPosition(a)}else{if(a.nodeName=="DIV"){k={row:AmiExcel.cursor.row,col:AmiExcel.cursor.col}}}if(k){var c=AmiExcel.cursor.row;var b=AmiExcel.cursor.row;var h=AmiExcel.cursor.col;var g=AmiExcel.cursor.col;if(k.row<AmiExcel.cursor.row){c=k.row}else{b=k.row}if(k.col<AmiExcel.cursor.col){h=k.col}else{g=k.col}AmiExcel.selection.setStart(c,h);AmiExcel.selection.setEnd(b,g);AmiExcel.selection.redraw()}}f.preventDefault()},onMouseUp:function(a){if(AmiExcel.selection.active&&!AmiExcel.selection.object){AmiExcel.selection.active=false}AmiExcel.selection.mouse=false;a.preventDefault()},getCellPosition:function(a){var b=a.cellIndex;var c=a.parentNode.rowIndex;if(AmiExcel.options.colHeaders){c--}if(AmiExcel.options.rowHeaders){b--}return{row:c,col:b}},addRow:function(){var b=AmiExcel.table.find("tr").length;if(b&&AmiExcel.options.colHeaders){b=b-1}if(AmiExcel.options.maxRows&&b>=AmiExcel.options.maxRows){return false}var d=AMI.$("<TR>");if(AmiExcel.options.colHeaders){var a=AMI.$("<TH>");a.addClass("columnHeader");a.html(b+1);a.click(function(f){return function(k){var g=true;var h=AmiExcel.selection;var l=AmiExcel.cursor;if(k.shiftKey){if(h.active){if(h.colStart==0&&h.colEnd==(AmiExcel.cols-1)){if(h.rowEnd<f){h.rowEnd=f;if(h.rowEnd>l.row){h.rowStart=l.row}}else{if(h.rowStart>f){h.rowStart=f;if(h.rowStart<l.row){h.rowEnd=l.row}}else{if(h.rowStart<=f<=h.rowEnd){if(f>=l.row){h.rowEnd=f}if(f<=l.row){h.rowStart=f}}}}g=false}}}if(g){h.clear();h.selectRow(f)}else{h.redraw()}}}(b));d.append(a)}for(var c=0;c<AmiExcel.cols;c++){var a=AMI.$("<TD>");a.click(function(g,f){return function(){if(AmiExcel.edited){AmiExcel.editor.stop();if(AmiExcel.needSaveUndo){AmiExcel.saveUndo();AmiExcel.needSaveUndo=false}}AmiExcel.cursor.position(g,f);AmiExcel.cursor.active=true;AmiExcel.cursor.show()}}(b,c));d.append(a)}AmiExcel.table.append(d);if(b>=AmiExcel.rows){AmiExcel.rows=b+1}return true},addRows:function(d){if(AmiExcel.debug){var c=new Date().getTime()/1000;console.log("adding "+d+" new rows")}if(d>0){for(var b=0;b<d;b++){AmiExcel.addRow()}}if(AmiExcel.debug){var a=new Date().getTime()/1000;console.log((a-c)+" seconds to add rows")}},addHeadersRow:function(){var f=AMI.$("<TR>");var d=AmiExcel.cols;if(AmiExcel.options.colHeaders){d++}for(var b=0;b<d;b++){var a=AMI.$("<TH>");var c=(AmiExcel.options.rowHeaders)?b-1:b;if(typeof(AmiExcel.options.headers)!="undefined"&&typeof(AmiExcel.options.headers[c])!="undefined"){a.html(AmiExcel.options.headers[c])}if(!(AmiExcel.options.rowHeaders&&b==0)){a.click(function(g){return function(l){var h=true;var k=AmiExcel.selection;var m=AmiExcel.cursor;if(l.shiftKey){if(k.active){if(k.rowStart==0&&k.rowEnd==(AmiExcel.rows-1)){if(k.colEnd<g){k.colEnd=g;if(k.colEnd>m.col){k.colStart=m.col}}else{if(k.colStart>g){k.colStart=g;if(k.colStart<m.col){k.colEnd=m.col}}else{if(k.colStart<=g<=k.colEnd){if(g>=m.col){k.colEnd=g}if(g<=m.col){k.colStart=g}}}}h=false}}}if(h){k.clear();k.selectColumn(g)}else{k.redraw()}}}(c))}f.append(a)}AmiExcel.table.append(f)},fill:function(){for(var c=0;c<AmiExcel.rows;c++){for(var a=0;a<AmiExcel.cols;a++){if(typeof(AmiExcel.data[c])=="undefined"){AmiExcel.data[c]=[]}if(typeof(AmiExcel.data[c][a])!="undefined"){AmiExcel.updateCell(c,a)}}var b={row:c,rowData:AmiExcel.data[c]};AmiExcel.fire("on_row",b)}},getCell:function(b,a){if(AmiExcel.options.rowHeaders){b=b+1}return AmiExcel.table.find("tr:eq("+b+") td:eq("+a+")")},updateCell:function(c,a,b){if(typeof(b)!="undefined"){if(typeof(AmiExcel.data[c])=="undefined"){AmiExcel.data[c]=[]}if((typeof(AmiExcel.data[c][a])=="undefined")||(AmiExcel.data[c][a]!=b)){AmiExcel.data[c][a]=b;if(!AmiExcel.redrawInProgress){AmiExcel.needSaveUndo=true}}if(!AmiExcel.redrawInProgress){AmiExcel.handleChanged(c)}}AmiExcel.setCellValue(c,a);if(AmiExcel.cursor.active){AmiExcel.cursor.show()}AmiExcel.selection.redraw()},setCellValue:function(f,b){var d=AmiExcel.data[f][b];var a=AmiExcel.getCell(f,b);var c={row:f,col:b,value:d,cell:a,rowData:AmiExcel.data[f]};AmiExcel.fire("on_cell",c);a.text(c.value)},editCell:function(c,b){var a=AmiExcel.getCell(c,b);if(!a.hasClass("readonly")){AmiExcel.editor.start(c,b)}},fire:function(a,b){if(typeof(AmiExcel.options.events[a])!="undefined"){AmiExcel.options.events[a](b)}},checkDataRow:function(a){if(typeof(AmiExcel.data[a])=="undefined"){AmiExcel.data[a]=[]}},handleChanged:function(h,f){var g=false;var d=AmiExcel.data;var k=AmiExcel.orig;AmiExcel.checkDataRow(h);if(typeof(k[h])=="undefined"){for(var a=0;a<AmiExcel.cols;a++){if(typeof(d[h][a])!="undefined"&&d[h][a]!=""){g=true;break}}}else{for(var a=0;a<AmiExcel.cols;a++){if(typeof(d[h][a])=="undefined"&&typeof(k[h][a])=="undefined"){continue}if((typeof(d[h][a])=="undefined"&&typeof(k[h][a])!="undefined")||(typeof(k[h][a])=="undefined"&&typeof(d[h][a])!="undefined")){g=true;break}if(!g&&(d[h][a]!=k[h][a])){g=true;break}}}var b={row:h,rowData:d[h],changedRows:AmiExcel.changedRows};AmiExcel.fire("on_change",b);if(g&&AmiExcel.changedRows.indexOf(h)<0){AmiExcel.changedRows.push(h);AmiExcel.changedRows.sort()}if(!g&&AmiExcel.changedRows.indexOf(h)>=0){AmiExcel.changedRows.splice(AmiExcel.changedRows.indexOf(h),1)}if(AmiExcel.options.highlightChanged){var c=(AmiExcel.options.colHeaders)?h+1:h;AmiExcel.table.find("TR:eq("+c+")")[g?"addClass":"removeClass"]("changed")}},highlightChanges:function(){for(var a=0;a<AmiExcel.data.length;a++){AmiExcel.handleChanged(a,true)}},getChangedRows:function(){var b=[];for(var a=0;a<AmiExcel.changedRows.length;a++){b.push({row:AmiExcel.changedRows[a],data:AmiExcel.data[AmiExcel.changedRows[a]]})}return b},destroy:function(){if(AmiExcel.edited){AmiExcel.editor.cancel()}AmiExcel.editor.object=null;AmiExcel.orig={};AmiExcel.data={};AmiExcel.changedRows=[];AmiExcel.selection.clear();AmiExcel.cursor.active=false;if(AmiExcel.container){AmiExcel.container.remove()}if(AmiExcel.resizeHandler!=null){clearInterval(AmiExcel.resizeHandler)}},prepareUndo:function(){AmiExcel.possibleUndoData=AMI.$.extend(true,[],AmiExcel.data)},saveUndo:function(){if(AmiExcel.possibleUndoData!=null){AmiExcel.undoData[AmiExcel.undoStep]=AMI.$.extend(true,[],AmiExcel.possibleUndoData);if(AmiExcel.undoData.length>10){AmiExcel.undoData.shift()}else{AmiExcel.undoStep++}if(AmiExcel.undoData.length>AmiExcel.undoStep){AmiExcel.undoData=AmiExcel.undoData.slice(0,AmiExcel.undoStep)}AmiExcel.possibleUndoData=null}},undo:function(){if(typeof(AmiExcel.undoData[AmiExcel.undoStep])=="undefined"){AmiExcel.undoData[AmiExcel.undoStep]=AMI.$.extend(true,[],AmiExcel.data)}if(AmiExcel.undoStep&&AmiExcel.undoData.length&&typeof(AmiExcel.undoData[AmiExcel.undoStep-1])!="undefined"){AmiExcel.data=AMI.$.extend(true,[],AmiExcel.undoData[AmiExcel.undoStep-1]);AmiExcel.undoStep--;AmiExcel.redraw();AmiExcel.highlightChanges()}},redo:function(){if((AmiExcel.undoData.length>AmiExcel.undoStep)&&typeof(AmiExcel.undoData[AmiExcel.undoStep+1])!="undefined"){AmiExcel.data=AMI.$.extend(true,[],AmiExcel.undoData[AmiExcel.undoStep+1]);AmiExcel.undoStep++;AmiExcel.redraw();AmiExcel.highlightChanges()}},finish:true};var amiAdminSelect=function(b,c,a){this.name=b;this.aData=c;this.container=null;this.highlighted={};this.lastStr="";this.showTooMuch=false;this.options=typeof(a)!=="undefined"?a:{};this.getOpt=function(f,d){var g=typeof(d)!=="undefined"?d:null;return typeof(this.options[f])!=="undefined"?this.options[f]:g};this.init=function(f){if(typeof(window.amiAdminSelectInstances)=="undefined"){window.amiAdminSelectInstances={};window.getAmiAdminSelect=function(h){return(typeof(window.amiAdminSelectInstances[h])!="undefined")?window.amiAdminSelectInstances[h]:null};AMI.$(window).keydown(function(p){var n=false;for(var h in window.amiAdminSelectInstances){if(AMI.$("#"+h+"-list:visible").length){n=window.amiAdminSelectInstances[h];break}}if(n!==false){var s={enter:13,escape:27,up:38,down:40,};var q=n.getListObject();var l=q.find(".ami-select__selected");if(p.keyCode===s.enter){if(l.length){l.click()}p.preventDefault()}var k=".ami-select__item";if(p.keyCode===s.up){if(!l.length){q.find(k).first().addClass("ami-select__selected");q.scrollTop(0)}else{var m=l.prevAll(k).first();if(!m.length){m=l.parent().prev().find(k).last()}if(m.length){m.mouseover();if(m.position().top<0){q.scrollTop(q.scrollTop()+m.position().top)}}}p.preventDefault()}if(p.keyCode===s.down){if(!l.length){q.find(k).first().addClass("ami-select__selected");q.scrollTop(0)}else{var o=l.nextAll(k).first();if(!o.length){o=l.parent().next().find(k).first()}if(o.length){o.mouseover();if(o.position().top>q.height()-o.height()){q.scrollTop(q.scrollTop()+o.height()+10)}}}p.preventDefault()}}})}window.amiAdminSelectInstances[this.name]=this;var d=AMI.$("#"+f);this.container=d;if(d.length){d.empty();var g=this.getOpt("onInit",false);if(typeof(g)=="function"){g(this)}this.renderInputRow(d);if(this.getOpt("renderDataOnStart",true)){this.renderData()}this.initEvents();setTimeout(function(h){return function(){if(!topEvents||window.self===window.top){h.getListObject().css("max-height",AMI.$(window).height()-250)}else{h.getListObject().css("max-height",AMI.$(window.top).height()-350)}var k=h.getOpt("onAfterInit",false);if(typeof(k)=="function"){k(h)}}}(this),300);return true}this.log("Container element ID #"+f+" not found!");return false};this.renderInputRow=function(d){var h=AMI.$("<DIV>");h.attr("id",this.name+"-container");h.addClass("ami-select__container");h.css("width",Math.round((parseInt(AMI.$("#filter-box").width())-100)/2)+"px");var o=AMI.$("<DIV>");o.addClass("ami-select__inner");o.addClass("ami-select__resultrow");var p=AMI.$("<DIV>");p.attr("id",this.name+"-resultrow");p.addClass("ami-select-resultrow");var l=AMI.$("<DIV>");l.attr("id",this.name+"-rolloverbutton");l.addClass("ami-select-rolloverbutton");l.attr("align","right");var g=AMI.$("<INPUT>");g.attr("type","text");g.val(this.getOpt("title",""));g.focus(function(q){return function(){if(this.value===q.getOpt("title","")){this.value=""}}}(this));g.blur(function(q){return function(){if(this.value===""){this.value=q.getOpt("title","")}}}(this));var n=AMI.$("<DIV>");n.attr("id",this.name+"-viewed");n.addClass("ami-select-viewed");p.append(g);p.append(n);o.append(p);o.append(l);h.append(o);d.append(h);var k=AMI.$("<DIV>");k.attr("id",this.name+"-list");k.addClass("ami-select__inner");k.addClass("ami-select__list");k.css("z-index","100");var m=AMI.$("<DIV>");m.addClass("ami-select__close");m.attr("id",this.name+"-close");m.click(function(q){return function(s){q.closeList(s,true)}}(this));k.append(m);if(this.getOpt("listAlign","left")=="right"){k.css("right","8px")}else{k.css("left","10px")}d.append(k);var f=AMI.$("<DIV>");f.attr("id",this.name+"-tooMuchMaches");f.addClass("ami-select__msgOverflow");d.append(f)};this.tooMuch=function(h,g,f){var d=AMI.$("#"+this.name+"-tooMuchMaches");this.showTooMuch=h;if(h&&(parseInt(g)<parseInt(f))){d.css("top",this.getListObject().position().top+this.getListObject().height()+4);d.html(this.getOpt("tooMuch","Not all mathes shown").replace("__count__",g).replace("__total__",f));d.show()}else{d.html("");d.hide()}};this.getListObject=function(){return AMI.$("#"+this.name+"-list")};this.getContainer=function(){return AMI.$("#"+this.name+"-container")};this.renderData=function(){for(var f in this.aData){this.addGroup(this.aData[f].caption);if(typeof(this.aData[f])==="object"){for(var d in this.aData[f].items){this.addItem(this.aData[f].caption,this.aData[f].items[d].caption,d)}}}};this.isGroupExists=function(d){return this.getGroup(d).length>0};this.getGroup=function(d){return this.getListObject().children('DIV[data-ami-select-group="'+d+'"]')};this.getGroups=function(){return AMI.$("#"+this.name+"-list > .ami-select__group")};this.addGroup=function(f){f=this.clearName(f);if(this.isGroupExists(f)){return this.getGroup(f)}var h=AMI.$("<DIV>");h.addClass("ami-select__group");h.attr("data-ami-select-group",f);var d=AMI.$("<DIV>");d.addClass("ami-select__grouptitle");for(var g in this.highlighted){var k=new RegExp("("+g+")","ig");f=f.replace(k,"<b>$1</b>")}d.html(f);h.append(d);this.getListObject().append(h);h.on("click","div",function(l){return function(){if(AMI.$(this).hasClass("ami-select__item")){AMI.$("#"+l.name+"-resultrow input, #"+l.name+"-list").hide();l.tooMuch(false);AMI.$("#"+l.name+"-viewed, #"+l.name+"-rolloverbutton").show();AMI.$("#"+l.name+"-viewed").text(AMI.$(this).attr("data-ami-select-item-full"));if(typeof(l.options.onSelect)!=="undefined"){l.options.onSelect(l,AMI.$(this).attr("data-ami-select-item-full"),AMI.$(this).attr("data-ami-select-item-value"),AMI.$(this))}}}}(this));return h};this.clearName=function(d){if(typeof(d)=="undefined"){return""}d=d.replace(/&quot;/ig,'"');d=d.replace(/&laquo;/ig,"");d=d.replace(/&raquo;/ig,"");d=d.replace(/\\'/ig,"'");d=d.replace(/\\\//ig,"/");return d};this.addItem=function(n,d,m,f){d=this.clearName(d);var k=this.addGroup(n);k.children("HR").remove();var l=AMI.$("<DIV>");l.addClass("ami-select__item");l.attr("data-ami-select-item-value",m);var p=k.attr("data-ami-select-group")+": "+d;l.attr("data-ami-select-item-full",p);if(typeof(f)=="undefined"){if(this.getOpt("selected","")===m){AMI.$("#"+this.name+"-viewed").text(p);AMI.$("#"+this.name+"-resultrow input").val(p)}}for(var h in this.highlighted){var g=new RegExp("("+h+")","ig");d=d.replace(g,"<b>$1</b>")}l.html(d);var o=this.getOpt("onAddItem",false);if(typeof(o)=="function"){o(this,n,d,m,k,l)}k.append(l);k.append(AMI.$("<HR>"))};this.searchItems=function(k,d){var g=false;for(var f=0;f<d.length;f++){if(d[f]==""){continue}var l=k.toLowerCase();var h=d[f];if(l.indexOf(h)>=0){g=true;this.highlighted[h]=1}}return g};this.initEvents=function(){AMI.$(window).resize(function(d){return function(f){d.getContainer().css("width",Math.round((parseInt(AMI.$("#filter-box").width())-100)/2)+"px")}}(this));this.getContainer().on("click","#"+this.name+"-rolloverbutton",function(d){return function(){var g=d.getOpt("onButtonClick",false);var f=false;if(typeof(g)=="function"){var f=g(d)}if(!f){d.getListObject().css("display","inline-block");var g=d.getOpt("onListOpen",false);if(typeof(g)=="function"){g(d,d.getListObject())}AMI.$("#"+d.name+"-viewed, #"+d.name+"-rolloverbutton").hide();AMI.$("#"+d.name+"-resultrow input").show().focus();d.ifInputNullShowList();if(d.showTooMuch){d.tooMuch(true)}}}}(this));this.getContainer().on("click","#"+this.name+"-viewed, #"+this.name+"-resultrow > input",function(d){return function(){var g=d.getOpt("onListClick",false);var f=false;if(typeof(g)=="function"){var f=g(d)}if(!f){d.getListObject().css("display","inline-block");var g=d.getOpt("onListOpen",false);if(typeof(g)=="function"){g(d,d.getListObject())}AMI.$("#"+d.name+"-viewed, #"+d.name+"-rolloverbutton").hide();AMI.$("#"+d.name+"-resultrow input").val("");if(typeof(d.lastStr)!="undefined"){AMI.$("#"+d.name+"-resultrow input").val(d.lastStr)}AMI.$("#"+d.name+"-resultrow input").show().focus().select();d.ifInputNullShowList();if(d.showTooMuch){d.tooMuch(true)}}}}(this));this.getListObject().scroll(function(d){return function(){var f=d.getListObject().scrollTop();AMI.$("#"+d.name+"-close").css("top",f+"px")}}(this));AMI.$(document).mouseup(function(d){return function(f){d.closeList(f)}}(this));AMI.$(document).keyup(function(d){return function(f){if(f.keyCode===27){d.closeList(f)}}}(this));this.getListObject().on("mouseover",".ami-select__item",function(d){return function(){AMI.$(".ami-select__item").removeClass("ami-select__selected");AMI.$(this).addClass("ami-select__selected")}}(this));AMI.$("#"+this.name+"-resultrow input").keyup(function(d){return function(f){if(f.keyCode===27){AMI.$(this).val("")}if((f.keyCode===38)||(f.keyCode===40)){return}d.delay(function(g){return function(){var m=[];var v=AMI.$("#"+g.name+"-resultrow input").val().replace(/\:/g,"");v=v.replace(/\s+/g," ").replace(/^\s/,"").replace(/\s$/,"");if(!v.length){g.highlighted={};g.lastStr="";var p=g.getOpt("onEmptySearch",false);var w=false;if(typeof(p)=="function"){w=p(g)}if(!w){return}}else{AMI.$("#"+d.name+"-viewed, #"+d.name+"-rolloverbutton").hide();d.getListObject().css("display","inline-block");var p=g.getOpt("onListOpen",false);if(typeof(p)=="function"){p(g,g.getListObject())}v=v.replace("\\","\\\\").toLowerCase();if(g.lastStr==v){return}g.highlighted={};g.lastStr=v;m=v.split(" ")}var p=g.getOpt("onBeforeHighlight",false);if(typeof(p)=="function"){p(g)}g.getListObject().empty();var z=AMI.$("<DIV>");z.addClass("ami-select__close");z.attr("id",g.name+"-close");z.click(function(F){return function(G){F.closeList(G,true)}}(g));g.getListObject().append(z);var o={};var A=0;var s=false;var E=0;for(var t in g.aData){for(var D in g.aData[t].items){for(var B=0;B<m.length;B++){if(m[B]!=""){m[B]=m[B];g.highlighted[m[B]]=0}}var k=false;var p=g.getOpt("onSearch",false);if(typeof(p)=="function"){k=p(g,t,D,v,m)}var q=g.searchItems(g.aData[t].caption,m);var n=g.searchItems(D,m);var h=g.searchItems(g.aData[t].items[D].caption,m);var C=true;for(var u in g.highlighted){if(!g.highlighted[u]){C=false;break}}if(C&&(k||q||n||h)){E++;if(s){continue}if(typeof(o[t])=="undefined"){o[t]={}}o[t][D]=g.aData[t].items[D];var l=o[t][D].caption;g.addItem(g.aData[t].caption,l,D,true);A++;if(A==g.getOpt("maxCount",1000)){s=true;break}}}}g.getListObject().find("P").remove();g.tooMuch(s,g.getOpt("maxCount",1000),E);if(!A){g.getListObject().append("<p>"+g.getOpt("notFound","Found nothing")+"</p>")}}}(d),300)}}(this))};this.ifInputNullShowList=function(){if(AMI.$("#"+this.name+"-resultrow > input").val()===""){this.getGroups().show()}};this.closeList=function(g,f){var d=this.getListObject();if(f||((typeof(g.target)!="undefined")&&((d.has(g.target).length===0)&&(d.attr("id")!=AMI.$(g.target).attr("id"))))){this.tooMuch(false);d.hide();AMI.$("#"+this.name+"-rolloverbutton").show();if(AMI.$("#"+this.name+"-viewed").text()!==""){AMI.$("#"+this.name+"-viewed").show();AMI.$("#"+this.name+"-resultrow input").hide()}}};this.timer=0;this.delay=function(f,d){clearTimeout(this.timer);this.timer=setTimeout(f,d)};this.log=function(f,d){if(this.getOpt("debug",false)){console.log(f)}}};var CodeMirror=(function(){function A(aT,aQ){var ca={},br=A.defaults;for(var aF in br){if(br.hasOwnProperty(aF)){ca[aF]=(aQ&&aQ.hasOwnProperty(aF)?aQ:br)[aF]}}var aK=document.createElement("div");aK.className="CodeMirror"+(ca.lineWrapping?" CodeMirror-wrap":"");aK.innerHTML='<div style="overflow: hidden; position: relative; width: 3px; height: 0px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll" tabindex="-1"><div style="position: relative"><div style="position: relative"><div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative; z-index: 0"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre class="CodeMirror-cursor">&#160;</pre><div style="position: relative; z-index: -1"></div><div></div></div></div></div></div></div>';if(aT.appendChild){aT.appendChild(aK)}else{aT(aK)}var b6=aK.firstChild,bu=b6.firstChild,bs=aK.lastChild,bV=bs.firstChild,cq=bV.firstChild,aO=cq.firstChild,a5=aO.firstChild,bC=aO.nextSibling.firstChild,aB=bC.firstChild,bk=aB.nextSibling,bo=bk.nextSibling,ax=bo.nextSibling;cO();cG();if(w){bu.style.width="0px"}if(!g){bC.draggable=true}bC.style.outline="none";if(ca.tabindex!=null){bu.tabIndex=ca.tabindex}if(ca.autofocus){bI()}if(!ca.gutter&&!ca.lineNumbers){aO.style.display="none"}if(p){b6.style.height="1px",b6.style.position="absolute"}try{cD("x")}catch(ch){if(ch.message.match(/runtime/i)){ch=new Error("A CodeMirror inside a P-style element does not work in Internet Explorer. (innerHTML bug)")}throw ch}var cg=new F(),aC=new F(),c0;var ck,cJ=new l([new an([new f("")])]),cr,ct;b2();var c7={from:{line:0,ch:0},to:{line:0,ch:0},inverted:false};var cs,by,a6,bO=0,bj,cx=false,cC=false;var cz,cf,aI,cY,aW,bn,aZ,cL,cm;var bl=0,c1=0,bU=0,bW=0;var cd;var bM="",aM;var aw={};ay(function(){a3(ca.value||"");cz=false})();var bg=new n();v(bs,"mousedown",ay(cu));v(bs,"dblclick",ay(b5));v(bC,"selectstart",Z);if(!T){v(bs,"contextmenu",a8)}v(bs,"scroll",function(){bO=bs.scrollTop;cn([]);if(ca.fixedGutter){aO.style.left=bs.scrollLeft+"px"}if(ca.onScroll){ca.onScroll(ci)}});v(window,"resize",function(){cn(true)});v(bu,"keyup",ay(cv));v(bu,"input",aX);v(bu,"keydown",ay(cl));v(bu,"keypress",ay(bv));v(bu,"focus",c5);v(bu,"blur",aL);if(ca.dragDrop){v(bC,"dragstart",aP);function bL(da){if(ca.onDragEvent&&ca.onDragEvent(ci,U(da))){return}C(da)}v(bs,"dragenter",bL);v(bs,"dragover",bL);v(bs,"drop",ay(au))}v(bs,"paste",function(){bI();aX()});v(bu,"paste",aX);v(bu,"cut",ay(function(){if(!ca.readOnly){bA("")}}));if(p){v(bV,"mouseup",function(){if(document.activeElement==bu){bu.blur()}bI()})}var cH;try{cH=(document.activeElement==bu)}catch(ch){}if(cH||ca.autofocus){setTimeout(c5,20)}else{aL()}function bz(da){return da>=0&&da<cJ.size}var ci=aK.CodeMirror={getValue:cb,setValue:ay(a3),getSelection:cc,getSelStart:aH,getSelEnd:bc,replaceSelection:ay(bA),focus:function(){window.focus();bI();c5();aX()},setOption:function(db,dc){var da=ca[db];ca[db]=dc;if(db=="mode"||db=="indentUnit"){b2()}else{if(db=="readOnly"&&dc=="nocursor"){aL();bu.blur()}else{if(db=="readOnly"&&!dc){cN(true)}else{if(db=="theme"){cO()}else{if(db=="lineWrapping"&&da!=dc){ay(cR)()}else{if(db=="tabSize"){cn(true)}else{if(db=="keyMap"){cG()}}}}}}}if(db=="lineNumbers"||db=="gutter"||db=="firstLineNumber"||db=="theme"){bm();cn(true)}},getOption:function(da){return ca[da]},undo:ay(c4),redo:ay(cU),indentLine:ay(function(db,da){if(typeof da!="string"){if(da==null){da=ca.smartIndent?"smart":"prev"}else{da=da?"add":"subtract"}}if(bz(db)){bH(db,da)}}),indentSelection:ay(cM),historySize:function(){return{undo:bg.done.length,redo:bg.undone.length}},clearHistory:function(){bg=new n()},matchBrackets:ay(function(){co(true)}),getTokenAt:ay(function(da){da=a0(da);return cQ(da.line).getTokenAt(ck,cE(da.line),da.ch)}),getStateAfter:function(da){da=b8(da==null?cJ.size-1:da);return cE(da+1)},cursorCoords:function(db,da){if(db==null){db=c7.inverted}return this.charCoords(db?c7.from:c7.to,da)},charCoords:function(db,da){db=a0(db);if(da=="local"){return c2(db,false)}if(da=="div"){return c2(db,true)}return av(db)},coordsChar:function(da){var db=aq(bC);return bQ(da.x-db.left,da.y-db.top)},markText:ay(bN),setBookmark:a1,findMarksAt:bw,setMarker:ay(b4),clearMarker:ay(aA),setLineClass:ay(bt),hideLine:ay(function(da){return cV(da,true)}),showLine:ay(function(da){return cV(da,false)}),onDeleteLine:function(da,db){if(typeof da=="number"){if(!bz(da)){return null}da=cQ(da)}(da.handlers||(da.handlers=[])).push(db);return da},lineInfo:a2,addWidget:function(de,dc,dg,dd,di){de=c2(a0(de));var df=de.yBot,db=de.x;dc.style.position="absolute";bV.appendChild(dc);if(dd=="over"){df=de.y}else{if(dd=="near"){var da=Math.max(bs.offsetHeight,cJ.height*bY()),dh=Math.max(bV.clientWidth,bC.clientWidth)-bd();if(de.yBot+dc.offsetHeight>da&&de.y>dc.offsetHeight){df=de.y-dc.offsetHeight}if(db+dc.offsetWidth>dh){db=dh-dc.offsetWidth}}}dc.style.top=(df+cB())+"px";dc.style.left=dc.style.right="";if(di=="right"){db=bV.clientWidth-dc.offsetWidth;dc.style.right="0px"}else{if(di=="left"){db=0}else{if(di=="middle"){db=(bV.clientWidth-dc.offsetWidth)/2}}dc.style.left=(db+bd())+"px"}if(dg){aG(db,df,db+dc.offsetWidth,df+dc.offsetHeight)}},lineCount:function(){return cJ.size},clipPos:a0,getCursor:function(da){if(da==null){da=c7.inverted}return ag(da?c7.from:c7.to)},somethingSelected:function(){return !aj(c7.from,c7.to)},setCursor:ay(function(da,dc,db){if(dc==null&&typeof da.line=="number"){be(da.line,da.ch,db)}else{be(da,dc,db)}}),setSelection:ay(function(dc,db,da){(da?bG:bE)(a0(dc),a0(db||dc))}),getLine:function(da){if(bz(da)){return cQ(da).text}},getLineHandle:function(da){if(bz(da)){return cQ(da)}},setLine:ay(function(da,db){if(bz(da)){bZ(db,{line:da,ch:0},{line:da,ch:cQ(da).text.length})}}),removeLine:ay(function(da){if(bz(da)){bZ("",{line:da,ch:0},a0({line:da+1,ch:0}))}}),replaceRange:ay(bZ),getRange:function(db,da){return cZ(a0(db),a0(da))},triggerOnKeyDown:ay(cl),execCommand:function(da){return R[da](ci)},moveH:ay(cP),deleteH:ay(cw),moveV:ay(cI),toggleOverwrite:function(){if(cx){cx=false;bk.className=bk.className.replace(" CodeMirror-overwrite","")}else{cx=true;bk.className+=" CodeMirror-overwrite"}},posFromIndex:function(db){var dc=0,da;cJ.iter(0,cJ.size,function(dd){var de=dd.text.length+1;if(de>db){da=db;return true}db-=de;++dc});return a0({line:dc,ch:da})},indexFromPos:function(db){if(db.line<0||db.ch<0){return 0}var da=db.ch;cJ.iter(0,db.line,function(dc){da+=dc.text.length+1});return da},scrollTo:function(da,db){if(da!=null){bs.scrollLeft=da}if(db!=null){bs.scrollTop=db}cn([])},operation:function(da){return ay(da)()},compoundChange:function(da){return bX(da)},refresh:function(){cn(true);if(bs.scrollHeight>bO){bs.scrollTop=bO}},getInputField:function(){return bu},getWrapperElement:function(){return aK},getScrollerElement:function(){return bs},getGutterElement:function(){return aO}};function cQ(da){return I(cJ,da)}function ba(db,da){aZ=true;var dc=da-db.height;for(var dd=db;dd;dd=dd.parent){dd.height+=dc}}function a3(da){var db={line:0,ch:0};aV(db,{line:cJ.size-1,ch:cQ(cJ.size-1).text.length},G(da),db,db);cz=true}function cb(){var da=[];cJ.iter(0,cJ.size,function(db){da.push(db.text)});return da.join("\n")}function cu(dj){bb(E(dj,"shiftKey"));for(var de=m(dj);de!=aK;de=de.parentNode){if(de.parentNode==bV&&de!=cq){return}}for(var de=m(dj);de!=aK;de=de.parentNode){if(de.parentNode==a5){if(ca.onGutterClick){ca.onGutterClick(ci,u(a5.childNodes,de)+c1,dj)}return Z(dj)}}var da=a9(dj);switch(D(dj)){case 3:if(T&&!S){a8(dj)}return;case 2:if(da){be(da.line,da.ch,true)}setTimeout(bI,20);return}if(!da){if(m(dj)==bs){Z(dj)}return}if(!ct){c5()}var db=+new Date;if(a6&&a6.time>db-400&&aj(a6.pos,da)){Z(dj);setTimeout(bI,20);return aR(da.line)}else{if(by&&by.time>db-400&&aj(by.pos,da)){a6={time:db,pos:da};Z(dj);return bR(da)}else{by={time:db,pos:da}}}var dl=da,dc;if(ca.dragDrop&&L&&!ca.readOnly&&!aj(c7.from,c7.to)&&!af(da,c7.from)&&!af(c7.to,da)){if(g){bC.draggable=true}function df(dm){if(g){bC.draggable=false}bj=false;di();dd();if(Math.abs(dj.clientX-dm.clientX)+Math.abs(dj.clientY-dm.clientY)<10){Z(dm);be(da.line,da.ch,true);bI()}}var di=v(document,"mouseup",ay(df),true);var dd=v(bs,"drop",ay(df),true);bj=true;if(bC.dragDrop){bC.dragDrop()}return}Z(dj);be(da.line,da.ch,true);function dk(dm){var dp=a9(dm,true);if(dp&&!aj(dp,dl)){if(!ct){c5()}dl=dp;bG(da,dp);cz=false;var dn=bJ();if(dp.line>=dn.to||dp.line<dn.from){dc=setTimeout(ay(function(){dk(dm)}),150)}}}function dh(dm){clearTimeout(dc);var dn=a9(dm);if(dn){bG(da,dn)}Z(dm);bI();cz=true;dg();di()}var dg=v(document,"mousemove",ay(function(dm){clearTimeout(dc);Z(dm);if(!O&&!D(dm)){dh(dm)}else{dk(dm)}}),true);var di=v(document,"mouseup",ay(dh),true)}function b5(da){for(var dc=m(da);dc!=aK;dc=dc.parentNode){if(dc.parentNode==a5){return Z(da)}}var db=a9(da);if(!db){return}a6={time:+new Date,pos:db};Z(da);bR(db)}function au(de){if(ca.onDragEvent&&ca.onDragEvent(ci,U(de))){return}de.preventDefault();var dh=a9(de,true),db=de.dataTransfer.files;if(!dh||ca.readOnly){return}if(db&&db.length&&window.FileReader&&window.File){function dd(dk,dj){var di=new FileReader;di.onload=function(){df[dj]=di.result;if(++dc==dg){dh=a0(dh);ay(function(){var dl=bZ(df.join(""),dh,dh);bG(dh,dl)})()}};di.readAsText(dk)}var dg=db.length,df=Array(dg),dc=0;for(var da=0;da<dg;++da){dd(db[da],da)}}else{try{var df=de.dataTransfer.getData("Text");if(df){bX(function(){var dj=c7.from,di=c7.to;bG(dh,dh);if(bj){bZ("",dj,di)}bA(df);bI()})}}catch(de){}}}function aP(dc){var da=cc();dc.dataTransfer.setData("Text",da);if(T||al){var db=document.createElement("img");db.scr="data:image/gif;base64,R0lGODdhAgACAIAAAAAAAP///ywAAAAAAgACAAACAoRRADs=";dc.dataTransfer.setDragImage(db,0,0)}}function bq(dc,da){if(typeof dc=="string"){dc=R[dc];if(!dc){return false}}var db=cs;try{if(ca.readOnly){cC=true}if(da){cs=null}dc(ci)}catch(dd){if(dd!=ah){throw dd}return false}finally{cs=db;cC=false}return true}function cW(dg){var da=c(ca.keyMap),dd=da.auto;clearTimeout(bK);if(dd&&!W(dg)){bK=setTimeout(function(){if(c(ca.keyMap)==da){ca.keyMap=(dd.call?dd.call(null,ci):dd)}},50)}var db=X[E(dg,"keyCode")],df=false;if(db==null||dg.altGraphKey){return false}if(E(dg,"altKey")){db="Alt-"+db}if(E(dg,"ctrlKey")){db="Ctrl-"+db}if(E(dg,"metaKey")){db="Cmd-"+db}var de=false;function dc(){de=true}if(E(dg,"shiftKey")){df=o("Shift-"+db,ca.extraKeys,ca.keyMap,function(dh){return bq(dh,true)},dc)||o(db,ca.extraKeys,ca.keyMap,function(dh){if(typeof dh=="string"&&/^go[A-Z]/.test(dh)){return bq(dh)}},dc)}else{df=o(db,ca.extraKeys,ca.keyMap,bq,dc)}if(de){df=false}if(df){Z(dg);cX();if(O){dg.oldKeyCode=dg.keyCode;dg.keyCode=0}}return df}function b7(dc,da){var db=o("'"+da+"'",ca.extraKeys,ca.keyMap,function(dd){return bq(dd,true)});if(db){Z(dc);cX()}return db}var cT=null,bK;function cl(dc){if(!ct){c5()}if(O&&dc.keyCode==27){dc.returnValue=false}if(bB){if(bT()){bB=false}}if(ca.onKeyEvent&&ca.onKeyEvent(ci,U(dc))){return}var da=E(dc,"keyCode");if(dc.ctrlKey&&(da==70)){if(typeof(_hlCtrlFWarning)=="function"){dc.preventDefault();_hlCtrlFWarning()}}bb(da==16||E(dc,"shiftKey"));var db=cW(dc);if(window.opera){cT=db?da:null;if(!db&&da==88&&E(dc,S?"metaKey":"ctrlKey")){bA("")}}}function bv(dd){if(bB){bT()}if(ca.onKeyEvent&&ca.onKeyEvent(ci,U(dd))){return}var dc=E(dd,"keyCode"),da=E(dd,"charCode");if(window.opera&&dc==cT){cT=null;Z(dd);return}if(((window.opera&&(!dd.which||dd.which<10))||p)&&cW(dd)){return}var db=String.fromCharCode(da==null?dc:da);if(ca.electricChars&&ck.electricChars&&ca.smartIndent&&!ca.readOnly){if(ck.electricChars.indexOf(db)>-1){setTimeout(ay(function(){bH(c7.to.line,"smart")}),75)}}if(b7(dd,db)){return}aX()}function cv(da){if(ca.onKeyEvent&&ca.onKeyEvent(ci,U(da))){return}if(E(da,"keyCode")==16){cs=null}}function c5(){if(ca.readOnly=="nocursor"){return}if(!ct){if(ca.onFocus){ca.onFocus(ci)}ct=true;if(aK.className.search(/\bCodeMirror-focused\b/)==-1){aK.className+=" CodeMirror-focused"}if(!bn){cN(true)}}at();cX()}function aL(){if(ct){if(ca.onBlur){ca.onBlur(ci)}ct=false;if(cd){ay(function(){if(cd){cd();cd=null}})()}aK.className=aK.className.replace(" CodeMirror-focused","")}clearInterval(c0);setTimeout(function(){if(!ct){cs=null}},150)}function aV(df,de,dd,db,da){if(cC){return}if(bg){var dc=[];cJ.iter(df.line,de.line+1,function(dg){dc.push(dg.text)});bg.addChange(df.line,dd.length,dc);while(bg.done.length>ca.undoDepth){bg.done.shift()}}az(df,de,dd,db,da)}function cj(df,dg){if(!df.length){return}var dh=df.pop(),db=[];for(var dc=dh.length-1;dc>=0;dc-=1){var de=dh[dc];var di=[],da=de.start+de.added;cJ.iter(de.start,da,function(dj){di.push(dj.text)});db.push({start:de.start,added:de.old.length,old:di});var dd=a0({line:de.start+de.old.length-1,ch:ac(di[di.length-1],de.old[de.old.length-1])});az({line:de.start,ch:0},{line:da-1,ch:cQ(da-1).text.length},de.old,dd,dd)}cz=true;dg.push(db)}function c4(){cj(bg.done,bg.undone)}function cU(){cj(bg.undone,bg.done)}function az(dq,de,dw,da,dx){if(cC){return}var dv=false,dd=bM.length;if(!ca.lineWrapping){cJ.iter(dq.line,de.line+1,function(dy){if(!dy.hidden&&dy.text.length==dd){dv=true;return true}})}if(dq.line!=de.line||dw.length>1){aZ=true}var dm=de.line-dq.line,dl=cQ(dq.line),db=cQ(de.line);if(dq.ch==0&&de.ch==0&&dw[dw.length-1]==""){var dj=[],dk=null;if(dq.line){dk=cQ(dq.line-1);dk.fixMarkEnds(db)}else{db.fixMarkStarts()}for(var ds=0,du=dw.length-1;ds<du;++ds){dj.push(f.inheritMarks(dw[ds],dk))}if(dm){cJ.remove(dq.line,dm,cL)}if(dj.length){cJ.insert(dq.line,dj)}}else{if(dl==db){if(dw.length==1){dl.replace(dq.ch,de.ch,dw[0])}else{db=dl.split(de.ch,dw[dw.length-1]);dl.replace(dq.ch,null,dw[0]);dl.fixMarkEnds(db);var dj=[];for(var ds=1,du=dw.length-1;ds<du;++ds){dj.push(f.inheritMarks(dw[ds],dl))}dj.push(db);cJ.insert(dq.line+1,dj)}}else{if(dw.length==1){dl.replace(dq.ch,null,dw[0]);db.replace(null,de.ch,"");dl.append(db);cJ.remove(dq.line+1,dm,cL)}else{var dj=[];dl.replace(dq.ch,null,dw[0]);db.replace(null,de.ch,dw[dw.length-1]);dl.fixMarkEnds(db);for(var ds=1,du=dw.length-1;ds<du;++ds){dj.push(f.inheritMarks(dw[ds],dl))}if(dm>1){cJ.remove(dq.line+1,dm-1,cL)}cJ.insert(dq.line+1,dj)}}}if(ca.lineWrapping){var dg=Math.max(5,bs.clientWidth/bp()-3);cJ.iter(dq.line,dq.line+dw.length,function(dy){if(dy.hidden){return}var dz=Math.ceil(dy.text.length/dg)||1;if(dz!=dy.height){ba(dy,dz)}})}else{cJ.iter(dq.line,dq.line+dw.length,function(dz){var dy=dz.text;if(!dz.hidden&&dy.length>dd){bM=dy;dd=dy.length;aM=null;dv=false}});if(dv){cm=true}}var dc=[],di=dw.length-dm-1;for(var ds=0,dp=cr.length;ds<dp;++ds){var dt=cr[ds];if(dt<dq.line){dc.push(dt)}else{if(dt>de.line){dc.push(dt+di)}}}var dr=dq.line+Math.min(dw.length,500);cS(dq.line,dr);dc.push(dr);cr=dc;bP(100);aI.push({from:dq.line,to:de.line+1,diff:di});var dh={from:dq,to:de,text:dw};if(cY){for(var df=cY;df.next;df=df.next){}df.next=dh}else{cY=dh}function dn(dy){return dy<=Math.min(de.line,de.line+di)?dy:dy+di}bE(da,dx,dn(c7.from.line),dn(c7.to.line));if(bs.clientHeight){bV.style.height=(cJ.height*bY()+2*cB())+"px"}}function bF(){var da=0;bM="";aM=null;cJ.iter(0,cJ.size,function(dc){var db=dc.text;if(!dc.hidden&&db.length>da){da=db.length;bM=db}});cm=false}function bZ(db,de,dd){de=a0(de);if(!dd){dd=de}else{dd=a0(dd)}db=G(db);function dc(dh){if(af(dh,de)){return dh}if(!af(dd,dh)){return da}var df=dh.line+db.length-(dd.line-de.line)-1;var dg=dh.ch;if(dh.line==dd.line){dg+=db[db.length-1].length-(dd.ch-(dd.line==de.line?de.ch:0))}return{line:df,ch:dg}}var da;aJ(db,de,dd,function(df){da=df;return{from:dc(c7.from),to:dc(c7.to)}});return da}function bA(da,db){aJ(G(da),c7.from,c7.to,function(dc){if(db=="end"){return{from:dc,to:dc}}else{if(db=="start"){return{from:c7.from,to:c7.from}}else{return{from:c7.from,to:dc}}}})}function aJ(dd,df,de,da){var dc=dd.length==1?dd[0].length+df.ch:dd[dd.length-1].length;var db=da({line:df.line+dd.length-1,ch:dc});aV(df,de,dd,db.from,db.to)}function cZ(de,dd){var db=de.line,da=dd.line;if(db==da){return cQ(db).text.slice(de.ch,dd.ch)}var dc=[cQ(db).text.slice(de.ch)];cJ.iter(db+1,da,function(df){dc.push(df.text)});dc.push(cQ(da).text.slice(0,dd.ch));return dc.join("\n")}function cc(){return cZ(c7.from,c7.to)}function aH(){return c7.from}function bc(){return c7.to}var bB=false;function at(){if(bB){return}cg.set(ca.pollInterval,function(){aU();bT();if(ct){at()}aE()})}function aX(){var da=false;bB=true;function db(){aU();var dc=bT();if(!dc&&!da){da=true;cg.set(60,db)}else{bB=false;at()}aE()}cg.set(20,db)}var bi="";function bT(){if(bn||!ct||ak(bu)||ca.readOnly){return false}var db=bu.value;if(db==bi){return false}cs=null;var dc=0,da=Math.min(bi.length,db.length);while(dc<da&&bi[dc]==db[dc]){++dc}if(dc<bi.length){c7.from={line:c7.from.line,ch:c7.from.ch-(bi.length-dc)}}else{if(cx&&aj(c7.from,c7.to)){c7.to={line:c7.to.line,ch:Math.min(cQ(c7.to.line).text.length,c7.to.ch+(db.length-dc))}}}bA(db.slice(dc),"end");if(db.length>1000){bu.value=bi=""}else{bi=db}return true}function cN(da){if(!aj(c7.from,c7.to)){bi="";bu.value=cc();a(bu)}else{if(da){bi=bu.value=""}}}function bI(){if(ca.readOnly!="nocursor"){bu.focus()}}function c9(){if(!bk.getBoundingClientRect){return}var da=bk.getBoundingClientRect();if(O&&da.top==da.bottom){return}var db=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);if(da.top<0||da.bottom>db){bk.scrollIntoView()}}function cp(){var db=c2(c7.inverted?c7.from:c7.to);var da=ca.lineWrapping?Math.min(db.x,bC.offsetWidth):db.x;return aG(da,db.y,da,db.yBot)}function aG(dc,di,da,dh){var df=bd(),dn=cB();di+=dn;dh+=dn;dc+=df;da+=df;var dk=bs.clientHeight,dd=bs.scrollTop,db=false,dm=true;if(di<dd){bs.scrollTop=Math.max(0,di);db=true}else{if(dh>dd+dk){bs.scrollTop=dh-dk;db=true}}var dj=bs.clientWidth,dl=bs.scrollLeft;var dg=ca.fixedGutter?aO.clientWidth:0;var de=dc<dg+df+10;if(dc<dl+dg||de){if(de){dc=0}bs.scrollLeft=Math.max(0,dc-10-dg);db=true}else{if(da>dj+dl-3){bs.scrollLeft=da+10-dj;db=true;if(da>bV.clientWidth){dm=false}}}if(db&&ca.onScroll){ca.onScroll(ci)}return dm}function bJ(){var da=bY(),dd=bs.scrollTop-cB();var dc=Math.max(0,Math.floor(dd/da));var db=Math.ceil((dd+bs.clientHeight)/da);return{from:ad(cJ,dc),to:ad(cJ,db)}}function cn(di,de){if(!bs.clientWidth){c1=bU=bl=0;return}var dd=bJ();if(di!==true&&di.length==0&&dd.from>c1&&dd.to<bU){return}var dj=Math.max(dd.from-100,0),dk=Math.min(cJ.size,dd.to+100);if(c1<dj&&dj-c1<20){dj=c1}if(bU>dk&&bU-dk<20){dk=Math.min(cJ.size,bU)}var dm=di===true?[]:b9([{from:c1,to:bU,domStart:0}],di);var dh=0;for(var df=0;df<dm.length;++df){var dg=dm[df];if(dg.from<dj){dg.domStart+=(dj-dg.from);dg.from=dj}if(dg.to>dk){dg.to=dk}if(dg.from>=dg.to){dm.splice(df--,1)}else{dh+=dg.to-dg.from}}if(dh==dk-dj&&dj==c1&&dk==bU){return}dm.sort(function(dp,dn){return dp.domStart-dn.domStart});var dc=bY(),da=aO.style.display;ax.style.display="none";aY(dj,dk,dm);ax.style.display=aO.style.display="";var db=dj!=c1||dk!=bU||bW!=bs.clientHeight+dc;if(db){bW=bs.clientHeight+dc}c1=dj;bU=dk;bl=h(cJ,dj);cq.style.top=(bl*dc)+"px";if(bs.clientHeight){bV.style.height=(cJ.height*dc+2*cB())+"px"}if(ax.childNodes.length!=bU-c1){throw new Error("BAD PATCH! "+JSON.stringify(dm)+" size="+(bU-c1)+" nodes="+ax.childNodes.length)}function dl(){aM=bs.clientWidth;var dp=ax.firstChild,dn=false;cJ.iter(c1,bU,function(dr){if(!dr.hidden){var dq=Math.round(dp.offsetHeight/dc)||1;if(dr.height!=dq){ba(dr,dq);aZ=dn=true}}dp=dp.nextSibling});if(dn){bV.style.height=(cJ.height*dc+2*cB())+"px"}return dn}if(ca.lineWrapping){dl()}else{if(aM==null){aM=cD(bM)}if(aM>bs.clientWidth){bC.style.width=aM+"px";bV.style.width="";bV.style.width=bs.scrollWidth+"px"}else{bC.style.width=bV.style.width=""}}aO.style.display=da;if(db||aZ){aS()&&ca.lineWrapping&&dl()&&aS()}c6();if(!de&&ca.onUpdate){ca.onUpdate(ci)}return true}function b9(dj,dh){for(var de=0,dc=dh.length||0;de<dc;++de){var dg=dh[de],da=[],di=dg.diff||0;for(var dd=0,db=dj.length;dd<db;++dd){var df=dj[dd];if(dg.to<=df.from&&dg.diff){da.push({from:df.from+di,to:df.to+di,domStart:df.domStart})}else{if(dg.to<=df.from||dg.from>=df.to){da.push(df)}else{if(dg.from>df.from){da.push({from:df.from,to:dg.from,domStart:df.domStart})}if(dg.to<df.to){da.push({from:dg.to+di,to:df.to+di,domStart:df.domStart+(dg.to-df.from)})}}}}dj=da}return dj}function aY(dj,dk,dm){if(!dm.length){ax.innerHTML=""}else{function da(dp){var dn=dp.nextSibling;dp.parentNode.removeChild(dp);return dn}var de=0,dc=ax.firstChild,db;for(var df=0;df<dm.length;++df){var dl=dm[df];while(dl.domStart>de){dc=da(dc);de++}for(var dd=0,dh=dl.to-dl.from;dd<dh;++dd){dc=dc.nextSibling;de++}}while(dc){dc=da(dc)}}var dg=dm.shift(),dc=ax.firstChild,dd=dj;var di=document.createElement("div");cJ.iter(dj,dk,function(dn){if(dg&&dg.to==dd){dg=dm.shift()}if(!dg||dg.from>dd){if(dn.hidden){var dp=di.innerHTML="<pre></pre>"}else{var dp="<pre"+(dn.className?' class="'+dn.className+'"':"")+">"+dn.getHTML(bh)+"</pre>";if(dn.bgClassName){dp='<div style="position: relative"><pre class="'+dn.bgClassName+'" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2">&#160;</pre>'+dp+"</div>"}}di.innerHTML=dp;ax.insertBefore(di.firstChild,dc)}else{dc=dc.nextSibling}++dd})}function aS(){if(!ca.gutter&&!ca.lineNumbers){return}var db=cq.offsetHeight,dj=bs.clientHeight;aO.style.height=(db-dj<2?dj:db)+"px";var dh=[],df=c1,di;cJ.iter(c1,Math.max(bU,c1+1),function(dl){if(dl.hidden){dh.push("<pre></pre>")}else{var dk=dl.gutterMarker;var dn=ca.lineNumbers?df+ca.firstLineNumber:null;if(dk&&dk.text){dn=dk.text.replace("%N%",dn!=null?dn:"")}else{if(dn==null){dn="\u00a0"}}dh.push((dk&&dk.style?'<pre class="'+dk.style+'">':"<pre>"),dn);for(var dm=1;dm<dl.height;++dm){dh.push("<br/>&#160;")}dh.push("</pre>");if(!dk){di=df}}++df});aO.style.display="none";a5.innerHTML=dh.join("");if(di!=null){var dd=a5.childNodes[di-c1];var de=String(cJ.size).length,da=N(dd),dc="";while(da.length+dc.length<de){dc+="\u00a0"}if(dc){dd.insertBefore(document.createTextNode(dc),dd.firstChild)}}aO.style.display="";var dg=Math.abs((parseInt(bC.style.marginLeft)||0)-aO.offsetWidth)>2;bC.style.marginLeft=aO.offsetWidth+"px";aZ=false;return dg}function c6(){var dd=aj(c7.from,c7.to);var dp=c2(c7.from,true);var dj=dd?dp:c2(c7.to,true);var dh=c7.inverted?dp:dj,db=bY();var da=aq(aK),dc=aq(ax);b6.style.top=Math.max(0,Math.min(bs.offsetHeight,dh.y+dc.top-da.top))+"px";b6.style.left=Math.max(0,Math.min(bs.offsetWidth,dh.x+dc.left-da.left))+"px";if(dd){bk.style.top=dh.y+"px";bk.style.left=(ca.lineWrapping?Math.min(dh.x,bC.offsetWidth):dh.x)+"px";bk.style.display="";bo.style.display="none"}else{var dm=dp.y==dj.y,df="";var dk=bC.clientWidth||bC.offsetWidth;var dg=bC.clientHeight||bC.offsetHeight;function dn(du,dt,ds,dq){var dr=K?"width: "+(!ds?dk:dk-ds-du)+"px":"right: "+ds+"px";df+='<div class="CodeMirror-selected" style="position: absolute; left: '+du+"px; top: "+dt+"px; "+dr+"; height: "+dq+'px"></div>'}if(c7.from.ch&&dp.y>=0){var dl=dm?dk-dj.x:0;dn(dp.x,dp.y,dl,db)}var de=Math.max(0,dp.y+(c7.from.ch?db:0));var di=Math.min(dj.y,dg)-de;if(di>0.2*db){dn(0,de,0,di)}if((!dm||!c7.from.ch)&&dj.y<dg-0.5*db){dn(0,dj.y,dk-dj.x,db)}bo.innerHTML=df;bk.style.display="none";bo.style.display=""}}function bb(da){if(da){cs=cs||(c7.inverted?c7.to:c7.from)}else{cs=null}}function bG(dc,db){var da=cs&&a0(cs);if(da){if(af(da,dc)){dc=da}else{if(af(db,da)){db=da}}}bE(dc,db);cf=true}function bE(dh,dg,da,df){cF=null;if(da==null){da=c7.from.line;df=c7.to.line}if(aj(c7.from,dh)&&aj(c7.to,dg)){return}if(af(dg,dh)){var dd=dg;dg=dh;dh=dd}if(dh.line!=da){var de=b0(dh,da,c7.from.ch);if(!de){cV(dh.line,false)}else{dh=de}}if(dg.line!=df){dg=b0(dg,df,c7.to.ch)}if(aj(dh,dg)){c7.inverted=false}else{if(aj(dh,c7.to)){c7.inverted=false}else{if(aj(dg,c7.from)){c7.inverted=true}}}if(ca.autoClearEmptyLines&&aj(c7.from,c7.to)){var dc=c7.inverted?dh:dg;if(dc.line!=c7.from.line&&c7.from.line<cJ.size){var db=cQ(c7.from.line);if(/^\s+$/.test(db.text)){setTimeout(ay(function(){if(db.parent&&/^\s+$/.test(db.text)){var di=ae(db);bZ("",{line:di,ch:0},{line:di,ch:db.text.length})}},10))}}}c7.from=dh;c7.to=dg;aW=true}function b0(df,db,dc){function de(di){var dk=df.line+di,dh=di==1?cJ.size:-1;while(dk!=dh){var dg=cQ(dk);if(!dg.hidden){var dj=df.ch;if(dd||dj>dc||dj>dg.text.length){dj=dg.text.length}return{line:dk,ch:dj}}dk+=di}}var da=cQ(df.line);var dd=df.ch==da.text.length&&df.ch!=dc;if(!da.hidden){return df}if(df.line>=db){return de(1)||de(-1)}else{return de(-1)||de(1)}}function be(da,dc,db){var dd=a0({line:da,ch:dc||0});(db?bG:bE)(dd,dd)}function b8(da){return Math.max(0,Math.min(da,cJ.size-1))}function a0(dc){if(dc.line<0){return{line:0,ch:0}}if(dc.line>=cJ.size){return{line:cJ.size-1,ch:cQ(cJ.size-1).text.length}}var da=dc.ch,db=cQ(dc.line).text.length;if(da==null||da>db){return{line:dc.line,ch:db}}else{if(da<0){return{line:dc.line,ch:0}}else{return dc}}}function cy(dd,dh){var de=c7.inverted?c7.from:c7.to,di=de.line,da=de.ch;var dg=cQ(di);function db(){for(var dj=di+dd,dl=dd<0?-1:cJ.size;dj!=dl;dj+=dd){var dk=cQ(dj);if(!dk.hidden){di=dj;dg=dk;return true}}}function df(dj){if(da==(dd<0?0:dg.text.length)){if(!dj&&db()){da=dd<0?dg.text.length:0}else{return false}}else{da+=dd}return true}if(dh=="char"){df()}else{if(dh=="column"){df(true)}else{if(dh=="word"){var dc=false;for(;;){if(dd<0){if(!df()){break}}if(am(dg.text.charAt(da))){dc=true}else{if(dc){if(dd<0){dd=1;df()}break}}if(dd>0){if(!df()){break}}}}}}return{line:di,ch:da}}function cP(da,db){var dc=da<0?c7.from:c7.to;if(cs||aj(c7.from,c7.to)){dc=cy(da,db)}be(dc.line,dc.ch,true)}function cw(da,db){if(!aj(c7.from,c7.to)){bZ("",c7.from,c7.to)}else{if(da<0){bZ("",cy(da,db),c7.to)}else{bZ("",c7.from,cy(da,db))}}cf=true}var cF=null;function cI(da,db){var dd=0,de=c2(c7.inverted?c7.from:c7.to,true);if(cF!=null){de.x=cF}if(db=="page"){dd=Math.min(bs.clientHeight,window.innerHeight||document.documentElement.clientHeight)}else{if(db=="line"){dd=bY()}}var dc=bQ(de.x,de.y+dd*da+2);if(db=="page"){bs.scrollTop+=c2(dc,true).y-de.y}be(dc.line,dc.ch,true);cF=de.x}function bR(dd){var db=cQ(dd.line).text;var dc=dd.ch,da=dd.ch;while(dc>0&&am(db.charAt(dc-1))){--dc}while(da<db.length&&am(db.charAt(da))){++da}bG({line:dd.line,ch:dc},{line:dd.line,ch:da})}function aR(da){bG({line:da,ch:0},a0({line:da+1,ch:0}))}function cM(dc){if(aj(c7.from,c7.to)){return bH(c7.from.line,dc)}var db=c7.to.line-(c7.to.ch?0:1);for(var da=c7.from.line;da<=db;++da){bH(da,dc)}}function bH(dc,dj){if(!dj){dj="add"}if(dj=="smart"){if(!ck.indent){dj="prev"}else{var da=cE(dc)}}var dk=cQ(dc),de=dk.indentation(ca.tabSize),db=dk.text.match(/^\s*/)[0],dg;if(dj=="prev"){if(dc){dg=cQ(dc-1).indentation(ca.tabSize)}else{dg=0}}else{if(dj=="smart"){dg=ck.indent(da,dk.text.slice(db.length),dk.text)}else{if(dj=="add"){dg=de+ca.indentUnit}else{if(dj=="subtract"){dg=de-ca.indentUnit}}}}dg=Math.max(0,dg);var di=dg-de;if(!di){if(c7.from.line!=dc&&c7.to.line!=dc){return}var dh=db}else{var dh="",df=0;if(ca.indentWithTabs){for(var dd=Math.floor(dg/ca.tabSize);dd;--dd){df+=ca.tabSize;dh+="\t"}}while(df<dg){++df;dh+=" "}}bZ(dh,{line:dc,ch:0},{line:dc,ch:db.length})}function b2(){ck=A.getMode(ca,ca.mode);cJ.iter(0,cJ.size,function(da){da.stateAfter=null});cr=[0];bP()}function bm(){var da=ca.gutter||ca.lineNumbers;aO.style.display=da?"":"none";if(da){aZ=true}else{ax.parentNode.style.marginLeft=0}}function cR(dc,db){if(ca.lineWrapping){aK.className+=" CodeMirror-wrap";var da=bs.clientWidth/bp()-3;cJ.iter(0,cJ.size,function(dd){if(dd.hidden){return}var de=Math.ceil(dd.text.length/da)||1;if(de!=1){ba(dd,de)}});bC.style.width=bV.style.width=""}else{aK.className=aK.className.replace(" CodeMirror-wrap","");aM=null;bM="";cJ.iter(0,cJ.size,function(dd){if(dd.height!=1&&!dd.hidden){ba(dd,1)}if(dd.text.length>bM.length){bM=dd.text}})}aI.push({from:0,to:cJ.size})}function bh(db){var da=ca.tabSize-db%ca.tabSize,dd=aw[da];if(dd){return dd}for(var de='<span class="cm-tab">',dc=0;dc<da;++dc){de+=" "}return(aw[da]={html:de+"</span>",width:da})}function cO(){bs.className=bs.className.replace(/\s*cm-s-\S+/g,"")+ca.theme.replace(/(^|\s)\s*/g," cm-s-")}function cG(){var da=B[ca.keyMap].style;aK.className=aK.className.replace(/\s*cm-keymap-\S+/g,"")+(da?" cm-keymap-"+da:"")}function c8(){this.set=[]}c8.prototype.clear=ay(function(){var df=Infinity,db=-Infinity;for(var de=0,dh=this.set.length;de<dh;++de){var dc=this.set[de],da=dc.marked;if(!da||!dc.parent){continue}var dg=ae(dc);df=Math.min(df,dg);db=Math.max(db,dg);for(var dd=0;dd<da.length;++dd){if(da[dd].marker==this){da.splice(dd--,1)}}}if(df!=Infinity){aI.push({from:df,to:db+1})}});c8.prototype.find=function(){var df,dg;for(var dc=0,de=this.set.length;dc<de;++dc){var di=this.set[dc],dd=di.marked;for(var db=0;db<dd.length;++db){var da=dd[db];if(da.marker==this){if(da.from!=null||da.to!=null){var dh=ae(di);if(dh!=null){if(da.from!=null){df={line:dh,ch:da.from}}if(da.to!=null){dg={line:dh,ch:da.to}}}}}}}return{from:df,to:dg}};function bN(dg,df,dc){dg=a0(dg);df=a0(df);var da=new c8();if(!af(dg,df)){return da}function de(dh,dk,dj,di){cQ(dh).addMark(new Q(dk,dj,di,da))}if(dg.line==df.line){de(dg.line,dg.ch,df.ch,dc)}else{de(dg.line,dg.ch,null,dc);for(var db=dg.line+1,dd=df.line;db<dd;++db){de(db,null,null,dc)}de(df.line,null,df.ch,dc)}aI.push({from:dg.line,to:df.line+1});return da}function a1(db){db=a0(db);var da=new M(db.ch);cQ(db.line).addMark(da);return da}function bw(df){df=a0(df);var de=[],dc=cQ(df.line).marked;if(!dc){return de}for(var db=0,dd=dc.length;db<dd;++db){var da=dc[db];if((da.from==null||da.from<=df.ch)&&(da.to==null||da.to>=df.ch)){de.push(da.marker||da)}}return de}function b4(da,dc,db){if(typeof da=="number"){da=cQ(b8(da))}da.gutterMarker={text:dc,style:db};aZ=true;return da}function aA(da){if(typeof da=="number"){da=cQ(b8(da))}da.gutterMarker=null;aZ=true}function a4(db,dd){var dc=db,da=db;if(typeof db=="number"){da=cQ(b8(db))}else{dc=ae(db)}if(dc==null){return null}if(dd(da,dc)){aI.push({from:dc,to:dc+1})}else{return null}return da}function bt(db,da,dc){return a4(db,function(dd){if(dd.className!=da||dd.bgClassName!=dc){dd.className=da;dd.bgClassName=dc;return true}})}function cV(db,da){return a4(db,function(dd,dg){if(dd.hidden!=da){dd.hidden=da;if(!ca.lineWrapping){var dc=dd.text;if(da&&dc.length==bM.length){cm=true}else{if(!da&&dc.length>bM.length){bM=dc;aM=null;cm=false}}}ba(dd,da?0:1);var df=c7.from.line,de=c7.to.line;if(da&&(df==dg||de==dg)){var di=df==dg?b0({line:df,ch:0},df,0):c7.from;var dh=de==dg?b0({line:de,ch:0},de,0):c7.to;if(!dh){return}bE(di,dh)}return(aZ=true)}})}function a2(db){if(typeof db=="number"){if(!bz(db)){return null}var dc=db;db=cQ(db);if(!db){return null}}else{var dc=ae(db);if(dc==null){return null}}var da=db.gutterMarker;return{line:dc,handle:db,text:db.text,markerText:da&&da.text,markerClass:da&&da.style,lineClass:db.className,bgClass:db.bgClassName}}function cD(da){aB.innerHTML="<pre><span>x</span></pre>";aB.firstChild.firstChild.firstChild.nodeValue=da;return aB.firstChild.firstChild.offsetWidth||10}function aN(dm,dg){if(dg<=0){return 0}var dd=cQ(dm),dj=dd.text;function dk(dn){return ce(dd,dn).left}var dh=0,df=0,di=dj.length,de;var db=Math.min(di,Math.ceil(dg/bp()));for(;;){var dc=dk(db);if(dc<=dg&&db<di){db=Math.min(di,Math.ceil(db*1.2))}else{de=dc;di=db;break}}if(dg>de){return di}db=Math.floor(di*0.8);dc=dk(db);if(dc<dg){dh=db;df=dc}for(;;){if(di-dh<=1){return(de-dg>dg-df)?dh:di}var dl=Math.ceil((dh+di)/2),da=dk(dl);if(da>dg){di=dl;de=da}else{dh=dl;df=da}}}var cK="CodeMirror-temp-"+Math.floor(Math.random()*16777215).toString(16);function ce(db,de){if(de==0){return{top:0,left:0}}var da=ca.lineWrapping&&de<db.text.length&&s.test(db.text.slice(de-1,de+1));aB.innerHTML="<pre>"+db.getHTML(bh,de,cK,da)+"</pre>";var dd=document.getElementById(cK);var dg=dd.offsetTop,df=dd.offsetLeft;if(O&&dg==0&&df==0){var dc=document.createElement("span");dc.innerHTML="x";dd.parentNode.insertBefore(dc,dd.nextSibling);dg=dc.offsetTop}return{top:dg,left:df}}function c2(df,dd){var da,db=bY(),de=db*(h(cJ,df.line)-(dd?bl:0));if(df.ch==0){da=0}else{var dc=ce(cQ(df.line),df.ch);da=dc.left;if(ca.lineWrapping){de+=Math.max(0,dc.top)}}return{x:da,y:de,yBot:de+db}}function bQ(dj,di){if(di<0){di=0}var dg=bY(),de=bp(),dq=bl+Math.floor(di/dg);var dk=ad(cJ,dq);if(dk>=cJ.size){return{line:cJ.size-1,ch:cQ(cJ.size-1).text.length}}var db=cQ(dk),dm=db.text;var ds=ca.lineWrapping,dh=ds?dq-h(cJ,dk):0;if(dj<=0&&dh==0){return{line:dk,ch:0}}function dr(du){var dv=ce(db,du);if(ds){var dw=Math.round(dv.top/dg);return Math.max(0,dv.left+(dw-dh)*bs.clientWidth)}return dv.left}var dp=0,dn=0,dc=dm.length,da;var dl=Math.min(dc,Math.ceil((dj+dh*bs.clientWidth*0.9)/de));for(;;){var df=dr(dl);if(df<=dj&&dl<dc){dl=Math.min(dc,Math.ceil(dl*1.2))}else{da=df;dc=dl;break}}if(dj>da){return{line:dk,ch:dc}}dl=Math.floor(dc*0.8);df=dr(dl);if(df<dj){dp=dl;dn=df}for(;;){if(dc-dp<=1){return{line:dk,ch:(da-dj>dj-dn)?dp:dc}}var dt=Math.ceil((dp+dc)/2),dd=dr(dt);if(dd>dj){dc=dt;da=dd}else{dp=dt;dn=dd}}}function av(dc){var da=c2(dc,true),db=aq(bC);return{x:db.left+da.x,y:db.top+da.y,yBot:db.top+da.yBot}}var a7,aD,b3;function bY(){if(b3==null){b3="<pre>";for(var db=0;db<49;++db){b3+="x<br/>"}b3+="x</pre>"}var da=ax.clientHeight;if(da==aD){return a7}aD=da;aB.innerHTML=b3;a7=aB.firstChild.offsetHeight/50||1;aB.innerHTML="";return a7}var c3,bD=0;function bp(){if(bs.clientWidth==bD){return c3}bD=bs.clientWidth;return(c3=cD("x"))}function cB(){return bC.offsetTop}function bd(){return bC.offsetLeft}function a9(de,dd){var dc=aq(bs,true),da,df;try{da=de.clientX;df=de.clientY}catch(de){return null}if(!dd&&(da-dc.left>bs.clientWidth||df-dc.top>bs.clientHeight)){return null}var db=aq(bC,true);return bQ(da-db.left,df-db.top)}function a8(db){var dg=a9(db),df=bs.scrollTop;if(!dg||window.opera){return}if(aj(c7.from,c7.to)||af(dg,c7.from)||!af(dg,c7.to)){ay(be)(dg.line,dg.ch)}var de=bu.style.cssText;b6.style.position="absolute";bu.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(db.clientY-5)+"px; left: "+(db.clientX-5)+"px; z-index: 1000; background: white; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";bn=true;var dd=bu.value=cc();bI();a(bu);function da(){var dh=G(bu.value).join("\n");if(dh!=dd){ay(bA)(dh,"end")}b6.style.position="relative";bu.style.cssText=de;if(H){bs.scrollTop=df}bn=false;cN(true);at()}if(T){C(db);var dc=v(window,"mouseup",function(){dc();setTimeout(da,20)},true)}else{setTimeout(da,50)}}function cX(){clearInterval(c0);var da=true;bk.style.visibility="";c0=setInterval(function(){bk.style.visibility=(da=!da)?"":"hidden"},650)}var bx={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function co(dg){var da=c7.inverted?c7.from:c7.to,di=cQ(da.line),db=da.ch-1;var df=(db>=0&&bx[di.text.charAt(db)])||bx[di.text.charAt(++db)];if(!df){return}var dj=df.charAt(0),dh=df.charAt(1)==">",du=dh?1:-1,dp=di.styles;for(var dv=db+1,dr=0,dt=dp.length;dr<dt;dr+=2){if((dv-=dp[dr].length)<=0){var ds=dp[dr+1];break}}var dd=[di.text.charAt(db)],dn=/[(){}[\]]/;function dl(dH,dC,dD){if(!dH.text){return}var dG=dH.styles,dB=dh?0:dH.text.length-1,dE;for(var dy=dh?0:dG.length-2,dA=dh?dG.length:-2;dy!=dA;dy+=2*du){var dF=dG[dy];if(dG[dy+1]!=null&&dG[dy+1]!=ds){dB+=du*dF.length;continue}for(var dx=dh?0:dF.length-1,dw=dh?dF.length:-1;dx!=dw;dx+=du,dB+=du){if(dB>=dC&&dB<dD&&dn.test(dE=dF.charAt(dx))){var dz=bx[dE];if(dz.charAt(1)==">"==dh){dd.push(dE)}else{if(dd.pop()!=dz.charAt(0)){return{pos:dB,match:false}}else{if(!dd.length){return{pos:dB,match:true}}}}}}}}for(var dr=da.line,dt=dh?Math.min(dr+100,cJ.size):Math.max(-1,dr-100);dr!=dt;dr+=du){var di=cQ(dr),de=dr==da.line;var dk=dl(di,de&&dh?db+1:0,de&&!dh?db:di.text.length);if(dk){break}}if(!dk){dk={pos:null,match:false}}var ds=dk.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";var dq=bN({line:da.line,ch:db},{line:da.line,ch:db+1},ds),dc=dk.pos!=null&&bN({line:dr,ch:dk.pos},{line:dr,ch:dk.pos+1},ds);var dm=ay(function(){dq.clear();dc&&dc.clear()});if(dg){setTimeout(dm,800)}else{cd=dm}}function bf(dg){var df,dc;for(var db=dg,dd=dg-40;db>dd;--db){if(db==0){return 0}var da=cQ(db-1);if(da.stateAfter){return db}var de=da.indentation(ca.tabSize);if(dc==null||df>de){dc=db-1;df=de}}return dc}function cE(dc){var db=bf(dc),da=db&&cQ(db-1).stateAfter;if(!da){da=ab(ck)}else{da=t(ck,da)}cJ.iter(db,dc,function(dd){dd.highlight(ck,da,ca.tabSize);dd.stateAfter=t(ck,da)});if(db<dc){aI.push({from:db,to:dc})}if(dc<cJ.size&&!cQ(dc).stateAfter){cr.push(dc)}return da}function cS(dc,da){var db=cE(dc);cJ.iter(dc,da,function(dd){dd.highlight(ck,db,ca.tabSize);dd.stateAfter=t(ck,db)})}function b1(){var dg=+new Date+ca.workTime;var dj=cr.length;while(cr.length){if(!cQ(c1).stateAfter){var dd=c1}else{var dd=cr.pop()}if(dd>=cJ.size){continue}var db=bf(dd),da=db&&cQ(db-1).stateAfter;if(da){da=t(ck,da)}else{da=ab(ck)}var df=0,dc=ck.compareStates,di=false,dh=db,de=false;cJ.iter(dh,cJ.size,function(dl){var dm=dl.stateAfter;if(+new Date>dg){cr.push(dh);bP(ca.workDelay);if(di){aI.push({from:dd,to:dh+1})}return(de=true)}var dn=dl.highlight(ck,da,ca.tabSize);if(dn){di=true}dl.stateAfter=t(ck,da);var dk=null;if(dc){var dp=dm&&dc(dm,da);if(dp!=ah){dk=!!dp}}if(dk==null){if(dn!==false||!dm){df=0}else{if(++df>3&&(!ck.indent||ck.indent(dm,"")==ck.indent(da,""))){dk=true}}}if(dk){return true}++dh});if(de){return}if(di){aI.push({from:dd,to:dh+1})}}if(dj&&ca.onHighlightComplete){ca.onHighlightComplete(ci)}}function bP(da){if(!cr.length){return}aC.set(da,ay(b1))}function aU(){cz=cf=cY=null;aI=[];aW=false;cL=[]}function aE(){var de=false,db;if(cm){bF()}if(aW){de=!cp()}if(aI.length){db=cn(aI,true)}else{if(aW){c6()}if(aZ){aS()}}if(de){cp()}if(aW){c9();cX()}if(ct&&!bn&&(cz===true||(cz!==false&&aW))){cN(cf)}if(aW&&ca.matchBrackets){setTimeout(ay(function(){if(cd){cd();cd=null}if(aj(c7.from,c7.to)){co(false)}}),20)}var da=cY,dc=cL;if(aW&&ca.onCursorActivity){ca.onCursorActivity(ci)}if(da&&ca.onChange&&ci){ca.onChange(ci,da)}for(var dd=0;dd<dc.length;++dd){dc[dd](ci)}if(db&&ca.onUpdate){ca.onUpdate(ci)}}var cA=0;function ay(da){return function(){if(!cA++){aU()}try{var db=da.apply(this,arguments)}finally{if(!--cA){aE()}}return db}}function bX(da){bg.startCompound();try{return da()}finally{bg.endCompound()}}for(var bS in ai){if(ai.propertyIsEnumerable(bS)&&!ci.propertyIsEnumerable(bS)){ci[bS]=ai[bS]}}return ci}A.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:false,smartIndent:true,tabSize:4,keyMap:"default",extraKeys:null,electricChars:true,autoClearEmptyLines:false,onKeyEvent:null,onDragEvent:null,lineWrapping:false,lineNumbers:false,gutter:false,fixedGutter:false,firstLineNumber:1,readOnly:false,dragDrop:true,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:false,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null,autofocus:null};var w=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent);var S=w||/Mac/.test(navigator.platform);var aa=/Win/.test(navigator.platform);var ap=A.modes={},Y=A.mimeModes={};A.defineMode=function(at,av){if(!A.defaults.mode&&at!="null"){A.defaults.mode=at}if(arguments.length>2){av.dependencies=[];for(var au=2;au<arguments.length;++au){av.dependencies.push(arguments[au])}}ap[at]=av};A.defineMIME=function(au,at){Y[au]=at};A.resolveMode=function(at){if(typeof at=="string"&&Y.hasOwnProperty(at)){at=Y[at]}else{if(typeof at=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(at)){return A.resolveMode("application/xml")}}if(typeof at=="string"){return{name:at}}else{return at||{name:"null"}}};A.getMode=function(au,at){var at=A.resolveMode(at);var av=ap[at.name];if(!av){return A.getMode(au,"text/plain")}return av(au,at)};A.listModes=function(){var au=[];for(var at in ap){if(ap.propertyIsEnumerable(at)){au.push(at)}}return au};A.listMIMEs=function(){var au=[];for(var at in Y){if(Y.propertyIsEnumerable(at)){au.push({mime:at,mode:Y[at]})}}return au};var ai=A.extensions={};A.defineExtension=function(at,au){ai[at]=au};var R=A.commands={selectAll:function(at){at.setSelection({line:0,ch:0},{line:at.lineCount()-1})},killLine:function(at){var aw=at.getCursor(true),av=at.getCursor(false),au=!aj(aw,av);if(!au&&at.getLine(aw.line).length==aw.ch){at.replaceRange("",aw,{line:aw.line+1,ch:0})}else{at.replaceRange("",aw,au?av:{line:aw.line})}},deleteLine:function(at){var au=at.getCursor().line;at.replaceRange("",{line:au,ch:0},{line:au})},undo:function(at){at.undo()},redo:function(at){at.redo()},goDocStart:function(at){at.setCursor(0,0,true)},goDocEnd:function(at){at.setSelection({line:at.lineCount()-1},null,true)},goLineStart:function(at){at.setCursor(at.getCursor().line,0,true)},goLineStartSmart:function(at){var aw=at.getCursor();var av=at.getLine(aw.line),au=Math.max(0,av.search(/\S/));at.setCursor(aw.line,aw.ch<=au&&aw.ch?0:au,true)},goLineEnd:function(at){at.setSelection({line:at.getCursor().line},null,true)},goLineUp:function(at){at.moveV(-1,"line")},goLineDown:function(at){at.moveV(1,"line")},goPageUp:function(at){at.moveV(-1,"page")},goPageDown:function(at){at.moveV(1,"page")},goCharLeft:function(at){at.moveH(-1,"char")},goCharRight:function(at){at.moveH(1,"char")},goColumnLeft:function(at){at.moveH(-1,"column")},goColumnRight:function(at){at.moveH(1,"column")},goWordLeft:function(at){at.moveH(-1,"word")},goWordRight:function(at){at.moveH(1,"word")},delCharLeft:function(at){at.deleteH(-1,"char")},delCharRight:function(at){at.deleteH(1,"char")},delWordLeft:function(at){at.deleteH(-1,"word")},delWordRight:function(at){at.deleteH(1,"word")},indentAuto:function(at){at.indentSelection("smart")},indentMore:function(at){at.indentSelection("add")},indentLess:function(at){at.indentSelection("subtract")},insertTab:function(at){at.replaceSelection("\t","end")},defaultTab:function(at){if(at.somethingSelected()){at.indentSelection("add")}else{at.replaceSelection("\t","end")}},transposeChars:function(at){var av=at.getCursor(),au=at.getLine(av.line);if(av.ch>0&&av.ch<au.length-1){at.replaceRange(au.charAt(av.ch)+au.charAt(av.ch-1),{line:av.line,ch:av.ch-1},{line:av.line,ch:av.ch+1})}},newlineAndIndent:function(at){at.replaceSelection("\n","end");at.indentLine(at.getCursor().line)},toggleOverwrite:function(at){at.toggleOverwrite()}};var B=A.keyMap={};B.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"};B.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"};B.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]};B["default"]=S?B.macDefault:B.pcDefault;B.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageUp","Shift-Ctrl-V":"goPageDown","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};function c(at){if(typeof at=="string"){return B[at]}else{return at}}function o(au,at,ay,aw,av){function ax(aD){aD=c(aD);var aB=aD[au];if(aB!=null&&aw(aB)){return true}if(aD.nofallthrough){if(av){av()}return true}var aA=aD.fallthrough;if(aA==null){return false}if(Object.prototype.toString.call(aA)!="[object Array]"){return ax(aA)}for(var az=0,aC=aA.length;az<aC;++az){if(ax(aA[az])){return true}}return false}if(at&&ax(at)){return true}return ax(ay)}function W(au){var at=X[E(au,"keyCode")];return at=="Ctrl"||at=="Alt"||at=="Shift"||at=="Mod"}A.fromTextArea=function(au,aw){if(!aw){aw={}}aw.value=au.value;if(!aw.tabindex&&au.tabindex){aw.tabindex=au.tabindex}if(aw.autofocus==null&&au.getAttribute("autofocus")!=null){aw.autofocus=true}function ay(){au.value=at.getValue()}if(au.form){var ax=v(au.form,"submit",ay,true);if(typeof au.form.submit=="function"){var av=au.form.submit;function az(){ay();au.form.submit=av;au.form.submit();au.form.submit=az}au.form.submit=az}}au.style.display="none";var at=A(function(aA){au.parentNode.insertBefore(aA,au.nextSibling)},aw);at.save=ay;at.getTextArea=function(){return au};at.toTextArea=function(){ay();au.parentNode.removeChild(at.getWrapperElement());au.style.display="";if(au.form){ax();if(typeof au.form.submit=="function"){au.form.submit=av}}};return at};function t(aw,at){if(at===true){return at}if(aw.copyState){return aw.copyState(at)}var av={};for(var ax in at){var au=at[ax];if(au instanceof Array){au=au.concat([])}av[ax]=au}return av}A.copyState=t;function ab(av,au,at){return av.startState?av.startState(au,at):true}A.startState=ab;function b(at,au){this.pos=this.start=0;this.string=at;this.tabSize=au||8}b.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}},eat:function(at){var av=this.string.charAt(this.pos);if(typeof at=="string"){var au=av==at}else{var au=av&&(at.test?at.test(av):at(av))}if(au){++this.pos;return av}},eatWhile:function(at){var au=this.pos;while(this.eat(at)){}return this.pos>au},eatSpace:function(){var at=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos}return this.pos>at},skipToEnd:function(){this.pos=this.string.length},skipTo:function(at){var au=this.string.indexOf(at,this.pos);if(au>-1){this.pos=au;return true}},backUp:function(at){this.pos-=at},column:function(){return q(this.string,this.start,this.tabSize)},indentation:function(){return q(this.string,null,this.tabSize)},match:function(aw,au,at){if(typeof aw=="string"){function ax(ay){return at?ay.toLowerCase():ay}if(ax(this.string).indexOf(ax(aw),this.pos)==this.pos){if(au!==false){this.pos+=aw.length}return true}}else{var av=this.string.slice(this.pos).match(aw);if(av&&au!==false){this.pos+=av[0].length}return av}},current:function(){return this.string.slice(this.start,this.pos)}};A.StringStream=b;function Q(aw,av,au,at){this.from=aw;this.to=av;this.style=au;this.marker=at}Q.prototype={attach:function(at){this.marker.set.push(at)},detach:function(au){var at=u(this.marker.set,au);if(at>-1){this.marker.set.splice(at,1)}},split:function(aw,at){if(this.to<=aw&&this.to!=null){return null}var av=this.from<aw||this.from==null?null:this.from-aw+at;var au=this.to==null?null:this.to-aw+at;return new Q(av,au,this.style,this.marker)},dup:function(){return new Q(null,null,this.style,this.marker)},clipTo:function(au,ax,at,aw,av){if(au&&aw>this.from&&(aw<this.to||this.to==null)){this.from=null}else{if(this.from!=null&&this.from>=ax){this.from=Math.max(aw,this.from)+av}}if(at&&(ax<this.to||this.to==null)&&(ax>this.from||this.from==null)){this.to=null}else{if(this.to!=null&&this.to>ax){this.to=aw<this.to?this.to+av:ax}}},isDead:function(){return this.from!=null&&this.to!=null&&this.from>=this.to},sameSet:function(at){return this.marker==at.marker}};function M(at){this.from=at;this.to=at;this.line=null}M.prototype={attach:function(at){this.line=at},detach:function(at){if(this.line==at){this.line=null}},split:function(au,at){if(au<this.from){this.from=this.to=(this.from-au)+at;return this}},isDead:function(){return this.from>this.to},clipTo:function(au,ax,at,aw,av){if((au||ax<this.from)&&(at||aw>this.to)){this.from=0;this.to=-1}else{if(this.from>ax){this.from=this.to=Math.max(aw,this.from)+av}}},sameSet:function(at){return false},find:function(){if(!this.line||!this.line.parent){return null}return{line:ae(this.line),ch:this.from}},clear:function(){if(this.line){var at=u(this.line.marked,this);if(at!=-1){this.line.marked.splice(at,1)}this.line=null}}};function f(au,at){this.styles=at||[au,null];this.text=au;this.height=1;this.marked=this.gutterMarker=this.className=this.bgClassName=this.handlers=null;this.stateAfter=this.parent=this.hidden=null}f.inheritMarks=function(ax,aA){var aw=new f(ax),at=aA&&aA.marked;if(at){for(var av=0;av<at.length;++av){if(at[av].to==null&&at[av].style){var au=aw.marked||(aw.marked=[]),az=at[av];var ay=az.dup();au.push(ay);ay.attach(aw)}}}return aw};f.prototype={replace:function(ax,aw,aA){var aB=[],av=this.marked,ay=aw==null?this.text.length:aw;ar(0,ax,this.styles,aB);if(aA){aB.push(aA,null)}ar(ay,this.text.length,this.styles,aB);this.styles=aB;this.text=this.text.slice(0,ax)+aA+this.text.slice(ay);this.stateAfter=null;if(av){var az=aA.length-(ay-ax);for(var au=0;au<av.length;++au){var at=av[au];at.clipTo(ax==null,ax||0,aw==null,ay,az);if(at.isDead()){at.detach(this);av.splice(au--,1)}}}},split:function(aA,ay){var aw=[ay,null],au=this.marked;ar(aA,this.text.length,this.styles,aw);var av=new f(ay+this.text.slice(aA),aw);if(au){for(var ax=0;ax<au.length;++ax){var az=au[ax];var at=az.split(aA,ay.length);if(at){if(!av.marked){av.marked=[]}av.marked.push(at);at.attach(av);if(at==az){au.splice(ax--,1)}}}}return av},append:function(au){var az=this.text.length,at=au.marked,ax=this.marked;this.text+=au.text;ar(0,au.text.length,au.styles,this.styles);if(ax){for(var ay=0;ay<ax.length;++ay){if(ax[ay].to==null){ax[ay].to=az}}}if(at&&at.length){if(!ax){this.marked=ax=[]}outer:for(var ay=0;ay<at.length;++ay){var aA=at[ay];if(!aA.from){for(var aw=0;aw<ax.length;++aw){var av=ax[aw];if(av.to==az&&av.sameSet(aA)){av.to=aA.to==null?null:aA.to+az;if(av.isDead()){av.detach(this);at.splice(ay--,1)}continue outer}}}ax.push(aA);aA.attach(this);aA.from+=az;if(aA.to!=null){aA.to+=az}}}},fixMarkEnds:function(au){var at=this.marked,ax=au.marked;if(!at){return}for(var aw=0;aw<at.length;++aw){var az=at[aw],ay=az.to==null;if(ay&&ax){for(var av=0;av<ax.length;++av){if(ax[av].sameSet(az)){ay=false;break}}}if(ay){az.to=this.text.length}}},fixMarkStarts:function(){var at=this.marked;if(!at){return}for(var au=0;au<at.length;++au){if(at[au].from==null){at[au].from=0}}},addMark:function(at){at.attach(this);if(this.marked==null){this.marked=[]}this.marked.push(at);this.marked.sort(function(av,au){return(av.from||0)-(au.from||0)})},highlight:function(ay,au,az){var aC=new b(this.text,az),aD=this.styles,aA=0;var ax=false,av=aD[0],aB;if(this.text==""&&ay.blankLine){ay.blankLine(au)}while(!aC.eol()){var at=ay.token(aC,au);var aw=this.text.slice(aC.start,aC.pos);aC.start=aC.pos;if(aA&&aD[aA-1]==at){aD[aA-2]+=aw}else{if(aw){if(!ax&&(aD[aA+1]!=at||(aA&&aD[aA-2]!=aB))){ax=true}aD[aA++]=aw;aD[aA++]=at;aB=av;av=aD[aA]}}if(aC.pos>5000){aD[aA++]=this.text.slice(aC.pos);aD[aA++]=null;break}}if(aD.length!=aA){aD.length=aA;ax=true}if(aA&&aD[aA-2]!=aB){ax=true}return ax||(aD.length<5&&this.text.length<10?null:false)},getTokenAt:function(ay,aw,av){var at=this.text,ax=new b(at);while(ax.pos<av&&!ax.eol()){ax.start=ax.pos;var au=ay.token(ax,aw)}return{start:ax.start,end:ax.pos,string:ax.current(),className:au||null,state:aw}},indentation:function(at){return q(this.text,null,at)},getHTML:function(aS,at,av,ax){var aD=[],aB=true,az=0;function aO(a4,a2){if(!a4){return}if(aB&&O&&a4.charAt(0)==" "){a4="\u00a0"+a4.slice(1)}aB=false;if(a4.indexOf("\t")==-1){az+=a4.length;var a3=V(a4)}else{var a3="";for(var a5=0;;){var a0=a4.indexOf("\t",a5);if(a0==-1){a3+=V(a4.slice(a5));az+=a4.length-a5;break}else{az+=a0-a5;var a1=aS(az);a3+=V(a4.slice(a5,a0))+a1.html;az+=a1.width;a5=a0+1}}}if(a2){aD.push('<span class="',a2,'">',a3,"</span>")}else{aD.push(a3)}}var aR=aO;if(at!=null){var aM=0,aH='<span id="'+av+'">';aR=function(a3,a1){var a0=a3.length;if(at>=aM&&at<aM+a0){if(at>aM){aO(a3.slice(0,at-aM),a1);if(ax){aD.push("<wbr>")}}aD.push(aH);var a2=at-aM;aO(window.opera?a3.slice(a2,a2+1):a3.slice(a2),a1);aD.push("</span>");if(window.opera){aO(a3.slice(a2+1),a1)}at--;aM+=a0}else{aM+=a0;aO(a3,a1);if(aM==at&&aM==aW){aD.push(aH+" </span>")}else{if(aM>at+10&&/\s/.test(a3)){aR=function(){}}}}}}var aL=this.styles,aC=this.text,aI=this.marked;var aW=aC.length;function ay(a0){if(!a0){return null}return"cm-"+a0.replace(/ +/g," cm-")}if(!aC&&at==null){aR(" ")}else{if(!aI||!aI.length){for(var aT=0,aE=0;aE<aW;aT+=2){var aK=aL[aT],aV=aL[aT+1],aN=aK.length;if(aE+aN>aW){aK=aK.slice(0,aW-aE)}aE+=aN;aR(aK,ay(aV))}}else{var aA=0,aT=0,aG="",aV,aZ=0;var aY=aI[0].from||0,aQ=[],aX=0;function aU(){var a0;while(aX<aI.length&&((a0=aI[aX]).from==aA||a0.from==null)){if(a0.style!=null){aQ.push(a0)}++aX}aY=aX<aI.length?aI[aX].from:Infinity;for(var a1=0;a1<aQ.length;++a1){var a2=aQ[a1].to||Infinity;if(a2==aA){aQ.splice(a1--,1)}else{aY=Math.min(a2,aY)}}}var aJ=0;while(aA<aW){if(aY==aA){aU()}var aF=Math.min(aW,aY);while(true){if(aG){var aw=aA+aG.length;var au=aV;for(var aP=0;aP<aQ.length;++aP){au=(au?au+" ":"")+aQ[aP].style}aR(aw>aF?aG.slice(0,aF-aA):aG,au);if(aw>=aF){aG=aG.slice(aF-aA);aA=aF;break}aA=aw}aG=aL[aT++];aV=ay(aL[aT++])}}}}return aD.join("")},cleanUp:function(){this.parent=null;if(this.marked){for(var at=0,au=this.marked.length;at<au;++at){this.marked[at].detach(this)}}}};function ar(az,aA,at,aB){for(var ax=0,ay=0,au=0;ay<aA;ax+=2){var av=at[ax],aw=ay+av.length;if(au==0){if(aw>az){aB.push(av.slice(az-ay,Math.min(av.length,aA-ay)),at[ax+1])}if(aw>=az){au=1}}else{if(au==1){if(aw>aA){aB.push(av.slice(0,aA-ay),at[ax+1])}else{aB.push(av,at[ax+1])}}}ay=aw}}function an(au){this.lines=au;this.parent=null;for(var av=0,aw=au.length,at=0;av<aw;++av){au[av].parent=this;at+=au[av].height}this.height=at}an.prototype={chunkSize:function(){return this.lines.length},remove:function(au,aA,ay){for(var ax=au,az=au+aA;ax<az;++ax){var av=this.lines[ax];this.height-=av.height;av.cleanUp();if(av.handlers){for(var aw=0;aw<av.handlers.length;++aw){ay.push(av.handlers[aw])}}}this.lines.splice(au,aA)},collapse:function(at){at.splice.apply(at,[at.length,0].concat(this.lines))},insertHeight:function(av,aw,au){this.height+=au;this.lines=this.lines.slice(0,av).concat(aw).concat(this.lines.slice(av));for(var ax=0,ay=aw.length;ax<ay;++ax){aw[ax].parent=this}},iterN:function(au,ax,aw){for(var av=au+ax;au<av;++au){if(aw(this.lines[au])){return true}}}};function l(aw){this.children=aw;var av=0,at=0;for(var au=0,ay=aw.length;au<ay;++au){var ax=aw[au];av+=ax.chunkSize();at+=ax.height;ax.parent=this}this.size=av;this.height=at;this.parent=null}l.prototype={chunkSize:function(){return this.size},remove:function(aw,av,az){this.size-=av;for(var ax=0;ax<this.children.length;++ax){var au=this.children[ax],aA=au.chunkSize();if(aw<aA){var ay=Math.min(av,aA-aw),aB=au.height;au.remove(aw,ay,az);this.height-=aB-au.height;if(aA==ay){this.children.splice(ax--,1);au.parent=null}if((av-=ay)==0){break}aw=0}else{aw-=aA}}if(this.size-av<25){var aC=[];this.collapse(aC);this.children=[new an(aC)];this.children[0].parent=this}},collapse:function(at){for(var au=0,av=this.children.length;au<av;++au){this.children[au].collapse(at)}},insert:function(av,aw){var au=0;for(var ax=0,ay=aw.length;ax<ay;++ax){au+=aw[ax].height}this.insertHeight(av,aw,au)},insertHeight:function(av,aC,aB){this.size+=aC.length;this.height+=aB;for(var aw=0,ay=this.children.length;aw<ay;++aw){var au=this.children[aw],az=au.chunkSize();if(av<=az){au.insertHeight(av,aC,aB);if(au.lines&&au.lines.length>50){while(au.lines.length>50){var ax=au.lines.splice(au.lines.length-25,25);var aA=new an(ax);au.height-=aA.height;this.children.splice(aw+1,0,aA);aA.parent=this}this.maybeSpill()}break}av-=az}},maybeSpill:function(){if(this.children.length<=10){return}var aw=this;do{var au=aw.children.splice(aw.children.length-5,5);var av=new l(au);if(!aw.parent){var ax=new l(aw.children);ax.parent=aw;aw.children=[ax,av];aw=ax}else{aw.size-=av.size;aw.height-=av.height;var at=u(aw.parent.children,aw);aw.parent.children.splice(at+1,0,av)}av.parent=aw.parent}while(aw.children.length>10);aw.parent.maybeSpill()},iter:function(av,au,at){this.iterN(av,au-av,at)},iterN:function(au,aB,aA){for(var av=0,ay=this.children.length;av<ay;++av){var az=this.children[av],ax=az.chunkSize();if(au<ax){var aw=Math.min(aB,ax-au);if(az.iterN(au,aw,aA)){return true}if((aB-=aw)==0){break}au=0}else{au-=ax}}}};function I(at,ax){while(!at.lines){for(var au=0;;++au){var aw=at.children[au],av=aw.chunkSize();if(ax<av){at=aw;break}ax-=av}}return at.lines[ax]}function ae(at){if(at.parent==null){return null}var ay=at.parent,ax=u(ay.lines,at);for(var au=ay.parent;au;ay=au,au=au.parent){for(var av=0,aw=au.children.length;;++av){if(au.children[av]==ay){break}ax+=au.children[av].chunkSize()}}return ax}function ad(az,ax){var av=0;outer:do{for(var aw=0,ay=az.children.length;aw<ay;++aw){var au=az.children[aw],at=au.height;if(ax<at){az=au;continue outer}ax-=at;av+=au.chunkSize()}return av}while(!az.lines);for(var aw=0,ay=az.lines.length;aw<ay;++aw){var aB=az.lines[aw],aA=aB.height;if(ax<aA){break}ax-=aA}return av+aw}function h(at,az){var av=0;outer:do{for(var au=0,ax=at.children.length;au<ax;++au){var ay=at.children[au],aw=ay.chunkSize();if(az<aw){at=ay;continue outer}az-=aw;av+=ay.height}return av}while(!at.lines);for(var au=0;au<az;++au){av+=at.lines[au].height}return av}function n(){this.time=0;this.done=[];this.undone=[];this.compound=0;this.closed=false}n.prototype={addChange:function(at,ay,au){this.undone.length=0;var av=+new Date,aA=this.done[this.done.length-1],aB=aA&&aA[aA.length-1];var ax=av-this.time;if(this.compound&&aA&&!this.closed){aA.push({start:at,added:ay,old:au})}else{if(ax>400||!aB||this.closed||aB.start>at+au.length||aB.start+aB.added<at){this.done.push([{start:at,added:ay,old:au}]);this.closed=false}else{var az=Math.max(0,aB.start-at),aC=Math.max(0,(at+au.length)-(aB.start+aB.added));for(var aw=az;aw>0;--aw){aB.old.unshift(au[aw-1])}for(var aw=aC;aw>0;--aw){aB.old.push(au[au.length-aw])}if(az){aB.start=at}aB.added+=ay-(au.length-az-aC)}}this.time=av},startCompound:function(){if(!this.compound++){this.closed=true}},endCompound:function(){if(!--this.compound){this.closed=true}}};function P(){C(this)}function U(at){if(!at.stop){at.stop=P}return at}function Z(at){if(at.preventDefault){at.preventDefault()}else{at.returnValue=false}}function J(at){if(at.stopPropagation){at.stopPropagation()}else{at.cancelBubble=true}}function C(at){Z(at);J(at)}A.e_stop=C;A.e_preventDefault=Z;A.e_stopPropagation=J;function m(at){return at.target||at.srcElement}function D(at){if(at.which){return at.which}else{if(at.button&1){return 1}else{if(at.button&2){return 3}else{if(at.button&4){return 2}}}}}function E(au,av){var at=au.override&&au.override.hasOwnProperty(av);return at?au.override[av]:au[av]}function v(aw,av,au,at){if(typeof aw.addEventListener=="function"){aw.addEventListener(av,au,false);if(at){return function(){aw.removeEventListener(av,au,false)}}}else{var ax=function(ay){au(ay||window.event)};aw.attachEvent("on"+av,ax);if(at){return function(){aw.detachEvent("on"+av,ax)}}}}A.connect=v;function F(){this.id=null}F.prototype={set:function(at,au){clearTimeout(this.id);this.id=setTimeout(au,at)}};var ah=A.Pass={toString:function(){return"CodeMirror.Pass"}};var T=/gecko\/\d{7}/i.test(navigator.userAgent);var O=/MSIE \d/.test(navigator.userAgent);var H=/MSIE [1-8]\b/.test(navigator.userAgent);var K=O&&document.documentMode==5;var g=/WebKit\//.test(navigator.userAgent);var al=/Chrome\//.test(navigator.userAgent);var k=/Apple Computer/.test(navigator.vendor);var p=/KHTML\//.test(navigator.userAgent);var L=function(){if(H){return false}var at=document.createElement("div");return"draggable" in at||"dragDrop" in at}();var d=function(){var at=document.createElement("textarea");at.value="foo\nbar";if(at.value.indexOf("\r")>-1){return"\r\n"}return"\n"}();var s=/^$/;if(T){s=/$'/}else{if(k){s=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/}else{if(al){s=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/}}}function q(au,at,aw){if(at==null){at=au.search(/[^\s\u00a0]/);if(at==-1){at=au.length}}for(var av=0,ax=0;av<at;++av){if(au.charAt(av)=="\t"){ax+=aw-(ax%aw)}else{++ax}}return ax}function z(at){if(at.currentStyle){return at.currentStyle}return window.getComputedStyle(at,null)}function aq(au,aC){var aw=au.ownerDocument.body;var aB=0,aA=0,ay=false;for(var at=au;at;at=at.offsetParent){var az=at.offsetLeft,av=at.offsetTop;if(at==aw){aB+=Math.abs(az);aA+=Math.abs(av)}else{aB+=az,aA+=av}if(aC&&z(at).position=="fixed"){ay=true}}var ax=aC&&!ay?null:aw;for(var at=au.parentNode;at!=ax;at=at.parentNode){if(at.scrollLeft!=null){aB-=at.scrollLeft;aA-=at.scrollTop}}return{left:aB,top:aA}}if(document.documentElement.getBoundingClientRect!=null){aq=function(aw,at){try{var av=aw.getBoundingClientRect();av={top:av.top,left:av.left}}catch(ax){av={top:0,left:0}}if(!at){if(window.pageYOffset==null){var au=document.documentElement||document.body.parentNode;if(au.scrollTop==null){au=document.body}av.top+=au.scrollTop;av.left+=au.scrollLeft}else{av.top+=window.pageYOffset;av.left+=window.pageXOffset}}return av}}function N(at){return at.textContent||at.innerText||at.nodeValue||""}function a(at){if(w){at.selectionStart=0;at.selectionEnd=at.value.length}else{at.select()}}function aj(au,at){return au.line==at.line&&au.ch==at.ch}function af(au,at){return au.line<at.line||(au.line==at.line&&au.ch<at.ch)}function ag(at){return{line:at.line,ch:at.ch}}var ao=document.createElement("pre");function V(at){ao.textContent=at;return ao.innerHTML}if(V("a")=="\na"){V=function(at){ao.textContent=at;return ao.innerHTML.slice(1)}}else{if(V("\t")!="\t"){V=function(at){ao.innerHTML="";ao.appendChild(document.createTextNode(at));return ao.innerHTML}}}A.htmlEscape=V;function ac(aw,av){if(!av){return 0}if(!aw){return av.length}for(var au=aw.length,at=av.length;au>=0&&at>=0;--au,--at){if(aw.charAt(au)!=av.charAt(at)){break}}return at+1}function u(aw,at){if(aw.indexOf){return aw.indexOf(at)}for(var au=0,av=aw.length;au<av;++au){if(aw[au]==at){return au}}return -1}function am(at){return/\w/.test(at)||at.toUpperCase()!=at.toLowerCase()}var G="\n\nb".split(/\n/).length!=3?function(av){var aw=0,au,at=[];while((au=av.indexOf("\n",aw))>-1){at.push(av.slice(aw,av.charAt(au-1)=="\r"?au-1:au));aw=au+1}at.push(av.slice(aw));return at}:function(at){return at.split(/\r?\n/)};A.splitLines=G;var ak=window.getSelection?function(au){try{return au.selectionStart!=au.selectionEnd}catch(at){return false}}:function(av){try{var at=av.ownerDocument.selection.createRange()}catch(au){}if(!at||at.parentElement()!=av){return false}return at.compareEndPoints("StartToEnd",at)!=0};A.defineMode("null",function(){return{token:function(at){at.skipToEnd()}}});A.defineMIME("text/plain","null");var X={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};A.keyNames=X;(function(){for(var at=0;at<10;at++){X[at+48]=String(at)}for(var at=65;at<=90;at++){X[at]=String.fromCharCode(at)}for(var at=1;at<=12;at++){X[at+111]=X[at+63235]="F"+at}})();return A})();CodeMirror.defineMode("javascript",function(N,R){var B=N.indentUnit;var V=R.json;var b=function(){function ab(ae){return{type:ae,style:"keyword"}}var Y=ab("keyword a"),ad=ab("keyword b"),ac=ab("keyword c");var Z=ab("operator"),aa={type:"atom",style:"atom"};return{"if":Y,"while":Y,"with":Y,"else":ad,"do":ad,"try":ad,"finally":ad,"return":ac,"break":ac,"continue":ac,"new":ac,"delete":ac,"throw":ac,"var":ab("var"),"function":ab("function"),"catch":ab("catch"),"for":ab("for"),"switch":ab("switch"),"case":ab("case"),"default":ab("default"),"in":Z,"typeof":Z,"instanceof":Z,"true":aa,"false":aa,"null":aa,"undefined":aa,"NaN":aa,"Infinity":aa}}();var S=/[+\-*&%=<>!?|]/;function W(aa,Z,Y){Z.tokenize=Y;return Y(aa,Z)}function k(ab,Y){var aa=false,Z;while((Z=ab.next())!=null){if(Z==Y&&!aa){return false}aa=!aa&&Z=="\\"}return aa}var X,t;function G(aa,Z,Y){X=aa;t=Y;return Z}function o(ac,aa){var Y=ac.next();if(Y=='"'||Y=="'"){return W(ac,aa,F(Y))}else{if(/[\[\]{}\(\),;\:\.]/.test(Y)){return G(Y)}else{if(Y=="0"&&ac.eat(/x/i)){ac.eatWhile(/[\da-f]/i);return G("number","atom")}else{if(/\d/.test(Y)){ac.match(/^\d*(?:\.\d*)?(?:e[+\-]?\d+)?/);return G("number","atom")}else{if(Y=="/"){if(ac.eat("*")){return W(ac,aa,g)}else{if(ac.eat("/")){ac.skipToEnd();return G("comment","comment")}else{if(aa.reAllowed){k(ac,"/");ac.eatWhile(/[gimy]/);return G("regexp","string")}else{ac.eatWhile(S);return G("operator",null,ac.current())}}}}else{if(S.test(Y)){ac.eatWhile(S);return G("operator",null,ac.current())}else{ac.eatWhile(/[\w\$_]/);var ab=ac.current(),Z=b.propertyIsEnumerable(ab)&&b[ab];return Z?G(Z.type,Z.style,ab):G("variable","variable",ab)}}}}}}}function F(Y){return function(aa,Z){if(!k(aa,Y)){Z.tokenize=o}return G("string","string")}}function g(ab,aa){var Y=false,Z;while(Z=ab.next()){if(Z=="/"&&Y){aa.tokenize=o;break}Y=(Z=="*")}return G("comment","comment")}var n={atom:true,number:true,variable:true,string:true,regexp:true};function z(ad,Z,Y,ac,aa,ab){this.indented=ad;this.column=Z;this.type=Y;this.prev=aa;this.info=ab;if(ac!=null){this.align=ac}}function C(aa,Z){for(var Y=aa.localVars;Y;Y=Y.next){if(Y.name==Z){return true}}}function J(ac,Z,Y,ab,ad){var ae=ac.cc;A.state=ac;A.stream=ad;A.marked=null,A.cc=ae;if(!ac.lexical.hasOwnProperty("align")){ac.lexical.align=true}while(true){var aa=ae.length?ae.pop():V?D:E;if(aa(Y,ab)){while(ae.length&&ae[ae.length-1].lex){ae.pop()()}if(A.marked){return A.marked}if(Y=="variable"&&C(ac,ab)){return"variable-2"}return Z}}}var A={state:null,column:null,marked:null,cc:null};function a(){for(var Y=arguments.length-1;Y>=0;Y--){A.cc.push(arguments[Y])}}function L(){a.apply(null,arguments);return true}function p(Z){var aa=A.state;if(aa.context){A.marked="def";for(var Y=aa.localVars;Y;Y=Y.next){if(Y.name==Z){return}}aa.localVars={name:Z,next:aa.localVars}}}var I={name:"this",next:{name:"arguments"}};function w(){if(!A.state.context){A.state.localVars=I}A.state.context={prev:A.state.context,vars:A.state.localVars}}function v(){A.state.localVars=A.state.context.vars;A.state.context=A.state.context.prev}function m(Z,aa){var Y=function(){var ab=A.state;ab.lexical=new z(ab.indented,A.stream.column(),Z,null,ab.lexical,aa)};Y.lex=true;return Y}function K(){var Y=A.state;if(Y.lexical.prev){if(Y.lexical.type==")"){Y.indented=Y.lexical.indented}Y.lexical=Y.lexical.prev}}K.lex=true;function c(Z){return function Y(aa){if(aa==Z){return L()}else{if(Z==";"){return a()}else{return L(arguments.callee)}}}}function E(Y){if(Y=="var"){return L(m("vardef"),O,c(";"),K)}if(Y=="keyword a"){return L(m("form"),D,E,K)}if(Y=="keyword b"){return L(m("form"),E,K)}if(Y=="{"){return L(m("}"),q,K)}if(Y==";"){return L()}if(Y=="function"){return L(l)}if(Y=="for"){return L(m("form"),c("("),m(")"),h,c(")"),K,E,K)}if(Y=="variable"){return L(m("stat"),H)}if(Y=="switch"){return L(m("form"),D,m("}","switch"),c("{"),q,K,K)}if(Y=="case"){return L(D,c(":"))}if(Y=="default"){return L(c(":"))}if(Y=="catch"){return L(m("form"),w,c("("),u,c(")"),E,K,v)}return a(m("stat"),D,c(";"),K)}function D(Y){if(n.hasOwnProperty(Y)){return L(Q)}if(Y=="function"){return L(l)}if(Y=="keyword c"){return L(D)}if(Y=="("){return L(m(")"),D,c(")"),K,Q)}if(Y=="operator"){return L(D)}if(Y=="["){return L(m("]"),T(D,"]"),K,Q)}if(Y=="{"){return L(m("}"),T(s,"}"),K,Q)}return L()}function Q(Y,Z){if(Y=="operator"&&/\+\+|--/.test(Z)){return L(Q)}if(Y=="operator"){return L(D)}if(Y==";"){return}if(Y=="("){return L(m(")"),T(D,")"),K,Q)}if(Y=="."){return L(U,Q)}if(Y=="["){return L(m("]"),D,c("]"),K,Q)}}function H(Y){if(Y==":"){return L(K,E)}return a(Q,c(";"),K)}function U(Y){if(Y=="variable"){A.marked="property";return L()}}function s(Y){if(Y=="variable"){A.marked="property"}if(n.hasOwnProperty(Y)){return L(c(":"),D)}}function T(aa,Y){function Z(ac){if(ac==","){return L(aa,Z)}if(ac==Y){return L()}return L(c(Y))}return function ab(ac){if(ac==Y){return L()}else{return a(aa,Z)}}}function q(Y){if(Y=="}"){return L()}return a(E,q)}function O(Y,Z){if(Y=="variable"){p(Z);return L(M)}return L()}function M(Y,Z){if(Z=="="){return L(D,M)}if(Y==","){return L(O)}}function h(Y){if(Y=="var"){return L(O,f)}if(Y==";"){return a(f)}if(Y=="variable"){return L(P)}return a(f)}function P(Y,Z){if(Z=="in"){return L(D)}return L(Q,f)}function f(Y,Z){if(Y==";"){return L(d)}if(Z=="in"){return L(D)}return L(D,c(";"),d)}function d(Y){if(Y!=")"){L(D)}}function l(Y,Z){if(Y=="variable"){p(Z);return L(l)}if(Y=="("){return L(m(")"),w,T(u,")"),K,E,v)}}function u(Y,Z){if(Y=="variable"){p(Z);return L()}}return{startState:function(Y){return{tokenize:o,reAllowed:true,cc:[],lexical:new z((Y||0)-B,0,"block",false),localVars:null,context:null,indented:0}},token:function(aa,Z){if(aa.sol()){if(!Z.lexical.hasOwnProperty("align")){Z.lexical.align=false}Z.indented=aa.indentation()}if(aa.eatSpace()){return null}var Y=Z.tokenize(aa,Z);if(X=="comment"){return Y}Z.reAllowed=X=="operator"||X=="keyword c"||X.match(/^[\[{}\(,;:]$/);return J(Z,Y,X,t,aa)},indent:function(ad,Y){if(ad.tokenize!=o){return 0}var ac=Y&&Y.charAt(0),aa=ad.lexical,ab=aa.type,Z=ac==ab;if(ab=="vardef"){return aa.indented+4}else{if(ab=="form"&&ac=="{"){return aa.indented}else{if(ab=="stat"||ab=="form"){return aa.indented+B}else{if(aa.info=="switch"&&!Z){return aa.indented+(/^(?:case|default)\b/.test(Y)?B:2*B)}else{if(aa.align){return aa.column+(Z?0:1)}else{return aa.indented+(Z?0:B)}}}}}},electricChars:":{}"}});CodeMirror.defineMIME("text/javascript","javascript");CodeMirror.defineMIME("application/json",{name:"javascript",json:true});(function(){function a(b,f,h,d){this.atOccurrence=false;this.cm=b;if(d==null&&typeof f=="string"){d=false}h=h?b.clipPos(h):{line:0,ch:0};this.pos={from:h,to:h};if(typeof f!="string"){this.matches=function(m,q){if(m){var k=b.getLine(q.line).slice(0,q.ch),l=k.match(f),p=0;while(l){var n=k.indexOf(l[0]);p+=n;k=k.slice(n+1);var o=k.match(f);if(o){l=o}else{break}p++}}else{var k=b.getLine(q.line).slice(q.ch),l=k.match(f),p=l&&q.ch+k.indexOf(l[0])}if(l){return{from:{line:q.line,ch:p},to:{line:q.line,ch:p+l[0].length},match:l}}}}else{if(d){f=f.toLowerCase()}var c=d?function(k){return k.toLowerCase()}:function(k){return k};var g=f.split("\n");if(g.length==1){this.matches=function(n,o){var l=c(b.getLine(o.line)),k=f.length,m;if(n?(o.ch>=k&&(m=l.lastIndexOf(f,o.ch-k))!=-1):(m=l.indexOf(f,o.ch))!=-1){return{from:{line:o.line,ch:m},to:{line:o.line,ch:m+k}}}}}else{this.matches=function(p,s){var q=s.line,t=(p?g.length-1:0),n=g[t],u=c(b.getLine(q));var o=(p?u.indexOf(n)+n.length:u.lastIndexOf(n));if(p?o>=s.ch||o!=n.length:o<=s.ch||o!=u.length-n.length){return}for(;;){if(p?!q:q==b.lineCount()-1){return}u=c(b.getLine(q+=p?-1:1));n=g[p?--t:++t];if(t>0&&t<g.length-1){if(u!=n){return}else{continue}}var m=(p?u.lastIndexOf(n):u.indexOf(n)+n.length);if(p?m!=u.length-n.length:m!=n.length){return}var k={line:s.line,ch:o},l={line:q,ch:m};return{from:p?l:k,to:p?k:l}}}}}}a.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(c){var b=this,g=this.cm.clipPos(c?this.pos.from:this.pos.to);function d(h){var k={line:h,ch:0};b.pos={from:k,to:k};b.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(c,g)){this.atOccurrence=true;return this.pos.match||true}if(c){if(!g.line){return d(0)}g={line:g.line-1,ch:this.cm.getLine(g.line-1).length}}else{var f=this.cm.lineCount();if(g.line==f-1){return d(f)}g={line:g.line+1,ch:0}}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(c){var b=this;if(this.atOccurrence){b.pos.to=this.cm.replaceRange(c,b.pos.from,b.pos.to)}}};CodeMirror.defineExtension("getSearchCursor",function(c,d,b){return new a(this,c,d,b)})})();CodeMirror.defineMode("css",function(f){var d=f.indentUnit,g;function c(l,m){g=m;return l}function k(n,m){var l=n.next();if(l=="@"){n.eatWhile(/\w/);return c("meta",n.current())}else{if(l=="/"&&n.eat("*")){m.tokenize=a;return a(n,m)}else{if(l=="<"&&n.eat("!")){m.tokenize=b;return b(n,m)}else{if(l=="="){c(null,"compare")}else{if((l=="~"||l=="|")&&n.eat("=")){return c(null,"compare")}else{if(l=='"'||l=="'"){m.tokenize=h(l);return m.tokenize(n,m)}else{if(l=="#"){n.eatWhile(/\w/);return c("atom","hash")}else{if(l=="!"){n.match(/^\s*\w*/);return c("keyword","important")}else{if(/\d/.test(l)){n.eatWhile(/[\w.%]/);return c("number","unit")}else{if(/[,.+>*\/]/.test(l)){return c(null,"select-op")}else{if(/[;{}:\[\]]/.test(l)){return c(null,l)}else{n.eatWhile(/[\w\\\-_]/);return c("variable","variable")}}}}}}}}}}}}function a(o,n){var l=false,m;while((m=o.next())!=null){if(l&&m=="/"){n.tokenize=k;break}l=(m=="*")}return c("comment","comment")}function b(o,n){var m=0,l;while((l=o.next())!=null){if(m>=2&&l==">"){n.tokenize=k;break}m=(l=="-")?m+1:0}return c("comment","comment")}function h(l){return function(p,n){var o=false,m;while((m=p.next())!=null){if(m==l&&!o){break}o=!o&&m=="\\"}if(!o){n.tokenize=k}return c("string","string")}}return{startState:function(l){return{tokenize:k,baseIndent:l||0,stack:[]}},token:function(o,n){if(o.eatSpace()){return null}var m=n.tokenize(o,n);var l=n.stack[n.stack.length-1];if(g=="hash"&&l=="rule"){m="atom"}else{if(m=="variable"){if(l=="rule"){m="number"}else{if(!l||l=="@media{"){m="tag"}}}}if(l=="rule"&&/^[\{\};]$/.test(g)){n.stack.pop()}if(g=="{"){if(l=="@media"){n.stack[n.stack.length-1]="@media{"}else{n.stack.push("{")}}else{if(g=="}"){n.stack.pop()}else{if(g=="@media"){n.stack.push("@media")}else{if(l=="{"&&g!="comment"){n.stack.push("rule")}}}}return m},indent:function(m,l){var o=m.stack.length;if(/^\}/.test(l)){o-=m.stack[m.stack.length-1]=="rule"?2:1}return m.baseIndent+o*d},electricChars:"}"}});CodeMirror.defineMIME("text/css","css");CodeMirror.defineMode("xmlami",function(B,n){var t=B.indentUnit;var A=n.htmlMode?{autoSelfClosers:{br:true,img:true,hr:true,link:true,input:true,meta:true,col:true,frame:true,base:true,area:true},doNotIndent:{pre:true,"!cdata":true},allowUnquoted:true}:{autoSelfClosers:{},doNotIndent:{"!cdata":true},allowUnquoted:false};var a=n.alignCDATA;var g,h;function s(F,E){function C(H){E.tokenize=H;return H(F,E)}var D=F.next();if(D=="<"){if(F.eat("!")){if(F.eat("[")){if(F.match("CDATA[")){return C(z("atom","]]>"))}else{return null}}else{if(F.match("--#set")){return C(z(null,'value="'))}else{if(F.match("--")){return C(z("comment","-->"))}else{if(F.match("DOCTYPE")){F.eatWhile(/[\w\._\-]/);return C(z("meta",">"))}else{return null}}}}}else{if(F.eat("?")){F.eatWhile(/[\w\._\-]/);E.tokenize=z("meta","?>");return"meta"}else{h=F.eat("/")?"closeTag":"openTag";F.eatSpace();g="";var G;while((G=F.eat(/[^\s\u00a0=<>\"\'\/?]/))){g+=G}E.tokenize=q;return"tag"}}}else{if(D=="&"){F.eatWhile(/[^;]/);F.eat(";");return"atom"}else{F.eatWhile(/[^&<]/);return null}}}function q(E,D){var C=E.next();if(C==">"||(C=="/"&&E.eat(">"))){D.tokenize=s;h=C==">"?"endTag":"selfcloseTag";return"tag"}else{if(C=="="){h="equals";return null}else{if(/[\'\"]/.test(C)){D.tokenize=m(C);return D.tokenize(E,D)}else{E.eatWhile(/[^\s\u00a0=<>\"\'\/?]/);return"word"}}}}function m(C){return function(E,D){while(!E.eol()){if(E.next()==C){D.tokenize=q;break}}return"string"}}function z(D,C){return function(F,E){while(!F.eol()){if(F.match(C)){E.tokenize=s;break}F.next()}return D}}var o,k;function b(){for(var C=arguments.length-1;C>=0;C--){o.cc.push(arguments[C])}}function f(){b.apply(null,arguments);return true}function l(C,E){var D=A.doNotIndent.hasOwnProperty(C)||(o.context&&o.context.noIndent);o.context={prev:o.context,tagName:C,indent:o.indented,startOfLine:E,noIndent:D}}function v(){if(o.context){o.context=o.context.prev}}function d(C){if(C=="openTag"){o.tagName=g;return f(p,c(o.startOfLine))}else{if(C=="closeTag"){v();return f(u)}else{if(C=="string"){if(!o.context||o.context.name!="!cdata"){l("!cdata")}if(o.tokenize==s){v()}return f()}else{return f()}}}}function c(C){return function(D){if(D=="selfcloseTag"||(D=="endTag"&&A.autoSelfClosers.hasOwnProperty(o.tagName.toLowerCase()))){return f()}if(D=="endTag"){l(o.tagName,C);return f()}return f()}}function u(C){if(C=="endTag"){return f()}return b()}function p(C){if(C=="word"){k="attribute";return f(p)}if(C=="equals"){return f(w,p)}return b()}function w(C){if(C=="word"&&A.allowUnquoted){k="string";return f()}if(C=="string"){return f()}return b()}return{startState:function(){return{tokenize:s,cc:[],indented:0,startOfLine:true,tagName:null,context:null}},token:function(F,E){if(F.sol()){E.startOfLine=true;E.indented=F.indentation()}if(F.eatSpace()){return null}k=h=g=null;var D=E.tokenize(F,E);if((D||h)&&D!="xml-comment"){o=E;while(true){var C=E.cc.pop()||d;if(C(h||D)){break}}}E.startOfLine=false;return k||D},indent:function(E,C){var D=E.context;if(D&&D.noIndent){return 0}if(a&&/<!\[CDATA\[/.test(C)){return 0}if(D&&/^<\//.test(C)){D=D.prev}while(D&&!D.startOfLine){D=D.prev}if(D){return D.indent+t}else{return 0}},electricChars:"/"}});CodeMirror.defineMIME("application/xml","xmlami");CodeMirror.defineMIME("text/html",{name:"xmlami",htmlMode:true});CodeMirror.defineMode("htmlmixedami",function(b,d){var a=CodeMirror.getMode(b,{name:"xmlami",htmlMode:true});var c=CodeMirror.getMode(b,"javascript");var l=CodeMirror.getMode(b,"css");function f(o,n){var m=a.token(o,n.htmlState);if(m=="tag"&&o.current()==">"&&n.htmlState.context){if(/^script$/i.test(n.htmlState.context.tagName)){n.token=k;n.localState=c.startState(a.indent(n.htmlState,""))}else{if(/^style$/i.test(n.htmlState.context.tagName)){n.token=g;n.localState=l.startState(a.indent(n.htmlState,""))}}}return m}function h(q,m,n){var p=q.current();var o=p.search(m);if(o>-1){q.backUp(p.length-o)}return n}function k(n,m){if(n.match(/^<\/\s*script\s*>/i,false)){m.token=f;m.curState=null;return f(n,m)}return h(n,/<\/\s*script\s*>/,c.token(n,m.localState))}function g(n,m){if(n.match(/^<\/\s*style\s*>/i,false)){m.token=f;m.localState=null;return f(n,m)}return h(n,/<\/\s*style\s*>/,l.token(n,m.localState))}return{startState:function(){var m=a.startState();return{token:f,localState:null,htmlState:m}},copyState:function(n){if(n.localState){var m=CodeMirror.copyState(n.token==g?l:c,n.localState)}return{token:n.token,localState:m,htmlState:CodeMirror.copyState(a,n.htmlState)}},token:function(n,m){return m.token(n,m)},indent:function(n,m){if(n.token==f||/^\s*<\//.test(m)){return a.indent(n.htmlState,m)}else{if(n.token==k){return c.indent(n.localState,m)}else{return l.indent(n.localState,m)}}},electricChars:"/{}:"}});CodeMirror.defineMIME("text/html","htmlmixedami");CodeMirror.overlayParser=function(b,a,c){return{startState:function(){return{base:CodeMirror.startState(b),overlay:CodeMirror.startState(a),basePos:0,baseCur:null,overlayPos:0,overlayCur:null}},copyState:function(d){return{base:CodeMirror.copyState(b,d.base),overlay:CodeMirror.copyState(a,d.overlay),basePos:d.basePos,baseCur:null,overlayPos:d.overlayPos,overlayCur:null}},token:function(f,d){if(f.start==d.basePos){d.baseCur=b.token(f,d.base);d.basePos=f.pos}if(f.start==d.overlayPos){f.pos=f.start;d.overlayCur=a.token(f,d.overlay);d.overlayPos=f.pos}f.pos=Math.min(d.basePos,d.overlayPos);if(f.eol()){d.basePos=d.overlayPos=0}if(d.overlayCur==null){return d.baseCur}if(d.baseCur!=null&&c){return d.baseCur+" "+d.overlayCur}else{return d.overlayCur}},indent:b.indent&&function(f,d){return b.indent(f.base,d)},electricChars:b.electricChars}};CodeMirror.defineMode("amitpl",function(a,b){var c="";var d={startState:function(f){return{amiConstruction:[]}},token:function(g,f){className=null;if(f.amiConstruction==""){if(g.match(/^##--/)){f.amiConstruction=c="comment";return"ami-comment"}else{if(g.match(/^%%include_(template|language)\s/i)){f.amiConstruction=c="include";return"ami-include"}else{if(g.match(/^<!--#set/i)){f.amiConstruction=c="set";return"ami-set"}else{if(g.match(/^"-->/)){return"ami-set"}else{if(g.match(/^##set(?:global)?var\s+/i)){f.amiConstruction=c="setvar";return"ami-setvar"}else{if(g.match(/^##if\(/i)||g.match(/^##else\s?if\(/i)){f.amiConstruction=c="if";return"ami-if"}else{if(g.match(/^##else##/i)||g.match(/^##endif##/i)){return"ami-if"}else{if(g.match(/^##__[A-Z_]+__##/)){return"ami-debug"}else{if(g.match(/^##/)){f.amiConstruction=c="var";return"ami-var"}else{if(g.match(/^%%/i)){f.amiConstruction=c="langvar";return"ami-langvar"}else{g.next()}}}}}}}}}}}else{switch(f.amiConstruction){case"include":className="ami-include";f.amiConstruction=c=this.moveTo(g,/^%%/)?"":c;break;case"set":f.amiConstruction=c=this.moveTo(g,/^var="/i)?"setname":c;break;case"setname":className="ami-setname";g.eatWhile(/[^"]/);f.amiConstruction=c="";break;case"setvar":if(g.match(/^##/)){className="ami-setvar";f.amiConstruction=c=""}else{g.next();className="ami-setvar-expr"}break;case"if":if(g.match(/^\)##/)){className="ami-if";f.amiConstruction=c=""}else{g.next();className="ami-if-expr"}break;case"var":className="ami-var";f.amiConstruction=c=this.moveTo(g,/^##/)?"":c;break;case"langvar":className="ami-langvar";f.amiConstruction=c=this.moveTo(g,/^%%/)?"":c;break;case"comment":className="ami-comment";f.amiConstruction=c=this.moveTo(g,/^--##/)?"":c;break}}return className},moveTo:function(h,f){var g=false;while(!h.eol()){if(h.match(f)){g=true;break}h.next()}return g}};return CodeMirror.overlayParser(CodeMirror.getMode(a,b.backdrop||"text/html"),d)});CodeMirror.defineMode("amitplbb",function(config,parserConfig){var amiConstruction="";var amitplOverlay={startState:function(base){return{amiConstruction:[]}},token:function(stream,state){className=null;var scRet=eval('"\\u21B5"');var scSpc=eval('"\\u00B7"');var specRegexp=new RegExp("^("+scRet+"|"+scSpc+")");if(state.amiConstruction==""){if(stream.match(/^##/)){state.amiConstruction=amiConstruction="var";return"ami-var"}else{if(stream.match(/^%%/i)){state.amiConstruction=amiConstruction="langvar";return"ami-langvar"}else{if(stream.match(/^\[RAW\]/i)){state.amiConstruction=amiConstruction="raw";return"ami-raw"}else{if(stream.match(specRegexp)){state.amiConstruction=amiConstruction="special";return"ami-raw"}else{if(stream.match(/^\[\/?(B|S|P|I|U|H1|H2|H3|H4|H5|DIV|LEFT|RIGHT|CENTER|JUSTIFY|INDENT|URL|IMG|OL|LIST|\*|Q|CODE|FONT|SIZE|COLOR)(\=[^\]]*?)?\]/i)){state.amiConstruction=amiConstruction="";return"ami-bb"}else{stream.next()}}}}}}else{switch(state.amiConstruction){case"special":state.amiConstruction=amiConstruction="";break;case"raw":className="ami-raw";state.amiConstruction=amiConstruction=this.moveTo(stream,/^\[\/RAW\]/i)?"":amiConstruction;break;case"var":className="ami-var";state.amiConstruction=amiConstruction=this.moveTo(stream,/^##/)?"":amiConstruction;break;case"langvar":className="ami-langvar";state.amiConstruction=amiConstruction=this.moveTo(stream,/^%%/)?"":amiConstruction;break}}return className},moveTo:function(stream,terminator){var res=false;while(!stream.eol()){if(stream.match(terminator)){res=true;break}stream.next()}return res}};return CodeMirror.overlayParser(CodeMirror.getMode(config,parserConfig.backdrop||"text/html"),amitplOverlay)});eval(function(h,b,l,d,g,f){g=function(a){return(a<b?"":g(parseInt(a/b)))+((a=a%b)>35?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){while(l--){f[g(l)]=d[l]||g(l)}d=[function(a){return f[a]}];g=function(){return"\\w+"};l=1}while(l--){if(d[l]){h=h.replace(new RegExp("\\b"+g(l)+"\\b","g"),d[l])}}return h}(";(8($){j e={},9,m,B,A=$.2u.2g&&/29\\s(5\\.5|6\\.)/.1M(1H.2t),M=12;$.k={w:12,1h:{Z:25,r:12,1d:19,X:\"\",G:15,E:15,16:\"k\"},2s:8(){$.k.w=!$.k.w}};$.N.1v({k:8(a){a=$.1v({},$.k.1h,a);1q(a);g 2.F(8(){$.1j(2,\"k\",a);2.11=e.3.n(\"1g\");2.13=2.m;$(2).24(\"m\");2.22=\"\"}).21(1e).1U(q).1S(q)},H:A?8(){g 2.F(8(){j b=$(2).n('Y');4(b.1J(/^o\\([\"']?(.*\\.1I)[\"']?\\)$/i)){b=1F.$1;$(2).n({'Y':'1D','1B':\"2r:2q.2m.2l(2j=19, 2i=2h, 1p='\"+b+\"')\"}).F(8(){j a=$(2).n('1o');4(a!='2f'&&a!='1u')$(2).n('1o','1u')})}})}:8(){g 2},1l:A?8(){g 2.F(8(){$(2).n({'1B':'',Y:''})})}:8(){g 2},1x:8(){g 2.F(8(){$(2)[$(2).D()?\"l\":\"q\"]()})},o:8(){g 2.1k('28')||2.1k('1p')}});8 1q(a){4(e.3)g;e.3=$('<t 16=\"'+a.16+'\"><10></10><t 1i=\"f\"></t><t 1i=\"o\"></t></t>').27(K.f).q();4($.N.L)e.3.L();e.m=$('10',e.3);e.f=$('t.f',e.3);e.o=$('t.o',e.3)}8 7(a){g $.1j(a,\"k\")}8 1f(a){4(7(2).Z)B=26(l,7(2).Z);p l();M=!!7(2).M;$(K.f).23('W',u);u(a)}8 1e(){4($.k.w||2==9||(!2.13&&!7(2).U))g;9=2;m=2.13;4(7(2).U){e.m.q();j a=7(2).U.1Z(2);4(a.1Y||a.1V){e.f.1c().T(a)}p{e.f.D(a)}e.f.l()}p 4(7(2).18){j b=m.1T(7(2).18);e.m.D(b.1R()).l();e.f.1c();1Q(j i=0,R;(R=b[i]);i++){4(i>0)e.f.T(\"<1P/>\");e.f.T(R)}e.f.1x()}p{e.m.D(m).l();e.f.q()}4(7(2).1d&&$(2).o())e.o.D($(2).o().1O('1N://','')).l();p e.o.q();e.3.P(7(2).X);4(7(2).H)e.3.H();1f.1L(2,1K)}8 l(){B=S;4((!A||!$.N.L)&&7(9).r){4(e.3.I(\":17\"))e.3.Q().l().O(7(9).r,9.11);p e.3.I(':1a')?e.3.O(7(9).r,9.11):e.3.1G(7(9).r)}p{e.3.l()}u()}8 u(c){4($.k.w)g;4(c&&c.1W.1X==\"1E\"){g}4(!M&&e.3.I(\":1a\")){$(K.f).1b('W',u)}4(9==S){$(K.f).1b('W',u);g}e.3.V(\"z-14\").V(\"z-1A\");j b=e.3[0].1z;j a=e.3[0].1y;4(c){b=c.2o+7(9).E;a=c.2n+7(9).G;j d='1w';4(7(9).2k){d=$(C).1r()-b;b='1w'}e.3.n({E:b,14:d,G:a})}j v=z(),h=e.3[0];4(v.x+v.1s<h.1z+h.1n){b-=h.1n+20+7(9).E;e.3.n({E:b+'1C'}).P(\"z-14\")}4(v.y+v.1t<h.1y+h.1m){a-=h.1m+20+7(9).G;e.3.n({G:a+'1C'}).P(\"z-1A\")}}8 z(){g{x:$(C).2e(),y:$(C).2d(),1s:$(C).1r(),1t:$(C).2p()}}8 q(a){4($.k.w)g;4(B)2c(B);9=S;j b=7(2);8 J(){e.3.V(b.X).q().n(\"1g\",\"\")}4((!A||!$.N.L)&&b.r){4(e.3.I(':17'))e.3.Q().O(b.r,0,J);p e.3.Q().2b(b.r,J)}p J();4(7(2).H)e.3.1l()}})(2a);",62,155,"||this|parent|if|||settings|function|current||||||body|return|||var|tooltip|show|title|css|url|else|hide|fade||div|update||blocked|||viewport|IE|tID|window|html|left|each|top|fixPNG|is|complete|document|bgiframe|track|fn|fadeTo|addClass|stop|part|null|append|bodyHandler|removeClass|mousemove|extraClass|backgroundImage|delay|h3|tOpacity|false|tooltipText|right||id|animated|showBody|true|visible|unbind|empty|showURL|save|handle|opacity|defaults|class|data|attr|unfixPNG|offsetHeight|offsetWidth|position|src|createHelper|width|cx|cy|relative|extend|auto|hideWhenEmpty|offsetTop|offsetLeft|bottom|filter|px|none|OPTION|RegExp|fadeIn|navigator|png|match|arguments|apply|test|http|replace|br|for|shift|click|split|mouseout|jquery|target|tagName|nodeType|call||mouseover|alt|bind|removeAttr|200|setTimeout|appendTo|href|MSIE|jQuery|fadeOut|clearTimeout|scrollTop|scrollLeft|absolute|msie|crop|sizingMethod|enabled|positionLeft|AlphaImageLoader|Microsoft|pageY|pageX|height|DXImageTransform|progid|block|userAgent|browser".split("|"),0,{}));var dummyVar=null;if(typeof(jQuery.widget)!="undefined"){(function(b,c){var a=0;var d=b(document);b.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:false,multiple:true,position:{},appendTo:"body"},_create:function(){var k=this.element.hide();var m=this.options;this.speed=b.fx.speeds._default;this._isOpen=false;this._namespaceID=this.eventNamespace||("multiselect"+a);var h=(this.button=b('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(m.classes).attr({title:k.attr("title"),"aria-haspopup":true,tabIndex:k.attr("tabIndex")}).insertAfter(k),f=(this.buttonlabel=b("<span />")).prependTo(h),l=(this.menu=b("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(m.classes).appendTo(b(m.appendTo)),p=(this.header=b("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(l),g=(this.headerLinkContainer=b("<ul />")).addClass("ui-helper-reset").html(function(){if(m.header===true){return"<li>"+AMI.Template.Locale.get("multiselect_mark")+':</li><li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+m.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+m.uncheckAllText+"</span></a></li>"}else{if(typeof m.header==="string"){return"<li>"+m.header+"</li>"}else{return""}}}).appendTo(p),n=(this.checkboxContainer=b("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(l);this._bindEvents();this.refresh(true);if(!m.multiple){l.addClass("ui-multiselect-single")}a++},_init:function(){if(this.options.header===false){this.header.hide()}if(!this.options.multiple){this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide()}if(this.options.autoOpen){this.open()}if(this.element.is(":disabled")){this.disable()}},refresh:function(m){var h=this.element;var l=this.options;var k=this.menu;var p=this.checkboxContainer;var f=[];var g="";var n=h.attr("id")||a++;h.find("option").each(function(s){var t=b(this);var A=this.parentNode;var C=this.innerHTML;var w=this.innerHTML;var z=this.value;var q="ui-multiselect-"+(this.id||n+"-option-"+s);var D=this.disabled;var o=this.selected;var v=["ui-corner-all"];var u=(D?"ui-multiselect-disabled ":" ")+this.className;var B;if(A.tagName==="OPTGROUP"){B=A.getAttribute("label");if(b.inArray(B,f)===-1){g+='<li class="ui-multiselect-optgroup-label '+A.className+'"><a href="#">'+B+"</a></li>";f.push(B)}}if(D){v.push("ui-state-disabled")}if(o&&!l.multiple){v.push("ui-state-active")}g+='<li class="'+u+'">';g+='<label for="'+q+'" title="'+w+'" class="'+v.join(" ")+'">';g+='<input id="'+q+'" name="multiselect_'+n+'" type="'+(l.multiple?"checkbox":"radio")+'" value="'+z+'" title="'+w+'"';if(o){g+=' checked="checked"';g+=' aria-selected="true"'}if(D){g+=' disabled="disabled"';g+=' aria-disabled="true"'}g+=" /><span>"+C+"</span></label></li>"});p.html(g);this.labels=k.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!m){this._trigger("refresh")}},update:function(){var m=this.options;var h=this.inputs;var g=h.filter(":checked");var k=g.length;var l;if(k===0){l='<span class="option_text">'+m.noneSelectedText+"</span>";this.buttonlabel.addClass("notSelected")}else{this.buttonlabel.removeClass("notSelected");if(b.isFunction(m.selectedText)){l=m.selectedText.call(this,k,h.length,g.get())}else{if(/\d/.test(m.selectedList)&&m.selectedList>0&&k<=m.selectedList){var f=[];g.map(function(){return b(this).next().html()}).get().forEach(function(o,n){if(n<m.selectedList){f.push(o)}});l='<span class="option_text">'+f.join(", ")+"</span>"}else{var p=k-m.selectedList;var f=[];g.map(function(){return b(this).next().html()}).get().forEach(function(o,n){if(n<m.selectedList){f.push(o)}});l='<span class="option_text">'+f.join(", ")+'</span> <span class="and_also"><span class="opacity"><span class="first_opacity"></span><span class="second_opacity"></span><span class="th_opacity"></span><span class="fo_opacity"></span><span class="fi_opacity"></span></span><span class="no_opacity">'+AMI.Template.Locale.get("multiselect_andAlso")+" "+p+"</span></span>"}}}this._setButtonValue(l);return l},_setButtonValue:function(f){this.buttonlabel.html(f)},_bindEvents:function(){var f=this;var g=this.button;function h(){f[f._isOpen?"close":"open"]();return false}g.find("span").bind("click.multiselect",h);g.bind({click:h,keypress:function(k){switch(k.which){case 27:case 38:case 37:f.close();break;case 39:case 40:f.open();break}},mouseenter:function(){if(!g.hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},mouseleave:function(){b(this).removeClass("ui-state-hover")},focus:function(){if(!g.hasClass("ui-state-disabled")){b(this).addClass("ui-state-focus")}},blur:function(){b(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(k){if(b(this).hasClass("ui-multiselect-close")){f.close()}else{f[b(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]()}k.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(o){o.preventDefault();var n=b(this);var m=n.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)");var k=m.get();var l=n.parent().text();if(f._trigger("beforeoptgrouptoggle",o,{inputs:k,label:l})===false){return}f._toggleChecked(m.filter(":checked").length!==m.length,m);f._trigger("optgrouptoggle",o,{inputs:k,label:l,checked:k[0].checked})}).delegate("label","mouseenter.multiselect",function(){if(!b(this).hasClass("ui-state-disabled")){f.labels.removeClass("ui-state-hover");b(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown.multiselect",function(k){k.preventDefault();switch(k.which){case 9:case 27:f.close();break;case 38:case 40:case 37:case 39:f._traverse(k.which,this);break;case 13:b(this).find("input")[0].click();break;case 32:b(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(n){var m=b(this);var o=this.value;var l=this.checked;var k=f.element.find("option");if(this.disabled||f._trigger("click",n,{value:o,text:this.title,checked:l})===false){n.preventDefault();return}m.focus();m.attr("aria-selected",l);k.each(function(){if(this.value===o){this.selected=l}else{if(!f.options.multiple){this.selected=false}}});if(!f.options.multiple){f.labels.removeClass("ui-state-active");m.closest("label").toggleClass("ui-state-active",l);f.close()}f.element.trigger("change");setTimeout(b.proxy(f.update,f),10)});d.bind("mousedown."+this._namespaceID,function(k){var l=k.target;if(f._isOpen&&l!==f.button[0]&&l!==f.menu[0]&&!b.contains(f.menu[0],l)&&!b.contains(f.button[0],l)){f.close()}});b(this.element[0].form).bind("reset.multiselect",function(){setTimeout(b.proxy(f.refresh,f),10)})},_setButtonWidth:function(){var f=this.element.outerWidth();var g=this.options;if(/\d/.test(g.minWidth)&&f<g.minWidth){f=g.minWidth}this.button.outerWidth(f)},_setMenuWidth:function(){var f=this.menu;f.outerWidth(this.button.outerWidth())},_traverse:function(l,m){var h=b(m);var g=l===38||l===37;var f=h.parent()[g?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)").first();if(!f.length){var k=this.menu.find("ul").last();this.menu.find("label")[g?"last":"first"]().trigger("mouseover");k.scrollTop(g?k.height():0)}else{if(!g){f.find("label").trigger("mouseover")}else{h.parent().prev().find("label").trigger("mouseover")}}},_toggleState:function(g,f){return function(){if(!this.disabled){this[g]=f}if(f){this.setAttribute("aria-selected",true)}else{this.removeAttribute("aria-selected")}}},_toggleChecked:function(f,l){var k=(l&&l.length)?l:this.inputs;var h=this;k.each(this._toggleState("checked",f));k.eq(0).focus();this.update();var g=k.map(function(){return this.value}).get();this.element.find("option").each(function(){if(!this.disabled&&b.inArray(this.value,g)>-1){h._toggleState("selected",f).call(this)}});if(k.length){this.element.trigger("change")}},_toggleDisabled:function(g){this.button.attr({disabled:g,"aria-disabled":g})[g?"addClass":"removeClass"]("ui-state-disabled");var f=this.menu.find("input");var h="ech-multiselect-disabled";if(g){f=f.filter(":enabled").data(h,true)}else{f=f.filter(function(){return b.data(this,h)===true}).removeData(h)}f.attr({disabled:g,"arial-disabled":g}).parent()[g?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:g,"aria-disabled":g})},open:function(l){var p=this;var k=this.button;var f=this.menu;var h=this.speed;var g=this.options;var m=[];if(this._trigger("beforeopen")===false||k.hasClass("ui-state-disabled")||this._isOpen){return}var n=f.find("ul").last();var q=g.show;if(b.isArray(g.show)){q=g.show[0];h=g.show[1]||p.speed}if(q){m=[q,h]}n.scrollTop(0).height(g.height);this.position();b.fn.show.apply(f,m);this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");k.addClass("ui-state-active");this._isOpen=true;this._trigger("open")},close:function(){if(this._trigger("beforeclose")===false){return}var k=this.options;var g=k.hide;var h=this.speed;var f=[];if(b.isArray(k.hide)){g=k.hide[0];h=k.hide[1]||this.speed}if(g){f=[g,h]}b.fn.hide.apply(this.menu,f);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=false;this._trigger("close")},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(f){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){b.Widget.prototype.destroy.call(this);d.unbind(this._namespaceID);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){var f=this.options;if(b.ui.position&&!b.isEmptyObject(f.position)){f.position.of=f.position.of||this.button;this.menu.show().position(f.position).hide()}else{var g=this.button.offset();this.menu.css({top:g.top+this.button.outerHeight(),left:g.left})}},_setOption:function(f,g){var h=this.menu;switch(f){case"header":h.find("div.ui-multiselect-header")[g?"show":"hide"]();break;case"checkAllText":h.find("a.ui-multiselect-all span").eq(-1).text(g);break;case"uncheckAllText":h.find("a.ui-multiselect-none span").eq(-1).text(g);break;case"height":h.find("ul").last().height(parseInt(g,10));break;case"minWidth":this.options[f]=parseInt(g,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[f]=g;this.update();break;case"classes":h.add(this.button).removeClass(this.options.classes).addClass(g);break;case"multiple":h.toggleClass("ui-multiselect-single",!g);this.options.multiple=g;this.element[0].multiple=g;this.refresh();break;case"position":this.position()}b.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery)}var dummyVar=null;(function(){var g,a,h,d,f,b={}.hasOwnProperty,c=function(n,l){for(var k in l){if(b.call(l,k)){n[k]=l[k]}}function m(){this.constructor=n}m.prototype=l.prototype;n.prototype=new m();n.__super__=l.prototype;return n};d=(function(){function k(){this.options_index=0;this.parsed=[]}k.prototype.add_node=function(l){if(l.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(l)}else{return this.add_option(l)}};k.prototype.add_group=function(s){var q,n,p,m,o,l;q=this.parsed.length;this.parsed.push({array_index:q,group:true,label:this.escapeExpression(s.label),children:0,disabled:s.disabled});o=s.childNodes;l=[];for(p=0,m=o.length;p<m;p++){n=o[p];l.push(this.add_option(n,q,s.disabled))}return l};k.prototype.add_option=function(m,n,l){if(m.nodeName.toUpperCase()==="OPTION"){if(m.text!==""){if(n!=null){this.parsed[n].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:m.value,text:m.text,html:m.innerHTML,selected:m.selected,disabled:l===true?l:m.disabled,group_array_index:n,classes:m.className,style:m.style.cssText,search_in_attr:g(m).data("search")})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};k.prototype.escapeExpression=function(n){var m,l;if((n==null)||n===false){return""}if(!/[\&\<\>\"\'\`]/.test(n)){return n}m={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};l=/&(?!\w+;)|[\<\>\"\'\`]/g;return n.replace(l,function(o){return m[o]||"&amp;"})};return k})();d.select_to_array=function(k){var p,o,n,l,m;o=new d();m=k.childNodes;for(n=0,l=m.length;n<l;n++){p=m[n];o.add_node(p)}return o.parsed};a=(function(){function k(l,m){this.form_field=l;this.options=m!=null?m:{};if(!k.browser_is_supported()){return}this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers()}k.prototype.set_default_values=function(){var l=this;this.click_test_action=function(m){return l.test_active_click(m)};this.activate_action=function(m){return l.activate_field(m)};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||false;this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:true;this.search_in_attr=this.options.search_in_attr!=null?this.options.search_in_attr:false;return this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:true};k.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder")}else{if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||k.default_multiple_text}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||k.default_single_text}}return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||k.default_no_result_text};k.prototype.mouse_enter=function(){return this.mouse_on_container=true};k.prototype.mouse_leave=function(){return this.mouse_on_container=false};k.prototype.input_focus=function(l){var m=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return m.container_mousedown()}),50)}}else{if(!this.active_field){return this.activate_field()}}};k.prototype.input_blur=function(l){var m=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return m.blur_test()}),100)}};k.prototype.results_option_build=function(m){var n,q,p,l,o;n="";o=this.results_data;for(p=0,l=o.length;p<l;p++){q=o[p];if(q.group){n+=this.result_add_group(q)}else{n+=this.result_add_option(q)}if(m!=null?m.first:void 0){if(q.selected&&this.is_multiple){this.choice_build(q)}else{if(q.selected&&!this.is_multiple){this.single_set_selected_text(q.text)}}}}return n};k.prototype.result_add_option=function(n){var l,m;if(!n.search_match){return""}if(!this.include_option_in_results(n)){return""}l=[];if(!n.disabled&&!(n.selected&&this.is_multiple)){l.push("active-result")}if(n.disabled&&!(n.selected&&this.is_multiple)){l.push("disabled-result")}if(n.selected){l.push("result-selected")}if(n.group_array_index!=null){l.push("group-option")}if(n.classes!==""){l.push(n.classes)}m=n.style.cssText!==""?' style="'+n.style+'"':"";return'<li class="'+(l.join(" "))+'"'+m+' data-option-array-index="'+n.array_index+'">'+n.search_text+"</li>"};k.prototype.result_add_group=function(l){if(!(l.search_match||l.group_match)){return""}if(!(l.active_options>0)){return""}return'<li class="group-result">'+l.search_text+"</li>"};k.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup()}this.result_clear_highlight();this.result_single_selected=null;this.results_build();if(this.results_showing){return this.winnow_results()}};k.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};k.prototype.results_search=function(l){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};k.prototype.winnow_results=function(){var A,q,u,v,p,l,z,s,w,m,n,t,o;this.no_results_clear();p=0;z=this.get_search_text();A=z.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");v=this.search_contains?"":"^";u=new RegExp(v+A,"i");m=new RegExp(A,"i");o=this.results_data;for(n=0,t=o.length;n<t;n++){q=o[n];q.search_match=false;l=null;if(this.include_option_in_results(q)){if(q.group){q.group_match=false;q.active_options=0}if((q.group_array_index!=null)&&this.results_data[q.group_array_index]){l=this.results_data[q.group_array_index];if(l.active_options===0&&l.search_match){p+=1}l.active_options+=1}if(!(q.group&&!this.group_search)){q.search_text=q.group?q.label:q.html;q.search_match=this.search_string_match(q.search_text,u);if(!q.search_match&&q.search_in_attr){q.search_match=this.search_string_match(q.search_in_attr,u)}if(q.search_match&&!q.group){p+=1}if(q.search_match){if(z.length){s=q.search_text.search(m);if(-1!==s){w=q.search_text.substr(0,s+z.length)+"</em>"+q.search_text.substr(s+z.length);q.search_text=w.substr(0,s)+"<em>"+w.substr(s)}}if(l!=null){l.group_match=true}}else{if((q.group_array_index!=null)&&this.results_data[q.group_array_index].search_match){q.search_match=true}}}}}this.result_clear_highlight();if(p<1&&z.length){this.update_results_content("");return this.no_results(z)}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight()}};k.prototype.search_string_match=function(q,n){var m,p,o,l;if(n.test(q)){return true}else{if(this.enable_split_word_search&&(q.indexOf(" ")>=0||q.indexOf("[")===0)){p=q.replace(/\[|\]/g,"").split(" ");if(p.length){for(o=0,l=p.length;o<l;o++){m=p[o];if(n.test(m)){return true}}}}}};k.prototype.choices_count=function(){var m,o,l,n;if(this.selected_option_count!=null){return this.selected_option_count}this.selected_option_count=0;n=this.form_field.options;for(o=0,l=n.length;o<l;o++){m=n[o];if(m.selected){this.selected_option_count+=1}}return this.selected_option_count};k.prototype.choices_click=function(l){l.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show()}};k.prototype.keyup_checker=function(l){var n,m;n=(m=l.which)!=null?m:l.keyCode;this.search_field_scale();switch(n){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke()}else{if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}}break;case 13:l.preventDefault();if(this.results_showing){return this.result_select(l)}break;case 27:if(this.results_showing){this.results_hide()}return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};k.prototype.container_width=function(){if(this.options.width!=null){return this.options.width}else{return""+this.form_field.offsetWidth+"px"}};k.prototype.include_option_in_results=function(l){if(this.is_multiple&&(!this.display_selected_options&&l.selected)){return false}if(!this.display_disabled_options&&l.disabled){return false}if(l.empty){return false}return true};k.browser_is_supported=function(){if(window.navigator.appName==="Microsoft Internet Explorer"){return document.documentMode>=8}if(/iP(od|hone)/i.test(window.navigator.userAgent)){return false}if(/Android/i.test(window.navigator.userAgent)){if(/Mobile/i.test(window.navigator.userAgent)){return false}}return true};k.default_multiple_text="Select Some Options";k.default_single_text="Select an Option";k.default_no_result_text="No results match";return k})();g=jQuery;g.fn.extend({chosen:function(k){if(!a.browser_is_supported()){return this}return this.each(function(m){var n,l;n=g(this);l=n.data("chosen");if(k==="destroy"&&l){l.destroy()}else{if(!l){n.data("chosen",new h(this,k))}}})}});h=(function(k){c(l,k);function l(){f=l.__super__.constructor.apply(this,arguments);return f}l.prototype.setup=function(){this.form_field_jq=g(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")};l.prototype.set_up_html=function(){var m,n;m=["chosen-container"];m.push("chosen-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){m.push(this.form_field.className)}if(this.is_rtl){m.push("chosen-rtl")}n={"class":m.join(" "),style:"width: "+(this.container_width())+";",title:this.form_field.title};if(this.form_field.id.length){n.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"}this.container=g("<div />",n);if(this.is_multiple){this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>')}else{this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>')}this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find("div.chosen-drop").first();this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chosen-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chosen-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chosen-search").first();this.selected_item=this.container.find(".chosen-single").first()}this.results_build();this.set_tab_index();this.set_label_behavior();return this.form_field_jq.trigger("chosen:ready",{chosen:this})};l.prototype.register_observers=function(){var m=this;this.container.bind("mousedown.chosen",function(n){m.container_mousedown(n)});this.container.bind("mouseup.chosen",function(n){m.container_mouseup(n)});this.container.bind("mouseenter.chosen",function(n){m.mouse_enter(n)});this.container.bind("mouseleave.chosen",function(n){m.mouse_leave(n)});this.search_results.bind("mouseup.chosen",function(n){m.search_results_mouseup(n)});this.search_results.bind("mouseover.chosen",function(n){m.search_results_mouseover(n)});this.search_results.bind("mouseout.chosen",function(n){m.search_results_mouseout(n)});this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(n){m.search_results_mousewheel(n)});this.form_field_jq.bind("chosen:updated.chosen",function(n){m.results_update_field(n)});this.form_field_jq.bind("chosen:activate.chosen",function(n){m.activate_field(n)});this.form_field_jq.bind("chosen:open.chosen",function(n){m.container_mousedown(n)});this.search_field.bind("blur.chosen",function(n){m.input_blur(n)});this.search_field.bind("keyup.chosen",function(n){m.keyup_checker(n)});this.search_field.bind("keydown.chosen",function(n){m.keydown_checker(n)});this.search_field.bind("focus.chosen",function(n){m.input_focus(n)});if(this.is_multiple){return this.search_choices.bind("click.chosen",function(n){m.choices_click(n)})}else{return this.container.bind("click.chosen",function(n){n.preventDefault()})}};l.prototype.destroy=function(){g(document).unbind("click.chosen",this.click_test_action);if(this.search_field[0].tabIndex){this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex}this.container.remove();this.form_field_jq.removeData("chosen");return this.form_field_jq.show()};l.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass("chosen-disabled");this.search_field[0].disabled=true;if(!this.is_multiple){this.selected_item.unbind("focus.chosen",this.activate_action)}return this.close_field()}else{this.container.removeClass("chosen-disabled");this.search_field[0].disabled=false;if(!this.is_multiple){return this.selected_item.bind("focus.chosen",this.activate_action)}}};l.prototype.container_mousedown=function(m){if(!this.is_disabled){if(m&&m.type==="mousedown"&&!this.results_showing){m.preventDefault()}if(!((m!=null)&&(g(m.target)).hasClass("search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}g(document).bind("click.chosen",this.click_test_action);this.results_show()}else{if(!this.is_multiple&&m&&((g(m.target)[0]===this.selected_item[0])||g(m.target).parents("a.chosen-single").length)){m.preventDefault();this.results_toggle()}}return this.activate_field()}}};l.prototype.container_mouseup=function(m){if(m.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(m)}};l.prototype.search_results_mousewheel=function(n){var p,m,o;p=-((m=n.originalEvent)!=null?m.wheelDelta:void 0)||((o=n.originialEvent)!=null?o.detail:void 0);if(p!=null){n.preventDefault();if(n.type==="DOMMouseScroll"){p=p*40}return this.search_results.scrollTop(p+this.search_results.scrollTop())}};l.prototype.blur_test=function(m){if(!this.active_field&&this.container.hasClass("chosen-container-active")){return this.close_field()}};l.prototype.close_field=function(){g(document).unbind("click.chosen",this.click_test_action);this.active_field=false;this.results_hide();this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};l.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};l.prototype.test_active_click=function(m){if(this.container.is(g(m.target).closest(".chosen-container"))){return this.active_field=true}else{return this.close_field()}};l.prototype.results_build=function(){this.parsing=true;this.selected_option_count=null;this.results_data=d.select_to_array(this.form_field);if(this.is_multiple){this.search_choices.find("li.search-choice").remove()}else{if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field[0].readOnly=true;this.container.addClass("chosen-container-single-nosearch")}else{this.search_field[0].readOnly=false;this.container.removeClass("chosen-container-single-nosearch")}}}this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false};l.prototype.result_do_highlight=function(n){var s,q,o,p,m;if(n.length){this.result_clear_highlight();this.result_highlight=n;this.result_highlight.addClass("highlighted");o=parseInt(this.search_results.css("maxHeight"),10);m=this.search_results.scrollTop();p=o+m;q=this.result_highlight.position().top+this.search_results.scrollTop();s=q+this.result_highlight.outerHeight();if(s>=p){return this.search_results.scrollTop((s-o)>0?s-o:0)}else{if(q<m){return this.search_results.scrollTop(q)}}}};l.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};l.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}this.container.addClass("chosen-with-drop");this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this});this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};l.prototype.update_results_content=function(m){return this.search_results.html(m)};l.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();this.container.removeClass("chosen-with-drop");this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})}return this.results_showing=false};l.prototype.set_tab_index=function(n){var m;if(this.form_field.tabIndex){m=this.form_field.tabIndex;this.form_field.tabIndex=-1;return this.search_field[0].tabIndex=m}};l.prototype.set_label_behavior=function(){var m=this;this.form_field_label=this.form_field_jq.parents("label");if(!this.form_field_label.length&&this.form_field.id.length){this.form_field_label=g("label[for='"+this.form_field.id+"']")}if(this.form_field_label.length>0){return this.form_field_label.bind("click.chosen",function(n){if(m.is_multiple){return m.container_mousedown(n)}else{return m.activate_field()}})}};l.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};l.prototype.search_results_mouseup=function(m){var n;n=g(m.target).hasClass("active-result")?g(m.target):g(m.target).parents(".active-result").first();if(n.length){this.result_highlight=n;this.result_select(m);return this.search_field.focus()}};l.prototype.search_results_mouseover=function(m){var n;n=g(m.target).hasClass("active-result")?g(m.target):g(m.target).parents(".active-result").first();if(n){return this.result_do_highlight(n)}};l.prototype.search_results_mouseout=function(m){if(g(m.target).hasClass("active-result"||g(m.target).parents(".active-result").first())){return this.result_clear_highlight()}};l.prototype.choice_build=function(n){var m,o,p=this;m=g("<li />",{"class":"search-choice"}).html("<span>"+n.html+"</span>");if(n.disabled){m.addClass("search-choice-disabled")}else{o=g("<a />",{"class":"search-choice-close","data-option-array-index":n.array_index});o.bind("click.chosen",function(q){return p.choice_destroy_link_click(q)});m.append(o)}return this.search_container.before(m)};l.prototype.choice_destroy_link_click=function(m){m.preventDefault();m.stopPropagation();if(!this.is_disabled){return this.choice_destroy(g(m.target))}};l.prototype.choice_destroy=function(m){if(this.result_deselect(m[0].getAttribute("data-option-array-index"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1){this.results_hide()}m.parents("li").first().remove();return this.search_field_scale()}};l.prototype.results_reset=function(){this.form_field.options[0].selected=true;this.selected_option_count=null;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};l.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove()};l.prototype.result_select=function(n){var p,o,m;if(this.result_highlight){p=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}if(this.is_multiple){p.removeClass("active-result")}else{if(this.result_single_selected){this.result_single_selected.removeClass("result-selected");m=this.result_single_selected[0].getAttribute("data-option-array-index");this.results_data[m].selected=false}this.result_single_selected=p}p.addClass("result-selected");o=this.results_data[p[0].getAttribute("data-option-array-index")];o.selected=true;this.form_field.options[o.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(o)}else{this.single_set_selected_text(o.text)}if(!((n.metaKey||n.ctrlKey)&&this.is_multiple)){this.results_hide()}this.search_field.val("");if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){this.form_field_jq.trigger("change",{selected:this.form_field.options[o.options_index].value})}this.current_selectedIndex=this.form_field.selectedIndex;return this.search_field_scale()}};l.prototype.single_set_selected_text=function(m){if(m==null){m=this.default_text}if(m===this.default_text){this.selected_item.addClass("chosen-default")}else{this.single_deselect_control_build();this.selected_item.removeClass("chosen-default")}return this.selected_item.find("span").text(m)};l.prototype.result_deselect=function(n){var m;m=this.results_data[n];if(!this.form_field.options[m.options_index].disabled){m.selected=false;this.form_field.options[m.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results()}this.form_field_jq.trigger("change",{deselected:this.form_field.options[m.options_index].value});this.search_field_scale();return true}else{return false}};l.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect){return}if(!this.selected_item.find("abbr").length){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}return this.selected_item.addClass("chosen-single-with-deselect")};l.prototype.get_search_text=function(){if(this.search_field.val()===this.default_text){return""}else{return g("<div/>").text(g.trim(this.search_field.val())).html()}};l.prototype.winnow_results_set_highlight=function(){var m,n;n=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];m=n.length?n.first():this.search_results.find(".active-result").first();if(m!=null){return this.result_do_highlight(m)}};l.prototype.no_results=function(m){var n;n=g('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');n.find("span").first().html(m);return this.search_results.append(n)};l.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};l.prototype.keydown_arrow=function(){var m;if(this.results_showing&&this.result_highlight){m=this.result_highlight.nextAll("li.active-result").first();if(m){return this.result_do_highlight(m)}}else{return this.results_show()}};l.prototype.keyup_arrow=function(){var m;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else{if(this.result_highlight){m=this.result_highlight.prevAll("li.active-result");if(m.length){return this.result_do_highlight(m.first())}else{if(this.choices_count()>0){this.results_hide()}return this.result_clear_highlight()}}}};l.prototype.keydown_backstroke=function(){var m;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{m=this.search_container.siblings("li.search-choice").last();if(m.length&&!m.hasClass("search-choice-disabled")){this.pending_backstroke=m;if(this.single_backstroke_delete){return this.keydown_backstroke()}else{return this.pending_backstroke.addClass("search-choice-focus")}}}};l.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};l.prototype.keydown_checker=function(n){var o,m;o=(m=n.which)!=null?m:n.keyCode;this.search_field_scale();if(o!==8&&this.pending_backstroke){this.clear_backstroke()}switch(o){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(n)}this.mouse_on_container=false;break;case 13:n.preventDefault();break;case 38:n.preventDefault();this.keyup_arrow();break;case 40:n.preventDefault();this.keydown_arrow();break}};l.prototype.search_field_scale=function(){var m,q,p,n,u,v,t,o,s;if(this.is_multiple){p=0;t=0;u="position:absolute; left: -1000px; top: -1000px; display:none;";v=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(o=0,s=v.length;o<s;o++){n=v[o];u+=n+":"+this.search_field.css(n)+";"}m=g("<div />",{style:u});m.text(this.search_field.val());g("body").append(m);t=m.width()+25;m.remove();q=this.container.outerWidth();if(t>q-10){t=q-10}return this.search_field.css({width:t+"px"})}};return l})(a)}).call(this);var amiAdminHelp=function(){this.popupId="data-help-popup";this.bgId="data-help-background";this.contentId="data-help-content";this.title="";this.forced=false;this.ready=false;this.aCommonSteps=[];this.aSteps=[];this.aStepsData={};this.displayCommon=true;this.displayVersion=true;this.activeStep=false;this.textContainer;this.stepsCount=0;this.aHelp={};this.content;this.init=function(){if(typeof(aHelpData)=="undefined"){return false}this.displayCommon=!AMI.Cookie.get("help_common_off");var b=cms_version.split(".");var a=b[0]+b[1]+b[2];this.versionCookie="help_version_"+a+"_off";this.displayVersion=!AMI.Cookie.get(this.versionCookie);this.parseHelpData();this.content=AMI.$("<DIV>");this.content.attr("id",this.contentId);this.content.css({visibility:"hidden",opacity:0});AMI.$("body").append(this.content);this.ready=true;return true};this.show=function(a){var b=AMI.Cookie.get("help_forced_off");if(AMI.Cookie.get(this.versionCookie)===null){AMI.Cookie.set(this.versionCookie,0,3600*24*30*365,"/",true);var b=false}if(a&&!b){this.forced=(typeof(a)=="undefined")?false:a;this.showPopup()}else{if(!a){this.showPopup()}}};this.getActiveStepHeader=function(){if(typeof(aHelpData["title_"+this.activeStep])!=="undefined"){return aHelpData["title_"+this.activeStep].caption}return this.title};this.showStep=function(){AMI.$(".data-help-popup__rowblock").remove();AMI.$(".data-help-popup__row-line-block").remove();this.showStepElements();this.textContainer.html(this.aStepsData[this.activeStep]);this.windowHeader.text(this.getActiveStepHeader());AMI.$(".data-help-popup__nav").removeClass("data-help-popup__nav-selected");AMI.$("#data-help-popup__nav-"+this.activeStep).addClass("data-help-popup__nav-selected")};this.getPopup=function(){return AMI.$("#"+this.popupId)};this.getBackground=function(){return AMI.$("#"+this.bgId)};this.hidePopup=function(){this.getPopup().remove();this.getBackground().remove();this.content.css({visibility:"hidden",opacity:0})};this.showPopup=function(){var c=true;if(this.stepsCount>1){if(!this.aSteps[0].length){c=false}if(c&&!this.aStepsData[this.aSteps[0]].length){c=false}}if(!c){return}var b=AMI.$("<DIV>");b.attr("id",this.popupId);b.addClass("data-help-popup");b.css("width",AMI.$(document).width()+"px");this.content.append(b);var a=AMI.$("<DIV>");a.attr("id",this.bgId);a.addClass("data-help_background");a.click(function(d){return function(){d.hidePopup()}}(this));AMI.$("body").prepend(a);this.showStepElements();this.content.css({visibility:"visible",opacity:1});this.createWindow();this.showStep(this.aSteps[0])};this.showStepElements=function(){AMI.$.each(this.aHelp,function(a){return function(h,f){if((typeof(f.settings)==="undefined")||(typeof(f.settings.step)==="undefined")||(a.activeStep!=f.settings.step)){return}var g=AMI.$("[data-helpid = "+h+"]");var n=false;if(g.length){if(typeof(f.caption)!=="undefined"){var b=AMI.$("<DIV>");b.addClass("data-help-popup__row");b.attr("id","data-help-popup__"+h);if(typeof(f.caption)!=="undefined"){b.html(f.caption);b.addClass("data-help-popup__rowblock")}else{b.addClass("data-help-popup__row-line-block")}var m=AMI.$("<DIV>");m.attr("id","data-help-popup__"+h+"-line");m.addClass("data-help-popup__row-line");if(typeof(f.settings)!=="undefined"){if(typeof(f.settings.text_float)!=="undefined"){n=f.settings.text_float;b.addClass("data-help-popup__"+n+"-block");m.addClass("data-help-popup__"+n+"-line")}}b.append(m);a.getPopup().append(b)}var d=parseInt(g.offset().top);var k=parseInt(g.offset().left);var c=parseInt(g.width());var l=parseInt(g.height());switch(n){case"topleft":b.css({left:(k+c/2)-b.outerWidth()+15,top:d-b.outerHeight()-20});m.css({left:b.outerWidth()-15,bottom:-15});break;case"top":b.css({left:(k+c/2)-b.outerWidth()/2,top:d-b.outerHeight()-20});m.css({left:b.outerWidth()/2,bottom:-15});break;case"topright":b.css({left:k+c/2-15,top:d-b.outerHeight()-20});m.css({left:15,bottom:-15});break;case"left":b.css({left:k-b.outerWidth()-20,top:d+l/2-b.outerHeight()/2});m.css({right:-15,top:b.outerHeight()/2});break;case"right":b.css({left:k+c+20,top:d+l/2-b.outerHeight()/2});m.css({left:-15,top:b.outerHeight()/2});break;case"bottomleft":b.css({left:(k+c/2)-b.outerWidth()+15,top:d+l+20});m.css({left:b.outerWidth()-15,top:-15});break;case"bottom":b.css({left:(k+c/2)-b.outerWidth()/2,top:d+l+20});m.css({left:b.outerWidth()/2,top:-15});break;case"bottomright":b.css({left:k+c/2-15,top:d+l+20});m.css({left:15,top:-15});break;default:}if(typeof(f.settings.text_align)==="undefined"){b.css({textAlign:f.settings.text_align})}AMI.$(".data-help-popup__rowblock").css({opacity:1,visibility:"visible"});AMI.$(".data-help-popup__row-line-block").css({opacity:1,visibility:"visible"})}}}(this))};this.parseHelpData=function(){this.aCommonSteps=[];this.aSteps=[];this.aStepsData={};this.activeStep=false;this.stepsCount=0;var h=cms_version.split(".");var a=h[0]+h[1]+h[2];var b=new RegExp("^version_"+a+"_(\\d+)$");for(var d in aHelpData){if(b.test(d)){this.hasVersionSteps=true;if(this.displayVersion){this.aStepsData[d]=aHelpData[d].caption;this.aCommonSteps.push(d);this.aSteps.push(d);this.stepsCount++}else{break}}}var f=/^common_(\d+)$/;for(var d in aHelpData){if(f.test(d)){this.hasCommonSteps=true;if(this.displayCommon){var c=f.exec(d);this.aStepsData[d]=aHelpData[d].caption;this.aCommonSteps.push(d);this.aSteps.push(d);this.stepsCount++}else{break}}}for(var d in aHelpData){var g=/^step_(\d+)$/;if(g.test(d)){var c=g.exec(d);this.aStepsData[d]=aHelpData[d].caption;this.aSteps.push(d);this.stepsCount++;continue}}for(var d in aHelpData){if(d=="title"){this.title=aHelpData[d].caption;continue}this.aHelp[d]=aHelpData[d]}if(this.stepsCount){this.activeStep=this.aSteps[0]}};this.renderSteps=function(){this.activeStep=this.aSteps[0];var f=AMI.$(".data-help-popup__nav-block");f.empty();var d=1;for(var b=0;b<this.aSteps.length;b++){var c=this.aSteps[b];var a=AMI.$("<DIV>");a.attr("id","data-help-popup__nav-"+c);a.addClass("data-help-popup__nav");if(this.aCommonSteps.indexOf(c)>=0){a.addClass("data-help-popup__nav-common")}a.text(d++);a.click(function(h,g){return function(){h.activeStep=g;h.showStep()}}(this,c));f.append(a)}};this.createWindow=function(){var f='<img class="blockinfo-docurl__image" src="skins/vanilla/images/book_20_blue.png" /><a title="'+helpManualLinkTitle+'" onclick="window.open(\''+AMI.$("[data-helpid-page]").attr("data-helpid-docurl")+'\'); return false;" href="#">'+helpManualLinkText+"</a>";var g=AMI.$("<DIV>").addClass("data-help-popup__blockinfo").css("display","none");var o=AMI.$("<DIV>").attr("id","data-help-popup__blockinfo-dnd").css({left:0,top:0,cursor:"move"});var n=this.getActiveStepHeader();var k=AMI.$("<H1>").addClass("data-help-popup__blockinfo-title").text(n?n:"Help");this.windowHeader=k;var c=AMI.$("<DIV>").addClass("data-help-popup__blockinfo-txt");this.textContainer=AMI.$("<DIV>").html(this.aStepsData[this.activeStep]);var h=AMI.$("<DIV>").addClass("data-help-popup__blockinfo-docurl").html(f);var m=AMI.$("<DIV>").addClass("data-help-popup__close").click(function(p){return function(){p.hidePopup()}}(this));c.append(this.textContainer);o.append(k).append(c).append(m);g.append(o);this.getPopup().append(g);AMI.UI.DnD.initElement(o[0],o[0]);g.delay(400).fadeIn();if(this.stepsCount>1){var d=AMI.$("<DIV>").addClass("data-help-popup__navigation");var b=AMI.$("<DIV>").addClass("data-help-popup__nav-block");o.append(d.append(b));this.renderSteps();var a=AMI.$("<DIV>").addClass("data-help-popup__blockinfo-nextbtn").html("&rarr;");a.click(function(p){return function(){var q=p.aSteps.indexOf(p.activeStep);if(typeof(p.aSteps[++q])=="undefined"){q=0}p.activeStep=p.aSteps[q];p.showStep()}}(this));b.after(a);AMI.$("#data-help-popup__nav-"+this.activeStep).addClass("data-help-popup__nav-selected")}if(typeof(h)!="undefined"){o.append(h)}h.before('<span id="cb-forced_off"><label for="forced_off"><INPUT type="checkbox" id="forced_off"><span>'+helpCbDisableHelp+"</span></label></span>");if(this.hasCommonSteps){h.before('<span id="cb-common_off"><label for="common_off"><INPUT type="checkbox" id="common_off"><span>'+helpCbDisableCommon+"</span></label></span>")}if(this.hasVersionSteps){h.before('<span id="cb-common_off"><label for="version_off"><INPUT type="checkbox" id="version_off"><span>'+helpCbDisableVersion+"</span></label></span>")}var l=AMI.Cookie.get("help_forced_off");AMI.$("#forced_off").attr("checked",l?true:false);AMI.$("#common_off").attr("checked",!this.displayCommon);AMI.$("#version_off").attr("checked",!this.displayVersion);AMI.$("#common_off").click(function(q){var p=this.checked?1:"";AMI.Cookie.set("help_common_off",p,3600*24*30*365,"/",true);oHelp.displayCommon=!p;oHelp.parseHelpData();oHelp.renderSteps();oHelp.showStep();q.stopPropagation()});AMI.$("#forced_off").click(function(q){var p=this.checked?1:"";AMI.Cookie.set("help_forced_off",p,3600*24*30*365,"/",true);q.stopPropagation()});AMI.$("#version_off").click(function(q){var p=this.checked?1:"";oHelp.displayVersion=!p;AMI.Cookie.set(oHelp.versionCookie,p,3600*24*30*365,"/",true);oHelp.parseHelpData();oHelp.renderSteps();oHelp.showStep();q.stopPropagation()});AMI.$("#cb-common_off label").click(function(p){p.stopPropagation()});AMI.$("#cb-forced_off label").click(function(p){p.stopPropagation()});AMI.$("#cb-version_off label").click(function(p){p.stopPropagation()})};this.initEvents=function(){AMI.$(window).resize(function(a){return function(){if(a.getPopup().length){a.hidePopup();a.showPopup()}}}(this))}};function toogleHelpBtn(b,a){$(".data-help-popup__rowblock").css({opacity:0,visibility:"hidden"});$(".data-help-popup__nav-selected").attr("class","data-help-popup__nav");$("#"+a).attr("class","data-help-popup__nav data-help-popup__nav-selected");$(".data-help-popup__rowblock").slice(Math.round($("[data-helpid]").length/3)*b-3,Math.round($("[data-helpid]").length/3)*b).css({opacity:1,visibility:"visible"});if($("#data-help-popup__panel_options").css("visibility")=="hidden"){$(".data-help-popup__row-line-block").css({opacity:0,visibility:"hidden"})}else{$(".data-help-popup__row-line-block").css({opacity:1,visibility:"visible"})}}var oHelp=new amiAdminHelp();$(document).ready(function(){oHelp.init()});