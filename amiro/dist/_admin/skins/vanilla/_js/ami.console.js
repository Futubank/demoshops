var amiConsole={isOpen:false,frame:null,input:null,screen:null,commands:{help:"Shows this help",debug:"Debugger prototype",exit:"Quits console"},init:function(){this.frame=AMI.$("<DIV>");this.frame.hide();this.frame.addClass("amiConsole");this.screen=AMI.$("<DIV>");this.screen.addClass("amiConsoleScreen");this.frame.append(this.screen);this.input=AMI.$('<INPUT type="text" placeholder="Type here...">');this.frame.append(this.input);AMI.$("body").append(this.frame);this.input.keyup(function(a){if(a.keyCode==13){if(!this.value.length){return}var b=this.value;this.value="";amiConsole.addLine(b);amiConsole.processCommand(b)}});AMI.$(window).keyup(function(a){if((a.keyCode==192)&&(a.altKey)){if(amiConsole.isOpen){amiConsole.close()}else{amiConsole.open()}}})},addLine:function(b,a){if(typeof(a)=="undefined"){this.screen.append("<span>$> "+b+"</span><br>")}else{if(a=="error"){this.screen.append('<span class="amiConsoleError">!> '+b+"</span><br>")}if(a=="cms"){this.screen.append('<span class="amiConsoleCms">AmiroCMS> '+b+"</span><br>")}}this.scrollDown()},scrollDown:function(){this.screen.scrollTop(this.screen.scrollHeight)},open:function(){if(this.isOpen){return}this.isOpen=true;this.screen.empty();this.addLine("Welcome to Amiro.CMS console.","cms");this.addLine("Type command below, use 'help' to list available commands or type 'exit' to colse the console.<br>","cms");this.frame.css("top",0);this.frame.css("left",0);this.frame.css("width","100%");this.frame.css("height","100%");this.frame.show();this.input.focus()},close:function(){this.isOpen=false;this.frame.hide()},processCommand:function(c){c=c.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\s+/," ");var a=c.split(" ");var b=a[0];switch(b){case"exit":this.close();break;case"help":this.cmdHelp();break;case"debug":amiDebugBar.launch();this.close();break;default:this.addLine('Unknown command "'+b+'"',"error")}},cmdHelp:function(){this.addLine("Console commands:","cms");for(var a in this.commands){this.addLine(a+" : "+this.commands[a],"cms")}}};AMI.$(document).ready(function(){amiConsole.init()});var amiDebugBar={active:false,bar:null,launch:function(){if(this.active){return}this.bar=AMI.$("<DIV>");this.bar.css("width","100%");this.bar.css("height","24px");this.bar.css("position","fixed");this.bar.css("left","0px");this.bar.css("bottom","0px");this.bar.css("z-index","100000");this.bar.css("background-color","#eee");this.bar.css("border-top","1px solid #000");this.bar.css("padding-left","10px");this.bar.attr("id","debugger");var b='&nbsp;<img src="skins/vanilla/images/flt_splitter.gif" style="vertical-align:middle;"&nbsp;>';this.bar.html(this.bar.html()+'<span id="x-p1" style="vertical-align:middle;">PHP Errors: <a href="javascript:;" style="color:red" title="PHP Fatal Errors: 1"><b>E1</b></a> <a href="#" title="PHP Warnings: 3" style="color:red">W3</a> <a href="#" title="PHP Notices: 12" style="color:#F07D19">N12</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p2" style="vertical-align:middle;">SQL Queries: <a href="javascript:;" title="MySQL Queries: 12, total time: 1.43 sec">12</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p3" style="vertical-align:middle;">Memory Usage: <a href="javascript:;" title="Memory Peak: 12.342 Mb">12Mb</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p4" style="vertical-align:middle;">GUI Errors: <a href="javascript:;" title="GUI Errors: 3" style="color:red">3</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p5" style="vertical-align:middle;">Messages: <a href="javascript:;" title="Debug Messages: 2" style="color:blue">2</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p6" style="vertical-align:middle;">Events: <a href="javascript:;" title="Events Fired: 25" style="color:green">25</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p7" style="vertical-align:middle;">AJAX Queries: <a href="javascript:;" title="AJAX Queries: 0" style="color:black" id="ajaxq">0</a></span>'+b);this.bar.html(this.bar.html()+'<span id="x-p8" style="vertical-align:middle;">Profiler: <a href="javascript:;" title="Script Total: 0.82353 sec" style="color:green"">0.82s</a></span>'+b);var d=AMI.$('<IMG src="http://go.iomega.com/static/img/x_button_close.png">');d.css("position","fixed");d.css("z-index","100001");d.css("right","0px");d.css("bottom","-4px");d.css("cursor","pointer");this.bar.append(d);var c=AMI.$("<DIV>");c.css("height","48px");c.css("position","fixed");c.css("left","0px");c.css("width","200px");c.css("bottom","-26000px");c.css("z-index","100002");c.css("background-color","#fff");c.css("border","1px solid #000");c.css("padding","4px");c.html('<b>Component "form" error:</b><br>Allowed memory size of 16777216 bytes exhausted...');c.attr("id","x-panel1");this.bar.append(c);AMI.$(this.bar).on("mouseover","#x-p1",function(){AMI.$("#x-panel1").css("bottom","24px")});AMI.$(this.bar).on("mouseout","#x-p1",function(){AMI.$("#x-panel1").css("bottom","-26000px")});this.bar.on("click","#x-p1 a:eq(0)",function(){var f="Allowed memory size of 16777216 bytes exhausted...<br>                        <br>            ";var e=new AMI.UI.Popup(f,{id:"popupka",header:"PHP Fatal Errors or Exceptions",width:700})});this.bar.on("click","#x-p2 a",function(){var f="[1=>1] Start query [19:15:22]:<br>                        <span style='color:blue;'>SELECT * FROM `cms_options` WHERE 1 AND `name` = 'instance' AND `module_name` = 'core'</span><br>                        [1=>1] End query [19:15:22], Delay = 0.00108 sec (Total = 0.00284 sec, Fetch count = 3)<br>                        <br>                        [2=>1] Start query [19:15:22]:<br>                        <span style='color:blue;'>SELECT * FROM `cms_options` WHERE 1 AND `name` = 'params' AND `module_name` = 'cache' </span><br>                        [2=>1] End query [19:15:22], Delay = 0.00094 sec (Total = 0.00380 sec, Fetch count = 5)<br>                        <br>                        [3=>1] Start query [19:15:22]:<br>                        <span style='color:blue;'>SELECT * FROM `cms_options` WHERE `module_name` = 'core' AND `name` = 'options_dump_all' </span><br>                        [3=>1] End query [19:15:22], Delay = 0.01670 sec (Total = 0.02052 sec, Fetch count = 7)<br>                        <br>                        [4=>2] Start query [19:15:22]:<br>                        <span style='color:blue;'>SELECT * FROM cms_plugins WHERE is_installed=1 OR is_first_run=1 ORDER BY id asc </span><br>                        [4=>2] End query [19:15:22], Delay = 0.00085 sec (Total = 0.02139 sec, Fetch count = 8)<br>                        <br>                        [5=>1] Start query [19:15:22]:<br>                        <span style='color:blue;'>SELECT * FROM `cms_options` WHERE 1 AND `name` = 'requre_rebuild_modules' AND `module_name` = 'core' </span><br>                        [5=>1] End query [19:15:22], Delay = 0.00117 sec (Total = 0.02262 sec, Fetch count = 12)<br>                        <br>                        [6=>3] Start query [19:15:22]:<br>                        <span style='color:blue;'>select id, username, licence from cms_host_users where sys_user='1' limit 1 </span><br>                        [6=>3] End query [19:15:22], Delay = 0.00067 sec (Total = 0.02330 sec, Fetch count = 13)<br>                        <br>            ";var e=new AMI.UI.Popup(f,{id:"popupka",header:"SQL Queries",width:700})});this.bar.on("click","#x-p4 a",function(){var f="Unable to open language file 'templates/plugins/lang/_menu_owners.lng'<br>                        Unable to open language file 'templates/plugins/lang/_menu_all.lng'<br>                        Unable to open language file 'templates/plugins/lang/_headers.lng'<br>                        <br>            ";var e=new AMI.UI.Popup(f,{id:"popupka",header:"GUI Error Messages",width:700,height:150})});var a=AMI.$("<DIV>");a.css("height","48px");a.css("position","fixed");a.css("left","145px");a.css("width","200px");a.css("bottom","-26000px");a.css("z-index","100002");a.css("background-color","#fff");a.css("border","1px solid #000");a.css("padding","4px");a.html("<b>SELECT:</b> 8 (1.03 sec)<br><b>UPDATE:</b>: 2 (0.4 sec)");a.attr("id","x-panel2");this.bar.append(a);AMI.$(this.bar).on("mouseover","#x-p2",function(){AMI.$("#x-panel2").css("bottom","24px")});AMI.$(this.bar).on("mouseout","#x-p2",function(){AMI.$("#x-panel2").css("bottom","-26000px")});d.click(function(){amiDebugBar.hide()});setInterval(function(){var e=parseInt(AMI.$("#ajaxq").text());AMI.$("#ajaxq").text(e+1);AMI.$("#ajaxq").attr("title","AJAX Queries: "+(e+1))},2000);AMI.$(top.document).find("body").append(this.bar);this.active=true},hide:function(){this.bar.remove();this.active=false}};