<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @subpackage api 
 * @version    $Id$ 
 * @size       7870 xkqwiurzssyszuniupnslrszzugnkywksmwkxlytkugugpxwypprrnirsppwstqypgxxpnir
 */ ?><?php foreach(array(608=>'jhwzj|Fmjqd|gzTo',609=>'|SYTZYJQD',610=>'OZnSJQr',611=>'uDQr',612=>"coqRq?IHSuJQ?=?'",613=>"IHSuJQ",614=>"KQB|QxtQrnZJ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class CMS_API {public $moduleName =''; public $_moduleNamePostfix =''; public $_events; public $_cms; public $_dbCMS; public $_dbInfo; public $_dbTables; public $_db; public $_allowableProperties; function Init(&$dbCMS, &$cms) {$this->_dbCMS =&$dbCMS; $this->_cms =&$cms; if (!is_array($this->_events)) {$this->_events =array ();}$path =$GLOBALS[I608] .'ext_integration/' .mb_strtolower(get_class($this)) .'.ini.php'; if (!is_file($path)) {return false; }$prevoiusErrorLevel =error_reporting(E_ALL); $INI =parse_ini_file($path, true); error_reporting($prevoiusErrorLevel); if (isset($INI['_dbInfo'])) {$this->_dbInfo =(array)$INI['_dbInfo']; }if (isset($INI[I609])) {$this->_dbTables =(array)$INI[I609]; }if (!is_array($this->_allowableProperties)) {$this->_allowableProperties =array ();}if (isset($INI['properties']) && count($this->_allowableProperties) >0) {foreach ($INI['properties'] as $name => $value) {if (in_array($name, $this->_allowableProperties)) {$this->$name =$value; }}}$this->moduleName .= $this->_moduleNamePostfix; return true; }function ProcessEvent($event, &$input, &$output) {if (!isset($this->_events[$event])) {return true; }$eventData =(array)$this->_events[$event]; if (!isset($eventData['handler'])) {trigger_error(sprintf("Handler parameter is missed for event '%s'", $event), E_USER_ERROR); }$method =$eventData[I610]; if (!method_exists($this, $method)) {trigger_error(sprintf("Method '%s' for event '%s' isn't implemented", $method, $event), E_USER_ERROR); }if (isset($eventData['require_connect']) && $eventData['require_connect']) {if (!$this->_connectToExtrenalDb()) {return false; }}return $this->$method($input, $output); }function _connectToExtrenalDb() {if (is_resource($this->_db)) {return true; }$this->_db =@mysql_connect($this->_dbInfo['host'], $this->_dbInfo[I611], $this->_dbInfo['password'], true); if (!$this->_db || !@mysql_select_db($this->_dbInfo['database'], $this->_db)) {$this->_db =null; return false; }return true; }function _getExternalKey($module, $internalKey) {$sql ="SELECT `key_external` " ."FROM `cms_external_integration` " .I612 .addslashes($module) ."' AND `key_internal` = '" .addslashes($internalKey) ."'"; $this->_dbCMS->query($sql); return $this->_dbCMS->next_record() ?addslashes($this->_dbCMS->Record["key_external"]) :""; }function _setExternalKey($module, $internalKey, $externalKey) {$record =array (I613 => addslashes($module), "key_internal" => addslashes($internalKey), I614 => addslashes($externalKey) );$sql =$this->_dbCMS->GenInsertSQL("cms_external_integration", $record); return (bool)$this->_dbCMS->query($sql); }function _deleteKeysDependence($module, $internalKey) {$sql ="DELETE FROM `cms_external_integration` " .I612 .$module ."' AND key_internal = '" .addslashes($internalKey) ."'"; return (bool)$this->_dbCMS->query($sql); }}?>