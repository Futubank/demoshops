<?php foreach(array(640=>'OQZSQr',641=>'OMSQ|Mn|JMDt',642=>'urPQnt|SZtQ',643=>'',644=>"PrHuG|HGQrZtMHnD",645=>"",646=>"uDQ|IHSMfMQS|SZtQ",647=>"MS|GZPQ|IHSuJQ|nZIQ",648=>"ZGGJB|IHSuJQ|nZIQ",649=>"WHJD",650=>"WZtHffDQt",651=>"DHrtWHJ|vZrnZIQ",652=>"WZtDHrt",653=>"DQZrWO|GZPQD|DQtuG",654=>'DuGGHrt|rMPOtD',655=>"ZnnHunWQ",656=>"uDQ|MS|QxtQrnZJ",657=>"fHrI",658=>"MtQI|GMWturQD",659=>'QDOHG|MtQI',660=>"QxtQnDMHnD",661=>"DtHG|uDQ|DuYJMnKD",662=>"KQBCHrSD|PQnQrZtQ",663=>"nH|MnSQx|SQtZMJD",664=>"SQfZuJt|GrQfMx",665=>'IuJtM|GZPQ|ZJJHCQS',666=>'Qxt|SMDWuDDMHn',667=>"funWtMHn|WJZDD",668=>"IuJtM|DMtQ",669=>"ZSIMn",670=>'MS',671=>"ZDW",672=>'fJt|IHSuJQ|YHSB|HnJB',673=>"fJt|IHSuJQ|YHSB|HnJB",674=>']fJt|IHSuJQ|YHSB|HnJB=1',675=>"zwTmVq|ihsUjq",676=>"fJt|MS|GZPQ",677=>"MS|GZPQ",678=>'Udq|dUyjmNkd',679=>"1",680=>"MS",681=>"MS|DMtQ",682=>"|DuYfHrI",683=>'funW|ZrrZB`GOG',684=>"DOHC|GZPQ|DMAQ",685=>"tQIGJZtQD~WHIIHn|IHSuJQD|DQtD`tGJ",686=>'WZthffDQt',687=>'WZtMS|vZrnZIQ',688=>"DOHC|YHSB|YrHCDQ",689=>"WZWOQ|QxGMrQ|fHrWQ",690=>"rDrtIQ",691=>"|PrG|MSD",692=>"WuDtHI",693=>"Qxt|ZWtMHn",694=>'UTF+8',695=>'=',696=>']',697=>'DtZtuD|IDP',698=>'IDP',699=>'DtZtuD|IQDDZPQD',700=>"zss",701=>"SQJ|ZJJ",702=>"QxGHrt",703=>"uG",704=>"PrG|WHGB",705=>"PrG|PQn|KQBCHrSD",706=>"PrG|MnSQx|SQtZMJD",707=>"ZGGJB",708=>"SHCn",709=>"TrBMnP?tH?PQt?OtIJ?Hn?unMtMZJMAQS?IHSuJQ?",710=>"|JMDt|YZWKuG",711=>"|uDQ|MS|GZPQ|HrMP",712=>'fMQJSD',713=>"LHMn",714=>"JMDt|SZtZ",715=>"DIZJJ|vMQC|IHSQ",716=>"ZWtMvQ|DGQW|YJHWKD",717=>"SZtZ",718=>"JMIMt",719=>"nZIQ",720=>"=",721=>"^",722=>"MnMt|fMJtQr",723=>'WuDtHI|SZtZ|',724=>'WOQWKYHx',725=>'WZGtMHn',726=>"JMKQ",727=>'fJt|',728=>'`[',729=>"oDGJMttQr",730=>"fMQJS",731=>"fJt|fHrWQ|vZJuQD",732=>"YHSB|tBGQ",733=>"fMJtQr|GZPQD|DQtuG",734=>"ZWtMHn",735=>"OMSSQn",736=>'YHSB|WZtD',737=>"?zNs?",738=>'M`',739=>'}',740=>"?zNs?}",741=>'YHSB|urPQnt|WZtD',742=>"=0?hR?",743=>"=1?",744=>"{{?",745=>"!",746=>"?=?",747=>'OMSQ|futurQ|MtQID',748=>"MS|DMtQ='",749=>"MS|GZPQ=0{{",750=>"IHSuJQ='",751=>'IHS|MS',752=>'vMQCTBGQ',753=>'IHSuJQ|SMDZYJQS|SQIH',754=>'rQS',755=>"SMDZYJQS",756=>"WOQWKQS",757=>'JMDt|SZtZ',758=>"fMJtQr",759=>"0",760=>"fJt|PrG|DQJQWtQS",761=>'0',762=>'fJt|urPQnt',763=>"DuYfHrI",764=>"ZJMPn=WQntQr",765=>"SMDGJZB|fHrI",766=>'DKMG|fMJtQr',767=>"MnMt|ZSIMn|OtIJ",768=>"ZSv|IHSuJQD|DtZtD",769=>'urPQnt',770=>"ZSv|GJZWQ",771=>'ZWtMHn',772=>'ZGGJMQS|MS',773=>"fMQJSD",774=>'|mSgZPQRHCwy',775=>'|ZSS',776=>'|GHDMtMHnDRHC',777=>'|ZSvFHrIZtwTRwy',778=>"|PrHuG|ZWtMHnD",779=>"IQtOHS",780=>'rMPOtD',781=>'IHSmS',782=>'JQPQnS',783=>"%rHC",784=>"|DuYfHrI%WZnWQJ",785=>"|vMQC",786=>'DI|SZtZ',787=>"tMtJQ",788=>"MD|KQBCHrSD|IZnuZJ",789=>'DuYJMnK',790=>'?SMDZYJQS',791=>"MS|QxtQrnZJ",792=>"fHrI|SZtZ",793=>"|SMDZYJQS",794=>"YHSB|MtQIs",795=>"YHSB|WZtD",796=>"DHrt",797=>"DQZrWO",798=>'GZPQD',799=>'IHS|MS|GZPQD',800=>"WZt|HffDQt",801=>"MnMt|frHnt|OtIJ",802=>"fMJtQr|JZnP|fMJQ",803=>"WZtD|IHSuJQ|nZIQ",804=>"WZtDHrtWHJ|vZrnZIQ",805=>"DHrt|GZPQD|DQtuG",806=>"YHSB|YrHCDQ",807=>"|GZPQ|DMAQ",808=>"DHrt|",809=>"MnMt|YB|IHSuJQ|nZIQ",810=>"IHSuJQ|nZIQ",811=>"yhsb|Tbgq",812=>"ZWtMvQ|MtQI|tBGQ",813=>"frHnt|JMnK",814=>'uDQ|MS|GZPQ',815=>'|pQtdrWFrHntjMnKwy',816=>"HYLQWt",817=>"WZJJYZWK",818=>"jmimT?",819=>'JMDt|DQt',820=>"MS=",821=>"GZPQ|MtQI|tBGQ",822=>"JMDt|DQt|QIGtB",823=>"WZt|rHC",824=>"JMDt|DQt",825=>"rHC|DQt",826=>" ",827=>"]",828=>'WZt|ZSv|GJZWQ',829=>"|JMDt",830=>"nZIQ|fMQJS|nZIQ",831=>"YHSB|DQZrWO",832=>"DQZrWO|MtQI|rHCD",833=>"MtQI|JMDt|QIGtB",834=>"MtQI|rHCD",835=>"JMDt|DQt|nHt|fHunS",836=>"GZPQr|nZvSZtZ",837=>"HffDQt|JMnK",838=>"DQZrWO|MtQI|",839=>"DMIGJQ|GrQfMx",840=>"MtQI|",841=>"urPQnt|MtQI|",842=>"=*dTzRT&",843=>"YrHCDQ|MtQI|",844=>"nQxt|JMnK|DQt",845=>'frHnt|JMDt|DEJ',846=>'rDrtIQ',847=>'HYLQWt',848=>'ZIM~WurrQntiHSuJQ',849=>"%",850=>"JMDt|tZYJQ",851=>"MtQI|DQt|QIGtB",852=>"MtQIs|",853=>"iHSuJQotIJ",854=>"OQZSQrD",855=>"|JMDt%",856=>"&?Mn?IHSuJQ?",857=>'GZPQ~JMnKD~GrQv',858=>'urPQnt|WZt|JMDt',859=>'LDHn',860=>"YHSB|DIZJJ",861=>"DuYJMnK",862=>"|pQtdGJMttQrwy",863=>"DIZJJ|JMDt|QIGtB",864=>'HGtMHnD',865=>"DtZtuD|ZSS|fZMJ",866=>"GHDMtMHn",867=>"'?zNs?MS#@'",868=>"'",869=>'DtZtuD|SQJ',870=>"sqjqTq?FRhi?",871=>"DtZtuD|SQJ|fZMJ",872=>'nuI|MtQID',873=>"DtZtuD|PrG|WHGB",874=>"ZWtMHn|HrMPMnZJ",875=>"GuYJMW",876=>"DtZtuD|PrG|GuYJMDO",877=>"ZrWO",878=>"?coqRq?MS='",879=>"SQtZMJD|nHMnSQx",880=>"Hff",881=>'`',882=>'COQrQ',883=>"DI|SZtZ?",884=>"MS?mN}",885=>"DI|SZtZ",886=>'ZJJ',887=>"KQBCHrSD",888=>"fMJJQS",889=>"DJZDOQD",890=>"YJuQ",891=>"dqjqwT?MS!?",892=>"!?MS|DMtQ",893=>"coqRq?MS='",894=>"PrG|GHGuG|",895=>"DBDtQI|GHGuG",896=>"PrG|MS|GZPQ",897=>"IHvQ",898=>"DtZtuD|WHGB|fZMJ",899=>"qxtrZ",900=>"Mnt}11{",901=>"DQJQWt?[?frHI?",902=>"WHGB|Hf",903=>"MD|WHGMQS",904=>'SMDZYJQ|QrrHr|IZMJ',905=>'rQGZMr|DQZrWO|OZDO',906=>"GHDMtMHnD",907=>'SQfZuJt|GrQfMx',908=>"dqjqwT?GHDMtMHn?",909=>"?coqRq?GHDMtMHn#",910=>"PrG|GHDMtMHn",911=>"?coqRq?GHDMtMHn@",912=>"?coqRq?MS=",913=>"tHG",914=>"@",915=>"GHDMtMHn?FRhi?",916=>'IHvQ|GHDMtMHn',917=>'fJuDO',918=>"DtZtuD|HrSQr",919=>"DtZtuD|WOZnPQS",920=>"IQIYQrD",921=>"HYLQWt|nZIQ",922=>"OtIJ|SQDWrMGtMHn",923=>"SQDWrMGtMHn",924=>"OtIJ|tMtJQ",925=>'ZsZtZ',926=>"GrQGZrQ|MtQI|SZtZ",927=>"IuJtM|DMtQD",928=>"tMtJQ|MnOQrMt",929=>"IHSuJQ",930=>'=_NUjj',931=>"FUNw|mNwjUsqd|gzTo",932=>"+",933=>"GHDtfMx",934=>"HrMPMnZJ|DuYJMnK",935=>"GrQfMx",936=>'+',937=>"|IHSuJQ|nZIQ",938=>"IQDDZPQ",939=>"SZtQ",940=>"GOG",941=>"uSZtQfrHI",942=>'WHntQnt',943=>"WZtMS",944=>'WZt|DuYJMnK',945=>"GrQv|nZv|SZtZ",946=>"nQxt|DuYJMnK",947=>'MS|DuYJMnK',948=>"YHSB|WZts",949=>"WZt|nZv|SZtZ",950=>'MS|WZt',951=>"nDGJMttQr|GrQfMx",952=>"|WHJD",953=>"DGJMttQr|GrQfMx",954=>"DMIGJQ|DQt|fMQJSD",955=>"|grQvNQxtjMnKDwy",956=>'|pQtNZvsZtZwy',957=>"|",958=>"OMDtHrB|DMAQ",959=>"tGJ|YJHWK",960=>"YrHCDQr|GHDMtMHn",961=>"tZYJQ",962=>"JZDt|QSMtQS|MS",963=>"tGJ|rHC|GHDtfMx",964=>"JMDt|WtrJ|JMDt",965=>"JMDt",966=>"JQPQnS",967=>"ZGGJMQS|MS",968=>'wid|zWtiHSuJQ%%pQtqxtQnDMHn%?WJZDD|nZIQ?MD?nHt?DGQWMfMQS?fHr?IHSuJQ?',969=>"MtQI|SZtZ",970=>'HhJSqnviHSuJQ',971=>'?',972=>'ZRQGJZWQIQnt',973=>"DHurWQ",974=>"COQrQ",975=>"dqjqwT?",976=>"?dqT?",977=>"?COQrQ?",978=>"'{",979=>"rHCD",980=>"IuJtM|DMtQD|DQJQWt",981=>"ZSS|DIZJJ|SZtZ",982=>'|MS|GZPQ|rHC|WHJ',983=>"MD|tHG",984=>"|DBD|rMPOt|C",985=>"|GHDMtMHnD|WHJ",986=>"JQP|IHvQ|uG",987=>"DMnPJQ|DMtQ",988=>"Drv|IuJtM|DMtQD",989=>"GrQvMHuD|JMnK|DQt",990=>'|',991=>"nQxt|JMnK",992=>"|nZ",993=>'GMS',994=>"|MS|GZPQ|rHCD",995=>'MDzvZMJZYJQ',996=>"dqRVqR|gRhThwhj",997=>"ZSv|GJZWQD",998=>"ZSv|IHSuJQD",999=>"DQJQWt?G`MS!?G`GHDtfMx!?G`IHSuJQ|nZIQ!?G`DHurWQ|tBGQ!?G`YrHCDQ|IHSQ!?t`MS?ZD?MS|tBGQ?frHI?WID|ZSv|GJZWQD?G?jqFT?lhmN?WID|ZSv|WZIGZMPn|tBGQD?t?hN?}ghdmTmhN}whNwzT}'^'!G`MS!'^'{?mN?t`MSD|GJZWQD{@0?ZnS?t`IZtQrMZJ|tBGQ='IHSuJQ'{?COQrQ?}G`DHurWQ|tBGQ='IHSYZnnQr'?hR?G`DHurWQ|tBGQ='IHSuJQ'{?ZnS?G`JZnP='",1000=>"MS|tBGQ",1001=>"MD|ZJJHCQS",1002=>"ZSv|GJZWQ|DY",1003=>"DQJQWtQS",1004=>"DQJQWt?MS!?nZIQ?frHI?WID|ZSv|GJZWQD?COQrQ?DHurWQ|tBGQ='IHSYZnnQr'?zNs?IHSuJQ|nZIQ?JMKQ?':^",1005=>"'?HrSQr?YB?nZIQ",1006=>"DQJQWt?W`MS!?W`nZIQ?frHI?WID|ZSv|WZIGZMPn|tBGQD?W?JQft?LHMn?WID|ZSv|GJZWQD?G?hN?ghdmTmhN}whNwzT}'^'!G`MS!'^'{?mN?W`MSD|GJZWQD{@0?COQrQ?G`DHurWQ|tBGQ='IHSuJQ'?zNs?G`IHSuJQ|nZIQ?JMKQ?':^",1007=>"^:'??zNs?W`JZnP='",1008=>"MS|HCnQr",1009=>"|GJZWQ",1010=>"Wnt",1011=>"WZt|ZSv|GJZWQ",1012=>"RhhT|gzTo|ccc",1013=>"|GJZWQ|",1014=>"vZJuQ",1015=>"ZSv|IHSuJQD|nZIQD",1016=>"DQJQWt?MS|MtQI!?IZx}MS{?ZD?IZx|MS!?WHunt}mF}YHSB|tBGQ='j'!?1!?NUjj{{?ZD?JMDt|rHCD!?WHunt}[{?ZD?ZJJ|rHCD?frHI?WID|ZSv|IHSuJQD|DtZtD|tIG?COQrQ?IHS|nZIQ='",1017=>"JMDt|rHCD",1018=>"?DQt?",1019=>"uGSZtQ?WID|ZSv|IHSuJQD|DtZtD|tIG?DQt?WHuntQr|GrHWQDDQS=1?COQrQ?MS#=",1020=>"SQJQtQ?frHI?WID|ZSv|IHSuJQD|DtZtD|tIG?COQrQ?WHuntQr|GrHWQDDQS=1?ZnS?DtZt|GrHWQDDQS=1",1021=>"DOHCn|Wtr",1022=>"%IHSuJQ|WHuntQr",1023=>"j",1024=>"ZSv|WHuntQr|GrQfMx",1025=>'GuDO',1026=>"dqjqwT?imN}",1027=>"?@?Nhc}{",1028=>".?=?1?zNs?.",1029=>'SZtQ|DtMWKB|tMJJ',1030=>"?md?NhT?NUjj?zNs?",1031=>'|SQfZuJt',1032=>'YHSB|MtQID',1033=>'YHSB|MtQIs',1034=>'EuQrB',1035=>'HffDQt',1036=>'WZtHffDQt',1037=>'fHruI|Qxt',1038=>'fHrWQiHYMJQ',1039=>'urM',1040=>'WZnHnMWZJ',1041=>'dqjqwT?',1042=>'DtZrt',1043=>'QnS') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class CMS_ActModule {public $cms; public $db; public $module; public $moduleName; public $IIllIIL; public $IIllII1; public $filter; public $browser; public $fn; public $itemData; public $id; public $IIllIlI; public $catId; public $siteId; public $appliedId; public $IIllIll; public $action; public $options; public $IIllIlL; public $words; public $langData; public $side; public $initialized; public $errno; public $error; public $ext; public $IIllIl1; public $IIllILI; public $IIllILl; public $IIllILL; public $offset; public $catOffset; public $bodyType; public $IIllIL1; public $IIllI1I; public $IIllI1l; public $IIllI1L; public $IIllI11; public $IIlllII; public $IIlllIl; public $IIlllIL; public $IIlllI1; public $IIllllI; public $aGroupIds; public $IIlllll; public $IIllllL; public $IIllll1; public $IIlllLI; public $isSmallMode; public $IIlllLl; public $IIlllLL; public $IIlllL1; public $IIlll1I; public $IIlll1l; public $redirect; public $forceRedirect; public $IIlll1L; public $IIlll11; public $IIllLII; public $IIllLIl; public $IIllLIL; public $IIllLI1; public $IIllLlI; public $IIllLll; public $IIllLlL; public $IIllLl1; public $realSide; public $IIllLLI; public $IIllLLl; public $IIllLLL; public $IIllLL1; public $suppressUrgency; public $IIllL1I; private $IIllL1l; protected $IIllL1L =true; private $IIllL11; private $IIll1II; public $forcePageSize =0; protected $IIll1Il; public $actionId; protected $IIll1IL =array(); protected $aSupportedResponseTypes =array('json'); protected $IIll1I1; protected $IIll1lI ='html'; protected $IIll1ll =array(); protected $doMapping =TRUE; public $IIll1lL =array( I640 => I640, 'date_created' => 'date', 'date_modified' => 'modified_date', I641 => 'public_direct_link', 'sticky' => 'urgent', 'date_sticky_till' => I642 );function CMS_ActModule(&$cms, &$db, &$cModule) {$this->cms =&$cms; $this->langData =$cms->lang_data; $this->side =$this->cms->Core->Side; $this->db =&$db; $this->module =&$cModule; $this->moduleName =$cModule->GetName(); $this->IIllII1 =""; $this->IIllIIL =$this->moduleName; $this->initialized =false; $this->filter =false; $this->fn =false; $this->IIllI1I =false; $this->IIllI1l =false; $this->IIllI1L =false; $this->IIllI11 =false; $this->SetLastError(); $this->IIllILI =0; $this->offset =0; $this->catOffset =0; $this->IIlllII ="filters"; $this->IIlllIl =Array(); $this->IIlllIL =false; $this->IIlllI1 =false; $this->siteId =0; $this->IIllIlI =0; $this->catId =0; $this->IIllllI =false; $this->IIlllll =false; $this->aGroupIds =Array(); $this->IIllllL =Array(); $this->IIllll1 =Array(); $this->IIlllLI =1; $this->isSmallMode =false; $this->IIlllLl =Array(); $this->IIlllLL =true; $this->IIlllL1 =false; $this->IIlll1I =0; $this->IIlll1l =0; $this->IIlll11 ="templates/"; $this->IIllLII =false; $this->IIllLIl =array(); $this->IIllLlI =false; $this->IIllLll =false; $this->IIllLI1 =false; $this->IIllLlL =false; $this->IIllLIL =false; $this->IIllLl1 =false; $this->realSide ="standard"; $this->IIllLLI =true; $this->IIllLLl =false; $this->IIlll1L =I643; $this->suppressUrgency =false; $this->IIllL1I =false; }function TTTlTT1() {return new DB_si; }function &TTTlTIT() {return $this->db; }function Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {if(!$this->initialized) {$this->IIll1Il =array(); $this->_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); $this->TTTlTII(); }}function TTTlTII() {if($this->side == "admin") {if($this->options["use_id_page"]) {$this->options[I644][] ="id_page"; }}}function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$this->itemData =Array(); $this->id =0; $this->appliedId =0; $this->IIllIll =0; $this->action =""; $this->ext =Array(); $this->IIllIl1 =Array(); $this->options =$aOptions; if(!empty($aOptions["filter_box_template"]) || !empty($aOptions["filter_form_template"])) {$this->IIlllll =true; }$this->TTTlll1($this->moduleName); $aDefault =array(); $aDefault["default_prefix"] =""; $aDefault["cat_default_prefix"] =I645; $aDefault["default_table_alias"] =I645; $aDefault["lang_data"] =true; $aDefault["use_id_page"] =false; $aDefault["spec_id_pages"] =Array(); $aDefault[I646] =true; $aDefault["use_options_form"] =false; $aDefault[I647] =$this->module->GetName(); $aDefault["multi_sites"] =false; $aDefault["check_public"] =AMI::doFilterFrn($this->moduleName); $aDefault[I648] =false; if($this->module->IssetOption("cols")) {$aDefault[I649] =$this->module->GetOption(I649); }$aDefault["admin_init_order"] =Array("filter", "form"); $aDefault["cat_offset"] =I650; $aDefault["item_offset"] ="offset"; $aDefault["catid_varname"] ="catid"; $aDefault[I651] ="sort"; $aDefault["sortdim_varname"] ="sdim"; $aDefault["catsortcol_varname"] =I652; $aDefault["catsortdim_varname"] ="catsdim"; $aDefault["filter_box_template"] ="templates/filter_box.tpl"; $aDefault["filter_form_template"] ="templates/filter_form.tpl"; $aDefault["filter_lang_file"] ="templates/lang/filter.lng"; $aDefault["filter_msgs_file"] ="templates/lang/_filter_msgs.lng"; $aDefault["filter_pages_setup"] =$this->TTT1llI("filter_pages_setup"); $aDefault["sort_pages_setup"] =$this->TTT1llI("sort_pages_setup"); $aDefault[I653] =$this->TTT1llI(I653); $aDefault["hide_empty_simple"] =$this->module->issetOption('hide_empty_simple') ?$this->module->GetAOption('hide_empty_simple') :array(); $aDefault["support_rights"] =$this->module->issetAndTrueProperty(I654); $aDefault["allowed_actions"] =Array(); $vMod =&$this->module->TTlIIIT(); $aDefault["name_field_name"] ="name"; $aDefault["strip_tags_before_autolink"] =false; $aDefault["cat_name_field_name"] ="name"; $aDefault["description_field_name"] ="description"; $aDefault["announce_field_name"] =I655; $aDefault["show_body_browse"] =$this->module->issetAndTrueOption("show_body_browse"); $aDefault["front_require_login"] =false; $aDefault['use_special_list_view'] =$this->module->IssetAndTrueProperty('use_special_list_view') && AMI::doFilterFrn($this->moduleName); $aDefault["stop_arg_names_mod_name"] =$this->moduleName; $aDefault["front_mod_name"] =$this->moduleName; $aDefault["use_positions"] =false; $aDefault["group_operations_popup"] =Array(); $aDefault[I656] =$this->module->IssetAndTrueProperty(I656); $aDefault["use_details_noindex"] =true; $aDefault["generate_id_external"] =$this->module->IssetAndTrueOption("generate_id_external"); $aDefault["auto_gen_id_external"] =($this->module->issetOption("auto_gen_id_external"))?$this->module->GetOption("auto_gen_id_external"):"Amiro_gen_"; $aDefault["admin_views"] =Array("list", I657); $aDefault['hide_future_items'] =$this->module->issetAndTrueOption('hide_future_items') && AMI::doFilterFrn($this->moduleName); $aDefault['additional_extensions'] =array(); $aDefault['item_pictures'] =($this->module->issetOption(I658))?$this->module->GetAOption(I658):array(); $this->options += $aDefault; if(!array_key_exists(I649, $this->options) || $this->options[I649] <1) {$this->options[I649] =1; }foreach( array( I640 => 'name_field_name', 'announce' => 'announce_field_name', 'body' => 'description_field_name', )as $mappedField => $field ){$this->IIll1lL[$mappedField] =$this->options[$field]; }if(!$this->doMapping){ $this->IIll1lL =array_combine( array_keys($this->IIll1lL), array_keys($this->IIll1lL) );}if(!array_key_exists('future_items_date_field', $this->options)) {$this->options['future_items_date_field'] =$this->IIll1lL['date_created']; }if(($this->side != "admin") && $this->moduleName == I659){ $oRequest =AMI::getSingleton('env/request'); $this->IIll1I1 =$oRequest->get('response_type', FALSE); if($this->IIll1I1 !== FALSE){ $IIll1LL =strtolower($oRequest->get('response_options', FALSE)); $IIll1ll =array(); if($IIll1LL !== FALSE){ $IIll1L1 =explode('|', $IIll1LL); foreach($IIll1L1 as $part){ $IIll1ll[$part] =true; }}$this->IIll1ll =$IIll1ll; $IIll11I =$this->module->GetOption(I660); $IIll11l =array(); foreach($IIll11I as $extension){ if(!isset($IIll1ll[$extension])){ $IIll11l[] =$extension; }}$this->module->SetOption('extensions', $IIll11l); }}$vModName =$this->cms->getStopArgModName($this->options["stop_arg_names_mod_name"]); if(!empty($vModName) && !isset($this->options["stop_use_sublinks"])) {$this->options["stop_use_sublinks"] =($this->cms->Core->issetModProperty($vModName, I661) && $this->cms->Core->GetModProperty($vModName, I661)); $this->options["stop_arg_names_mod_name"] =$vModName; }$this->IIlllIl += Array($aDefault[I651], $aDefault["sortdim_varname"], $aDefault["catsortcol_varname"], $aDefault["catsortdim_varname"]); if(!$this->module->IssetOption(I662) || $this->module->GetOption(I662) == "none") {if(isset($this->options[I644]) && is_array($this->options[I644])) {$ind =array_search("gen_keywords", $this->options[I644]); if($ind !== false) {unset($this->options[I644][$ind]); }$ind =array_search("gen_sublink", $this->options[I644]); if($ind !== false) {unset($this->options[I644][$ind]); }$ind =array_search("index_details", $this->options[I644]); if($ind !== false) {unset($this->options[I644][$ind]); }$ind =array_search(I663, $this->options[I644]); if($ind !== false) {unset($this->options[I644][$ind]); }}}if(!$this->cms->Core->TTlIlll()){ $this->cms->Core->SetOption($this->cms->Core->IlLII1L, false); $this->cms->Core->SetOption($this->cms->Core->IlLII11, 1); }$this->options["default_table_alias"] =empty($this->options["default_prefix"]) ?I645: " AS ".$this->options["default_prefix"]; $this->options[I664] =empty($this->options[I664]) ?I645 :$this->options[I664]."."; $this->options["id_page_prefix"] =$this->options[I664]; $this->options["use_id_page"] =$this->cms->Core->TTlI1T1($this->options[I647], "multi_page") && $this->cms->Core->issetAndTrueOption(I665); $this->options["_use_id_page_orig"] =$this->options["use_id_page"]; $aExt =$this->module->issetOption('extensions') ?$this->module->GetAOption(I660) :array(); $aExt =array_unique(array_merge($aExt,$this->options["additional_extensions"])); if(sizeof($aExt) >0) {foreach(array(I666, 'ext_reindex') as $IIll11L){ if(in_array($IIll11L, $aExt)){ $IIll111 =array_search($IIll11L, $aExt); $IIlLIII =sizeof($aExt) -1; if($IIll111 != $IIlLIII){ array_splice($aExt, $IIll111, 1); $aExt[] =$IIll11L; }}}foreach($aExt as $IIlLIIl) {if($this->cms->Core->IsInstalled($IIlLIIl)) {$ext =&$this->GetExtension($IIlLIIl); if(is_object($ext)) {$this->ext[$IIlLIIl] =&$ext; $this->ext[$IIlLIIl]->Init($this->cms, $this->module, $this); }else {$this->IIllIl1[$IIlLIIl] =false; trigger_error("CMS_ActModule::Init: class_name is not specified for module $IIlLIIl", E_USER_WARNING); }}else {$this->IIllIl1[$IIlLIIl] =true; }}}if($this->module->IssetProperty("function_class")) {require_once $GLOBALS['CLASSES_PATH'] .'CMS_Functions.php'; $className =$this->module->GetProperty(I667); require_once $GLOBALS['CLASSES_PATH'] .$className .'.php'; $this->fn =new $className($this->cms, $this->db, $this->module, $this); }if($this->options["multi_sites"]) {if($this->cms->Core->IsInstalled("srv_multi_sites")) {if($this->module->IssetOption(I668) && !$this->module->GetOption(I668)) {$this->options["multi_sites"] =false; }}else {$this->options["multi_sites"] =false; }}$IIlLIIL =Array("action"=>"init"); $this->TTT1lI1($IIlLIIL); $this->browser =&$this->cms->Pager; switch($this->side) {case I669: if(isset($this->cms->Vars["sort"]) && $this->module->TTlT1IT($this->cms->Vars["sort"]) ){$SortCol =$this->cms->Vars["sort"]; }else {$SortCol =$this->module->GetOption("page_sort_col"); if(!$SortCol){ $SortDim =I670; }}if(isset($this->cms->Vars["sdim"])) {$SortDim =($this->cms->Vars["sdim"]=="desc")?"desc":I671; }else {$SortDim =$this->module->GetOption("page_sort_dim"); if(!$SortDim){ $SortDim ='desc'; }}$this->TTTlIIT(isset($this->cms->Vars["offset"]) ?$this->cms->Vars["offset"] :null, $SortCol, $SortDim); $this->_InitAdmin(); break; default: $this->TTTlTI1(); break; }foreach($IIll1l1 as $name => $files) {if(!is_array($files)) {$files =Array($files); }foreach($files as $fname) {$this->cms->Gui->mergeBlock($name, $fname); }}if(empty($IIll1Ll)) {$IIll1Ll ="templates/lang/main.lng"; }if(!empty($IIll1LI)) {$this->cms->AddMessages($this->cms->Gui->ParseLangFile($IIll1LI)); }if(!is_array($IIll1Ll)) {$this->words =$this->cms->Gui->ParseLangFile($IIll1Ll); }else {$this->words =Array(); foreach($IIll1Ll as $IIlLII1) {$this->words += $this->cms->Gui->ParseLangFile($IIlLII1); }}$IIlLIIL =Array("action"=>"init_post"); $this->TTT1lI1($IIlLIIL); if($this->side == I669 && $this->options["_use_id_page_orig"]) {$this->TTTlTIl(); }$this->initialized =true; }function _InitAdmin() {$this->TTITTTl(); $IIlLIlI =false; if(!empty($this->cms->Vars[I672])){ $this->cms->Gui->AddGlobalVars(array( I673 => I674 ));}$this->filter =&$this->cms->Filter; if($this->IIlllll) {$this->filter->ReInitTemplates($this->options["filter_box_template"], $this->options["filter_form_template"]); $this->filter->SetCaptions($this->cms->Gui->ParseLangFile($this->options["filter_lang_file"])); $this->filter->SetMessages($this->cms->Gui->ParseLangFile($this->options["filter_msgs_file"])); }$this->cms->Gui->AddGlobalVars(array (I675 =>$this->IIllIIL, "FORM_MODE" =>"ADD" ));if(isset($this->cms->Vars[I676])) {$this->options["id_page"] =intval($this->cms->Vars[I676]); }else {$this->options["id_page"] =-1; }if(isset($this->cms->VarsPost["id_page"])) {if($this->options["id_page"] != $this->cms->VarsPost[I677] && $this->cms->VarsPost[I677] >0) {$this->options[I677] =-1; $this->filter->UpdateField("offset", 0); }}$this->cms->Gui->addBlock("options_form", $this->IIlll11."_mod_options_form.tpl"); if(!empty($this->options['stop_use_sublinks'])){ $this->cms->Gui->addGlobalVars(array(I678 => '1')); }if($this->options['use_special_list_view']) {$this->cms->Gui->addGlobalVars(Array("USE_SPECIAL_LIST_VIEW"=>true)); }if($this->options[I656]) {$this->cms->Gui->addGlobalVars(Array("USE_ID_EXTERNAL"=>I679)); }if($this->options["use_details_noindex"]) {$this->cms->Gui->addGlobalVars(Array("USE_DETAILS_NOINDEX"=>I679)); }if($this->cms->Core->issetModOption($this->options["stop_arg_names_mod_name"], "stop_arg_names")) {$stopArgNames =$this->cms->Core->GetModOption($this->options["stop_arg_names_mod_name"], "stop_arg_names"); $IIlLIll =array_search($this->moduleName, $stopArgNames); if(!empty($IIlLIll)) {$this->IIlllLl =Array("id"=>Array("id"=>$IIlLIll, "sublink"=>Array(I680=>$IIlLIll."_sublink", "var"=>"sublink"))); }}if($this->options["multi_sites"]) {$this->siteId =intval($this->cms->Vars[I681]); }$IIlLIlI =$this->options["_use_id_page_orig"] || $this->options["use_positions"]; if(isset($this->options[I644]) && is_array($this->options[I644]) && sizeof($this->options[I644]) >0) {$this->IIllllI =true; $this->cms->Gui->mergeBlock($this->moduleName."_list", $this->IIlll11."_group_operations.tpl", true); $this->cms->AddMessages($this->cms->Gui->ParseLangFile($this->IIlll11."lang/_group_operations_msgs.lng")); }else {$this->IIllllI =false; }$this->cms->Gui->mergeBlock($this->moduleName."_form", $this->IIlll11."_group_operations.tpl", true); if($IIlLIlI) {$this->cms->Gui->mergeBlock($this->moduleName."_list", $this->IIlll11."_common_fields.tpl", true); }$this->cms->Gui->mergeBlock($this->moduleName.I682, $this->IIlll11."_common_form_fields.tpl", true); $IIlLIIL =Array("action"=>"init_admin"); $this->TTT1lI1($IIlLIIL); }function TTTlTIl() {require_once $GLOBALS['FUNC_INCLUDES_PATH'] .I683; $this->IIllll1 =$this->moduleName == $this->options[I647] ?$this->module->TTlIT1I() :$this->cms->Core->TTlI1I1($this->options[I647]); $this->cms->Gui->addGlobalVars(Array("USE_ID_PAGE"=>I679)); $this->IIlllLI =sizeof($this->IIllll1); if(is_array($this->IIllll1)){ sortMultiArrayPreserveKeys($this->IIllll1, 'name'); }else{ $this->IIllll1 =array(); $this->IIlllLI =0; }}function TTTlTI1() {$this->IIllL1l =$GLOBALS['IIlLIlL']; $this->IIllL11 =false; $this->IIll1II =I643; $this->browser->ShowPageSizeBox =false; if($this->module->IssetOption("show_page_size")) {$this->browser->ShowPageSizeBox =$this->module->GetOption(I684); }$this->browser->lll1Ill =$this->module->issetAndTrueOption("pager_page_number_as_bound"); $this->IIllILl =Array(); $this->IIllILL =false; if(sizeof($this->options[I658]) >0 || $this->options["show_body_browse"] || isset($this->ext["ext_discussion"])) {$this->cms->Gui->mergeBlock($this->moduleName."_list", I685, true); }foreach(array(I686 => 'cat_offset', 'offset' => 'item_offset', 'catId' => I687) as $varName => $optionName){ $option =$this->options[$optionName]; foreach(array('VarsPost', 'VarsGet') as $sourceName){ $source =$this->cms->$sourceName; if(isset($source[$option])) {$value =$source[$option]; $this->TTITTIT($value); $this->$varName =(int)$value; break; }}}if($this->options["multi_sites"]) {$this->siteId =intval($this->cms->Core->GetModOption("srv_multi_sites", I680)); }if($this->options[I688] && isset($this->cms->Vars["mode"]) && $this->cms->Vars["mode"] == "browse" && isset($this->cms->Vars[$this->options["item_offset"]])) {$this->IIlllL1 =true; }if($this->options["stop_arg_names_mod_name"] != $this->moduleName) {$this->cms->InitNavSettings($this->options["stop_arg_names_mod_name"]); }$this->bodyType =I645; $this->IIllIL1 =Array(); $this->TTTlTlT($this->moduleName, $this->module); $IIlLIIL =Array("action"=>"init_front"); $this->TTT1lI1($IIlLIIL); }function TTTlTlT($modName, &$vMod) {$expireTime =I645; if($vMod->IssetOption("cache_expire_force")) {$expireTime =$vMod->GetOption(I689); if($expireTime != I645) {$expireTime =strtotime($expireTime); }}$IIlLIl1 =$this->TTITTTl(true); if (!empty($expireTime) && !empty($IIlLIl1)) {$this->cms->Core->Cache->SetForceExpireTime($modName, min($expireTime, $IIlLIl1)); }else if (!empty($expireTime)) {$this->cms->Core->Cache->SetForceExpireTime($modName, $expireTime); }else if (!empty($IIlLIl1)) {$this->cms->Core->Cache->SetForceExpireTime($modName, $IIlLIl1); }}function SetLastError($errno =0, $error ="OK") {$this->errno =$errno; $this->error =$error; }function GetLastError() {return Array("errno" => $this->errno, "error" => $this->error); }function ProcessAction($IIIL11l, $cId, $cModule =I645) {if($this->side != I669) {$this->TTT1IIl(); $this->TTITTIT($cId); }$this->appliedId =0; $this->IIllIll =0; $this->action =$IIIL11l; $id =intval($cId); $this->id =$id; $IIlLILI =mb_strpos($this->action, "grp_"); if($this->IIllllI) {if($this->action != I690 && $IIlLILI === false) {if($this->action != "none") {$this->cms->Vars["_grp_ids"] =I645; }}elseif($IIlLILI !== false) {$actionName =mb_substr($this->action, 4); if(!in_array($actionName, $this->options[I644]) && !in_array($actionName, $this->options["group_operations_popup"])) {$this->action ="none"; }}}$this->aGroupIds =isset($this->cms->Vars[I691]) ?$this->TTTlT11($this->cms->Vars[I691]) :array(); $this->action =$this->TTTlTl1($this->action,$id,$cModule,$this->aGroupIds); if ($this->side=='admin' && !isset($this->redirect)) {$this->redirect =true; }if($this->action != "none") {$IIlLIIL =Array("action" => "process_".$this->side, I680 => $cId, I692 => Array("ext_action" => $this->action)); $this->TTT1lI1($IIlLIIL); }$this->TTTlITT($this->action, $id, $cModule); if($this->action != "none") {$IIlLIIL =Array("action" => "post_process_".$this->side, I680 => $cId, I692 => Array(I693 => $this->action)); $this->TTT1lI1($IIlLIIL); }if (!empty($this->forceRedirect) || (!empty($this->cms->VarsGet['action']) && $this->redirect)) {$this->TTTlTlI(); }$this->TTTlTll(); }function TTTlTlI() {global $conn; $query =array ();if (mb_strpos($this->cms->ActiveScript, '?') !== false) {$IIlLILl =parse_url($this->cms->ActiveScript); if (isset($IIlLILl['query'])) {parse_str($IIlLILl['query'], $query); mb_internal_encoding(I694); $this->cms->ActiveScript =$IIlLILl['path']; }else {$this->cms->ActiveScript =mb_substr($this->cms->ActiveScript, 0, -1); }}$IIlLILL =array ();$get =$this->cms->VarsGet; unset($get[I670], $get['action']); foreach ($get as $k => $v) {if (is_array($v)) {unset($query[$k]); foreach ($v as $IIlLIL1 => $IIlLI1I) {$IIlLILL[] =$k .'[' .$IIlLIL1 .']=' .urlencode((string)$IIlLI1I); }}else {$query[$k] =urlencode($v); }}foreach ($query as $k => $v) {$query[$k] =$k .I695 .$v; }$query =array_merge($query, $IIlLILL); if(isset($get['_url_hash_data']) && strlen($get['_url_hash_data'])){ $this->IIlll1L =$get['_url_hash_data']; }$url =$this->cms->AdminPathWWW .$this->cms->ActiveScript .'?' .implode(I696, $query) .rawurldecode(html_entity_decode($this->IIlll1L)); $this->cms->getStatusMsgArrays($sys, $plain); $msg =array('sys' => $sys, 'plain' => $plain); SetLocalCookie('status_msg', serialize($msg), time() +3600); $null =null; doRedirect301($url, $null); }function TTTlTll() {$arr =array(); if(isset($this->cms->VarsGet['status_msg']) || isset($this->cms->VarsCookie[I697])){ $msg =stripslashes(isset($this->cms->VarsGet[I697]) ?$this->cms->VarsGet[I697] :$this->cms->VarsCookie[I697]); $arr=unserialize(unhtmlentities($msg)); if (is_array($arr) && is_array($arr['sys']) && is_array($arr['plain'])) {foreach (array ('sys', 'plain') as $source) {foreach ($arr[$source] as $k => $v) {if (is_array($v) && isset($v[I698])) {$msg =strip_tags(preg_replace('/<script[^>]*>.*?<\/script[^>]*?>?/si', I643, $v[I698])); $this->cms->TTITIlI($msg); $arr[$source][$k][I698] =$msg; }else {unset($arr[$source][$k]); }}}$this->cms->TTITIlT($arr['sys'],$arr['plain']); }}if ($this->side == 'front') {$this->cms->SetSpecialBlock(I699, $this->cms->GetStatusMessages()); SetLocalCookie(I697, I643, time() -36000); }else{ if(isset($this->cms->VarsGet[I697]) || isset($this->cms->VarsCookie[I697])){ SetLocalCookie(I697, I643, time()+1); }}}function TTTlTl1($IIIL11l, $id, $cModule, &$IIlLI1l){ $modId =I643 == $cModule ?$this->moduleName :$cModule; $aEvent =array( 'modId' => $modId, 'action' => &$IIIL11l, I670 => $id, 'aGrpIds' => &$IIlLI1l, '_discard' => FALSE );AMI_Event::fire('v5_on_action_verification', $aEvent, AMI_Event::MOD_ANY); if($aEvent['_discard']){ $IIIL11l ='none'; }return $IIIL11l; }function TTTlT1T($IIIL11l,$id,$cModule,&$IIlLI1l) {return $IIIL11l; }function TTTlT1I($aActions) {return $aActions; }function TTTlT1l() {return SYS_A_RIGHT; }function TTTlT11($groupsIdsList) {$aGroupIds =Array(); $aTmpGroupIds =explode(";", $groupsIdsList); if(is_array($aTmpGroupIds)) {$numGroupIds =sizeof($aTmpGroupIds); unset($aTmpGroupIds[$numGroupIds -1]); unset($aTmpGroupIds[0]); }$numGroupIds--; $k =0; for($i=1; $i<$numGroupIds; $i++) {$id =intval($aTmpGroupIds[$i]); if($id >0) {$aGroupIds[$k++] =$id; }}$aGroupIds =array_unique($aGroupIds); return $aGroupIds; }function TTTlITT($IIIL11l, $cId, $cModule =I645) {if(isset($this->IIll1Il[$IIIL11l])){ if(is_string($this->IIll1Il[$IIIL11l])){ if(class_exists($this->IIll1Il[$IIIL11l], true)){ if(!in_array('CMS_Mod_ActionHandler_Interface', class_implements($this->IIll1Il[$IIIL11l]))){ trigger_error('Handler must implement interface CMS_Mod_ActionHandler_Interface', E_USER_ERROR); }$this->IIll1Il[$IIIL11l] =new $this->IIll1Il[$IIIL11l]; }}$this->actionId =(int)$cId; return $this->IIll1Il[$IIIL11l]->processAction($this); }switch($this->side) {case I669: switch ($IIIL11l) {case "view": $this->TTTll1l($cId, $cModule); $this->redirect =false; break; case "add": $this->TTTll11($cId, $cModule); break; case "edit": $this->TTTl1Tl($cId, $cModule); if(empty($this->itemData[I680])) {$this->cms->Gui->AddGlobalVars(Array("FORM_MODE"=>I700)); $this->action ="none"; }$this->redirect =false; break; case "copy": $this->_ActionCopy($cId, $cModule); break; case "cancel": $this->TTTl1T1($cId, $cModule); $this->redirect =false; break; case "del": $this->_ActionDel($cId, $cModule); break; case I701: $this->TTTl1IT($cId, $cModule); break; case "apply": $this->TTTl1lI($cId, $cModule); break; case "save": $this->TTTl1ll($cId, $cModule); break; case "publish": $this->_ActionPublish($cId, $cModule); break; case "archive": $this->_ActionArchive($cId, $cModule); break; case I702: $this->TTTl11I($cId, $cModule); break; case "repair": $this->TTT1Tl1($this->cms->Vars["type"], $cModule); break; case "top": case "bottom": case I703: case "down": $this->IIllLLl =$this->options["use_positions"]; $this->redirect =false; break; case "locate": $this->TTT1ITT($cId, $cModule); $this->redirect =false; break; case "grp_del": $this->TTTl1I1($this->aGroupIds, $cModule); break; case I704: $this->TTTl1lT($this->aGroupIds, $cModule); break; case "grp_publish_on": $this->TTTl1l1($this->aGroupIds, $cModule); break; case "grp_publish_off": $this->TTTl11T($this->aGroupIds, $cModule); break; case "grp_archive_on": $this->TTTl11l($this->aGroupIds, $cModule); break; case "grp_archive_off": $this->TTTl111($this->aGroupIds, $cModule); break; case I705: $this->TTT1TTT($this->aGroupIds, $cModule); break; case "grp_gen_sublink": $IIlLI1L =I645; if($this->cms->Core->IssetModOption($this->moduleName, "add_date_prefix")){ $IIlLI1L =", DATE_FORMAT(`" .$this->IIll1lL['date_created'] ."`, '%d.%m.%Y') `prefix_date`"; }$this->TTT1TT1($this->aGroupIds, $cModule, $IIlLI1L); break; case "grp_move_position": $this->IIllLLl =$this->options["use_positions"]; $this->redirect =false; break; case "grp_open_popup": $this->TTT1TIl($this->aGroupIds, $cModule); break; case "grp_id_page": $this->TTT1TlT($this->aGroupIds, $cModule); break; case I706: $this->TTT1TIT($this->aGroupIds, $cModule); break; case "grp_no_index_details": $this->TTT1TII($this->aGroupIds, $cModule); break; case I690: case "none": $this->redirect =false; break; }break; default: switch ($IIIL11l) {case "add": $this->TTT1ITI($cId, $cModule); break; case "edit": $this->TTT1ITl($cId, $cModule); break; case I707: $this->TTT1IT1($cId, $cModule); break; case "search": $this->IIlllI1 =true; case I690: $this->IIlllIL =(sizeof($this->cms->VarsGet) >0) && $this->cms->Core->GetOption('use_front_filter_cookie'); break; }break; }}function TTTlITI($IIIL11l, $cId) {switch($IIIL11l) {case "top": case "bottom": $this->TTT1T1l($IIIL11l, $cId); break; case I703: case I708: $this->TTT1T1I($IIIL11l, $cId); break; }}function GetHtml(&$aCustom) {$res =false; if(!$this->initialized) {trigger_error(I709.$this->module->GetName(), E_USER_WARNING); return $res; }if(!is_array($aCustom)) {$aCustom =Array(); }switch($this->side) {case I669: $res =&$this->TTTlI1T($aCustom); break; default: $res =&$this->TTTllTl($aCustom); break; }return $res; }function TTTlITl(&$aCustom, $cType ="small", $IIlLI11 =I645, $IIlLlII ="_small") {if($this->IIllLl1) {$this->cms->Gui->copyBlock($this->moduleName."_list_backup", $this->moduleName."_list"); $this->cms->Gui->dropBlock($this->moduleName.I710); $this->IIllLl1 =false; }if($this->module->IssetOption("spec_block_template")) {$specBlockTemplate =$this->module->GetOption("spec_block_template"); if($this->cms->Gui->isValidFile($specBlockTemplate)) {$this->cms->Gui->copyBlock($this->moduleName."_list", $this->moduleName.I710); $this->cms->Gui->mergeBlock($this->moduleName."_list", $specBlockTemplate); $this->IIllLl1 =true; }}if($this->options[I711] && $this->module->IssetOption("spec_id_pages")) {$this->options["spec_id_pages"] =$this->module->GetAOption("spec_id_pages"); }$aRes =$this->TTTlIT1($aCustom, $cType, $IIlLI11, $IIlLlII); return $aRes; }function TTTlIT1(&$aCustom, $cType, $IIlLI11, $IIlLlII) {$this->SetBodyType("body_small"); $this->isSmallMode =true; $aRes =Array(); if(!is_array($aCustom)) {$aCustom =Array(); }if(!isset($aCustom[I712]) || !is_array($aCustom[I712])) {$aCustom[I712] =array(); }$aCustom["sql_addon"] =Array("select"=>I645, "from"=>I645, "where"=>I645, I713=>I645); $IIlLIIL =Array("action"=>"small_".$cType, I692=>&$aCustom); $this->TTT1lI1($IIlLIIL); if($cType == "small" && $this->module->issetProperty("spec_blocks")){ $this->options[I661] =!empty($this->options[I661]) || !empty($IIlLI11); if($this->options[I661]) {$this->cms->PushNavSettings(); $this->cms->InitNavSettings(empty($IIlLI11) ?$this->module->GetName(): $IIlLI11); }$this->module->TTlITI1($IIlLlII); $this->module->PushPager($this->browser); $this->TTT1I11(); $this->TTTlTIl(); $aCustom[I714]["simple_prefix"] ="small_"; $specName =$this->module->GetProperty("active_spec_blocks"); if($this->module->IssetOption("small_view_mode")) {if($this->module->GetOption(I715) == "calendar") {$aRes["body"] =TlT1I1I($this); $this->cms->Core->Cache->TT1TI1T($specName."_calendar", 1); }else {$this->TTTll1I($aRes, $aCustom, $cType, $IIlLlII); $this->cms->Core->Cache->TT1TI1T($specName."_calendar", 0); }}else {$this->TTTll1I($aRes, $aCustom, $cType, $IIlLlII); }$this->cms->SetSpecialBlock($this->module->GetProperty(I716), $aRes["body"]); $this->TTT1lTT(); $this->module->PopPager($this->browser); $this->module->TTlITlT(); if($this->options[I661]) {$this->cms->PopNavSettings(); }$this->IIllILl =Array(); $this->IIllILL =false; }elseif ($cType != "small") {$this->TTTll1I($aRes, $aCustom, $cType, $IIlLlII); }$IIlLIIL =Array("action"=>"small_".$cType, I717=>&$aRes, I692=>&$aCustom); $this->TTT1lI1($IIlLIIL); $this->isSmallMode =false; return $aRes; }function TTTlIIT($cOffset, $cDefSort, $cDefSdim, $cPageSize =0, $cShowPageSizeBox =true, $pagerType ="page", $browseActiveItemPosition =1) {$cDefSdim =mb_strtolower($cDefSdim); if($cDefSdim !== 'asc' && $cDefSdim !== 'desc'){ $cDefSdim ='asc'; }$this->browser->ShowPageSizeBox =$cShowPageSizeBox; $this->browser->SortCol =$cDefSort; $this->browser->TapePosition =$browseActiveItemPosition; $this->browser->SortDim =$cDefSdim; $this->browser->Position =$cOffset; if(!empty($cPageSize)) {$this->browser->PageSize =$cPageSize; }$this->cms->Vars[I718] =$this->browser->InitPageSizeBox($this->cms->Core->GetOption("items_per_page")); $this->browser->SetMode($pagerType); }function TTTlIII() {if($this->options["use_id_page"] && $this->side==I669) {$aPages =array(); foreach($this->IIllll1 as $pageId=>$aPageData) {$aPages =$this->filter->TITI1TT($aPages, Array($aPageData["name"]=>$pageId), 35); }$this->IIllll1["0"] =Array(I680=>0, I719=>$this->words["common_item"]); $aPages =$this->filter->TITI1TT($aPages, Array($this->words["common_items"]=>0), 35, false); $aPages =$this->filter->TITI1TT($aPages, Array($this->words["all_pages"]=>-1), 35, false); $this->filter->AddField(I676, "select", $this->options[I677], I645, I720, $this->options[I664].I677, $aPages); $this->filter->MoveField(I676, _MOVE_START); if($this->options[I677] == -1) {$this->filter->DisableFieldSQL(I676); }else {$this->filter->TITI1II(I676, "OR ".$this->options[I664]."id_page=0"); }}if($this->IIllllI) {$grpIdsVal =I645; if(sizeof($this->aGroupIds) >0) {$grpIdsVal =";".implode(";", $this->aGroupIds).I721; }$this->filter->AddField(I691, "hidden", $grpIdsVal); }if($this->side == I669 && !empty($this->cms->Vars[I672])){ $this->filter->AddField(I673, "hidden", '1', I643, I645, I645, I645, 0, 0); }$IIlLIIL =Array("action"=>I722); $this->TTT1lI1($IIlLIIL); if($this->cms->Core->IssetModOption($this->moduleName, "admin_filter_custom_fields")){ $IIlLlIl =$this->cms->Core->GetModOption($this->moduleName, "admin_filter_custom_fields"); if(is_array($IIlLlIl)){ foreach($IIlLlIl as $IIlLlIL => $cstData){ $IIlLlI1 =$IIlLlIL; $IIlLllI =stripslashes(unhtmlentities($this->cms->Vars['flt_'.$IIlLlIL])); $IIlLlll =I643; $fieldType ="text"; if(mb_strpos($IIlLlIL, I723) === 0){ $IIlLllL =$this->cms->Core->GetModOption('members', "custom_fields"); $IIlLlI1 ='custom_data'; $IIlLlll =mb_substr($IIlLlIL, 12); if(isset($IIlLllL[$IIlLlll]) && $IIlLllL[$IIlLlll]['type'] == I724){ $fieldType ="checkbox"; }}if(is_array($cstData['caption'])){ $IIlLll1 =isset($cstData['caption'][$this->cms->lang]) ?$cstData['caption'][$this->cms->lang] :I643; }else{ $IIlLll1 =$cstData[I725]; }$this->filter->AddCaptions(array('flt_'.$IIlLlIL => $IIlLll1)); if($fieldType == I724){ $this->filter->AddField('flt_'.$IIlLlIL, "checkbox", intval($IIlLllI), '0', I726, $IIlLlI1); }else{ $this->filter->AddField('flt_'.$IIlLlIL, "text", $IIlLllI, I645, " like ", $IIlLlI1); }if(empty($IIlLllI)){ $this->filter->DisableFieldSQL('flt_'.$IIlLlIL); }else if($IIlLlll != I643){ $this->filter->TITI1II(I727.$IIlLlIL, '=| AND 0 OR '.$this->options[I664].$IIlLlI1.' REGEXP \'"'.$IIlLlll.'";s\\:[0-9]+\\:"'.addslashes(str_replace('\\*', I728, preg_quote($IIlLllI))).'.*";\'', "force"); }}}}}function TTTlIIl($IIlLlLI, $IIlLlLl, $defaultValue) {if(mb_substr($IIlLlLI, 0, 9) == "Vsplitter") {$this->filter->AddField($IIlLlLI, "Vsplitter"); }else if(mb_substr($IIlLlLI, 0, 9) == I729) {$this->filter->AddField($IIlLlLI, I729); }else if(mb_substr($IIlLlLI, 0, 6) == "Sblock") {$this->filter->AddField($IIlLlLI, "Sblock"); }else if(mb_substr($IIlLlLI, 0, 6) == "Fblock") {$this->filter->AddField($IIlLlLI, "Fblock"); }else {$IIlLlLL =Array(); $IIlLlLL[I730] =$IIlLlLI; $IIlLlLL["value"] =$IIlLlLl; $IIlLIIL =Array("action"=>"init_front_filter_field", I717=>$IIlLlLL); $this->TTT1lI1($IIlLIIL); }}function TTTlII1($IIlLlL1 =I645) {$this->offset =(int)$this->offset; $this->IIllI1I =false; $IIlLl1I =Array(); if(!(isset($this->cms->Vars["flt_force_values"]) && $this->cms->Vars[I731] == I679) && isset($this->cms->VarsCookie[$this->IIlllII])) {$aTmp =unserialize(rawurldecode(unhtmlentities($this->cms->VarsCookie[$this->IIlllII]))); $IIlLl1I =empty($aTmp[$this->cms->ActiveScriptNavLink]) ?array() :$aTmp[$this->cms->ActiveScriptNavLink]; unset($aTmp); }$IIlLlLL =Array(); $IIlLlLL["pages_setup"] =&$this->options["filter_pages_setup"][$IIlLlL1]; $IIlLlLL["body_type"] =$IIlLlL1; $aEvent =array( 'discard_ext_init_front_filter' => FALSE );AMI_Event::fire('deprecated_v5_on_front_filter_init', $aEvent, $this->moduleName); AMI_Event::fire('v5_on_front_filter_init', $aEvent, $this->moduleName); if(empty($aEvent['discard_ext_init_front_filter'])){ $IIlLIIL =Array("action"=>"init_front_filter", I717=>$IIlLlLL); $this->TTT1lI1($IIlLIIL); }$IIlLl1l =array(I732 => $IIlLlL1); $IIlLl1L =array(); if(empty($aEvent['discard_ext_createfilterfields'])){ $IIlLIIL =Array("action"=>"createfilterfields", I717=>&$IIlLl1l, I692=>&$IIlLl1L); $this->TTT1lI1($IIlLIIL); }$this->filter->SetCaptions(array_merge($this->filter->GetCaptions(), $IIlLl1L)); if (isset($IIlLl1l[I732])) {unset($IIlLl1l[I732]); }if((isset($this->options["filter_pages_setup"][$IIlLlL1]) && sizeof($this->options[I733][$IIlLlL1]) >0) || sizeof($IIlLl1l) >0) {$this->IIllI1I =true; $aFields =is_array($this->options[I733][$IIlLlL1]) ?array_merge($this->options[I733][$IIlLlL1], $IIlLl1l) :$IIlLl1l; $IIlLl11 =Array(); if($this->module->IssetOption("filter_defaults")) {$IIlLl11 =$this->module->GetOption("filter_defaults"); }foreach($aFields as $fieldName) {$defaultValue =I645; if(isset($IIlLl11[$fieldName])) {$defaultValue =$IIlLl11[$fieldName]; }$fieldValue =I645; if(isset($this->cms->VarsGet[$fieldName])) {$fieldValue =$this->cms->VarsGet[$fieldName]; }elseif($this->action != I690) {if(isset($IIlLl1I[$IIlLlL1][$fieldName])) {$fieldValue =$IIlLl1I[$IIlLlL1][$fieldName]; }else {$fieldValue =$defaultValue; }}$this->TTTlIIl($fieldName, $fieldValue, $defaultValue); }if($this->IIlllIL) {$IIlLLII =$this->filter->GetFieldsAsArray(); foreach($IIlLLII as $fieldName=>$fieldValue) {$this->IIlllIl[] =$fieldName; }}$this->filter->AddField("submit", "submit"); }$IIlLl1l =array(I732 => $IIlLlL1); $IIlLIIL =Array(I734=>"postcreatefilterdata", I717=>$IIlLl1l, I692=>false); $this->TTT1lI1($IIlLIIL); $this->filter->AddField(I734, "hidden", I690); if($IIlLlL1 == "body_search") {$this->filter->AddField("offset", I735, $this->offset); }if($this->bodyType == "body_filtered") {$this->filter->AddField("body_filtered", I735, 1); }}function TTTlIlT() {$IIlLl1I =Array(); if(isset($this->cms->VarsCookie[$this->IIlllII])) {$IIlLLIl =rawurldecode(unhtmlentities($this->cms->VarsCookie[$this->IIlllII])); $aTmp =unserialize(rawurldecode(unhtmlentities($this->cms->VarsCookie[$this->IIlllII]))); if(isset($aTmp[$this->cms->ActiveScript]) && is_array($aTmp[$this->cms->ActiveScript])){ $IIlLl1I =$aTmp[$this->cms->ActiveScript]; }}foreach($this->IIllIL1 as $bodyType => $tmp) {if(isset($this->options["sort_pages_setup"][$bodyType]) && sizeof($this->options["sort_pages_setup"][$bodyType]) >0) {if (in_array($bodyType, array (I736, 'body_urgent_cats'))) {$IIlLLIL =$this->options["catsortcol_varname"]; $IIlLLI1 =$this->options["catsortdim_varname"]; }else {$IIlLLIL =$this->options[I651]; $IIlLLI1 =$this->options["sortdim_varname"]; }if(isset($this->cms->VarsGet[$IIlLLIL])) {$sortCol =$this->cms->VarsGet[$IIlLLIL]; }elseif(!empty($IIlLl1I[$this->bodyType][$IIlLLIL])) {$sortCol =$IIlLl1I[$this->bodyType][$IIlLLIL]; }else {$sortCol =I645; }if(isset($this->cms->VarsGet[$IIlLLI1])) {$sortDim =$this->cms->VarsGet[$IIlLLI1]; }elseif(!empty($IIlLl1I[$this->bodyType][$IIlLLI1])) {$sortDim =$IIlLl1I[$this->bodyType][$IIlLLI1]; }else {$sortDim =I645; }if(!$this->filter->issetField($IIlLLIL)) {$this->filter->AddField($IIlLLIL, I735, $sortCol); $this->filter->AddField($IIlLLI1, I735, $sortDim); }}}}function TTTlIlI($IIlLlL1) {$this->IIllI11 =false; if(isset($this->options[I653][$IIlLlL1]) && sizeof($this->options[I653][$IIlLlL1]) >0) {$this->IIllI11 =true; $searchFields =$this->module->GetOption("search_fields_setup"); $IIlLLlI =array_keys($searchFields); if(!empty($this->options[I664])) {for($i=0; $i<sizeof($IIlLLlI); $i++) {$IIlLLlI[$i] =$this->options[I664].$IIlLLlI[$i]; $this->options[I664]; }}$aFields =$this->options[I653][$IIlLlL1]; foreach($aFields as $fieldName) {$fieldValue =I645; if(isset($this->cms->VarsGet[$fieldName])) {$fieldValue =$this->cms->VarsGet[$fieldName]; }$this->filter->AddField($fieldName, "search", $fieldValue, I645, I645, $IIlLLlI); if($this->IIlllI1) {$this->filter->UpdateField(I734, "search"); }}}}function TTTlIll() {if($this->IIlllIL) {$IIlLLII =$this->filter->GetFieldsAsArray(); $IIlLLll =Array(); foreach($IIlLLII as $fieldName=>$fieldValue) {if(in_array($fieldName, $this->IIlllIl)) {$IIlLLll[$fieldName] =$fieldValue; }}$storage =isset($this->cms->VarsCookie[$this->IIlllII]) ?unserialize(rawurldecode(unhtmlentities($this->cms->VarsCookie[$this->IIlllII]))) :array(); $storage[$this->cms->ActiveScriptNavLink][$this->bodyType] =$IIlLLll; $IIlLLlL =rawurlencode(serialize($storage)); SetLocalCookie($this->IIlllII, $IIlLLlL, 0); }}function TTTlIl1() {$res =I645; if(is_object($this->filter)) {$res =$this->filter->GetFilterSql(); }return $res; }function _ApplyFilters($prefix =I643, $bodyType =I643, $IIlLLl1 =true) {$res =I645; if(empty($prefix)) {$prefix =$this->options[I664]; }else {$prefix .= "."; }if($this->options["lang_data"]) {$res .= I737.$prefix."lang='".$this->langData."' "; }if($this->side == "front"){ $IIlLLLI =') '; $table =$this->module->GetTableName(); if( I738 == $prefix && $this->db->attr('multi_user') && $this->cms->Core->HasRecordRights($table) ){$filter =$this->db->_sqlProc->_getRightsFilter( $this->cms->Core, 'update', $table, trim($prefix, '.') );if(I643 != $filter){ $filter =preg_replace('/\s+and\s?$/i', I643, str_replace(array(I739, ')'), I643, $filter)); $IIlLLLI ='OR ' .$filter .') '; }unset($filter); }if($this->options["check_public"]) {$res .= I740 .$prefix ."public = 1 " .$IIlLLLI; }if($this->options['use_special_list_view']){ if(empty($bodyType)){ $bodyType =$this->bodyType; }if( !in_array($bodyType, array('body_itemD', 'body_urgent_items', I741, I643)) || ('body_itemD' == $bodyType && 'c.' == $prefix) ){$res.= I740 .($IIlLLl1 ?$prefix .$this->IIll1lL[I641] ."=0 " :"(" .$prefix .$this->IIll1lL[I641] .I742 .$prefix .$this->IIll1lL['sticky'] ."=1)" ).$IIlLLLI; }if($IIlLLl1 && in_array($bodyType, array('body_urgent_items', I741))){ $res .= I740 .$prefix .$this->IIll1lL['sticky'] .I743 .$IIlLLLI; }}if($this->options['use_id_page']){ $IIlLLLl =$this->options['spec_id_pages']; if(in_array(-1, $IIlLLLl)){ $IIlLLLl =array(); }$pagesCount =sizeof($IIlLLLl); if($this->isSmallMode) {if($pagesCount){ $res .= I740 .$prefix ."id_page IN (" .implode(",", $IIlLLLl) .I744; }}else{ if($bodyType == 'body_filtered' && isset($this->cms->Vars['force_id_page'])){ $aForceIdPage =(array)$this->cms->Vars["force_id_page"]; if(sizeof($aForceIdPage) && !in_array(-1, $aForceIdPage) && !(sizeof($aForceIdPage) == 1 && empty($aForceIdPage[0]))) {$res .= I740 .$prefix ."id_page IN (" .implode(I745, $aForceIdPage) .I744; }}else{ if(!$this->module->IssetOption('mod_id_pages')){ $res .= I740 .$prefix ."id_page IN (" .$this->cms->GetPageId() .",0))"; }else{ if($pagesCount){ if(($index =array_search(-2, $IIlLLLl)) !== false){ $IIlLLLl[$index] =$this->cms->GetPageId(); $IIlLLLl =array_unique($IIlLLLl); $pagesCount =sizeof($IIlLLLl); }$res .= I740 .$prefix ."id_page " .($pagesCount == 1 ?I746 .$IIlLLLl[0] :"IN (" .implode(',', $IIlLLLl) .")") .") "; }}}}}if( $this->options[I747] && (isset($this->_forceHideFutureItems) || !in_array($bodyType, array (I736, I741))) ){$res .= ' AND (' .$this->options['future_items_date_field'] .' <= NOW() ' .$IIlLLLI; }}if($this->options["multi_sites"]) {$tmpRes =$prefix.I748.$this->siteId."'"; if($this->siteId == 0 ){if($this->options["use_id_page"]) {$res .= I740.$tmpRes." OR (".$prefix."id_site>0 AND ".$prefix.I749; }}else {$res .= I737.$tmpRes; }}if($this->options[I648]) {$res .= I737.$prefix.I750.$this->moduleName."' "; }$IIlLIIL =Array(I734=>"apply_filters", I692=>Array("filter" => &$res, "prefix" => $prefix)); $this->TTT1lI1($IIlLIIL); $aEvent =array( I751 => $this->moduleName, 'sql_part' => &$res, 'sql_prefix' => $prefix, 'sqlPart' => &$res, 'sqlPrefix' => $prefix, I752 => $bodyType, 'oEngine' => $this );AMI_Event::fire('deprecated_v5_on_apply_filters', $aEvent, $this->moduleName); AMI_Event::fire('v5_on_apply_filters', $aEvent, AMI_Event::MOD_ANY); return $res; }function &TTTlI1T(&$aCustom) {if($this->module->issetAndTrueProperty('disable_in_demo') && $this->cms->Core->TTlllTI()) {$this->cms->AddStatusMsg(I753,I754,I643,I643,array(),true); return array(); }$aData =Array(); if($this->action != "edit") {$aData["fdate"] =date($this->cms->DFMT["php"]); $aData["add"] =I645; $aData[I707] =I755; $aData["save"] =I645; $aData["cancel"] =I755; $aData[I734] ="add"; $aData["public"] =I756; }else {$aData["add"] =I755; $aData[I707] =I645; $aData["save"] =I645; $aData[I734] =I707; $aData[I707] =I645; $aData["cancel"] =I645; }if(!isset($aCustom['list_data']) || !is_array($aCustom[I757])){ $aCustom[I757] =array(); }if(in_array('list', $this->options['admin_views'])){ $aCustom[I757] += $this->cms->TTITI1T($this->moduleName .'_list'); }foreach($this->options["admin_init_order"] as $type) {switch($type) {case I758: if(is_object($this->filter)) {$this->TTTlIII(); if($this->IIllllI && sizeof($this->aGroupIds) >0) {$this->filter->AddField("flt_grp_selected", "checkbox", empty($this->cms->Vars["flt_grp_selected"]) ?null :$this->cms->Vars["flt_grp_selected"], I759, I746, "( ".$this->options[I664]."id IN(".implode(I745, $this->aGroupIds)."))"); $this->filter->MoveField("flt_grp_selected",_MOVE_START); if(empty($this->cms->Vars[I760])) {$this->filter->DisableFieldSql(I760); }}if ($this->options['use_special_list_view']) {$this->filter->AddField('flt_urgent', I724, empty($this->cms->Vars['flt_urgent']) ?null :$this->cms->Vars['flt_urgent'], I761, ' = ', $this->options['default_prefix'] .'urgent'); if (empty($this->cms->Vars['flt_urgent'])) {$this->filter->DisableFieldSQL(I762); }}}break; case I657: $this->TTTlI1I($aData); break; }}if(is_array($this->itemData)) {$aData =array_merge($aData, $this->itemData); }if(!isset($aCustom[I712]) || !is_array($aCustom[I712])) {$aCustom[I712] =array(); }$this->TTTlI11($aData, $aCustom); if(!isset($aData["list_table"])){ $aData["list_table"] =I645; }$aData["list_table"] .= $this->cms->Gui->getAbs("spacer",I645); if(!empty($aData[I763])) {$IIlLLLL =array( "header"=>$aData["form_header"], "content"=>$aData[I763], "form_align"=>I764, 'width' => isset($aData['form_width']) ?$aData['form_width'] :I643 );if(!empty($aData['do_not_show_form'])){ $IIlLLLL[I765] ="none"; }$aData[I657] =$this->cms->Gui->get($this->moduleName."_form", $IIlLLLL); }if(is_object($this->filter)) {$aMessages =$this->filter->GetStatusMessages(); if(count($aMessages)>0){ $this->cms->InitMessages($this->cms->Gui->ParseLangFile("templates/lang/_filter_msgs.lng")); foreach($aMessages as $vItem => $vData){ $this->cms->AddStatusMsg($vData["type"]); }}$this->filter->ScriptName =$this->cms->ActiveScript; if(!$this->module->issetAndTrueProperty(I766)){ $aData[I758] =$this->filter->getFilterHtml(); }$this->filter->TITIlll(); $GLOBALS["IIlLLL1"] =true; }unset($aData[I763]); if(isset($aData["status"])) {unset($aData["status"]); }return $aData; }function TTTlI1I(&$vData) {$vData["is_keywords_manual"] =0; $IIlLIIL =Array(I734=>I767, I717=>&$vData); $this->TTT1lI1($IIlLIIL); if($this->TTT11ll()){ $IIlLL1I =$this->cms->Core->GetModOption(I768, "proc_statistics_by"); if(is_array($IIlLL1I) && in_array(I669, $IIlLL1I)){ $this->TTT1111($this->moduleName, $this->module->GetTableName()); }if($this->module->IssetOption("show_adv_stat_columns") && $this->module->GetOption("show_adv_stat_columns")){ $this->cms->Gui->addGlobalVars(array("SHOW_ADV_STAT_COLUMNS" => I679)); }if($this->module->IssetOption("show_adv_place_columns") && $this->module->GetOption("show_adv_place_columns")){ $this->cms->Gui->addGlobalVars(array("SHOW_ADV_PLACE_COLUMNS" => I679)); }}if ($this->options['use_special_list_view']) {$vData['urgent_date_disabled'] =empty($this->itemData[I769]) ?' disabled' :I643; }}function TTTlI1l() {return ($this->browser->TI1TTIl() == "position"); }function TTTlI11(&$vData, &$aCustom) {if($this->IIllLLl) {if($this->action == "grp_move_position") {$this->TTT1T1T($this->aGroupIds, $cModule); }else {$this->TTTlITI($this->action, $this->id); }}$vData["adv_place_fields"] =I645; if($this->TTT11ll()){ $IIllLI1 =$this->TTT111T($vData[I770]); if(!empty($IIllLI1)) $vData["adv_place_fields"] =$this->cms->Gui->getAbs($this->moduleName."_subform:use_adv_place", array("adv_places" => $IIllLI1)); $IIlLL1l =$this->TTT111I($vData["adv_campaign_type"]); if(!empty($IIlLL1l)) $vData["adv_campaign_types_fields"] =$this->cms->Gui->getAbs($this->moduleName."_subform:use_adv_campaign_type", array("adv_campaign_types" => $IIlLL1l)); }if($this->options["use_positions"]) {$this->browser->TI1TITl($this->options[I664]."position"); }$IIlLIIL =array(I771=>'admin_list_sql', 'data'=> &$vData, 'custom'=> &$aCustom); $this->TTT1lI1($IIlLIIL); $db =&$this->TTTlTIT(); if($this->appliedId>0){ $this->browser->ArrangePosSQL($db, $this->appliedId, isset($aCustom['applied_id']) ?$aCustom[I772] :I670); }$IIlLIIL =Array(I734=>"fill_admin_data", I717=>&$vData, I692=>&$aCustom); $this->TTT1lI1($IIlLIIL); if($this->options["use_id_page"]) {$aCustom[I714]["_id_page_header"] =$this->cms->Gui->getAbs($this->moduleName."_list:_id_page_header", I645); $aCustom[I773]["_id_page_row_col"] =Array(I734=>"callback", "object"=>&$this, "method"=>I774); $this->browser->TI1TITl($this->options["id_page_prefix"].I677); }if(isset($this->words[$this->moduleName .'_add'])){ $aCustom[I757]['button_add'] =$this->cms->Gui->getAbs($this->moduleName .'_list:button_add', array(I725 => $this->words[$this->moduleName .I775])); }if($this->options["use_positions"]) {$aCustom[I714]["_positions_data"] =$this->cms->Gui->getAbs($this->moduleName."_list:_positions_script", I645); if($this->TTTlI1l()) {$this->IIllLLI =false; $this->cms->Gui->addGlobalVars(Array("POSITIONS_COL_ENABLED"=>I679)); $set =I645; }else {$this->cms->Gui->addGlobalVars(Array("POSITIONS_COL_ENABLED"=>I759)); $set ="_disabled"; }$aCustom[I714]["_positions_data"] .= $this->cms->Gui->getAbs($this->moduleName."_list:_positions_map".$set, I645); $aCustom[I714]["_positions_header"] =$this->cms->Gui->get($this->moduleName."_list:_positions_header", $aCustom[I714]); $aCustom[I773]["_positions_col"] =Array(I734=>"callback", "object"=>&$this, "method"=>I776); }if($this->TTT11ll()){ $this->browser->TI1TITl($this->options[I664]."shown_items, ".$this->options[I664]."shown_details, IF(".$this->options[I664]."shown_items=0,0,".$this->options[I664]."shown_details/".$this->options[I664]."shown_items) as shown_ctr,   ".$this->options[I664].I770); $aCustom[I773]["shown_ctr"] =Array(I771=>'callback', 'object'=>&$this, 'method'=>I777); $aCustom[I773][I770] =Array(I771=>'callback', 'object'=>&$this, 'method'=>'_advFormatPlaceCB'); }if($this->IIllllI) {$aCustom[I714]["_group_operations_reset"] =$this->cms->Gui->getAbs($this->moduleName."_list:group_operations_reset", I645); $aCustom[I714]["_group_operations_header"] =$this->cms->Gui->getAbs($this->moduleName."_list:group_operations_header", I645); $aCustom[I714]["_group_actions"] =I645; foreach($this->options[I644] as $operation) {$aCustom[I714][I778] .= $this->cms->Gui->getAbs($this->moduleName."_list:icons_grp_".$operation, I645); }$aCustom[I714]["_group_num_checked"] =sizeof($this->aGroupIds); $aCustom[I714]["_group_operations_footer"] =$this->cms->Gui->getAbs($this->moduleName."_list:group_operations_footer", $aCustom[I714]); $aCustom[I714]["_group_operations_script"] =$this->cms->Gui->getAbs($this->moduleName."_list:group_operations_script", I645); $aCustom[I773]["_group_operations_col"] =Array(I734=>"callback", "object"=>&$this, I779=>'_GroupOperationCB'); }if($this->options["support_rights"]) {foreach($aCustom[I773] as $fieldName => $aRule) {if($aRule[I734] == 'flagicon' && !(isset($aRule['rights']) && is_array($aRule[I780]))) {$aCustom[I773][$fieldName]["rights"] =$this->TTT11T1($fieldName); }}}if(in_array('list', $this->options['admin_views'])){ if(AMI_Registry::get('injected60', FALSE)){ $vData += $aCustom[I757]; }else{ $aEvent =array( I781 => $this->moduleName, 'oEngine' => $this, 'oBrowser' => $this->browser );AMI_Event::fire('deprecated_v5_on_list_view', $aEvent, AMI_Event::MOD_ANY); AMI_Event::fire('v5_on_admin_list_view', $aEvent, AMI_Event::MOD_ANY); $this->browser->ProcessSQL($db); if(!isset($aCustom[I782]) || !is_array($aCustom[I782])){ $aCustom["legend"] =Array(); }$this->TTT11Tl($aCustom["legend"]); $vData += $this->browser->GetList($db, $aCustom[I773], $this->moduleName."_list", ":list_body", I783, ":empty", $this->IIllIlI, $this->appliedId, $aCustom["legend"], $aCustom[I714]); }}if($this->action == "edit") {$vData["cancel"] =$this->cms->Gui->getAbs($this->moduleName.I784, I645); $vData["form_header"] =$this->words[$this->moduleName."_apply"]; }elseif($this->action=='view') {$vData["form_header"] =$this->words[$this->moduleName.I785]; }else {$vData["form_header"] =isset($this->words[$this->moduleName."_add"]) ?$this->words[$this->moduleName."_add"] :I643; }if(is_object($this->filter)) {$this->filter->UpdateField("offset", $this->browser->Position); $vData["filter_hidden_fields"] =$this->filter->GetFieldsAsHidden(); }$this->TTT11lT($vData); if(isset($this->itemData['details_noindex'])){ $vData["details_noindex"] =$this->itemData['details_noindex'] == 1 ?' checked' :I643; }if(isset($this->itemData[I786]) && is_array($IIlLL1L =unserialize($this->itemData[I786]))) {$vData["html_title_inherit"] =empty($IIlLL1L['title_inherit']) ?I643 :'checked'; $vData["html_title"] =$IIlLL1L[I787]; $vData["html_keywords"] =htmlspecialchars($IIlLL1L["keywords"]); $vData["html_description"] =htmlspecialchars($IIlLL1L["description"]); $vData[I788] =intval($IIlLL1L["is_kw_manual"]); }$vData['original_sublink'] =$vData['sublink'] =isset($this->itemData['sublink']) ?$this->itemData[I789] :null; if($this->options['use_special_list_view']) {if (empty($this->itemData[I769])) {$vData[I769] =I643; $vData['public_direct_link'] =empty($this->itemData['public_direct_link']) ?I643 :'checked'; $vData['public_direct_link_disabled'] =I643; }else {$vData[I769] =' checked'; $vData['public_direct_link'] ='checked'; $vData['public_direct_link_disabled'] =I790; if ($this->action == 'edit') {$vData[I642] =is_null($this->itemData[I642]) ?I643 :date($this->cms->DFMT['php'], DateTools::TT1lIl1($this->itemData[I642])); }}}if($this->options[I656]) {$vData["id_external"] =isset($vData["id_external"]) ?htmlspecialchars($vData[I791]) :I643; }if(!empty($this->options[I661])) {$vData['check_url'] =$this->cms->Gui->getAbs('options_form:check_url'); }$vData["options_form"] =$this->cms->Gui->get("options_form", $vData); $this->TTTllTT($vData); if(isset($aCustom[I792]["buttons"]) && is_array($aCustom[I792]["buttons"])) {$aData["form_buttons"] =I645; foreach($aCustom[I792]["buttons"] as $btnName) {if(isset($vData[$btnName]) && $vData[$btnName] == I755) {$setPostfix =I793; }else {$setPostfix =I645; }$setName ="form_".$btnName."_btn"; $vData[$setName] =$this->cms->Gui->get($this->moduleName."_subform:".$setName.$setPostfix, $vData); }$vData["form_buttons"] =$this->cms->Gui->get($this->moduleName."_subform:form_buttons_position", $vData); }$vData["form_common_hidden_fields"] =$this->cms->Gui->get($this->moduleName."_subform:form_common_hidden_fields", $vData); $vData[I763] =$this->cms->Gui->get($this->moduleName.I682, $vData); unset($aCustom); }function TTTllTT(&$vData) {$IIlLIIL =Array(I734=>"final_admin_data", I717=>&$vData); $this->TTT1lI1($IIlLIIL); }function TTTllTI(&$aCustom) {if(sizeof($this->IIllIL1) == 0) {$this->SetBodyType("body_empty"); }else {if($this->bodyType == I794 && $this->options[I688]) {$this->SetBodyType("body_browse", true); }if(!empty($this->cms->Vars["body_filtered"]) && isset($this->options[I733]["body_filtered"]) && ($this->bodyType == "body_items" || $this->bodyType == I795)) {unset($this->IIllIL1[$this->bodyType], $this->IIllIL1["body_urgent_cats"], $this->IIllIL1["body_urgent_items"]); $this->bodyType =I645; $this->SetBodyType("body_filtered", true); }}}function SetBodyType($IIlLL11, $IIlL1II =false) {if(empty($this->bodyType)) {$this->bodyType =$IIlLL11; }if($IIlL1II) {$this->IIllIL1 =Array($IIlLL11 => true) +$this->IIllIL1; }else {$this->IIllIL1[$IIlLL11] =true; }}function &TTTllTl(&$aCustom) {$aData =Array(); $this->TTTlllT($aData); $aDefault =Array( "sort_set"=>I796 );$aCustom += $aDefault; if($this->IIlllL1) {$IIlL1Il =$aCustom; $IIlL1IL =$aData; $this->SetBodyType("body_items"); $this->TTTllIl($IIlL1IL, $IIlL1Il); $this->IIllIL1 =Array(); $this->bodyType =I645; unset($IIlL1IL); unset($IIlL1Il); }$this->TTTllTI($aCustom); $this->TTTllIl($aData, $aCustom); $IIlL1I1 =I645; if($this->IIllI11) {$IIlL1I1 =$this->filter->TITI11l(); }$IIlL1lI =I645; if($this->IIllI1l || $this->IIllI1I || $this->IIllI11) {$IIlL1lI =$this->filter->GetFilterHtml(true, $this->IIllI1I); if($this->bodyType == "body_filtered") {foreach($this->options[I733]["body_filtered"] as $fieldName) {$aData["flt_".$fieldName] =$this->filter->GetFieldValue($fieldName); }}}$aData[I758] =$IIlL1lI; $aData[I797] =$IIlL1I1; $aData["body"] =$this->cms->Gui->get($this->moduleName."_list:".$this->bodyType, $aData); $aData["body"] =$this->cms->Gui->get($this->moduleName."_list", $aData); if($this->IIllL1L){ $this->processSEO($aCustom); }if($this->cms->Core->TTlI1T1(I798, 'use_canonical')) {$this->processCanonical($aCustom); }return $aData; }public final function TTTllT1(){ if(!$this->IIllL11){ $this->IIllL1l =false; }}public final function TTTllIT(){ $this->IIllL11 =true; $this->IIllL1l =true; }public final function TTTllII($bodyType){ $this->IIll1II =$bodyType; }function TTTllIl(&$aData, &$aCustom) {if(is_array($this->itemData)) {$aData =array_merge($aData, $this->itemData); }$this->TTTlII1($this->bodyType); $this->TTTlIlT(); $this->TTTlIlI($this->bodyType); if(!$this->IIlllL1) {$this->TTTlIll(); if($this->IIllI1I) {$aMessages =$this->filter->GetStatusMessages(); if(count($aMessages)>0){ $this->cms->InitMessages($this->cms->Gui->ParseLangFile("templates/lang/_filter_msgs.lng")); foreach($aMessages as $vItem => $vData){ $this->cms->AddStatusMsg($vData["type"]); }}$this->filter->ScriptName =$this->cms->ActiveScript; $this->filter->TITIlll(); }}$this->IIllLLL =0; $this->_urgentItemsQty =0; if($this->options['_use_id_page_orig'] && $this->module->IssetOption(I799)) {$this->options['spec_id_pages'] =$this->module->GetAOption(I799); }if(empty($this->options['use_special_list_view'])){ foreach(array('body_urgent_items', I741) as $IIlL1ll){ unset($this->IIllIL1[$IIlL1ll]); }}$this->TTTll1T($aData, $aCustom); if($this->IIlllL1) {$this->IIlllL1 =false; }}function TTTllI1() {$this->offset =(int)$this->offset; $itemOffsetUrl =I645; $catOffsetUrl =I645; $IIlL1lL =$this->options["item_offset"]; $catOffset =$this->options[I800]; $this->IIllllL =Array(); if($this->offset >0) {$this->cms->Gui->AddGlobalVars(Array($IIlL1lL=>$this->offset)); $itemOffsetUrl ="&".$IIlL1lL.I720.$this->offset; }if($this->catOffset >0) {$this->cms->Gui->AddGlobalVars(Array($catOffset=>$this->catOffset)); $catOffsetUrl ="&".$catOffset.I720.$this->catOffset; }$this->IIllllL["front_cats_link"] =$catOffsetUrl; $this->IIllllL["front_items_link"] =$catOffsetUrl.$itemOffsetUrl; }function TTTlllT(&$vData) {$this->TTT1IIl(); $this->TTTllI1(); $vData += $this->IIllllL; $this->TTTlllI(); $IIlLIIL =Array(I734=>I801, I717=>&$vData); $this->TTT1lI1($IIlLIIL); }function TTTlllI($IIlL1l1 =I645, $IIlL1LI =false) {require_once $GLOBALS['CLASSES_PATH'] .'Filter.php'; if(!is_object($this->filter) || $IIlL1LI) {$this->filter =new Filter($this->cms, $this->options["filter_box_template".$IIlL1l1], $this->options["filter_form_template".$IIlL1l1]); $this->filter->IL11l1L =array(); $this->filter->SetDateFormat($this->cms->DFMT); $this->filter->SetCaptions($this->cms->Gui->ParseLangFile($this->options[I802])); $this->filter->SetMessages($this->cms->Gui->ParseLangFile($this->options["filter_msgs_file"])); }else {$this->filter->ReInitTemplates($this->options["filter_box_template".$IIlL1l1], $this->options["filter_form_template".$IIlL1l1]); }}function TTTllll(&$vData, &$IIlL1Ll) {$this->offset =(int)$this->offset; $IIlL1LL =false; $IIlL1L1 =$IIlL1Ll["page_item_type"]; if (in_array($IIlL1L1, array (I736, I741))) {$aDefault =Array(I803=>$this->moduleName); $IIlL1Ll += $aDefault; $moduleName =$IIlL1Ll[I803]; $offset =$this->catOffset; $IIlLLIL =$this->options[I804]; $IIlLLI1 =$this->options["catsortdim_varname"]; }else {$moduleName =$this->moduleName; $offset =$this->offset; $IIlLLIL =$this->options[I651]; $IIlLLI1 =$this->options["sortdim_varname"]; if($this->catId >0) {$this->filter->AddField($this->options["catid_varname"], I735, $this->catId); }}$this->module->setProperty('sort_fields', array()); $this->IIllI1L =false; $IIlL11I =I645; $IIlL11l =I645; if(isset($this->options[I805][$IIlL1L1]) && sizeof($this->options[I805][$IIlL1L1]) >0) {$this->module->setProperty('sort_fields', $this->options['sort_pages_setup'][$IIlL1L1]); $this->IIllI1L =true; $this->IIllI1l =true; if($this->filter->issetField($IIlLLIL)) {$IIlL11I =$this->filter->GetFieldValue($IIlLLIL); }}if($IIlL11I != I645) {$IIlL11l =$this->filter->GetFieldValue($IIlLLI1); }else {$IIlL11I =$this->cms->Core->GetModOption($moduleName, "front_page_sort_col"); $IIlL11l =$this->cms->Core->GetModOption($moduleName, "front_page_sort_dim"); }if(!empty($moduleName)) {$this->TTTlll1($moduleName); }$browseActiveItemPosition =0; if($IIlL1L1 == I806) {$IIlL11L ="tape"; $browseActiveItemPosition =$this->cms->Core->GetModOption($moduleName, "browse_active_item_position"); }else {$IIlL11L ="page"; }if($this->cms->Core->IssetModOption($moduleName, $IIlL1L1."_page_size")) {$pageSize =$this->cms->Core->GetModOption($moduleName, $IIlL1L1.I807); }else {$pageSize =$this->cms->Core->GetModOption($moduleName, "page_size"); }$aEvent =array( I752 => $IIlL1L1, I781 => $this->moduleName, 'pageSize' => &$pageSize, );AMI_Event::fire('v5_on_set_page_size', $aEvent, AMI_Event::MOD_ANY); $this->TTTlIIT($offset, $IIlL11I, $IIlL11l, $pageSize, $IIlL1LL, $IIlL11L, $browseActiveItemPosition); if($this->IIllI1L) {$IIlL111 =$this->cms->TTITI1I($this->moduleName."_list", $this->words, I808, $IIlLLIL, $IIlLLI1); $IIl1III =$this->cms->Gui->get($this->moduleName."_list:".$IIlL1L1."_".$IIlL1Ll["sort_set"], $IIlL111); $IIl1IIl =I645; if($this->bodyType != $IIlL1L1) {$IIl1IIl =$IIlL1L1."_"; }$vData[$IIl1IIl.I796] =$IIl1III; $vData += $IIlL111; if(!isset($IIlL1Ll[I757]) || !is_array($IIlL1Ll[I757])) {$IIlL1Ll[I757] =$IIlL111; }else {$IIlL1Ll[I757] += $IIlL111; }}}function TTTlll1($moduleName) {if($this->IIllII1 != $moduleName){ $this->IIllII1 =$moduleName; $IIlLIIL =Array(I734=>I809, I680=>$moduleName); $this->TTT1lI1($IIlLIIL); }}function _InitByModuleNameCB(&$aItem, &$aData, &$aParams) {$this->TTTlll1($aParams[I810]); }function TTTll1T(&$vData, &$aCustom) {$this->offset =(int)$this->offset; $IIl1IIL =array(); $this->cms->Gui->AddGlobalVars(Array(I811=>$this->bodyType)); if(empty($aCustom["page_item_type"])) {$aCustom["page_item_type"] =$this->bodyType; }$IIl1II1 =$aCustom["page_item_type"]; if(empty($aCustom["active_item_type"])) {$aCustom[I812] =$IIl1II1; }if(!$this->IIlllL1) {if($IIl1II1 == "body_filtered") {$this->TTTlTIl(); if(!$this->options["use_id_page"] || ($this->options["use_id_page"] && $this->IIlllLI == 1)) {if(!isset($aCustom[I714]["front_link"])) {$aCustom[I714][I813] =$this->module->GetFrontLink(); }}else {$IIl1IlI =Array(I813 => Array(I734=>"callback", "object"=>&$this, I779=>"_GetFrontLinkCB")); $aCustom[I773] =$IIl1IlI +$aCustom[I773]; $this->browser->TI1TITl($this->options["id_page_prefix"].I677); }}elseif($this->module->IssetOption(I799) && $this->options[I814]){ $aCustom[I712] =array('front_link' => array(I771 => 'callback', 'object' => $this, 'method' => I815)) +(isset($aCustom[I712]) ?$aCustom[I712] :array()); $this->browser->TI1TITl($this->options['id_page_prefix'] .'id_page'); }$this->TTT1lTI($aCustom); $this->IIllILI =$this->TTT1I1l(); if($this->IIllILI) {$aCustom[I773]["nsplitter"] =Array(I734=>"callback", I816=>&$this, I779=>"_GetNSplitterCB"); }$aCustom[I773]["splitter"] =I645; if(empty($aCustom["splitter_off"])) {$aCustom[I773]["splitter"] =Array(I734=>I817, I816=>&$this, I779=>"_GetSplitterCB"); }}$this->cms->Gui->addHtmlScript("var _cms_body_type = '".$this->bodyType."';"); $this->TTT1l1l($aCustom[I812]); if($this->IIlllL1 && $IIl1II1 == "body_items") {$this->browser->SetForceRules(I645, I818.($this->offset).", 1"); $this->browser->ProcessSQL($this->db, I645, $this->id); if($this->db->next_record()) {$this->id =$this->db->Record[I680]; }else {$this->id =-1; }}else {$itemOffsetUrl =I645; $catOffsetUrl =I645; $IIlL1lL =$this->options["item_offset"]; $catOffset =$this->options[I800]; $IIl1Ill =I645; $IIl1IlL =I645; $IIl1Il1 =Array(); if($this->offset >0) {$this->cms->Gui->AddGlobalVars(Array($IIlL1lL=>$this->offset)); $itemOffsetUrl =$IIlL1lL.I720.$this->offset."&"; $IIl1Il1[$IIlL1lL] =$this->offset; }if($this->catOffset >0) {$this->cms->Gui->AddGlobalVars(Array($catOffset=>$this->catOffset)); $catOffsetUrl =$catOffset.I720.$this->catOffset."&"; $IIl1Il1[$catOffset] =$this->catOffset; }if($this->catId >0 && empty($aCustom[I819]['hide_cat_id'])) {$IIl1IlL =$this->options["catid_varname"].I720.$this->catId."&"; $IIl1Il1[$this->options["catid_varname"]] =$this->catId; }$filterVars =$this->filter->GetFieldsAsUrlParams(); if($this->id >0) {$IIl1Ill =I820.$this->id."&"; }$aCustom["url_params"] =$IIl1Il1; $aCustom["cat_id_url"] =&$IIl1IlL; $IIlLIIL =Array(I734=>"fill_front_data", I717=>&$vData, I692=>&$aCustom); $this->TTT1lI1($IIlLIIL); $aCustom[I714][I821] =$IIl1II1; $aCustom[I714][I812] =$aCustom[I812]; $this->TTT11ll(); unset($vData['pager']); switch($IIl1II1) {case I795: case I741: if (!empty($IIlL1Ll['reset_pager_for_urgent_cats'])) {$this->browser->lll1IIl =0; $this->browser->Position =0; $this->browser->PageSize =0; }$aDefault =$IIl1II1 == I736 ?array ("list_set"=>"cat_list", I822=>"cat_list_empty", "list_set_not_found"=>"cat_list_not_found", "row_set"=>I823, "list_table"=>"cat_rows", I803=>$this->moduleName, "pager_navdata"=>"?" ):array (I824=>"urgent_cat_list", I822=>"urgent_item_list_empty", "list_set_not_found"=>"urgent_item_list_empty", I825=>"urgent_cat_row", "list_table"=>"urgent_cat_rows", I803=>$this->moduleName, "pager_navdata"=>I826 );$IIlL1Ll =$aCustom +$aDefault +array(I782 => null); $prefix =$IIl1II1 == I736 ?'cat_' :'urgent_cat_'; $IIl1ILI =Array( "offset_link"=> $this->cms->ActiveScript.$IIlL1Ll["pager_navdata"].$filterVars.I827.$IIl1IlL.$IIl1Ill.$itemOffsetUrl.$catOffset."=[START]", "simple_prefix"=>$prefix, "splitter_prefix"=>$prefix, "stub_prefix"=>$prefix );$IIlL1Ll[I714] += $IIl1ILI; $IIlL1Ll[I712][I828] =Array(I771=>'callback', 'object'=>&$this, 'method'=>'_getCatAdvPlaceCB'); $this->browser->ProcessSQL($this->db); if ($IIl1II1 == I741) {$this->IIllLLL =$this->browser->MaxCount; }elseif(!empty($aCustom['replace_empty_set_by_row_set']) && $this->IIllLLL >0) {$this->browser->III1I1L =true; }$IIl1ILl =$this->options["name_field_name"]; $this->options["name_field_name"] =$this->options["cat_name_field_name"]; if($this->action == I690) {$IIl1ILL =$IIlL1Ll["list_set_not_found"]; }else {$IIl1ILL =$IIlL1Ll[I822]; }$this->TTT11Il($vData, $IIlL1Ll); $vData += $this->browser->GetList($this->db, $IIlL1Ll[I773], $this->moduleName.I829, ":".$IIlL1Ll[I824], ":".$IIlL1Ll[I825], ":".$IIl1ILL, $this->id, $this->appliedId, $IIlL1Ll["legend"], $IIlL1Ll[I714], $this->options[I649]); $this->options[I830] =$IIl1ILl; $this->TTT11I1($vData, $IIlL1Ll); $vData[$IIlL1Ll[I824]] =$vData["list_table"]; unset($vData["list_table"]); break; case I806: $tmp =array(); $this->browser->SetApplied($this->db, $tmp, $this->langData); $this->browser->lll1IlI =true; if($this->options["use_positions"]) {$this->browser->TI1TITl($this->options[I664]."position"); }case I831: case "body_items": case "body_urgent_items": case "body_filtered": if($aCustom[I821] == I831) {$aDefault =Array( I824=>"search_item_list", I822=>"search_item_list_empty", "list_set_not_found"=>"search_item_list_not_found", I825=>"search_item_row", "list_table"=>I832, "pager_navdata"=>I826 );}elseif($aCustom[I821] == "body_items" || $aCustom[I821] == "body_filtered") {$aDefault =Array( I824=>"item_list", I822=>I833, "list_set_not_found"=>"item_list_not_found", I825=>"item_row", "list_table"=>I834, "pager_navdata"=>I826 );}elseif($aCustom[I821] == "body_urgent_items") {$aDefault =Array( I824=>"urgent_item_list", I822=>"urgent_item_list_empty", I835=>"urgent_item_list_empty", I825=>"urgent_item_row", "list_table"=>"urgent_item_rows", I836=>I826 );}elseif($aCustom[I821] == I806) {$aDefault =Array( I824=>"browse_item_list", I822=>"browse_item_list_empty", I825=>"browse_item_row", I836=>"?mode=browse" );}$IIlL1Ll =$aCustom +$aDefault +array(I782 => null); if($aCustom[I821] == I831) {$IIl1ILI =Array( I837=>"javascript:go_pageSubmit('[START]', 'offset', 'search');", "simple_prefix"=>"search_item_", "splitter_prefix"=>I838, "stub_prefix"=>I838 );}elseif($aCustom[I821] == "body_items" || $aCustom[I821] == "body_filtered") {$IIl1ILI =Array( I837=>$this->cms->ActiveScript.$IIlL1Ll[I836].$filterVars.I827.$IIl1IlL.$catOffsetUrl.$IIlL1lL."=[START]", I839=>"item_", "splitter_prefix"=>"item_", "stub_prefix"=>I840, "cat_id"=>I645, "catid_sublink"=>I645 );}elseif($aCustom[I821] == "body_urgent_items") {$IIl1ILI =Array( I837=>$this->cms->ActiveScript.$IIlL1Ll[I836].$filterVars.I827.$IIl1IlL.$catOffsetUrl.$IIlL1lL."=[START]", I839=>I841, "splitter_prefix"=>I841, "stub_prefix"=>I841, "cat_id"=>I645, "catid_sublink"=>I645 );}elseif($aCustom[I821] == I806) {$IIl1ILI =Array( I837=>$this->cms->ActiveScript.$IIlL1Ll[I836].$filterVars.I827.$IIl1IlL.$catOffsetUrl.$IIlL1lL.I842, I839=>"browse_item_", "splitter_prefix"=>"browse_item_", "stub_prefix"=>I843, "cat_id"=>I645, "catid_sublink"=>I645, "previous_link_set"=>"previous_link", I844=>"next_link" );}$IIlL1Ll[I714] += $IIl1ILI; if ($this->options['use_special_list_view'] && $aCustom['page_item_type'] == 'body_urgent_items') {$aShowAt =isset($aCustom['show_urgent_elements']) ?$aCustom['show_urgent_elements'] :$this->module->GetAOption('show_urgent_elements'); if ($this->browser->getActivePage()) {if (!in_array('at_next_pages', $aShowAt)) {return; }}else {if (!in_array('at_first_page', $aShowAt)) {return; }}$this->browser->lll1IIl =0; $this->browser->Position =0; $this->browser->PageSize =0; }$IIlLIIL =array(I771 => I845, 'custom' => array('page_item_type' => $IIl1II1)); $this->TTT1lI1($IIlLIIL); $this->browser->ProcessSQL($this->db, I645, $this->id); if ($IIl1II1 == 'body_urgent_items') {$this->_urgentItemsQty =$this->browser->MaxCount; }elseif(!empty($aCustom['replace_empty_set_by_row_set']) && $this->_urgentItemsQty >0) {$this->browser->III1I1L =true; }$k =$this->action == I846 ?'list_set_not_found' :'list_set_empty'; $IIl1ILL =isset($IIlL1Ll[$k]) ?$IIlL1Ll[$k] :null; $this->TTT11Il($vData, $IIlL1Ll); $IIlL1Ll[I712]['adv_place'] =Array(I771=>'callback', I847=>&$this, 'method'=>'_getAdvPlaceCB'); if($this->IIll1I1 && !empty($this->IIll1ll['no_pager'])){ $IIlL1Ll[I757]['no_pager'] =true; }AMI_Registry::set(I848, $this->moduleName); $aRows =array(); $aList =$this->browser->GetList( $this->db, $IIlL1Ll[I773], $this->moduleName .I829, I849 .$IIlL1Ll[I824], I849 .$IIlL1Ll[I825], I849 .$IIl1ILL, $this->id, $this->appliedId, $IIlL1Ll["legend"], $IIlL1Ll[I714], $this->options[I649], $aRows );foreach($aRows as $row => $aRow){ $keys =array_keys($aRow); foreach($keys as $key){ if(is_int($key)){ unset($aRows[$row][$key]); }}}$IIl1IIL['list_rows'] =$aRows; $vData += $aList; $this->TTT11I1($vData, $IIlL1Ll); if($IIlL1Ll[I824] != "list_table") {$vData[$IIlL1Ll[I824]] =$vData["list_table"]; unset($vData[I850]); }if($aCustom[I821] == I831) {$vData += Array("num_results"=>$this->browser->MaxCount); }break; case "body_catD": break; case I794: $aDefault =Array( "item_set"=>"item_details", I837=>$this->cms->ActiveScriptNavLink.I826.$filterVars.I827.$IIl1IlL.$catOffsetUrl.$IIlL1lL.I720.$this->offset, I851=>"item_details_empty", "item"=>"item_details", I839=>"itemD_" );$IIlL1Ll =$aCustom +$aDefault; $IIl1ILI =Array( I839=>I852 );$IIlL1Ll[I714] += $IIl1ILI; if($this->db->next_record()) {if (!empty($this->options['announce_field_name']) && !empty($this->options['description_field_name']) && $this->module->IssetAndTrueOption('fill_empty_description') && !empty($this->db->Record[$this->options['announce_field_name']]) && mb_strlen(trim(strip_tags($this->db->Record[$this->options['announce_field_name']]))) && !mb_strlen(trim(strip_tags($this->db->Record[$this->options['description_field_name']], "<img><span>"))) ){$this->db->Record[$this->options['description_field_name']] =$this->db->Record[$this->options['announce_field_name']]; }unset($vData[I670]); $vData += $this->db->Record; $IIlLIIL =Array(I734=>"item_details_record", I717=>&$vData, I692=>&$IIlL1Ll); $this->TTT1lI1($IIlLIIL); if(isset($vData[I770])){ if($this->IIllLII) $this->TTT111l($vData, "adv", $vData[I680], "details"); else unset($vData[I770]); }$this->browser->ProcessFields($IIlL1Ll[I773], $vData, $IIlL1Ll[I714]); $this->TTT1lTl($aCustom[I821], $this->db->Record, $vData, $IIlL1Ll[I714]); if(isset($this->db->Record["sm_data"])) {$IIl1IL1 =unserialize($this->db->Record["sm_data"]); $GLOBALS[I853][I854] =$this->cms->TITlTl1($GLOBALS[I853][I854], $IIl1IL1); }if(isset($this->db->Record["details_noindex"]) && $this->db->Record["details_noindex"] == '1') {$this->TTTllT1(); }$vData[$IIlL1Ll["item"]] =$this->cms->Gui->get($this->moduleName.I855.$IIlL1Ll["item_set"], $vData); }else {$vData[$IIlL1Ll["item"]] =$this->cms->Gui->get($this->moduleName.I855.$IIlL1Ll[I851], $vData); $this->TTT11lI(); }break; case "body_empty": $this->TTT11lI(); break; case "body_form": break; default: trigger_error("Unknown page item type [".$aCustom[I821].I856.$this->module->GetName(), E_USER_WARNING); break; }if(in_array($aCustom[I821], array('body_items', 'body_search', 'body_filtered'))) {$IIl1I1I =$GLOBALS["ROOT_PATH_WWW"].$this->cms->ActiveScript.$IIlL1Ll[I836].$filterVars.I827.$IIl1IlL.$catOffsetUrl; if($this->browser->Position >0) {$offset =$this->browser->Position -$this->browser->PageSize; AMI_Registry::set(I857, $IIl1I1I.$IIlL1lL.I720. ($offset >0 ?$offset :0)); }if($this->browser->Position +$this->browser->PageSize <$this->browser->MaxCount) {AMI_Registry::set('page/links/next', $IIl1I1I.$IIlL1lL.I720. ($this->browser->Position +$this->browser->PageSize)); }}$IIlLIIL =Array(I734=>"final_front_data", I717=>&$vData, I692=>&$aCustom); $this->TTT1lI1($IIlLIIL); }if (isset($vData['urgent_cat_list'])) {$this->cms->Gui->addGlobalVars(array ('URGENT_CAT_LIST_' .mb_strtoupper($this->moduleName) => $vData[I858])); unset($vData[I858]); }if (isset($vData['urgent_item_list'])) {$this->cms->Gui->addGlobalVars(array ('URGENT_ITEM_LIST_' .mb_strtoupper($this->moduleName) => $vData['urgent_item_list'])); }if($this->IIll1I1 && in_array($this->IIll1I1, $this->aSupportedResponseTypes)){ if($this->IIll1lI == 'html'){ $IIl1IIL += $vData; }$this->outType($IIl1IIL, $this->IIll1I1); }}function outType($data, $type =I859){ global $conn; $oResponse =AMI::getSingleton('response'); if(!$oResponse->isStarted()){ $oResponse->start(); }switch($type){ case I859: $oResponse->setType('JSON'); unset($data['captcha_row'], $data['captcha_script']); $oResponse->write($data); break; default: return; }$oResponse->send(); die(); }function TTTll1I(&$vRes, &$aCustom, $cType, $IIlLlII) {if(empty($aCustom[I821])) {$aCustom[I821] =I860; }if(!$this->options["use_id_page"] || ($this->options["use_id_page"] && $this->IIlllLI == 1)) {if(!isset($aCustom[I714][I813])) {$aCustom[I714][I813] =$this->module->GetFrontLink(); }}else {$IIl1IlI =Array(I813 => Array(I734=>I817, I816=>&$this, I779=>"_GetSmallFrontLinkCB")); $aCustom[I773] =$IIl1IlI +$aCustom[I773]; $this->browser->TI1TITl($this->options["id_page_prefix"].I677); }$this->TTT1lTI($aCustom); if($this->options[I661]) {$_sublink =Array(I861 => Array(I734=>I817, I816=>&$this, I779=>"_GetNavDataCB")); $aCustom[I773] =$_sublink +$aCustom[I773]; }$this->IIllILI =$this->TTT1I1l(); if($this->IIllILI) {$aCustom[I773]["nsplitter"] =Array(I734=>I817, I816=>&$this, I779=>"_GetNSplitterCB"); }$aCustom[I773]["splitter"] =Array(I734=>I817, I816=>&$this, I779=>I862); $aCustom[I773]["extention_data"] =Array(I734=>I817, I816=>&$this, I779=>"_GetExtSmallDataCB"); $aCustom[I714][I821] =$aCustom[I821]; if(empty($aCustom[I812])) {$aCustom[I812] =$aCustom[I821]; }$aCustom[I714][I812] =$aCustom[I812]; $IIlLIIL =Array(I734=>"get_small_block", I717=>&$vRes, I692=>&$aCustom); $this->TTT1lI1($IIlLIIL); $aDefault =Array( I824=>"small_list", I822=>I863, I825=>"small_row", I850=>"small_rows" );$IIlL1Ll =$aCustom +$aDefault +array(I782 => null); $IIl1ILI =Array( I839=>I840, "splitter_prefix"=>I840 );$IIlL1Ll[I714] += $IIl1ILI; $this->TTT1l1l($IIlL1Ll[I812]); $this->TTTlll1($this->moduleName); $this->browser->SQLData['options'] =$this->browser->SQLData[I864] |Pager::DB_NO_CALC_FOUND_ROWS; $this->browser->ProcessSQL($this->db); $aCustom += $this->browser->GetList($this->db, $IIlL1Ll[I773], $this->moduleName.I829, I849.$IIlL1Ll[I824], I849.$IIlL1Ll[I825], I849.$IIlL1Ll[I822], $this->id, $this->appliedId, $IIlL1Ll["legend"], $IIlL1Ll[I714]); $aCustom[$IIlL1Ll[I824]] =$aCustom[I850]; unset($aCustom[I850]); $vRes["body"] =$this->cms->Gui->get($this->moduleName.I855.$aCustom[I821], $aCustom); }function TTTll1l($cId, $cModule) {$this->SetLastError(); }function TTTll11($cId, $cModule) {$asql =Array(); $asql =$this->TTT1IlI($asql, $cId); if($this->TTTl1TT($asql, $cId, $cModule)) {$this->SetLastError(); $this->cms->AddStatusMsg("status_add"); $this->TTT1I1T(); }else {$this->SetLastError(1, "Adding failed"); $this->cms->AddStatusMsg(I865, "red"); }}function TTTl1TT(&$asql, $cId, $cModule) {$res =false; if(!empty($asql)) {$this->TTT11TT($asql, $cId, $this->action); if($this->options[I646]) {$asql[$this->IIll1lL['date_modified']] ="=|NOW()"; }if($this->options["use_positions"]) {$asql[I866] =$this->TTTl1TI(); }$sql =$this->db->GenInsertSQL($this->module->GetTableName(), $asql); if($this->db->query($sql)) {$this->appliedId =$this->db->lastInsertId(); $this->browser->SetApplied($this->db, $asql, $this->langData); $res =true; $IIl1I1l =Array(); if($this->IIllL1I) {if($this->cms->IIIlL1L){ $this->cms->IIIlL1l[I670] =$this->appliedId; list($IIl1I1L, $IIILlLl) =$this->TTT1Il1($asql); $IIl1I1l[I789] =$this->GenAutoLink($asql[$this->options['name_field_name']], $IIl1I1L, $IIILlLl); unset($this->cms->IIIlL1l[I670]); }if(empty($IIl1I1l[I789])){ $IIl1I1l[I861] =$asql[I861]."-".$this->appliedId; }}if($this->options[I656]) {if($this->options["generate_id_external"] && empty($asql[I791])) {$IIl1I1l[I791] ="=|if(id_external='', '".$this->options["auto_gen_id_external"].$this->appliedId."', id_external)"; }elseif($this->cms->VarsPost["id_external_manual"] == 1) {$sql ="SELECT 1 FROM ".$this->module->GetTableName()." WHERE id_external='".$asql[I791].I867.$this->appliedId."' LIMIT 1"; if($this->db->getValue($sql) >0) {$IIl1I1l[I791] ="=|concat(id_external,'_".$this->appliedId."')"; }}}if (sizeof($IIl1I1l) >0) {$sql =$this->db->GenUpdateSQL($this->module->GetTableName(), $IIl1I1l, "WHERE id='".$this->appliedId.I868); $this->db->query($sql); }}}return $res; }function TTTl1TI() {$tableName =$this->module->GetTableName(); $res =TlT1Ill($this->db, $tableName); return $res; }function TTTl1Tl($cId, $cModule) {$this->cms->Gui->AddGlobalVars(Array("FORM_MODE"=>"EDIT")); $this->IIllIlI =$cId; $this->SetLastError(); }function TTTl1T1($cId, $cModule) {$this->SetLastError(); }function _ActionDel($cId, $cModule){ $sql ="DELETE FROM " .$this->module->GetTableName() ." WHERE id='" .$cId .I868; if( $this->db->query($sql) && (!$this->options[I654] || ($this->db->affected_rows() >0)) ){$this->SetLastError(); $this->cms->AddStatusMsg(I869); }else{ AMI_Registry::set('deprecated/amiLastSQLQuery', AMI_Registry::get('amiLastSQLQuery')); $this->SetLastError(3, 'Deleting failed'); $this->cms->AddStatusMsg('status_del_fail', I754); }}function TTTl1IT($cId, $cModule) {$tmp =$this->options[I664]; $this->options[I664] =I645; $sql =I870.$this->module->GetTableName()." WHERE 1".$this->_ApplyFilters(); $this->options[I664] =$tmp; if($this->db->query($sql) && (!$this->options["support_rights"] || $this->db->affected_rows() >0)) {$this->SetLastError(); $this->cms->AddStatusMsg("status_del"); }else {$this->SetLastError(3, "Deleting failed"); $this->cms->AddStatusMsg(I871, "red"); }}function TTTl1II(&$aGroupIds, $cModule, $IIl1I11, $IIl1lII) {$keys =array_keys($aGroupIds); $IIl1lIl =0; foreach ($keys as $key) {$IIl1lIL =$this->{$IIl1I11}($aGroupIds[$key], $cModule); if ($this->errno == 0) {$IIl1lIl += is_null($IIl1lIL) ?1 :$IIl1lIL; }}$this->IIllIll =$IIl1lIl; $this->cms->AddStatusMsg($IIl1lII, "blue", I645, I645, Array("num_items" => $IIl1lIl.I645)); $aGroupIds =Array(); unset($this->cms->VarsGet[I691]); $this->appliedId =I645; }protected function TTTl1Il(&$aGroupIds, $module, $action, $IIl1lI1){ $keys =array_keys($aGroupIds); $IIl1lIl =0; foreach ($keys as $key){ $IIl1lIL =$this->TTTlITT($action, $aGroupIds[$key], $module); if($this->errno == 0){ $IIl1lIl += (is_null($IIl1lIL) ?1 :$IIl1lIL); }}$this->IIllIll =$IIl1lIl; $this->cms->AddStatusMsg($IIl1lI1, 'blue', I643, I643, array(I872 => (string)$IIl1lIl)); $aGroupIds =array(); unset($this->cms->VarsGet['_grp_ids']); $this->appliedId =I643; }function TTTl1I1(&$aGroupIds, $cModule) {$numItems =sizeof($aGroupIds); $this->TTTl1II($aGroupIds, $cModule, "_ActionDel", "status_grp_del"); }function TTTl1lT(&$aGroupIds, $cModule) {$numItems =sizeof($aGroupIds); $this->TTTl1II($aGroupIds, $cModule, "_ActionCopy", I873); }function TTTl1lI($cId, $cModule) {$asql =Array(); $asql =$this->TTT1IlI($asql, $cId); $res =false; if(!empty($asql)) {$this->TTT1ll1($asql, $cId, $this->action); if($this->options[I646]) {$asql[$this->IIll1lL['date_modified']] ="=|NOW()"; }if($this->options[I656] && $this->cms->VarsPost["id_external_manual"] == 1) {$sql ="SELECT 1 FROM ".$this->module->GetTableName()." WHERE id_external='".$asql[I791].I867.$cId."' LIMIT 1"; if($this->db->getValue($sql) >0) {$asql[I791] .= "_".$cId; }}$sql =$this->db->GenUpdateSQL($this->module->GetTableName(), $asql, "WHERE id='".$cId.I868); if( $this->db->query($sql) && (!$this->options[I654] || ($this->db->affected_rows() >0)) ){$this->SetLastError(); $this->cms->AddStatusMsg("status_apply"); $res =TRUE; }}if(!$res){ AMI_Registry::set('deprecated/amiLastSQLQuery', AMI_Registry::get('amiLastSQLQuery')); $this->SetLastError(2, 'Apply failed'); $this->cms->AddStatusMsg('status_apply_fail', I754); }$this->appliedId =$cId; $this->browser->SetApplied($this->db, $asql, $this->langData); $this->TTT1I1T(); }function TTTl1ll($cId, $cModule) {$IIl1llI =false; if($this->cms->VarsPost["action_original"] != I645) {$this->ProcessAction($this->cms->VarsPost[I874], $cId); if($this->cms->VarsPost[I874] == I707) {$IIl1llI =true; }elseif($this->cms->VarsPost[I874] == "add") {$cId =$this->appliedId; }}if($IIl1llI || empty($this->errno)) {$appliedId =$this->appliedId; $this->ProcessAction("edit", $cId); $this->appliedId =$appliedId; }}function _ActionPublish($cId, $cModule) {$this->TTT1IIT(($this->cms->Vars["publish"]=="on"), $cId, $this->module->GetTableName(), I875, "status_publish"); }function TTTl1l1(&$aGroupIds, $cModule) {$this->cms->Vars["publish"] ="on"; $this->TTTl1II($aGroupIds, $cModule, "_ActionPublish", I876); }function TTTl11T(&$aGroupIds, $cModule) {$this->cms->Vars["publish"] ="off"; $this->TTTl1II($aGroupIds, $cModule, "_ActionPublish", "status_grp_unpublish"); }function _ActionArchive($cId, $cModule) {$this->TTT1IIT(($this->cms->Vars[I877]=="on"), $cId, $this->module->GetTableName(), "archive", "status_archive"); }function TTTl11I($cId, $cModule) {$this->itemData =Array(); $sql ="SELECT * FROM ".$this->module->GetTableName().I878.$cId.I868; $this->db->query($sql); if($this->db->next_record()) {foreach($this->db->Record as $key=>$value) {if(!is_numeric($key)) {$this->itemData[$key] =$value; }}}}function _ActionIndexDetails($cId, $cModule){ $this->TTT1IIT(($this->cms->Vars["details_noindex"] == I679), $cId, $this->module->GetTableName(), "details_noindex", "status_grp_no_index_details"); }function _ActionNoIndexDetails($cId, $cModule){ $this->TTT1IIT(($this->cms->Vars["details_noindex"] == I679), $cId, $this->module->GetTableName(), I879, "status_grp_no_index_details"); }function TTTl11l(&$aGroupIds, $cModule) {$this->cms->Vars[I877] ="on"; $this->TTTl1II($aGroupIds, $cModule, "_ActionArchive", "status_grp_archive"); }function TTTl111(&$aGroupIds, $cModule) {$this->cms->Vars[I877] =I880; $this->TTTl1II($aGroupIds, $cModule, "_ActionArchive", "status_grp_unarchive"); }function TTT1TTT(&$aGroupIds, $cModule) {$this->TTITTII(); $numItems =sizeof($aGroupIds); $IIl1lIl =0; if($numItems >0) {$IIl1lll =array_chunk($aGroupIds, 200); if($this->module->IssetOption(I662)) {$IIILL1L =$this->module->GetOption(I662); if($IIILL1L != "none") {$prefix =trim($this->options['default_prefix'], I881) .I881; if ($prefix == I881) {$prefix =I643; }$IIl1llL ="SELECT " .$prefix ."id, " .$prefix .$this->IIll1lL[I640]; if($this->options["use_id_page"]) {$IIl1llL .= ", " .$prefix .I677; }if($this->options["description_field_name"] != I645) {$IIl1llL .= ", " .$prefix .$this->options["description_field_name"]; }$IIl1ll1 =array ('select' => I643, 'join' => I643, I882 => I643 );$this->TTT1TTI($IIl1ll1, $prefix); $IIl1llL .= $IIl1ll1['select'] .", " .$prefix .$this->options["announce_field_name"] .", " .$prefix .I883 ."FROM ".$this->module->GetTableName().$this->options["default_table_alias"] .$IIl1ll1['join'] ." WHERE " .$prefix .I884; $sql2 =") " .$this->_ApplyFilters() .$IIl1ll1[I882]; $db =$this->TTTlTT1(); $IIl1lLI =$this->TTTlTT1(); $this->TTITTIl('gen_keywords', 'start'); foreach($IIl1lll as $IIl1lLl){ $IIl1lLL =I868.implode("','", $IIl1lLl).I868; $sql =$IIl1llL.$IIl1lLL.$sql2; $IIl1lLI->query($sql); while($IIl1lLI->next_record()) {@set_time_limit(29); $this->TTT1TTl($IIl1lLI->Record); $id =$IIl1lLI->Record[I670]; $this->id =$id; $IIlLL1L =unserialize($IIl1lLI->Record[I885]); $IIIL1Il =array( I787=>$IIlLL1L[I787], "keywords"=>$IIlLL1L["keywords"], "description"=>$IIlLL1L["description"] );$IIIL1II =$IIIL1Il; $IIl1lL1 =Array(); $vName =removeSpecial($IIl1lLI->Record[$this->options[I830]], I886, true); if($this->cms->TTTT1Tl($IIILL1L, 0, $IIIL1II, $IIIL1Il, $IIl1lL1, $vName, $IIl1lLI->Record[$this->options["description_field_name"]], $IIl1lLI->Record[$this->options["announce_field_name"]])) {$IIlLL1L[I787] =$IIIL1Il[I787]; $aParams =Array("default_html_title" => $IIlLL1L[I787], I677=>isset($IIl1lLI->Record[I677]) ?$IIl1lLI->Record[I677] :0, "object_name" => $vName, I810 => $this->moduleName); $IIl1l1I =$this->TTT1II1($db, $aParams); $IIlLL1L[I787] =TlT1IlI($this->cms, $this->moduleName, $IIl1l1I, $IIlLL1L[I787]); $IIlLL1L[I887] =$IIIL1Il[I887]; $IIlLL1L["description"] =$IIIL1Il["description"]; }$IIlLL1L["is_kw_manual"] =$IIl1lL1["is_kw_manual"]; $IIlLL1L[I888] =1; $aEvent =array( I781 => $this->moduleName, 'aData' => &$IIlLL1L, 'aOriginalData' => $IIl1lLI->Record, 'oEngine' => $this );AMI_Event::fire('v5_on_group_generate_keywords', $aEvent, AMI_Event::MOD_ANY); unset($aEvent); $aSql =Array(I885=>addslashes(serialize(removeSpecial($IIlLL1L, I889)))); $sql =$IIl1lLI->GenUpdateSQL($this->module->GetTableName(), $aSql, "WHERE id='".$id.I868); $db->query($sql); $IIl1lIl += $db->affected_rows(); $this->TTITTIl('gen_keywords', 'flush'); }$this->IIllIll =$IIl1lIl; $this->cms->AddStatusMsg("status_grp_note_kwauto", I890, I645, I645, Array("num_items" => $IIl1lIl.I645)); $aGroupIds =Array(); $this->appliedId =I645; $this->id =I645; }$this->TTITTIl('gen_keywords', 'end'); }}}}function TTT1TTI(&$IIl1ll1, $prefix){ }function TTT1TTl(&$record){ }function TTT1TT1(&$aGroupIds, $cModule, $IIl1l1l =I643) {if($this->options['stop_use_sublinks']){ $this->TTITTII(); $IIl1lIl =0; if(sizeof($aGroupIds)){ $sql =I891 .$this->IIll1lL[I640] .", sublink" .$IIl1l1l; if($this->options["use_id_page"]) {$sql .= ", id_page"; }if($this->options["multi_sites"]) {$sql .= I892; }$this->TTITTIl('gen_sublinks', 'start'); $IIl1l1L =$sql; $IIl1lll =array_chunk($aGroupIds, 200); foreach($IIl1lll as $IIl1lLl){ $IIl1lLL =I868.implode("','",$IIl1lLl).I868; $sql =$IIl1l1L ." FROM ".$this->module->GetTableName().$this->options["default_table_alias"]." WHERE id IN(".$IIl1lLL.") ".$this->_ApplyFilters(); $this->db->query($sql); $db =&$this->TTTlTT1(); while($this->db->next_record()){ @set_time_limit(29); $this->cms->IIIlL1l[I670] =$this->db->Record[I670]; list($IIl1I1L, $IIILlLl) =$this->TTT1Il1($this->db->Record); $IIl1l11 =$this->GenAutoLink($this->db->Record[$this->options[I830]], $IIl1I1L, $IIILlLl, $this->db->Record["prefix_date"]); unset($this->cms->IIIlL1l[I670]); $this->IIlll1I =isset($this->db->Record[I677]) ?$this->db->Record[I677] :0; $this->IIlll1l =isset($this->db->Record[I681]) ?$this->db->Record[I681] :0; $IIl1LII =$this->TTT11II($IIl1l11, $this->db->Record[I680]); if($IIl1LII<0){ $IIl1l11 .= "-".$this->db->Record[I680]; }$aSql =Array(I861=>$IIl1l11); $sql =$this->db->GenUpdateSQL($this->module->GetTableName(), $aSql, I893.$this->db->Record[I680].I868); $db->query($sql); $IIl1lIl += $db->affected_rows(); $this->TTITTIl('gen_sublinks', 'flush'); }}$this->TTITTIl('gen_sublinks', 'end'); $this->IIllIll =$IIl1lIl; $this->cms->AddStatusMsg("status_grp_note_linkauto", I890, I645, I645, Array("num_items" => $IIl1lIl.I645)); $aGroupIds =Array(); $this->appliedId =I645; }}}function TTT1TIT(&$aGroupIds, $cModule){ $this->cms->Vars[I879] =I759; $this->TTTl1II($aGroupIds, $cModule, "_ActionIndexDetails", "status_grp_no_index_details"); }function TTT1TII(&$aGroupIds, $cModule){ $this->cms->Vars[I879] =I679; $this->TTTl1II($aGroupIds, $cModule, "_ActionNoIndexDetails", "status_grp_no_index_details"); }function TTT1TIl(&$aGroupIds, $cModule) {$IIl1LIl =Array(); $IIl1LIl["list"] =I645; if(sizeof($this->options["group_operations_popup"]) >0) {$IIl1LIL =array_diff($this->options[I644], Array("move_position", "open_popup")); if(sizeof($IIl1LIL) >0) {$this->words += $this->cms->Gui->ParseLangFile($this->IIlll11."lang/_group_operations.lng"); $aData =Array("common_list" => I645); foreach($IIl1LIL as $IIl1LI1) {$aData["caption"] =$this->words["icon_grp_".$IIl1LI1]; $aData[I734] =$IIl1LI1; $aData["common_list"] .= $this->cms->Gui->getDefPostf($this->moduleName."_list:grp_popup_common_row", "_".$IIl1LI1, $aData); }$aData["caption"] =$this->words["grp_popup_gcommon"]; $IIl1LIl["list"] =$this->cms->Gui->get($this->moduleName."_list:grp_popup_common_list", $aData); }$aCustom =Array(); foreach($this->options["group_operations_popup"] as $IIl1LI1) {$IIl1LlI =$this->TTT1TI1($IIl1LI1, $aCustom); if($IIl1LlI != I645) {$IIl1LIl["list"] .= $this->cms->Gui->getAbs($this->moduleName."_list:grp_popup_custom_row", Array("caption" => $this->words[I894.$IIl1LI1], I717 => $IIl1LlI, I734 => $IIl1LI1)); }}}$content =$this->cms->Gui->get($this->moduleName."_list:grp_popup_operation_list", $IIl1LIl); $header =$this->words[I644]; $vData =Array( "content" => $content, "popup_title" => $header, "header" => $header );$this->TTT1I1I($vData, I895, $this->moduleName.I829, I895); }function TTT1TI1($IIl1LI1, &$aCustom) {$IIl1LlI =I645; switch($IIl1LI1) {case I677: $aPageData =Array("selected" => I645); $pagesList =I645; foreach($this->IIllll1 as $pageId=>$aPageData) {$pagesList .= $this->cms->Gui->get($this->moduleName."_subform:_id_page_row", $aPageData); }$aPageData["pages_list"] =$pagesList; $IIl1LlI =$this->cms->Gui->get($this->moduleName."_list:grp_popup_id_page_body", $aPageData); break; }return $IIl1LlI; }function TTT1TlT(&$aGroupIds, $cModule) {$idPage =intval($this->cms->VarsGet[I896]); if($idPage >= 0 && sizeof($aGroupIds) >0) {$IIl1Lll =I737.$this->options[I664]."id_page!=".$idPage; if($this->cms->VarsGet["grp_type"] == "move") {$sql ="UPDATE ".$this->module->GetTableName().$this->options["default_table_alias"]." SET id_page='".$idPage."' WHERE id IN('".implode("','", $aGroupIds)."') ".$this->_ApplyFilters().$IIl1Lll; $this->db->query($sql); $IIl1LlL =$this->db->affected_rows(); $type =I897; }else {$IIl1Ll1 =Array(I677 => $idPage); $IIl1LlL =$this->TTT1TlI($aGroupIds, $cModule, false, $IIl1Ll1, $IIl1Lll); $type ="copy"; }if($idPage >0) {$pageName =$this->IIllll1[$idPage][I719]; $this->cms->AddStatusMsg("status_grp_id_page_".$type, I645, I645, I645, Array("num_copied"=>$IIl1LlL.I645, "page_name" => $pageName)); }else {$this->cms->AddStatusMsg("status_grp_id_page_".$type."_common", I645, I645, I645, Array("num_copied"=>$IIl1LlL.I645)); }}}function _ActionCopy($cId, $cModule) {if($this->TTT1TlI($cId, $cModule)) {$this->SetLastError(); $this->cms->AddStatusMsg("status_copy"); $this->TTT1I1T(); }else {$this->SetLastError(1, "Copying failed"); $this->cms->AddStatusMsg(I898, "red"); }}function TTT1TlI($cId, $cModule, $IIl1LLI =true, $IIl1Ll1=Array(), $IIl1LLl =I645) {$IIl1LLL =$this->id; $this->id =I643; $IIl1LL1 =0; $isError =false; $aIds =(array)$cId; $aFields =Array(); $keyField =I680; $sql ="describe ".$this->module->GetTableName(); $this->db->query($sql); $IIl1L1I =Array(); while($this->db->next_record()) {if($this->db->Record["Key"] == "PRI") {if($this->db->Record[I899] != "auto_increment") {$isError =true; break; }else {$keyField =$this->db->Record["Field"]; }}else {$aFields[] =$this->db->Record["Field"]; }if((in_array($this->db->Record["Type"], Array(I900, "bigint(64)", "double", "float")))){ $IIl1L1I[$this->db->Record["Field"]] =1; }}if(!$isError) {$sql =I901.$this->module->GetTableName().$this->options["default_table_alias"]." WHERE id IN('".implode("', '", $aIds)."') ".$IIl1LLl; $db =$this->db->TTI1I1T(); $dbrs =&$this->db->select($sql); while($dbrs->nextRecord()){ $IIl1L1l =Array(); $IIl1L1L =$dbrs->Record[I670]; foreach($aFields as $key){ if(isset($IIl1Ll1[$key])) {$IIl1L1l[$key] =$IIl1Ll1[$key]; }else {if($IIl1LLI && $this->options[I830] == $key) {$IIl1L1l[$key] =addslashes($this->words[I902]." ".$dbrs->Record[$key]); }else {$IIl1L1l[$key] =addslashes($dbrs->Record[$key]); }if(isset($IIl1L1I[$key])){ if($IIl1L1l[$key] == I645){ $IIl1L1l[$key] ="=|NULL"; }}}}$aVars =Array(); $aVars["original_sublink"] =I645; $aVars[$this->options[I830]] =$IIl1L1l[$this->options[I830]]; $IIl1L11 =false; $this->TTT1Ill($IIl1L1l, 0, $aVars, true); unset($IIl1L1l[I791]); if($this->TTT1Tll($db->Record[$keyField], $IIl1L1l, $cModule)) {$IIl1LL1++; $IIl1L11 =true; }$IIlLIIL =Array(I734 => "_copy_item_".$this->side, I680 => $IIl1L1L, I692 => Array(I903 => $IIl1L11, "new_sql" => $IIl1L1l, "aVars" => $aVars)); $this->TTT1lI1($IIlLIIL); }}$this->id =$IIl1LLL; return $IIl1LL1; }function TTT1Tll($IIl11II, &$IIl1L1l, $cModule) {return $this->TTTl1TT($IIl1L1l, 0, $cModule); }function TTT1Tl1($cType, $cModule, $condition =I643) {$IIl11Il =$this->module->GetTableName(); switch($cType) {case "search_hash": if($this->module->IssetOption("search_fields_setup")) {$db =$this->TTTlTT1(); $sql ="SELECT COUNT(*) as 'count' FROM ".$IIl11Il .$condition; $db->query($sql); $db->next_record(); $max =$db->Record['count']; for($chunk =0; $chunk <$max; $chunk += 100) {$sql ="SELECT * FROM ".$IIl11Il .$condition .' LIMIT ' .$chunk .', 100'; $db->query($sql); AMI_Registry::push(I904, true); $this->TTITTIl('repair_search_hash', 'start'); while($db->next_record()) {@set_time_limit(29); $aSql =Array(); foreach($db->Record as $key=>$value) {if(!is_numeric($key) && !is_null($value)) {$aSql[$key] =addslashes($value); }}$this->TTT1ll1($aSql, $db->Record[I680], empty($this->importForceAction) ?'apply' :'add'); $sql =$db->GenUpdateSQL($IIl11Il, $aSql, I893.$db->Record[I680].I868); $this->db->query($sql); $count++; $this->TTITTIl(I905, 'flush'); }}$this->TTITTIl(I905, 'end'); AMI_Registry::pop(I904); $this->cms->AddStatusMsg('status_repair_search_hash', 'blue'); }break; case I906: if($this->options["use_positions"]) {$sql ="UPDATE ".$IIl11Il." SET position=id WHERE lang='".$this->langData.I868; $this->db->query($sql); $this->cms->AddStatusMsg("status_repair_positions", I890); }break; }}function TTT1T1T(&$aIds, $cModule) {$alias =rtrim($this->options[I907], I881); if(empty($alias)){ $alias ='p'; }$filter =" WHERE 1".$this->_ApplyFilters($alias).$this->TTTlIl1(); $skipIncrease =false; $posAfter =0; $posAfterNext =0; $nMoved =sizeof($aIds); $IIIL11l =$this->cms->Vars["grp_type"]; if($nMoved >0) {if($IIIL11l == "top") {$sql =I908. "FROM ".$this->module->GetTableName(). " AS " .$alias .$filter ." ORDER BY position ASC LIMIT 1"; $this->db->query($sql,DBC_SYS_QUERY); if($this->db->next_record()) {$posAfterNext =$this->db->Record[I866]; $sql ="SELECT position FROM ".$this->module->GetTableName().I909.$posAfterNext." ORDER BY position DESC LIMIT   1"; $this->db->query($sql,DBC_SYS_QUERY); if($this->db->next_record()) {$posAfter =$this->db->Record[I866]; }else {$posAfter =$posAfterNext -1; }}}elseif($IIIL11l == "bottom") {$skipIncrease =true; $sql ="SELECT position FROM ".$this->module->GetTableName()." ORDER BY position DESC LIMIT 1"; $this->db->query($sql,DBC_SYS_QUERY); if($this->db->next_record()) {$posAfter =$this->db->Record[I866]; $posAfterNext =$posAfter +1; }}else {$grpPosition =max(0, intval($this->cms->Vars[I910]) -1); $IIl11IL =$this->browser->SetForceRules(I645, " LIMIT ".$grpPosition.", 1"); $this->browser->ProcessSQL($this->db, $this->options[I664].I866); if($this->db->next_record()) {$posAfter =$this->db->Record[I866]; }$this->browser->SetForceRules($IIl11IL["order"], $IIl11IL[I718], true); $sql ="SELECT position FROM ".$this->module->GetTableName().I911.$posAfter." ORDER BY position ASC LIMIT 1"; $this->db->query($sql,DBC_SYS_QUERY); if($this->db->next_record()) {$posAfterNext =$this->db->Record[I866]; }}$sql ="SELECT id, position FROM ".$this->module->GetTableName()." WHERE id IN('".implode("','", $aIds)."') ORDER BY position ASC"; $this->db->query($sql); $aIds =Array(); while($this->db->next_record()) {$aIds[] =$this->db->Record[I680]; }$numEmptyPlaces =$posAfterNext -$posAfter -1; if($numEmptyPlaces >-1) {$numIncrease =max(0, $nMoved -$numEmptyPlaces); if($numIncrease >0 && !$skipIncrease) {$sql ="UPDATE ".$this->module->GetTableName()." SET position=position+".$numIncrease.I911.$posAfter; $this->db->query($sql); }}foreach($aIds as $i => $id) {$sql ="UPDATE ".$this->module->GetTableName()." SET position=".($posAfter +$i +1).I912.$id; $this->db->query($sql); }}}function TTT1T1I($IIIL11l, $cId) {if($this->browser->TI1TTI1() == "desc") {if($IIIL11l == I703) {$IIIL11l =I708; }else {$IIIL11l =I703; }}$this->TTT1T11($IIIL11l, $cId, 1); }function TTT1T1l($IIIL11l, $cId) {if($this->browser->TI1TTI1() == "desc") {if($IIIL11l == "top") {$IIIL11l ="bottom"; }else {$IIIL11l =I913; }}$this->TTT1T11($IIIL11l, $cId); }function TTT1T11($IIIL11l, $cId, $IIl11I1 =I645) {$IIl11lI =$this->module->GetTableName(); $sql ="SELECT position FROM ".$IIl11lI." WHERE id = '".$cId.I868; $this->db->query($sql,DBC_SYS_QUERY); if($this->db->next_record()) {$position =$this->db->Record[I866]; if($IIIL11l == I703 || $IIIL11l == I913){ $cond ="<"; $sortDim ="DESC"; }else {$cond =I914; $sortDim ="ASC"; }$pref =$this->options[I664]; if($pref != I645) {$IIl11ll =" ".mb_substr($pref, 0, -1); }$sql ="SELECT ".$pref."id, ".$pref.I915.$IIl11lI.$IIl11ll." WHERE ".$pref.I866.$cond.I868.$position.I868.$this->_ApplyFilters().$this->TTTlIl1()." ORDER BY ".$pref."position ".$sortDim; if($IIl11I1 != I645) {$sql .= " LIMIT ".$IIl11I1; }$this->db->query($sql); $IIl11lL =$position; $IIl11l1 =&$this->TTTlTT1(); $this->TTITTIl(I916, 'start'); while($this->db->next_record() && $this->db->Record[I680] != $cId) {@set_time_limit(29); $sql="UPDATE ".$IIl11lI." SET position='".$IIl11lL."' WHERE id='".$this->db->Record[I680].I868; $IIl11lL =$this->db->Record[I866]; $IIl11l1->query($sql); $this->TTITTIl(I916, I917); }$this->TTITTIl(I916, 'end'); if($IIl11lL != $position) {$sql="UPDATE ".$IIl11lI." SET position='".$IIl11lL."' WHERE id='".$cId.I868; $IIl11l1->query($sql); $aSql =Array(I866=>$IIl11lL); $this->browser->SetApplied($this->db, $aSql, $this->langData); $this->appliedId =$cId; $this->cms->AddStatusMsg(I918, I890); }}}function TTT1ITT($cId, $cModule) {$this->ProcessAction("edit", $cId); $this->appliedId =$this->id; $asql =$this->cms->VarsGet; $this->browser->SetApplied($this->db, $asql, $this->langData); }function TTT1ITI($cId, $cModule) {$this->SetLastError(11, "Not processed front add action"); }function TTT1ITl($cId, $cModule) {$this->SetLastError(12, "Not processed front edit action"); }function TTT1IT1($cId, $cModule) {$this->SetLastError(13, "Not processed front apply action"); }function TTT1IIT($IIIII1L, $cId, $IIl11LI, $IIl11Ll, $IIl11LL =I919) {$status =($IIIII1L) ?1: 0; $this->TTT1III($status, $cId, $IIl11LI, $IIl11Ll, $IIl11LL); }function TTT1III($cValue, $cId, $IIl11LI, $IIl11Ll, $IIl11LL =I919) {$sql ="UPDATE $IIl11LI SET $IIl11Ll='$cValue'"; if($this->options[I646]) {$sql .= ', ' .$this->IIll1lL['date_modified'] .'=NOW() '; }$sql .= "WHERE id='$cId'"; if($this->db->query($sql) && (!$this->options["support_rights"] || $this->db->affected_rows() >0)) {$this->SetLastError(); $this->cms->AddStatusMsg($IIl11LL); }else {$this->SetLastError(4, "Changing status failed"); $this->cms->AddStatusMsg($IIl11LL."_fail", "red"); }$this->appliedId =$cId; $this->browser->SetApplied($this->db, $asql, $this->langData); }function TTT1IIl() {if($this->options["front_require_login"]) {if($this->cms->Core->IsInstalled("members") && $this->cms->ActivePage != I920) {$mMembers =&$this->cms->Core->GetModule(I920); CreateMember($this->cms, $GLOBALS ["oSession"]); $this->cms->Member->requireLogin($GLOBALS["ROOT_PATH_WWW"].$mMembers->GetFrontLink(), $GLOBALS["ROOT_PATH_WWW"].$this->module->GetFrontLink()); }}}function TTT1II1(&$db, &$aParams) {$IIl1l1I =TlT1IlT($this->cms, $db, $aParams[I810], $aParams[I677], $aParams["default_html_title"]); $IIl1l1I[I921] =htmlspecialchars($aParams[I921]); return $IIl1l1I; }function TTT1IlT(&$aVars) {if($this->module->IssetOption(I662)) {$IIILL1L =$this->module->GetOption(I662); $IIl11L1 =I645; $IIl111I =I645; $aVars["html_keywords"] =removeSpecial($aVars["html_keywords"], "html"); $aVars["html_description"] =removeSpecial($aVars[I922], "html"); if($IIILL1L != "none") {$IIILL11 =$aVars[I788]; if($IIILL1L == "auto") {$IIIL1II =array( I787=>removeSpecial($aVars["original_html_title"]), I887=>removeSpecial($aVars["original_html_keywords"]), "description"=>removeSpecial($aVars["original_html_description"]) );}$IIIL1Il =array( I787=>removeSpecial($aVars["html_title"], I889), I887=>removeSpecial($aVars["html_keywords"], I889), I923=>removeSpecial($aVars[I922], I889) );$IIl1lL1 =Array(); $vName =removeSpecial($aVars[$this->options[I830]], I886, true); $description =I645; if(isset($aVars[I923])) {$description =$aVars[I923]; }elseif(isset($aVars["body"])) {$description =$aVars["body"]; }$description =removeSpecial($description, I889); if($this->cms->TTTT1Tl($IIILL1L, $IIILL11, $IIIL1II, $IIIL1Il, $IIl1lL1, $vName, $description, isset($aVars[I655]) ?$aVars[I655] :null)) {$aVars["html_title"] =$IIIL1Il[I787]; $aParams =Array("default_html_title" => $aVars[I924], I677 => $this->IIlll1I, I921 => $vName, I810 => $this->moduleName); $IIl1l1I =$this->TTT1II1($this->db, $aParams); $aVars[I924] =TlT1IlI($this->cms, $this->moduleName, $IIl1l1I, $aVars[I924]); $aVars["html_keywords"] =$IIIL1Il[I887]; $aVars[I922] =$IIIL1Il[I923]; $this->cms->AddStatusMsg("status_apply_note_kwauto", I890); }$aVars[I788] =$IIl1lL1["is_kw_manual"]; }}}function TTT1IlI($aSql, $cId =0) {$aEvent =array( I781 => $this->moduleName, 'itemId' => $cId, I925 => &$aSql );AMI_Event::fire('deprecated_v5_on_item_prepare', $aEvent, AMI_Event::MOD_ANY); if(!empty($aSql)) {if($this->TTT11ll()){ if(isset($this->cms->VarsPost[I770])) $aSql[I770] =$this->cms->VarsPost[I770]; if(isset($this->cms->VarsPost["adv_campaign_type"])) $aSql["adv_campaign_type"] =$this->cms->VarsPost["adv_campaign_type"]; }$IIlLIIL =Array(I734=>I926, I680=>$cId, "item_data"=>&$aSql); $this->TTT1lI1($IIlLIIL); if($this->options["lang_data"]) {$aSql["lang"] =$this->langData; }$this->IIlll1I =0; if($this->options["use_id_page"]) {$this->IIlll1I =intval($this->cms->VarsPost[I677]); $aSql[I677] =$this->IIlll1I; }if($this->options[I927]) {if($this->action == I707 && $cId >0) {$sql ="SELECT id_site FROM ".$this->module->GetTableName().I878.$cId.I868; $this->db->query($sql); if($this->db->next_record()) {$this->IIlll1l =$this->db->Record[I681]; }}elseif($this->action == "add") {$this->IIlll1l =$this->siteId; }}if($this->options["use_options_form"]) {$IIlLL1L =Array(); $this->TTT1IlT($this->cms->VarsPost); if(isset($this->cms->VarsPost["html_title_inherit"])) {$IIlLL1L[I928] =intval($this->cms->VarsPost["html_title_inherit"]); }if(isset($this->cms->VarsPost[I924])) {$IIlLL1L[I787] =trim($this->cms->VarsPost[I924]); }if(isset($this->cms->VarsPost["html_keywords"])) {$IIlLL1L[I887] =trim($this->cms->VarsPost["html_keywords"]); }if(isset($this->cms->VarsPost[I922])) {$IIlLL1L[I923] =trim($this->cms->VarsPost[I922]); }if(isset($this->cms->VarsPost[I788])) {$IIlLL1L["is_kw_manual"] =intval($this->cms->VarsPost[I788]); }if(sizeof($IIlLL1L) >0) {foreach($IIlLL1L as $IIl111l => $val) {if(!empty($val)) {$IIlLL1L[I888] =1; break; }}$aSql[I885] =addslashes(serialize(removeSpecial($IIlLL1L, I889))); }if($this->options["use_details_noindex"]){ $aSql[I879] =intval($this->cms->VarsPost[I879]); }}if($this->options[I656]) {$aSql[I791] =$this->cms->VarsPost[I791]; }if($this->options[I648]) {$aSql[I929] =$this->IIllIIL; }if($this->options['use_special_list_view']) {if (empty($this->cms->VarsPost[I769])) {$aSql[$this->IIll1lL[I641]] =intval(!empty($this->cms->VarsPost['public_direct_link'])); $aSql[$this->IIll1lL['sticky']] =0; $aSql[$this->IIll1lL['date_sticky_till']] =I930; }else {$aSql[$this->IIll1lL[I641]] =1; $aSql[$this->IIll1lL['sticky']] =1; $aSql[$this->IIll1lL['date_sticky_till']] =empty($this->cms->VarsPost[I642]) ?I930 :DateTools::toMysqlDate(DateTools::getCorrectUDate($this->cms->VarsPost[I642], $this->cms->DFMT['conf'])); }}$this->TTT1Ill($aSql, $cId, $this->cms->VarsPost); }AMI_Event::fire('v5_on_item_prepare', $aEvent, AMI_Event::MOD_ANY); return $aSql; }function TTT1Ill(&$aSql, $cId =0, &$aVars, $IIl111L =false, $IIl1111 =true) {$cId =$cId >0 ?$cId :$this->id; require_once($GLOBALS[I931]."func_url.php"); $res =true; $aMessages =Array(); $IIl1LII =0; if($this->options["use_options_form"] && $this->options[I661] && empty($aVars["skip_sublink_changing"])) {$this->cms->IIIlL1l[I670] =$cId; $sublink =PrepareSublink($aVars[I861]); $IILIIII =false; if(empty($sublink)){ list($IIl1I1L, $IIILlLl) =$this->TTT1Il1($aSql); $IIl1l11 =$this->GenAutoLink($aVars[$this->options[I830]], $IIl1I1L, $IIILlLl); $IIl1LII =$this->TTT11II($IIl1l11, $cId); if($IIl1LII<0 || $IIl1l11 == I643){ if($IIl1111 && ($this->action=="add" || $cId==0)){ $this->IIllL1I =true; }else{ $IIl1l11 .= I932.$cId; }}else {$aMessages[] =Array( "message" => "status_apply_note_linkauto", "type" => I890, "prefix" => I645, I933 => I645, "param" => array("link"=>$IIl1l11) );}$IILIIII =true; $sublink =$IIl1l11; }if(!$IILIIII && $sublink!=$aVars["original_sublink"]){ if(!checkUrlSymbols($sublink, $GLOBALS["ROOT_PATH_WWW"])){ $sublink =$aVars[I934]; $aMessages[] =Array( "message" => "status_apply_warn_link_symb", "type" => "red", I935 => I645, I933 => I645, "param" => array() );}else{ $IIl1LII =$this->TTT11II($sublink, $cId); if($IIl1LII <0){ if(empty($aVars['original_sublink'])){ $count =2; do{ $tmp =$this->TTT11II($sublink, $id); if($tmp <0){ if(empty($id)){ $sql ="SELECT `id` FROM " .$this->module->GetTableName() ." ORDER BY `id` DESC LIMIT 1"; $id =(int)$this->db->getValue($sql) +1; }$sublink .= I936 .$id; }}while(($tmp <0) && (--$count >0)); }else{ $sublink =$aVars['original_sublink']; }}}}if(!empty($sublink)){ $aSql[I861] =$sublink; }if($IIl1LII <0) {$navData =$this->cms->TTIT1Tl(); $frontLink =$navData["_front_link"]; if($IIl1LII == -3) {$modName =$this->cms->Core->GetModOption($navData[I937], "admin_menu_caption"); $aMessages[] =Array( "message" => "status_apply_linkauto_vpage_found_warn", "type" => "red", I935 => I645, I933 => I645, "param" => array(I813=>$frontLink, I810 => I868.$modName.I868) );}elseif($IIl1LII == -1) {$aMessages[] =Array( "message" => "status_apply_linkauto_page_found_warn", "type" => "red", I935 => I645, I933 => I645, "param" => array(I813=>$frontLink) );}else {$aMessages[] =Array( "message" => "status_apply_linkauto_item_found_warn", "type" => "red", I935 => I645, I933 => I645, "param" => array(I813=>$frontLink, I719=>$navData["_additional_info"][$this->options[I830]]) );}}unset($this->cms->IIIlL1l[I670]); }if(!$IIl111L) {foreach($aMessages as $IILIIIl) {$this->cms->AddStatusMsg($IILIIIl[I938], $IILIIIl["type"], $IILIIIl[I935], $IILIIIl[I933], $IILIIIl["param"]); }}return $res; }function TTT1Il1(&$aSql) {return array(I643, 5); }function TTT1I1T(){ if($this->appliedId >0 && is_object($this->filter) && $this->filter->issetField("datefrom")) {$udate =DateTools::getCorrectUDate(isset($this->cms->VarsPost["date"]) ?$this->cms->VarsPost[I939] :null, $this->cms->DFMT["conf"]); $result =DateTools::TT1lI11($udate, $this->cms->Vars["udatefrom"], $this->cms->Vars["udateto"]); if($result !== false){ $this->cms->Vars["datefrom"] =date($this->cms->DFMT[I940], $this->cms->Vars["udatefrom"]); $this->cms->Vars["dateto"] =date($this->cms->DFMT[I940], $this->cms->Vars["udateto"]); $this->filter->UpdateField("datefrom", $this->cms->Vars[I941]); $this->filter->UpdateField("dateto", $this->cms->Vars["udateto"]); }}}function TTT1I1I(&$vData, $IILIIIL, $blockName =I645) {global $conn; $vData["metas"] =$this->cms->Gui->getMetas(); $vData["scripts"] =$this->cms->Gui->getScripts(); $vData[I657] =$vData[I942]; if($blockName == I645) {$blockName =$this->moduleName.I682; }echo $this->cms->Gui->get($blockName.I849.$IILIIIL, $vData); $conn->Out(); die(); }function TTT1I1l() {return 0; }function _GetSmallFrontLinkCB(&$vItem, &$vData) {$vData[I813] =$this->module->GetFrontLink($vItem[I677]); }function _GetFrontLinkCB(&$vItem, &$vData) {$vItem["script_link"] =$this->module->GetFrontLink($vItem[I677]); }function _GetSrcFrontLinkCB(&$vItem, &$vData) {$pageId =isset($vItem['id_page']) ?$vItem['id_page'] :0; $vItem[I813] =$this->module->GetFrontLink($pageId); }function _GetNavDataCB(&$vItem, &$vData) {$aNavData =Array(); $vItem += $this->IIllllL; switch($vData[I812]) {case I795: case "body_urgent_cats": $aNavData[I943] =$vItem[I680]; $aNavData['catid_sublink'] =isset($vItem[I789]) ?$vItem[I789] :null; $vItem += $this->cms->ApplyNav($aNavData); break; case I806: $aNavData[I943] =$vData["cat_id"]; $aNavData["catid_sublink"] =isset($vData['cat_sublink']) ?$vData[I944] :null; if(isset($vData["prev_id"])) {$aNavData[I680] =$vData["prev_id"]; $aNavData["id_sublink"] =$vData["prev_sublink"]; $aNavData =$this->cms->ApplyNav($aNavData); $vData[I945] =$aNavData["nav_data"]; }if(isset($vData["next_id"])) {$aNavData[I680] =$vData["next_id"]; $aNavData["id_sublink"] =$vData[I946]; $aNavData =$this->cms->ApplyNav($aNavData); $vData["next_nav_data"] =$aNavData["nav_data"]; }case "body_items": case "body_urgent_items": $aNavData[I670] =isset($vItem[I670]) ?$vItem[I670] :null; $aNavData[I947] =isset($vItem[I789]) ?$vItem[I789] :null; $aNavData['catid'] =isset($vData['cat_id']) ?$vData['cat_id'] :null; $aNavData['catid_sublink'] =isset($vData[I944]) ?$vData[I944] :null; $vItem += $this->cms->ApplyNav($aNavData); break; case I948: break; case I794: case "body_filtered": $aNavData[I943] =isset($vItem['cat_id']) ?$vItem['cat_id'] :null; $aNavData["catid_sublink"] =isset($vItem[I944]) ?$vItem[I944] :null; $vItem += $this->cms->ApplyNav($aNavData); $vItem[I949] =$vItem["nav_data"]; unset($vItem["nav_data"]); $aNavData[I680] =$vItem[I680]; $aNavData["id_sublink"] =$vItem[I861]; $vItem += $this->cms->ApplyNav($aNavData); break; case I860: $aNavData[I680] =$vItem[I680]; $aNavData["id_sublink"] =$vItem[I861]; $aNavData[I943] =isset($vItem[I950]) ?$vItem[I950] :null; $aNavData["catid_sublink"] =isset($vItem[I944]) ?$vItem[I944] :null; $vItem += $this->cms->ApplyNav($aNavData); break; }}function _GetNSplitterCB(&$vItem, &$vData) {$row =$vItem["row_index"]; if($row >0 && $row %$this->IIllILI == 0 && $row != $vData["_num_rows"]) {$prefix =(isset($vData["nsplitter_prefix"]))? $vData[I951] :I840; $vData["list"] .= $this->cms->Gui->getAbs($this->moduleName.I855.$prefix."nSplitter", I645); }}function _GetSplitterCB(&$vItem, &$vData) {$aNavData =Array(); $row =isset($vItem['row_index']) ?$vItem['row_index'] :0; $vItem[I952] =$this->options[I649]; if(($row >0) && (($row %$this->options[I649]) == 0)) {$vData["list"] .= $this->cms->Gui->getAbs( $this->isSmallMode && $this->cms->Gui->issetSet($name =$this->moduleName."_list:small_".$vData["splitter_prefix"]."Vsplitter") ?$name :$this->moduleName.I855.$vData[I953]."Vsplitter", $vItem); }elseif($row >0) {$vData["list"] .= $this->cms->Gui->getAbs( $this->isSmallMode && $this->cms->Gui->issetSet($name =$this->moduleName."_list:small_".$vData[I953].I729) ?$name :$this->moduleName.I855.$vData[I953].I729, $vItem); }}function _ApplySimpleSetsCB(&$vItem, &$vData) {$cnt =sizeof($this->IIllILl); for($i=0; $i <$cnt; $i++) {$fieldName =$this->IIllILl[$i]; $vItem["_".$fieldName] =isset($vItem[$fieldName]) ?$vItem[$fieldName] :null; if(!$this->IIllILL || !empty($vItem[$fieldName])) {$vItem[$fieldName] =$this->cms->Gui->getAbs($this->moduleName.I855.$vData[I839].$fieldName, $vItem); }}}function TTT1I11() {$this->IIllIlL =$this->options; }function TTT1lTT() {$this->options =$this->IIllIlL; }function TTT1lTI(&$aCustom) {if(!isset($aCustom[I712]) || !is_array($aCustom[I712])) {$aCustom[I712] =array(); }$IILIII1 =Array(); $this->IIllILl =Array(); if(isset($aCustom[I954]) && is_array($aCustom[I954]) && sizeof($aCustom[I954]) >0) {$IILIII1 =Array("simple_sets" => Array(I734=>I817, I816=>&$this, I779=>"_ApplySimpleSetsCB")); $this->IIllILl =$aCustom[I954]; }$this->IIllILL =in_array($aCustom[I821], $this->options["hide_empty_simple"]); $IILIIlI =Array(); $IILIIll =true; $IILIIlL =Array(); if($aCustom[I821] == I806) {$IILIIll =true; $IILIIlL =Array("prev_next_links" => Array(I734=>I817, I816=>&$this, I779=>I955)); }if($IILIIll && (!empty($this->options['stop_use_sublinks']) || $this->module->IssetOption('stop_arg_names'))){ $IILIIlI =array(I789 => array(I771 => 'callback', I847 => &$this, 'method' => I956)); }$aCustom[I773] =$IILIIlI +$IILIII1 +$IILIIlL +$aCustom[I773]; }function TTT1lTl($IILIIl1, &$IILIILI, &$vData, &$IILIILl) {$IIlLIIL =Array(I734=>"apply_vars", "item_data"=>&$IILIILI, I717=>&$vData, I692=>&$IILIILl); $this->TTT1lI1($IIlLIIL); }function TTT1lT1(&$IILIILL, $aCustom) {$res =I645; $aHistory =unserialize($IILIILL); if(is_array($aHistory)) {require_once $GLOBALS['CLASSES_PATH'] .'CMS_IteratorArray.php'; $IILIIL1 =$this->db; $this->db =new CMS_IteratorArray($this->module); krsort($aHistory, SORT_STRING); $IILII1I =array(); foreach($aHistory as $key => $val){ if(($pos =mb_strpos($key, I957)) !== false){ $key =mb_substr($key, 0, $pos); }$val["_date"] =date($this->cms->DFMT["php_dtime"], $key); $val["changed_by"] =$this->words[$val["type"]]; $IILII1I[] =$val; }$IIl1ILI =Array(); $maxSize =$this->module->IssetOption(I958)? $this->module->GetOption(I958): 10; if(sizeof($IILII1I) >$maxSize) {$IIl1ILI["show_full_history"] =1; $IIl1ILI["history_length"] =sizeof($IILII1I); }$this->db->SetArray($IILII1I); $aDefault =Array( "items" => I680, "table" => $this->module->GetTableName(), I959 => $this->moduleName.I682, "tpl_list_postfix" => ":history_list", "tpl_row_postfix" => ":history_row", "tpl_empty_list_postfix" => ":history_list_empty", "legend" => I645, "applied_id" => -1, "last_edited_id" => -1, I960 => 0, "browser_page_size" => $maxSize, I714 => $IIl1ILI );$IIlL1Ll =$aCustom +$aDefault; $IIlL1Ll[I714] += $IIl1ILI; $this->module->PushPager($this->browser); $this->browser->Position =$IIlL1Ll[I960]; $this->browser->PageSize =$IIlL1Ll["browser_page_size"]; $this->browser->InitSQL($IIlL1Ll["items"], "FROM ".$IIlL1Ll[I961], "WHERE 1"); $this->browser->ProcessSQL($this->db); $res =$this->browser->GetList($this->db, $IIlL1Ll[I773], $IIlL1Ll[I959], $IIlL1Ll["tpl_list_postfix"], $IIlL1Ll["tpl_row_postfix"], $IIlL1Ll["tpl_empty_list_postfix"], $IIlL1Ll[I962], $IIlL1Ll["applied_id"], $IIlL1Ll["legend"], $IIlL1Ll[I714]); $res =$res[I850]; $this->module->PopPager($this->browser); $this->db =$IILIIL1; }return $res; }function TTT1lIT(&$aList, $count, $aCustom) {$aDefault =array (I959 => $this->moduleName .I682, "tpl_hidden_field_postfix" => "list_ctrl_hidden_field", I963 => "list_ctrl_row", "tpl_single_row_postfix" => "list_ctrl_row_single", "tpl_list_postfix" => I964, "count" => $count, "list" => array (),);$IIlL1Ll =$aCustom +$aDefault; $tplBlock =$IIlL1Ll[I959] .I849; $res =$this->cms->Gui->get($tplBlock .$IIlL1Ll["tpl_hidden_field_postfix"], $IIlL1Ll); if ($count <0) {if (isset($aList[0])) {$IIlL1Ll += $aList[0]; }$res .= $this->cms->Gui->get($tplBlock .$IIlL1Ll["tpl_single_row_postfix"], $IIlL1Ll); }else {$count =$count >0 ?min($count, count($aList)) :count($aList); $IIlL1Ll[I965] =I645; foreach ($aList as $row) {$row["selected"] =empty($row["selected"]) ?I643 :' selected'; $IIlL1Ll[I965] .= $this->cms->Gui->get($tplBlock .$IIlL1Ll[I963], $row); $count--; if ($count <1) {break; }}$res .= $this->cms->Gui->get($tplBlock .$IIlL1Ll["tpl_list_postfix"], $IIlL1Ll); }return $res; }function TTT1lII(&$db, $count, $aCustom) {$res =I645; $aDefault =array (I773 => I645, I959 => $this->moduleName .I682, "tpl_hidden_field_postfix" => ":props_list_ctrl_hidden", I963 => ":props_list_ctrl_row", "tpl_list_postfix" => ":props_list_ctrl_list", "tpl_empty_list_postfix" => ":props_list_ctrl_empty_list", "tpl_single_item_postfix" => ":props_list_ctrl_single", "applied_id" => -1, I962 => -1, I966 => I645, I714 => Array(), );$IIlL1Ll =$aCustom +$aDefault; $aListData =Array( "hidden_field" => $this->cms->Gui->get($IIlL1Ll[I959].$IIlL1Ll["tpl_hidden_field_postfix"], $IIlL1Ll[I714]), );$IIlL1Ll[I714] += $aListData; $IILII1l =true; if($count >= 0) {$this->browser->Position =0; $this->browser->PageSize =($count == 0)? 100000: $count; $this->browser->ProcessSQL($db); if($this->browser->MaxCount <= $this->browser->PageSize) {$IILII1l =false; $res =$this->browser->GetList($db, $IIlL1Ll[I773], $IIlL1Ll[I959], $IIlL1Ll["tpl_list_postfix"], $IIlL1Ll[I963], $IIlL1Ll["tpl_empty_list_postfix"], $IIlL1Ll[I962], $IIlL1Ll[I967], $IIlL1Ll[I966], $IIlL1Ll[I714]); $res =$res[I850]; }}if($IILII1l) {$res =$this->cms->Gui->get($IIlL1Ll[I959].$IIlL1Ll["tpl_single_item_postfix"], $IIlL1Ll[I714]); }return $res; }public function &GetExtension($IIlLIIl){ $ext =null; $IILII1L =&$this->cms->Core->GetModule($IIlLIIl); if(is_object($IILII1L) && $IILII1L->IssetProperty('class')) {$aClasses =$IILII1L->TTlTTTI('class'); $class =array_pop($aClasses); $ext =new $class(); }else {trigger_error(I968 .$IIlLIIl, E_USER_WARNING); }return $ext; }function TTT1lIl($IILII11 =Array()) {$aExt =Array(); if(!is_array($IILII11)) {$IILII11 =Array($IILII11); }if(count($IILII11) == 0) {$IILII11 =array_keys($this->ext); }foreach($IILII11 as $IIlLIIl) {if(is_object($this->ext[$IIlLIIl])) {$aExt[$IIlLIIl] =&$this->ext[$IIlLIIl]; }}return $aExt; }function TTT1lI1(&$IIlLIIL,$aExtensions =false){ if(!is_array($this->ext)){ $aExtensions =array(); }elseif($aExtensions === false) {$aExtensions =array_keys($this->ext); }else{ $aExtensions =array_intersect($aExtensions,array_keys($this->ext)); }if(sizeof($aExtensions) >0) {if(!isset($IIlLIIL["item_data"]) || $IIlLIIL[I969] === false) {$IIlLIIL[I969] =&$this->itemData; }if(empty($IIlLIIL[I734])) {$IIlLIIL[I734] =$this->action; }if(empty($IIlLIIL[I680])) {$IIlLIIL[I680] =$this->id; }$IIlLIIL += Array( I717 => Array(), I692 => Array(), );foreach($aExtensions as $IIlLIIl) {if(!empty($this->ext[$IIlLIIl]) && $this->ext[$IIlLIIl]->IsInstalled()) {$this->ext[$IIlLIIl]->TTT1lI1($IIlLIIL); }}}$IILIlII =empty($IIlLIIL[I781]); if($IILIlII){ $IIlLIIL[I781] =$this->moduleName; }$IIlLIIL[I970] =$this; AMI_Event::fire('v5_on_ext_action', $IIlLIIL, AMI_Event::MOD_ANY); unset($IIlLIIL[I970]); if($IILIlII){ unset($IIlLIIL[I781]); }}function TTT1llT(&$aOptions) {$res =Array(); if(is_array($aOptions)) {foreach($aOptions as $IILIlIl => $val) {$IILIlIL =explode(I721, $IILIlIl); for($i=0; $i<sizeof($IILIlIL); $i++) {$res[$IILIlIL[$i]] =$val; }}}return $res; }function TTT1llI($IILIlI1) {$res =Array(); if($this->module->IssetOption($IILIlI1)) {$aTmp =$this->module->GetAOption($IILIlI1); $res =$this->TTT1llT($aTmp); }return $res; }function TTT1lll($content) {$aEvent =array( 'sourceContent' => $content, I942 => mb_strtolower($content), 'aReplacement' => array( '/[\r\n]/' => I971, '/##--.*?--##/' => I643, '/<!--.*?-->/' => I643, '/##[a-z0-9_]+##/' => I643, '/<[a-z\/].*?>/' => I971, '/[^a-z--0-9\.,&-]/u' => '_', '/&(?:nbsp|raquo|laquo|amp|quot|lt|gt|_039|_035|_037)/' => I643, '/[_ ]+/' => I971 ));AMI_Event::fire('on_search_index', $aEvent, $this->moduleName); $content =$aEvent[I942]; if(sizeof($aEvent[I972])){ $content =preg_replace( array_keys($aEvent[I972]), array_values($aEvent[I972]), $content );}return I936 .$content .I936; }function TTT1ll1(&$asql, $cId, $IIIL11l, $IILIllI =false) {$cId =intval($cId); if (!isset($asql['id_category'])) {$asql['id_category'] =0; $set =true; }if($this->module->IssetOption("search_fields_setup")) {$aOption =$this->module->GetOption("search_fields_setup"); if(is_array($aOption) && sizeof($aOption) >0) {foreach($aOption as $IILIlll=>$data) {$num =sizeof($data[I773]); if(is_array($data[I773]) && $num >0) {$content =I645; if(isset($data[I973]) && is_array($data[I973]) && !$IILIllI) {if($IIIL11l == "add") {$IILIllL =$this->TTT1l1T($data[I973], $asql, $cId); if($IILIllL) {$sql ="SELECT CONCAT_WS(' ', ".implode(I745, $data[I773]).") as hs_data FROM ".$IILIllL["t_name"].$IILIllL[I974]; $this->db->query($sql); if($this->db->next_record()) {$content =$this->db->Record["hs_data"]; }}}else {continue; }}else {if(!$IILIllI) {for($i=0; $i<$num; $i++) {$content .= " ".$asql[$data[I773][$i]]; }$content =$this->TTT1lll($content); }}if(isset($data["target"]) && is_array($data["target"])) {if($IILIllI) {$IILIll1 =$this->module->GetTableName(); $sql =I975.$IILIlll." FROM ".$IILIll1.I878.$cId.I868; $this->db->query($sql); if($this->db->next_record()) {$content =$this->db->Record[$IILIlll]; }}if($IIIL11l == I707) {$IILIllL =$this->TTT1l1T($data["target"], $asql, $cId); if($IILIllL) {$sql ="UPDATE ".$IILIllL["t_name"].I976.$IILIlll."='".addslashes($content)."' ".$IILIllL[I974]; $this->db->query($sql); }}}$asql[$IILIlll] =$content; }}}}if (isset($set)) {unset($asql['id_category']); }}function TTT1l1T($cData, &$IILIlLI, $cId) {$res =false; $IILIlLl =&$this->cms->Core->GetModule($cData[I929]); if(is_object($IILIlLl)) {$IILIll1 =$IILIlLl->GetTableName(); if(!empty($IILIll1)) {$res["t_name"] =$IILIll1; $where =I645; if(!empty($cData[I974])) {$where =I977.str_replace("##{id}##", I868.$cId.I868, $cData[I974]); $where =$this->cms->Gui->parseText($where, $IILIlLI); $res[I974] =$where; }}}return $res; }function &TTT1l1I(&$cModule) {$vMod =&$this->module; $this->module =&$cModule; $this->moduleName =$cModule->GetName(); return $vMod; }function TTT1l1l($IILIlLL) {$aOptions =$this->module->TTlITII($IILIlLL."*", $this->langData); if(isset($aOptions[I649])) {$this->options[I649] =$aOptions[I649]; }}function TTT1l11(&$asql) {if($this->options[I927] && !isset($asql[I681])) {$asql[I681] =$this->siteId; }}function TTT11TT(&$asql, $cId, $IIIL11l) {$this->TTT1ll1($asql, $cId, $IIIL11l); $this->TTT1l11($asql); }function TTT11TI(&$vData, $IILIlL1, $IILIl1I, $IILIl1l =Array()) {$html =I645; if($this->options[I927]) {$rows =Array(); $exclude =I645; if(is_array($IILIl1l) && sizeof($IILIl1l) >0) {$exclude =" WHERE id NOT IN('".implode("','", $IILIl1l).I978; }$sql ="SELECT id, name FROM cms_sites".$exclude." ORDER BY id asc"; $this->db->query($sql); while($this->db->next_record()) {$IILIl1L =($this->db->Record[I680]==$IILIlL1); $IILIl11 =array("active"=>$IILIl1L?"selected":I645,I680=>$this->db->Record[I680], I719=>$this->db->Record[I719]); $rows[I979] .= $this->cms->Gui->get($this->moduleName."_subform:site_select_row", $IILIl11); }$vData["multi_sites_select_disabled"] =($IILIlL1 >0 && !$IILIl1I)? I755:I645; $vData["multi_sites_select"] =$this->cms->Gui->get($this->moduleName."_subform:site_select_body", $rows); $vData[I980] =$this->cms->Gui->get($this->moduleName."_subform:multi_sites_select", $vData); }return $html; }function _GroupOperationCB(&$vItem, &$vData) {$vItem["_group_checked"] =(in_array($vItem[I680], $this->aGroupIds)) ?I756 :I645; $vItem["_group_operations_col"] =$this->cms->Gui->getAbs($this->moduleName."_list:group_operations_col", $vItem); }function _GetExtSmallDataCB(&$vItem, &$vData){ $IIlLIIL =Array(I734=>I981, I969=>&$vItem, I717=>&$vData); $this->TTT1lI1($IIlLIIL); }function _IdPageRowCB(&$vItem, &$vData){ $vItem['_page_name'] =isset($this->IIllll1[$vItem['id_page']]) ?$this->IIllll1[$vItem['id_page']]['name'] :I643; $vItem[I982] =$this->cms->Gui->getAbs($this->moduleName .'_list:_id_page_row_col', $vItem); }function _positionsRow(&$vItem, &$vData) {$vItem["is_top"] =I645; $vItem["is_bottom"] =I645; if($this->browser->Position == 0 && $vItem['row_index'] == 0) {$vItem[I983] =1; }if($vData['_page_is_last'] && ($vItem['row_index'] +1) == $vData["_num_rows"]) {$vItem["is_bottom"] =1; }if($this->IIllLLI || (isset($vItem[I984]) && empty($vItem[I984]))) {$set =I793; $this->cms->Gui->addGlobalVars(Array("POSITIONS_COL_ENABLED"=>I759)); }else {$set =I645; $this->cms->Gui->addGlobalVars(Array("POSITIONS_COL_ENABLED"=>I679)); }$vItem["abs_row_index_m"] =$vItem["abs_row_index"] +1; $vItem[I985] =$this->cms->Gui->get($this->moduleName."_list:_positions_col".$set, $vItem); }function TTT11Tl(&$IILILII) {if($this->options["use_positions"]) {array_unshift($IILILII, "leg_move_top", "leg_move_bottom", I986, "leg_move_down"); }}function TTT11T1($cName, $IIlLlL1 =I645) {$res =Array(); $IILILIl =Array( "tpl_prefix"=>"icon_", "tpl_postfix"=>I645, "modify_on_permission"=>false, );switch ($IIlLlL1) {case I645: switch($cName) {case "action_del": $res["d"] =$IILILIl; break; default: $res["w"] =$IILILIl; break; }break; }return $res; }function TTT11IT($IILILIL) {$aNavData =Array(); if(is_array($this->IIlllLl)) {foreach($this->IIlllLl as $idName=>$IILILI1) {$aNavData[$IILILI1[I680]] =$this->{$idName}; if($IILILIL === false) {$sublink =$this->cms->VarsPost[$IILILI1[I861]["var"]]; }else {$sublink =$IILILIL; }$aNavData[$IILILI1[I861][I680]] =$sublink; }}return $aNavData; }function TTT11II($IIl1l11, $id) {$res =0; if($this->IIlllLL) {$navData =$this->TTT11IT($IIl1l11); $aPages =array(1); $IILILlI =false; $mode =I987; if($this->options[I927]) {$IILILll =$this->cms->Core->GetModOption("srv_multi_sites", I680); $this->cms->Core->SetModOption("srv_multi_sites", I680, $this->IIlll1l); $IILILlI =true; }elseif($this->cms->Core->IsInstalled("srv_multi_sites")) {$IILILll =$this->cms->Core->GetModOption("srv_multi_sites", I680); $IILILlI =true; if($this->IIlll1I >0) {$pageInfo =$this->module->GetFrontLink($this->IIlll1I, true); $this->cms->Core->SetModOption(I988, I680, $pageInfo[I681]); }else {$mode ="all_sites"; }}if($mode == I987) {foreach($aPages as $pageId=>$aPageData) {$res =$this->cms->TTTTll1($IIl1l11, $id, false, $navData, $this->options["front_mod_name"], $this->options[I830], $pageId, $this->moduleName); if($res <0) {break; }}}else {foreach($aPages as $pageId=>$aPageData) {$pageInfo =$this->module->GetFrontLink($pageId, true); $this->cms->Core->SetModOption(I988, I680, $pageInfo[I681]); $res =$this->cms->TTTTll1($IIl1l11, $id, false, $navData, $this->options["front_mod_name"], $this->options[I830], $pageId, $this->moduleName); if($res <0) {break; }}}if($res >= 0) {if($this->IIlll1l >0 && $this->IIlll1I == 0) {$this->cms->Core->SetModOption(I988, I680, 0); $res =$this->cms->TTTTll1($IIl1l11, $id, false, $navData, $this->options["front_mod_name"], $this->options[I830], 0, 0); }}if($IILILlI) {$this->cms->Core->SetModOption(I988, I680, $IILILll); }}return $res; }function GenAutoLink($IILILlL, $IIl1I1L, $IIILlLl =5, $IIILlLL =I643) {if($this->options["strip_tags_before_autolink"]) {$IILILlL =strip_tags($IILILlL); }$newLink =$this->cms->GenAutoLink($IILILlL, $IIl1I1L, ($this->langData=="ru")?true:false, I645, $IIILlLl, $IIILlLL); return $newLink; }function _PrevNextLinksCB(&$vItem, &$vData) {static $header =I643; if(empty($vData['prev_next_ready'])){ if($vItem[I680] == $this->id) {$vData["current_id"] =$this->id; $this->_GetNavDataCB($vData, $vData); if(isset($vData[I945])) {$vData["previos_link"] =$this->cms->Gui->getAbs($this->moduleName.I855.$vData[I839].$vData[I989], $vData +array (I640 => $header)); }}else {if(isset($vData["current_id"])) {$vItem['next_name'] =str_replace('\\', '\\\\', $vItem[I990 .$this->options['name_field_name']]); $vData["next_id"] =$vItem[I680]; $vData[I946] =$vItem[I861]; $vData['prev_next_ready'] =true; $this->_GetNavDataCB($vData, $vData); if(isset($vData["next_nav_data"])) {$vData[I991] =$this->cms->Gui->getAbs($this->moduleName.I855.$vData[I839].$vData[I844], $vData +$vItem); }}else {$vData["prev_id"] =$vItem[I680]; $vData["prev_sublink"] =$vItem[I861]; }}}$header =$vItem[$this->options['name_field_name']]; }function TTT11Il(&$vData, &$aCustom) {switch($aCustom[I821]) {case I806: $aCustom[I714]["previos_link"] =$this->cms->Gui->get($this->moduleName.I855.$aCustom[I714][I839].$aCustom[I714][I989].I992, $vData); $aCustom[I714][I991] =$this->cms->Gui->get($this->moduleName.I855.$aCustom[I714][I839].$aCustom[I714][I844].I992, $vData); break; }}function TTT11I1(&$vData, &$aCustom) {switch($aCustom[I821]) {case I831: $vData += Array("num_results"=>$this->browser->MaxCount); break; }}function TTT11lT(&$vData) {if($this->options["use_id_page"]) {$vData["_id_page_rows"] =I645; if(isset($this->cms->Vars['pid'])){ $IILILl1 =(int)$this->cms->Vars[I993]; }else{ $IILILl1 =(int)((isset($this->itemData[I677]) ?$this->itemData['id_page'] :max(0, $this->options['id_page']))); }foreach($this->IIllll1 as $pageId=>$aPageData) {$aPageData["selected"] =($IILILl1 == $pageId)? "selected": I645; $vData[I994] .= $this->cms->Gui->get($this->moduleName."_subform:_id_page_row", $aPageData); }$vData["_id_page_field"] =$this->cms->Gui->get($this->moduleName."_subform:_id_page_field", $vData); }}function SetRedirect($IILILLI =null){ if (is_null($IILILLI)) {unset($this->forceRedirect); }else {$this->forceRedirect =$IILILLI; $this->redirect =$IILILLI; }}function TTT11lI() {$aPage =AMI_Registry::get('page'); $aPage[I995] =false; AMI_Registry::set('page', $aPage); global $conn; if ($this->cms->Core->IssetModOption($this->moduleName, "set_404_header") && $this->module->GetAOption('set_404_header')) {$conn->DelHeader("Status: 200 OK"); $conn->DelHeader($GLOBALS[I996]." 200 OK"); $conn->AddHeader($GLOBALS[I996]." 404 Not Found", true); $conn->AddHeader("Status: 404 Not Found", true); $conn->SetSkip200Status(true); return true; }return false; }function TTT11ll($modName =false){ if($modName === false) $modName =$this->IIllII1; if($modName != $this->moduleName && preg_match('/\_home$/', $this->moduleName)) $modName =$this->moduleName; if(isset($this->IIllLIl[$modName])){ $this->IIllLII =$this->IIllLIl[$modName]; }else{ $this->IIllLII =false; $this->IIllLIl[$modName] =false; if($this->cms->Core->IsInstalled(I997)){ if($this->cms->Core->IssetModOption(I997, I998)){ $IILILLl =$this->cms->Core->GetModOption(I997, I998); if(is_array($IILILLl) && sizeof($IILILLl) >0){ if(in_array($modName, $IILILLl)){ $this->IIllLII =true; $this->IIllLIl[$modName] =true; }}}if($this->IIllLII && ($this->IIllLI1 === false || $this->IIllLlI === false)){ $this->IIllLI1 =array(); $this->IIllLlI =array(); $this->IIllLlL =array(); $sql =I999.$this->langData."' and p.public=1"; $rs =$this->db->select($sql); while($Record =$rs->nextRecord()){ if($Record['source_type'] == "modbanner") $this->IIllLI1[$Record[I680]] =array($Record[I810], $Record[I933]); else $this->IIllLlI[$Record[I680]] =array($Record[I810], $Record["browse_mode"], $Record[I1000]); }$sql ="select id, adv_places from cms_adv_groups where lang='".$this->langData.I868; $rs =$this->db->select($sql); while($Record =$rs->nextRecord()){ foreach(explode(I721, $Record[I997]) as $idPlace){ $idPlace =intval($idPlace); if($idPlace >0 && isset($this->IIllLI1[$idPlace])) $this->IIllLlL[$Record[I680]][] =$idPlace; }}}}}return $this->IIllLII; }function TTT11l1($moduleName, $bodyType, &$idPlace){ $res =false; if($bodyType == "small") $bodyType ="specblock"; if($moduleName != $this->moduleName && preg_match('/\_home$/', $this->moduleName)) $moduleName =$this->moduleName; if(isset($this->IIllLll[I717][$moduleName][$bodyType])){ $res =$this->IIllLll[I717][$moduleName][$bodyType][I1001]; $idPlace =$this->IIllLll[I717][$moduleName][$bodyType]["id_place"]; }else{ $optionName =($bodyType == "details" ?"adv_place_details" :($bodyType == "specblock" ?I1002 :"adv_place_list")); $idPlace =$this->module->IssetOption($optionName) ?$this->module->GetOption($optionName) :-1; if($idPlace >0 && isset($this->IIllLlI[$idPlace])){ if(mb_strpos($this->IIllLlI[$idPlace][0], I721.$moduleName.I721) !== false && mb_strpos($this->IIllLlI[$idPlace][1], I721.$bodyType.I721) !== false) $res =true; }$this->IIllLll[I717][$moduleName][$bodyType] =array( I1001 => $res, "id_place" => $idPlace );}return $res; }function TTT111T($IILILLL){ $ret =I645; $sql ="select (1000000000+id) as id, name from cms_adv_groups where lang='".$this->langData."' order by name"; $this->db->query($sql); while($this->db->next_record()){ $this->db->Record[I1003] =($IILILLL == $this->db->Record[I680]); $this->db->Record[I719] =$this->cms->Words["adv_group"].": ".$this->db->Record[I719]; $this->IIllLIL[$this->db->Record[I680]] =$this->db->Record[I719]; $ret .= $this->cms->Gui->getAbs($this->moduleName."_subform:adv_place_item", $this->db->Record); }$sql =I1004.$this->IIllII1.";%'  AND lang='".$this->langData.I1005; $this->db->query($sql); while($this->db->next_record()){ $this->db->Record[I1003] =($IILILLL == $this->db->Record[I680]); $this->IIllLIL[$this->db->Record[I680]] =$this->db->Record[I719]; $ret .= $this->cms->Gui->getAbs($this->moduleName."_subform:adv_place_item", $this->db->Record); }return $ret; }function TTT111I($IILILLL){ $ret =I645; if(mb_strpos($this->IIllII1, "_cat") !== false){ $reqModuleName =str_replace("_cat", "_item", $this->IIllII1); $sql =I1006.$reqModuleName.I1007.$this->langData."' order by c.name"; $this->db->query($sql); while($this->db->next_record()){ $this->db->Record[I1003] =($IILILLL == $this->db->Record[I680]); $ret .= $this->cms->Gui->getAbs($this->moduleName."_subform:adv_campaign_type_item", $this->db->Record); }}return $ret; }function TTT111l(&$vData, $cName, $itemId, $bodyType =I965 ,$guiBlockName =false){ $vData[$cName."_counter"] =$this->TTITTTT($this->IIllII1, $itemId, $bodyType, $guiBlockName, intval($vData["adv_campaign_type"]), intval($vData[I1008])); if(isset($vData[$cName."_place"])){ if(!isset($GLOBALS["IILILL1"])) $GLOBALS["IILILL1"] =0; $idPlace =intval($vData[$cName."_place"]); if($idPlace >1000000000){ $vData[$cName.I1009] =I645; $idPlace -= 1000000000; if(is_array($this->IIllLlL[$idPlace])){ foreach($this->IIllLlL[$idPlace] as $groupId => $placeId){ $placeId =intval($placeId); if($placeId >0){ $IILIL1I =$this->cms->Gui->getAbs($this->moduleName."_list:adv_body", array("id_place" => $placeId, "view_url" => $GLOBALS["ROOT_PATH_WWW"], I1010 => ++$GLOBALS["IILILL1"])); if($bodyType != I965 && $bodyType != "small"){ $this->cms->Gui->addGlobalVars(array("adv_place_".$placeId => $IILIL1I, "cat_adv_place_".$placeId => $IILIL1I)); if(!empty($this->IIllLI1[$placeId][1])){ $this->cms->Gui->addGlobalVars(array(I770.$this->IIllLI1[$placeId][1] => $IILIL1I, I1011.$this->IIllLI1[$placeId][1] => $IILIL1I)); }}else{ $vData[$cName."_place_".$placeId] =$IILIL1I; if(!empty($this->IIllLI1[$placeId][1])){ $vData[$cName.I1009.$this->IIllLI1[$placeId][1]] =$IILIL1I; }}}}}}else if($idPlace >0){ $IILIL1I =$this->cms->Gui->getAbs($this->moduleName."_list:adv_body", array("id_place" => $idPlace, "view_url" => $GLOBALS[I1012], I1010 => ++$GLOBALS["IILILL1"])); if($bodyType != I965 && $bodyType != "small"){ $this->cms->Gui->addGlobalVars(array("adv_place_".$idPlace => $IILIL1I, "cat_adv_place_".$idPlace => $IILIL1I)); if(!empty($this->IIllLI1[$idPlace][1])){ $this->cms->Gui->addGlobalVars(array(I770.$this->IIllLI1[$idPlace][1] => $IILIL1I, I1011.$this->IIllLI1[$idPlace][1] => $IILIL1I)); }}else{ $vData[$cName.I1013.$idPlace] =$IILIL1I; if(!empty($this->IIllLI1[$idPlace][1])){ $vData[$cName.I1009.$this->IIllLI1[$idPlace][1]] =$IILIL1I; }else{ $vData[$cName.I1009] =$IILIL1I; }}}else $vData[$cName.I1009] =I645; }}function _getAdvPlaceCB(&$aItem, &$aData, $bodyType =I965){ if(isset($aItem[I770])){ if($this->TTT11ll()){ $this->TTT111l($aItem, "adv", $aItem[I680], $bodyType); }else unset($aItem[I770]); }}function _getCatAdvPlaceCB(&$aItem, &$aData, $bodyType =I965){ if(isset($aItem[I1011])){ if($this->TTT11ll()){ $this->TTT111l($aItem, "cat_adv", $aItem[I680], $bodyType); }else unset($aItem[I1011]); }}function TTT1111($moduleName =I645, $IILIL1l =I645){ if($this->cms->Core->ReadOption($vData, I768, "calc_last")){ $vData["value"] =intval($vData[I1014]); if($vData[I1014]+7200 >time()){ return; }}$this->cms->Core->WriteOption(I768, "calc_last", time()); $IILIL1L =0; if(!empty($moduleName) && !empty($IILIL1l)){ $IILIL11 =$this->cms->Core->GetModProperty(I997, I1015); if(isset($IILIL11[$moduleName])){ $dbi =new db_si; set_time_limit(60); $sql =I1016.$moduleName."' and counter_processed=0 group by id_item order by id"; $this->db->query($sql); while($this->db->next_record()){ $IILIL1L =max($IILIL1L, $this->db->Record["max_id"]); $idItem =intval($this->db->Record["id_item"]); if($idItem >0){ set_time_limit(20); $IILI1II =intval($this->db->Record[I1017]); $IILI1Il =intval($this->db->Record["all_rows"]) -$this->db->Record[I1017]; $IILI1IL =array(); if($IILI1II >0){ $IILI1IL[] ="shown_items=shown_items+".$IILI1II; }if($IILI1Il >0){ $IILI1IL[] ="shown_details=shown_details+".$IILI1Il; }if(count($IILI1IL) >0){ $sql ="update ".$IILIL1l.I1018.implode(', ', $IILI1IL)." where id=".$idItem; $dbi->query($sql); }}}if($IILIL1L >0){ $sql =I1019.$IILIL1L." AND mod_name='".$moduleName.I868; $this->db->query($sql); $sql =I1020; $this->db->query($sql); }}}$this->cms->Core->DeleteOption(I768, "calc_last"); }function _advFormatCTRCB(&$aItem, &$aData){ $aItem[I1021] =sprintf("%.2f", $aItem[I1021]*100); }function _advFormatPlaceCB(&$aItem, &$aData){ $aItem[I770] =(isset($this->IIllLIL[$aItem[I770]]) ?$this->IIllLIL[$aItem[I770]] :I645); }function TTITTTT($moduleName, $itemId, $bodyType, $guiBlockName =false, $IILI1I1 =0, $idOwner =0){ $res =I645; if($this->TTT11l1($moduleName, $bodyType, $idPlace)){ $res =$this->cms->Gui->getAbs(($guiBlockName === false ?$this->moduleName.I829 :$guiBlockName).I1022, array(I810 => $moduleName, "is_details" => ($bodyType == "details" ?"D" :I1023), I680 => $itemId, "id_place" => $idPlace, "id_campaign" => $IILI1I1, I1008 => $idOwner)); }return $res; }function _GetSmallAdvCounter(&$vItem, &$vData) {if($vItem["adv_counter_id"] >0){ $vItem[(!empty($vData["adv_counter_prefix"]) ?$vData[I1024] :I645)."adv_counter"] =$this->TTITTTT($this->IIllII1, $vItem["adv_counter_id"], "small", false, intval($vItem["adv_campaign_type"]), intval($vItem[I1008])); }}function TTITTTI($command) {static $stack =array ();if ($command == I1025) {$stack[] =$this->options[I747]; $this->options[I747] =false; }else {$this->options[I747] =array_pop($stack); }}function TTITTTl($IILI1lI =false) {if (!empty($this->suppressUrgency) || !($table =$this->module->GetTableName())) {return; }$result =null; $minimum =null; $filter =" AND `lang` = '" .$this->langData ."' AND `public` = 1" .($this->options['multi_sites'] ?' AND `id_site` = ' .$this->siteId :I643); if ($this->options[I747] && $IILI1lI) {$sql =I1026 .$this->options['future_items_date_field']. ") FROM " .$table ." WHERE " .$this->options['future_items_date_field'] .I1027 .$filter; $minimum =$this->db->getValue($sql); if ($minimum) {$minimum =strtotime($minimum); }}if ($this->options['use_special_list_view']) {$sql ="SELECT 1 FROM " .$table ." WHERE `" .$this->IIll1lL['sticky'] .I1028 .$this->IIll1lL['date_sticky_till'] ."` < CONCAT(CURDATE(), ' 23:59:59')" .$filter ." LIMIT 1"; if ($this->db->getValue($sql)) {$sql =$this->db->genUpdateSQL( $table, array ($this->IIll1lL['sticky'] => 0, $this->IIll1lL[I641] => 0, $this->IIll1lL[I1029] => I930 ),"WHERE `" .$this->IIll1lL[I1029] ."` < CONCAT(CURDATE(), ' 23:59:59')" .$filter );$this->db->execute($sql); }if ($IILI1lI) {$sql =I1026 .$this->IIll1lL[I1029] .") FROM " .$table ." WHERE " .$this->IIll1lL[I1029] .I1030 .$this->IIll1lL['sticky'] ." >= NOW()" .$filter; $result =$this->db->getValue($sql); if ($result) {$result =strtotime(mb_substr($minimum, 0, 11) .'23:59:59'); }if ($minimum && $result) {$result =min($minimum, $result); }else if ($minimum) {$result =$minimum; }}}return $result; }function TTITTT1(&$aCustom, $IIlL1L1, $IILI1ll =true){ $res =isset($aCustom[$IIlL1L1 .'_default']) && is_array($aCustom[$IIlL1L1 .I1031]) ?$aCustom[$IIlL1L1 .I1031] :array(); $res += $aCustom; if($IILI1ll){ $res['page_item_type'] =$IIlL1L1; }return $res; }public function addHandler($action, $IILI1lL){ if( !is_string($IILI1lL) && !in_array('CMS_Mod_ActionHandler_Interface', class_implements($IILI1lL)) ){trigger_error('Handler must implement interface CMS_Mod_ActionHandler_Interface', E_USER_ERROR); }$this->IIll1Il[$action] =$IILI1lL; }private function TTITTIT($arg){ if((int)$arg != $arg || $arg <0){ $this->TTTllT1(); }}protected function processSEO($aCustom){ $aCustom += array('force_page_size' => $this->forcePageSize); $this->forcePageSize =0; $this->IIllL1l =$this->IIllL1l && !in_array($this->moduleName, $this->cms->Core->GetProperty('disabled_se_indexing_mods')); if(!$this->IIllL11 && $this->IIllL1l && $this->module->issetOption('disable_se_indexing_pages')){ $option =$this->module->GetOption('disable_se_indexing_pages'); if($this->cms->Vars['offset']){ if($this->cms->Vars[I771] == I846 && empty($aCustom['force_page_size'])){ $this->IIllL1l =!in_array('body_items_internal', $option); }elseif($this->cms->Vars[I771] == 'search'){ $this->IIllL1l =!in_array('body_filtered_internal', $option); }}$this->IIllL1l =$this->IIllL1l && (!$this->cms->Gui->getGlobalVar('PRINT_VERSION') ?true :!in_array('print_version', $option)); if($this->IIllL1l){ $bodyType =$this->IIll1II == I643 ?$this->bodyType :$this->IIll1II; foreach (array(I1032, 'body_browse', 'body_filtered', 'body_itemD', 'body_search') as $pageType) {if($bodyType == $pageType){ $this->IIllL1l =!in_array($pageType, $option); if(!$this->IIllL1l){ break; }}}if( $this->IIllL1l && $bodyType == I1033 && $this->offset && empty($aCustom['force_page_size']) ){$this->IIllL1l =false; }}}if(!$this->IIllL11 && $this->IIllL1l && $this->module->issetAndTrueProperty('stop_use_sublinks')){ $navData =array_keys($this->cms->I1IlIlI); foreach($navData as $getParameter){ if(isset($this->cms->sourceGET[$getParameter])){ $this->TTTllT1(); break; }}}$aGETVars =array(); if(!$this->IIllL11 && $this->IIllL1l){ $aURI =parse_url(AMI::getSingleton('env/request')->getURL('uri')); if(isset($aURI[I1034])){ parse_str($aURI[I1034], $aGETVars); mb_internal_encoding(I694); }if(isset($aGETVars['catid']) && empty($aGETVars[I771])){ $this->TTTllT1(); }}if(!$this->IIllL11 && $this->IIllL1l){ $get =$this->cms->VarsGet; unset($get[I670]); if($this->moduleName == 'forum'){ unset($get['id_message'], $aGETVars['id_message']); }$IILI1l1 =array( I1035 => empty($aCustom['force_page_size']) ?$this->module->GetOption('page_size') :$aCustom['force_page_size'], 'part' => 0 );$IILI1LI =isset($this->IlIllI1); if($IILI1LI || isset($this->oEshop)){ $IILI1l1[I1036] =$IILI1LI ?$this->IlIllI1->IILI1LI->GetOption('page_size') :$this->oEshop->ILlLLLL->GetOption('page_size'); unset($get['catid'], $aGETVars['catid']); }foreach($IILI1l1 as $arg => $pageSize){ if(isset($get[$arg])){ $pageSize =(int)$pageSize; if($pageSize && ($get[$arg] %$pageSize !== 0)){ $this->TTTllT1(); break; }unset($get[$arg], $aGETVars[$arg]); if(isset($get[I771]) && $get[I771] === I846){ unset($get[I771], $aGETVars[I771]); }}}if( isset($get[I1037]) && !empty($this->ext[I666]) && $this->ext[I666]->IsInstalled() ){unset($get[I1037], $get[I1035], $aGETVars[I1037], $aGETVars[I1035]); }if(isset($get['_print_version'])){ unset($get['_print_version'], $aGETVars['_print_version']); }$g =$get; foreach(array_keys($g) as $k){ if(mb_substr($k, 0, 4) === '404;'){ unset($get[$k]); }}if($this->cms->Core->Cache->Enabled){ $this->cms->Core->Cache->stripGet($get); $this->cms->Core->Cache->stripGet($aGETVars); }if (!empty($this->cms->VarsCookie[I1038])) {unset($get['lay_id']); unset($aGETVars['lay_id']); }if(sizeof($get) || sizeof($aGETVars)){ $this->TTTllT1(); }}if(!$this->IIllL1l){ $this->cms->Gui->setRobotsMeta(false); }}protected function processCanonical($aCustom) {$sBaseHref =$GLOBALS[I1012]; $aLinks =AMI_Registry::get('page/links', array()); $aGETVars =array(); $aURI =parse_url(AMI::getSingleton('env/request')->getURL(I1039)); if(isset($aURI[I1034])){ parse_str($aURI[I1034], $aGETVars); mb_internal_encoding(I694); }$pKeyName =$this->cms->Core->GetOption("print_flag"); if( empty($aLinks['canonical']) && isset($aGETVars[$pKeyName]) && (bool)$aGETVars[$pKeyName] == true ){$query =I643; foreach($aGETVars as $key => $value) {if(mb_strlen($key) >0 && !in_array($key, array($pKeyName, 'submit_url'))) {$query .= (mb_strlen($query) >0 ?I696 :'?') .$key .I695 .$value; }}$aLinks[I1040] =$this->cms->ActiveScriptNavLink .$query; }if(isset($aLinks[I1040])) {unset($aLinks['prev']); unset($aLinks['next']); }foreach($aLinks as $type => $value) {$this->cms->Gui->setLink(_fmtHrefLink((mb_strpos($value, $sBaseHref) === false ?$sBaseHref :I643) .$value, I643), $type); }}private function TTITTII(){ if(!sizeof($this->aGroupIds) && isset($this->cms->VarsGet['grp_target']) && $this->cms->VarsGet['grp_target'] == I886){ $sql =I1041 .$this->options[I907] .'`id` ' .'FROM ' .$this->module->GetTableName() .$this->options['default_table_alias'] .I971 .'WHERE 1 ' .$this->_ApplyFilters(); $oRS =$this->db->select($sql); while($aRow =$oRS->nextRecord()){ $this->aGroupIds[] =$aRow[I670]; }}}protected function TTITTIl($name, $type){ switch($type){ case I1042: $this->IIll1IL[$name] =0; break; case I917: if(!isset($this->IIll1IL[$name])){ trigger_error("Long operation '" .$name ."' isn't started", E_USER_ERROR); }$this->IIll1IL[$name]++; if(!($this->IIll1IL[$name]) && isset($GLOBALS['ENABLE_BUFFERING']) && $GLOBALS['ENABLE_BUFFERING'] === false){ echo I971; flush(); }break; case I1043: if(!isset($this->IIll1IL[$name])){ trigger_error("Long operation '" .$name ."' isn't started", E_USER_ERROR); }unset($this->IIll1IL[$name]); break; default: trigger_error("Invalid long operation '" .$name ."' type '" .$type .I868, E_USER_ERROR); }}public function getItemId(){ return $this->id; }public function TTITTI1($doMapping){ $this->doMapping =(bool)$doMapping; }}