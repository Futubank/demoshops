<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       46154 xkqwisuqtgstpnwnxkwrqpnkiuliktunztpzqrmxxzrktltrtkmzllqgirmzwzxlsmxrpnir
 */ ?><?php foreach(array(1060=>'oTTg~1`0?403?FHrYMSSQn',1061=>'FHrYMSSQn!?MnvZJMS?URj,?',1062=>'?Zt?',1063=>"",1064=>"Qn",1065=>"qnPJMDO",1066=>"ru",1067=>"RuDDMZn",1068=>"dHftmIGrQDDMHn",1069=>"nHnQ",1070=>"#Yr@",1071=>"rQS",1072=>"#fHnt?WHJHr=<ff0000?WJZDD=DtZtuD|rQS@*idp&#~fHnt@",1073=>"YJZWK",1074=>"#fHnt?WHJHr=<000000?WJZDD=DtZtuD|YJZWK@*idp&#~fHnt@",1075=>"#fHnt?WHJHr=<0000ff?WJZDD=DtZtuD|nHnQ@*idp&#~fHnt@",1076=>"YHSB",1077=>"*yhsb&",1078=>"WHnf",1079=>"ii~ss~bbbb",1080=>"GOG",1081=>"I~S~b",1082=>"SY",1083=>":I~:S~:b",1084=>"GIZnZPQr",1085=>"GZPQD",1086=>'wjzddqd|gzTo',1087=>'pUm|tQIGJZtQUGSZtQr`GOG',1088=>"OQZSQr|WZWOQ|Hff",1089=>'HpUm',1090=>"MnDtZJJQS|JZnPD",1091=>"MnDtZJJQS|MfZWQ|JZnPD",1092=>'|Ñv',1093=>"ZJJHC|IuJtM|JZnP",1094=>"MnDtZJJQS|WQ",1095=>'md|FmRdT|dTzRT|dTqg2',1096=>"WID",1097=>"WHSQ",1098=>"DtZrt|vQrDMHn",1099=>'WHrQ',1100=>'rQEurQ|rQYuMJS|IHSuJQD',1101=>'frHnt',1102=>"DtBJQ`WDD",1103=>"|IQDDZPQD",1104=>"tQIGJZtQD~IQDDZPQD`tGJ",1105=>"|IQDDZPQD%rQS",1106=>"|IQDDZPQD%YJZWK",1107=>"|IQDDZPQD%nHnQ",1108=>"|IQDDZPQD%DGJMttQr",1109=>"|GZPQr",1110=>"tQIGJZtQD~GZPQr`tGJ",1111=>"DtHG|JMnK|ZJJHCQS",1112=>"DtHG|JMnK|vZJuQ",1113=>"DtHG|JMnK|DGJMttQr",1114=>"DGQW|YJHWKD",1115=>"IHSuJQ",1116=>"WHrQ",1117=>"MnDtZJJQS",1118=>"PrHuG",1119=>"IHSuJQD",1120=>"MIP",1121=>"OtIJ|ZrQZ|fMQJSD",1122=>"JZnP|nZIQD",1123=>"DtZtuD|IQDDZPQD",1124=>'sqyUp|TqigjzTq',1125=>"frHnt|DWrMGt|JMnK",1126=>'WurrQnt|JZnP|SZtZ',1127=>"frHnt",1128=>"frHnt|",1129=>'DZfQ|WHHKMQD',1130=>'ZSIMn',1131=>'Qnv~WHHKMQ',1132=>"ZJJHCQS|vZrD|WHHKMQ",1133=>'ZRQEuQDt',1134=>'ZpQt',1135=>'ZgHDt',1136=>'ZwHHKMQ',1137=>'WuDtHI|Hn|rQEuQDt|MnMt',1138=>"[",1139=>"#Y@qxtQrnZJ?vZrMZYJQ?*",1140=>"&?MDn't?GZDDQS?MntH?VZrD```#~Y@#Yr@",1141=>'zim|qdwzgq|RqeUqdT',1142=>"ZSSDJZDOQD",1143=>"OtIJWOZrD|ZnS|ZSSDJZDOQD",1144=>"OtIJWOZrD",1145=>'=_',1146=>"mnvZJMS?SZtZ?fHr?'",1147=>"'?vZrMZYJQ",1148=>'ZIG^',1149=>"|OtIJWOZrDwy",1150=>"|ZSSdJZDOQDwy",1151=>"|OtIJWOZrDznSzSSdJZDOQDwy",1152=>'<',1153=>':',1154=>'\'',1155=>']<035^',1156=>']<037^',1157=>']<039^',1158=>'::',1159=>']<037^]<037^',1160=>'HJSQnv|MnDMSQ|nQCQnv',1161=>'HJSQnv|DtZtuD|IQDDZPQD',1162=>'Qnv~rQEuQDt',1163=>'rQDGHnDQ',1164=>'rQS',1165=>'IHS|ZWtMHn',1166=>'fHrI|DZvQ',1167=>'fHrI|MtQI|DZvQS',1168=>'fHrI|MtQI|nHt|DZvQS',1169=>'|',1170=>"IDP",1171=>"tBGQ",1172=>'IDP',1173=>'',1174=>'/;\D[#DWrMGt\D`-#~DWrMGt@\D[$/DMu',1175=>'*idp&',1176=>'tBGQ',1177=>'*yhsb&',1178=>'YHSB',1179=>'~\*zjqRT\&}`[ {\*\~zjqRT\&~D',1180=>"\r",1181=>"\n",1182=>'\\',1183=>"'",1184=>'\r',1185=>'\n',1186=>'\\\\',1187=>"\\'",1188=>'#DWrMGt?tBGQ="tQxt~LZvZDWrMGt"@ZJQrt}\'',1189=>"'{^#~DWrMGt@",1190=>"\t",1191=>"zrrZB}\n",1192=>"{\n",1193=>"SZtQ",1194=>"=_Nhc}{",1195=>"IHS|nZIQ",1196=>"IQDDZPQ",1197=>"rMnP",1198=>"funWtMHn",1199=>"SQtZMJD",1200=>"WID|IQDDZPQD",1201=>"DHrt",1202=>"DSMI",1203=>"DHrt|",1204=>"GZPQ|DHrt|WHJ",1205=>"DHrt|WHJ|nZIQ",1206=>"DHrt|SMI|nZIQ",1207=>"ZJJ|DHrt|fMJQSD",1208=>"ZJJ|DHrt|ZDW|SQDW",1209=>"KQB",1210=>"WZGtMHn",1211=>"|DQJ",1212=>"SQDW",1213=>"%DHrt|ZDW",1214=>"%DHrt|SQDW",1215=>"DHrt|SMI|WurrQnt",1216=>"DHrtfMQJS|",1217=>"%DHrtfMQJS",1218=>"ZDW",1219=>"DHrtSMr|ZDW",1220=>"%DHrtSMr|ZDW",1221=>"DHrtSMr|SQDW",1222=>"%DHrtSMr|SQDW",1223=>"%",1224=>"|",1225=>"MIZPQD|IMIQD",1226=>"frMQnSJB",1227=>"HrMPMnZJ",1228=>"fMJQnZIQ",1229=>"fYHSB",1230=>"ZGGJMWZtMHn~HWtQt+DtrQZI",1231=>"fMS",1232=>"Fmjqms",1233=>">",1234=>"ftBGQ",1235=>"fDMAQ",1236=>"DtZtuD",1237=>"HK",1238=>"fZMJ",1239=>"FUNw|mNwjUsqd|gzTo",1240=>"funW|trZnDJMt`GOG",1241=>"``",1242=>"`",1243=>"~*;Z+Az+a0+9|`+&~",1244=>'~}*0+9\`&-{? }*Z+A&[{~M',1245=>"y",1246=>"k",1247=>"i",1248=>"p",1249=>"T",1250=>"g",1251=>"SQIH|IHSQ",1252=>"uGJHZS|SMDZYJQS|SQIH",1253=>"IZx|uGJHZS|DMAQ",1254=>"uGJHZS|IZx|fMJQDMAQ",1255=>'SMDZYJQ|QrrHr|IZMJ',1256=>'tIG|nZIQ',1257=>"UnZYJQ?tH?uGJHZS?fMJQ?*",1258=>'PMf',1259=>'LGP',1260=>'GnP',1261=>'DCf',1262=>'YIG',1263=>'tMff',1264=>'CYIG',1265=>'xYI',1266=>"DMIGJQ|MIZPQD|Qxt",1267=>"ZJJHCQS|MIZPQD|Qxt",1268=>"mIZPQ?uGJHZS?QrrHr!?unDuGGHrtQS?MIZPQ?tBGQ?",1269=>'DtrMG|DtrMnPD|YB|CHrSD',1270=>'?',1271=>'```',1272=>"#DGQW|IZrK?nZIQ=",1273=>"@#~DGQW|IZrK@",1274=>"#DGQW|IZrK|?nZIQ=",1275=>"@#~DGQW|IZrK|@",1276=>"nHt|WJQZr|JMnKD",1277=>"DGQW|YJHWKD|unMEuQ",1278=>"*|nZIQ|&",1279=>"*|WHntQnt|&",1280=>"ZJJ",1281=>"SZtQfHrIZt|",1282=>"sZtQ?fHrIZt?MD?unKnHCn%?*",1283=>"&```",1284=>"sZtQ?fHrIZt?MD?nHt?DQt?fHr?JZnPuZPQ%?*",1285=>"WHnf|StMIQ",1286=>"GOG|StMIQ",1287=>"SY|StMIQ",1288=>"GOG|tMIQ",1289=>"SY|tMIQ",1290=>'DBDtQI',1291=>'rQDtrMWt|CQY|ZWWQDD|YB|rMPOtD',1292=>'CQY|ZWWQDD|IHS|MS',1293=>"DtHG|uDQ|DuYJMnKD",1294=>"DtHG|ZrP|SQGQnSQnWQ",1295=>'ZSIMn|IQnu|WZGtMHn',1296=>'DtHG|ZrP|nZIQD',1297=>"DtHG|ZrP|nZIQD",1298=>"|DuYJMnK",1299=>"~",1300=>"+~",1301=>"nZv|SZtZ",1302=>" ",1303=>"=",1304=>"]",1305=>'IuJtM|uDQr',1306=>'MS',1307=>'ZWtMHn',1308=>'DtZtuD',1309=>'MtQI|nuIYQr',1310=>'HrSQr|MS',1311=>'ZIM|') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header(I1060);die(I1061.__FILE__.I1062.__LINE__);} class CMS_Base {public $Debug; public $IIIlLLl; public $Owner; public $Side; public $ActivePage; public $IILlIlI; public $ActiveScript; public $ActiveModule; public $IILlIll; public $Vars; public $VarsGet; public $VarsPost; public $VarsCookie; public $IILlIlL; public $StatusMsgs; public $Options; public $Module; public $IILlIl1; public $Messages; public $IILlILI; public $IIIlLLL; public $IIIlLL1; public $DFMT; public $SetsTemplate; public $IILlILl; public $IILlILL; public $Core; public $Pager; public $Gui; public $IILlIL1; public $IILlI1I; public $WorkingModuleName; public $SuppressStatusErrors; public $IILlI1l; public $IILlI1L; public $IILlI11; public $IILllII; public $IILllIl; public $IILllIL; public $IILllI1; public $lang; public $sourceGET; public $IILlllI; function CMS_Base(&$IIIl1II, $IIIl1Il =I1063, $IILllll =false){ global $ROOT_PATH_WWW; $this->Debug =false; $this->lang =I1064; $this->lang_data =I1064; $this->langnames =Array(I1064=>I1065,I1066=>I1067); $this->IIIlLLl =I1068; $this->Owner =false; $this->Side =I1069; $this->ActivePage =I1063; $this->ActiveScript =I1063; $this->ActiveModule =I1063; $this->WorkingModuleName =I1063; $this->IILlIll =false; $this->Vars =array(); $this->VarsGet =array(); $this->VarsPost =array(); $this->VarsCookie =array(); $this->IILlIlL =array(); $this->Options =array(); $this->Module =false; $this->PManager =false; $this->IILlIl1 =array(); $this->StatusMsgs =Array(); $this->SysStatusMsgs =Array(); $this->Messages =Array(); $this->IILlILI =Array(); $this->IIIlLLL =I1070; $this->IILlILL =I1063; $this->IILlIL1 =0; $this->IILlI1I =Array(); $this->SuppressStatusErrors =false; $this->IIIlLL1 =Array( I1071 => I1072, I1073 => I1074, I1069 => I1075, I1076=>I1077 );$this->DFMT =Array( I1078 => I1079, I1080 => I1081, I1082 => I1083 );$this->Core =&$IIIl1II; $this->Init(); if($this->Core->IsOwnerInstalled(I1084)){ $this->PManager =&$this->Core->GetModule(I1085); }if(RUN_UPDATE){ require_once $GLOBALS[I1086] .I1087; $this->Gui =new guiUpdater($ROOT_PATH_WWW, $IIIl1Il, $this->Core->issetAndTrueOption(I1088), $IILllll); }else{ $this->Gui =AMI_Registry::get(I1089, false); if(!$this->Gui){ $this->Gui =new gui($ROOT_PATH_WWW, $IIIl1Il, $this->Core->issetAndTrueOption(I1088), $IILllll); AMI_Registry::set(I1089, $this->Gui); }}$IILlllL =$this->Core->GetAOption(I1090); array_splice($IILlllL, count($IILlllL), 0, $this->Core->GetAOption(I1091)); $this->Gui->langs =array_unique($IILlllL); if(!$this->Core->TTlIlll()){ $this->Gui->urlVersionParam =I1092; }$this->Gui->ll1IlIl =$this->Core->GetOption(I1093); $this->Gui->InstalledCE =$this->Core->GetProperty(I1094); $this->Pager =new Browser($this); $vMod =&$this->Core->TTlIllT(); $vMod->InitPager($this->Pager); if(defined(I1095) && IS_FIRST_START_STEP2 === 1) {$IILlll1 =$this->Core->getVersion(I1096, I1097); $this->Core->WriteOption(I1096, I1098, $IILlll1); $this->Core->WriteOption(I1099, I1100, 2); $this->Gui->doImportIfRequired(true); }}function constructorPostActions(){ if($this->Side != I1101){ $this->Gui->addStyle(I1102); }$this->Gui->addBlock(I1103, I1104); $this->IIIlLL1[I1071] =$this->Gui->getAbs(I1105,I1063); $this->IIIlLL1[I1073] =$this->Gui->getAbs(I1106,I1063); $this->IIIlLL1[I1069] =$this->Gui->getAbs(I1107,I1063); $this->IIIlLLL =$this->Gui->getAbs(I1108,I1063); $this->IIIlLL1[I1076] =$this->Gui->getAbs(I1103,I1063); $this->Gui->addBlock(I1109, I1110); TlT1Il1($this->Gui, $this->Pager); $this->IILlI1l =false; $this->IILlI1L =false; $this->IILlI11 =array(); $this->IILllI1 =false; $this->IILllII =$this->Core->GetOption(I1111); $this->IILllIl =$this->Core->GetOption(I1112); $this->IILllIL =$this->Core->GetOption(I1113); }function Init(){ $this->Options =$this->Core->GetOption(); $IILllLI =$this->Core->GetProperty(I1114); foreach($IILllLI as $vName=>$vVal){ $IILllLI[$vName][I1115] =I1116; $IILllLI[$vName][I1117] =0; }$IILllLl =$this->Core->TTllTIT(array(I1114)); foreach($IILllLl as $vModName=>$aOptions){ $isInstalled =($this->Core->IsInstalled($vModName))?1:0; $IILllLL =false; if(isset($aOptions[I1114])){ $IILllLL =true; $aNames =$aOptions[I1114]; foreach($aNames as $vName) {$IILllLI[$vName] =array(I1118=>I1119, I1120 => $vName, I1115 => $vModName, I1117 => $isInstalled); }}}$this->Core->SetProperty(I1114, $IILllLI); $this->HtmlAreaFields =$this->Core->GetProperty(I1121); $this->AllowedLangs =$this->Options[I1090]; $this->langnames =$this->Options[I1122]; $this->SetSpecialBlock(I1123, I1063); return true; }function TTITT1l($moduleName, $IILllL1 =false){ $this->WorkingModuleName =$moduleName; if(defined(I1124) && !$IILllL1) $this->Gui->startWorkingModule($moduleName); }function getWorkingModuleName(){ return $this->WorkingModuleName; }function stopWorkingModule(&$cContent){ }function InitFromObject(&$cms, &$obj) {$this->setLang($cms->lang_data); $this->lang_data =$cms->lang_data; $this->Gui->lang_data =$cms->lang_data; $this->IILlIll =$cms->IILlIll; $this->Vars =$cms->Vars; $this->VarsGet =$cms->VarsGet; $this->VarsPost =$cms->VarsPost; $this->VarsCookie =$cms->VarsCookie; if(is_object($obj)) {$this->Module =&$obj; }else {$this->Module =&$this->Core->GetModule($obj); }$this->FrontScript =$cms->ActiveScript; $IILll1I =Array( I1125 => $cms->ActiveScript, I1126 => $cms->lang_data );$IILll1I += $cms->Gui->getGlobalVars(); $this->Gui->addGlobalVars($IILll1I); }function TTITT11($aFields) {$this->HtmlAreaFields =$aFields; }function TTITITT() {return $this->HtmlAreaFields; }function TTITITI(&$vars, $IILll1l=false, $IILll1L){ return $this->_PrepareVars($vars, $IILll1l, $IILll1L); }function PrepareVars(){ global $_TMPGET, $ROOT_PATH_WWW, $cookieId, $cookieData; if($this->IILlIll){ return false; }$IILll11 =I1063; if($this->Side==I1127){ $IILll11 =I1128; }$this->Vars =array(); if(isset($_POST)){ $this->TTIT1T1($_POST); $IILlLII =$this->_PrepareVars($_POST); $this->VarsPost =$_POST; $this->Vars += $IILlLII; }if(isset($_GET)){ $this->TTIT1T1($_GET); $IILlLII =$this->_PrepareVars($_GET); $this->VarsGet =$this->TTITITl($_GET); $this->Vars += $this->TTITITl($IILlLII); }if(isset($_TMPGET)){ $this->TTIT1T1($_TMPGET); $IILlLII =$this->_PrepareVars($_TMPGET); $this->sourceGET =$IILlLII; $this->VarsGet += $this->TTITITl($_TMPGET); $this->Vars += $this->TTITITl($_TMPGET); }if(isset($_COOKIE)){ if($this->Core->GetOption(I1129) && $this->Core->Side==I1130) {$oServerCookie =AMI::getSingleton(I1131); $cookieData =$oServerCookie->getCookieData(); $_COOKIE += $oServerCookie->getVarsCookie(); }$IILlLII =$this->_PrepareVars($_COOKIE, $this->Core->GetProperty($IILll11.I1132)); $this->VarsCookie =$_COOKIE; $this->Vars += $IILlLII; if($this->Core->GetOption(I1129) && $this->Core->Side==I1130) {AMI::getSingleton(I1131)->onPrepareVars(); }}$aEvent =array( I1133 => &$this->Vars, I1134 => &$this->VarsGet, I1135 => &$this->VarsPost, I1136 => &$this->VarsCookie );AMI_Event::fire(I1137, $aEvent, AMI_Event::MOD_ANY); $this->IILlIll =true; }function _PrepareVars(&$vars, $IILlLIl=false, $IILll1L =false){ $res =array(); $IILlLIL =false; $IILlLI1 =array(); if($IILlLIl!==false) {foreach($IILlLIl as $tmpName){ $IILlLlI =mb_strlen($tmpName); $IILlLll =mb_strpos($tmpName, I1138); if($IILlLll!==false && ($IILlLll==($IILlLlI-1))){ $IILlLIL =true; $IILlLI1[]=mb_substr($tmpName,0,$IILlLll); }}}reset($vars); foreach($vars as $vName => $IILlLlL){ $skip =false; if($IILlLIl!==false) {if(!in_array($vName, $IILlLIl)){ $skip =true; if($IILlLIL){ foreach($IILlLI1 as $IILlLl1){ $IILlLll =mb_strpos($vName, $IILlLl1); if($IILlLll!==false && $IILlLll==0) $skip =false; }}}if($skip){ if($this->Debug){ echo I1139.$vName.I1140; }}}$needAddSlashes =$GLOBALS[I1141] || $IILll1L; if(in_array($vName, $this->HtmlAreaFields)){ $IILlLlL =$this->TTITIT1($IILlLlL); if($needAddSlashes) {$IILlLlL =$this->htmlchars($IILlLlL, I1142); }}else {$type =($needAddSlashes) ?I1143 :I1144; $IILlLlL =$this->htmlchars($IILlLlL, $type); }if(is_string($IILlLlL) && mb_strpos($IILlLlL, I1145) === 0){ trigger_error(I1146 .$vName .I1147, E_USER_WARNING); do{ $IILlLlL =mb_substr($IILlLlL, 2); }while(mb_strpos($IILlLlL, I1145) === 0); }$res[$vName] =$IILlLlL; $vars[$vName] =$IILlLlL; }return $res; }function TTITITl($aData){ foreach($aData as $key => $value){ if(strncasecmp($key, I1148, 4) == 0){ $aData[mb_substr($key, 4)] =$value; }}return $aData; }function htmlchars($cStr, $type =I1144){ $IILlLLI =I1149; switch($type) {case I1142: $IILlLLI =I1150; break; case I1143: $IILlLLI =I1151; break; }if(is_array($cStr)){ foreach($cStr as $key => $value) {$res[$key] =$this->htmlchars($value); }}else {$res =$this->{$IILlLLI}($cStr); }return $res; }function _htmlcharsCB($cStr){ $res =htmlspecialchars($cStr); $res =str_replace(Array(I1152, I1153, I1154), Array(I1155, I1156, I1157), $res); return $res; }function _addSlashesCB($cStr){ return addslashes($cStr); }function _htmlcharsAndAddSlashesCB($cStr){ $res =$this->_htmlcharsCB($cStr); $res =addslashes($res); return $res; }function TTITIT1($cStr){ $res =$cStr; $res =str_replace(Array(I1158), Array(I1159), $res); return $res; }function TTITIIT($cStr){ $res =$cStr; $res =str_replace(Array(I1159), Array(I1158), $res); return $res; }function TTITIII($cType){ $res =$this->IIIlLL1[$cType]; if(empty($res)) $res =$this->IIIlLL1[I1069]; return $res; }function InitMessages($IILlLLl, $IILlLLL =false){ if($IILlLLL){ $this->IILlILI =$IILlLLl; }else{ $this->Messages =$IILlLLl; }}function AddMessages($IILlLLl, $IILlLLL =false){ if($IILlLLL){ $this->IILlILI += $IILlLLl; }else{ $this->Messages += $IILlLLl; }}function ClearMessages(){ $this->StatusMsgs =array(); }function TTITIIl($IIl11LL, $IILlLLL=false) {if($IILlLLL) {$res =isset($this->IILlILI[$IIl11LL]); }else {$res =isset($this->Messages[$IIl11LL]); }return $res; }function AddStatusMsg($IIl11LL, $cType =I1063, $IILlLL1 =I1063, $IILlL1I =I1063, $IILlL1l =Array(), $IILlLLL=false){ $res =I1063; if(empty($cType) || !array_key_exists($cType, $this->IIIlLL1)) $cType =I1069; if($IILlLLL){ $IILlL1L =&$this->IILlILI; $IILlL11 =&$this->SysStatusMsgs; }else{ $IILlL1L =&$this->Messages; $IILlL11 =&$this->StatusMsgs; }if(AMI_Registry::get(I1160, FALSE) === TRUE){ $IILl1II =AMI_Registry::get(I1161, array()); if(!in_array($IIl11LL, $IILl1II)){ $IILl1II[] =$IIl11LL; $oRequest =AMI::getSingleton(I1162); $oResponse =AMI::getSingleton(I1163); $IILl1Il =($cType == I1164) ?AMI_Response::STATUS_MESSAGE_ERROR :AMI_Response::STATUS_MESSAGE; if($oRequest->get(I1165, FALSE) == I1166){ if($IILl1Il == AMI_Response::STATUS_MESSAGE){ $oResponse->setMessage(I1167, AMI_ModForm::SAVE_SUCCEED); }else{ $oResponse->setMessage(I1168, AMI_ModForm::SAVE_FAILED); }}$oResponse->addStatusMessage($IIl11LL, $IILlL1l, $IILl1Il); AMI_Registry::set(I1161, $IILl1II); }}else{ if(!isset($IILlL1L[$IIl11LL]) && !$this->SuppressStatusErrors) trigger_error("Unknown message type [$IIl11LL]...", E_USER_WARNING); }$message =$IILlL1L[$IIl11LL]; foreach($IILlL1l as $key=>$value){ $message =mb_ereg_replace(I1169.$key.I1169, $value, $message); }$res =$message; $aMsg =Array(I1170 => $IILlLL1.$message.$IILlL1I, I1171 => $cType); if(!in_array($aMsg, $IILlL11)) {$IILlL11[] =$aMsg; }$this->SetSpecialBlock(I1123, $this->GetStatusMessages()); return $res; }function getStatusMsgArrays(&$sys,&$plain) {$sys =$this->SysStatusMsgs; $plain =$this->StatusMsgs; }function TTITII1(&$dest,$src) {foreach($src as $IILl1IL) {$add =true; foreach($dest as $IILl1I1) if($IILl1IL[I1172]==$IILl1I1[I1172]) {$add =false; break; }if($add) $dest[] =$IILl1IL; }}function TTITIlT($sys,$plain) {$this->TTITII1($this->SysStatusMsgs,$sys); $this->TTITII1($this->StatusMsgs,$plain); }function GetStatusMessages(){ $res =I1173; $IILl1lI =array_merge($this->SysStatusMsgs, $this->StatusMsgs); foreach($IILl1lI as $msg){ if($msg[I1172]){ $this->TTITIlI($msg[I1172]); $IILl1ll =preg_match(I1174, $msg[I1172]); if(!empty($res) && !$IILl1ll){ $res .= $this->IIIlLLL; }$msg =$IILl1ll ?$msg[I1172] :str_replace(I1175, $msg[I1172], $this->TTITIII($msg[I1176])); $res .= $msg; }}$res =str_replace(I1177, $res, $this->TTITIII(I1178)); return $res; }public function TTITIlI(&$message){ if (preg_match_all(I1179, $message, $matches)) {foreach ($matches[0] as $k => $v) {$IILl1lL =str_replace( array(I1180, I1181, I1182, I1183), array(I1184, I1185, I1186, I1187), $matches[1][$k] );$message =str_replace($v, I1188 .$IILl1lL .I1189, $message); }}}function TTITIll(&$aData, $level=1){ $res =I1063; if(is_array($aData)){ $margin =str_repeat(I1190, $level); $res .= I1191; foreach($aData as $vName=>$vData){ $res .= $margin."[$vName]=>".$this->TTITIll($vData, $level+1).I1181; }$res .= $margin.I1192; }else{ $res =$aData; }return $res; }function TTITIl1($IIILLII, $IIl11LL, $IILl1l1 =0, $IILl1LI =I1063, $aData =I1063){ $db =new DB_Si; $IILl1Ll =$this->TTITIll($aData); $aSql =array( I1193=>I1194, I1195=>$IIILLII, I1196=>$IIl11LL, I1197=>$IILl1l1, I1198=>$IILl1LI, I1199=>$IILl1Ll );$sql =$db->genInsertSQL(I1200, $aSql); $db->query($sql); return $db->num_rows(); }function TTITI1T($cBlockName, $IILl1LL =I1201, $IILl1L1 =I1202){ $aNone =Array(); return $this->TTITI1I($cBlockName, $aNone); }function TTITI1I($cBlockName, &$aWords, $IILl11I =I1203, $IILl1LL =I1201, $IILl1L1 =I1202){ $res =Array(); if(!$this->Module->TTlT1IT($this->Pager->SortCol)){ $this->Pager->SortCol =$this->Module->GetOption(I1204); }$IILl11l =$this->Module->TTlT1T1(); $IILl11L =$this->Module->TTlT1II(); $aNames =Array(I1205=>$IILl1LL, I1206=>$IILl1L1); $res[I1207] =I1063; $res[I1208] =I1063; $IILl111 =Array(); $IILLIII =null; foreach( $IILl11l as $IILLIIl ){unset($IILLIIL); $IILLIIL[I1209] =$IILLIIl; $IILLIIL += $aNames; if(isset($aWords[$IILl11I.$IILLIIl])) {$IILLIIL[I1210] =$aWords[$IILl11I.$IILLIIl]; }$IILLIII =I1063; $IILLII1 =I1063; $IILLIlI =I1063; if($this->Pager->SortCol == $IILLIIl) {$IILLIlI =I1211; if($this->Pager->SortDim == I1212) $IILLII1 =I1211; else $IILLIII =I1211; $IILl111 =$IILLIIL; }$res[I1203.$IILLIIl] =I1063; if(!isset($IILl11L[$IILLIIl]) || !($IILl11L[$IILLIIl] &_srt_noASC) ){$res[I1203.$IILLIIl] .= $this->Gui->get($cBlockName.I1213.$IILLIII, $IILLIIL); }if(!isset($IILl11L[$IILLIIl]) || !($IILl11L[$IILLIIl] &_srt_noDESC) ){$res[I1203.$IILLIIl] .= $this->Gui->get($cBlockName.I1214.$IILLII1, $IILLIIL); }$IILLIIL[I1215] =$res[I1203.$IILLIIl]; $res[I1208] .= $res[I1203.$IILLIIl]; $res[I1207] .= $res[I1216.$IILLIIl] =$this->Gui->get($cBlockName.I1217.$IILLIlI, $IILLIIL); }if($this->Pager->SortDim == I1212) $IILLII1 =I1211; else $IILLIII =I1211; $IILl111[I1209] =I1218; $res[I1219] =$this->Gui->get($cBlockName.I1220.$IILLIII, $IILl111); $IILl111[I1209] =I1212; $res[I1221] =$this->Gui->get($cBlockName.I1222.$IILLII1, $IILl111); return $res; }function TTITI1l($IILLIll, $IILLIlL, $IILLIl1=I1063, $IILLILI=I1063, $IILLILl=false){ $res =I1063; if(isset($this->SetsTemplate)&&!empty($this->SetsTemplate)){ if(!$IILLILl || is_array($IILLIl1) || !empty($IILLIl1)) {$Name =empty($IILLILI)?$IILLIlL:$IILLILI; $Values =$IILLIl1; if(!is_array($IILLIl1)){ $Values =Array(); $Values[$Name] =$IILLIl1; }if(empty($IILLIll)){ $vSet =I1063; }else{ $vSet =I1223.$IILLIll.I1224.$IILLIlL; }$res =$this->Gui->get($this->SetsTemplate.$vSet, $Values); }}return $res; }function ReadFileExtended($cPath, $cName, $IILLILL, $IILLIL1=I1063){ $res =Array(); $imgTypes =$this->Core->GetProperty(I1225); $res[I1226] =$IILLILL; if(!empty($IILLIL1)) $res[I1226] =$IILLIL1; $res[I1227] =$IILLILL; $res[I1228] =$cName; $fname =$cPath.$cName; $res[I1229] =file_get_contents($fname, false); if($res[I1229] !== false){ if(isset($imgTypes[mb_strtoupper(get_file_ext($fname))])){ $ftype =$imgTypes[mb_strtoupper(get_file_ext($fname))]; }else{ $ftype =I1230; }$res[I1231] =I1232.rand(10,99).I1233.uniqid(I1063); $res[I1234] =$ftype; $res[I1235] =@filesize($fname); $res[I1236] =I1237; }else{ $res[I1236] =I1238; unset($res[I1229]); }return $res; }function TTITI11($fname) {require_once($GLOBALS[I1239].I1240); $res =cms_transliterate($fname, $this->lang_data); while(mb_strpos($res, I1241)!==false){ $res =str_replace(I1241, I1242, $res); }$res =preg_replace(I1243, I1224, $res); return $res; }function ConvertToBytes($string) {if (preg_match(I1244, $string, $matches)) {$number =$matches[1]; $suffix =$matches[2]; $IILLI1I =array(I1063=> 0, I1245=>0, I1246=>1, I1247=>2, I1248=>3, I1249=>4, I1250=>5); if (isset($IILLI1I[$suffix])){ $bytes =round($number *pow(1024, $IILLI1I[$suffix])); return $bytes; }else {return false; }}else {return false; }}function doUploadFile($IILLI1l, $IILLI1L, $IILLI11 =0666){ $res =false; if($this->Core->GetOption(I1251)){ $this->AddStatusMsg(I1252, I1071, I1063, I1063, array(), true); return $res; }$IILLlII =$this->Core->GetOption(I1253); $IILLlIl =$IILLlII; if(!isset($IILLlII) |$IILLlII<1) $IILLlIl =$this->ConvertToBytes(ini_get(I1254)); AMI_Registry::push(I1255, true); $fsize =@filesize($IILLI1l[I1256]); if( ($fsize <$IILLlIl) && ($fsize >0) && is_uploaded_file($IILLI1l[I1256]) ){if(!@move_uploaded_file($IILLI1l[I1256], $IILLI1L)){ trigger_error(I1257.$IILLI1l[I1256]."] into [$IILLI1L]: $php_errormsg", E_USER_WARNING); }else{ @chmod($IILLI1L, $IILLI11); $res =true; }}else{ trigger_error("Upload error, bad size [$fsize] or Hack attempt ".$IILLI1l[I1256].": $php_errormsg", E_USER_WARNING); }AMI_Registry::pop(I1255); return $res; }function doUploadImage($IILLI1l, $IILLI1L, $simple =false){ $res =false; if($this->Core->GetOption(I1251)){ $this->AddStatusMsg(I1252, I1071, I1063, I1063, array(), true); return $res; }$IILLlIL =array( 1 => I1258, 2 => I1259, 3 => I1260, 4 => I1261, 6 => I1262, 7 => I1263, 8 => I1263, 13 => I1261, 15 => I1264, 16 => I1265 );$imgData =getimagesize($IILLI1l[I1256]); if(isset($IILLlIL[$imgData[2]])){ $extension =$IILLlIL[$imgData[2]]; if($simple) {$aExts =$this->Core->GetProperty(I1266); }else {$aExts =$this->Core->GetProperty(I1267); }if (in_array($extension, $aExts) ){$res =$this->doUploadFile($IILLI1l, $IILLI1L); }else{ AMI_Registry::push(I1255, true); trigger_error(I1268.$IILLI1l[I1256], E_USER_WARNING); AMI_Registry::pop(I1255); }}return $res; }function TTITlTT($IILLlI1, $cPath =I1063){ $res =false; if( !empty($IILLlI1) )if(!@unlink($cPath.$IILLlI1)){ trigger_error("Unable to delete file '{$cPath}{$IILLlI1}': {$php_errormsg}", E_USER_WARNING); }else{ $res =true; }return $res; }function TTITlTI($IILLlI1, $IILLllI, $cPath =I1063, $IILLI11 =0666){ $res =false; if($this->Core->GetOption(I1251)){ $this->AddStatusMsg(I1252, I1071, I1063, I1063, array(), true); return $res; }if( !empty($IILLlI1) )if(!@rename($cPath.$IILLlI1, $cPath.$IILLllI)){ trigger_error("Unable to rename file $cPath$IILLlI1 to $cPath$IILLllI: $php_errormsg", E_USER_WARNING); }else{ @chmod($cPath.$IILLllI, $IILLI11); $res =true; }return $res; }function TTITlTl($IILLlI1, $IILLllI, $cPath =I1063, $IILLI11 =0666, $move =FALSE){ $res =false; if( !empty($IILLlI1) )if(!($move ?@rename($cPath .$IILLlI1, $cPath .$IILLllI) :@copy($cPath .$IILLlI1, $cPath .$IILLllI))){ trigger_error("Unable to copy file $cPath$IILLlI1 to $cPath$IILLllI: $php_errormsg", E_USER_WARNING); }else{ @chmod($cPath.$IILLllI, $IILLI11); $res =true; }return $res; }function stripLine($IILLlll, $IILLllL, $IILLll1 =false){ $IILLlLI =$this->Core->GetOption(I1269); $s =strip_tags($IILLlll); if($IILLll1){ $s =unhtmlentities($s); }if(mb_strlen($s) >$IILLllL){ if($IILLlLI){ $s =mb_substr($s, 0, $IILLllL -3); if(mb_substr($s, $IILLllL -4, 1) != I1270){ $last =mb_strrpos($s, I1270); if($last !== false){ $s =mb_substr($s, 0, $last); }}$s =rtrim($s) .I1271; }else{ $s =rtrim(mb_substr($s, 0, $IILLllL -3)) .I1271; }}if($IILLll1){ $s =$this->htmlchars($s); }return $s; }function SetSpecialBlock($cName, $cContent, $IILLlLl =true){ if(EventApplyVars($this, $cName, $cContent)){ if($IILLlLl) {$this->IILlIlL[$cName] =I1272.$cName.I1273.$cContent.I1274.$cName.I1275; }else {$this->IILlIlL[$cName] =$cContent; }}return true; }function TTITlT1($cName, $cContent){ unset($this->IILlIlL[$cName]); return true; }function TTITlIT($cName){ return isset($this->IILlIlL[$cName]); }function TTITlII($cName){ return $this->IILlIlL[$cName]; }function TTITlIl($cName){ $res =$this->IILlIlL[$cName]; if(!$this->Core->issetAndTrueOption(I1276)){ TlT1T1I($res); }return $res; }function TTITlI1(){ return $this->IILlIlL; }function TTITllT(){ $res =array_keys($this->IILlIlL); return $res; }function TTITllI(){ $res =array(); $IILLlLL =$this->Core->GetOption(I1277); foreach($this->IILlIlL as $vName => $IILlLlL ){if(in_array($vName, $IILLlLL)){ $res[] =$vName; }}return $res; }function TTITlll($cName, $IILLlL1){ $IILLl1I =array(I1278, I1279); if($cName!=I1280 && isset($this->IILlIlL[$cName])){ $IILLl1l =array($cName, $this->IILlIlL[$cName]); $this->IILlIlL[$cName] =str_replace($IILLl1I, $IILLl1l, $IILLlL1); }else{ foreach($this->IILlIlL as $vName=>$vData){ $IILLl1l =array($vName, $this->IILlIlL[$vName]); $this->IILlIlL[$vName] =str_replace($IILLl1I, $IILLl1l, $IILLlL1); }}return true; }function TTITll1(&$IILLl1L, &$IILLl11){ return true; }function TTITl1T($cLang){ return $this->langnames[$cLang]; }function TTITl1I($lang){ if($this->IILlILL!=$lang){ $optName =I1281.$this->Side; if(!$this->Core->issetOption($optName)){ trigger_error(I1282.$IILLLII.I1283, E_USER_WARNING); }$IILLLIl =$this->Core->GetOption($optName); if(!isset($IILLLIl[$lang])){ trigger_error(I1284.$lang.I1283, E_USER_WARNING); }$dfmt =$IILLLIl[$lang]; $this->DFMT[I1078] =DateTools::getJustDateFormat($dfmt); $this->DFMT[I1285] =$dfmt; $this->DFMT[I1080] =DateTools::conf2phpFormat($this->DFMT[I1078]); $this->DFMT[I1082] =DateTools::php2mysqlFormat($this->DFMT[I1080]); $this->DFMT[I1286] =DateTools::conf2phpFormat($this->DFMT[I1285]); $this->DFMT[I1287] =DateTools::php2mysqlFormat($this->DFMT[I1286]); $this->DFMT[I1288] =DateTools::conf2phpFormat($this->DFMT[I1285], true); $this->DFMT[I1289] =DateTools::php2mysqlFormat($this->DFMT[I1286], true); $this->IILlILL =$lang; }}function setLang($lang){ $this->TTITl1I($lang); $this->Gui->_setLang($lang); $this->lang =$lang; }function TTITl1l($userId =FALSE){ if($userId === FALSE){ $userId =$this->Core->GetUserId(); }$aOwners =$this->Core->TTllII1($userId); $aModules =$this->Core->TTllIIl($userId); $IILllLl =&$this->Core->GetAllModules(); foreach($IILllLl as $name => $vMod){ if($vMod->HaveParent()){ continue; }if(!in_array($name, $aModules) && $vMod->GetOwnerName() != I1290){ if( $IILllLl[$name]->issetAndTrueProperty(I1291) && AMI_Registry::get(I1292, FALSE) !== $name ){$IILllLl[$name]->setAdminAllowed(FALSE); continue; }$IILllLl[$name]->SetInstalled(false); }}$vOwners =&$this->Core->GetOwnersList(); foreach($vOwners as $name => $vOwner){ if(!in_array($name, $aOwners) && $name != I1290){ $this->Core->SetOwnerInstalled($name, false); }}return TRUE; }function TTITl11($IILLLIL) {$this->IILlIL1 =$IILLLIL; }function TTIT1TT() {return $this->IILlIL1; }function getStopArgModName($IIIL1LL) {$modName =I1063; $IILLLI1 =&$this->Core->GetModule($IIIL1LL); if(!$IILLLI1){ return I1173; }for($i=0;$i<10;$i++) {if($IILLLI1->issetProperty(I1293)) {$modName =$IILLLI1->GetName(); break; }elseif($IILLLI1->issetOption(I1294)) {$IILLLlI =$IILLLI1->getOption(I1294); $IILLLI1 =&$this->Core->GetModule($IILLLlI); }else {$vMod =&$IILLLI1->TTlIIIT(); if(!is_object($vMod)){ $vMod =&$IILLLI1; if($vMod->issetProperty(I1293)) {$modName =$vMod->GetName(); }break; }else {$IILLLI1 =&$vMod; }}}return $modName; }function TTIT1TI(&$aData) {return array_push($this->IILlI1I, $aData); }function TTIT1Tl() {return array_pop($this->IILlI1I); }function GetModHeader($IILLLll, $IILIlI1 =I1295, $IILLLlL =I1173) {$res =$IILLLll; if(!is_string($IILLLll)) {if(is_object($IILLLll)) {$res =$IILLLll->issetOption($IILIlI1) ?$IILLLll->GetOption($IILIlI1): $IILLLlL; }if(is_array($res)) {$res =$res[$this->lang]; }}return $res; }function InitNavSettings($IIILLII =I1063){ $this->IILlI1l =false; if($IIILLII!=I1063){ $vMod =&$this->Core->GetModule($IIILLII); }else{ $vMod =&$this->ActiveModule; }$this->IILlI1L =$vMod->GetProperty(I1293) && $this->IILllII; $this->IILlI11 =$vMod->issetOption(I1296) ?array_keys($vMod->GetAOption(I1297)) :array ();$this->IILllI1 =true; }function ApplyNav(&$aNavData){ if(!$this->IILllI1) $this->InitNavSettings(); if($this->IILlI1L){ $aNav =array(); $sNav =I1063; $rNames =array_reverse($this->IILlI11); $found =false; foreach($rNames as $vName){ $vVal =I1063; if(isset($aNavData[$vName])){ $vVal =$aNavData[$vName]; if(isset($aNavData[$vName.I1298]) && $aNavData[$vName.I1298]!==I1063){ $vVal =$aNavData[$vName.I1298]; }$sNav =$vVal.(($found)?I1299:I1063).$sNav; $found =true; }else {$sNav =(($found)?I1300:I1063).$sNav; }}if($found){ $aNav[I1301] =I1299.$sNav.I1302; }else{ $aNav[I1301] =I1302; }}else{ $aNav =array(I1301=>I1302); $sNav =I1063; foreach($this->IILlI11 as $vName){ $sNav .= $vName.I1303.$aNavData[$vName].I1304; }$aNav[I1301] =$aNav[I1301].$sNav; }return $aNav+$aNavData; }function PushFrontSettings(&$db, $langData) {$this->Core->Side =I1130; DB_si::globalAttr(I1305, true); $db->ILlllll =false; $this->IILlllI =$this->Core->GetUserId(); $this->Core->TTlIlIl(is_object($this->Member) ?$this->Member->GetUserInfo(I1306) :0); $this->Core->TTllI1I($langData, true); }function PopFrontSettings(&$db, $langData) {$this->Core->Side =I1101; DB_si::globalAttr(I1305, false); $db->ILlllll =false; $this->Core->TTlIlIl($this->IILlllI); $this->Core->TTllI1I($langData, false); }protected function TTIT1T1(array &$aVars){ if($this->Side == I1101){ foreach(array( I1307, I1308, I1309, I1310 )as $name){ if(isset($aVars[I1311 .$name])){ $aVars[$name] =$aVars[I1311 .$name]; }}}return $aVars; }}