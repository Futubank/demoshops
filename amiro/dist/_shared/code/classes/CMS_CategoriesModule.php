<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       12040 xkqwxgguzzxnsssnsumzxpykgslwpwkzxqtrqqunmqutywxglrimlpqprzqtukxwpiuqpnir
 */ ?><?php foreach(array(1394=>"",1395=>"?zd?",1396=>'QxtQnDMHnD',1397=>'Qxt|IHSuJQD|WuDtHI|fMQJSD',1398=>'PrHuG|HGQrZtMHnD',1399=>'PQn|KQBCHrSD',1400=>"SZtQfrHI",1401=>"fJt|nZIQ",1402=>'100:',1403=>'SQfZuJt|GrQfMx',1404=>"GuYJMW!?",1405=>"DOHCn|SQtZMJD!?mF}",1406=>"coqRq?1?",1407=>"ZWtMHn",1408=>"Hn",1409=>"DtrMGJMnQ",1410=>"fJZPMWHn",1411=>"Hff",1412=>"|JMDt%SQJ|WZt",1413=>'HYLQWt',1414=>"JQPQnS",1415=>"JQP|YJuQ",1416=>"ZSS",1417=>"dqjqwT?",1418=>"'",1419=>"ZnnHunWQ",1420=>"='",1421=>"WHunt|MtQID",1422=>"YJuQ",1423=>'nZIQ',1424=>"IHSuJQ|nZIQ",1425=>"PQtZJJvZJuQD",1426=>"vZJuQ",1427=>"WZGtMHn",1428=>'ZJJHC|QIGtB') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class CMS_CategoriesModule extends CMS_ActModule {public $IIL1l1l; public $IIL1l1L; public $IIL1l11; public $IIL1LII; public $IIL1LIl; public $IIL1LIL; public $IIL1LI1; function CMS_CategoriesModule(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); $this->IIL1l1l =""; $this->IIL1LII =""; $this->IIL1l1L =I1394; $this->IIL1l11 ="id_cat"; $this->IIL1LIL =I1394; $this->IIL1LI1 =false; }function _Init($IIll1l1 =Array(), $IIll1LI =I1394, $IIll1Ll =I1394, $aOptions =Array()) {$this->IIL1l1l =$this->module->GetTableName(); if(isset($aOptions['default_prefix']) && $aOptions['default_prefix'] != ''){ $this->IIL1LII =I1395.$aOptions["default_prefix"]; }if(is_object($this->module->Ill1llL)) {$this->IIL1l1L =$this->module->Ill1llL->GetTableName(); }if(isset($aOptions["id_cat_field_name"])) {$this->IIL1l11 =$aOptions["id_cat_field_name"]; }if($this->module->issetOption('extensions')){ $aExt =$this->module->GetOption(I1396); $this->IIL1LI1 =in_array('ext_discussion', $aExt) || in_array(I1397, $aExt); unset($aExt); }$this->cms->Gui->addGlobalVars(array ('NUM_ITEMS_COL' => '' .intval(empty($aOptions['disable_items_counter'])))); $IIIIL11 =array (I1398 => array ('publish_on', 'publish_off', 'del', 'gen_sublink', I1399, 'move_position'), 'use_positions' => true );if(in_array('ext_images',$this->cms->Core->GetModOption($this->module->Ill1llL->Name, I1396)) && !isset($aOptions["additional_extensions"])){ $IIIIL11["additional_extensions"] =array('ext_images'); }$IIIIL11['use_details_noindex'] =false; $aOptions += $IIIIL11; $this->TTITTI1( AMI::getResourceModel($this->moduleName .'/table') ->hasField('name') );parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function TTTlIII() {parent::TTTlIII(); if($this->filter->issetField(I1400)) $this->filter->TITI1l1(I1400); if($this->filter->issetField("dateto")) $this->filter->TITI1l1("dateto"); $this->filter->AddField("flt_name", "text", isset($this->cms->Vars[I1401]) ?stripslashes(unhtmlentities($this->cms->Vars[I1401])) :'', I1394, " like ", "name"); $this->filter->MoveField(I1401,_MOVE_START); }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); $vData['form_width'] =I1402; }function TTTlI11(&$vData, &$aCustom) {$select =empty($aCustom['cat_sql']) ?'' :$aCustom['cat_sql']; unset($aCustom['cat_sql']); $pf =$this->options[I1403]; if (empty($aCustom['suppress_cat_sql_init'])) {$this->browser->InitSQL( $pf ."id, " .$pf ."name, " .$pf ."announce, " .$pf .I1404 .$pf ."num_items, " .$pf ."num_public_items" .$select .($this->TTT11ll() ?", " .$pf ."shown_items, " .$pf .I1405 .$pf ."shown_items=0,0," .$pf ."shown_details/" .$pf ."shown_items) as shown_ctr" :I1394), "FROM ".$this->IIL1l1l.$this->IIL1LII, I1406.$this->_ApplyFilters().$this->TTTlIl1(), I1394, $pf ."name" );}else {unset($aCustom['suppress_cat_sql_init']); }$aCustom["fields"] += Array( "public"=>Array(I1407=>"flagicon", "value"=>1, "id"=>"pub_id", I1408=>$this->moduleName."_list:public_on","off"=>$this->moduleName."_list:public_off"), "name"=>Array(I1407=>I1409, "size"=>50), "announce"=>Array(I1407=>I1409, "size"=>150), "action_edit"=>Array(I1407=>I1410, "value"=>I1394, "id"=>"edit_id", I1408=>$this->moduleName."_list:edit",I1411=>I1394), "action_del"=>Array(I1407=>I1410, "value"=>I1394, "id"=>"del_id", I1408=>$this->moduleName.I1412,I1411=>I1394), );if($this->TTT11ll()){ $aCustom['fields']['shown_ctr'] =Array('action'=>'callback', I1413=>&$this, 'method'=>'_advFormatCTRCB'); }$aCustom["applied_id"] =$pf ."id"; $aCustom[I1414] =Array("published", "notpublished", "leg_red", "leg_yellow", I1415, "leg_edit", "leg_del"); $aCustom["form_data"]["buttons"] =Array(I1416, "apply", "cancel", "save"); parent::TTTlI11($vData, $aCustom); }function TTTllTT(&$vData) {$vData["page_is_last"] =($this->browser->getPagesCount() == ($this->browser->getActivePage() +1)); }function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $pf =$this->options[I1403]; $sql =I1417 .$pf ."* FROM ".$this->IIL1l1l.$this->IIL1LII." ". "WHERE " .$pf ."id='".$cId.I1418.$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; $this->itemData["public"] =($this->itemData["public"] == 1) ?"checked": I1394; $this->itemData["announce"] =$this->cms->htmlchars($this->itemData[I1419]); $this->itemData["body"] =$this->cms->htmlchars($this->itemData["body"]); }}function _ActionDel($cId, $cModule) {parent::_ActionDel($cId, $cModule); $sql ="DELETE FROM ".$this->IIL1l1L." WHERE ".$this->IIL1l11.I1420.$cId.I1418; $this->db->query($sql); }function TTT1Tl1($cType, $cModule, $condition ='') {switch($cType) {case "counters": $sql ="UPDATE ".$this->IIL1l1l." SET num_items=0, num_public_items=0 WHERE lang='".$this->langData.I1418; $this->db->execute($sql); $sql =I1417.$this->IIL1l11.", count(id) as count_items, SUM(IF(public !=0, 1, 0)) AS count_public_items FROM ".$this->IIL1l1L." WHERE lang='".$this->langData."' GROUP BY ".$this->IIL1l11; $rs =&$this->db->select($sql); while($record =$rs->nextRecord()) {$sql ="UPDATE ".$this->IIL1l1l." SET num_items='".$record[I1421]."', num_public_items='".$record["count_public_items"]."' WHERE id='".$record[$this->IIL1l11].I1418; $this->db->execute($sql); set_time_limit(30); }$this->cms->AddStatusMsg("status_repair_counters", I1422); break; default: parent::TTT1Tl1($cType, $cModule); }}function TTT1Tll($IIl11II, &$IIl1L1l, $cModule) {$IIl1L1l["num_items"] =0; $IIl1L1l["num_public_items"] =0; parent::TTT1Tll($IIl11II, $IIl1L1l, $cModule); }function TTT1IlI($aSql =array (),$cId =0, $fields =array ('announce', 'body')) {$name =$this->cms->VarsPost[I1423]; if($name != ''){ $public =(int)$this->cms->VarsPost['public']; $aSql += array( $this->options['name_field_name'] => $name, 'public' => $public );foreach ($fields as $field) {$aSql += array($field => $this->cms->VarsPost[$field]); }}$aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function TTT1II1(&$db, &$aParams) {$aParams[I1424] =$this->module->GetParentName(); return parent::TTT1II1($db, $aParams); }function getOptionsModCB($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I =I1425){ if(!is_array($cData["value"])) {if($cData["value"] != I1394) {$cData["value"] =Array($cData["value"]); }else {$cData[I1426] =Array(); }}switch($IIL1l1I){ case I1425: $res =Array(); if(!is_array($this->IIL1LIL)) {$db =new DB_si; $this->IIL1LIL =Array(); $sql ="SELECT id, name FROM ".$this->IIL1l1l.$this->IIL1LII." WHERE 1 ".$this->_ApplyFilters(); $db->query($sql); while($db->next_record()) {$this->IIL1LIL[] =array( "name" => $db->Record["id"], I1427 => $db->Record["name"], "selected" => ((in_array($db->Record["id"], $cData[I1426])) ?"selected" :I1394) );}}$aData[I1428] =true; $res =$this->IIL1LIL; break; case "correctvalue": $aIds =Array(); foreach($this->IIL1LIL as $aData) {$aIds[] =$aData["name"]; }if(is_array($cData[I1426])) {$res =array_intersect($aIds, $cData[I1426]); }else {$res =Array(); }break; case "getvalue": $res =$cData[I1426]; break; }return true; }}