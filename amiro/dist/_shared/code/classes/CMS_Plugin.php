<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       8064 xkqwsyupslqkiusxsxmwkutilyiggxwmtwztqxywxmqniqkrsmxpgiwxukiqrwsqsprppnir
 */ ?><?php foreach(array(2319=>'ZSIMn',2320=>'GJuPMn|IHSuJQ|nZIQ',2321=>'MnDtZJJQS',2322=>"gJuPMn?MD?nHt?MnDtZJJQS`?MS%?",2323=>'FUNw|mNwjUsqd|gzTo',2324=>'WHSQ|MnDtZJJ|GZtO',2325=>'MIP|MnDtZJJ|GZtO',2326=>'WHSQ|GZtO',2327=>'SMDtr|GZtO',2328=>'WZWOQ|J3|QnZYJQ',2329=>'\\',2330=>"YHSB",2331=>'rHHt|GZtO',2332=>'rHHt|GZtO|CCC',2333=>'ZGM|vQrDMHn',2334=>'WHnfMP|GZtO',2335=>'~',2336=>'JZnP',2337=>'OttG|vZrD|PQt',2338=>'ZWtMvQ|IHSuJQ',2339=>"nHnQ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class CMS_Plugin extends CMS_ActModule {public $pluginId; public $pluginMod; public $IlI1lLL; public $IlL1LIl; public $config; function CMS_Plugin(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {if($this->side == I2319) {$this->pluginMod =&$this->cms->Core->GetModule($this->cms->ActivePage); }else {$this->pluginMod =&$this->cms->Core->GetModule($aOptions[I2320]); $this->TTTlTlT($aOptions[I2320], $this->pluginMod); }if(!is_object($this->pluginMod)) {trigger_error("Undefined plugin, page: ".$this->cms->ActivePage, E_USER_ERROR); }$this->pluginId =$this->pluginMod->GetOption('plugin_id'); AMI_ErrorHandler::getInstance()->setPluginId($this->pluginId); if(!$this->pluginMod->issetAndTrueOption(I2321)) {trigger_error(I2322.$this->pluginId, E_USER_ERROR); }$this->config =$this->cms->Core->GetModProperty('plugins_wizard', 'config'); require_once $GLOBALS[I2323] .'func_file_system.php'; foreach (array (I2324, I2325) as $key) {if (!validatePath($this->config[$key])) {trigger_error("FS path hack attempt ({$key})", E_USER_ERROR); }}$path =$this->pluginMod->GetOption('is_copied')? $this->config[I2324].$this->pluginId.'/': $this->pluginMod->GetOption('distr_path').$this->config[I2326].'/'; $this->IlI1lLL =$GLOBALS['ROOT_PATH'] .$path; $this->IlL1LIl =($this->pluginMod->GetOption('is_copied') ?$this->config[I2324] .$this->pluginId .'/' :$this->pluginMod->GetOption(I2327)) .$this->config['templates_path'] .'/'; $this->initialized =true; }function TTTlIT1(&$aCustom, $cType, $IIlLI11, $IIlLlII) {$specblock =$this->pluginMod->GetOption('specblock'); $blockName =$this->pluginMod->GetProperty("active_spec_blocks"); if(!$this->pluginMod->GetOption(I2328)) {$this->cms->Core->Cache->TT1Tl1l($blockName); }$specblock =preg_replace('/\\.{2,}/', '', strtr($specblock, array('/' => '', I2329 => ''))); $file =$this->IlI1lLL.$specblock; $params =$this->TTll1l1(); $params += array ('block_id' => $blockName); $res =$this->TTll1ll($file, $params); $vRes['body'] =$res['list_table']; $this->cms->SetSpecialBlock($blockName, $vRes[I2330]); return $vRes; }function &TTTlI1T(&$aCustom) {$file =$this->IlI1lLL.$this->pluginMod->GetOption(I2319); $params =$this->TTll1l1(); $res =$this->TTll1ll($file, $params); return $res; }function TTll1ll($file, &$pluginParams) {$null =null; $api =new AMI_PluginState('', $this->pluginMod, $this->cms, $null); $IlL1LIL =!in_array($pluginParams['plugin_id'], array('translator', 'sape')); $p =$pluginParams +array (I2331 => $GLOBALS['ROOT_PATH'], I2327 => $this->pluginMod->GetOption(I2327)); $p['root_path_www'] =str_replace('//www.', '//', mb_strtolower($p[I2332])); $api->params($p); unset($p, $pluginParams['block_id']); $IlL1LI1 =array(); $resultHtml =''; if(is_file($file) && is_readable($file)){ if($IlL1LIL){ AMI_Registry::set('AMI_CWD', getcwd()); chdir($GLOBALS['ROOT_PATH']); }if($this->pluginMod->GetOption(I2333) >= '06.00'){ AMI_Service::addAutoloadPath('_local/plugins_distr/'.$pluginParams['plugin_id'].'/code/'); }else{ AMI_Registry::set('ami_allow_model_save', true); }include $file; if($IlL1LIL){ chdir(AMI_Registry::delete('AMI_CWD')); }}else {trigger_error("Cannot include plugin file $file", E_USER_WARNING); }return array('headers' => $IlL1LI1, 'list_table' => $resultHtml); }function TTll1l1() {$res =array( 'plugin_id' => $this->pluginId, I2334 => $GLOBALS['ROOT_PATH'] .$this->config[I2324].$this->pluginId.'/', 'config_file' => $GLOBALS['ROOT_PATH'] .$this->config[I2324].$this->pluginId.I2335.$this->pluginMod->GetOption('config'), I2326 => $this->IlI1lLL, 'templates_path' => $this->IlL1LIl, I2332 => $GLOBALS['ROOT_PATH_WWW'], 'side' => $this->side, I2336 => $this->cms->lang, 'lang_data' => $this->langData, 'company_email' => $this->cms->Core->GetOption("company_email"), 'company_robot_email' => $this->cms->Core->GetOption("company_robot_email"), 'company_name' => $this->cms->Core->GetOption("company_name"), 'http_vars' => $this->cms->Vars, 'http_vars_post' => $this->cms->VarsPost, I2337 => $this->cms->VarsGet, 'http_vars_cookie' => $this->cms->VarsCookie );if($this->side == 'front') {$res += array( 'active_script' => $this->cms->ActiveScript, I2338 => $this->cms->TITlTlI(), );}return $res; }function ProcessAction($IIIL11l, $cId, $cModule ="") {if (!$IIIL11l || $IIIL11l == I2339) {parent::ProcessAction($IIIL11l, $cId, $cModule); }}}