<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       10511 xkqwlxtgllwnrplkigyggpwnnxnnwtgkqqwmtwpuzrkxkrynxxmwlkrlktxtzqtgwymgpnir
 */ ?><?php foreach(array(2515=>'uDQ|MS|GZPQ',2516=>'PrHuG|HGQrZtMHnD',2517=>"PQn|KQBCHrSD",2518=>"ZSS",2519=>"MtQI|IHSuJQ",2520=>'',2521=>"vMQCMS",2522=>"YHSB|MtQID",2523=>"JMDt|DQt|QIGtB",2524=>"vMQC|rHCD",2525=>"DMIGJQ|DQt|fMQJSD",2526=>"JMDt|SZtZ",2527=>"FRhi?WID|vMQC?v",2528=>'fMQJSD',2529=>'IQtOHS',2530=>"SZtQfrHI",2531=>"fJt|nZIQ",2532=>'QnPMnQ|vQrDMHn',2533=>"MWHn|vMQC|ZSS",2534=>"MWHn|vMQC|QSMt",2535=>"",2536=>"ZWtMHn",2537=>"Hn",2538=>"DtrMGJMnQ",2539=>"ZWtMHnD",2540=>"SQJ|MS",2541=>"nHtGuYJMDOQS",2542=>"JQP|SQJ",2543=>"DZvQ",2544=>"ZnnHunWQ",2545=>"nZIQ",2546=>"GuYJMW",2547=>"MS|DMtQ",2548=>"DuYJMnK",2549=>"vMQCMS|DuYJMnK") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class CMS_ViewModule extends CMS_ActModule {public $viewId; public $Il11I1I; function CMS_ViewModule(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11[I2515] =false; $IIIIL11['cat_offset'] ='viewoffset'; $IIIIL11['default_prefix'] ='v'; $IIIIL11[I2516] =Array("publish_on", "publish_off", "del", "gen_sublink", I2517, "index_details", "no_index_details"); $IIIIL11["allowed_actions"] =Array("publish", I2518, "edit", "apply", "save", "del"); $aOptions += $IIIIL11; $this->Il11I1I =$this->module->GetProperty(I2519); parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _ApplyFilters($prefix =I2520, $bodyType =I2520, $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); if(!empty($this->Il11I1I)) {$res .= " AND ".$this->options['default_prefix']."mod_name='".$this->Il11I1I."'"; }return $res; }function TTTlTI1() {parent::TTTlTI1(); $this->viewId =intval($this->cms->Vars[I2521]); }function _InitAdmin() {parent::_InitAdmin(); $this->words[$this->cms->ActiveModule."_add"] =$this->words["form_view_add"]; $this->words[$this->cms->ActiveModule."_edit"] =$this->words["form_view_edit"]; }function TTTllTI(&$aCustom) {if($this->viewId >0) {$this->SetBodyType(I2522); }else {$this->SetBodyType("body_views"); }}function TTTll1T(&$vData, &$aCustom) {$aDefault =Array(); foreach($this->IIllIL1 as $IIlL1L1 => $tmp) {$IIlL1Ll =$aCustom; $Il11I1l =$vData; switch($IIlL1L1) {case "body_views": $aDefault =Array( "list_set"=>"view_list", I2523=>"view_list_empty", "row_set"=>"view_row", "list_table"=>I2524, "active_item_type"=>"body_views", "page_item_type"=>"body_cats" );$aDefault[I2525] =Array("announce", "description"); $IIlL1Ll += $aDefault; $IIlL1Ll["list_data"]["simple_prefix"] =$IIlL1Ll[I2526]["splitter_prefix"] ="view_"; $this->module->InitPager($this->browser); $this->browser->InitPager($this->catOffset, $this->module->GetOption("page_size")); $this->browser->InitSQL("id, public, name, announce, sublink", I2527, "WHERE 1 ".$this->_ApplyFilters(), "", "name", "v.id" );$IIlL1Ll[I2528]['item'] =Array('action'=>'callback', 'object'=>&$this, I2529=>'_ViewCB'); parent::TTTll1T($Il11I1l, $IIlL1Ll); $vData += $Il11I1l; break; default: parent::TTTll1T($vData, $aCustom); }}}function _ViewCB(&$aItem, &$aData) {$aItem["viewoffset"] =$this->catOffset; $aItem["name"] =$this->cms->Gui->getAbs($this->moduleName."_list:view_name", $aItem); }function TTTlIII() {parent::TTTlIII(); if($this->filter->issetField(I2530)) $this->filter->TITI1l1(I2530); if($this->filter->issetField("dateto")) $this->filter->TITI1l1("dateto"); $this->filter->AddField("flt_name", "text", stripslashes(unhtmlentities($this->cms->Vars[I2531])), "", " like ", "v.name"); $this->filter->MoveField(I2531,_MOVE_START); }function TTTlI1I(&$vData) {$vData["id"] =-1; $Il11I1L =&$this->cms->Core->GetModule($this->Il11I1I); $Il11I11 =$Il11I1L->GetOption(I2532); $Il11I1L->SetOption(I2532, '0303'); $vData["view_items_url"] =$Il11I1L->GetAdminLink(); $Il11I1L->SetOption(I2532, $Il11I11); if($this->action == "edit" && !empty($this->itemData["view_data"])) {$vData[I2533] ="none"; $vData["icon_view_edit"] ="inline"; }else {$vData[I2533] ="inline"; $vData[I2534] ="none"; }parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL("id, public, name, announce", "FROM cms_view v ", "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), I2535, "name", "v.id desc" );$aCustom["fields"] += Array( "public"=>Array(I2536=>"flagicon", "value"=>1, "id"=>"pub_id", I2537=>$this->cms->ActiveModule."_list:public_on","off"=>$this->cms->ActiveModule."_list:public_off"), "name"=>Array(I2536=>I2538, "size"=>25), "announce"=>Array(I2536=>"strip_tags"), "actions"=>Array(I2536=>I2539, "set"=>$this->cms->ActiveModule."_list:icons_edit_del", "id"=>Array("edit_id", I2540)), );$aCustom["applied_id"] ="id"; $aCustom["legend"] =Array("published", I2541, "leg_red", "leg_yellow", "leg_blue", "leg_edit", I2542); $aCustom["form_data"]["buttons"] =Array(I2518, "apply", "cancel", I2543); parent::TTTlI11($vData, $aCustom); }function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $sql ="SELECT *, IF(public > 0, 'checked', '') AS public ". "FROM cms_view v ". "WHERE id='".$cId."'".$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; $this->itemData[I2544] =$this->cms->htmlchars($this->itemData[I2544]); $this->itemData["description"] =$this->cms->htmlchars($this->itemData["description"]); $this->itemData["view_data"] =$this->cms->htmlchars($this->itemData["view_data"]); }}function TTT1IlI($aSql =Array(), $cId =0) {$announce =$this->cms->VarsPost[I2544]; $name =$this->cms->VarsPost[I2545]; $Il11lII =$this->cms->VarsPost["view_data"]; if($name != I2535 && $Il11lII != I2535) {if(!is_array($aSql)) {$aSql =Array(); }$aSql += Array( I2544=>$this->cms->VarsPost[I2544], "description"=>$this->cms->VarsPost["description"], I2545=>$name, "public"=>intval($this->cms->VarsPost[I2546]), "view_data"=>addslashes(unhtmlentities(stripslashes($Il11lII))) );if($this->options["multi_sites"] && isset($this->cms->VarsPost["id_site"])) {$aSql["id_site"] =intval($this->cms->VarsPost[I2547]); }}$aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function _GetNavDataCB(&$vItem, &$vData) {$aNavData =Array(); switch($vData["active_item_type"]) {case "body_views": $aNavData[I2521] =$vItem["id"]; $aNavData["viewid_sublink"] =$vItem[I2548]; $vItem += $this->cms->ApplyNav($aNavData); break; case I2522: $aNavData["id"] =$vItem["id"]; $aNavData["id_sublink"] =$vItem[I2548]; $aNavData[I2521] =$vItem["id"]; $aNavData[I2549] =$vItem[I2548]; $vItem += $this->cms->ApplyNav($aNavData); break; default: parent::_GetNavDataCB($vItem, $vData); }}}?>