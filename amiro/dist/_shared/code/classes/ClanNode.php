<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       2499 xkqwrpnluwqyuitxiuxxrpqwsxprutqpqryknpymuytmxuiszyknqtlrwzgizmqxyxlgpnir
 */ ?><?php foreach(array(3280=>'JHWZJOHDt',3281=>'MS|nHSQ') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ClanNode {public $rec; function ClanNode($rec) {$this->rec =$rec; }function name() {return $this->rec['name']; }function TT1I1IT() {$ILI11LI =intval($this->rec['id_node']); if(!$ILI11LI) {$host =I3280; $port =$GLOBALS['SHARED_OPT']['wzdaemon_port']; }else {$host =$this->rec['daemon_addr']; $port =intval($this->rec['daemon_port']); }if(empty($host) || $port <=0) trigger_error("Invalid daemon connection params for node ID=$ILI11LI, name=".$this->name(). ": host='$host',port='$port'",E_USER_ERROR); return "inet:$host:$port"; }function TT1I1II() {$ILI11LI =intval($this->rec[I3281]); if(!$ILI11LI) {$url =$GLOBALS['SHARED_OPT']['mboxd_url']; }else {$url =$this->rec['mboxd_url']; }if($url == 'inet:none') {return null; }if(empty($url)) trigger_error("Empty mboxd url for node ID=$ILI11LI, name=".$this->name(),E_USER_ERROR); return $url; }function &TT1I1Il($domain=false) {static $ILI11Ll =array(); if($domain===false) {$oSess =admSession(); $domain =$oSess->TlIT11I(); }$sql ="SELECT u.id_node,n.name,n.daemon_addr,n.daemon_port,n.mboxd_url FROM cms_host_users u ". "LEFT JOIN cms_clan_nodes n ON n.id=u.id_node ". "WHERE u.domain_orig='".addslashes($domain)."'"; $db =&DB_si::admInstance(); if(!($rec=$db->getRecord($sql))) trigger_error("Cannot get clan node by domain: domain '$domain' not found in clan DB",E_USER_ERROR); $ILI11LI =intval($rec[I3281]); if(!is_object($ILI11Ll[$ILI11LI])) {$ILI11Ll[$ILI11LI] =new ClanNode($rec); }return $ILI11Ll[$ILI11LI]; }}?>