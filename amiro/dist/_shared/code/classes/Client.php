<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       12634 xkqwlpmxpilprmswiyympinzwzipmiunlnxqzsptrusuknqmwgqllqgsqpsugsyqlxrqpnir
 */ ?><?php foreach(array(3275=>"IQIYQr|SZtZ",3276=>"MS|rQDQJJQr",3277=>"WID|ODt|WJMQntD",3278=>"WurrQnWB",3279=>"ZWtMvQ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class Client extends CMS_Member {public $dbTablePrefix; function Client(&$sess, $IIIL1ll ="client") {parent::CMS_Member($sess, $IIIL1ll); }function TT1Il1l(&$cms, &$db, $data, $sendMail =false, $update =true, $genData ='') {$res =0; $id_member =$this->checkUsername($db, $data[I3275]["username"]); if($id_member >0) {$sql ="SELECT id FROM cms_hst_clients WHERE id_member='$id_member'"; $db->query($sql); $add =!$db->next_record(); if($update) {$this->updateMember($cms, $db, $id_member, $data[I3275], true); }}else {$add =$this->createMember($cms, $db, $data[I3275], $sendMail, $genData); $id_member =$db->lastInsertId(); }if($add) {$aSql =Array('id_member' => $id_member, 'id_reseller' => $data["item_data"][I3276], 'is_active' => 1, 'is_reseller' => $data["item_data"]["is_reseller"]); $sql =$db->GenInsertSQL(I3277, $aSql); $db->query($sql); $res =$id_member; }return $res; }function TT1Il11(&$cms, &$db, $id, $data, $IIIL1lL =false) {global $lang_data; $res =0; $sql =$db->GenUpdateSQL(I3277, $data["item_data"], "WHERE id_member='".intval($id)."'"); if ($db->query($sql)) {$balance =$data[I3275]["balance"]; $currency =$data[I3275][I3278]; if ($this->updateMember($cms, $db, $id, $data[I3275], $IIIL1lL)) {$this->updateBalance($db, $id, $balance, $currency, true, "admin"); $res =$id; }else {$cms->AddStatusMsg("status_apply_member_data_fail"); }}else {$cms->AddStatusMsg("status_apply_client_data_fail"); }return $res; }function TT1I1TT(&$cms, &$db, $id) {$sql ="DELETE FROM cms_hst_clients WHERE id_member='$id'"; $db->query($sql); }function TT1I1TI(&$cms, &$db, $id, $active) {$res =false; $sql ="SELECT active FROM cms_members WHERE id='$id'"; $db->query($sql); if($active=="0" || ($db->next_record() && $db->Record[I3279]==1)) {$sql ="UPDATE cms_hst_clients SET is_active='$active' WHERE id_member='$id'"; $db->query($sql); $res =true; }return $res; }function TT1I1Tl(&$cms, &$db, $id, $status) {$res =false; $sql ="SELECT 1 FROM cms_hst_clients WHERE id_member='$id'"; $db->query($sql); if(!$db->next_record()) {$sql ="INSERT INTO cms_hst_clients (id_member, active) VALUES ('$id', '0')"; $db->query($sql); }$res =$this->TT1I1TI($cms, $db, $id, $status); return $res; }function TT1I1T1(&$cms, &$db, $id =0) {if(empty($id)) {$id =$this->User["id"]; }$sql ="SELECT (m.active & hc.active) as active FROM cms_members m ". "INNER JOIN cms_hst_clients hc ON hc.id_member=m.id WHERE m.id='$id'"; $db->query($sql); $db->next_record(); $res =($db->Record[I3279] == 1); return $res; }}?>
