<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       147682 xkqwgnqtsryqtzuxtimkrxnkzypmxyiwnutxnizlnxltntgrxxmgpzwwrminqsgnlpuxpnir
 */ ?><?php foreach(array(3448=>'oTTg~1`0?403?FHrYMSSQn',3449=>'FHrYMSSQn!?MnvZJMS?URj,?',3450=>'?Zt?',3451=>"dbd|s|RmpoT",3452=>"dbd|c|RmpoT",3453=>"dbd|R|RmpoT",3454=>"dbd|z|RmpoT",3455=>'ohdTihsq|dozRqs',3456=>'ohdTihsq|zsimN',3457=>'sqFmNq001',3458=>"dbd|zwT|sqF|RmpoTd",3459=>"nHnQ",3460=>"rDrtIQ",3461=>"vMQC",3462=>"SQJ",3463=>"QSMt",3464=>'wjzddqd|gzTo',3465=>'wid|iHSuJQDdQttMnPD`GOG',3466=>'IHSuJQD',3467=>'unKnHCn',3468=>'`GOG',3469=>'GZPQ|',3470=>'DMAQ',3471=>'DHrt|WHJ',3472=>'DHrt|SMI',3473=>'IZx|GZPQD',3474=>'',3475=>'WID|',3476=>'MS',3477=>'ZSIMn|GZPQ|OQZSQr',3478=>'ZSIMn|IQnu|WZGtMHn',3479=>"MS",3480=>"",3481=>'hYDHJQtQ?wHrQ%%dQtTZYJQdHrtFMQJSD?IQtOHS?WZJJQS',3482=>'DHrt|fMQJSD',3483=>"WOQWK|JMnKD|WHnfJMWt",3484=>'MnOQrMt|DQttMnPD',3485=>'HGtMHn',3486=>"UnKnHCn?",3487=>"?'",3488=>"'?Mn?IHSuJQ?'",3489=>"'",3490=>'ZWtMHnD',3491=>"ZWtMHnD",3492=>"[",3493=>"|dmsq",3494=>"frHnt",3495=>"frHnt|",3496=>'QnPMnQ|WJZDDQD',3497=>"'QnPMnQ|WJZDDQD'?GrHGQrtB?nHt?fHunS?fHr?IHSuJQ?'",3498=>'GJuPMn|',3499=>'ZGM|vQrDMHn',3500=>'06`00',3501=>'QnPMnQ`GOG IHS|MS=',3502=>'GJuPMn|MS',3503=>'QnPMnQ|vQrDMHn',3504=>'0600',3505=>'ZSIMn|rQEuQDt|tBGQD',3506=>'ZLZx',3507=>'Qnv~WHHKMQ',3508=>'ZIM|QnPMnQ',3509=>"nZIQ",3510=>"JMnK",3511=>"MS|DMtQ",3512=>'JMnK',3513=>",,,",3514=>"mnWHrrQWt?GZrZIQtQrD?nuIYQr```",3515=>"hGtMHnD",3516=>"wuDtHIsZtZ",3517=>'hGtMHnD',3518=>'grHGQrtMQD',3519=>'dQZrWOFMQJSD',3520=>'dQZrWOsZtZ',3521=>'wuDtHIsZtZ',3522=>"dQZrWOFMQJSD",3523=>"dQZrWOsZtZ",3524=>'mJJ111j',3525=>'uDQr',3526=>"unKnHCn",3527=>"SQfZuJt",3528=>'SQfZuJt',3529=>'rQYGCErLYBBnCrtnWvPBOA',3530=>'ErLYBBnCrtnWCvPBOA',3531=>'tInBCvPBOACLYBBn',3532=>'ErLYBBnCKnACPrfnPnE',3533=>'BrMrBCOIrACErLYBBn',3534=>'|ZIC',3535=>'CIZ|',3536=>"QH",3537=>'GJuPMnD',3538=>"JMW",3539=>"vQrDMHn",3540=>'Drv|IuJtM|DMtQD',3541=>'DBD|PrHuGD',3542=>'nQCD',3543=>'ZrtMWJQD',3544=>'GOHtHZJYuI',3545=>'fZE',3546=>'DQZrWO',3547=>'fQQSYZWK',3548=>'vHtQD',3549=>'DuYDWrMYQ',3550=>'fMJQD',3551=>'fHruI',3552=>'PuQDtYHHK',3553=>'LHYD',3554=>'ZSv|GJZWQD',3555=>'ZSv|ZSvQrtMDQr',3556=>'YJHP',3557=>'WJZDDMfMQSD',3558=>'QDOHG|MtQI',3559=>'QDOHG|WZrt',3560=>'QDOHG|HrSQr',3561=>'QDOHG|HrSQr|rQGHrtD',3562=>'QDOHG|uDQr',3563=>'KY|MtQI',3564=>'GHrtfHJMH|MtQI',3565=>'PZJJQrB|MtQI',3566=>'Zff|DtZtD',3567=>'YMJJMnP',3568=>'Drv|ZuSMt',3569=>'CA|SQDMPnD',3570=>'CA|OHDt|uDQrD',3571=>'ZSv|ZSvQrtMDQrD',3572=>'QDOHG|SMDWHuntD',3573=>'QDOHG|WHuGHnD',3574=>'QDOHG|ZPrQQIQnt',3575=>'QDOHG|uDQr|MtQID',3576=>'QDOHG|SZtZ|QxWOZnPQ',3577=>'QDOHG|DOMGGMnP|IQtOHSD',3578=>'rZtMnP',3579=>'GrMvZtQ|IQDDZPQD',3580=>'QI',3581=>'QD',3582=>'OHG|MtQI',3583=>'QDO',3584=>'HG|HrSQr',3585=>'QDOH',3586=>'G|SZtZ|QxWOZnPQ',3587=>'Du',3588=>'YD|DQ',3589=>'nS',3590=>'DQZ',3591=>'rWO',3592=>'zim|iHSsQW',3593=>'JZrZtHr',3594=>'PQtmn',3595=>'DtZnWQ',3596=>'PQtRQPM',3597=>'DtQrQS',3598=>'ZI',3599=>'v|AOBPvDr',3600=>'QSD',3601=>'PQtgZ',3602=>'rQnt',3603=>'HGt',3604=>'wis|DKMG',3605=>'IHSuJQ',3606=>'SZtZ',3607=>"wis|frHnt|ZJJHCQS",3608=>"wis|rQIHvQ|MtQI",3609=>"WHrQ",3610=>'DBD|uDQrD',3611=>'zim|iHSd',3612=>'QttMnPD',3613=>'PQthGtMH',3614=>'nD',3615=>'WHrQ',3616=>'rQEurQ|rQYuMJS|IHSuJQD',3617=>'WID',3618=>'QSMtMHn',3619=>'Hn|PQt|QSMtMHn',3620=>'YuDMnQDD',3621=>'IMnMIZrKQt',3622=>'vMtrMnZ',3623=>'WHrGHrZtQ',3624=>'DuYD|DQnS',3625=>'vMDMtKZ',3626=>"uDQr",3627=>'VqRdmhNd',3628=>'ZWt|SY',3629=>'DtZrt|vQrDMHn',3630=>'|ZJHnQ|rQWHrS',3631=>'nZIQ',3632=>'SY|vQrDMHn',3633=>'vZJuQ',3634=>'~;}\S-\`{)3(\S-$~',3635=>'`',3636=>'GKP',3637=>'JMW',3638=>'vQrDMHn',3639=>'zdwmm',3640=>'UTF+8',3641=>'ZSIMn',3642=>"W",3643=>"PtID`",3644=>"BI",3645=>"ZWHJ",3646=>"JOH",3647=>"vIDtu",3648=>"721",3649=>'0',3650=>'1`0`',3651=>"GZrZI3",3652=>"JMDt",3653=>"OHDtD",3654=>'GZrZI3',3655=>'SZtZDQt|IZx|ZJJHCQS',3656=>"dqjqwT?WHunt}[{?ZD?WHunt?",3657=>"FRhi?",3658=>"|SZtZDQtD?S?",3659=>"coqRq?1",3660=>"WHunt",3661=>"SZtZDQt|IZx|ZJJHCQS",3662=>"DtZtuD|IZxSD|fZMJ",3663=>"rQS",3664=>"UnSQfMnQS?IHSuJQ?*",3665=>"&```",3666=>"dQtiHSsuIGsZtZ%%?UnSQfMnQS?IHSuJQ?*",3667=>'QnPMnQ`GOG',3668=>'EuQrB',3669=>'IHS|MS',3670=>'WHrQ|IHSuJQ',3671=>"hGtMHn?",3672=>"%",3673=>"?WZnnHt?YQ?MnOQrMtQS?frHI?MtDQJf",3674=>"?WZnnHt?YQ?MnOQrMtQS?frHI?",3675=>'%',3676=>'Drv|HGtMHnD',3677=>'ZJJHCQS|MnOQrMtZnWQ',3678=>'MnOQrMtZnWQ',3679=>"MnDtZJJQS",3680=>"hCnQr?MD?unKnHCn?Hr?nHt?MnDtZJJQS?Mn?pQtiHSuJQDyBhCnQr?*",3681=>"SHnt|DOHC|Mn|GI",3682=>"DQZrWO|YB|GZrQnt",3683=>"hCnQr?MDn't?fHunS?*",3684=>"IHSuJQ",3685=>"iHSuJQ?nZIQ?*",3686=>"&?MD?rQDQrvQS```",3687=>'fMrDt|IHS|MS',3688=>"iHSuJQ?CMtO?tOMD?nZIQ?ZJrQZSB?QxMDtD?*",3689=>"UnSQfMnQS?GZrQnt?IHSuJQ?*",3690=>"iHSuJQ?MD?nHt?fHunS?*",3691=>"IHSuJQD",3692=>"tZYHrSQr",3693=>"grHGQrtMQD",3694=>'tZYHrSQr',3695=>"HCnQrD",3696=>'HCnQrD',3697=>'GHD',3698=>"GHD",3699=>'ZJJ',3700=>"ZJJ",3701=>"dZvQhGtMHnD%?UnKnHCn?IHSuJQ?*",3702=>"WID|HGtMHnD",3703=>"CrMtQ",3704=>"dZvQhGtMHnD%?wZn't?JHWK?HGtMHnD?tZYJQ```?WrQZtQ?HGtMHnD?fZMJQS",3705=>'OZD|HGtMHnD|JZAB',3706=>'HGtMHnD|SuIG|JZAB',3707=>"sqjqTq?FRhi?.WID|HGtMHnD.?",3708=>"coqRq?.nZIQ.?=?'HGtMHnD|SuIG|JZAB'?zNs?.nZIQ.?=?'",3709=>'ZWtMHn',3710=>'rQfrQDO',3711=>'DtQG',3712=>"RQZShGtMHnD?%%?rQWHrS?nHt?fHunS?fHr?IHSuJQ?*",3713=>"&!?*",3714=>'HGtMHnD|SuIG|',3715=>'mm1mmmm',3716=>'WHrQ|fZDt|ZSI',3717=>'HGtMHnD|SuIG',3718=>'HGtMHnD',3719=>"WID|vQrDMHn",3720=>'wid|VqRdmhN',3721=>"`",3722=>"mJjJJJJ",3723=>"vZJuQD",3724=>'vZJuQD',3725=>'Drv|JMWQnWQ',3726=>'IMn|tZYHrSQr',3727=>"dQtgrHGQrtMQDsuIG?%%?GrHGQrtMQD?nHt?fHunS?fHr?IHSuJQ?*",3728=>"|",3729=>'DEJ|DZfQtB|WOQWK',3730=>"SuIG|",3731=>"PAWHIGrQDD",3732=>"DQJQWt?MS?frHI?WID|HGtMHnD?COQrQ?IHSuJQ|nZIQ='WHrQ'?ZnS?nZIQ='",3733=>"uGSZtQ?WID|HGtMHnD?DQt?",3734=>"SZtQ|IHSMfMQS=nHC}{!?",3735=>"vZJuQ='",3736=>"'!?",3737=>"YMP|vZJuQ='",3738=>"'?",3739=>"COQrQ?MS='",3740=>"MnDQrt?MntH?WID|HGtMHnD?DQt?",3741=>"IHSuJQ|nZIQ='WHrQ'!?",3742=>"nZIQ='",3743=>"DQJQWt?[?frHI?WID|HGtMHnD?COQrQ?IHSuJQ|nZIQ='WHrQ'?ZnS?nZIQ='",3744=>"'?JMIMt?1",3745=>"YMP|vZJuQ",3746=>"vZJuQ",3747=>"PAunWHIGrQDD",3748=>"qRRhR%?dZvQS?WHrQ?SuIG?JQnPtO*",3749=>"&?MD?nHt?QEuZJ?tH?rQZS*",3750=>'rMPOtD|vQrDMHn',3751=>"yUmjsqR|VqRdmhN",3752=>"UgszTq?WID|OHDt|uDQrD?dqT?rMPOtD|vQrDMHn='",3753=>"'?coqRq?DBD|uDQr=1",3754=>"UgszTq?WID|ODt|rQD|WID|MnDt?dqT?rMPOtD|vQrDMHn='",3755=>"'?coqRq?MD|DBD=1",3756=>'Qnv~fMJQ|WZWOQ',3757=>'[|rv|[',3758=>'uDQr|rMPOtD',3759=>'PrHuGD',3760=>'IHS|rMPOtD',3761=>'PrHuG|IZDK',3762=>'JHPMn',3763=>'DBD|uDQr',3764=>"dqjqwT?.MS|IQIYQr.!?.rMPOtD|vQrDMHn.?FRhi?.WID|OHDt|uDQrD.?coqRq?.DBD|uDQr.?=?1",3765=>"dqjqwT?.MS|ZSIMn.?.MS|IQIYQr.!?.rMPOtD|vQrDMHn.?FRhi?.WID|ODt|rQD|WID|MnDt.?coqRq?.MD|DBD.?=?1",3766=>'MS|IQIYQr',3767=>"rMPOtD|vQrDMHn",3768=>"0",3769=>'HdQDDMHn',3770=>'ZIM|QfQ',3771=>"dqjqwT?DP`MS!?DP`PrHuG|IZDK!?DP`JHPMn!?DP`IHSQrZtHr!?DP`QSMt|frHnt|ZJJHCQS?",3772=>"FRhi?WID|DBD|uDQrD?Du?",3773=>"jqFT?lhmN?WID|DBD|PrHuGD?DP?hN?Du`MS|PrHuG=DP`MS?",3774=>"coqRq?Du`MS|IQIYQr?=?",3775=>"?zNs?DP`JHPMn?@=?",3776=>"PrHuG|IZDK",3777=>"_",3778=>'IHSQrZtHr',3779=>'_',3780=>'QSMt|frHnt|ZJJHCQS',3781=>"dqjqwT?.MS.!?.PrHuG|IZDK.!?.JHPMn.!?.QSMt|frHnt|ZJJHCQS.?FRhi?.WID|DBD|PrHuGD.?coqRq?.PuQDt.?=?1",3782=>"PrHuGD",3783=>"puQDt?PrHuG?nHt?fHunS",3784=>"dqjqwT?",3785=>"[!?",3786=>"}.PrHuG|IZDK.?]?}",3787=>"{{?@?0?.IHSQrZtHr.!?",3788=>"{{?@?0?.QSMt|frHnt|ZJJHCQS.",3789=>"!?}.PrHuG|IZDK.?]?}",3790=>"{{?@?0?.ZSIMn.",3791=>"?FRhi?.WID|DBD|ZWtMHnD|rMPOtD.?",3792=>"coqRq?}.PrHuG|IZDK.?]?}",3793=>"{{?,=?0",3794=>'IHSuJQ|nZIQ',3795=>'ZWtMHn|nZIQ',3796=>'IQIYQrD',3797=>'QSMt|frHnt|ZJJHCQS|IHSuJQD',3798=>'nHnQ',3799=>'rDrtIQ',3800=>'ZSS',3801=>'ZGGJB',3802=>'SQJ',3803=>"ZSIMn",3804=>"IHSQrZtHr",3805=>'DtZrt',3806=>'PrHuG|rMPOtD',3807=>"IHS|rMPOtD",3808=>"dqjqwT?PrHuG|IZDK?FRhi?WID|DBD|PrHuGD?coqRq?MS=",3809=>"prHuG?MS=",3810=>"?nHt?fHunS",3811=>"dqjqwT?[?frHI?WID|DBD|ZWtMHnD|rMPOtD?coqRq?}PrHuG|IZDK?]?}",3812=>"{{,=0",3813=>"prHuGiHSuJQzWWQDDRcs}",3814=>"!",3815=>"{%?IHSuJQ?'",3816=>"'?unKnHCn?Hr?nHt?MnDtZJJQS",3817=>"UDQriHSuJQzWWQDDRcs}",3818=>"rMPOtD",3819=>"JHPMn",3820=>"JZnP",3821=>"uDQr|rMPOtD",3822=>"UnKnHCn?DBDtQI?SZtZ?nZIQ?*",3823=>'DuGGHrt|rMPOtD',3824=>"MS|HCnQr",3825=>"~",3826=>"~\\Y",3827=>"\\Y~",3828=>"tZYJQ",3829=>'|O',3830=>'IHSQ',3831=>'DMnPJQ',3832=>'z',3833=>'im|RQP',3834=>'MDtrB',3835=>'Q',3836=>'xMDt',3837=>'D',3838=>'PQ',3839=>'t',3840=>'#DWrMGt?tBGQ="tQxt~LZvZDWrMGt"?DrW="',3841=>'RhhT|gzTo|ccc',3842=>'Z',3843=>'IMrH|DBD|',3844=>'LD`GOG ',3845=>'|L',3846=>'~',3847=>'WHI',3848=>'IHn',3849=>'`LD ',3850=>']|Wv=',3851=>'DBD',3852=>'Qrr',3853=>'nH|WZWOQ|LD',3854=>'QxtSQY',3855=>']|tD=',3856=>'WHIIHn|DQttMnPD',3857=>'WDD|LD|vQrDMHn',3858=>']|Dv=',3859=>']ZI',3860=>'MrH|KQB=',3861=>'~;\S-\`\S-\`\S-\`}\S-{[~',3862=>'$1',3863=>'"@#~DWrMGt@',3864=>"\r\n",3865=>'frHnt',3866=>'DWrMGt=DBDtQI_fMJtQr_ZGM',3867=>'Qnv~DQDDMHn',3868=>'_DKMn',3869=>'SQYuP|MGD',3870=>'RqihTq|zssR',3871=>'SMDZYJQ|LD|HGtMIMAZtMHn',3872=>'_WHIIHn',3873=>']WHuntQr=2',3874=>'zi',3875=>'m~r',3876=>'QDHur',3877=>'WQD~L~r',3878=>'DWrMGt=uDQr|rZtMnP',3879=>'im~rQD',3880=>'HurWQ',3881=>'D~L~D',3882=>'DWrMGt=',3883=>'zim~r',3884=>'QDHu',3885=>'rWQD~',3886=>'L~60',3887=>'DWrMGt=60',3888=>'zim~rQ',3889=>'DHu',3890=>'rWQD~L~Q',3891=>'DWrMGt=QSMtHr]',3892=>'puM',3893=>'OQZ',3894=>'SQrwHSQ',3895=>'#~OQ',3896=>'ZS@',3897=>'OHDt|SZtZ',3898=>'fJZPD',3899=>"iHSuJQ?'",3900=>"'?MDn't?MnDtZJJQS",3901=>'|DHurWQ|IHS|MS',3902=>"iMDDMnP?OBGQr?IHSuJQ?SQWJZrZtMHn?'",3903=>'ruJQD',3904=>'HGQnQr',3905=>'WJHDQr',3906=>'IZrKQr',3907=>'~|SZtZ|QxWOZnPQ$~',3908=>'|SZtZ|QxWOZnPQ',3909=>'~|}*;|&-{$~',3910=>'<<IHSmS<<',3911=>'<<GZrQntiHSmS<<',3912=>'<<tZYHrSQr<<',3913=>'<<DQWtMHn<<',3914=>'WHnDtD',3915=>'Dt',3916=>'r|r',3917=>'Ht13',3918=>'~;*0+9&$~',3919=>'DOZrQS',3920=>'YuM',3921=>'JSQr',3922=>'im',3923=>'PQtqS',3924=>'MtMHn',3925=>'DQDDMHn|ZSI|nH|MG|YMnS',3926=>'whNFmp|mNm',3927=>'DQDDMHn',3928=>'DQDDMHn|nH|MG|YMnS',3929=>'zim',3930=>'PQtdM',3931=>'nPJQtHn',3932=>'SY',3933=>'sy|eu',3934=>'QrB',3935=>'PQtdn',3936=>'MGGQt',3937=>"dqjqwT?.MS|IQIYQr.!?.SZtZ.?",3938=>"FRhi?.WID|DQDDMHnD.?",3939=>"coqRq?.MS.?=?:D?zNs?.MS|IQIYQr.?=?0?zNs?.QxGMrQS.?@=?:D",3940=>"?zNs?.MG.?=?:D",3941=>'b+I+S?o%M%D',3942=>'fQtWOR',3943=>'HC',3944=>'OZDO|',3945=>'OZDO',3946=>'uDQr|',3947=>'PQtdMnPJ',3948=>'QtHn',3949=>'Qnv~DQ',3950=>'DDMHn',3951=>'JHPMnz',3952=>'DUDQr',3953=>'uDQrnZIQ',3954=>'trMZJ|OZDO') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header(I3448);die(I3449.__FILE__.I3450.__LINE__);} define(I3451, 1); define(I3452, 2); define(I3453, 4); define(I3454, SYS_R_RIGHT |SYS_W_RIGHT |SYS_D_RIGHT); if (!defined(I3455)) {define(I3455, 0x2); define(I3456, 0x4); }define(I3457, HOSTMODE_SHARED); define(I3458, SYS_R_RIGHT |SYS_W_RIGHT); $Ill1ILL =array( I3459 => SYS_R_RIGHT, I3460 => SYS_R_RIGHT, I3461 => SYS_R_RIGHT, I3462 => SYS_R_RIGHT |SYS_D_RIGHT, I3463 => SYS_R_RIGHT); $Ill1IL1 =array(I3459, I3460); require_once $GLOBALS[I3464] .I3465; class CMS_Module {public $Debug =true; public $Name; public $Owner =I3466; public $Ill1I1I =false; public $Ill1I1l =true; public $Ill1I1L; public $Ill1I11 =true; public $Ill1lII; public $Ill1lIl =I3467; public $Ill1lIL =array(I3467); public $Ill1lI1 =true; public $Ill1llI =false; public $Ill1lll =false; public $ILlIL1l =false; public $Table; public $SearchFields =array(); public $SearchData =array(); public $CustomData =array(); public $Options; public $Properties; public $Ill1llL =false; public $Ill1ll1 =I3468; public $Ill1lLI =I3469; public $Ill1lLl =array(I3470, I3471, I3472, I3473); public $Ill1lLL =false; public $Ill1lL1 =I3474; public $Ill1l1I =array(); public $Ill1l1l; public $Engine =false; public $TableName; public $TablePrefix =I3475; public $Ill1l1L =I3476; public $Ill1l11; public $Ill1LII; public $TableDynamicClassName =I3474; public $Ill1LIl =null; public $Ill1LIL =I3474; function __construct($cName, $IlllLlL =0) {$this->Properties =new CMS_ModulesProperties(); $this->Options =new CMS_ModulesOptions(); $this->SetOption(I3477, I3467); $this->SetOption(I3478, I3467); $this->Init($cName, $IlllLlL); }function TTlT1TT() {$this->Debug =true; }function TTlT1TI() {$this->Debug =false; }function Init($cName, $IlllLlL =0) {$this->TableInit($cName); $this->Name =$cName; $this->Ill1I1L =$IlllLlL; $this->Ill1lII =$cName .$this->Ill1ll1; return true; }function TableInit($Ill1LI1, $Illl1LI =I3479, $Ill1LlI =I3480) {$this->Ill1l1L =$Illl1LI; $this->Ill1l11 =$Ill1LlI; $this->SetTableName($Ill1LI1); $this->Ill1LII =Array(); return true; }function TTlT1Tl() {trigger_error(I3481, E_USER_WARNING); $numArgs =func_num_args(); if ($numArgs == 1 && is_array($arg =func_get_arg(0))) {$aFields =$arg; }else {$aFields =array(); for ($i =0; $i <$numArgs; $i++) {$aFields[] =func_get_arg($i); }}$this->setProperty(I3482, $aFields); return true; }function TTlT1T1() {return $this->issetProperty(I3482) ?$this->getProperty(I3482) :array(); }function TTlT1IT($IIlLlLI) {return $this->issetProperty(I3482) ?in_array($IIlLlLI, $this->getProperty(I3482)) :false; }function SetTableSortAdvFields($aFields) {$this->Ill1LII =Array(); foreach ($aFields as $IILLIIl => $IIIlLlL) {$this->Ill1LII[$IILLIIl] =$IIIlLlL; }return true; }function TTlT1II() {return $this->Ill1LII; }function TTlT1Il($Ill1Lll) {$this->TableDynamicClassName =$Ill1Lll; }function TTlT1I1($name, $value) {$this->Ill1LIL[$name] =$value; }function TTlT1lT($name) {return isset($this->Ill1LIL[$name]) ?$this->Ill1LIL[$name] :null; }function TTlT1lI($Ill1LlL =1) {$res =$Ill1LlL != 2 ?$this->Ill1l1L :$this->Ill1l11; return $res; }function GetTableName($aAdditionalParams =Array()) {$res =false; $tableName =$this->TableName; if ($this->TableName != I3459) {if (!empty($this->TableDynamicClassName)) {if (!is_object($this->Ill1LIl)) {$this->Ill1LIl =new $this->TableDynamicClassName($this); }$tableName =$this->Ill1LIl->GetTableName($this->TableName, $aAdditionalParams); if (empty($aAdditionalParams[I3483])) {$this->TableName =$tableName; }}$res =$this->TablePrefix .$tableName; }return $res; }function SetTableName($Ill1LI1) {if (!empty($Ill1LI1)) {$this->TableName =$Ill1LI1; }}function TTlT1ll($IIL11ll) {$this->Owner =$IIL11ll; return true; }function TTlT1l1($key, $Ill1Ll1 =false) {$this->Options->TTlTlIl($this->Name, $key, $Ill1Ll1); }function TTlT11T($key, $Ill1LLI =true, $IlIlIL1 =false) {return $this->Options->TTlTlI1($this->Name, $key, $Ill1LLI, !$IlIlIL1); }function issetOption($cName) {return $this->Options->issetModParam($this->Name, $cName); }function issetOptionLazy($cName) {return $this->Options->issetModParamLazy($this->Name, $cName); }function issetProperty($cName) {return $this->Properties->issetModParam($this->Name, $cName); }function TTlT11I(&$aOptions) {$this->Options->TTlTIlT($this->Name, $aOptions); }public function SetOption($name, $value =NULL) {global $RebuildOptions, $IIIlILL; if (!empty($RebuildOptions) || !empty($IIIlILL) || !isset($this->IlLII1l) || !in_array($name, array($this->IlLII1l, $this->IlLII1L, $this->IlLII11)) ){$this->Options->setModParam($this->Name, $name, $value); }return true; }function TTlT11l($name, $value =null) {return $this->SetOption($name, $value); }public function setOptionLazy($name, $value =null) {global $RebuildOptions, $IIIlILL; if (!empty($RebuildOptions) || !empty($IIIlILL) || !isset($this->IlLII1l) || !in_array($name, array($this->IlLII1l, $this->IlLII1L, $this->IlLII11)) ){$this->Options->setModParamLazy($this->Name, $name, $value); }return true; }function SetProperty($name, $value =null) {$numArgs =func_num_args(); if ($numArgs >2) {$value =array(); for ($i =1; $i <$numArgs; $i++) {$value[] =func_get_arg($i); }}$this->Properties->setModParam($this->Name, $name, $value); return true; }function TTlT111(&$container, $cName =I3474, $warn =true) {$res =$container->getModParam($this->Name, $cName, false); if (is_null($res) && $warn) {$Ill1LLl =$this->GetProperty(I3484, false); if (is_string($Ill1LLl)) {if (is_object($this->Ill1l1l)) {$vMod =&$this->Ill1l1l->GetModule($Ill1LLl); if (is_object($vMod)) {$res =$container->entity == I3485 ?$vMod->GetOption($cName) :$vMod->GetProperty($cName); }}}elseif ($this->Debug) {trigger_error(I3486 .$container->entity .I3487 .$cName .I3488 .$this->Name .I3489, E_USER_WARNING); }}return $res; }function GetOption($name =I3474) {return $this->TTlT111($this->Options, $name); }function getOptionLazy($name =I3474) {$res =$this->Options->getModParamLazy($this->Name, $name, FALSE); if (is_null($res)) {$res =$this->GetOption($name); }return $res; }function GetProperty($name =I3474, $warn =true) {return $this->TTlT111($this->Properties, $name, $warn); }function TTlITTT() {$act =$this->GetProperty(I3490, false); if ($act === false) return false; if (!isset($act)) return null; return true; }function TTlITTI() {global $Ill1ILL, $Ill1IL1; $Ill1LLL =$this->GetProperty(I3491, false); if (!is_array($Ill1LLL)) $Ill1LLL =empty($Ill1LLL) ?array() :array($Ill1LLL); foreach ($Ill1IL1 as $tmp => $act) $Ill1LLL[] =$act; $act =array(); foreach ($Ill1LLL as $tmp => $adata) {if (is_array($adata)) {foreach ($adata as $action => $Ill1LL1) $act[$action] =$Ill1LL1 |SYS_R_RIGHT; }else if (isset($Ill1ILL[$adata])) $act[$adata] =$Ill1ILL[$adata]; else $act[$adata] =SYS_ACT_DEF_RIGHTS; }return $act; }function TTlITTl($Ill1L1I =false) {$access =0; $Ill1LLL =$this->TTlITTI(); foreach ($Ill1LLL as $action => $Ill1LL1) {if ($Ill1L1I === false || in_array($action, $Ill1L1I)) $access |= $Ill1LL1; }return $access; }function TTlITT1($Ill1LL1 =SYS_A_RIGHT) {$actions =array(); $Ill1LLL =$this->TTlITTI(); foreach ($Ill1LLL as $action => $Ill1L1l) {if (($Ill1LL1 &$Ill1L1l) == $Ill1L1l) $actions[$action] =$Ill1L1l; }return $actions; }function issetAndTrueOption($name) {return $this->Options->issetAndTrueModParam($this->Name, $name); }function issetAndTrueProperty($name) {return $this->Properties->issetAndTrueModParam($this->Name, $name); }function getAOption($name =I3474) {return $this->Options->getModAParam($this->Name, $name); }function getAOptionLazy($name =I3474) {return $this->Options->TTlTIl1($this->Name, $name); }function TTlITIT($name =I3474) {return $this->getAOption($name); }function TTlTTTI($name =I3480) {return $this->Properties->getModAParam($this->Name, $name); }function TTlITII($cMask =I3492, $lang =I3474) {return $this->Options->TTlTlIT($this->Name, $cMask, $lang); }function TTlITIl($cName, $IllLLLL =I3474) {return $this->Options->TTlTlII($this->Name, $cName, $IllLLLL); }function TTlITI1($Ill1L1L) {$this->Ill1lL1 =$Ill1L1L; return true; }function TTlITlT() {$this->Ill1lL1 =I3480; return true; }function TTlITlI($Ill1L11, &$res) {$aOptions =$this->Options->TTlTII1($this->Name); $Ill11II =mb_strlen($Ill1L11); foreach ($aOptions as $cName => $cValue) {$IILlLll =mb_strpos($cName, $Ill1L11); if ($IILlLll === false || $IILlLll >0) {continue; }else {$vName =mb_substr($cName, $Ill11II); $res[$vName] =$cValue; }}}function TTlITll() {$res =Array(); $this->TTlITlI($this->Ill1lLI, $res); if ($GLOBALS[I3493] == I3494) {$this->TTlITlI(I3495 .$this->Ill1lLI, $res); }if (!empty($this->Ill1lL1)) {$vRes =$res; foreach ($vRes as $cName => $cValue) {if (mb_strpos($cName, $this->Ill1lL1) === false) {continue; }else {$vName =str_replace($this->Ill1lL1, I3480, $cName); $res[$vName] =$cValue; unset($res[$cName]); }}}$vRes =Array(); foreach ($res as $cName => $cValue) {if (in_array($cName, $this->Ill1lLl)) {$vRes[$cName] =$cValue; }}$res =$vRes; return $res; }function PushPager(&$Pager, $cOffset =I3480, $Ill11Il =I3480, $Ill11IL =I3480) {$this->Ill1lLL =clone($Pager); $this->InitPager($Pager, $cOffset, $Ill11Il, $Ill11IL); $Pager->Position =0; return true; }function PopPager(&$Pager) {$Pager =clone($this->Ill1lLL); $this->Ill1lLL =false; return true; }function InitPager(&$Pager, $cOffset =I3480, $Ill11Il =I3480, $Ill11IL =I3480) {$Ill11I1 =$this->TTlITll(); $Pager->SortCol =isset($Ill11I1[I3471]) ?$Ill11I1[I3471] :I3474; $Pager->SortDim =isset($Ill11I1[I3472]) ?$Ill11I1[I3472] :I3474; $Pager->PageSize =isset($Ill11I1[I3470]) ?(int) $Ill11I1[I3470] :0; $Pager->lllL11L =isset($Ill11I1[I3473]) ?(int) $Ill11I1[I3473] :10; if (is_numeric($cOffset)) {$Pager->Position =$cOffset; }if (!empty($Ill11Il) && $this->TTlT1IT($Ill11Il)) {$Pager->SortCol =$Ill11Il; }if (!empty($Ill11IL)) {$Pager->SortDim =$Ill11IL; }return true; }function InitEngine(&$cms, &$db) {if ($this->Engine === false) {$aClasses =$this->TTlTTTI(I3496); $class =array_pop($aClasses); if (empty($class)) {trigger_error( I3497 .$this->Name .I3489, E_USER_ERROR );}$this->Engine =new $class($cms, $db, $this); }}function TTlITl1() {unset($this->Engine); $this->Engine =false; }function TTlIT1T($Ill11lI) {$this->Ill1I1L =$Ill11lI; return true; }function IsFrontAllowed($IIILLII =I3474) {return $this->Ill1I1L; }function SetAdminAllowed($Ill11lI) {$this->Ill1I11 =$Ill11lI; return true; }function IsAdminAllowed() {return $this->Ill1I11; }function SetAdminLink($IIILl1L) {$this->Ill1lII =$IIILl1L; return true; }function GetAdminLink($Ill11ll =true) {if ((substr($this->Name, 0, 7) == I3498) && $this->issetOption(I3499) && $this->GetOption(I3499) >= I3500) {$res =I3501 .urlencode($this->GetOption(I3502)); }elseif (($this->issetOption(I3503) && ($this->GetOption(I3503) >= I3504)) || ($this->issetProperty(I3505) && in_array(I3506, $this->GetProperty(I3505)) && AMI::getSingleton(I3507)->get(I3508, false) == 6) ){$res =I3501 .urlencode($this->Name); }else {$res =$this->Ill1lII; }if ($Ill11ll && !$this->IsAdminAllowed()) {$res =I3480; }return $res; }function SetFrontLink($IIILl1L, $Ill11lL =0, $cName =I3480, $Ill11l1 =0) {$aLink =array(I3479 => $Ill11lL, I3509 => $cName, I3510 => $IIILl1L, I3511 => $Ill11l1); if ($this->Ill1lI1) {$this->Ill1lIl =$aLink; }if ($Ill11lL >0) {$this->Ill1lIL[$Ill11lL] =$aLink; }else {$this->Ill1lIl =$aLink; }$this->Ill1lI1 =false; return true; }function GetFrontLink($Ill11lL =0, $Ill11LI =false) {if ($Ill11lL <1) {$res =$Ill11LI ?$this->Ill1lIl :$this->Ill1lIl[I3512]; }else {if (isset($this->Ill1lIL[$Ill11lL])) {$res =$Ill11LI ?$this->Ill1lIL[$Ill11lL] :$this->Ill1lIL[$Ill11lL][I3512]; }else {$res =null; }}return $res; }function TTlIT1I() {$res =$this->Ill1lIL; unset($res[0]); return $res; }function TTlIT1l() {return $this->Ill1lI1; }function IsPresentInPM() {return $this->Ill1llI; }function IsPresentInPMandPublic($IIILLII =I3474) {return $this->Ill1llI && $this->Ill1lll; }function IsVirtual() {return $this->ILlIL1l; }function TTlIT11($aData =I3480) {$numArgs =func_num_args(); $this->SearchFields =Array(); for ($i =0; $i <$numArgs; $i++) {$this->SearchFields[] =func_get_arg($i); }return true; }function TTlIITT($aData =I3480) {$numArgs =func_num_args(); for ($i =0; $i <$numArgs; $i++) {$pos =array_search(func_get_arg($i), $this->SearchFields); if ($pos !== false) {$this->SearchFields[$pos] =I3513; }}return true; }function TTlIITI($Ill11Ll =I3480) {$res =!empty($Ill11Ll) ?$this->SearchFields[$Ill11Ll] :$this->SearchFields; return $res; }function SetInstalled($Ill11lI) {return $this->TTlII1T($Ill11lI); }function TTlIITl($Ill11lI) {return $this->TTlII1T($Ill11lI); }function IsInstalled($IIILLII =I3474) {return $this->TTlIII1(); }function TTlIIT1($IIILLII =I3474) {return $this->TTlIII1(); }function GetParentName() {return $this->Ill1I1I; }function &TTlIIIT() {return $this->Ill1llL; }function HaveParent() {return is_object($this->Ill1llL); }function GetOwnerName() {return $this->Owner; }function &GetSubModules() {$res =&$this->Ill1l1I; return $res; }function TTlIIIl() {return sizeof($this->Ill1l1I) >0; }protected function TTlIII1($Ill11LL =I3474) {return $this->Ill1I1l; }function TTlIIlT($Ill11Ll, $cValue) {$this->SearchData[$Ill11Ll] =$cValue; return true; }function TTlIIlI($Ill11Ll, $Ill11L1) {$numArgs =func_num_args(); if ($numArgs <2) {trigger_error(I3514, E_USER_WARNING); }else {for ($i =2; $i <$numArgs; $i++) {$this->SearchData[$Ill11Ll][$Ill11L1][] =func_get_arg($i); }}return true; }function TTlIIll($Ill11Ll =I3474) {$res =!empty($Ill11Ll) ?$this->SearchData[$Ill11Ll] :$this->SearchData; return $res; }function TTlIIl1($Ill11Ll, $cName, $cValue) {$this->CustomData[$Ill11Ll][$cName] =$cValue; return true; }function TTlII1I($Ill11Ll =I3480) {return empty($Ill11Ll) ?$this->CustomData :$this->CustomData[$Ill11Ll]; }protected function TTlII1T($Ill11lI) {$this->Ill1I1l =$Ill11lI; if (!$Ill11lI) {foreach ($this->Ill1l1I as $index => $vMod) {$this->Ill1l1I[$index]->TTlII1T(FALSE); }}else {if ($this->HaveParent()) {$Ill111I =&$this->TTlIIIT(); if (!$Ill111I->TTlIII1()) {$Ill111I->TTlII1T(FALSE); }}}return TRUE; }function &TTlTTTT($IlllLl1, $IlllLlL, &$IlllLLI) {$res =false; unset($this->Ill1l1I[$IlllLl1]); if (is_object($IlllLLI)) {$this->Ill1l1I[$IlllLl1] =clone($IlllLLI); $this->Ill1l1I[$IlllLl1]->Init($IlllLl1, $IlllLlL); $this->Ill1l1I[$IlllLl1]->Properties =&$this->Ill1l1l->Properties; $this->Ill1l1l->Properties->TTlTIII($IlllLl1, array()); $this->Ill1l1I[$IlllLl1]->Options =&$this->Ill1l1l->Options; $this->Ill1l1l->Options->TTlTIII($IlllLl1, array()); $this->Ill1l1I[$IlllLl1]->TTlT1ll($this->Owner); }else {$this->Ill1l1I[$IlllLl1] =new CMS_Module($IlllLl1, $IlllLlL); }$vMod =&$this->Ill1l1I[$IlllLl1]; if (is_object($vMod)) {$vMod->Ill1I1I =$this->Name; $vMod->Ill1llL =&$this; }$res =&$vMod; return $res; }function &GetModule($cName) {$res =false; if (isset($this->Ill1l1I[$cName])) {$res =&$this->Ill1l1I[$cName]; }return $res; }function GetName() {return $this->Name; }function TTlII1l($IIL1Lll =I3474) {return array( I3515 => $this->Options->TTlTII1($this->Name), I3516 => $this->CustomData );}function TTlII11(&$vData) {$this->Options->TTlTIII($this->Name, $vData[I3517]); return true; }function &TTlIlTT($Ill111l =array()) {$res =array( I3518 => $this->Properties->TTlTII1($this->Name), I3519 => &$this->SearchFields, I3520 => &$this->SearchData, I3521 => &$this->CustomData );return $res; }function TTlIlTI($IIII11I) {$this->Properties->TTlTIII($this->Name, $IIII11I[I3518]); $this->SearchFields =$IIII11I[I3522]; $this->SearchData =$IIII11I[I3523]; $this->CustomData =$IIII11I[I3516]; }}if (empty($GLOBALS[I3524])) {class CMS_Core_Parent extends CMS_Module {}}else {class CMS_Core_Parent extends CMS_ModuleDebug {}}class CMS_Core extends CMS_Core_Parent {public $Ill1I1l =false; public $Side; public $Owners =array(); public $Default; public $Unknown; public $Ill1111 =array(); public $Cache; public $IlLIIII; public $Modules =array(); public $IlLIIIl =array(); public $IlLIIIL =array(); public $IIL1Ll1 =0; public $IlLIII1 =array( I3525 => 0 );public $IlLIIlI; public $IlLIIll =array(I3526, I3527); public $IlLIIlL; public $IlLIIl1; protected $IlLIILI; public $IlLIILl; public $IlLIILL; public $IlLIIL1 =false; public $IlLII1I; public $IlLII1l; public $IlLII1L; public $IlLII11; public $IlLIlII; public $IlLIlIl =array(); public $IlLIlIL =0; public $IlLIlI1 =false; protected $aHyperStruct =array(); private $opt; function __construct($IIL1Lll) {$this->Side =$IIL1Lll; $this->Properties =new CMS_ModulesProperties(); $this->Options =new CMS_ModulesOptions(); $this->Default =new CMS_Module(I3528); $this->Default->Ill1l1l =&$this; $this->Default->Properties =&$this->Properties; $this->Default->Options =&$this->Options; $this->Options->setModParam(I3528, I3477, I3467); $this->Options->setModParam(I3528, I3478, I3467); $this->Unknown =new CMS_Module(I3467, 0); $this->Unknown->Properties =&$this->Properties; $this->Unknown->Options =&$this->Options; $this->Options->setModParam(I3467, I3477, I3467); $this->Options->setModParam(I3467, I3478, I3467); $this->IlLII1I =$this->TTlIlTl(I3529); $this->IlLII1l =$this->TTlIlTl(I3530); $this->IlLII1L =$this->TTlIlTl(I3531); $this->IlLII11 =$this->TTlIlTl(I3532); $this->IlLIlII =$this->TTlIlTl(I3533); }function TTlIlTl($value) {return strrev(str_rot13(strtr($value, I3534, I3535))); }function TT1lTTT($IlLILIL) {$IlLILIL[I3536][I3537] =1; $ILlIL1L =false; if (empty($IlLILIL[I3538][I3539])) {$IlLIllI =array(I3540, I3541, I3542, I3543, I3544, I3545, I3546, I3547, I3548, I3549, I3550, I3551, I3552, I3553, I3554, I3555, I3556, I3557, I3558, I3559, I3560, I3561, I3562, I3563, I3564, I3565, I3566, I3567, I3568, I3569, I3570); }else {$IlLIllI =array(I3540, I3541, I3543, I3544, I3545, I3546, I3547, I3548, I3549, I3550, I3553, I3554, I3571, I3557, I3558, I3559, I3560, I3572, I3573, I3561, I3562, I3574, I3575, I3576, I3577, I3563, I3564, I3565, I3566, I3567, I3568, I3578, I3569, I3570); }$IlLIlll =array( I3549 => I3579 );if (is_array($IlLILIL[I3580])) {$ILlIL1L =true; $IILllLl =&$this->GetAllModules(); foreach ($IlLIllI as $i => $name) {if (empty($IlLILIL[I3580][$name]) && is_object($this->GetModule($name))) {$IILllLl[$name]->TTlIITl(false); }}}if ($ILlIL1L && is_array($IlLILIL[I3536])) {$vOwners =$this->GetOwnersList(); foreach ($vOwners as $name => $vOwner) {if (empty($IlLILIL[I3536][$name])) {$this->TTllTTT($name, false); }}}else {$ILlIL1L =false; }if ($ILlIL1L) {foreach ($IlLIlll as $IlLIlLI => $IlLIlLl) {$vMod =&$this->TTlI1lT($IlLIlLl); $vMod->TTlIT1T($this->TTlIIT1($IlLIlLI)); }}$IlLIl1l =array( I3581 .I3582, I3583 .I3584, I3585 .I3586, I3587 .I3588 .I3589, I3590 .I3591 );$ILlIL11 =array(); $ILlIL11[] =array(); $ILlIL11[0][] =(int) FALSE; $ILlIL11[0][] =$IlLIl1l[0]; $ILlIL11[0][] =$IlLIl1l[1]; $ILlIL11[0][] =$IlLIl1l[2]; $ILlIL11[] =array(1 +(24 >> 3), $IlLIl1l[0], $IlLIl1l[1]); $ILlIL11[] =array(2 *(3 +2), $IlLIl1l[0]); $ILlIL11[] =array(13 -3, $IlLIl1l[3]); $ILlIL11[] =array(1 +3, $IlLIl1l[4]); $_found =FALSE; foreach ($ILlIL11 as $IlLIl1l) {foreach ($IlLIl1l as $IlLIl1L) {if (is_int($IlLIl1L)) {$ILlI1II =$IlLIl1L; continue; }if (!$this->TTlIIT1($IlLIl1L)) {continue 2; }}$_found =TRUE; break; }if (!$_found) {$ILlI1II =1 << 1; }$IlLIlL1 =call_user_func(array(I3592 .I3593, I3594 .I3595)); $IlLIl1I =call_user_func(array($IlLIlL1, I3596 .I3597), I3598 .str_rot13(I3599) .I3600); $IlLIl1l =array(); foreach ($IlLIl1I as $IlLIl1L) {if (is_null(call_user_func(array($IlLIlL1, I3601 .I3602), $IlLIl1L))) {$IlLIl1l[] =$IlLIl1L; }}$IlLILII =sizeof($IlLIl1l); if (!$ILlI1II) {$ILlI1II =$IlLILII; }if ($IlLILII >$ILlI1II) {for ($IlLILIl =$ILlI1II; $IlLILIl <$IlLILII; ++$IlLILIl) {$IlLIlLL =&$this->TTlI1lT($IlLIl1l[$IlLILIl]); if ($IlLIlLL) {$IlLIlLL->TTlIITl(FALSE); }}}return $ILlIL1L; }function TTlIlII($IlLILIL) {$ILlIL1L =is_array($IlLILIL[I3603]); if ($ILlIL1L) {$IILllLl =&$this->GetAllModules(); foreach ($IlLILIL[I3603] as $IlLI11L => $ILlI1Il) {if (!$this->IlLIlI1 && $IlLI11L == $this->IlLII1I && $ILlI1Il == I3604) {$this->Options->setModParam($this->Name, $this->IlLII1l, TRUE); }if (!is_array($ILlI1Il) || $ILlI1Il == I3604) {continue; }$vName =$ILlI1Il[I3605]; $vData =$ILlI1Il[I3606]; if (empty($vName)) {continue; }switch (key($vData)) {case I3607: if ($this->TTlIIT1($vName)) {$IILllLl[$vName]->TTlIT1T($vData[key($vData)]); }break; case I3608: if ($this->TTlIIT1($vName) && $IILllLl[$vName]->IssetOption(key($vData[key($vData)]))) {$ILlI1IL =$IILllLl[$vName]->GetOption(key($vData[key($vData)])); $aItems =$vData[key($vData)][key($vData[key($vData)])]; if (!is_array($aItems)) {$aItems =array($aItems); }$ILlI1I1 =array(); foreach ($ILlI1IL as $vItem => $IILlLlL) {if (in_array($IILlLlL, $aItems)) {continue; }else {$ILlI1I1[$vItem] =$IILlLlL; }}$IILllLl[$vName]->TTlT11l(key($vData[key($vData)]), $ILlI1I1); }break; default: if ($vName == I3609) {$this->Options->setModParam($this->Name, key($vData), $vData[key($vData)]); }else {if ($this->TTlIIT1($vName)) {$IILllLl[$vName]->TTlT11l(key($vData), $vData[key($vData)]); }}break; }}if (empty($this->opt)) {$this->opt =array( I3587 => $this->TTlIII1(I3610) );}if (2 == call_user_func(array(I3611 .I3612, I3613 .I3614), I3615, I3616, TRUE)) {$this->DeleteOption(I3615, I3616); $this->Options->writeOption(I3617, I3618, $this->TT1lTTI()); }}return $ILlIL1L; }private function TT1lTTI() {$ILlI1lI =array(); AMI_Event::fire(I3619, $ILlI1lI, AMI_Event::MOD_ANY); if (isset($ILlI1lI[I3618])) {return $ILlI1lI[I3618]; }$ILlIL11 =array( I3620 => array(I3558, I3560, I3576), I3621 => array(I3558, I3560), I3622 => array(I3558), I3623 => array(I3624), I3625 => array(I3546) );foreach ($ILlIL11 as $ILlI1ll => $IlLIl1l) {foreach ($IlLIl1l as $IlLIl1L) {if (!$this->TTlIIT1($IlLIl1L)) {continue 2; }}return $ILlI1ll; }return I3467; }function TTlIlIl($userId) {$this->IlLIII1[I3626] =intval($userId); }function GetUserId() {return $this->IlLIII1[I3626]; }function getVersion($product =false, $type =false) {if (!is_array($this->IlLIIlI)) {$this->IlLIIlI =$GLOBALS[I3627]; }if (empty($this->IlLIIlI[I3617][I3628]) || empty($this->IlLIIlI[I3617][I3629])) {$this->ReadOption($data, I3617); if (isset($data[I3630])) {$this->TTlIlI1($data); }elseif (is_array($data)) {foreach ($data as $IIII111) {$this->TTlIlI1($IIII111); }}}if ($type === false && $product === false) {return $this->IlLIIlI; }return $type === false ?$this->IlLIIlI[$product] :$this->IlLIIlI[$product][$type]; }function TTlIlI1(&$IIII111) {switch ($IIII111[I3631]) {case I3632; $this->IlLIIlI[I3617][I3628] =$IIII111[I3633]; break; case I3629; $this->IlLIIlI[I3617][I3629] =$IIII111[I3633]; break; }}function compareVersions($IIlLI1I, $IlLILI1, $num =3) {$re =I3634; if (!preg_match($re, $IIlLI1I) || !preg_match($re, $IlLILI1)) return -2; $IIlLI1I =explode(I3635, $IIlLI1I); $IlLILI1 =explode(I3635, $IlLILI1); for ($i =0; $i <$num; $i++) {if ($IIlLI1I[$i] != $IlLILI1[$i]) return $IIlLI1I[$i] <$IlLILI1[$i] ?-1 :1; }return 0; }function &TTlIllT() {$res =&$this->Default; return $res; }function detectSpecialLanguageData() {if (!$this->issetOption($this->IlLII1l)) {$this->Options->setModParam($this->Name, $this->IlLII1L, false); }}function ReadOption(&$vData, $IIILLII =I3474, $IILIlI1 =I3474, $cLang =I3474) {return $this->Options->readOption($vData, $IIILLII, $IILIlI1, $cLang); }function WriteOption($IIILLII =I3474, $IILIlI1, $cValue, $IllLLL1 =false, $cLang =I3474, $IllLL1I =I3474) {return $this->Options->writeOption($IIILLII, $IILIlI1, $cValue, $IllLLL1, $cLang, $IllLL1I); }function TTlIllI($IIILLII =I3474, $IILIlI1, $cValue, $IllLLL1 =false, $cLang =I3474, $IllLL1I =I3474) {return $this->WriteOption($IIILLII, $IILIlI1, $cValue, $IllLLL1, $cLang, $IllLL1I); }function DeleteOption($IIILLII, $IILIlI1, $cLang =I3474) {return $this->Options->deleteOption($IIILLII, $IILIlI1, $cLang); }function TTlIlll() {return $this->issetOption($this->IlLII1l); }function TTlIll1($IlLILlI) {return TlTII1l($IlLILlI); }function TTlIl1T($IlLILll) {$aData =TlTI1TT($IlLILll); $this->IlLIlIL =mb_strlen($IlLILll, empty($aData[I3636]) || ($aData[I3636][I3637][I3638]) <3 ?I3639 :I3640 );return $aData; }function TTlIl1I($IlLILlL, $IlLILl1 =I3641) {$aExceptions =array( TlTII11(I3642 .TlTIllT(I3643, 2, 3) .TlTIl1I(I3644)), TlTII11(TlTIl1I(I3645) .I3646 .TlTIllT(I3647, 2, 2)), TlTII11(TlTIl1I(I3648) .I3635 .I3649 .TlTIl1I(I3650)) );foreach ($aExceptions as $IlLILLI) {if (isset($IlLILlL[$IlLILLI])) {unset($IlLILlL[$IlLILLI]); }}if (isset($this->IlLIlIl[I3651][I3538][I3652][$IlLILl1][I3653])) {foreach ($this->IlLIlIl[I3651][I3538][I3652][$IlLILl1][I3653] as $IlLILLl => $null) {if (isset($IlLILlL[$IlLILLl])) {unset($IlLILlL[$IlLILLl]); }}}if (sizeof($IlLILlL) >0) {$this->IlLIlI1 =true; }else {$IlLILLL =serialize($this->IlLIlIl[I3654]); if (mb_strlen($IlLILLL) != $this->IlLIlIL) {$this->IlLIlI1 =true; }}}function TTlIl1l() {$this->IlLIlIl =array(); }function TT1lTTl(&$oM, $isEqual =false) {if ($this->issetOption(I3655) && $this->GetOption(I3655) >0) {$sql =I3656 .I3657 .$oM->oEshop->dbTablePrefix .I3658 .I3659 .$oM->_ApplyFilters(); $oM->db->query($sql); if ($oM->db->next_record()) {if (!$isEqual && $oM->db->Record[I3660] >$this->GetOption(I3661) || $isEqual && $oM->db->Record[I3660] >= $this->GetOption(I3661)) {$oM->cms->AddStatusMsg(I3662, I3663); return false; }}}return true; }function TTlTlIl($IIILLII, $key, $Ill1Ll1 =false) {if (isset($this->IlLIIIl[$IIILLII])) {$this->Options->TTlTlIl($IIILLII, $key, $Ill1Ll1); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return true; }function TTlTlI1($IIILLII, $key, $Ill1LLI =true, $IlIlIL1 =false) {if (isset($this->IlLIIIl[$IIILLII])) {$this->Options->TTlTlI1($IIILLII, $key, $Ill1LLI, !$IlIlIL1); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return true; }function SetModOption($IIILLII, $cName, $cValue) {if (isset($this->IlLIIIl[$IIILLII])) {$this->Options->setModParam($IIILLII, $cName, $cValue); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return true; }function setModOptionLazy($IIILLII, $cName, $cValue) {if (isset($this->IlLIIIl[$IIILLII])) {$this->Options->setModParamLazy($IIILLII, $cName, $cValue); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return true; }function SetModProperty($IIILLII, $cName, $cValue) {if (isset($this->IlLIIIl[$IIILLII])) {$this->IlLIIIl[$IIILLII]->SetProperty($cName, $cValue); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return true; }function TTlIl11($IIILLII, &$aOptions) {if (isset($this->IlLIIIl[$IIILLII])) {if (is_array($aOptions)) {$this->Options->TTlTIlT($IIILLII, $aOptions); }}else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }}function GetModOption($IIILLII, $cName =I3474) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->GetOption($cName); }elseif ($this->Debug) {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1TT($IIILLII, $cName =I3474) {return $this->GetModOption($IIILLII, $cName); }function getModOptionLazy($IIILLII, $cName =I3474) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->getOptionLazy($cName); }elseif ($this->Debug) {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function GetModProperty($IIILLII, $cName =I3474, $warn =true) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->GetProperty($cName, $warn); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1TI($IIILLII, $cName =I3474) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->GetAOption($cName); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1Tl($IIILLII, $cName =I3474) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->TTlTTTI($cName); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function issetModOption($IIILLII, $cName =I3480) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->Options->issetModParam($IIILLII, $cName); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function issetModProperty($IIILLII, $cName =I3480) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->Properties->issetModParam($IIILLII, $cName); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1T1($IIILLII, $cName) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->Options->issetAndTrueModParam($IIILLII, $cName); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1IT($IIILLII, $cName) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->Properties->issetAndTrueModParam($IIILLII, $cName); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1II($IIILLII, &$cValue) {if (isset($this->IlLIIIl[$IIILLII])) {$this->IlLIIIl[$IIILLII]->TTlII11($cValue); }else {trigger_error(I3666 .$IIILLII .I3665, E_USER_WARNING); }return true; }function TTlI1Il($IIILLII, $IIILl1L) {if (isset($this->IlLIIIl[$IIILLII])) {$this->IlLIIIl[$IIILLII]->SetFrontLink($IIILl1L); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return true; }function GetModFrontLink($IIILLII, $Ill11lL =0, $Ill11LI =false) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->GetFrontLink($Ill11lL, $Ill11LI); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTlI1I1($IIILLII) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$res =$this->IlLIIIl[$IIILLII]->TTlIT1I(); }else {trigger_error(I3664 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function &GetModule($IIILLII) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$vMod =&$this->IlLIIIl[$IIILLII]; if (is_object($vMod)) {$res =&$vMod; }}elseif ($IIILLII == I3526) {$res =&$this->Unknown; }return $res; }function &TTlI1lT($IIILLII) {$res =false; if (isset($this->IlLIIIl[$IIILLII])) {$vMod =&$this->IlLIIIl[$IIILLII]; if (is_object($vMod)) {$res =&$vMod; }}elseif ($IIILLII == I3526) {$res =&$this->Unknown; }return $res; }function &TTlI1lI($IIILl1L) {$res =false; foreach ($this->IlLIIIl as $vMod) {$modLink =$vMod->GetAdminLink(); if (substr($modLink, 0, 10) == I3667) {$aUrl =parse_url($modLink); if (isset($aUrl[I3668])) {parse_str($aUrl[I3668], $IIl1Il1); mb_internal_encoding(I3640); }if (isset($IIl1Il1[I3669])) {$modLink =$IIl1Il1[I3669] .I3468; }}if ($modLink == $IIILl1L) {$res =&$vMod; break; }}return $res; }function TTlI1ll( &$module, $optionName, $IIlI11L, $IlLILL1, $IlLIL1I =FALSE, $value =I3474, $callback =NULL ){if (!isset($this->IlLIIl1)) {$this->IlLIIl1 =array(); $this->IlLIIlL =array(); $this->IlLIILl =array(); $this->_isInheritanceSet =false; $this->IlLIILI =array(); }$modName =empty($module->Name) ?I3670 :$module->Name; if (!isset($this->IlLIIl1[$modName][$optionName][$IIlI11L])) {$this->IlLIIl1[$modName][$optionName][$IIlI11L] =array(); }if (in_array($IlLILL1, $this->IlLIIl1[$modName][$optionName][$IIlI11L]) === false) {$this->IlLIIl1[$modName][$optionName][$IIlI11L][] =$IlLILL1; }if ($IlLIL1I) {$this->SetModOption($modName, $optionName, $value); $this->IlLIILl[$modName][$optionName] =1; }elseif (!is_null($callback)) {$this->IlLIILI[$modName .I3635 .$optionName] =$callback; }return true; }function TTlI1l1($vModName =I3480) {$IlLIL1l =true; $IlLIL1L =0; $IlLIL11 =true; if ($vModName != I3480) {if (isset($this->IlLIIl1[$vModName])) {$IlLI1II[$vModName] =$this->IlLIIl1[$vModName]; }else {$IlLI1II =Array(); }}else {$IlLI1II =$this->IlLIIl1; }while ($IlLIL1l && $IlLIL11 && $IlLIL1L++ <5) {$IlLI1Il =Array(); $IlLIL1l =false; $IlLIL11 =false; foreach ($IlLI1II as $moduleName => $aOptions) {foreach ($aOptions as $optionName => $IlLI1IL) {foreach ($IlLI1IL as $IIlI11L => $IlLI1I1) {if ($IIlI11L != I3670 && !$this->TTlIII1($IIlI11L)) {unset($IlLI1II[$moduleName][$optionName][$IIlI11L]); continue; }foreach ($IlLI1I1 as $index => $IlLILL1) {$error =false; if ($moduleName == $IIlI11L && $optionName == $IlLILL1) {trigger_error(I3671 .$IIlI11L .I3672 .$IlLILL1 .I3673, E_USER_WARNING); $error =true; unset($IlLI1II[$moduleName][$optionName][$IIlI11L][$index]); unset($this->IlLIIl1[$moduleName][$optionName][$IIlI11L][$index]); }if (($IIlI11L != I3670 ?!$this->issetModOption($IIlI11L, $IlLILL1) :!$this->issetOption($IlLILL1))) {$IlLIL1l =true; $error =true; $IlLI1Il[] =$moduleName .I3672 .$optionName .I3674 .$IIlI11L .I3672 .$IlLILL1; }if (!$error) {$IlLIL11 =true; unset($IlLI1II[$moduleName][$optionName][$IIlI11L][$index]); if (!(isset($this->IlLIILl[$moduleName][$optionName]) || isset($this->IlLIIlL[$moduleName][$optionName]))) {if ($this->IlLIIL1) {$this->IlLIIlL[$moduleName][$optionName] =$IIlI11L .I3675 .$IlLILL1; if ($moduleName != I3670) {$this->SetModOption($moduleName, $optionName, I3474); }else {$this->SetOption($optionName, I3474); }}else {if ($moduleName != I3670) {if (!$this->issetModOption($moduleName, $optionName)) {$this->SetModOption($moduleName, $optionName, I3474); }}else {if (!$this->issetOption($optionName)) {$this->SetOption($optionName, I3474); }}}}}}}}}}if ($this->Debug && sizeof($IlLI1Il) >0) {foreach ($IlLI1Il as $msg) {trigger_error($msg, E_USER_WARNING); }}$this->SetModOption(I3676, I3677, $this->IlLIIl1); $this->SetModOption(I3676, I3678, $this->IlLIIlL); }function TTlI11T($vModName =I3480, $force =false) {if (is_null($this->IlLIIlL) || (!$force && $this->_isInheritanceSet)) {return; }$this->TTlI1l1($vModName); $IlLI1lI =array(); if ($vModName != I3480) {if (isset($this->IlLIIlL[$vModName])) {$IlLI1ll[$vModName] =&$this->IlLIIlL[$vModName]; }else {$IlLI1ll =Array(); }}else {$IlLI1ll =&$this->IlLIIlL; }foreach ($IlLI1ll as $moduleName => $IlLI1lL) {foreach ($IlLI1lL as $optionName => $data) {list ($IIlI11L, $IlLILL1) =explode(I3675, $data); do {$IlLI1lI[$IIlI11L][$IlLILL1][$moduleName][] =$optionName; $IlLI1l1 =false; if (isset($this->IlLIIlL[$IIlI11L][$IlLILL1])) {list ($IIlI11L, $IlLILL1) =explode(I3675, $this->IlLIIlL[$IIlI11L][$IlLILL1]); $IlLI1l1 =true; }}while ($IlLI1l1); }}$inheritance =$IlLI1lI; foreach ($IlLI1lI as $IIlI11L => $IlLI1LI) {foreach ($IlLI1LI as $IlLI1Ll) {foreach ($IlLI1Ll as $moduleName => $options) {foreach ($options as $option) {unset($inheritance[$moduleName][$option]); }}}}foreach ($inheritance as $IIlI11L => $IlLI1LI) {foreach ($IlLI1LI as $IlLILL1 => $IlLI1Ll) {$value =$IIlI11L != I3670 ?$this->GetModOption($IIlI11L, $IlLILL1) :$this->GetOption($IlLILL1); foreach ($IlLI1Ll as $moduleName => $options) {foreach ($options as $option) {if (isset($this->IlLIILI[$moduleName .I3635 .$option])) {$value =call_user_func( $this->IlLIILI[$moduleName .I3635 .$option], $option, $value );}$moduleName != I3670 ?$this->SetModOption($moduleName, $option, $value) :$this->SetOption($option, $value); }}}}$this->_isInheritanceSet =true; }function &GetAllModules() {$res =&$this->IlLIIIl; return $res; }function &GetInstalledModuleNames($ownerName =null) {$res =false; if (is_null($ownerName)) {$aMods =&$this->GetAllModules(); }else {$aMods =&$this->GetModulesByOwner($ownerName); }if ($aMods != false) {$res =Array(); foreach (array_keys($aMods) as $name) {if ($aMods[$name]->TTlIII1()) {$res[] =$name; }}}return $res; }function &GetModulesByOwner($IIL1L11) {$res =false; if (isset($this->Owners[$IIL1L11]) && $this->Owners[$IIL1L11][I3679] && isset($this->IlLIIIL[$IIL1L11])) {$res =&$this->IlLIIIL[$IIL1L11]; }else {trigger_error(I3680 .$IIL1L11 .I3665, E_USER_WARNING); }return $res; }function TTlI11I() {return $this->IIL1Ll1; }function IsFrontAllowed($IIILLII =I3474) {$res =false; $tmp =&$this->GetModule($IIILLII); if (is_object($tmp)) {$res =($tmp->TTlIII1() && $tmp->IsFrontAllowed()); }return $res; }function TTlI11l($IIILLII) {return $this->IsFrontAllowed($IIILLII); }function TTlI111($IIILLII) {$res =false; $tmp =&$this->GetModule($IIILLII); if (is_object($tmp)) {$res =($tmp->TTlIII1() && $tmp->IsFrontAllowed() && !$tmp->issetAndTrueProperty(I3681)); if (!$res) {if ($tmp->issetProperty(I3682) && $tmp->getProperty(I3682)) {$Ill111I =&$tmp->TTlIIIT(); if (is_object($Ill111I) && $Ill111I->TTlIII1() && $Ill111I->IsFrontAllowed()) {$res =true; }}}}return $res; }function IsInstalled($IIILLII =I3474) {return $this->TTlIII1($IIILLII); }function TTlIIT1($IIILLII =I3474) {return $this->TTlIII1($IIILLII); }function IsPresentInPMandPublic($IIILLII =I3474) {$res =false; $tmp =&$this->GetModule($IIILLII); if (is_object($tmp)) {$res =$tmp->IsPresentInPMandPublic(); }return $res; }function IsOwnerInstalled($IIL1L11) {$res =false; if (isset($this->Owners[$IIL1L11]) && $this->Owners[$IIL1L11][I3679]) {$res =true; }return $res; }function SetOwnerInstalled($IIL1L11, $IlLI1LL) {$res =false; if (isset($this->Owners[$IIL1L11])) {$this->Owners[$IIL1L11][I3679] =$IlLI1LL; if (!$IlLI1LL) {$modlist =&$this->IlLIIIL[$IIL1L11]; foreach ($modlist as $vModName => $vData) {$vMod =&$modlist[$vModName]; $vMod->TTlIITl(false); }}}return $res; }function TTllTTT($IIL1L11, $IlLI1LL) {return $this->SetOwnerInstalled($IIL1L11, $IlLI1LL); }function SetOwner($IIL11ll) {$this->Owner =$IIL11ll; if (!isset($this->Owners[$IIL11ll])) {$this->Owners[$IIL11ll] =Array(); $this->Owners[$IIL11ll][I3679] =true; }}protected function TTlIII1($Ill11LL =I3474) {$tmp =&$this->GetModule($Ill11LL); $res =is_object($tmp) ?$tmp->TTlIII1() :FALSE; return $res; }function OwnerSetData($IIL11ll, $cName, $cValue) {$res =false; if (isset($this->Owners[$IIL11ll])) {$this->Owners[$IIL11ll][$cName] =$cValue; $res =true; }else {trigger_error(I3683 .$IIL11ll .I3665, E_USER_WARNING); }return $res; }function OwnersAllSetOption($IlLI1L1, $aData) {foreach (array_keys($this->Owners) as $owner) {if (isset($aData[$owner])) {$this->Owners[$owner][$IlLI1L1] =$aData[$owner]; }}return true; }function ModAllSetOption($IlLI1L1, $aData) {foreach ($aData as $IlLI11I => $cValue) {if (isset($this->IlLIIIl[$IlLI11I])) {$this->IlLIIIl[$IlLI11I]->SetOption($IlLI1L1, $cValue); }}return true; }function TTllTTl($IILIlI1) {$res =array(); $IILllLl =&$this->GetAllModules(); foreach ($IILllLl as $vModName => $vVal) {if ($IILllLl[$vModName]->issetOption($IILIlI1)) {$res[$vModName] =$IILllLl[$vModName]->GetOption($IILIlI1); }}return $res; }function TTllTT1($IlLI11l) {$res =array(); $IILllLl =&$this->GetAllModules(); foreach ($IILllLl as $vModName => $vVal) {foreach ($IlLI11l as $IlLI11L) {if ($IILllLl[$vModName]->issetOption($IlLI11L)) {$res[$vModName][$IlLI11L] =$IILllLl[$vModName]->GetOption($IlLI11L); }}}return $res; }function TTllTIT($IlLI111) {$res =array(); $IILllLl =&$this->GetAllModules(); foreach ($IILllLl as $vModName => $vVal) {foreach ($IlLI111 as $IlLlIII) {if ($IILllLl[$vModName]->issetProperty($IlLlIII)) {$res[$vModName][$IlLlIII] =$IILllLl[$vModName]->GetProperty($IlLlIII); }}}return $res; }function GetModNames() {return array_keys($this->IlLIIIl); }function OwnerGetData($IIL11ll, $cName =I3480) {return empty($cName) ?$this->Owners[$IIL11ll] :(isset($this->Owners[$IIL11ll][$cName]) ?$this->Owners[$IIL11ll][$cName] :null); }function &GetOwnersList() {return $this->Owners; }function TTllTII() {$res =I3480; foreach ($this->Owners as $cName => $cData) {$res =$cName; break; }return $res; }function &TTllTIl($Ill1LI1) {$res =false; if (isset($this->Ill1111[$Ill1LI1][I3684])) {$res =$this->GetModule($this->Ill1111[$Ill1LI1][I3684]); }return $res; }function AddTableToList(&$oModule) {$IILIll1 =$oModule->GetTableName(); if ($IILIll1 != I3459 && $IILIll1 != $this->TablePrefix .I3459) {$this->Ill1111[$IILIll1] =array(I3509 => $IILIll1, I3684 => $oModule->GetName()); }}function AddChildTable(&$oModule, $Ill1LI1) {$IILIll1 =$Ill1LI1; if ($IILIll1 != I3459 && $IILIll1 != $this->TablePrefix .I3459) {$this->Ill1111[$IILIll1] =array(I3509 => $IILIll1, I3684 => $oModule->GetName()); }}function &AddModule($IIILLII, $IlllLlL =0, $Ill1LI1 =I3480) {$res =false; if (in_array($IIILLII, $this->IlLIIll)) {trigger_error(I3685 .$IIILLII .I3686, E_USER_ERROR); }unset($this->Modules[$IIILLII]); $this->Modules[$IIILLII] =clone($this->Default); $this->Modules[$IIILLII]->Init($IIILLII, $IlllLlL); $this->Modules[$IIILLII]->Options =&$this->Options; $this->Options->TTlTIII($IIILLII, array()); $this->Modules[$IIILLII]->Properties =&$this->Properties; $this->Properties->TTlTIII($IIILLII, array()); if (empty($this->IlLIIIL[$this->Owner])) {$this->OwnerSetData($this->Owner, I3687, $IIILLII); }$this->Modules[$IIILLII]->TTlT1ll($this->Owner); if (!isset($this->IlLIIIl[$IIILLII])) {$this->IIL1Ll1++; }else {trigger_error(I3688 .$IIILLII .I3665, E_USER_WARNING); }$this->IlLIIIl[$IIILLII] =&$this->Modules[$IIILLII]; $this->IlLIIIL[$this->Owner][$IIILLII] =&$this->Modules[$IIILLII]; if (!empty($Ill1LI1)) {$this->Modules[$IIILLII]->SetTableName($Ill1LI1); }$this->AddTableToList($this->Modules[$IIILLII]); $res =&$this->Modules[$IIILLII]; return $res; }function &TTllTI1($IlLlIIl, $IlllLl1, $IlllLlL =0, $Ill1LI1 =I3480) {$res =false; $vMod =&$this->GetModule($IlLlIIl); if (!is_object($vMod)) {trigger_error(I3689 .$IlLlIIl .I3665, E_USER_ERROR); }$res =&$vMod->TTlTTTT($IlllLl1, $IlllLlL, $this->Default); if (is_object($res) && !empty($Ill1LI1)) {$res->SetTableName($Ill1LI1); }if (!isset($this->IlLIIIl[$IlllLl1])) {$this->IIL1Ll1++; }else {trigger_error(I3688 .$IlllLl1 .I3665, E_USER_WARNING); }$this->IlLIIIl[$IlllLl1] =&$res; $this->IlLIIIL[$res->GetOwnerName()][$IlllLl1] =&$res; $this->AddTableToList($res); return $res; }function TTllTlT($IIILLII) {$res =false; if (is_object($this->Modules[$IIILLII])) {unset($this->IlLIIIL[$this->Modules[$IIILLII]->GetOwnerName()][$IIILLII]); unset($this->Modules[$IIILLII]); unset($this->IlLIIIl[$IIILLII]); $res =true; }else {trigger_error(I3690 .$IIILLII .I3665, E_USER_WARNING); }return $res; }function TTllTlI($name =I3474) {return $this->GetOption($name); }function GetProperty($name =I3474, $warn =true) {$res =$this->TTlT111($this->Properties, $name, $warn); return $res; }function TTllTll($name =I3474, $warn =true) {return $this->GetProperty($name, $warn); }function TTllTl1($IILIlI1, $cType =I3691) {return $this->TTllT1I(I3515, $IILIlI1, $cType); }function TTllT1T($IlLlIIL =I3692, $cType =I3691) {return $this->TTllT1I(I3693, $IlLlIIL, $cType); }function TTllT1I($container, $IlLlII1, $cType) {if (empty($IlLlII1)) {$IlLlII1 =I3692; }$defaultValue =$IlLlII1 == I3694 ?1000 :I3474; $aIndex =array(); $aRes =array(); $i =0; $level2 =!empty($IlLlIlI); if ($cType == I3695) {$IlLlIll =&$this->Owners; }else {$IlLlIll =&$this->IlLIIIl; }if ($container == I3517) {$dump =$this->Options->TTlTIIl(); }else if ($container == I3518) {$dump =$this->Properties->TTlTIIl(); }$IlLlIlL =$cType == I3696; foreach ($IlLlIll as $vName => $vData) {if ($IlLlIlL) {$aIndex[I3697][$i] =isset($vData[$IlLlII1]) ?$vData[$IlLlII1] :$defaultValue; }else {$aIndex[I3697][$i] =isset($dump[$vName][$IlLlII1]) ?$dump[$vName][$IlLlII1] :$defaultValue; }$aIndex[I3631][$i] =$vName; $i++; }$c =$i; array_multisort($aIndex[I3698], SORT_NUMERIC, SORT_ASC, $aIndex[I3509]); for ($i =0; $i <$c; $i++) {$aRes[$aIndex[I3509][$i]] =&$IlLlIll[$aIndex[I3509][$i]]; }if ($cType == I3695) {$this->Owners =$aRes; }else {$this->IlLIIIl =$aRes; }return true; }function SaveOptions($vModName =I3699, $IlLlIl1 =TRUE) {if ($vModName == I3700) {$this->TTlI11T(); $modlist =&$this->GetAllModules(); }else {$this->TTlI11T($vModName, true); $vMod =$this->GetModule($vModName); if (!is_object($vMod)) {trigger_error(I3701 .$vModName .I3665, E_USER_WARNING); return false; }$modlist =array($vModName => $vMod); }if (!$this->Options->db->TT1lT11(array(I3702 => I3703))) {trigger_error(I3704, E_USER_WARNING); return false; }$res =true; foreach ($modlist as $vModName => $vData) {$vMod =&$modlist[$vModName]; $res =$res && $this->Options->TTlTlT1($vModName, $vMod->TTlII1l()); if( AMI_ModDeclarator::getInstance()->isRegistered($vModName) && AMI_ModDeclarator::getInstance()->getAttr($vModName, I3705, FALSE) ){$IlLlILl =$this->Options->TTlTI11($vModName); if ($IlLlILl) {$res =$res && $this->Options->TTlTlT1($vModName, $IlLlILl, I3706); }else {$sql =I3707 .I3708 .$vModName .I3489; $this->Options->db->query($sql, DBC_SYS_QUERY); }}}if ($IlLlIl1) {$this->TTllT11(); }$this->Options->db->TT1lITT(); $this->Cache->ClearAdd(I3700); return $res; }function TTllT1l($aModules =array()) {$res =false; if (sizeof($aModules)) {foreach (array_keys($aModules) as $index => $module) {if (!$this->isInstalled($aModules[$index])) {unset($aModules[$index]); }}}else {$aModules =$this->GetInstalledModuleNames(); }if (sizeof($aModules)) {$this->Options->TTlTlTl($aModules, true); if (sizeof($this->Options->IllLLLI)) {if ($this->Debug && !(isset($_GET[I3709]) && $_GET[I3709] == I3710 && isset($_GET[I3711]))) {trigger_error(I3712 .implode(I3713, $this->Options->IllLLLI) .I3665); }$res =$this->Options->IllLLLI; }else {$res =true; }}return $res; }function SaveCoreOptions($IIL1Lll =I3700, $IlLlILL =false, $IlLlIL1 =false, $IlLlI1I =false) {$res =false; if ($IIL1Lll == I3700) {if (!$IlLlILL) {$this->TTlI11T(); }$this->SaveCoreOptions(I3494, $IlLlILL, $IlLlIL1, $IlLlI1I); }$IlLlI1l =$this->TTlII1l($IIL1Lll); if ($IlLlILL) {$IIII11I =array(); $res =$this->ReadCoreOptions($IIII11I, $IIL1Lll); }if ($IlLlI1I !== false) {$IlLlI1l[I3693] =&$IlLlI1I; }$res =$this->Options->TTlTlT1(I3615, $IlLlI1l, I3714 .$IIL1Lll); $this->TTllT11(); $this->Cache->ClearAdd(I3700); return $res; }function TTllT11() {$IlLlI1l =$this->TTlII1l(I3699); $res =TRUE; if ($this->opt && (!RUN_UPDATE || !empty($GLOBALS[I3715]))) {$IlLlI1L =serialize(array(I3517 => $this->opt +$IlLlI1l[I3517])); $res =$this->Options->writeOption(I3716, I3717, mb_strlen($IlLlI1L), addslashes($IlLlI1L)) && $res; }return $res; }function TTllITT() {$this->TTllT11(); }function ReadCoreOptions(&$IIII11I, $IIL1Lll =I3494, $IlLlI11 =I3700) {$dump =$this->Properties->read($IIL1Lll); $res =is_array($dump); if ($res) {$IIII11I =is_array($dump[I3518]) ?$dump[I3518] :array(); if (in_array($IlLlI11, array(I3699, I3718))) {$this->TTlII11($dump); }}return $res; }function TTlII1l($IIL1Lll =I3474) {$res =array(); $res[I3515] =$this->Options->getModParam(null); $res[I3693] =$this->Properties->getModParam(null); return $res; }function TTlII11(&$vData) {$this->Options->TTlTIII($this->Name, $vData[I3517]); return true; }function TTllITI($IIII11I, &$IlLllII, $IlLllIl, $IlLllIL =Array()) {$res =false; $IlLllII =Array(); $IlLllI1 =sizeof($IlLllIL) >0; $IlLlllI =$IlLllI1; if (!$IlLllIl && !empty($IIII11I[I3719]) && $IIII11I[I3719] == $GLOBALS[I3720] .I3721 .$GLOBALS[I3722]) {if (isset($IIII11I[I3723][I3609])) {$res =true; $this->Properties->TTlTIII($this->Name, $IIII11I[I3724][I3615]); $IlLlllI =false; if ($IlLllI1) {$IlLlllL =Array(); foreach ($IlLllIL as $owner) {$IlLlllL += array_keys($this->GetModulesByOwner($owner)); }}else {$IlLlllL =array_keys($this->IlLIIIl); }if (($index =array_search(I3725, $IlLlllL)) !== false) {unset($IlLlllL[$index]); }foreach ($IlLlllL as $modName) {if ($this->IlLIIIl[$modName]->TTlIII1()) {$IlLllII[] =$modName; if (isset($IIII11I[I3723][$modName])) {$IlLIlLL =&$this->IlLIIIl[$modName]; $IlLIlLL->TTlIlTI($IIII11I[I3723][$modName]); if (isset($IIII11I[I3724][$modName][I3518][I3694]) ){$ILlI1lL =$this->OwnerGetData($IlLIlLL->Owner, I3726); $ILlI1l1 =FALSE; $taborder =$IIII11I[I3724][$modName][I3518][I3694]; if ($ILlI1lL) {if ($taborder <$ILlI1lL) {$ILlI1l1 =TRUE; }}else {$ILlI1l1 =TRUE; }if ($ILlI1l1) {$this->OwnerSetData($IlLIlLL->Owner, I3687, $modName); $this->OwnerSetData($IlLIlLL->Owner, I3726, $taborder); }}}else {if (!FIRST_PLUGIN_RUN) {trigger_error(I3727 .$modName .I3665); }$res =false; }}}}}if ($IlLlllI) {foreach ($this->IlLIIIl as $modName => $vMod) {if ($this->IlLIIIl[$modName]->TTlIII1()) {$IlLllII[] =$modName; }}}return $res; }function &TTlIlTT($Ill111l =array()) {$IIII11I =Array(); $IIII11I[I3719] =$GLOBALS[I3720] .I3721 .$GLOBALS[I3722]; $IIII11I[I3723][I3609] =$this->Properties->TTlTII1($this->Name); foreach ($this->IlLIIIl as $modName => $vMod) {if ($this->IlLIIIl[$modName]->TTlIII1() || in_array($modName, $Ill111l)) {$IIII11I[I3723][$modName] =$this->IlLIIIl[$modName]->TTlIlTT(); }}return $IIII11I; }function SaveDump(&$IlLlll1, $IILlLL1 =I3728) {$db =new DB_Si; $db->setAttr(I3729, false); if (!$db->TT1lT11(array(I3702 => I3703))) {return false; }$dump =serialize($IlLlll1); $IlLllLI =mb_strlen($dump); $cName =I3730 .$IILlLL1; if (function_exists(I3731)) $dump =gzcompress($dump, 4); $sql =I3732 .$cName .I3489; $db->query($sql, DBC_SYS_QUERY); if ($db->next_record()) {$sql =I3733 .I3734 .I3735 .$IlLllLI .I3736 .I3737 .addslashes($dump) .I3738 .I3739 .$db->Record[I3479] .I3489; }else {$sql =I3740 .I3734 .I3741 .I3742 .$cName .I3736 .I3735 .$IlLllLI .I3736 .I3737 .addslashes($dump) .I3738; }$db->query($sql, DBC_SYS_QUERY); $db->TT1lITT(); return true; }function TTllITl(&$IlLllLl, $IILlLL1 =I3728) {$res =false; $cName =I3730 .$IILlLL1; $db =new DB_Si; $db->setAttr(I3729, false); $sql =I3743 .$cName .I3744; $db->query($sql, DBC_SYS_QUERY); if ($db->next_record()) {$dump =&$db->Record[I3745]; $IlLllLI =$db->Record[I3746]; if (function_exists(I3747)) $dump =gzuncompress($dump); if (mb_strlen($dump) != $IlLllLI) {trigger_error(I3748 .$IlLllLI .I3749 .mb_strlen($dump) .I3665, E_USER_WARNING); }else {$IlLllLl =unserialize($dump); $res =true; }}return $res; }function TTllIT1() {return $this->IlLIII1[I3750]; }function UpdateRightsVersion() {$ver =time(); $db =new DB_si; if ($GLOBALS[I3751] <2) {$sql =I3752 .$ver .I3753; }else {$sql =I3754 .$ver .I3755; }$db->execute($sql, DBC_SYS_QUERY); $this->IlLIII1[I3750] =$ver; $oFileCache =AMI::getResource(I3756); $oFileCache->reset(I3757); return $ver; }function TTllIIT($IlLllLL, $IlLllL1 =false) {if (!isset($this->IlLIII1[I3758])) {$this->IlLIII1[I3758] =array(); }$data =array( I3759 => array(), I3760 => array(), I3761 => I3649, I3762 => 0, I3763 => 0, I3750 => 0 );if ($IlLllLL == false) return $data; if (isset($this->IlLIII1[I3758][$IlLllLL])) return $this->IlLIII1[I3758][$IlLllLL]; $this->IlLIII1[I3758][$IlLllLL] =array(); $db =new DB_si; if ($GLOBALS[I3751] <2) {$sql =I3764; }else {$sql =I3765; }$db->query($sql, DBC_SYS_QUERY); $db->next_record(); if ($db->Record[I3766] == $IlLllLL){ $data[I3763] =1; }$data[I3767] =$db->Record[I3750]; if ($this->TTlIII1(I3610)) {$moderatorGroups =I3768; $IlLll1I =I3649; $IlLll1l =I3649; $IlLll1L =empty($data[I3763]) && !empty($GLOBALS[I3769]) && $GLOBALS[I3769]->GetVar(I3770); $sql =I3771 .I3772 .I3773 .I3774 .(int)$IlLllLL .I3775 .(int)$IlLllL1; $db->query($sql, DBC_SYS_QUERY); if ($db->num_rows() >0) {while ($db->next_record()) {$data[I3759][] =(int)$db->Record[I3476]; $data[I3776] .= I3777 .$db->Record[I3776]; $data[I3762] |= (int)$db->Record[I3762]; if($db->Record[I3778]){ $moderatorGroups .= I3779 .$db->Record[I3761]; }if($db->Record[I3780]){ $IlLll1I .= I3779 .$db->Record[I3761]; }if($IlLll1L){ if($db->Record[I3762]){ $IlLll1l .= I3779 .$db->Record[I3761]; }}}}else {$sql =I3781; $db->query($sql, DBC_SYS_QUERY); $db->next_record(); $data[I3759][0] =(int)$db->Record[I3476]; $data[I3761] =$db->Record[I3761]; $data[I3762] =(int)$db->Record[I3762]; $data[I3778] =0; $data[I3780] =(int)$db->Record[I3780]; if ($data[I3782][0] == 0) {trigger_error(I3783, E_USER_ERROR); }}$IlLll11 =array(); $sql =I3784 .I3785 .I3786 .$moderatorGroups .I3787 .I3786 .$IlLll1I .I3788 .($IlLll1L ?I3789 .$IlLll1l .I3790 :I3474) .I3791 .I3792 .$data[I3761] .I3793; $db->query($sql, DBC_SYS_QUERY); while ($db->next_record()) {$modname =$db->Record[I3794]; if (($mod =&$this->GetModule($modname)) !== false && $mod->TTlIII1()) {$IlLll11[$modname][I3778] =(isset($IlLll11[$modname][I3778]) ?(int)$IlLll11[$modname][I3778] :0) |$db->Record[I3778]; $IlLll11[$modname][I3780] =(isset($IlLll11[$modname][I3780]) ?(int)$IlLll11[$modname][I3780] :0) |$db->Record[I3780]; if($IlLll1L){ $IlLll11[$modname][I3641] =(isset($IlLll11[$modname][I3641]) ?(int)$IlLll11[$modname][I3641] :0) |$db->Record[I3641]; }$IlLll11[$modname][I3490][] =$db->Record[I3795]; }}$data[I3760] =$IlLll11; }else{ $IlLlLII =array(); foreach($this->GetModOption(I3796, I3797) as $IlLIl1L){ $IlLlLII[$IlLIl1L] =array( I3778 => 0, I3780 => 1, I3641 => 0, I3490 => array( I3798, I3799, I3800, I3801, I3802 ));}$data[I3760] =$IlLlLII; }$this->IlLIII1[I3758][$IlLllLL] += $data; return $data; }function IsSysUser($userId =false){ if($userId === false){ $userId =$this->GetUserId(); }if(!$userId){ return false; }$data =$this->TTllIIT($userId); return $data[I3763] != 0; }function IsModerator($IIILLII, $userId) {$res =false; if ($this->IsSysUser($userId)) {$res =true; }else {$aRights =$this->TTllIIT($userId); if (isset($aRights[I3760][$IIILLII]) && $aRights[I3760][$IIILLII][I3778]) {$res =true; }}return $res; }function TTllIII($IIILLII, $userId) {return ($this->IsSysUser($userId)) ?I3803 :(($this->IsModerator($IIILLII, $userId)) ?I3804 :I3626); }function TTllIIl($userId) {if ($this->IsSysUser($userId)) {$modlist =array(); $IILllLl =&$this->GetAllModules(); reset($IILllLl); while (list($name, )=each($IILllLl)) {$vMod =&$IILllLl[$name]; if ($vMod->HaveParent() || !$vMod->TTlIII1()) continue; $modlist[] =$name; }}else {$data =$this->TTllIIT($userId); $modlist =array_keys($data[I3760]); }$modlist[] =I3805; return $modlist; }function TTllII1($userId) {$owners =array(); $IlLlllL =$this->TTllIIl($userId); foreach ($IlLlllL as $i => $name) {$mod =&$this->GetModule($name); $oname =$mod->GetOwnerName(); if ($this->IsOwnerInstalled($oname)) $owners[] =$oname; }return $owners; }function TTllIlT($groupId) {if (!isset($this->IlLIII1[I3806])) $this->IlLIII1[I3806] =array(); $data =array(); $data[I3807] =Array(); $data[I3761] =0; $groupId =intval($groupId); if (isset($this->IlLIII1[I3806][$groupId])) return $this->IlLIII1[I3806][$groupId]; $this->IlLIII1[I3806][$groupId] =array(); $db =new DB_si; $sql =I3808 .$groupId; $db->query($sql, DBC_SYS_QUERY); if (!$db->next_record()) trigger_error(I3809 .$groupId .I3810, E_USER_ERROR); $data[I3776] =$db->Record[I3776]; $IlLll11 =array(); $sql =I3811 .$data[I3776] .I3812; $db->query($sql, DBC_SYS_QUERY); while ($db->next_record()) {$modname =$db->Record[I3794]; if (($mod =&$this->GetModule($modname)) !== false && $mod->TTlIII1()) $IlLll11[$modname][I3490][] =$db->Record[I3795]; }$data[I3760] =$IlLll11; $this->IlLIII1[I3806][$groupId] += $data; return $data; }function TTllIlI($groupId, $modName, $IlLlLIl =false) {$groupId =intval($groupId); if (!$groupId) return 0; $data =$this->TTllIlT($groupId); if (!($mod =&$this->GetModule($modName)) || !$mod->TTlIII1()) {trigger_error(I3813 .$groupId .I3814 .$modName .I3815 .$modName .I3816, E_USER_WARNING); return 0; }$access =0; if (!isset($data[I3760][$modName])) return $access; $access |= $mod->TTlITTl($data[I3760][$modName][I3490]); if (!$IlLlLIl) return $access; $IlLlLIL =&$mod->GetSubModules(); if (!is_array($IlLlLIL)) return $access; foreach ($IlLlLIL as $modName => $tmp) {if (!isset($data[I3760][$modName])) continue; $mod =&$IlLlLIL[$modName]; $access |= $mod->TTlITTl($data[I3760][$modName][I3490]); }return $access; }function TTllIll($modName, $userId =false) {if ($userId === false) $userId =$this->GetUserId(); $data =$this->TTllIIT($userId); if (!is_array($data[I3760][$modName])) return array(); return $data[I3760][$modName]; }function TTllIl1($modName, $userId =false) {if ($userId === false) $userId =$this->GetUserId(); $data =$this->TTllIll($modName, $userId); if (!($mod =&$this->GetModule($modName)) || !$mod->TTlIII1()) {trigger_error(I3817 .$modName .I3814 .$userId .I3815 .$modName .I3816, E_USER_WARNING); return 0; }$access =$mod->TTlITTl($data); return $access; }function TTllI1T($groupId) {$groupId =intval($groupId); if (!$groupId) return array(); $data =$this->TTllIlT($groupId); return $data[I3760]; }function TTllI1I($cLang, $IlLllL1 =false) {$IlLllLL =$this->GetUserId(); if (isset($this->IlLIII1[I3818]) && $IlLllLL === $this->IlLIII1[I3818]) return; $this->IlLIII1[I3818] =Array(); $this->IlLIII1[I3782] =Array(); $this->IlLIII1[I3776] =I3768; $this->IlLIII1[I3819] =0; $this->IlLIII1[I3820] =$cLang; $this->IlLIII1[I3767] =0; if ($IlLllLL == false) return; $IlLlLI1 =$this->TTllIIT($IlLllLL, $IlLllL1); $this->IlLIII1[I3759] =$IlLlLI1[I3759]; $this->IlLIII1[I3761] =$IlLlLI1[I3761]; $this->IlLIII1[I3762] =$IlLlLI1[I3762]; $this->IlLIII1[I3767] =$IlLlLI1[I3750]; }function TTllI1l($cName =I3480, $IlLllLL =false) {if (!empty($cName)) {$userId =$IlLllLL === false ?$this->GetUserId() :$IlLllLL; $name =mb_strtolower($cName); if ($this->Debug && !isset($this->IlLIII1[I3821][$userId][$name])) {trigger_error(I3822 .$name .I3665, E_USER_WARNING); }$res =$this->IlLIII1[I3821][$userId][$name]; }else {$res =$this->IlLIII1[I3821][$userId]; }return $res; }function HasRecordRights($IIl11LI) {$vMod =$this->TTllTIl($IIl11LI); return is_object($vMod) && $vMod->issetAndTrueProperty(I3823); }function GetRightsFields(&$aLexems, $IIl11LI) {$aFileds =Array(); $vMod =&$this->TTllTIl($IIl11LI); if (is_object($vMod) && $vMod->issetAndTrueProperty(I3823)) {foreach (Array(I3824) as $col) {$found =false; $regCol =preg_quote($col, I3825); foreach ($aLexems as $lexem) {if ((mb_substr($lexem, 0, 1) != I3489) && preg_match(I3826 .$regCol .I3827, $lexem)) {$found =true; break; }}if (!$found) {switch ($col) {case I3824: $val =intval($this->GetUserId()); break; }$aFileds[$col] =$val; }}}return $aFileds; }function GetRights($IlLlLlI, $cType =I3828) {return $this->IsSysUser() ?SYS_A_RIGHT :SYS_R_RIGHT; }function HostMode() {if ($this->Side == I3641 && !RUN_UPDATE) return hostMode(); if ($GLOBALS[I3829][I3830] == I3831) return 0; return HOSTMODE_SHARED; }function TTllI11() {return $this->HostMode(); }public function TTlllTT(&$IlLlLll) {$IlLlLlL =I3474; $IlLlLl1 =I3832 .I3833 .I3834; $IlLlLLI =I3835 .I3836 .I3837; $IlLlLLl =I3838 .I3839; $IlLlLLL =I3840 .$GLOBALS[I3841] .I3842 .I3843 .I3844; $IlLlLL1 =I3840 .$GLOBALS[I3841] .I3845 .I3837 .I3846 .I3847 .I3848 .I3849; $IlLlL1I =I3850 .$GLOBALS[I3720]; if(!empty($GLOBALS[I3851][I3852][I3853]) && !empty($GLOBALS[I3851][I3852][I3854])){ $IlLlL1I .= I3855 .time(); }if ($this->issetModOption(I3856, I3857)) {$IlLlL1I .= I3858 .$this->TTlI1TT(I3856, I3857); }$IlLlL1I .= I3859 .I3860 .dechex(preg_replace(I3861, I3862, $GLOBALS[I3720])) .I3863 .I3864; if (I3865 === $this->Side) {$_script =I3866; $oSession =AMI::getSingleton(I3867); $oUser =$oSession->getUserData(); $userId =0; if($oUser){ $userId =$oUser->getId(); }if(AMI_Skin::skinEnvActive() && $userId){ $_script .= I3868; }if(AMI::editModeEnabled()){ $this->Cache->Disable(); }$IlLlL1l =$this->TTlI1TT(I3856, I3869); $IlLlL1L =TRUE; if (!isset($IlLlL1l[$_SERVER[I3870]]) || FALSE === mb_strpos($IlLlL1l[$_SERVER[I3870]], I3871) ){$_script .= I3872; $IlLlL1L =FALSE; }$IlLlLlL .= $IlLlLLL .$_script .I3873 .$IlLlL1I; if (TRUE === $IlLlL1L) {$IlLlLlL .= $IlLlLL1 .$IlLlL1I; }if (call_user_func(array($IlLlLl1, $IlLlLLI), I3874 .I3875 .I3876 .I3877) ){$IlLlLlL .= $IlLlLLL .I3878 .$IlLlL1I; }if (call_user_func(array($IlLlLl1, $IlLlLLI), I3832 .I3879 .I3880 .I3881) ){$IlLlLlL .= $IlLlLLL .I3882 .call_user_func(array($IlLlLl1, $IlLlLLl), I3832 .I3879 .I3880 .I3881) .$IlLlL1I; }}if (call_user_func(array($IlLlLl1, $IlLlLLI), I3883 .I3884 .I3885 .I3886) ){$IlLlLlL .= $IlLlLLL .I3887 .$IlLlL1I; }if (call_user_func(array($IlLlLl1, $IlLlLLI), I3888 .I3889 .I3890) ){$IlLlLlL .= $IlLlLLL .I3891 .call_user_func(array($IlLlLl1, $IlLlLLl), I3888 .I3889 .I3890) .$IlLlL1I; }$IlLlLl1 =I3892; $IlLlLLl =I3893 .I3894; $IlLlLlL .= $GLOBALS[I3617]->$IlLlLl1->$IlLlLLl; if (I3474 !== $IlLlLlL) {$IlLlLll =str_replace( I3895 .I3896, $IlLlLlL .I3895 .I3896, $IlLlLll );}}function TTlllTI() {if (!isset($this->IlLIILL)) {$oSess =admSession(); $udata =$oSess->GetVar(I3525); $this->IlLIILL =isset($udata[I3897][I3898]) ?$udata[I3897][I3898] :0; }return $this->IlLIILL &SF_DEMO ?true :false; }function TTlllTl($key) {$oSess =admSession(); $udata =$oSess->GetVar(I3525); return $udata[I3897][$key]; }public function renameModOptions($modId, $newModId) {if (empty($this->Modules[$modId])) {trigger_error(I3899 .$modId .I3900, E_USER_ERROR); }if ($newModId) {AMI_Registry::set(I3901, $modId); $this->Modules[$modId]->Name =$newModId; $this->Modules[$modId]->Options->aParams[$newModId] =$this->Modules[$modId]->Options->aParams[$modId]; $this->Modules[$modId]->Properties->aParams[$newModId] =$this->Modules[$modId]->Properties->aParams[$modId]; $this->Modules[$newModId] =$this->Modules[$modId]; $this->IlLIIIl[$newModId] =$this->IlLIIIl[$modId]; unset( $this->Modules[$modId], $this->Modules[$newModId]->Options->aParams[$modId], $this->Modules[$newModId]->Properties->aParams[$modId], $this->IlLIIIl[$modId] );foreach (array_keys($this->IlLIIIL) as $owner) {if (isset($this->IlLIIIL[$owner][$modId])) {$this->IlLIIIL[$owner][$newModId] =$this->IlLIIIL[$owner][$modId]; unset($this->IlLIIIL[$owner][$modId]); break; }}}return (bool) $newModId; }public function &declareModule($owner, $hyperMod, $config, $modId, $parentModId =I3474, $useFront =FALSE) {$this->setOwner($owner); if ($parentModId) {$oModule =&$this->TTllTI1($parentModId, $modId, $useFront); }else {$oModule =&$this->AddModule($modId, $useFront); }if ($oModule) {if (!isset($this->aHyperStruct[$hyperMod])) {$this->aHyperStruct[$hyperMod] =array(); }if (!isset($this->aHyperStruct[$hyperMod][$config])) {$this->aHyperStruct[$hyperMod][$config] =array(); }$this->aHyperStruct[$hyperMod][$config][] =$modId; }return $oModule; }public function setupHyperMod($path, $IlLlL11, $type, $aVars =null, array $aModIds =null) {$name =$type .I3468; $IlLl1II =@file_get_contents($path .$name); if ($IlLl1II === FALSE) {trigger_error(I3902 .$name .I3489, E_USER_ERROR); }if (is_array($aVars)) {extract($aVars); }if (!sizeof($aModIds)) {$aModIds =null; }$Core =$this; $oDeclarator =AMI_ModDeclarator::getInstance(); $aModIds =$oDeclarator->getRegistered(); foreach ($aModIds as $modId) {if (!is_null($aModIds) && !in_array($modId, $aModIds)) {continue; }$owner =$oDeclarator->getSection($modId); if (!in_array($owner, $IlLlL11)) {continue; }list($hyperMod, $config) =$oDeclarator->getHyperData($modId); $tabOrder =$oDeclarator->getTabOrder($modId); if ($type === I3903) {$oCoreRules->setCurrentOwner($owner); }else {$this->SetOwner($owner); }$IlLl1Il =0; $IlLl1IL =array( array( I3904 => "// [{$hyperMod}|{$config}] {", I3905 => "// } [{$hyperMod}|{$config}]" ));$tail =$oDeclarator->getAttr($modId, I3906); if (!is_null($tail)) {array_unshift( $IlLl1IL, array( I3904 => "// [{$hyperMod}|{$config}|{$tail}] {", I3905 => "// } [{$hyperMod}|{$config}|{$tail}]" ));$IlLl1Il++; }foreach ($IlLl1IL as $index => $IlLl1I1) {$IlLl1lI =mb_strpos($IlLl1II, $IlLl1I1[I3904]); $IlLl1ll =mb_strpos($IlLl1II, $IlLl1I1[I3905]); if ($IlLl1lI === FALSE || $IlLl1ll === FALSE) {if ($index == $IlLl1Il) {}continue; }$IlLl1lI += mb_strlen($IlLl1I1[I3904]); $code =mb_substr($IlLl1II, $IlLl1lI, $IlLl1ll -$IlLl1lI); $parentModId =preg_match(I3907, $modId) ?str_replace(I3908, I3474, $modId) :preg_replace(I3909, I3474, $modId); $IlLl1lL =str_replace( array(I3910, I3911, I3912, I3913), array($modId, $parentModId, $tabOrder, $owner), $code );if ($type === I3914) {$IIIlILl =empty($REBULD_MODULES_LIST); }eval($IlLl1lL); break; }}}public function authByHash($IlLl1l1){ $IlLl1LI =FALSE; do{ $IlLl1l1 =call_user_func(I3915 .I3916 .I3917, $IlLl1l1); $IlLl1Ll =mb_substr($IlLl1l1, 0, 1); if(!preg_match(I3918, $IlLl1Ll)){ break; }$_hash =mb_substr($IlLl1l1, 1, $IlLl1Ll); $IlLl1l1 =mb_substr($IlLl1l1, $IlLl1Ll +1); $_shared =I3919 == $GLOBALS[I3829][I3830]; if(I3920 .I3921 == call_user_func(array(I3832 .I3922, I3923 .I3924))){ $_shared =FALSE; }$IlLl1LL =empty($GLOBALS[I3829][I3925]) && empty($GLOBALS[I3926][I3927][I3928]); $IlLl1L1 =call_user_func(array(I3929, I3930 .I3931), I3932); $IlLl11I =call_user_func(array(I3933 .I3934, I3935 .I3936), I3937 .I3938 .I3939 .($IlLl1LL ?I3940 :I3474) )->q($IlLl1l1) ->q(date(I3941)); if($IlLl1LL){ $IlLl11I->q($_SERVER[I3870]); }$IlLl11l =call_user_func(array($IlLl1L1, I3942 .I3943), $IlLl11I); if($IlLl11l){ $IlLl11L =@unserialize($IlLl11l[I3606]); if( (int)$_hash === ($_shared ?unserialize($IlLl11L[I3944]) :$IlLl11L[I3945] )){$IlLl111 =$_shared ?unserialize($IlLl11L[I3946]) :$IlLl11L[I3525]; $IlLl1LI =call_user_func( array( call_user_func(array(I3832 .I3922, I3947 .I3948), I3949 .I3950), I3951 .I3952 ),$IlLl111[I3953] );}}}while(FALSE); return $IlLl1LI; }public function repairPagesTree(){ Tree::TI11ITI(I3954, $GLOBALS[I3932]); }public function getSessions(){ $oSess =admSession(); if($oSess){ return $oSess->getSessions(); }return array(); }public function expireUserSession($id){ $oSess =admSession(); if($oSess){ $oSess->expireUserSession($id); }}}