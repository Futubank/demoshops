<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       17944 xkqwnizlkiyskzqtrrlpwwimgwrwgqkliplpupggigzywupxuktsktzrtirqwkiuwrqwpnir
 */ ?><?php foreach(array(3997=>"YJHWK|DHurWQ|DtZrt",3998=>"IHSuJQ|DtZrt",3999=>"IHSuJQ|OMPOJMPOt|DtZrt",4000=>"IHSuJQ|QnS",4001=>'',4002=>'!?fMJQ%',4003=>'SQYuP%DQtDsZtZ',4004=>"YJHWKNZIQD",4005=>'^?IHSuJQ%nHnQ^?YJHWK%nHnQ^?fMJQ%',4006=>'tQxt"',4007=>"WHntQnt",4008=>'|MDQtD',4009=>'#Y@',4010=>"WID",4011=>"DGQW|IHSuJQ|YHSB",4012=>"IHSuJQ",4013=>"ZJJ",4014=>'~}#,++>?"IHSuJQ%}',4015=>"WHSQ|DtZrt",4016=>"",4017=>'|IZKQyJHWK',4018=>'~#,++<?"MS%\S-^?IHSuJQ%nHnQ^?YJHWK%nHnQ^?fMJQ%}*;^"&[ {}^_"{~D',4019=>"nHnQ",4020=>'^?IHSuJQ%nHnQ^?',4021=>'^?IHSuJQ%',4022=>'#,++>?"IHSuJQ%',4023=>'^?YJHWK%',4024=>'"?++@',4025=>'|MGZrt',4026=>'<<JMnK|OrQf<<',4027=>"YJHWK|DHurWQ|JMnK",4028=>"IHSuJQ%?",4029=>"YJHWK|DtZrt",4030=>'IHSuJQ%',4031=>'^?',4032=>'~IHSuJQ%}`[ {^~',4033=>"~",4034=>"IHSuJQ|",4035=>"DtZrt",4036=>"<",4037=>']EuHt^?++]Pt^',4038=>"MS%",4039=>'#~Y@IHSuJQ%#Y@',4040=>'?#~Y@fMJQ%#Y@',4041=>"DQt|",4042=>'#fHnt?WHJHr=rQS@',4043=>"&") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class DEBUG_template extends GUI_template{ public $debugLevel; public $doMarkup; public $workingModuleData; public $workingModulesPool; public $codeFrames; public $rplIsAll; public $rplHighlighted; public $rplReqModules; public $rplHighlightPart; public $currentTemplateData; public $_modulesBlocks; public $_setCounter; public $_scriptLink; function DEBUG_template(){ parent::GUI_template(); $this->debugLevel =$GLOBALS["allow_ext_debug"]; if($this->debugLevel >1) $this->allowCacheProcessedFiles =false; $this->doMarkup =false; $this->workingModuleData =NULL; $this->workingModulesPool =array(); $this->codeFrames =array( "block_start" => '<table border=0 cellpadding=0 cellspacing=0 style="border: 1px dotted black; text-align: left" title="##title##">##source_link##<tr><td>', "block_end" => '</td></tr></table>', "block_source_link" => '<tr><td><a href="##link_href##" target="_blank" style="text-decoration:underline;color:#DD0000">##link_title##</a></td></tr>', I3997 => '<table border=0 cellpadding=0 cellspacing=0 style="border: 1px dotted black; text-align: left" title="##title##"><tr><td>', "block_source_end" => '</td></tr></table>', I3998 => '<span style="background: #FFFFFF; font-family: Verdana; font-weight: bold; font-size: 12px; color:#669966;">', I3999 => '<span style="background: #DDDDDD; font-family: Verdana; font-weight: normal; font-size: 12px; color:#669966;">', I4000 => '</span><br>', "set_start" => '<span style="background: #FFFFFF; font-family: Verdana; font-weight: normal; font-size: 12px; color:#0000FF">', "set_highlight_start" => '<span style="background: #DDDDDD; font-family: Verdana; font-weight: normal; font-size: 12px; color:#0000FF">', "set_end" => '</span><br>', "code_start" => '<pre style="background: #FFFFFF; font-family: Verdana; font-weight: normal; font-size: 12px; color:#000000; margin: 0px">', "code_highlight_start" => '<pre style="background: #DDDDDD; font-family: Verdana; font-weight: normal; font-size: 12px; color:#000000; margin: 0px">', "code_end" => '</pre>', );$this->_modulesBlocks =array(); $this->_setCounter =0; $this->_scriptLink =null; }function setMarkupMode($bIsOn =true){ if($this->debugLevel >1){ $this->doMarkup =$bIsOn; }}function _readTemplate(&$aSetsData, $firstParam, $includeFile, $isFirstParamText =false, $returnParsedIfPossible =false){ $content =parent::_readTemplate($aSetsData, $firstParam, $includeFile, $isFirstParamText, $returnParsedIfPossible); if($this->doMarkup && mb_strlen($returnParsedIfPossible ?$content[0] :$content) >0){ $contentText =$returnParsedIfPossible ?$content[0] :$content; $this->currentTemplateData =array( $contentText, str_replace($GLOBALS['ROOT_PATH'], I4001, $includeFile) );$contentText =preg_replace_callback($this->regExp["set_statement"], array($this, '_cbReadTemplate'), $contentText); if($returnParsedIfPossible) $content[0] =$contentText; }return $content; }function _cbReadTemplate($matches){ $techInfo =""; $pos =mb_strpos($this->currentTemplateData[0], $matches[0]); if($pos !== false){ $techInfo ='<!--/techInfo line:'.intval($this->_getLineNumberByPos($this->currentTemplateData[0], $pos)).I4002.$this->currentTemplateData[1].' /-->'; }return $matches[1].$matches[3].'"'.$matches[4].$matches[6].$techInfo.$matches[7].$matches[8].$matches[9]; }function _getLineNumberByPos($text, $pos){ $lineNumber =0; $i =-1; while(($i =strpos($text, "\n", $i+1)) !== false){ if($i >= $pos) return $lineNumber+1; $lineNumber++; }return $lineNumber; }function _processSetContent(&$aSetData, $setName, $setContent){ parent::_processSetContent($aSetData, $setName, $setContent); if($this->doMarkup){ if(preg_match('/<!--\/techInfo line:(\d+?), file:(.*?) \/-->/', $aSetData[$setName], $matches)){ $aSetData[I4003][$setName] =array( "line" => $matches[1], "file" => $matches[2] );$aSetData[$setName] =str_replace($matches[0], I4001, $aSetData[$setName]); }}}function _getParsedContent($name, $addon, $aVars, $bReplaceMode ='all'){ $data =parent::_getParsedContent($name, $addon, $aVars, $bReplaceMode); if($this->doMarkup){ if(!is_null($this->workingModuleData)){ if(!in_array($name, $this->workingModuleData["blockNames"])) $this->workingModuleData[I4004][] =$name; }$this->_setCounter ++; $infoData ='"id:'.$this->_setCounter.I4005; if(!is_array($this->html[$name]["content"]) || empty($this->html[$name]["content"][I4003][$addon]['file'])) $infoData .= I4006; else $infoData .= $this->html[$name]["content"][I4003][$addon]['file'].'; set:'.$addon.'; line:'.$this->html[$name][I4007][I4003][$addon]['line'].'"'; $ds =isset($GLOBALS['cms']) && isset($GLOBALS['cms']->Vars[I4008]) && $GLOBALS['cms']->Vars[I4008] == $name; return "\n".'<!--# '.$infoData.' -->'. ($ds ?I4009.$addon.'[</b>' :I4001) .$data .($ds ?'<b>]</b>' :I4001).'<!--#/ '.$infoData.' -->'; }else return $data; }function startWorkingModule($moduleName){ }function stopWorkingModule(&$moduleData, $moduleName){ }function processHtmlDocument(&$dataStr, $iSrc, $iBlock, $iPart){ if($this->doMarkup){ foreach($GLOBALS[I4010]->Core->GetProperty("spec_blocks") as $sbName => $sbData){ if($sbName != I4011) $this->_modulesBlocks[$sbName] =$sbData[I4012]; else $this->_modulesBlocks[$sbName] =$GLOBALS[I4010]->ActiveModule->GetName(); }$dataStr =preg_replace_callback('/(<spec_mark name=(.+?)(_\d+?)?><\/spec_mark>)(.*?)(<spec_mark_ name=\2\3?><\/spec_mark_>)/s', array(&$this, "_parseBlocks"), $dataStr); $this->rplHighlighted =false; $this->rplReqModules =explode(";", $iSrc); $this->rplIsAll =in_array(I4013, $this->rplReqModules); if($this->rplReqModules[0] == "") $this->rplReqModules =array(); if($this->rplIsAll) $dataStr =htmlspecialchars($dataStr); else if(sizeof($this->rplReqModules) >0){ $dataStr =preg_replace_callback(I4014.implode('|', $this->rplReqModules).'); .*?".*?<!--@\/ "\2" -->)/si', array($this, '_makeSource'), $dataStr); }$dataStr =($this->rplIsAll ?$this->codeFrames[I4015] :"").preg_replace_callback('/(&lt;!--(#|@)(\/?) &quot;(.*?)&quot; --&gt;)/si', array($this, '_replaceBlock'), $dataStr).($this->rplIsAll ?$this->codeFrames["code_end"] :I4016); $this->_highLightFoundData($dataStr, stripslashes($iPart)); $aBlock =explode(";", $iBlock); if($aBlock[0] == I4016) $aBlock =array(); if(sizeof($aBlock) >0){ $rxAddon =I4016; if(in_array(I4013, $aBlock)) $rxAddon =".*?"; else $rxAddon =implode('|', $aBlock); if(mb_strlen($rxAddon) >0) $dataStr =preg_replace_callback(I4014.$rxAddon.'); block:(.*?);.*?".*?<!--@\/ "\2" -->)/si', array($this, I4017), $dataStr); }}}function _parseBlocks($rParts){ $moduleName =$blockName ="none"; if(isset($this->_modulesBlocks[$rParts[2]])){ $moduleName =$this->_modulesBlocks[$rParts[2]]; if($moduleName == "core") $moduleName ="pages"; $blockName =$rParts[2].$rParts[3]; }$usedTemplates =array(); if(preg_match_all(I4018, $rParts[4], $mTemplates) >0){ $usedTemplates =$mTemplates[1]; $usedTemplates =array_unique($usedTemplates); }if($moduleName != "none" || $blockName != I4019) $rParts[4] =str_replace(array(I4020, '; block:none; '), array(I4021.$moduleName.'; ', '; block:'.$blockName.'; '), $rParts[4]); $moduleData =$rParts[1].I4022.$moduleName.I4023.$blockName.'; templates:'.implode('; ', $usedTemplates).'" -->'.$rParts[4].'<!--@/ "'.$moduleName.I4024.$rParts[5]; return $moduleData; }function _makeBlock($matches){ $src =I4016; $source_link =I4016; if(!is_array($GLOBALS[I4010]->VarsPost) || sizeof($GLOBALS[I4010]->VarsPost) == 0){ if(is_null($this->_scriptLink)){ $this->scriptLink =$GLOBALS["ActiveScriptLink"]."?_isrc=##block##"; $getParams =I4001; if(is_array($GLOBALS[I4010]->VarsGet) && sizeof($GLOBALS[I4010]->VarsGet) >0){ foreach($GLOBALS[I4010]->VarsGet as $key => $value){ if($key != '_isrc' && $key != '_iblock' && $key != I4025){ if(is_array($value)){ for($i =0; $i <sizeof($value); $i++){ $getParams .= '&'.$key.'[]='.rawurlencode(unhtmlentities($value[$i])); }}else{ $getParams .= '&'.$key.'='.rawurlencode(unhtmlentities($value)); }}}}if(mb_strlen($getParams) >0){ $this->scriptLink .= $getParams; }}$source_link =str_replace(array(I4026, '##link_title##'), array(str_replace('##block##', $matches[2], $this->scriptLink), $GLOBALS['cms']->Words['debug_show_source']), $this->codeFrames[I4027]); }$src =str_replace(array("##title##", '##source_link##'), array(htmlspecialchars(I4028.$matches[2]."\n"."block: ".$matches[3]), $source_link), $this->codeFrames[I4029]).$matches[1].$this->codeFrames["block_end"]; return $src; }function _makeSource($matches){ return htmlspecialchars($matches[1]); }function _replaceBlock($matches){ $res =I4016; if($matches[2] == "@"){ if($matches[3] != "/"){ $matches[1] =str_replace(array(I4030, I4023, '; templates:', I4031, ' :: ', ',', '&quot<br>--&gt;'), array(I4001, '"<br>Block: "', '"<br>Templates:<br>', '<br>', ':<br>', '<br>', '<br>--&gt;'), $matches[1]); if(preg_match(I4032, $matches[4], $matches4)) $matches[4] =$matches4[1]; }if($matches[3] != I4033){ $this->rplHighlighted =$this->rplIsAll && in_array($matches[4], $this->rplReqModules); }else{ $res .= $this->codeFrames["code_end"]; }$res .= ($matches[3] != I4033 ?($this->rplIsAll ?"<br>" :str_replace("##title##", htmlspecialchars(I4028.$matches[4]), $this->codeFrames[I3997])) :I4016).$this->codeFrames[I4034.($this->rplHighlighted ?"highlight_" :I4016).I4035].$matches[1].$this->codeFrames[I4000].($matches[3] == I4033 ?($this->rplIsAll ?"<br>" :$this->codeFrames["block_source_end"]) :I4016); if($matches[3] == I4033){ $this->rplHighlighted =false; }else{ $res .= $this->codeFrames["code_".($this->rplHighlighted ?"highlight_" :I4016).I4035]; }}if($matches[2] == I4036){ $matches[1] ="<b>".$matches[1]."</b>"; $matches[1] =str_replace(array('&lt;!--# &quot;', '&lt;!--#/ &quot;', I4037, I4030, ' block:', " file:", " set:", " line:", I4038), array('</b>&lt;!--# &quot;<b>', '</b>&lt;!--#/ &quot;<b>', '</b>&quot; --&gt;<b>', I4039, ' </b>block:<b>', I4040, ' </b>set:<b>', ' </b>line:<b>', '</b>id:<b>'), $matches[1]); if($matches[3] == I4033){ $res .= $this->codeFrames["code_end"]; }$res .= $this->codeFrames[I4041.($this->rplHighlighted ?"highlight_" :I4016).I4035].$matches[1].$this->codeFrames["set_end"]; if($matches[3] != I4033){ $res .= $this->codeFrames["code_".($this->rplHighlighted ?"highlight_" :I4016).I4035]; }}return $res; }function _highLightFoundData(&$content, $sub){ if(mb_strlen($sub) >0){ $content =str_replace($sub, I4042.$sub.'</font>', $content); }}function procError($errType, $errData){ $msgStr =I4016; switch($errType){ case TPL_E_EVAL_FAILED: if($this->debugLevel == 2) $msgStr ="[code evaluating error in: ".$errData."]"; break; case TPL_E_EVAL_FORBIDDEN: if($this->debugLevel == 2) $msgStr ="[code evaluating forbidden for: ".$errData.I4043; break; }if(I4001 !== $msgStr){ trigger_error($msgStr); }return $msgStr; }}?>