<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       9086 xkqwppnxspyqnztrimkunsnpimmwslyiipzyggqisxwgyxzrsrqrmryrruqtqxlkiugqpnir
 */ ?><?php foreach(array(4078=>'FUNw|mNwjUsqd|gzTo',4079=>'GrHxB',4080=>'pqT',4081=>'GHDt|SZtZ',4082=>'mjJJ1m1',4083=>'wHntQnt+jQnPtO',4084=>'sjh|q|cRmTq|Fmjq',4085=>"\r\n",4086=>'OHDt',4087=>'') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} require_once $GLOBALS['CLASSES_PATH'] .'BaseObject.php'; require_once $GLOBALS[I4078] .'func_url.php'; $ILll1I1 =false; function _dlo_write($ch,$arg) {return $GLOBALS['ILll1I1']->_write($arg); }class Downloader extends BaseObject {public $ch; public $ILll1lI; public $ILll1ll; public $IIlIlIl; public $ILll1lL; public $ILll1l1; public $ILll1LI; public $ILll1Ll; public $_url; function Downloader($opt=array()) {$this->BaseObject(); $this->TTTIT1I('dload_get'); $this->ILlI1LI += array( 'timeout' => 30, I4079 => false, 'follow_rediects' => true, 'tick_bytes' => 1024*1024, 'reget' => false, 'method' => I4080, 'post_data' => '', 'request_headers' => false, 'user_agent' => "Mozilla/4.0 (compatible; MSIE 6; Dloader)" );$this->set($opt); }public static function TTTI1II() {return function_exists('curl_init'); }function _init($url,$fname) {$this->IIlIlIl =$fname; $this->_url =$url; $this->ch =curl_init(); curl_setopt($this->ch, CURLOPT_URL,$url); curl_setopt($this->ch, CURLOPT_USERAGENT,$this->get('user_agent')); if($this->get('method')=='POST') {curl_setopt($this->ch, CURLOPT_POST,true); curl_setopt($this->ch, CURLOPT_POSTFIELDS,$this->get(I4081)); }curl_setopt($this->ch, CURLOPT_FOLLOWLOCATION,$this->get('follow_redirects')); curl_setopt($this->ch, CURLOPT_MAXREDIRS,10); curl_setopt($this->ch, CURLOPT_CONNECTTIMEOUT,$this->get('timeout')); curl_setopt($this->ch, CURLOPT_LOW_SPEED_TIME,$this->get('timeout')); curl_setopt($this->ch, CURLOPT_LOW_SPEED_LIMIT,10); $ILll1LL =$this->get(I4079); if($ILll1LL!==false) {$ILll1LL =mb_strtolower($ILll1LL); if(!preg_match('/^(http|socks5):\/\/([a-z0-9\-]+(\.[a-z0-9\-]+)*):(\d+)/',$ILll1LL,$m)) return $this->TTTITTI("Cannot use proxy server: invalid URL",'DLO_E_PROXY_URL'); curl_setopt($this->ch,CURLOPT_PROXYTYPE,$m[1]=='socks5'?CURLPROXY_SOCKS5:CURLPROXY_HTTP); curl_setopt($this->ch,CURLOPT_PROXYPORT,$m[4]); curl_setopt($this->ch,CURLOPT_PROXY,$m[2]); }$ILll1L1 =$this->get('request_headers'); if(is_array($ILll1L1)) curl_setopt($this->ch,CURLOPT_HTTPHEADER,$ILll1L1); if($this->get('reget') && $this->IIlIlIl!==false) {$from =intval(@filesize($this->IIlIlIl)); curl_setopt($this->ch,CURLOPT_RANGE,"$from-"); }curl_setopt($this->ch, CURLOPT_BINARYTRANSFER,true); curl_setopt($this->ch, CURLOPT_FAILONERROR,true); curl_setopt($this->ch, CURLOPT_HEADER,true); $GLOBALS[I4082] =&$this; curl_setopt($this->ch, CURLOPT_WRITEFUNCTION,'_dlo_write'); return true; }function _fireEvent($event) {$data =array('gotBytes'=>$this->ILll1l1, 'totalBytes'=>isset($this->ILll1lI['Content-Length']) ?$this->ILll1lI[I4083] :false); $this->TTTIITI('dload_get',$event,$data); }function _write($str) {$len =mb_strlen($str, 'ASCII'); @set_time_limit(30); if($this->ILll1lI!==false) {$this->ILll1l1 += $len; if($this->ILll1LI>0 && intval($this->ILll1l1/$this->ILll1LI)>$this->ILll1Ll) {$this->_fireEvent('progress'); $this->ILll1Ll++; }if($this->ILll1lL && @fwrite($this->ILll1lL,$str)!=$len) {$this->TTTITTI("Cannot write to output file",I4084); return 0; }else {$this->ILll1ll .= $str; return $len; }}$this->ILll1ll .= $str; if(($p=mb_strpos($this->ILll1ll,"\r\n\r\n"))===false) return $len; $ILll1L1 =mb_substr($this->ILll1ll,0,$p); $this->ILll1ll =mb_substr($this->ILll1ll,$p+4); if(preg_match('/100\s+Continue/',$ILll1L1)) return $len; $ILll11I =mb_strlen($this->ILll1ll); $this->ILll1l1 =$ILll11I; if($this->ILll1lL) {if(@fwrite($this->ILll1lL,$this->ILll1ll)!=$ILll11I) {$this->TTTITTI("Cannot write to output file",I4084); return 0; }$this->ILll1ll =''; }$ILll1L1 =explode(I4085,$ILll1L1); $this->ILll1lI =array(); if(is_array($ILll1L1)) {foreach($ILll1L1 as $h) {if(preg_match('/^(\S+):\s+(.*)/',$h,$m)) $this->ILll1lI[$m[1]] =$m[2]; }}return $len; }function _request() {$this->ILll1lL =$this->ILll1lI =false; $this->ILll1ll =''; if($this->IIlIlIl!==false) {$this->ILll1lL =@fopen($this->IIlIlIl,'ab'); if(!$this->ILll1lL) return $this->TTTITTI("Cannot open output file for writing",I4084); if(!flock($this->ILll1lL,LOCK_EX|LOCK_NB)) return $this->TTTITTI("Cannot lock output file",'DLO_E_FLOCK'); if(!$this->get('reget')) @ftruncate($this->ILll1lL,0); }$this->ILll1LI =$this->get('tick_bytes'); $this->ILll1Ll =$this->ILll1l1 =0; $IIlILI1 =parse_url($this->_url); $data =array('host'=>$IIlILI1[I4086]); $this->TTTIITI('dload_get','connecting',$data); curl_exec($this->ch); if($this->ILll1lL) {@fclose($this->ILll1lL); $this->ILll1lL =false; }$code =curl_errno($this->ch); if($code) {return $this->TTTITTI("CURL error [$code]: ".curl_error($this->ch),'DLO_E_REQUEST'); }if($this->ILll1LI>0) {$this->_fireEvent('done'); }return true; }function run($url,$fname=false) {if(!$this->_init($url,$fname)) return false; if(!$this->_request()) return false; return true; }function TT1llTT($IIIl1I1=true) {if(!is_array($this->ILll1lI)) return false; if($IIIl1I1) return $this->ILll1lI; return implode(I4085,$this->ILll1lI); }function TT1llTI() {return $this->ILll1ll; }function TT1llTl($v) {TlT1ITI($v); $post =I4087; TlT1ITl($v,$post); $this->set(I4081,$post); }}