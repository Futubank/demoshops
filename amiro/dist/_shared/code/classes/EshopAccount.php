<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       3638 xkqwgmwgikpkuxtmurnpqrrigqiwttisipunwmimprsyumupnwttrnmplkgypngwgkqupnir
 */ ?><?php foreach(array(4264=>'MS|IQIYQr',4265=>"YZDQ|WurrQnWB",4266=>"|HrSQr|MtQID?QHM?",4267=>'Qxt|SZtZ',4268=>"EtB",4269=>"DOMGGMnP") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class EshopAccount extends EshopExtention{ function updateOrderStatus(&$cms, $IIIL11l, $ILLIll1, $IllI11L, &$aOrderData, &$ILLIlLI){ $db =new DB_si; switch ($IIIL11l){ case 'ext_update_account': $ILLIlLL =0; $id_member =0; $needUpdate =false; $aExtData =unserialize($aOrderData['ext_data']); $idMember =$aOrderData[I4264]; if($aExtData["is_account_updated"]!=1){ $aExtData["is_account_updated"] =1; $aOrderData["ext_data"] =serialize($aExtData); $sql ="UPDATE ".$cms->Eshop->dbTablePrefix."_orders SET ext_data='".addslashes($aOrderData["ext_data"])."' WHERE id='".$ILLIll1."'"; $db->query($sql); $baseCurrency =$cms->Eshop->baseCurrency; $cms->Eshop->pushCurrencyData(); if(!$cms->Eshop->issetCurrency($baseCurrency)){ }$cms->Eshop->setCurrencyData($aExtData["currency"], $aExtData[I4265]["code"]); $sql ="SELECT eoi.ext_data, eoi.price_number, eoi.qty, ". "ei.tax, ei.tax_type, ei.charge_tax_type, ei.discount, ei.discount_type ". "FROM ".$cms->Eshop->dbTablePrefix.I4266. "LEFT JOIN ".$cms->Eshop->dbTablePrefix."_items ei ON eoi.id_product = ei.id ". "WHERE eoi.id_order='".$ILLIll1."' AND ei.item_type='eshop_account'"; $db->query($sql); while($db->next_record()){ $aExtData =unserialize($db->Record[I4267]); $price =$cms->Eshop->convertCurrency($aExtData['item_info']['original_price'], $aExtData['currency']['code'], $baseCurrency); $ILLIlLL += $price *$db->Record[I4268]; }$cms->Eshop->TT11T1T(); EshopUser::updateBalance($db, $idMember, $ILLIlLL, $cms->Eshop->baseCurrency, false, $IllI11L); }break; }}function processAction($action, $cId, &$itemData, &$addParams){ parent::processAction($action, $cId, $itemData, $addParams); switch($action){ case "edit": break; case "before_add": case "before_apply": if($this->cms->VarsPost["item_type"] == $this->modName){ $itemData[I4269] =0; $itemData["discount"] =0; }break; }}}class EshopAccountAdmin extends EshopAccount{ }class EshopAccountFront extends EshopAccount{ }