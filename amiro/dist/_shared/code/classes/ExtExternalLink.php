<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       5496 xkqwpkzwkmxmqminwrxpillrwizllugktlykqsiumulzprksynwisytnyxpxzlnnlwwqpnir
 */ ?><?php foreach(array(4902=>"MS|GZrQnt",4903=>"IHSuJQ|nZIQ",4904=>"WZJJYZWK",4905=>"JQP|QxtQrnZJ|JMnK",4906=>"{?zNs?IHSuJQ|nZIQ='",4907=>"'",4908=>"{",4909=>"nZIQ",4910=>"'?zNs?IHSuJQ|nZIQ='",4911=>"MWHn|JMnK|GHGuG") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ExtExternalLink extends CMS_ExtModule {public $IL1l11L; public $IL1l111; public $IL1LIII; public $IL1LIIl; function ExtExternalLink() {parent::CMS_ExtModule(); $this->IL1l11L ="del"; $this->IL1l111 ="del"; $this->IL1LIII =I4902; $this->IL1LIIl =Array(); }function GetModuleName() {return "ext_external_link"; }function TTIllI1($cId, &$vItemData, &$vData, &$IILIILl) {$IL1LIIL =0; if($cId >0) {$sql ="SELECT count(*) as cnt FROM cms_external_links WHERE id_target='$cId' AND module_name='".$this->mod->moduleName."' AND lang='".$this->mod->langData."'"; $this->db->query($sql); $this->db->next_record(); $IL1LIIL =$this->db->Record["cnt"]; $vData["USE_ID_EXTERNAL_LINK"] ='1'; $vData[I4903] =$this->mod->moduleName; }$IILIILl["fields"]["link_action"] =Array("action"=>I4904, "object"=>&$this, "method"=>"_GetLinkActionCB"); $IILIILl["legend"][] =I4905; $vData["num_external_links"] =$IL1LIIL; }function TTIl1Il($cId, &$vItemData, &$vData, &$IILIILl) {switch($IILIILl["ext_action"]) {case $this->IL1l11L: if(!empty($cId)) {$sql ="DELETE FROM cms_external_links WHERE id_target in (".$cId.I4906.$this->mod->moduleName."' AND lang='".$this->mod->langData.I4907; $this->db->query($sql); }break; case "external_link_forward": if(!empty($cId)) {$sql ="UPDATE cms_external_links SET id_target=".$this->cms->Vars[I4902]." WHERE id_target in (".$cId.I4906.$this->mod->moduleName."' AND lang='".$this->mod->langData.I4907; $this->db->query($sql); $sql ="SELECT id_external, ".$this->mod->options["name_field_name"]." as name ". "FROM ".$this->activeModule->GetTableName()." WHERE id in (".$cId.I4908; $this->db->query($sql); $db =&$this->mod->TTTlTT1(); while($this->db->next_record()){ $aSql =Array( "id_external" => $this->db->Record["id_external"], "id_target" => $this->cms->Vars[I4902], "lang" => $this->mod->langData, I4903 => $this->mod->moduleName, I4909 => $this->db->Record[I4909], );$sql =$db->GenInsertSQL("cms_external_links", $aSql); $db->query($sql); }$this->cms->Vars[$this->IL1LIII] =$this->cms->VarsPost[$this->IL1LIII] =$this->cms->VarsGet[$this->IL1LIII] =$this->cms->Vars[I4902]; $this->mod->action =$this->IL1l111; $this->cms->AddMessages($this->cms->Gui->ParseLangFile("templates/lang/_external_link_ext_msgs.lng")); $this->cms->AddStatusMsg("forwarding_added"); }break; case "del_all": $sql ="DELETE FROM cms_external_links WHERE lang='".$this->mod->langData.I4910.$this->mod->moduleName.I4907; $this->db->query($sql); break; }}function _GetLinkActionCB(&$aItem, &$aData) {$aItem["actions"] .= $this->cms->Gui->get($this->mod->moduleName."_list:".(in_array($aItem["id"], $this->IL1LIIl)? "icon_none": I4911), $aItem); }}?>