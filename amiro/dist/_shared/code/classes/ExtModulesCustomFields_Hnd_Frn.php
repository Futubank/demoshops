<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    modules 
 * @subpackage extensions 
 * @version    $Id$ 
 * @size       11010 xkqwwqmmmwxsuqsrxzmrrgmzxpsxsllrlqkmknmukznqklnyzuzrtxnggnpgqlqkwgigpnir
 */ ?><?php foreach(array(5056=>'YHSB|WZtD',5057=>'fMQJSD|IZG',5058=>'SY|fMQJSD',5059=>'GZPQ|MtQI|tBGQ',5060=>'ZWtMHn',5061=>'Qxt|Wf|tGJ|YJHWK',5062=>'GHDtfMx',5063=>'tBGQ',5064=>'SQtZMJD',5065=>'JMDt',5066=>'IHSuJQ',5067=>'ftBGQ',5068=>'nuIQrMW',5069=>'IQtZD',5070=>"FRhi?.WID|IHSuJQD|WuDtHI|fMQJSD.?",5071=>".IHSuJQ|nZIQ.?=?'",5072=>"'") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ExtModulesCustomFields_Hnd_Frn_ModifySQL implements CMS_Ext_ActionHandler_Interface{ private static $IL1LLI1 =array( 'body_urgent_cats' => 'body_urgent_items', I5056 => 'body_items' );public function processAction($IlIlI11, $cId, &$vItemData, &$vData, &$IILIILl){ $IlIlI11->aCrossHandlerData[$IlIlI11->moduleName]['db_fields'] =array(); if($IlIlI11->mod->isSmallMode){ return; }if($IlIlI11->setDataset()){ $IIl1II1 =$IILIILl['page_item_type']; $IL1LLlI =$IIl1II1 != 'body_itemD'; foreach($IlIlI11->aDataset[I5057] as $fieldId){ if(!isset($IlIlI11->IL1Llll->aCustomFields[$fieldId])){ continue; }$aField =$IlIlI11->IL1Llll->aCustomFields[$fieldId]; if(isset(self::$IL1LLI1[$IIl1II1])){ $IIl1II1 =self::$IL1LLI1[$IIl1II1]; }if(mb_strpos($aField['show_body_type'], ';' .$IIl1II1 .';') !== false){ $IL1lIL1 =CMS_API_ModulesCustomFields::PREFIX .$aField['system_name']; $IlIlI11->aCrossHandlerData[$IlIlI11->moduleName][I5058][$aField['id']] =$IL1lIL1; if(empty($aField['isnot_all'])){ $IlIlI11->aCrossHandlerData[$IlIlI11->moduleName]['common_db_fields'][$aField['id']] =$IL1lIL1; }if($IL1LLlI){ $IlIlI11->mod->browser->TI1TITl($IL1lIL1); }}}}}}class ExtModulesCustomFields_Hnd_Frn_FillData implements CMS_Ext_ActionHandler_Interface{ private $IL1LLll; public function processAction($IlIlI11, $cId, &$vItemData, &$vData, &$IILIILl){ if($IlIlI11->mod->isSmallMode){ return; }$this->IL1LLll =$IlIlI11; $IL1LLlL =true; if(in_array($IILIILl[I5059], array('body_itemD', 'body_urgent_cats', I5056))){ ExtModulesCustomFields_Hnd_Frn_ModifySQL::processAction($IlIlI11, $cId, $vItemData, $vData, $IILIILl); $IL1LLlL =sizeof($IlIlI11->aCrossHandlerData[$IlIlI11->moduleName][I5058]) >0; }if($IL1LLlL){ $IILIILl['fields']['id'] =array(I5060 => 'callback', 'object' => $this, 'method' => 'cbFrontData'); }}public function cbFrontData(&$aItem, &$aData){ if(!sizeof($this->IL1LLll->aCrossHandlerData[$this->IL1LLll->moduleName][I5058])){ return; }$IL1LLl1 =empty($aData[I5061]) ?preg_replace('/_cat$/', '', $this->IL1LLll->mod->moduleName) .'_list' :$aData[I5061]; $commonCustomFields =''; $splitter =$this->IL1LLll->cms->Gui->getAbs($IL1LLl1 .':common_cf_splitter'); foreach($this->IL1LLll->aCrossHandlerData[$this->IL1LLll->moduleName][I5058] as $fieldId => $field){ if(is_null($aItem[$field])){ continue; }$isCommonList =isset($this->IL1LLll->aCrossHandlerData[$this->IL1LLll->moduleName]['common_db_fields'][$fieldId]); $aField =$this->IL1LLll->IL1Llll->aCustomFields[$fieldId]; $aSetData =$this->IL1LLll->aCrossHandlerData[$this->IL1LLll->moduleName] +array( 'id' => $fieldId, 'prefix' => $aField['prefix'], I5062 => $aField[I5062], 'caption' => $aField['caption'], 'name' => $aField['system_name'], I5063 => $aField['ftype'], 'value' => $aItem[$field] );if(!$isCommonList){ $aSetData['is_unique'] =true; }if($aField['description']){ $aSetData[I5064] =$this->IL1LLll->cms->Gui->get($IL1LLl1 .':cf_details', $aSetData); }unset($aSetData[I5058], $aSetData['common_db_fields']); $fieldHTML =$this->IL1LLll->cms->Gui->get($IL1LLl1 .':common_cf', $aSetData); if($isCommonList){ $commonCustomFields .= $fieldHTML .$splitter; }else{ $aItem[CMS_API_ModulesCustomFields::PREFIX .$aField['system_name']] =$fieldHTML; }}if(mb_strlen($commonCustomFields)){ $splitterLength =mb_strlen($splitter); if($splitterLength){ $commonCustomFields =mb_substr($commonCustomFields, 0, -$splitterLength); }$aSetData =$this->IL1LLll->aCrossHandlerData[$this->IL1LLll->moduleName] +array(I5065 => $commonCustomFields); unset($aSetData[I5058], $aSetData['common_db_fields']); $aItem['common_cf_list'] =$this->IL1LLll->cms->Gui->get( $IL1LLl1 .':common_cf_list', $aSetData );}}}class ExtModulesCustomFields_Hnd_Frn_InitByMod implements CMS_Ext_ActionHandler_Interface{ public function processAction($IlIlI11, $moduleName, &$vItemData, &$vData, &$IILIILl){ $IlIlI11->moduleName =$moduleName; if(!isset($IlIlI11->aCrossHandlerData[$IlIlI11->moduleName])){ $IlIlI11->aCrossHandlerData[$IlIlI11->moduleName] =$IlIlI11->IL1Lll1 +array(I5066 => $IlIlI11->moduleName); }}}class ExtModulesCustomFields_Hnd_Frn_CreateFilterFields implements CMS_Ext_ActionHandler_Interface{ public function processAction($IlIlI11, $cId, &$vItemData, &$vData, &$IILIILl){ if($IlIlI11->mod->isSmallMode){ return; }if($IlIlI11->setDataset()){ foreach($IlIlI11->IL1Llll->aCustomFields as $aField){ $field =CMS_API_ModulesCustomFields::PREFIX .$aField['system_name']; if(isset($IlIlI11->cms->Vars[$field])){ $vData[] =$field; if($aField[I5067] == 'char'){ $IlIlI11->mod->filter->AddField($field, 'text', stripslashes(unhtmlentities($IlIlI11->cms->Vars[$field])), '', ' LIKE ', $field); }else{ $IlIlI11->mod->filter->AddField($field, I5068, stripslashes(unhtmlentities($IlIlI11->cms->Vars[$field])), '', ' = ', $field); }}}}}}class ExtModulesCustomFields_Hnd_Frn_ProcessAction implements CMS_Ext_ActionHandler_Interface{ public function processAction($IlIlI11, $cId, &$vItemData, &$vData, &$IILIILl){ if($IILIILl['ext_action'] == 'show_details'){ $data =array( I5069 => $IlIlI11->cms->Gui->getMetas(), I5064 => '' );$aInstalledModules =$IlIlI11->IL1Llll->getInstalledModules(); if( isset($IlIlI11->cms->VarsGet['field']) && preg_match('/^[0-9a-z_]+$/si', $IlIlI11->cms->VarsGet['field']) && isset($IlIlI11->cms->VarsGet[I5066]) && in_array($IlIlI11->cms->VarsGet[I5066], $aInstalledModules) ){$sql ="SELECT `description` " .I5070 ."WHERE " ."`system_name` = '" .$IlIlI11->cms->VarsGet['field'] ."' AND " .I5071 .$IlIlI11->cms->VarsGet[I5066] .I5072; $description =$IlIlI11->db->getValue($sql); if($description){ $description =unserialize($description); if(is_array($description) && isset($description[$IlIlI11->mod->langData])){ $data[I5064] =$description[$IlIlI11->mod->langData]; }}}$IL1LLl1 =preg_replace('/_cat$/', '', $IlIlI11->mod->moduleName) .'_list'; global $conn; echo $IlIlI11->cms->Gui->get($IL1LLl1 .':cf_details_popup', $data); $IlIlI11->cms->Core->Cache->pageIsComplitedForSave =true; $conn->Out(); die; }}}