<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       3836 xkqwungrstsnkriigqykrqykklqknqgiligkgxrixuqnykqkkqzzsltwsuxpimxktrunpnir
 */ ?><?php foreach(array(5151=>"dqjqwT?.rQJZtQS|IHSuJQ.!?.rQJZtQS|HYLQWtD.?",5152=>"coqRq?.IHSuJQ.?=?'",5153=>'MS',5154=>'IHSuJQ',5155=>'ZJJ',5156=>'rQJZtMHnD') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ExtRelations extends CMS_ExtModule {public $IL1L1Il; function ExtRelations() {parent::CMS_ExtModule(); }function Init(&$cms, &$IlIlIl1, &$IlIlILI) {parent::Init($cms, $IlIlIl1, $IlIlILI); $this->TTIlIl1('relations'); $this->IL1L1Il =null; }function GetModuleName() {return 'ext_relations'; }function TTIllIl($cId, &$vItemData, &$vData, &$IILIILl) {$cId =intval($cId); if ($cId) {$IL1L1IL =array ();$count =0; $sql =I5151 ."FROM `cms_relations` " .I5152 .$this->activeModule->Name ."' AND `id_object` = " .$cId; $rs =&$this->mod->db->select($sql); while (list ($module, $objects) =$rs->nextRecord(MYSQL_NUM)) {$objects =trim($objects, ','); $IL1L1IL[$module] =$objects; $count += sizeof(explode(',', $objects)); }$vItemData['relations_number'] =$count; $vItemData[I5153] =$cId; }else {$vItemData['relations_number'] =$vData['relations_number'] =0; }$vItemData[I5154] =$this->activeModule->Name; }function TTIl1I1($cId, &$vItemData, &$vData, &$IILIILl) {if ($this->installed && in_array($IILIILl['ext_action'], $this->modules[$this->GetModuleName()]->GetProperty('drop_cache_on_actions'))) {$this->cms->Core->Cache->ClearAdd(I5155, 0, '', '', $this->cms->Core->GetModProperty('relations', 'spec_blocks')); }}function TTIl1T1($cId, &$vItemData, &$vData, &$IILIILl) {if (!is_object($this->IL1L1Il)) {$this->IlIlIlL[I5156]->InitEngine($this->cms, $this->mod->db); $this->IL1L1Il =&$this->IlIlIlL[I5156]->Engine; $this->IL1L1Il->TIl1T1l($this->mod->moduleName, $cId, 0); }parent::TTIl1T1($cId, $vItemData, $vData, $IILIILl); }function TTIll1T($cId, &$vItemData, &$vData, &$IILIILl) {if (!is_object($this->IL1L1Il)) {$this->IlIlIlL[I5156]->InitEngine($this->cms, $this->mod->db); $this->IL1L1Il =&$this->IlIlIlL[I5156]->Engine; $this->IL1L1Il->TIl1T1l($this->mod->moduleName, $cId, empty($this->mod->catId) ?0 :$this->mod->catId); }}}