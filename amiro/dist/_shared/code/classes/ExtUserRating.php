<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    Users 
 * @version    $Id$ 
 * @size       2903 xkqwxxplkupigygwrqmzxxurluuukqtztkuzsykkyunmzzgqtrmsxmigtirzlyrnullwpnir
 */ ?><?php foreach(array(5209=>'Qnv~tQIGJZtQ|DBD',5210=>'"^',5211=>'SMDWuDDMHn',5212=>'MS',5213=>'IQIYQr|rZtMnP') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ExtUserRating extends CMS_ExtModule{ public function Init(&$cms, &$IlIlIl1, &$IlIlILI){ if(AMI_Registry::get('side') === 'frn'){ $oTpl =AMI::getResource(I5209); $aLocale =$oTpl->parseLocale('templates/lang/user_rating.lng'); AMI_Registry::set('AMI/resources/j/r', TRUE); $cms->Gui->addHtmlScript('var amiUserRatingVoteForYourself = "' .$aLocale['vote_for_yourself'] .I5210); $cms->Gui->addHtmlScript('var amiUserRatingVoteGuest = "' .$aLocale['vote_guest'] .I5210); $cms->Gui->addHtmlScript('var amiUserRatingVoteNegative = "' .$aLocale['vote_negative'] .I5210); AMI_Event::addHandler('ON_AMI_FORUM_ITEM_ROW', array($this, 'handleItemRow'), 'forum'); AMI_Event::addHandler('ON_AMI_DISCUSSION_ITEM_ROW', array($this, 'handleItemRow'), I5211); }parent::Init($cms, $IlIlIl1, $IlIlILI); }public function GetModuleName(){ return "ext_user_rating"; }public function handleItemRow($name, array $aEvent, $handlerModId, $srcModId){ $aItem =$aEvent['aItem']; $oItem =AMI::getResourceModel($srcModId .'/table')->find($aItem['id'], array(I5212, 'id_member', 'rating_pos', 'rating_neg')); $oRating =AMI::getSingleton('users/rating'); $aItem[I5213] =$oRating->getUserRatingHTML($aItem['id_member'], true, $aItem['user_rating_value']); $aItem['item_rating'] =$oRating->getItemRatingHTML($oItem, true); $aEvent['aItem'] =$aItem; return $aEvent; }}