<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       3988 xkqwmugsigxikqxtixsmluiwmtmtysnqwknnltugwxpmzpwlxkkzlptuiyizpnqpwikqpnir
 */ ?><?php foreach(array(6881=>'wjzddqd|gzTo',6882=>"IHSuJQ|nZIQ",6883=>"ZWtMHn",6884=>"0",6885=>"uDQrnZIQ",6886=>"JZDtnZIQ",6887=>"WHIIQntD") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleAuditPopup extends CMS_ActModule {public $ILLLLlI; public $ILLLLLl; function ModuleAuditPopup(&$cms, &$db, &$cModule) {$this->ILLLLlI =null; $this->ILLLLLl =Array(); parent::CMS_ActModule($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11 =Array(); $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function TTTlI11(&$vData, &$aCustom) {$vData += $this->cms->Vars; require_once $GLOBALS[I6881] .'AuditObject.php'; $this->ILLLLlI =new AuditObject($this->cms, $this->db); if(!$this->ILLLLlI->Init($this->cms->Vars["item_id"], $this->cms->Vars[I6882])) {trigger_error("Audit object was not initialized", E_USER_ERROR); }$aHistory =$this->ILLLLlI->TTTT111(0); $ILLL1L1 =Array( "tpl_block" => "srv_audit_popup_list", "browser_position" => $this->browser->Position, "browser_page_size" => $this->browser->PageSize, "fields" => Array( "history" => Array(I6883 => "callback", "object"=>&$this, "method"=>"_GetHistoryRowCB"), ),);$ILLL11I =I6884; foreach($aHistory as $key=>$val) {$ILLL11I .= ",".$val["id_actor"].",".$val["id_owner"]; }$sql ="SELECT id, firstname, lastname, username FROM cms_members WHERE id IN (".$ILLL11I.")"; $this->db->query($sql); while($this->db->next_record()) {$this->ILLLLLl[$this->db->Record["id"]] =$this->db->Record; }$vData["list_table"] =$this->TTT1lT1(serialize($aHistory), $ILLL1L1); $vData["subform"] =$this->cms->Gui->get("srv_audit_popup_subform", $vData); }function _GetHistoryRowCB(&$vItem, &$vData) {$vItem["status"] =$this->words[$vItem["status"]]; $vItem["owner"] =$this->ILLLLLl[$vItem["id_owner"]][I6885]; $vItem[I6885] =$this->ILLLLLl[$vItem["id_actor"]][I6885]; $vItem["firstname"] =$this->ILLLLLl[$vItem["id_actor"]]["firstname"]; $vItem[I6886] =$this->ILLLLLl[$vItem["id_actor"]][I6886]; $vItem["changed_by"] =$this->words[$this->cms->Core->TTllIII($this->itemData[I6882], $vItem["id_actor"])]; $vItem["comments_short"] =$this->cms->stripLine($vItem[I6887], 30, true); }}?>