<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       30767 xkqwkgukwgpptgnissnqyyttrgmwrlkksqptgryxtwirxrnrzkputpkqtmtyrtyxxgsipnir
 */ ?><?php foreach(array(7678=>"ZJJHCQS|ZWtMHnD",7679=>"SQJ",7680=>'S',7681=>"nZIQ",7682=>'',7683=>'SZtQfrHI',7684=>"fJt|nZIQ",7685=>"fMQJSD|IZG",7686=>"fMQJSD|DOZrQS",7687=>"^",7688=>"fMQJSD|WZGtMHnD",7689=>"MS",7690=>"MD|DOZrQS",7691=>"MD|uDQS",7692=>"OZrSWHSQS|",7693=>"nQQS|WZGtMHn",7694=>"MnMt|fMQJSD",7695=>'W',7696=>'DtrMGJMnQ',7697=>'DKu|IZG',7698=>'WZJJYZWK',7699=>'ZWtMHn',7700=>"ZWtMHn",7701=>"Hn",7702=>"fJZPMWHn",7703=>"Hff",7704=>'|DQtzWtMHnsQJ',7705=>'JQP|BQJJHC',7706=>"fHrI|SZtZ",7707=>"DZvQ",7708=>"nuIfMQJSD",7709=>"ZWtMHn|SQJ",7710=>"nuIWZtD",7711=>"|SZtZDQtD?S?",7712=>"coqRq?S`MS='",7713=>'QrrnH',7714=>"",7715=>"WZGtMHn|",7716=>"fMJtQr|",7717=>"GrHG|rQGQZt",7718=>"fMQJSD|DOHC|QIGtB",7719=>"^:'?ZnS?JZnP='",7720=>"FRhi?",7721=>'fMQJSD|WZGtMHnD',7722=>"fMQJSD|fMJtQr",7723=>"OZrSWHSQS|fMQJSD",7724=>"SZtZDQt|SZtZ",7725=>"|SZtZDQtD`JnP",7726=>"WZGtMHn",7727=>"vZJuQ",7728=>"sqdwRmyq?.",7729=>'DQJQWtQS') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleEshopDatasets extends CMS_ActModule {public $oEshop; public $I11lILL; public $ILL1llL; public $I11lIL1; public $I11lI1I; private $I11lI1l; function ModuleEshopDatasets(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); $this->I11lILL =array(); $this->I11lIL1 =array(); $this->I11lI1I =false; }function _Init($IIll1l1 =Array(), $IIll1LI ='', $IIll1Ll ='', $aOptions =Array()) {$IIIIL11[I7678] =Array("add", "edit", "apply", "save", I7679, "copy"); $IIIIL11["group_operations"] =Array(I7679, "copy"); $IIIIL11['default_prefix'] =I7680; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); if($this->side == "admin"){ $sql ="select * from ".$this->oEshop->dbTablePrefix."_custom_types order by fnum"; $this->db->query($sql); while($this->db->next_record()){ $I11I1Ll =unserialize($this->db->Record["name"]); if(is_array($I11I1Ll)) $this->db->Record[I7681] =$I11I1Ll[$this->langData]; $I11I1LL =unserialize($this->db->Record["default_caption"]); if(is_array($I11I1LL)){ $key ='def_caption_flt_' .$this->db->Record['text_comparison']; $this->db->Record['default_caption'] =$I11I1LL[$this->langData] .(isset($this->words[$key]) ?$this->words[$key] :I7682); }$this->I11lILL[] =$this->db->Record; }}$this->ILL1llL =$this->module->GetProperty("hardcoded_fields"); if(!is_array($this->ILL1llL)) $this->ILL1llL =array(); foreach($this->ILL1llL as $key => $val){ if($val <100000) $this->ILL1llL[$key] =$val+100000; }}function _InitAdmin() {parent::_InitAdmin(); require_once $GLOBALS['CLASSES_PATH'] .'EshopAdmin.php'; $this->oEshop =new EshopAdmin($this->cms, $this->words); $this->oEshop->init($this->moduleName); $this->oEshop->TT1l11l($this->options["multi_sites"], $this->siteId); if($this->filter->issetField(I7683)){ $this->filter->TITI1l1(I7683); }if($this->filter->issetField('dateto')){ $this->filter->TITI1l1('dateto'); }$this->filter->IL11l1L =array('limit'); }function ProcessAction($IIIL11l, $cId, $cModule ="") {parent::ProcessAction($IIIL11l, $cId, $cModule); }function TTTlIII() {parent::TTTlIII(); $this->filter->AddField(I7684, "text", isset($this->cms->Vars[I7684]) ?stripslashes(unhtmlentities($this->cms->Vars[I7684])) :I7682, "", " like ", "d.name"); }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); $this->fn->TITTTll($this->oEshop->dbTablePrefix); if(!isset($this->itemData[I7685])){ $sql ="select fields_shared from ".$this->oEshop->dbTablePrefix."_datasets where lang='".$this->langData."' limit 1"; $this->db->query($sql); if($this->db->next_record()){ $vData["initial_shared"] =$this->itemData[I7685] =$this->itemData[I7686] =$this->db->Record[I7686]; }}else $vData["initial_shared"] =$this->itemData[I7686]; }function TTTlI11(&$vData, &$aCustom) {$initFileds =array(); $sharedFileds =array(); $filterFileds =array(); $I11lI1L =array(); $I11lI11 =array(); if(isset($this->itemData[I7685])){ $initFileds =explode(";", $this->itemData[I7685]); $sharedFileds =explode(";", $this->itemData[I7686]); $filterFileds =isset($this->itemData["fields_filter"]) ?explode(I7687, $this->itemData["fields_filter"]) :array(); $I11lI1L =isset($this->itemData["fields_show_empty"]) ?explode(I7687, $this->itemData["fields_show_empty"]) :array(); $I11lI11 =isset($this->itemData["fields_captions"]) ?unserialize($this->itemData[I7688]) :array(); }$vData["hasCustomFields"] =false; if(!isset($vData["free_fields"])){ $vData["free_fields"] =I7682; }for($i =0; $i <sizeof($this->I11lILL); $i++){ $fieldData =array("id" => $this->I11lILL[$i][I7689], I7681 => addslashes(unhtmlentities($this->I11lILL[$i][I7681])), "caption" => str_replace("\\", "\\\\", isset($I11lI11[$this->I11lILL[$i][I7689]]) ?$I11lI11[$this->I11lILL[$i][I7689]] :$this->I11lILL[$i]["default_caption"]), I7690 => in_array($this->I11lILL[$i][I7689], $sharedFileds), "is_filter" => in_array($this->I11lILL[$i][I7689], $filterFileds), "is_showempty" => in_array($this->I11lILL[$i][I7689], $I11lI1L), "is_unique" => 1, "need_caption" => 1, I7691 => "0"); $vData["free_fields"] .= $this->cms->Gui->get($this->moduleName."_subform:free_field", $fieldData); $vData["hasCustomFields"] =true; }foreach($this->ILL1llL as $postf => $IL1l1L1){ $fieldData =array(I7689 => $IL1l1L1, I7681 => $this->words[I7692.$postf], "caption" => isset($I11lI11[$IL1l1L1]) ?$I11lI11[$IL1l1L1] :$this->words[I7692.$postf], I7690 => 0, "is_unique" => stristr($postf, "splitter") === false && stristr($postf, "block") === false ?1 :0, I7693 => stristr($postf, "splitter") === false && stristr($postf, "block") === false ?1 :0, I7691 => "0"); $vData["free_fields"] .= $this->cms->Gui->get($this->moduleName."_subform:free_field", $fieldData); $vData["hasCustomFields"] =true; }if(!isset($vData["init_fields"])){ $vData["init_fields"] =I7682; }for($i =0; $i <sizeof($initFileds); $i++){ if($initFileds[$i] >0){ $subId =0; if(($pos =mb_strpos($initFileds[$i], "_")) !== false){ $subId =intval(mb_substr($initFileds[$i], $pos+1)); $initFileds[$i] =intval(mb_substr($initFileds[$i], 0, $pos)); }$vData[I7694] .= $this->cms->Gui->getAbs($this->moduleName."_subform:init_fields", array(I7689 => $initFileds[$i], "sub_id" => $subId)); }}$this->browser->InitSQL("d.id, d.postfix, d.name, d.sku_map, d.fields_map, count(cat.id) as numcats, d.is_sys", "FROM ".$this->oEshop->dbTablePrefix."_datasets d LEFT JOIN ".$this->oEshop->dbTablePrefix."_cats cat ON d.id=cat.dataset_id", "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), "d.id", "d.id" );$this->browser->AddSQLJoinedTables($this->cms->Core, I7680, Array(I7695=>$this->oEshop->dbTablePrefix."_cats")); $aCustom['fields'] =Array( 'name'=>Array('action'=>I7696, 'size'=>100), 'postfix'=>Array('action'=>I7696, 'size'=>50), I7697=>Array('action'=>I7696, 'size'=>50), 'fields_map'=>Array('action'=>I7698, 'object'=>&$this, 'method'=>'_fieldsnumCB'), 'numcats'=>Array(I7699=>I7698, 'object'=>&$this, 'method'=>'_catsnumCB'), "action_copy"=>Array(I7700=>"flagicon", "value"=>"", I7689=>"copy_id", I7701=>$this->moduleName."_list:copy","off"=>""), "action_edit"=>Array(I7700=>I7702, "value"=>"", I7689=>"edit_id", I7701=>$this->moduleName."_list:edit",I7703=>""), 'action_del'=>Array(I7699=>I7698, 'object'=>&$this, 'method'=>I7704), );$aCustom['applied_id'] ='d.id'; $aCustom['legend'] =Array('leg_red', I7705, 'leg_blue', 'leg_edit', 'leg_del', 'leg_copy'); $aCustom[I7706]["buttons"] =Array("add", "apply", "cancel", I7707); parent::TTTlI11($vData, $aCustom); }function _fieldsnumCB(&$aItem, &$aData){ $aItem["numfields"] =0; foreach(explode(I7687, $aItem[I7685]) as $key => $val){ if($val >0) $aItem["numfields"]++; }$aItem["numfields"] ="".$aItem[I7708]; }function _setActionDel(&$aItem, &$aData){ $links["del_id"] =$links["edit_id"] =$links["pub_id"] =$aItem[I7689]; if(!$aItem["is_sys"]) $aItem[I7709] .= $this->cms->Gui->get($this->moduleName."_list:del", $links); else $aItem[I7709] =$this->cms->Gui->get($this->moduleName."_list:icon_none", $links); }function _catsnumCB(&$aItem, &$aData){ $aItem["numcats"] ="".$aItem[I7710]; }function TIIIlTI($isEqual =false){ if($this->cms->Core->issetOption("dataset_max_allowed") && $this->cms->Core->GetOption("dataset_max_allowed") >0){ $sql ="SELECT count(*) as count ". "FROM ".$this->oEshop->dbTablePrefix.I7711. "WHERE 1".$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {if(!$isEqual && $this->db->Record["count"] >$this->cms->Core->GetOption("dataset_max_allowed") || $isEqual && $this->db->Record["count"] >= $this->cms->Core->GetOption("dataset_max_allowed")){ $this->cms->AddStatusMsg("status_maxds_fail", "red"); return false; }}}return true; }function TTTl1Tl($cId, $cModule) {if(!$this->cms->Core->TT1lTTl($this)) return false; parent::TTTl1Tl($cId, $cModule); $sql ="SELECT * ". "FROM ".$this->oEshop->dbTablePrefix.I7711. I7712.$cId."'".$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; }}function TTTll11($cId, $cModule){ if(!$this->cms->Core->TT1lTTl($this, true)) return false; parent::TTTll11($cId, $cModule); if($II1LLLL->errno == 0){ $this->TIIIlTl($this->appliedId, $this->cms->VarsPost["initial_shared"]); }}function TTTl1lI($cId, $cModule) {if(!$this->cms->Core->TT1lTTl($this)) return false; $I11llII =""; $sql ="select * from ".$this->oEshop->dbTablePrefix."_datasets d where d.id=".intval($cId); $this->db->query($sql); if($this->db->next_record()){ $I11llII =$this->db->Record[I7686]; }parent::TTTl1lI($cId, $cModule); $II1LLLL =$this->GetLastError(); if(empty($II1LLLL['errno'])){ $this->TIIIlTl($cId, $I11llII); $this->fn->TITTTlT($this->oEshop->dbTablePrefix, $cId); }}function _ActionDel($cId, $cModule) {$sql ="select count(*) as count from ".$this->oEshop->dbTablePrefix."_datasets where is_sys=1 and id=".intval($cId); $this->db->query($sql); $this->db->next_record(); if($this->db->Record["count"] <= 0){ parent::_ActionDel($cId, $cModule); $II1LLLL =$this->GetLastError(); if(empty($II1LLLL[I7713])){ $this->fn->TITTTI1($this->oEshop->dbTablePrefix, $cId); }}else{ $this->SetLastError(3, "Deleting failed"); $this->cms->AddStatusMsg("status_del_sys_fail", "red"); }}function TTT1IlI($aSql =Array(), $cId =0) {$name =$this->cms->VarsPost[I7681]; $postfix =$this->cms->VarsPost["postfix"]; $fieldsMap =I7714; $I11llII =I7714; $I11llIl =I7714; $I11llIL =I7714; $I11lI11 =array(); foreach(explode(';', $this->cms->VarsPost[I7685]) as $key => $fld){ $I11llI1 =false; if(($pos =mb_strpos($fld, "_")) !== false){ $I11lllI =intval(mb_substr($fld, $pos+1)); $fld =mb_substr($fld, 0, $pos); $I11llI1 =true; }$fld =intval($fld); if($fld >= 100000){ if(in_array($fld, $this->ILL1llL)){ $fieldsMap .= I7687.$fld.($I11llI1 ?"_".$I11lllI :I7714); $I11lI11[$fld.($I11llI1 ?"_".$I11lllI :I7714)] =$this->cms->VarsPost[I7715.$fld.($I11llI1 ?"_".$I11lllI :I7714)]; if(empty($I11lI11[$fld])){ foreach($this->ILL1llL as $postf => $IL1l1L1) if($IL1l1L1 == $fld) $I11lI11[$fld.($I11llI1 ?"_".$I11lllI :I7714)] =$this->words[I7692.$postf]; }}}else{ for($i =0; $i <sizeof($this->I11lILL); $i++){ if($this->I11lILL[$i][I7689] == $fld){ $fieldsMap .= I7687.$fld; if($this->cms->VarsPost["shared_".$fld] == "1") $I11llII .= I7687.$fld; if($this->cms->VarsPost[I7716.$fld] == "1") $I11llIl .= I7687.$fld; if($this->cms->VarsPost["showempty_".$fld] == "1") $I11llIL .= I7687.$fld; $I11lI11[$fld] =$this->cms->VarsPost[I7715.$fld]; if(empty($I11lI11[$fld])) $I11lI11[$fld] =$this->I11lILL[$i]["default_caption"]; break; }}}}if(!empty($fieldsMap)) $fieldsMap .= I7687; if(!empty($I11llII)) $I11llII .= I7687; if(!empty($I11llIl)) $I11llIl .= I7687; if(!empty($I11llIL)) $I11llIL .= I7687; if($name != I7682 && $postfix != I7682 ){if (is_array($I11lI11)) {foreach ($I11lI11 as $k => $v) {$I11lI11[$k] =stripslashes($v); }}$aSql =Array( I7681=>$name, I7717=>min(max(0, $this->cms->VarsPost[I7717]), 10), "postfix"=>$postfix, "sku_map"=>$this->cms->VarsPost["sku_map"], I7685 => $fieldsMap, I7686 => $I11llII, "fields_filter" => $I11llIl, I7718 => $I11llIL, I7688 => addslashes(serialize($I11lI11)), );$this->I11lI1l =$I11lI11; }$aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function TIIIlTl($cId, $I11llll){ $cId =intval($cId); $sql ="select fields_shared, fields_map from ".$this->oEshop->dbTablePrefix."_datasets where id=".$cId; $this->db->query($sql); if($this->db->next_record()){ $shared =$this->db->Record[I7686]; $I11lllL =$this->db->Record[I7685]; }$I11lll1 =array(); foreach(explode(I7687, $shared) as $null => $id){ if(empty($id) || $id <= 0){ continue; }if(isset($this->I11lI1l[$id])){ $I1IIILl =$this->I11lI1l[$id]; }else{ $I1IIILl =I7682; for($i =0; $i <sizeof($this->I11lILL); $i++){ if($this->I11lILL[$i][I7689] == $id){ $I1IIILl =$this->I11lILL[$i][I7681]; }}}if(mb_strpos($I11llll, I7687.$id.I7687) === false){ $I11llLI =array(); $sql ="select * from ".$this->oEshop->dbTablePrefix."_datasets where fields_shared not like '%;".$id.I7719.$this->langData."' and id!=".$cId; $this->db->query($sql); while($this->db->next_record()){ $I11llLI[] =$this->db->Record; }for($i =0; $i <sizeof($I11llLI); $i++){ $I1l1lLI =array(); if(mb_strpos($I11llLI[$i][I7685], I7687.$id.I7687) === false){ $I1l1lLI[I7685] .= (empty($I11llLI[$i][I7685]) ?I7687 :$I11llLI[$i][I7685]).$id.I7687; $I11llLl =unserialize($I11llLI[$i][I7688]); if(is_array($I11llLl)) $I11llLl[$id] =$I1IIILl; else $I11llLl =array($id => $I1IIILl); $I1l1lLI[I7688] =addslashes(serialize($I11llLl)); }$I1l1lLI[I7686] .= (empty($I11llLI[$i][I7686]) ?I7687 :$I11llLI[$i][I7686]).$id.I7687; $I11lll1[$I11llLI[$i][I7689]] =$I11llLI[$i][I7689]; $sql =$this->db->GenUpdateSql($this->oEshop->dbTablePrefix."_datasets", $I1l1lLI, "where id=".$I11llLI[$i][I7689]); $this->db->query($sql); }}else{ $sql ="SELECT `id`, `fields_captions` " .I7720 .$this->oEshop->dbTablePrefix ."_datasets " ."WHERE `fields_shared` LIKE '%;".$id.";%' AND `lang` = '" .$this->langData ."' AND `id` != " .$cId; $rs =$this->db->select($sql); while($record =$rs->nextRecord()){ $aCaptions =unserialize($record[I7721]); if(is_array($aCaptions)){ $aCaptions[$id] =$I1IIILl; }else{ $aCaptions =array($id => $I1IIILl); }$sql =$this->db->GenUpdateSql($this->oEshop->dbTablePrefix .'_datasets', array( I7721 => addslashes(serialize($aCaptions)) ),"WHERE `id` = " .$record['id']); $this->db->execute($sql); }}}foreach(explode(I7687, $I11llll) as $null => $id){ if(empty($id) || $id <= 0) continue; if(mb_strpos($shared, I7687.$id.I7687) === false){ $I11llLI =array(); $sql ="select * from ".$this->oEshop->dbTablePrefix."_datasets where fields_shared like '%;".$id.I7719.$this->langData."' and id!=".$cId; $this->db->query($sql); while($this->db->next_record()){ $I11llLI[] =$this->db->Record; }for($i =0; $i <sizeof($I11llLI); $i++){ $I1l1lLI =array(); if(mb_strpos($I11lllL, I7687.$id.I7687) === false){ $I1l1lLI[I7685] =str_replace(I7687.$id.I7687, I7687, $I11llLI[$i][I7685]); if($I1l1lLI[I7685] == I7687) $I1l1lLI[I7685] =I7714; $I11llLl =unserialize($I11llLI[$i][I7688]); if(is_array($I11llLl)) unset($I11llLl[$id]); else $I11llLl =array(); $I1l1lLI[I7688] =addslashes(serialize($I11llLl)); $I1l1lLI["fields_filter"] =str_replace(I7687.$id.I7687, I7687, $I11llLI[$i]["fields_filter"]); if($I1l1lLI["fields_filter"] == I7687) $I1l1lLI[I7722] =I7714; }$I1l1lLI[I7686] =str_replace(I7687.$id.I7687, I7687, $I11llLI[$i][I7686]); if($I1l1lLI[I7686] == I7687) $I1l1lLI[I7686] =I7714; $I11lll1[$I11llLI[$i][I7689]] =$I11llLI[$i][I7689]; $sql =$this->db->GenUpdateSql($this->oEshop->dbTablePrefix."_datasets", $I1l1lLI, "where id=".$I11llLI[$i][I7689]); $this->db->query($sql); }}}if(sizeof($I11lll1) >0){ $this->fn->TITTTlT($this->oEshop->dbTablePrefix, $I11lll1); }}function _ActionCopy($cId, $cModule){ if(!$this->cms->Core->TT1lTTl($this, true)) return false; parent::_ActionCopy($cId, $cModule); $II1LLLL =$this->GetLastError(); if(empty($II1LLLL[I7713])){ $sql ="update ".$this->oEshop->dbTablePrefix."_datasets set is_sys=0 where id=".intval($this->appliedId); $this->db->query($sql); }}function TIIIlT1($I11llLL) {if(!$this->I11lI1I) {$this->I11lI1I =true; $this->I11lIL1 =Array(); $db =new DB_si; $this->ILL1llL =$this->module->GetProperty(I7723); $catId =$this->oEshop->mEshop->GetOption("small_filter_start_cat"); if($catId) {$I11llL1 =false; }else {$catId =$this->oEshop->rootCatId; $I11llL1 =true; }$I11ll1I =I7714; if($catId >0) {$sql ="SELECT dataset_data FROM ".$this->oEshop->dbTablePrefix."_cats WHERE id='".$catId."'"; $db->query($sql); if($db->nextRecord()) {if($db->Record[I7724] != I7714) {$aDataset =unserialize($db->Record[I7724]); if($aDataset[I7722] != I7714) {$I11ll1l =explode(I7687, $aDataset[I7722]); if($I11llL1) {$I11ll1L =explode(I7687, $aDataset[I7686]); $I11ll1l =array_intersect($I11ll1l, $I11ll1L); }$I11ll11 =sizeof($I11ll1l); unset($I11ll1l[$I11ll11 -1]); unset($I11ll1l[0]); if($I11ll11 >2) {$I11ll1I ="t.id IN('".implode("','", $I11ll1l)."')"; }}}}}$ILL1llL =$this->module->GetProperty(I7723); foreach($ILL1llL as $key => $val){ if($val <100000) {$ILL1llL[$key] =$val+100000; }}$words =$this->cms->Gui->ParseLangFile("templates/lang/".$this->oEshop->ownerName.I7725); foreach($ILL1llL as $postf => $IL1l1L1){ if(in_array($postf, $I11llLL)) {$selected ="selected"; }else {$selected =I7714; }$this->I11lIL1[] =array( I7681 => $postf, "caption" => $words[I7692.$postf], "selected" => $selected );}if($I11ll1I != I7714) {$sql ="SELECT t.* FROM ".$this->oEshop->dbTablePrefix."_custom_types AS t WHERE ".$I11ll1I; $db->query($sql); while($db->next_record()) {if(in_array($db->Record["fnum"], $I11llLL)) {$selected ="selected"; }else {$selected =I7714; }$aCaption =unserialize($db->Record["default_caption"]); $this->I11lIL1[] =array( I7681 => $db->Record["fnum"], I7726 => $aCaption[$this->langData], "selected" => $selected );}}}}function getOptionsModFilterFieldsCB($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I ="getallvalues"){ $aData["allow_empty"] =true; switch($IIL1l1I){ case "getallvalues": $res =Array(); $this->TIIIlT1($cData[I7727]); $res =$this->I11lIL1; break; case "correctvalue": $this->TIIIlT1($cData[I7727]); $aIds =Array(); foreach($this->I11lIL1 as $aData) {$aIds[] =$aData[I7681]; }if(is_array($cData[I7727])) {$res =array_intersect($aIds, $cData[I7727]); }else {$res =Array(); }break; case "getvalue": $res =$cData[I7727]; break; }return true; }function getOptionsModTableFieldsCB($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I ='getallvalues'){ static $aFields; switch($IIL1l1I){ case 'getallvalues': if(!is_array($aFields)){ $sql =I7728 .$this->oEshop->dbTablePrefix ."_items`"; $rs =&$this->db->select($sql); while($record =$rs->nextRecord()){ $aFields[] =$record['Field']; }sort($aFields); }foreach($aFields as $field){ $res[] =array( 'name' => $field, 'caption' => $field, I7729 =>($field == $cData['value']) ?1 :0 );}break; case 'correctvalue': break; case 'getvalue': $res =$cData['value']; break; }return true; }}