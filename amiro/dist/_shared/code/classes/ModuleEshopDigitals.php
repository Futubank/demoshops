<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       6223 xkqwynutigizyzttmxkwwkuprprxzqkkqiitguuqqrwgpwkigrziuilsutlyilwxmpuipnir
 */ ?><?php foreach(array(7948=>'PQtZJJvZJuQD',7949=>"ZGGJB",7950=>"DtHG|uDQ|DuYJMnKD",7951=>"ZWtMvZtQ",7952=>"IuJtM|DMtQD",7953=>"MS",7954=>'nZIQ',7955=>'|wyFHrIZtNZIQ',7956=>'IQtOHS',7957=>'HYLQWt',7958=>'JMDt|SZtZ',7959=>"GuYJMW",7960=>"nZIQ",7961=>"MWHn",7962=>"Hn") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleEshopDigitals extends CMS_FilesImportModule {public $oEshop; function ModuleEshopDigitals(&$cms, &$db, &$cModule) {parent::CMS_FilesImportModule($cms, $db, $cModule); $this->filesPath =$GLOBALS["PRIVATE_PATH"].$this->module->GetOption("eshop_files_path"); }function getOptionFilesPathCB($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I =I7948) {$bValid =true; switch($IIL1l1I){ case I7948: $res =''; break; case 'getvalue': case 'correctvalue': $res =$cData['value']; break; case I7949: $I1111IL =$GLOBALS['ROOT_PATH'] .'_mod_files/'; if (mb_strpos(realpath($I1111IL .$cData['value']), realpath($I1111IL)) !== 0) {if (!isset($this->words['warn_forbidden_path'])) {$this->words += $this->cms->Gui->ParseLangFile('templates/lang/eshop_digitals_def.lng'); }$aData['warning'] =$this->words['warn_forbidden_path']; $bValid =false; }break; }return $bValid; }function _Init($IIll1l1 =Array(), $IIll1LI ='', $IIll1Ll ='', $aOptions =Array()) {$IIIIL11[I7950] =false; $IIIIL11["stop_arg_names"] =array("id"=>"eshop_currency"); $IIIIL11["allowed_actions"] =Array(I7949, I7951); $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_gui.php"); parent::_InitAdmin(); require_once $GLOBALS['CLASSES_PATH'] .'EshopAdmin.php'; $this->oEshop =new EshopAdmin($this->cms, $this->words); $this->oEshop->init($this->moduleName); $this->oEshop->TT1l11l($this->options[I7952], $this->siteId); }function TTTlITT($IIIL11l, $cId, $cModule ='') {switch ($IIIL11l) {case 'activate': $this->_ActionActivate($cId, $cModule); break; default: parent::TTTlITT($IIIL11l, $cId, $cModule); break; }}function &TTTlI1T(&$aCustom) {$aData =parent::TTTlI1T($aCustom); $aData["filter"] =""; return $aData; }function TTTlI11(&$vData, &$aCustom) {$IILIIL1 =$this->db; $this->db =new CMS_IteratorFiles($this->module); $this->browser->InitSQL(I7953, "FROM ".$this->oEshop->dbTablePrefix."_files ", "WHERE 1 " );$aCustom['fields'] =Array( I7954=>Array('action'=>'callback', 'object'=>&$this, 'method'=>I7955), 'file'=>Array('action'=>'callback', 'object'=>&$this, I7956=>'_CBFormatFile'), 'size'=>Array('action'=>'callback', I7957=>&$this, I7956=>'_CBFormatSize'), );$aCustom['applied_id'] =I7953; $aCustom['legend'] =Array(); if(is_object($this->filter)) {$this->filter->UpdateField("offset", $this->browser->Position); $aCustom[I7958]['filter_hidden_fields'] =$this->filter->GetFieldsAsHidden(); }$aCustom[I7958]['remove'] ="checked"; $aCustom[I7958]["action"] =I7949; $aCustom[I7958][I7959] ="checked"; $aCustom[I7958]["force_rewrite"] ="checked"; $this->appliedId =-1; $this->id =-1; parent::TTTlI11($vData, $aCustom); $this->db =$IILIIL1; }function _CBFormatName(&$aItem, &$aData){ $aItem["name"] =htmlspecialchars($aItem[I7960]); }function _CBFormatFile(&$aItem, &$aData){ $aItem["file"] =htmlentities($aItem["file"],ENT_QUOTES); $ext ='.'.mb_strtolower(get_file_ext($aItem["file"])); if (!empty($this->IlIllII[$ext])) {$aItem[I7961] =$this->IlIllII[$ext]; }else {$aItem[I7961] =$this->IlIllII['.']; }}function _CBFormatSize(&$aItem, &$aData){ $aItem["size"] =getBytesAsText($aItem["size"], $this->words, 1); }function _ActionActivate($cId, $cModule) {$this->fn->TITTT1l($cId, ($this->cms->VarsPost["free_download"]==I7962), $this->oEshop->dbTablePrefix."_files"); }}?>