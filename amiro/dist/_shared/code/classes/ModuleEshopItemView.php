<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       11491 xkqwspxzxwlyygutpslqisuunxtruiwnrzzmlwtluggkuzylzizqnzxtuzlyxwipwltgpnir
 */ ?><?php foreach(array(8549=>"DSMI",8550=>"",8551=>'vMQCHffDQt',8552=>'Qxt|MIZPQD',8553=>"fJt|nZIQ",8554=>"WOQWKYHx",8555=>"fJt|SMDWHunt",8556=>"M`Hn|DGQWMZJ",8557=>"OMSSQn",8558=>"fJt|GuYJMW",8559=>"YHSB|MtQID",8560=>'iHSuJQotIJ',8561=>'OQZSQrD',8562=>'vMQC|SQDWrMGtMHn',8563=>"vMQC|SZtZ",8564=>"DEJ",8565=>"DQJQWt",8566=>"?zNs?W`GuYJMW=1",8567=>"YHSB|MtQID|SQfZuJt",8568=>"nZv|SZtZ",8569=>"MtQI|",8570=>"vMQCMS",8571=>"|pQtgMWturQDwy") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleEshopItemView extends ModuleEshopItem{ public $viewId; public $lII1ll1; public $lII1lLI; public $lII1lLl; public $lII1lLL; function ModuleEshopItemView(&$cms, &$db, &$cModule) {parent::ModuleEshopItem($cms, $db, $cModule); $this->viewId =0; $this->lII1ll1 =""; $this->lII1lLI =Array("sort", I8549); $this->lII1lLl =Array("flt_public"); require_once $GLOBALS['CLASSES_PATH'] .'CMS_ViewFunctions.php'; $this->lII1lLL =new CMS_ViewFunctions($this->cms, "eshop_item"); }function TTTlITT($IIIL11l, $cId, $cModule) {$this->lII1lLL->ProcessAction($IIIL11l, $cId); parent::TTTlITT($IIIL11l, $cId, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI =I8550, $IIll1Ll =I8550, $aOptions =Array()) {if(!empty($this->cms->Vars["view_data"])) {$lII1lL1 =unserialize(stripslashes(unhtmlentities($this->cms->Vars["view_data"]))); if(is_array($lII1lL1)) {foreach($lII1lL1["filter_fields"] as $fname => $val) {$this->cms->Vars[$fname] =$val; }}}$IIIIL11['cat_offset'] =I8551; $aOptions += $IIIIL11; $this->viewId =intval($this->cms->Vars["viewid"]); parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); if(!isset($this->ext['ext_images'])){ if($this->cms->Core->IsInstalled('ext_images')) {$ext =&$this->GetExtension('ext_images'); if(is_object($ext)) {$this->ext[I8552] =&$ext; $this->ext[I8552]->Init($this->cms, $this->module, $this); }}}$IIlLIIL =Array("action"=>"_OverrideGenPicModName", "data"=> $_data =array('eshop_item')); parent::TTT1lI1($IIlLIIL, array(I8552)); }function TTTlIII() {parent::TTTlIII(); $this->cms->Filter->AddField(I8553, "text", stripslashes(unhtmlentities($this->cms->Vars[I8553])), I8550, " like ", "i.name"); $this->cms->Filter->MoveField(I8553, _MOVE_START); $this->filter->AddField("flt_discount", I8554, $this->cms->Vars["flt_discount"], "0", "=", "(i.discount>0)"); if(empty($this->cms->Vars[I8555])) {$this->filter->DisableFieldSql(I8555); }$this->cms->Filter->MoveField(I8555, _MOVE_START); $this->filter->AddField("flt_special", I8554, $this->cms->Vars["flt_special"], "0", ">=", I8556); if(empty($this->cms->Vars["flt_special"])) {$this->filter->DisableFieldSql("flt_special"); }$this->cms->Filter->MoveField("flt_special", _MOVE_START); $this->filter->AddField("flt_public", I8557, "1", "1", "=", "i.public"); if(empty($this->cms->Vars[I8558])) {$this->cms->Filter->DisableFieldSQL(I8558); }$this->filter->AddField("viewid", I8557, $this->viewId); }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {$this->lII1lLL->TT1TTI1($this->cms, $this->db, $this->viewId, $aCustom["list_data"], $this->lII1lLI, $this->lII1lLl, $this->moduleName."_list"); parent::TTTlI11($vData, $aCustom); }function TTTllTI(&$aCustom) {if($this->id >0) {$this->SetBodyType("body_itemD"); }else {$this->SetBodyType(I8559); }}function TTTlllT(&$vData) {parent::TTTlllT($vData); $this->cms->SetsTemplate =$this->moduleName."_list"; }function TTTll1T(&$vData, &$aCustom) {$aFilter =$this->lII1lLL->GetView($this->db, $this->viewId, "name, announce, description, view_data, sublink, sm_data, details_noindex", 1); if (isset($this->lII1lLL->aRecord['sm_data'])) {$IIl1IL1 =unserialize($this->lII1lLL->aRecord['sm_data']); $GLOBALS[I8560][I8561] =$this->cms->TITlTl1($GLOBALS[I8560][I8561], $IIl1IL1); $vData['view_name'] =$this->lII1lLL->aRecord['name']; $vData['view_announce'] =$this->lII1lLL->aRecord['announce']; $vData[I8562] =$this->lII1lLL->aRecord['description']; }if (isset($this->lII1lLL->aRecord['details_noindex']) && $this->lII1lLL->aRecord['details_noindex'] == '1') {$this->TTTllT1(); }$lII1l1I =unserialize($aFilter[I8563]); $this->lII1ll1 =$aFilter["sublink"]; $aNavData =Array(); $aNavData["viewid"] =$this->viewId; $aNavData["viewid_sublink"] =$this->lII1ll1; $aNavData =$this->cms->ApplyNav($aNavData); if($this->id >0) {$aCustom["body_itemD_default"][I8564] ="SELECT i.id,i.name,i.announce,i.description,i.price AS price0,i.tax,i.tax_type". $this->oEshop->getPriceFields("i.price%d, c.price_caption%d, SUBSTRING(c.price%d, INSTR(c.price%d, '#')+1, 3) AS currency%d, SUBSTRING(c.price%d, INSTR(c.price%d, ':')+1, 3) AS db_currency%d"). ", i.charge_tax_type,i.on_special,i.ext_picture,i.ext_popup_picture,i.discount,i.discount_type, i.item_type, i.num_files, ". "i.files_size, i.sublink, i.sm_data, i.details_noindex, i.id_category, c.sublink as cat_sublink, c.dataset_id ".$addSql[I8565]. " FROM ".$this->oEshop->dbTablePrefix."_items i INNER JOIN ".$this->oEshop->dbTablePrefix."_cats c WHERE i.id_category = c.id AND i.id = '".$this->id."' AND i.public=1 ". $this->_ApplyFilters().I8566.$lII1l1I["where"]; }else {$aCustom["body_items_default"]['sql']['fields'] ="i.id,i.name,i.announce,i.description,i.price AS price0".$this->oEshop->getPriceFields("i.price%d, c.price_caption%d, SUBSTRING(c.price%d, INSTR(c.price%d, '#')+1, 3) AS currency%d, SUBSTRING(c.price%d, INSTR(c.price%d, ':')+1, 3) AS db_currency%d"). ", i.tax,i.tax_type,i.charge_tax_type,i.on_special,i.ext_picture,i.ext_popup_picture,". "i.discount,i.discount_type, i.sublink, (LENGTH(i.description) = 0) AS descr_empty, i.item_type, ". "i.num_files, i.files_size, c.dataset_id "; $aCustom[I8567]['sql']['from'] ="FROM ".$this->oEshop->dbTablePrefix."_items i INNER JOIN ".$this->oEshop->dbTablePrefix."_cats c ON i.id_category=c.id"; $aCustom[I8567][I8564]["filter"] ="WHERE 1".$lII1l1I["where"]. $this->_ApplyFilters().$this->TTTlIl1(); $aCustom[I8567]["pager_navdata"] =$aNavData[I8568]; $aCustom[I8567]["list_data"] =Array( "simple_prefix"=>"item_", "splitter_prefix"=>I8569 );}parent::TTTll1T($vData, $aCustom); }function _GetNavDataCB(&$vItem, &$vData) {if($this->id >0) {$aNavData["id"] =$vItem["id"]; $aNavData["id_sublink"] =$vItem["sublink"]; }$aNavData[I8570] =$this->viewId; $aNavData["viewid_sublink"] =$aNavData["view_sublink"] =$this->lII1ll1; $vItem += $this->cms->ApplyNav($aNavData); }function _getItemCB(&$aItem, &$aData) {$this->oEshop->getItemCB($aItem, $aData); }function _GetPicturesCB(&$vItem, &$vData) {$lII1l1l =$this->IIllII1; $this->IIllII1 =$this->oEshop->ownerName.'_item'; $IIlLIIL =Array("action"=>I8571, "data"=> $_data =array(&$vItem, &$vData)); parent::TTT1lI1($IIlLIIL, array(I8552)); $this->IIllII1 =$lII1l1l; }}