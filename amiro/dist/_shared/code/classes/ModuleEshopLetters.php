<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       6692 xkqwnigtggsksizktgppkgtrzktzpxrgsynmuygrmsiyqtlsklxkrwkpxzquylmuzwxgpnir
 */ ?><?php foreach(array(8572=>"'?ZnS?JZnP='",8573=>"?coqRq?MS=",8574=>"'{",8575=>'JQttQr',8576=>"ZJGOZYQt",8577=>"DOHC",8578=>"DOHC|nuI|MtQID",8579=>"|JMDt%JQttQr",8580=>"JQttQrD|YHSB",8581=>"|JMDt%JQttQrD|YHSB",8582=>"JZnP",8583=>"WHunt|GuYJMW|MtQID") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleEshopLetters extends CMS_Functions {function ModuleEshopLetters(&$cms, &$db, &$cModule, &$IlILIl1) {parent::CMS_Functions($cms, $db, $cModule, $IlILIl1); }function TIIllI1($letter, $increment, $lang){ if(mb_strlen($letter) == 1 && $increment != 0){ $sql ="select id from ".$this->IlILIlL->oEshop->dbTablePrefix."_letters where letter like binary '".$letter.I8572.$lang."'"; $this->db->query($sql); $lII1l1L =0; if($this->db->next_record()) $lII1l1L =intval($this->db->Record["id"]); if($lII1l1L >0){ $sql ="UPDATE ".$this->IlILIlL->oEshop->dbTablePrefix."_letters SET count_public_items=count_public_items+".intval($increment).I8573.$lII1l1L; $this->db->query($sql); }else if($increment >0){ $sql ="INSERT INTO ".$this->IlILIlL->oEshop->dbTablePrefix."_letters(letter, count_public_items, lang) VALUES('". addslashes($letter)."', '".$increment."', '".$lang.I8574; $this->db->query($sql); }}}function TIIlllT($lII1l11 =""){ $lII1LII =array(); $sql ="select * from ".$this->IlILIlL->oEshop->dbTablePrefix."_letters where lang='".$this->IlILIlL->langData."'"; $this->db->query($sql); $counter =0; while($this->db->next_record()){ $counter++; $lII1LII[$this->db->Record[I8575]] =intval($this->db->Record['count_public_items']); }if($counter >0){ $numCols =intval($this->cms->Core->GetModOption($this->IlILIlL->oEshop->ownerName."_letters", "cols")); if($numCols <= 0) $numCols =32; $lII1LIl =$this->cms->Core->GetModOption($this->IlILIlL->oEshop->ownerName."_letters", I8576); if(isset($lII1LIl[$this->IlILIlL->langData])){ if(is_array($lII1LIl[$this->IlILIlL->langData])){ $cData =array('letters_body' => ''); $counter =0; foreach($lII1LIl[$this->IlILIlL->langData] as $lII1LIL => $letters){ $oneAtLeast =false; $lII1LI1 =true; for($i =0, $q =mb_strlen($letters); $i <$q; $i++){ $letter =mb_substr($letters, $i, 1); $lII1LlI =isset($lII1LII[$letter]) && $lII1LII[$letter] >0; if($lII1LlI || $this->cms->Core->GetModOption($this->IlILIlL->oEshop->ownerName."_letters", "show_no_items") == I8577){ $lII1LI1 =false; $counter ++; $oneAtLeast =true; $lII1Lll =array("letter_val" => $letter, "letter" => $letter, "show_number" => $this->cms->Core->GetModOption($this->IlILIlL->oEshop->ownerName."_letters", I8578) ?"1" :"0", "number" => $lII1LII[$letter]); $cData["letters_body"] .= $this->cms->Gui->getDefPostf($this->IlILIlL->moduleName.I8579.($lII1LlI ?($lII1l11 == $letter ?"_selected" :"") :"_noitems"), "_".$lII1LIL, $lII1Lll); if($counter %$numCols == 0){ $cData[I8580] .= $this->cms->Gui->getAbs($this->IlILIlL->moduleName."_list:letters_VSplitter"); $lII1LI1 =true; }}}if($this->cms->Core->GetModOption($this->IlILIlL->oEshop->ownerName."_letters", "divide_alphabets") && $oneAtLeast && !$lII1LI1){ $cData[I8580] .= $this->cms->Gui->getAbs($this->IlILIlL->moduleName."_list:letters_VSplitter"); $counter =0; }}return $this->cms->Gui->get($this->IlILIlL->moduleName.I8581, $cData); }}}return ""; }function TTT1Tl1($cType, $cModule, $condition =''){ $sql ="delete from ".$this->IlILIlL->oEshop->dbTablePrefix."_letters"; $this->db->query($sql); $letters =array(); $sql ="SELECT i.letter, i.lang FROM ".$this->IlILIlL->oEshop->dbTablePrefix."_items i LEFT JOIN ".$this->IlILIlL->oEshop->dbTablePrefix."_cats c ON i.id_category=c.id where c.public=1 AND i.public=1"; $this->db->query($sql); while($this->db->next_record()){ if(!isset($letters[$this->db->Record["lang"]])) $letters[$this->db->Record["lang"]] =array(); if(!isset($letters[$this->db->Record[I8582]][$this->db->Record["letter"]])) $letters[$this->db->Record[I8582]][$this->db->Record["letter"]] =0; $letters[$this->db->Record[I8582]][$this->db->Record["letter"]] += 1; }foreach($letters as $lang => $lII1LlL){ foreach($lII1LlL as $lII1Ll1 => $num){ $lII1Lll =array("letter" => addslashes($lII1Ll1), I8583 => $num, I8582 => $lang); $sql =$this->db->GenInsertSQL($this->IlILIlL->oEshop->dbTablePrefix."_letters", $lII1Lll); $this->db->query($sql); }}}}