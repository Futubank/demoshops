<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       44243 xkqwlmrulmmzgytlykswgnktqmnupwzsxgmuqqtwssuzskpkzwptrmslgsxuzpzmimkipnir
 */ ?><?php foreach(array(9051=>'qDOHGzSIMn`GOG',9052=>'iHSuJQTZxQD`GOG',9053=>'iHSuJQTZxwJZDDQD`GOG',9054=>"DtHG|uDQ|DuYJMnKD",9055=>"uDQ|GHDMtMHnD",9056=>"ZGGJB",9057=>"IHvQ|GHDMtMHn",9058=>":",9059=>"nHnQ",9060=>'vZJuQ',9061=>'zNs?GuYJMW?=?1',9062=>'WuDtHI|DOMGGMnP|',9063=>"fMQJSDQtD|HGtMHnD",9064=>"fJt|ZIHunt",9065=>"",9066=>"SZtQfrHI",9067=>'fJt|nZIQ',9068=>'fJt|ZIHunt',9069=>'ZIHunt',9070=>"?jmkq?",9071=>"uDQ|DOMGGMnP|IHSuJQ",9072=>"CZrn|DOMGGMnP|IHSuJQ|MD|SMDZYJQS",9073=>"]WurrQnWB=",9074=>"nZIQ",9075=>"WuDtHI|WHnSMtMHnD",9076=>"DOMGGMnP|tBGQD",9077=>"HGtMHn|rHC",9078=>"^",9079=>"|",9080=>"dqjqwT?[?FRhi?```",9081=>"tBGQ",9082=>"WuDtHI|fMQJSD",9083=>'tBGQ|HGtMHnD',9084=>'tBGQ',9085=>".?",9086=>"DhrSQr",9087=>"ZIHunt",9088=>"I`[",9089=>"I`MS?sqdw",9090=>"ZWtMHn",9091=>"DMAQ",9092=>"fJZPMWHn",9093=>"|JMDt%QSMt",9094=>"WHGB|MS",9095=>"vZJuQ",9096=>"Hff",9097=>"|rHCwy",9098=>"JQP|QSMt",9099=>"ZSS",9100=>"IQtOHS|MS",9101=>"rQPMHnD",9102=>"fJHZt",9103=>"IZx|",9104=>"_",9105=>"ZdEJ",9106=>"dqjqwT?I`[?",9107=>"IZx|tHtZJ",9108=>"WOQWKQS",9109=>"MS|GZrQnt",9110=>"sqjqTq?FRhi?.",9111=>"mNdqRT?mNTh?.",9112=>"'",9113=>"DQJQWtQS",9114=>"COQrQ",9115=>"DQJQWt",9116=>"?FRhi?",9117=>"{?zNs?}",9118=>"JMIMt",9119=>"=",9120=>'WuDtHI|WHnSMtMHnD',9121=>"WuDtHI|DOMGGMnP|",9122=>"tBGQ|HGtMHnD",9123=>"rQS",9124=>"fMQJS|nZIQ",9125=>"rZSMH|rHC",9126=>"SMDZYJQS",9127=>"jqFT?lhmN?.",9128=>"'?",9129=>"?.DQJQWtQS.?",9130=>'PQtZJJvZJuQD',9131=>'^',9132=>'WuDtHI|fMQJS|',9133=>'DMAQ',9134=>'DQJQWtQS',9135=>'ZJJHC|QIGtB') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleEshopShippingMethods extends CMS_ActModule {public $oEshop; public $lIlLIL1; public $_filter; public $lIlLI1I; public $lIlLI1l; public $lIlLI1L; public $lIlLI11; public $lIlLlII; public $I1111l1; public $lIlLlIl; public $I1111Ll; public $_success; public $I1111LL; public $lIlLlIL; public $I1LLlII; public $I1LLlIl; public $lIII11L; protected $aShippingFieldsHeaders =array(); function ModuleEshopShippingMethods(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); if($this->cms->Core->Side == "admin") {require_once $GLOBALS['CLASSES_PATH'] .I9051; $this->oEshop =new EshopAdmin($this->cms, $this->words); $this->oEshop->init($this->moduleName); require_once $GLOBALS['CLASSES_PATH'] .I9052; require_once $GLOBALS['CLASSES_PATH'] .I9053; $this->I1LLlII =new ModuleTaxClasses($cms, $db, $cModule); }else {CreateEshop($cms); $this->oEshop =&$cms->Eshop; }}function _Init($IIll1l1 =array (),$IIll1LI ='', $IIll1Ll ='', $aOptions =array ()){$IIIIL11 =array (I9054 => false, "lang_data" => true, "check_public" => false, "default_prefix" => "m", I9055 => true, "allowed_actions" => array ("add", "edit", "copy", I9056, "save", "del"), "group_operations" => array ("del", I9057) );$aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {$this->popup =isset($this->cms->Vars["popup"]) ?intval($this->cms->Vars["popup"]) :0; $this->lIlLIL1 =$this->oEshop->getCurrencyPrefix($this->oEshop->baseCurrency) .$this->oEshop->getCurrencyPostfix($this->oEshop->baseCurrency); $this->lIlLI1I =array ("abs" => $this->lIlLIL1, "percent" => I9058 );$this->_aValueStatuses =array( 'abs' => 'available', 'percent' => 'not_available' );$this->lIlLI1l =array (I9059 => I9059, "total" => "total", "weight" => "weight", I9060 => I9060 );$this->lIlLI1L =$this->lIlLI11 =array ();$oShippingFieldsList =AMI::getResourceModel('eshop_shipping_fields/table')->getList(); $oShippingFieldsList ->addColumns(array('id', 'header', 'postfix')) ->addWhereDef(I9061) ->addWhereDef(DB_Query::getSnippet('AND lang = %s')->q($this->langData)) ->addOrder('id', ' asc') ->load(); $fieldsets =array(); foreach($oShippingFieldsList as $oShippingFieldModelItem){ $fieldsets[] ='custom_shipping_' .$oShippingFieldModelItem->postfix; $this->aShippingFieldsHeaders[I9062 .$oShippingFieldModelItem->postfix] =$oShippingFieldModelItem->header; }foreach ($fieldsets as $fieldset) {$lIlLlI1 =preg_replace('/^custom\_shipping\_/', '', $fieldset); $this->lIlLI1L["|" .$lIlLlI1 ."|"] =$fieldset; $this->lIlLI11[] =$lIlLlI1; }$this->lIlLlII =array ();$this->lIlLlII =$this->module->GetOption(I9063); $this->_success =false; $this->I1111LL =null; $this->_filter =array ("flt_name" => isset($this->cms->Vars["flt_name"]) ?$this->cms->Vars["flt_name"] :"", I9064 => isset($this->cms->Vars[I9064]) ?$this->cms->Vars[I9064] :"", "flt_custom_conditions" => isset($this->cms->Vars["flt_custom_conditions"]) ?$this->cms->Vars["flt_custom_conditions"] :I9065, "flt_custom_fields" => isset($this->cms->Vars["flt_custom_fields"]) ?$this->cms->Vars["flt_custom_fields"] :I9065 );parent::_InitAdmin(); }function TTTlIII() {parent::TTTlIII(); if ($this->filter->issetField("datefrom")) {$this->filter->TITI1l1(I9066); }if ($this->filter->issetField("dateto")) {$this->filter->TITI1l1("dateto"); }$this->filter->AddField( 'flt_name', 'text', isset($this->cms->Vars[I9067]) ?stripslashes(unhtmlentities($this->cms->Vars[I9067])) :'', '', ' LIKE ', 'name' );$this->filter->MoveField( I9067, _MOVE_START );$this->filter->AddField( I9068, 'text', isset($this->cms->Vars[I9068]) ?stripslashes(unhtmlentities($this->cms->Vars[I9068])) :'', '', ' = ', I9069 );$this->filter->MoveField(I9068, _MOVE_PREV); if (!isset($this->cms->Vars[I9068]) || '' === $this->cms->Vars[I9068]) {$this->filter->DisableFieldSQL(I9068); }$this->TIII1lI("custom_conditions", $this->lIlLI1l, 13, "=", I9065); $this->words += $this->aShippingFieldsHeaders; $this->TIII1lI("custom_fields", $this->lIlLI1L, 50, I9070, I9065, "CONCAT(custom_fields, ' ' , REPLACE(custom_field_groups, '\"', '|'))"); }function TTTlI1I(&$vData) {if (!$this->module->GetOption(I9071)) {$this->cms->AddStatusMsg(I9072, "red"); }parent::TTTlI1I($vData); $this->cms->Gui->addScript("ranges_js.php?lang=" .$this->cms->lang ."&source=" .$this->moduleName .I9073 .rawurlencode($this->oEshop->baseCurrency)); $vData["base_currency"] =$this->lIlLIL1; $vData["common_type_options"] =$this->TIII1ll("type", "option_row", $this->lIlLI1I, I9065, true); if(!sizeof($this->itemData)){ if ($this->_success || !isset($this->cms->VarsPost[I9074])) {$wipe =array (I9074, "amount", "type", "kind", "delivery_time", I9075, "custom_fields", "regions", "comments"); foreach ($wipe as $lIIIIl1) {$this->cms->VarsPost[$lIIIIl1] =I9065; }$vData["shipping_types"] =$this->TIIl1II(0); }else {$lIlLllI =isset($this->cms->Vars[I9076]) ?$this->cms->Vars[I9076] :array ();$vData[I9076] =$this->TIIl1II(0, $shipping_types); }$vData[I9074] =$this->cms->VarsPost[I9074]; $vData["amount"] =$this->cms->VarsPost["amount"]; $vData["type_options"] =$this->TIII1ll("type", I9077, $this->lIlLI1I, $this->cms->VarsPost["type"]); $vData["delivery_time"] =$this->cms->VarsPost["delivery_time"]; $custom_conditions =empty($this->cms->VarsPost[I9075]) ?I9059 :$this->cms->VarsPost[I9075]; if ($custom_conditions != I9059) {$ids =isset($this->cms->VarsPost[$custom_conditions ."sOrder"]) ?explode(I9078, $this->cms->VarsPost[$custom_conditions ."sOrder"]) :array ();$max_ ="max_" .$custom_conditions; $amount_ ="amount_" .$custom_conditions; $type_ ="type_" .$custom_conditions; $rows =array ();foreach ($ids as $id) {$rows[] =array ($max_ => isset($this->cms->VarsPost[$max_ .I9079 .$id]) ?$this->cms->VarsPost[$max_ .I9079 .$id] :I9065, "amount" => isset($this->cms->VarsPost[$amount_ .I9079 .$id]) ?$this->cms->VarsPost[$amount_ .I9079 .$id] :I9065, "type" => isset($this->cms->VarsPost[$type_ .I9079 .$id]) ?$this->cms->VarsPost[$type_ .I9079 .$id] :I9065 );}$db =clone($this->db); require_once $GLOBALS['CLASSES_PATH'] .'CMS_IteratorArray.php'; $this->db =new CMS_IteratorArray($this->module); $this->db->SetArray($rows); $this->db->query(I9080); $vData[$custom_conditions ."sOrder"] =implode(I9078, range(1, count($rows))); $vData[$custom_conditions ."_list"] =$this->TIII1l1( $custom_conditions, array ($max_ => $max_, "amount" => "amount", I9081 => I9081) );$this->db =$db; }$vData["custom_fields"] =$this->TIIl1IT((array)$this->cms->VarsPost["custom_fields"], "checkbox_row", "checked", I9082); $vData["comments"] =mysql_real_escape_string($this->cms->VarsPost["comments"]); }else{ $vData[I9074] =$this->itemData[I9074]; $vData["amount"] =$this->itemData["amount"]; $custom_conditions =$this->itemData[I9075]; $vData[I9083] =$this->TIII1ll('type', 'option_row', $this->lIlLI1I, $this->itemData['type']); $vData['available_options'] =$this->TIII1ll(I9084, 'option_row', $this->_aValueStatuses, $this->itemData[I9084]); if($custom_conditions != 'none'){ $sql ="SELECT * " ."FROM `" .$this->module->GetTableName() .I9085 ."WHERE `id_parent` = '" .$this->id ."' " ."ORDER BY IFNULL(`max_" .$custom_conditions ."`, 1.7976931348623157E+308) ASC"; $this->db->query($sql); $vData[$custom_conditions .I9086] =implode(I9078, range(1, $this->db->num_rows())); $vData[$custom_conditions ."_list"] =$this->TIII1l1( $custom_conditions, array ("max_" .$custom_conditions => "max_" .$custom_conditions, "amount" => I9087, I9081 => I9081) );}$vData[I9082] =$this->itemData[I9082]; $vData["comments"] =$this->itemData["comments"]; $vData[I9076] =$this->TIIl1II($this->id); }$vData[I9075] =$custom_conditions; $vData["custom_conditions_" .$custom_conditions] =" checked"; $this->I1LLlIl =false; $this->I1LLlIL =false; $this->I1LLlII->TIl1I1I($this, $this->action, $vData, $this->itemData); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL( I9088, 'FROM ' .$this->module->GetTableName() .' m', "WHERE 1 " .$this->_ApplyFilters() .$this->TTTlIl1(), "m.id", I9065, I9089 );$aCustom["fields"] += array (I9074 => array ("action" => "stripline", "size" => 50), I9087 => array (I9090 => "stripline", "size" => 10), "delivery_time" => array (I9090 => "stripline", I9091 => 255), I9075 => array (I9090 => "stripline", I9091 => 10), "regions_count" => array (I9090 => "stripline", I9091 => 10), "action_edit" => array (I9090 => I9092, "value" => I9065, "id" => "edit_id", "on" => $this->moduleName .I9093, "off" => I9065 ),"action_copy" => array (I9090 => I9092, "value" => I9065, "id" => I9094, "on" => $this->moduleName ."_list:copy", "off" => I9065 ),"action_del" => array (I9090 => I9092, I9095 => I9065, "id" => "del_id", "on" => $this->moduleName ."_list:del", I9096 => I9065 ),"row" => array (I9090 => "callback", "object" => &$this, "method" => I9097) );$aCustom["legend"] =array ("leg_red", "leg_yellow", "leg_blue", I9098, "leg_copy", "leg_del"); $aCustom["form_data"]["buttons"] =array (I9099, I9056, "cancel", "save"); $aCustom["applied_id"] ="m.id"; $vData[I9100] =intval($this->id); parent::TTTlI11($vData, $aCustom); }function _ApplyFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); $res .= " AND m.id_parent = 0 AND m.hidden = 0"; return $res; }function TTT1IlI($aSql =array (),$cId =0) {$this->I1111l1 =false; $this->I1111Ll =array ();if ($this->I1111LL) {$aSql =$this->I1111LL; $aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }$name =trim($this->cms->VarsPost[I9074]); $amount =$this->cms->VarsPost[I9087]; $type =$this->cms->VarsPost[I9081]; $delivery_time =$this->cms->VarsPost["delivery_time"]; $custom_conditions =$this->cms->VarsPost[I9075]; $ids =$this->cms->VarsPost[$custom_conditions .I9086]; $custom_fields =$this->cms->VarsPost[I9082]; $regions =$this->cms->VarsPost[I9101]; $comments =mysql_real_escape_string(unhtmlentities($this->cms->VarsPost["comments"])); if ($custom_conditions != I9059) {$amount =$this->cms->VarsPost[I9087] =-1; }if (empty($name)) {$this->I1111l1 =true; $this->cms->AddStatusMsg("warn_missing_name", "red"); }if ($custom_conditions == I9059) {$this->I1111l1 =$this->TIII11T($amount, "warn_missing_amount", "warn_invalid_amount", "float") || $this->I1111l1; }else {$ids =explode(I9078, $ids); $this->I1111Ll =array ();foreach ($ids as $id) {$lIIIIlI =$custom_conditions .I9079 .$id; $max_ =$this->cms->VarsPost["max_" .$lIIIIlI]; if (is_float($max_)) {$this->I1111l1 =$this->TIII11T($max_, "warn_missing_max_range_limit", "warn_invalid_max_range_limit", I9102, false) || $this->I1111l1; }$amount_ =$this->cms->VarsPost["amount_" .$lIIIIlI]; if($custom_conditions != I9060){ $this->I1111l1 =$this->TIII11T($amount_, "warn_missing_amount", "warn_invalid_amount", I9102) || $this->I1111l1; }$type_ =$this->cms->VarsPost["type_" .$lIIIIlI]; $this->I1111Ll[] =array (I9103 .$custom_conditions => $max_, I9087 => $amount_, I9081 => $type_ );}}$custom_fields =(array)$custom_fields; $lIlLlll ="|" .implode("|", $custom_fields) ."|"; $custom_field_groups =array(); foreach($custom_fields as $lIlLllL){ if(isset($this->cms->VarsPost["custom_field_groups_".$lIlLllL])){ $custom_field_groups[$lIlLllL] =$this->cms->VarsPost["custom_field_groups_".$lIlLllL]; $lIlLlll =str_replace("|".$lIlLllL."|", "|".$this->cms->VarsPost["custom_field_groups_".$lIlLllL].I9104, $lIlLlll); }}$aSql =array ();if (!$this->I1111l1) {$this->lIlLlIl =array (I9074 => $name, I9087 => $amount, I9081 => $type, "delivery_time" => $delivery_time, I9075 => $custom_conditions, I9082 => $lIlLlll, "custom_field_groups" => serialize($custom_field_groups), "comments" => $comments );$aSql =$this->lIlLlIl +array ("id_parent" => 0 );}$I1L1lII =$this->I1LLlII->TIl1I1l($this->action, $this->cms->VarsPost, $aSql, $cId); $aSql =$I1L1lII[I9105]; if (is_array($this->lIlLlIl)) {$this->lIlLlIl["tax_class_type"] =$I1L1lII[I9105]['tax_class_type']; $this->lIlLlIl["id_tax_class"] =$I1L1lII[I9105]['id_tax_class']; }$aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function TTTll11($cId, $cModule) {parent::TTTll11($cId, $cModule); if ($this->id) {$this->appliedId =$this->id; }if (!$this->I1111l1) {$this->TIIl1T1(); $this->_success =true; $this->TIIl1Tl($this->db->lastInsertId()); }}function TTTl1lI($cId, $cModule) {parent::TTTl1lI($cId, $cModule); if (!$this->I1111l1) {$this->TIIl1Tl($this->id); $this->TIIl1T1(); $this->_success =true; }}function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $sql =I9106 ."FROM `" .$this->module->GetTableName() .I9085 ."m " ."WHERE m.id = '" .$cId ."'" .$this->_ApplyFilters(); $this->db->query($sql); if ($this->db->next_record()) {$this->itemData =$this->db->Record; $this->itemData[I9107] =$this->itemData[I9107]; unset($this->itemData[I9107]); if ($this->itemData[I9087] <0) {$this->itemData[I9087] =I9065; }$this->itemData["comments"] =$this->cms->htmlchars($this->itemData["comments"]); $this->itemData[I9082] =$this->TIIl1IT(explode(I9104, trim($this->itemData[I9082], '|')), "checkbox_row", I9108, I9082); }}function _ActionCopy($cId, $cModule) {parent::_ActionCopy($cId, $cModule); if ($this->errno) {return; }$parentId =$this->appliedId; $sql ="SELECT * " ."FROM `" .$this->module->GetTableName() .I9085 ."WHERE `id_parent` = '" .$cId ."'"; $this->db->query($sql); $children =array ();while ($this->db->next_record()) {$children[] =array (I9109 => $parentId, I9074 => $this->db->Record[I9074], I9087 => $this->db->Record[I9087], I9081 => $this->db->Record[I9081], I9107 => $this->db->Record[I9107], "max_weight" => $this->db->Record["max_weight"] );}foreach ($children as $child) {$this->I1111LL =$child; parent::TTTll11($parentId, $cModule); if ($this->errno) {return; }}$this->I1111LL =null; $this->appliedId =$parentId; $this->SetLastError(); $this->cms->AddStatusMsg("status_copy"); }function _ActionDel($cId, $cModule) {$sql ="DELETE FROM `" .$this->oEshop->dbTablePrefix ."_shipping_methods_regions` " ."WHERE id_method = '" .$cId ."'"; $this->db->query($sql); $sql ="DELETE FROM `" .$this->oEshop->dbTablePrefix ."_shipping_types_methods` " ."WHERE id_method = '" .$cId ."'"; $this->db->query($sql); $sql ="DELETE FROM `" .$this->module->GetTableName() .I9085 ."WHERE `id_parent` = '" .$cId ."'"; $this->db->query($sql); parent::_ActionDel($cId, $cModule); }function TIIl1Tl($cId) {$sql =I9110 .$this->oEshop->dbTablePrefix ."_shipping_types_methods` " ."WHERE id_method = '" .$cId ."'"; $this->db->query($sql); $lIlLll1 =isset($this->cms->VarsPost[I9076]) && is_array($this->cms->VarsPost[I9076]) ?array_map("intval", $this->cms->VarsPost[I9076]) :array ();foreach ($lIlLll1 as $shippingTypeId) {$sql =I9111 .$this->oEshop->dbTablePrefix ."_shipping_types_methods` " ."SET id_method = '" .$cId ."', id_type = " .$shippingTypeId; $this->db->query($sql); }}function TIIl1T1() {$sql =I9110 .$this->module->GetTableName() .I9085 ."WHERE `id_parent` = '" .$this->appliedId .I9112; $this->db->query($sql); $custom_conditions =$this->lIlLlIl[I9075]; foreach ($this->I1111Ll as $range) {if (!is_numeric($range[I9103 .$custom_conditions])) {unset($range[I9103 .$custom_conditions]); }$aSql =array_merge($this->lIlLlIl, $range); $aSql[I9109] =$this->appliedId; $aSql["lang"] =$this->langData; $sql =$this->db->GenInsertSQL( "`" .$this->module->GetTableName() .I9085, $aSql );$this->db->query($sql); }}function TIII1ll($fieldName, $setName, $aData, $selected =null, $lIIIIlL =false) {$options =''; foreach ($aData as $id => $name) {$aRowData =array ("id" => $id, I9074 => isset($this->words[$name]) ?$this->words[$name] :(isset($this->cms->Words[$name]) ?$this->cms->Words[$name] :$name), I9113 => $id === $selected ?" selected" :I9065 );$row =$this->cms->Gui->getAbs($this->moduleName ."_subform:" .$setName, $aRowData); if ($lIIIIlL) {$row =trim($row); }$options .= $row; }return $options; }function TIIIT1I($optionName, $I1LLLll, $aCustom, $callback =I9065) {$count =$this->module->GetOption($optionName); if ($count <0) {if (isset($I1LLLll["where"]) && !is_array($I1LLLll["where"])) {$I1LLLll[I9114] =(array)$I1LLLll[I9114]; }if (isset($I1LLLll["selectedCondition"])) {$I1LLLll[I9114][] =$I1LLLll["selectedCondition"]; }}elseif ($count >0) {$I1LLLll["limit"] =$count; }$sql ="SELECT " .$I1LLLll[I9115] .(isset($I1LLLll["selectedCondition"]) ?", " .$I1LLLll["selectedCondition"] ." AS `selected` " :I9065) .I9116 .$I1LLLll["from"] ." " .(isset($I1LLLll[I9114]) ?"WHERE " .(is_array($I1LLLll[I9114]) ?"(" .implode(I9117, $I1LLLll[I9114]) .")" :$I1LLLll[I9114]) :I9065 ).(isset($I1LLLll["order"]) ?" ORDER BY " .$I1LLLll["order"] :I9065) .(isset($I1LLLll[I9118]) ?" LIMIT " .$I1LLLll[I9118] :I9065) .(isset($I1LLLll["tail"]) ?" " .$I1LLLll["tail"] :I9065); $this->db->query($sql); $aList =array ();while ($this->db->next_record()) {if (method_exists($this, $callback)) {$this->$callback($this->db->Record); }$aList[] =$this->db->Record; }if ($count <0 && count($aList) >0) {$aCustom += $aList[0]; }return $this->TTT1lIT($aList, $count, $aCustom); }function TIII1lI($fieldName, &$aData, $lIIIIll, $operation =I9119, $default =null, $lIlLlLI =I9065) {if(!$lIlLlLI){ $lIlLlLI =$fieldName; }$IILLLL1 ="flt_" .preg_replace("/^\w+\./", I9065, $fieldName); $aSelect =array ();if (!is_null($default)) {$aSelect =$this->filter->TITI1TT($aSelect, Array($this->cms->Words["all"] => $default)); }foreach ($aData as $value => $word) {$aSelect =$this->filter->TITI1TT( $aSelect, array ((isset($this->words[$word]) ?$this->words[$word] :$this->cms->Words[$word])=> $value), $lIIIIll );}$this->filter->AddField( $IILLLL1, I9115, $this->_filter[$IILLLL1], I9065, $operation, $lIlLlLI, $aSelect );$this->filter->MoveField($IILLLL1, _MOVE_PREV); if (!is_null($default) && $this->_filter[$IILLLL1] == $default) {$this->filter->DisableFieldSQL($IILLLL1); }}function _rowCB(&$aItem, &$aData) {$fldGroupOptionsIds =unserialize($aItem["custom_field_groups"]); if(!is_array($fldGroupOptionsIds)){ $fldGroupOptionsIds =array(); }if($aItem[I9120] != I9060){ $aItem[I9087] =$aItem[I9087] >= 0 ?$aItem[I9087] .($aItem[I9081] == "abs" ?" " .$this->lIlLIL1 :I9058) :$this->words["combined"]; }else{ $aItem[I9069] ='---'; }$aItem[I9075] =$this->words[$aItem[I9075]]; if (mb_strlen($aItem[I9082]) >0) {$fieldsets =explode(I9104, mb_substr($aItem[I9082], 1, -1)); $custom_fields =I9065; foreach ($fieldsets as $fieldset) {if (in_array($fieldset, $this->lIlLI11)) {$custom_fields .= $this->aShippingFieldsHeaders[I9121 .$fieldset] ."<br />"; }elseif (in_array($fieldset, $fldGroupOptionsIds)) {$custom_fields .= $this->words[I9121 .array_search($fieldset, $fldGroupOptionsIds)] ."<br />"; }}$aItem[I9082] =$custom_fields; }}function TIII1l1($condition, $fieldsMap) {$i =1; $html =I9065; while ($this->db->next_record()) {$row =array ("num" => $i); foreach ($fieldsMap as $key => $lIIIIl1) {$row[$lIIIIl1] =mb_strpos($key, I9103) === false || !is_null($this->db->Record[$key]) ?$this->db->Record[$key] :$this->words["infinitely"]; }$row[I9122] =$this->TIII1ll(I9081, I9077, $this->lIlLI1I, $row[I9081]); $row['available_options'] =$this->TIII1ll(I9084, 'option_row', $this->_aValueStatuses, $row[I9084]); $html .= $this->cms->Gui->get($this->moduleName ."_subform:" .$condition ."_row", $row); $i++; }return $html; }function TIII11T(&$value, $lIIIILI, $lIIIILl, $type, $lIIIILL =true) {if (mb_strlen($value) <1) {if (!empty($lIIIILI)) {$this->cms->AddStatusMsg($lIIIILI, I9123); return true; }else {$value =0; return false; }}if (($type == "integer" ?!preg_match("/^\d+$/", $value) :!preg_match("/^\d+(\.\d+)?$/", $value) )|| ($lIIIILL ?$value <0 :$value <= 0) ){$this->cms->AddStatusMsg($lIIIILl, I9123); return true; }return false; }function TIIl1IT($Il11IL1 =array (),$setName =I9077, $selected =I9113, $fieldName =I9082) {$result =''; $fldGroupOptionsIds =isset($this->itemData['custom_field_groups']) ?unserialize($this->itemData['custom_field_groups']) :array(); if(!is_array($fldGroupOptionsIds)){ $fldGroupOptionsIds =array(); }foreach ($this->lIlLI11 as $id) {if(in_array($id, $Il11IL1) || array_key_exists($id, $fldGroupOptionsIds)){ $lIlLlLl =true; }else{ $lIlLlLl =false; }$result .= $this->cms->Gui->getAbs( $this->moduleName ."_subform:" .$setName, array ("id" => $id, I9074 => $this->aShippingFieldsHeaders[$this->lIlLI1L[I9104 .$id .I9104]], I9113 => $lIlLlLl ?" " .$selected :I9065, I9124 => $fieldName, "field_name_id" => $id ));if(array_key_exists(I9062.$id, $this->lIlLlII)){ $lIlLlLL =explode('|', $this->lIlLlII[I9062.$id]); $lIlLlL1 =true; foreach($lIlLlLL as $lIlLl1I){ preg_match("/\d+$/", $lIlLl1I, $matches); $result .= $this->cms->Gui->getAbs( $this->moduleName ."_subform:" .I9125, array ("parent_id" => $id, "id" => $matches[0], "radio_id" => $lIlLl1I, I9074 => $this->words[$lIlLl1I], I9108 => ((array_key_exists($id, $fldGroupOptionsIds) && $fldGroupOptionsIds[$id] == $matches[0]) || (!count($this->itemData) && $lIlLlL1) || (!$lIlLlLl && $lIlLlL1)) ?I9108 :I9065, "disabled" => (in_array($id, $Il11IL1) || array_key_exists($id, $fldGroupOptionsIds)) ?I9065 :I9126 ));if($lIlLlL1){ $lIlLlL1 =false; }}}}return $result; }function TIIl1II($id, $lIlLl1l =array ()){if ($id) {$sql ="SELECT t.id, t.name, t2m.id_method `selected` " ."FROM `" .$this->oEshop->dbTablePrefix ."_shipping_types` " ."t " .I9127 .$this->oEshop->dbTablePrefix ."_shipping_types_methods` " ."t2m ON t.id = t2m.id_type AND t2m.id_method = " .$id ." " ."WHERE t.hidden = 0 AND t.lang = '" .$this->langData .I9128 ."ORDER BY t.name ASC"; }else {$sql ="SELECT `id`, `name`, " .(count($lIlLl1l) ?"`id` IN (" .implode($lIlLl1l) .")" :0) .I9129. "FROM `" .$this->oEshop->dbTablePrefix ."_shipping_types` " ."WHERE `hidden` = 0 AND `lang` = '" .$this->langData .I9128 ."ORDER BY `name` ASC"; }$this->db->query($sql); $result =I9065; while ($this->db->next_record()) {$result .= $this->cms->Gui->getAbs( $this->moduleName ."_subform:checkbox_row", array ("id" => $this->db->Record["id"], I9074 => $this->db->Record[I9074], I9113 => $this->db->Record[I9113] ?" checked" :I9065, I9124 => I9076 ));}return $result; }function ruleAvailableShippingFields($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I ="getallvalues"){ $passedValue =$cData[I9060]; switch($IIL1l1I){ case I9130: static $words =null; static $lIlLl1L =null; if(is_null($words)){ $words =$this->cms->Gui->parseLangFile('templates/lang/options/eshop_shipping_methods_rules_values.lng'); }if(is_null($lIlLl1L)){ $lIlLl1L =array(); $lIlLl11 =array(); $fields =$this->db->getValue("SELECT `fields_shared` FROM `" .$this->oEshop->dbTablePrefix ."_datasets` WHERE lang = '".$this->langData."' LIMIT 1"); $lIlLl11 =explode(I9131, trim($fields, I9131)); if(sizeof($lIlLl11)){ $lIlLLII ="SELECT id, name, fnum FROM " .$this->oEshop->dbTablePrefix ."_custom_types WHERE public = 1 AND id IN (%s) AND type_owner = %s"; $this->db->query(DB_Query::getSnippet($lIlLLII)->implode($lIlLl11)->q('item')->get()); while($this->db->next_record()){ $aCaptions =unserialize($this->db->Record['name']); $lIlLl1L[] =I9132.$this->db->Record['fnum']; $words[I9132.$this->db->Record['fnum']] =$aCaptions[$this->langData]; }}$lIlLl1L[] ='rest'; $lIlLl1L[] ='weight'; $lIlLl1L[] =I9133; }$res =array(); $aFields =array(); foreach($lIlLl1L as $value){ $aFields[] =array( 'name' => $value, 'caption' => isset($words[$value]) ?$words[$value] .' ('.$value.')' :$value, I9134 => in_array($value, $passedValue) ?I9134 :'' );}if(sizeof($aFields)){ require_once $GLOBALS['FUNC_INCLUDES_PATH'] .'func_array.php'; sortMultiArray($aFields, 'caption'); $res += $aFields; }$aData[I9135] =true; break; case 'correctvalue': break; case 'getvalue': $res =$passedValue; break; }return true; }}?>
