<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       8546 xkqwrnpkxpsnrignixuisnpgxlpxuywwgllxillpltznqskuwkmxxulrngmlkywuxxlqpnir
 */ ?><?php foreach(array(9430=>"FUNw|mNwjUsqd|gzTo",9431=>"uDQrmS",9432=>"fMJQD",9433=>'ZJt',9434=>'MWHn',9435=>'nZIQ',9436=>'wjzddqd|gzTo',9437=>"SZtQfrHI",9438=>"fJt|nZIQ",9439=>"%LD|MtQID",9440=>"ZSS",9441=>"|uDQr|MtQID",9442=>"LHMnD",9443=>"coqRq?H`HCnQr|MS='",9444=>"",9445=>"|fMJQD",9446=>"vZJuQ",9447=>"Hff",9448=>"DMAQ",9449=>"IQtOHS",9450=>"HYLQWt",9451=>"ZGGJMQS|MS",9452=>"ftBGQ",9453=>"ftGPQtfMJQ`GOG IHSuJQ=QDOHG]MS=",9454=>"GrMWQ",9455=>"fMJQDMAQ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleEshopUserItemsPopup extends CMS_ActModule {public $userId; public $oEshop; public $lIlL1l1; public $IlIllII; public $fileType; public $lIlL1LI; function ModuleEshopUserItemsPopup(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); }function Init($IIll1l1 =Array(), $IIll1LI ='', $IIll1Ll ='', $aOptions =Array()) {require_once($GLOBALS[I9430]."func_gui.php"); if(isset($this->cms->VarsGet["userId"]) && $this->cms->VarsGet["userId"] != "") $this->userId =intval($this->cms->VarsGet[I9431]); else $this->userId =0; $IIIIL11['default_prefix'] ='i'; $IIIIL11["allowed_actions"] =Array("none"); $aOptions += $IIIIL11; parent::Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); $this->lIlL1l1 =&$this->cms->Core->GetModule(I9432); $this->IlIllII =Array(); $this->fileType =Array(); $this->lIlL1LI =Array(); $aIconData =Array(); $aIconData['path'] =$GLOBALS["ROOT_PATH_WWW"].$this->lIlL1l1->GetOption("icons_path"); $sql ="SELECT id, name, icon, extensions FROM cms_ftypes"; $this->db->query($sql); while ($this->db->next_record()) {$aIconData[I9433] ="__file__ [".$this->db->Record['name']."]"; $aIconData['icon'] =$this->db->Record[I9434]; $aExts =explode(';', mb_strtolower($this->db->Record['extensions'])); foreach($aExts as $key => $value) {if(!empty($value) || mb_strlen($this->db->Record['extensions'])==0) {$this->lIlL1LI[$this->db->Record['id']] =$this->db->Record[I9435]; $this->IlIllII[$this->db->Record['id']] =$this->cms->Gui->get($this->module->GetName()."_list:icon", $aIconData); $this->fileType['.'.$value] =$this->db->Record['id']; }}}require_once $GLOBALS[I9436] .'EshopAdmin.php'; $this->oEshop =new EshopAdmin($this->cms, $this->words); $this->oEshop->init($this->moduleName); $this->oEshop->TT1l11l($this->options["multi_sites"], $this->siteId); }function ProcessAction($IIIL11l, $cId, $cModule ='') {$id =intval($cId); switch ($IIIL11l) {default: parent::ProcessAction($IIIL11l, $cId, $cModule); break; }}function TTTlIII() {parent::TTTlIII(); if($this->filter->issetField("datefrom")) $this->filter->TITI1l1(I9437); if($this->filter->issetField("dateto")) $this->filter->TITI1l1("dateto"); $this->filter->AddField("flt_name", "text", stripslashes(unhtmlentities($this->cms->Vars[I9438])), "", " like ", "i.name"); $this->filter->MoveField(I9438,_MOVE_START); }function &TTTlI1T(&$aCustom) {$data =parent::TTTlI1T($aCustom); $data["js_functions"] =$this->cms->Gui->get($this->module->GetName().I9439, $data); $data["scripts"] =$this->cms->Gui->getScripts(); $data["metas"] =$this->cms->Gui->getMetas(); $data["filter"] =$this->filter->getFilterHtml(); global $conn; print $this->cms->Gui->get($this->module->GetName(), $data); $conn->Out(); die(); }function TTTlI1I(&$vData) {$vData["action"] =I9440; $vData["user_id"] =$this->userId; parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL("o.id, o.commission, o.commission_type, f.id as fileid, f.original_fname, i.public as public, i.name, i.price, f.ftype, f.filesize", Array("tables"=>Array("o" => $this->oEshop->dbTablePrefix.I9441, "i"=>$this->oEshop->dbTablePrefix."_items", "f"=>$this->oEshop->dbTablePrefix."_files"), I9442 =>Array("o|i"=>"o.item_id=i.id", "i|f"=>"f.id_product=i.id") ),I9443.$this->userId."' ".$this->_ApplyFilters().$this->TTTlIl1(), "", "name", "", I9444, _DB_STRAIGHT_JOIN );$this->browser->AddSQLJoinedTables($this->cms->Core, "o", Array("i"=>$this->oEshop->dbTablePrefix."_items", "f"=>$this->oEshop->dbTablePrefix.I9445)); $aCustom["fields"] =Array( "public" => Array("action"=>"flagicon", I9446=>1, "id"=>"pub_id", "on"=>$this->moduleName."_list:icon_public_on",I9447=>$this->moduleName."_list:icon_public_off"), "name"=>Array("action"=>"stripline", I9448=>50), "ftype"=>Array("action"=>"callback", "object"=>&$this, I9449=>"_CBFormatFileType"), "price"=>Array("action"=>"callback", I9450=>&$this, I9449=>"_CBFormatPrice"), "commission"=>Array("action"=>"callback", I9450=>&$this, I9449=>"_CBFormatCommission"), "filesize"=>Array("action"=>"callback", I9450=>&$this, I9449=>"_CBFormatFileSize"), );$aCustom[I9451] ="o.id"; $aCustom['legend'] =Array('published', 'notpublished'); parent::TTTlI11($vData, $aCustom); }function _CBFormatFileType(&$aItem, &$aData){ if(array_key_exists($aItem[I9452], $this->IlIllII)) $aItem[I9452] =$this->IlIllII[$aItem[I9452]]; else $aItem[I9452] =$this->IlIllII[1000]; $aItem[I9452] =str_replace("__file__", $aItem["original_fname"], $aItem[I9452]); $aItem["viewicon"] =I9453.$aItem["fileid"]; }function _CBFormatPrice(&$aItem, &$aData){ $aItem[I9454] =FormatNumber($aItem[I9454], $this->oEshop->numberDecimals, $this->oEshop->numberDecimals, true, true); $aItem["prefix"] =$this->oEshop->getCurrencyPrefix($this->oEshop->baseCurrency); $aItem["postfix"] =$this->oEshop->getCurrencyPostfix($this->oEshop->baseCurrency); }function _CBFormatCommission(&$aItem, &$aData){ $aItem["commission"] =FormatNumber($aItem["commission"], $this->oEshop->numberDecimals, $this->oEshop->numberDecimals, true, true); }function _CBFormatFileSize(&$aItem, &$aData){ $aItem[I9455] =getBytesAsText($aItem[I9455], $this->words, 1); }}?>