<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       37995 xkqwlrqqguzklkxqyxwuitkgpqrpriqwwgxmnusuyswuiixmplrrwrgzxlzkxizxtugypnir
 */ ?><?php foreach(array(9240=>"fMJQD|WZt",9241=>"funW|PuM`GOG",9242=>"uDQ|HGtMHnD|fHrI",9243=>"PQn|DuYJMnK",9244=>"GMWturQ|WZt",9245=>"|zGGJBwZtFMJtQrD",9246=>'',9247=>"?zNs?f`IHSuJQ='",9248=>"WSZtQ",9249=>"",9250=>"fJt|WZt|MS",9251=>"GuYJMW",9252=>"HGtMHnD",9253=>"tBGQ",9254=>'100:',9255=>"ft",9256=>"JMDt|SZtZ",9257=>'WID|fMJQD',9258=>'f_ft',9259=>"HrSQr|rQGJZWQ",9260=>'ZGGJMQS|MS',9261=>'WZJJYZWK',9262=>'ZWtMHn',9263=>'MS',9264=>'|JMDt%GuYJMW|Hff',9265=>"MS",9266=>"ZWtMHn|SQJ",9267=>"Hn",9268=>"fHrI|SZtZ",9269=>"DZvQ",9270=>"JQP|YJuQ",9271=>"#MIP?DrW=\"",9272=>"\"?YHrSQr=0?ZJt=\"",9273=>"vMQC|JMnK",9274=>"ftGPQtfMJQ`GOG IHSuJQ=fMJQD]MS=",9275=>"nZIQ",9276=>'ftBGQ',9277=>"ffMJQnZIQ",9278=>"ZnnHunWQ",9279=>'nZIQ',9280=>"|",9281=>"ihsUjq|gmwTURqd|gzTo",9282=>"ZGGJB",9283=>"fMJQnZIQ",9284=>"coqRq?MS='",9285=>'SMDZYJQ|QrrHr|IZMJ',9286=>"FRhi?WID|fMJQD?zd?f?coqRq?f`IHSuJQ='",9287=>"SQDWrMGtMHn",9288=>"MS|WZt",9289=>'YHSB|WZtD',9290=>'YHSB|urPQnt|WZtD',9291=>'Qxt|rDD',9292=>"'{?zd?SI!?",9293=>"'",9294=>'YHSB|urPQnt|MtQID',9295=>"SY",9296=>'ft',9297=>"ZWtMHn",9298=>"GZPQ|MtQI|tBGQ",9299=>"MWHnD",9300=>"WftnZIQ",9301=>"nuI|SHCnJHZSQS",9302=>"SQDW|nHtQIGtB",9303=>"MtQI|JMnK",9304=>"RhhT|gzTo|ccc",9305=>"SZtQ",9306=>"'{?zd?WSZtQ!?",9307=>'nuJJ',9308=>"?jmimT?",9309=>"||MS|WZt||",9310=>"nZIQ|fMQJS|nZIQ",9311=>"DuYJMnK",9312=>"DuYMtQI",9313=>"rHC",9314=>"MtQI|JMDt",9315=>"PQtZJJvZJuQD") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleFiles extends CMS_ActModule {public $lIlLL1L; public $IlIllI1; public $lIlLL11; public $I1LIIl1; public $I1LIILI; public $I1LIILl; public $I1LIILL; function ModuleFiles(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); $this->lIlLL1L =false; $this->lIlLL11 =false; $this->I1LIILI =Array(); require_once $GLOBALS['CLASSES_PATH'] .'CMS_CategoriesFunctions.php'; if($this->cms->Core->IsInstalled(I9240) && $this->module->IssetAndTrueOption("use_categories")) {$this->IlIllI1 =new CMS_CategoriesFunctions($this->cms, $this, I9240); }else {$this->IlIllI1 =new CMS_CategoriesFunctionsStub($this->cms, $this, I9240); }}function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {require_once($GLOBALS["FUNC_INCLUDES_PATH"].I9241); $this->lIlLL1L =$this->module->GetOption("show_download_counter"); $IIIIL11['default_prefix'] ='f'; $IIIIL11["use_id_page"] =true; $IIIIL11[I9242] =true; $IIIIL11["group_operations"] =Array("publish_on", "publish_off", "del", I9243, "gen_keywords", "index_details", "no_index_details", "move_position"); $IIIIL11[I9244] ="files"; $IIIIL11["use_positions"] =true; $IIIIL11['future_items_date_field'] ='cdate'; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); $this->IlIllI1->_Init(); $this->IlIllI1->TTIT1IT(I9245); }function TTTlTI1() {parent::TTTlTI1(); $this->I1LIIl1 =$this->module->GetOption("show_subitems"); $this->I1LIILl =$this->module->GetOption("subitems_splitter_period"); $this->I1LIILL =$this->module->GetOption("subitems_cols"); $this->cms->SetsTemplate =$this->moduleName."_list"; }function _ApplyCatFilters($prefix =I9246, $bodyType =I9246, $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function _ApplyFilters($prefix =I9246, $bodyType =I9246, $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); if(!$this->lIlLL11) {$res .= I9247.$this->moduleName."'"; }return $res; }function TTTlIII() {parent::TTTlIII(); $this->filter->UpdateFieldDBName("datefrom", "cdate"); $this->filter->UpdateFieldDBName("dateto", I9248); $this->filter->AddField("flt_fname", "text", isset($this->cms->Vars["flt_fname"]) ?stripslashes(unhtmlentities($this->cms->Vars["flt_fname"])) :null, I9249, " like ", "f.name"); $this->filter->MoveField("flt_fname",_MOVE_START); if($this->IlIllI1->TTTlIII("flt_cat_id")) {$this->filter->MoveField(I9250, _MOVE_START); }}function TTTlI1I(&$vData) {$vData["fcdate"] =date($this->cms->DFMT["php_dtime"]); $vData["fmdate"] =date($this->cms->DFMT["php_dtime"]); $vData[I9251] ="checked"; $vData["maxfile"] =getBytesAsText($this->cms->Core->GetOption("max_upload_size"), $this->words,1); $vData["options"] =I9246; $this->db->query("SELECT id, name FROM cms_ftypes ORDER BY id"); if($this->db->num_rows()) {while($this->db->next_record()) {$ext =I9249; if(isset($this->itemData["ftype"])) {if($this->itemData["ftype"] == $this->db->Record["id"]) {$ext ="selected"; }}$vData[I9252] .= $this->cms->Gui->getAbs($this->moduleName."_subform:options", Array("id"=>$this->db->Record["id"], "ext"=>$ext, I9253=>$this->db->Record["name"])); }}$vData["ftype_selectbox"] =$this->cms->Gui->get($this->moduleName."_subform:ftype", $vData); parent::TTTlI1I($vData); $vData['form_width'] =I9254; }function TTTlI1l() {$res =false; if(parent::TTTlI1l()) {$res =$this->IlIllI1->TTTlI1l(); }return $res; }function TTTlI11(&$vData, &$aCustom) {$IIlL1Ll =Array(); $IIlL1Ll["list_data"] =$aCustom["list_data"]; $IIlL1Ll['fields'] =Array(); $aCatSql =Array(); $aCatSql["join_to_alias"] =I9255; $this->IlIllI1->TTIT1lT("item_list", $aCatSql); if($this->lIlLL1L) {$IIlL1Ll["list_data"]["num_downloaded_header"] =$this->cms->Gui->get("files_list:num_downloaded_header", $IIlL1Ll[I9256]); }$this->browser->InitSQL("f.id, f.num_downloaded, f.public, f.name, f.announce, ". "DATE_FORMAT(f.cdate, '" .$this->cms->DFMT["db_dtime"] ."') AS cdate, ". "DATE_FORMAT(f.mdate, '" .$this->cms->DFMT["db_dtime"] ."') AS mdate, ". "f.filesize, ". "f.ftype, ". "ft.name as cftname, ". "ft.icon as cftpicon ".$aCatSql["select"], Array('tables'=>Array('f'=>I9257,'ft'=>'cms_ftypes') +$aCatSql['tables'], 'joins'=>Array(I9258=>'f.ftype=ft.id') +$aCatSql['joins']), "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), I9249, I9249, "f.cdate", $aCatSql[I9259] );$this->browser->AddSQLJoinedTables($this->cms->Core, 'f', $aCatSql['tables'] +Array('ft'=>'cms_ftypes')); $IIlL1Ll[I9260] ='f.id'; $IIlL1Ll['fields'] += Array( 'ftype'=>Array('action'=>I9261, 'object'=>&$this, 'method'=>'_ItemRowCB'), 'announce'=>Array(I9262=>'strip_tags'), 'public'=>Array(I9262=>'flagicon', 'value'=>1, I9263=>'pub_id', 'on'=>$this->moduleName.'_list:public_on','off'=>$this->moduleName.I9264), "action_edit"=>Array("action"=>"flagicon", "value"=>I9249, I9265=>"edit_id", "on"=>$this->moduleName."_list:edit","off"=>I9249), I9266=>Array("action"=>"flagicon", "value"=>I9249, I9265=>"del_id", I9267=>$this->moduleName."_list:del","off"=>I9249) );$aCustom += $IIlL1Ll; $aCustom[I9256] += $IIlL1Ll[I9256]; $aCustom["fields"] += $IIlL1Ll["fields"]; $aCustom[I9268]["buttons"] =Array("add", "apply", "cancel", I9269); $this->IlIllI1->TTTlI11($vData, $aCustom); parent::TTTlI11($vData, $aCustom); }function TTT11Tl(&$IILILII) {$IILILII[] ="published"; $IILILII[] ="notpublished"; $IILILII[] ="leg_red"; $IILILII[] ="leg_yellow"; $IILILII[] =I9270; $IILILII[] ="leg_edit"; $IILILII[] ="leg_del"; }function _ItemRowCB(&$aItem, &$aData) {$aItem["lid"] =$aItem[I9265]; $aItem["ficon"] =I9271.$GLOBALS["ROOT_PATH_WWW"].$this->module->GetOption("icons_path")."/small_".$aItem["cftpicon"].I9272.$aItem["cftname"]."\">"; $aItem["fsize"] =getBytesAsText($aItem["filesize"], $this->words, 1); $aItem[I9273] =I9274.$aItem[I9265]; if($this->lIlLL1L) {$aItem["num_downloaded_col"] =$this->cms->Gui->get($this->moduleName."_list:num_downloaded_col", $aItem); }}function TTT1IlI($aSql =Array(), $cId =0) {$this->cms->VarsPost['date'] =$this->cms->VarsPost['fcdate']; $name =$this->cms->VarsPost[I9275]; $lIlL1II =DateTools::getCorrectUDate($this->cms->VarsPost["fcdate"], $this->cms->DFMT["conf_dtime"]); $lIlL1Il =DateTools::getCorrectUDate($this->cms->VarsPost["fmdate"], $this->cms->DFMT["conf_dtime"]); $ftype =$this->cms->VarsPost[I9276]; if(empty($ftype)) {$ftype ='0'; }if(!empty($name) && (!empty($GLOBALS["_FILES"]["ffilename"][I9275]) && filesize($GLOBALS["_FILES"][I9277]["tmp_name"]) || $this->action == "apply")) {$aSql =Array( "ftype"=>$ftype, I9275=>$name, I9248=>DateTools::toMysqlDate($lIlL1II), "mdate"=>DateTools::toMysqlDate($lIlL1Il), I9278=>$this->cms->VarsPost[I9278], "description"=>$this->cms->VarsPost["description"], I9251=>intval($this->cms->VarsPost[I9251]) );}$this->IlIllI1->TTT1IlI($aSql, $cId); $aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function TIIl1ll() {if(!empty($GLOBALS["_FILES"]['ffilename'][I9279])) {AMI_Registry::push('disable_error_mail', true); $fsize =@filesize($GLOBALS["_FILES"][I9277]["tmp_name"]); $newfilename ='files_'.$this->appliedId.I9280.$GLOBALS["_FILES"][I9277][I9275].$this->module->GetOption("extension"); $newfilename =$this->cms->TTITI11(stripslashes($newfilename)); if($this->cms->doUploadFile($GLOBALS["_FILES"][I9277], $GLOBALS[I9281].$this->module->GetOption("files_path").$newfilename)) {if($this->action == I9282) {$sql ="select filename from cms_files where id='".$this->cms->Vars[I9265]."'"; $this->db->query($sql); if($this->db->next_record()) {$lIlL1IL =$this->db->Record["filename"]; }if(!empty($lIlL1IL) && $lIlL1IL!=$newfilename) {$this->cms->TTITlTT($lIlL1IL, $GLOBALS[I9281].$this->module->GetOption("files_path")); }}$aSql =Array( I9283=>addslashes($newfilename), "filesize"=>$fsize, "original_fname"=>$_FILES['ffilename'][I9279] );$sql =$this->db->GenUpdateSQL("cms_files", $aSql, I9284.$this->appliedId."'"); $this->db->query($sql); }else {unset($this->cms->Vars['publish']); $this->module->PushPager($this->browser); $this->_ActionPublish($this->appliedId, I9246); $this->module->PopPager($this->browser); $this->cms->ClearMessages(); $this->cms->AddStatusMsg("status_error", "red"); }AMI_Registry::pop(I9285); }}function TTTll11($cId, $cModule) {parent::TTTll11($cId, $cModule); if(empty($this->errno) && $this->appliedId >0) {$this->TIIl1ll(); $this->IlIllI1->TTTll11($cId, $cModule); }}function TTTl1lI($cId, $cModule) {parent::TTTl1lI($cId, $cModule); if(empty($this->errno)) {$this->TIIl1ll(); $this->IlIllI1->TTTl1lI($cId, $cModule); }}function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $sql ="SELECT f.*, IF(f.public > 0, 'checked', '') AS public, ". "DATE_FORMAT(f.cdate, '".$this->cms->DFMT["db_dtime"]."') AS fcdate, ". "DATE_FORMAT(NOW(), '".$this->cms->DFMT["db_dtime"]."') as fmdate ". I9286.$this->moduleName."' AND f.id='".$cId."'".$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; $this->itemData[I9278] =$this->cms->htmlchars($this->itemData[I9278]); $this->itemData[I9287] =$this->cms->htmlchars($this->itemData[I9287]); }$this->itemData["num_downloaded"] =$this->cms->Gui->getAbs($this->moduleName."_subform:num_downloaded", $this->itemData); }function _ActionDel($cId, $cModule) {$sql ="SELECT public, id_cat, filename FROM cms_files WHERE id='".$cId."'"; $this->db->query($sql); if($this->db->next_record()){ $fname =$this->db->Record[I9283]; $this->IlIllI1->TTIT1ll($cId, $cModule, $this->db->Record[I9251], $this->db->Record[I9288]); parent::_ActionDel($cId, $cModule); $this->IlIllI1->_ActionDel($cId, $cModule); if(!empty($fname)) {$this->cms->TTITlTT($fname, $GLOBALS[I9281].$this->module->GetOption("files_path")); }}}function _ActionPublish($cId, $cModule) {$this->IlIllI1->TTIT1ll($cId, $cModule); parent::_ActionPublish($cId, $cModule); $this->IlIllI1->_ActionPublish($cId, $cModule); }function TTT1Tl1($cType, $cModule, $condition =I9246) {$res =$this->IlIllI1->TTT1Tl1($cType, $cModule); if(!$res) {parent::TTT1Tl1($cType, $cModule); }}function TTTllTI(&$aCustom) {$cat =$this->IlIllI1->TTTllTI($aCustom); if($cat != -1) {if($this->id >0) {$this->SetBodyType("body_itemD"); }else {if($cat === 0) {$this->SetBodyType('body_urgent_cats'); $this->SetBodyType("body_cats"); $this->bodyType =I9289; }else {if($this->id != -1) {$this->SetBodyType("body_items"); $this->SetBodyType('body_urgent_items'); }else {$this->SetBodyType("body_itemD"); }}}}parent::TTTllTI($aCustom); }function TTTlllT(&$vData) {parent::TTTlllT($vData); }function TTTll1T(&$vData, &$aCustom) {$aDefault =Array(); foreach($this->IIllIL1 as $IIlL1L1 => $tmp) {$this->lIlLL11 =false; $IIlL1Ll =$this->TTITTT1($aCustom, $IIlL1L1, false); switch($IIlL1L1) {case "body_cats": case I9290: $IIlL1Ll["page_item_type"] =$IIlL1L1; $IIlL1Ll['show_urgent_elements'] =$this->cms->Core->getModOption('files_cat', 'show_urgent_elements'); if (isset($this->ext[I9291])) {$I1LII11 =$this->ext[I9291]->IL1LI11; $this->ext[I9291]->IL1LI11 =false; }$this->IlIllI1->TTTll1T($vData, $IIlL1Ll); break; case "body_itemD": $aDefault["page_item_type"] ="body_itemD"; $IIlL1Ll += $aDefault; $aCatSql =Array(); $this->IlIllI1->TTIT1lT("item_details", $aCatSql); $sql ="SELECT f.*, DATE_FORMAT(f.cdate, '" .$this->cms->DFMT["db_dtime"] ."') AS dc, ". "DATE_FORMAT(f.mdate, '" .$this->cms->DFMT["db_dtime"] .I9292. "f.sm_data, f.details_noindex, filesize, ft.name as cftname, ft.icon as cftpicon ". "FROM cms_files AS f ". "LEFT JOIN cms_ftypes AS ft on ft.id=f.ftype ". "WHERE f.id='".$this->id.I9293.$aCatSql["where"].$this->_ApplyFilters(); $this->lIlLL11 =true; if(!$this->IlIllI1->TTTll1T($vData, $IIlL1Ll)) {$IIlL1Ll["page_item_type"] ="body_empty"; }$this->db->query($sql); $vData[I9265] =$this->id; break; case "body_items": case I9294: $aDefault["page_item_type"] =$IIlL1L1; $IIlL1Ll += $aDefault; $this->TTTllll($vData, $IIlL1Ll); $aCatSql =Array(); $this->IlIllI1->TTIT1lT("item_list", $aCatSql); $this->browser->InitSQL("f.id, f.num_downloaded, f.name, f.announce, f.sublink, ". "(LENGTH(f.description) > 0) AS desc_notempty, ". "f.name as f_name, f.cdate as c_date, f.mdate as m_date, f.description, ". "DATE_FORMAT(f.cdate, '".$this->cms->DFMT["db"]."') AS cdate, ". "DATE_FORMAT(f.mdate, '".$this->cms->DFMT[I9295]."') AS mdate, ". "f.filesize, ft.name AS cftname, ". "ft.icon AS cftpicon ".$aCatSql["select"], "FROM cms_files AS f LEFT JOIN cms_ftypes AS ft ON ft.id=f.ftype ".$aCatSql["join"], "WHERE 1 ".$aCatSql["where"].$this->_ApplyFilters(I9246, $IIlL1L1 == I9294 ?$IIlL1L1 :I9246).$this->TTTlIl1(), I9249, $this->browser->TI1TTlT() );$this->browser->AddSQLJoinedTables($this->cms->Core, 'f', Array(I9296=>'cms_ftypes') +$aCatSql["tables"]); $IIlL1Ll["fields"]["detials"] =Array(I9297=>"callback", "object"=>&$this, "method"=>"_GetItemCB"); $this->lIlLL11 =true; if(!$this->IlIllI1->TTTll1T($vData, $IIlL1Ll)) {$IIlL1Ll[I9298] ="body_empty"; }break; }$this->lIlLL11 =false; parent::TTTll1T($vData, $IIlL1Ll); if (isset($I1LII11)) {$this->ext[I9291]->IL1LI11 =$I1LII11; unset($I1LII11); }}}function _GetItemCB(&$aItem, &$aData) {$this->TIITIll($aItem, $aData); }function TIITIll(&$aItem, &$aData, $setPrefix =I9249) {$icon =$aItem["cftpicon"]; if(empty($icon)) {$icon ="other.gif"; }$aItem["linktag"] =I9274.$aItem[I9265]; $aItem[I9299] =$GLOBALS["ROOT_PATH_WWW"].$this->module->GetOption("icons_path")."small_".$icon; $aItem["alt"] =$aItem[I9300]; if($this->lIlLL1L) {$aItem["num_downloaded"] =$this->cms->Gui->getAbs($this->moduleName."_list:".$setPrefix."num_downloaded", Array("num_downloaded"=>$aItem[I9301])); }$aItem["date"] =$aItem["mdate"]; $aItem["size"] =getBytesAsText($aItem["filesize"], $this->words, 1); if($aItem[I9302]) {$aItem["more_link"] =$this->cms->Gui->get($this->moduleName."_list:".$setPrefix."more_link",$aItem); }}function TTT1lTl($IIl1II1, &$record, &$vData, &$aData) {parent::TTT1lTl($IIl1II1, $record, $vData, $aData); switch($IIl1II1) {case "body_itemD": $vData[I9303] =$this->cms->Gui->get($this->moduleName."_list:itemD_item_link", $vData); $this->IlIllI1->TTT1lTl($IIl1II1, $record, $vData, $aData); $icon =$record["cftpicon"]; if(empty($icon)) {$icon ="other.gif"; }$vData["offset"] =$this->offset; $vData[I9299] =$GLOBALS[I9304].$this->module->GetOption("icons_path").$icon; $vData["linktag"] =I9274.$record[I9265]; $vData["alt"] =$record[I9300]; $vData[I9278] =$this->cms->Gui->MYnl2br($record[I9278]); $vData[I9287] =$this->cms->Gui->MYnl2br($vData[I9287]); if($this->lIlLL1L) {$vData[I9301] =$this->cms->Gui->getAbs($this->moduleName."_list:num_downloaded", Array(I9301=>$record[I9301])); }$vData[I9305] =$record["mdate"]; $vData["size"] =getBytesAsText($record["filesize"], $this->words, 1); break; }}function TIITIl1(&$IIL1lLI, $IIl1II1 =I9246) {$this->lIlLL11 =false; $II11L1L =" f.urgent DESC, f.".$this->module->GetOption("front_subitem_sort_col")." ".$this->module->GetOption("front_subitem_sort_dim"); $fields ="SELECT f.sublink, f.num_downloaded, (LENGTH(f.description) > 0) AS desc_notempty, ". "DATE_FORMAT(f.cdate, '".$this->cms->DFMT[I9295].I9306. "DATE_FORMAT(f.mdate, '".$this->cms->DFMT[I9295]."') AS mdate, f.filesize, f.id, f.id_cat, f.name, f.announce, f.description, f.urgent, ". "ft.icon AS cftpicon"; foreach($this->options["item_pictures"] as $fieldName) {if(!empty($fieldName) && $fieldName != I9307 && $fieldName != -222222){ $fields .= ", f.ext_".$fieldName; }}$fields .= " FROM cms_files AS f LEFT JOIN cms_ftypes AS ft ON ft.id=f.ftype WHERE "; $this->_forceHideFutureItems =true; if($this->I1LIIl1 >0) {$sql =$fields."f.id_cat='__id_cat__'".$this->_ApplyFilters(I9246, $IIl1II1, false)." ORDER BY ".$II11L1L.I9308.$this->I1LIIl1; }else {$sql =$fields."f.id_cat IN('".implode("','", $IIL1lLI)."')".$this->_ApplyFilters()." ORDER BY f.id_cat ASC, ".$II11L1L; }unset($this->_forceHideFutureItems); $this->I1LIILI =$this->IlIllI1->TTIITTI($sql, $IIL1lLI, I9309); $this->lIlLL11 =true; }function _DrawSubItemsCB(&$aItem, &$aData) {$I1LIlIl =$this->I1LIILI[$aItem[I9265]]; $aItem["item_list"] =I9249; if(is_array($I1LIlIl)) {$k =0; $numRows =sizeof($I1LIlIl); $vData["simple_prefix"] ="subitem_"; $I1LIlIL =$this->options["name_field_name"]; $this->options[I9310] =I9275; foreach($I1LIlIl as $index=>$aSubItem) {$k++; $aTmp["active_item_type"] ="body_items"; $aTmp["cat_id"] =$aItem[I9265]; $aTmp["cat_sublink"] =$aItem[I9311]; $this->_GetNavDataCB($aSubItem, $aTmp); $aSubItem += $this->IIllllL; $IIlLIIL =Array(I9297=>"_GetPicturesCB", "data"=> $_data =array(&$aSubItem, &$vData)); $this->TTT1lI1($IIlLIIL, array('ext_images')); $aSubItem[I9275] =$this->cms->TTITI1l("subitem", I9275, $aSubItem); $aSubItem[I9278] =$this->cms->TTITI1l(I9312, I9278, $aSubItem); $IIlLIIL =Array(I9297=>"add_subitem_data", I9265=>I9249, "item_data"=>&$aSubItem); $this->TTT1lI1($IIlLIIL); $this->TIITIll($aSubItem, $aData, "subitem_"); $aItem["item_list"] .= $this->cms->TTITI1l(I9312, I9313, $aSubItem); if($k >0 && $k != $numRows) {if((($k %$this->I1LIILL) == 0)) {$aItem["item_list"] .= $this->cms->TTITI1l(I9312, "Vsplitter", $aItem); }elseif($k >1) {$aItem["item_list"] .= $this->cms->TTITI1l(I9312, "Hsplitter", $aItem); }if($this->I1LIILl && $k%$this->I1LIILl == 0 ){$aItem[I9314] .= $this->cms->TTITI1l(I9312, "nSplitter", I9249); }}}$this->options[I9310] =$I1LIlIL; $aItem[I9314] =$this->cms->TTITI1l(I9312, "list", $aItem); }}function TTTlIT1(&$aCustom, $cType ="small", $IIlLI11 =I9249, $IIlLlII ="_small") {$this->IlIllI1->TTTlITl($aCustom, $cType, $IIlLI11, $IIlLlII, true); $html =parent::TTTlIT1($aCustom, $cType, $IIlLI11, $IIlLlII); $this->IlIllI1->TTTlITl($aCustom, $cType, $IIlLI11, $IIlLlII, false); return $html; }function TTT11IT($IILILIL) {$navData =parent::TTT11IT($IILILIL); $navData += $this->IlIllI1->TTT11IT($IILILIL); return $navData; }function correctStopArgNames($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I =I9315){ return $this->IlIllI1->correctStopArgNames($cData, $IIL1lL1, $res, $aData, $IIL1l1I); }function TTT1II1(&$db, &$aParams) {$aVars =parent::TTT1II1($db, $aParams) +$this->IlIllI1->TTT1II1($db, $aParams); return $aVars; }}