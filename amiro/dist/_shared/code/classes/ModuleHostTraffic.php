<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       29179 xkqwrxwxtntnritmkskunpwwxuklxrxqrrptpxpittgsizxipsgqrwumzmxrnwunwrigpnir
 */ ?><?php foreach(array(10279=>'zSIiHSuJQ`GOG',10280=>"",10281=>"PrHuG|HGQrZtMHnD",10282=>"fJt|DQZrWO",10283=>"SZtQ|frHI",10284=>"u`uDQrnZIQ",10285=>'=_ftG|tHtZJ',10286=>'u',10287=>'ZWtMHn',10288=>"ZGGJMQS|MS",10289=>"|vMQC",10290=>"OttG|tHtZJ",10291=>'unJMIMtQS',10292=>'tHtZJ',10293=>'trZf|EuHtZ',10294=>'B|I',10295=>'ftG|Mn',10296=>"OttG|I|Mn",10297=>'IZMJ|Hut',10298=>"ftG|I|Hut",10299=>'vZJuQ',10300=>'ftG|I|Hut',10301=>'ftG|Hut',10302=>'tHtZJ|Hut',10303=>'JZDt|uGSZtQ',10304=>"funW|PuM`GOG",10305=>"|DIZJJ",10306=>"SZtQ|tH",10307=>'oDtRQD`GOG',10308=>'uDQrnZIQ',10309=>'IZMJ|tHtZJ',10310=>'D',10311=>"fMQJSD",10312=>"D`MS",10313=>"SHIZMn",10314=>"trZf|EuHtZ",10315=>'uSZtQfrHI',10316=>'ftG|I|Mn',10317=>'SHIZMn',10318=>'IHntO|nuI|',10319=>'OttG|Hut',10320=>"ftG|I|Mn",10321=>'tHtZJ|I|Hut',10322=>'IZMJ|Mn',10323=>'SQtZMJD|JMDt') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} require_once $GLOBALS['CLASSES_PATH'] .I10279; if($GLOBALS["BUILDER_VERSION"] <2){ class ModuleHostTraffic extends AdmModule {public $userData; function ModuleHostTraffic(&$cms, &$db, &$cModule) {parent::AdmModule($cms,$db,$cModule); }function _Init($IIll1l1 =Array(), $IIll1LI =I10280, $IIll1Ll =I10280, $aOptions =Array()) {require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_gui.php"); $this->userData =array(); $IIIIL11["allowed_actions"] =Array("view"); $IIIIL11[I10281] =Array(); $IIIIL11["lang_data"] =false; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {parent::_InitAdmin(); }function TTTlITT($IIIL11l, $cId, $cModule =I10280) {parent::TTTlITT($IIIL11l, $cId, $cModule); }function GetHtml(&$aCustom) {return parent::GetHtml($aCustom); }function TTTlIT1(&$aCustom, $cType ="small", $IIlLI11 =I10280, $IIlLlII ="_small") {return parent::TTTlIT1($aCustom, $cType, $IIlLI11, $IIlLlII); }function TTlTll1() {parent::TTlTll1(); }function TTTlIII() {parent::TTTlIII(); if($this->TTTTIIl()) {$search =stripslashes(unhtmlentities($this->cms->Vars["flt_search"])); $this->filter->AddField(I10282, "text", $search, I10280, "=", "u.username"); $this->filter->TITI1II(I10282," OR u.domain LIKE '%".addslashes(TlT1III($search)) ."%' OR u.username LIKE '%".addslashes($search)."%'"); $this->filter->MoveField(I10282, _MOVE_START); }$this->filter->UpdateFieldDBName("dateto", "date_to"); $this->filter->UpdateFieldDBName("datefrom", I10283); }function _ApplyFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function &TTTlI1T(&$aCustom) {return parent::TTTlI1T($aCustom); }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {if($this->TTTTIIl()) {$sql =" u.id, u.username, u.domain,u.traf_quota AS traf_quota, ". "SUM(t.traf_ftp_in)+SUM(t.traf_ftp_out) AS ftp_total, ". "SUM(t.traf_http_in)+SUM(t.traf_http_out) AS http_total, ". "SUM(t.traf_mail_in)+SUM(t.traf_mail_out) AS mail_total, ". "SUM(t.traf_ftp_in)+SUM(t.traf_ftp_out)+ ". "SUM(t.traf_http_in)+SUM(t.traf_http_out)+ ". "SUM(t.traf_mail_in)+SUM(t.traf_mail_out) AS total "; $from ="FROM cms_host_users u ". "LEFT JOIN cms_host_traffic t ". "ON u.id = t.id_user "; $this->browser->InitSQL($sql,$from, "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), "u.id",I10284,"username asc", array('http_total'=>'=|http_total', 'ftp_total'=>I10285, 'mail_total'=>'=|mail_total', 'total'=>'=|total' ));$this->browser->AddSQLJoinedTables($this->cms->Core,I10286,array('cms_host_traffic'=>'t')); $aCustom["fields"] += Array( 'username'=>array(I10287=>'callback','object'=>&$this,'method'=>'CBRow') );$aCustom[I10288] ="u.id"; parent::TTTlI11($vData, $aCustom); }else {$vData["subform"] =$this->cms->Gui->get($this->moduleName."_subform", $vData); $vData["form_header"] =$this->words[$this->moduleName.I10289]; }}function CBRow(&$aItem,&$aData) {$aItem["domain"] =$this->cms->stripLine($aItem["domain"], 30); $aItem["ftp_total"] =getBytesAsText($aItem["ftp_total"], $this->words, 2, 2); $aItem[I10290] =getBytesAsText($aItem[I10290], $this->words, 2, 2); $aItem["mail_total"] =getBytesAsText($aItem["mail_total"], $this->words, 2, 2); $aItem["traf_quota"] =getBytesAsText($aItem["traf_quota"], $this->words, 2, 2,$this->words[I10291]); $act =array('view_id'=>$aItem['id']); $aItem['actions'] =$this->cms->Gui->get("srv_host_trafic_list:icon_view", $act); $aItem[I10292] =getBytesAsText($aItem[I10292],$this->words,2,2); }function TTTll1l($cId, $cModule) {parent::TTTll1l($cId, $cModule); $lILLLLl =intval($this->cms->Vars['udatefrom']); $lILLLLL =intval($this->cms->Vars['udateto']); $cId =intval($cId); $db =&DB_si::admInstance(); if(!$this->TTTTIIl()) {$domain =$this->TTTTIlT(); $sql ="SELECT id, username, domain_orig AS domain,traf_quota ". "FROM cms_host_users WHERE domain_orig='$domain'"; $db->query($sql); $db->next_record(); $cId =$db->Record['id']; if($this->cms->Core->TTlllTI()) {$lILLLLL =time(); $lILLLLl =$lILLLLL -86400; }}else {$sql ="SELECT username, domain_orig AS domain,traf_quota ". "FROM cms_host_users WHERE id='$cId'"; $db->query($sql); $db->next_record(); }$this->itemData['username'] =$db->Record['username']; $this->itemData['domain'] =$db->Record['domain']; $quota =$db->Record[I10293]; $this->itemData['quota'] =getBytesAsText($db->Record["traf_quota"], $this->words, 2, 2,$this->words[I10291]); $sql ="SELECT  ". "DATE_FORMAT(t.date_from,'%Y%m') AS y_m,". "SUM(t.traf_ftp_in) AS ftp_m_in, SUM(t.traf_ftp_out) AS ftp_m_out,". "SUM(t.traf_http_in) AS http_m_in, SUM(t.traf_http_out) AS http_m_out,". "SUM(t.traf_mail_in) AS mail_m_in, SUM(t.traf_mail_out) AS mail_m_out,". "SUM(t.traf_ftp_in)+SUM(t.traf_ftp_out) AS ftp_m_total, ". "SUM(t.traf_http_in)+SUM(t.traf_http_out) AS http_m_total, ". "SUM(t.traf_mail_in)+SUM(t.traf_mail_out) AS mail_m_total ". "FROM cms_host_users u LEFT JOIN cms_host_traffic t ON u.id = t.id_user ". "WHERE u.id=$cId AND t.date_from>=FROM_UNIXTIME($lILLLLl) AND t.date_to<=FROM_UNIXTIME($lILLLLL) ". "GROUP BY y_m ORDER BY y_m"; $db->query($sql); $gui =&$this->cms->Gui; $rows =''; $i =0; $ftp_in =$ftp_out =$http_in =$http_out =$mail_in =$mail_out =$total_in =$total_out =0; while($db->next_record()) {$year =mb_substr($db->Record['y_m'],0,4); $month =mb_substr($db->Record[I10294],4); $item['month'] =$this->words['month_num_'.intval($month)]." $year"; $item['style'] =sprintf("row%d",((++$i)%2)+1); $item[I10295] =getBytesAsText($db->Record["ftp_m_in"], $this->words, 2, 2); $item['ftp_out'] =getBytesAsText($db->Record["ftp_m_out"], $this->words, 2, 2); $item['http_in'] =getBytesAsText($db->Record[I10296], $this->words, 2, 2); $item['http_out'] =getBytesAsText($db->Record["http_m_out"], $this->words, 2, 2); $item['mail_in'] =getBytesAsText($db->Record["mail_m_in"], $this->words, 2, 2); $item[I10297] =getBytesAsText($db->Record["mail_m_out"], $this->words, 2, 2); $lILLLL1 =floatval($db->Record["ftp_m_in"])+floatval($db->Record[I10296])+floatval($db->Record["mail_m_in"]); $item['total_m_in'] =getBytesAsText($lILLLL1,$this->words, 2, 2); $lILLL1I =floatval($db->Record[I10298])+floatval($db->Record["http_m_out"])+floatval($db->Record["mail_m_out"]); $item['total_m_out'] =getBytesAsText($lILLL1I,$this->words, 2, 2); $lILLL1l =$lILLL1I+$lILLLL1; if($lILLL1l<=$quota) $item['total_m'] =getBytesAsText($lILLL1l,$this->words, 2, 2); else {$tmp =array(I10299=>getBytesAsText($lILLL1l,$this->words, 2, 2)); $item['total_m'] =$gui->get("srv_host_trafic_subform:over_limit",$tmp); }$rows .= $gui->get("srv_host_trafic_subform:traf_details_row",$item); $ftp_in += $db->Record['ftp_m_in']; $ftp_out += $db->Record[I10300]; $http_in += $db->Record['http_m_in']; $http_out += $db->Record['http_m_out']; $mail_in += $db->Record['mail_m_in']; $mail_out += $db->Record['mail_m_out']; }$total_in =$ftp_in+$http_in+$mail_in; $total_out =$ftp_out+$http_out+$mail_out; $total =$total_in+$total_out; $this->itemData[I10292] =getBytesAsText($total,$this->words,2,2); $aTotal =array( I10295=>getBytesAsText($ftp_in,$this->words,2,2),I10301=>getBytesAsText($ftp_out,$this->words,2,2), 'http_in'=>getBytesAsText($http_in,$this->words,2,2),'http_out'=>getBytesAsText($http_out,$this->words,2,2), 'mail_in'=>getBytesAsText($mail_in,$this->words,2,2),I10297=>getBytesAsText($mail_out,$this->words,2,2), 'total_in'=>getBytesAsText($total_in,$this->words,2,2),I10302=>getBytesAsText($total_out,$this->words,2,2), I10292=>getBytesAsText($total,$this->words,2,2) );$aRows =array('details_list'=>$rows,'traf_totals'=>$gui->get("srv_host_trafic_subform:traf_totals",$aTotal)); $this->itemData['traf_details'] =$gui->get("srv_host_trafic_subform:traf_details",$aRows); if(CMS_ModulesOptions::TTlTllT($db,$IIIIl11, '', 'last_traffic_gain')) $this->itemData['last_update'] =date($this->cms->DFMT["php_dtime"], $IIIIl11[I10299]); else $this->itemData[I10303] =$this->words['unknown']; }function TIlTTTl($userId,$from,$to) {$sql ="SELECT ". "SUM(traf_mail_in)+SUM(traf_mail_out)+". "SUM(traf_http_in)+SUM(traf_http_out)+". "SUM(traf_ftp_in)+SUM(traf_ftp_out) AS traffic,id_user ". "FROM cms_host_traffic ". "WHERE id_user=$userId AND date_from>=FROM_UNIXTIME($from) AND date_to<FROM_UNIXTIME($to) ". "GROUP BY id_user"; $db =&DB_si::admInstance(); $db->query($sql); $db->next_record(); return $db->Record['traffic']; }}}else{ class ModuleHostTraffic extends AdmModule {public $userData; function ModuleHostTraffic(&$cms, &$db, &$cModule) {parent::AdmModule($cms,$db,$cModule); }function _Init($IIll1l1 =Array(), $IIll1LI =I10280, $IIll1Ll =I10280, $aOptions =Array()) {require_once($GLOBALS["FUNC_INCLUDES_PATH"].I10304); $this->userData =array(); $IIIIL11["allowed_actions"] =Array("view"); $IIIIL11[I10281] =Array(); $IIIIL11["lang_data"] =false; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {parent::_InitAdmin(); }function TTTlITT($IIIL11l, $cId, $cModule =I10280) {parent::TTTlITT($IIIL11l, $cId, $cModule); }function GetHtml(&$aCustom) {return parent::GetHtml($aCustom); }function TTTlIT1(&$aCustom, $cType ="small", $IIlLI11 =I10280, $IIlLlII =I10305) {return parent::TTTlIT1($aCustom, $cType, $IIlLI11, $IIlLlII); }function TTlTll1() {parent::TTlTll1(); }function TTTlIII() {parent::TTTlIII(); if($this->TTTTIIl()) {$search =stripslashes(unhtmlentities($this->cms->Vars[I10282])); $this->filter->AddField(I10282, "text", $search, I10280, "=", "m.username"); $this->filter->MoveField(I10282, _MOVE_START); }$this->filter->UpdateFieldDBName("dateto", I10306); $this->filter->UpdateFieldDBName("datefrom", I10283); }function _ApplyFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function &TTTlI1T(&$aCustom) {return parent::TTTlI1T($aCustom); }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {if($this->TTTTIIl()) {require_once $GLOBALS['CLASSES_PATH'] .I10307; $lILLL1L =new HstResFactory($this->db, $this->cms->core); $res =$lILLL1L->TITl1TI('trafic', $this->langData); if(!is_object($res)) trigger_error('Trafic resource is absent for lang='.$this->langData, E_USER_ERROR); $sql =" s.id, m.username, sr.bound as traf_quota, ". "SUM(t.traf_ftp_in)+SUM(t.traf_ftp_out) AS ftp_total, ". "SUM(t.traf_http_in)+SUM(t.traf_http_out) AS http_total, ". "SUM(t.traf_mail_in)+SUM(t.traf_mail_out) AS mail_total, ". "SUM(t.traf_ftp_in)+SUM(t.traf_ftp_out)+ ". "SUM(t.traf_http_in)+SUM(t.traf_http_out)+ ". "SUM(t.traf_mail_in)+SUM(t.traf_mail_out) AS total "; $from ="FROM cms_hst_clients c ". "INNER JOIN cms_hst_subscription s ON s.id_member = c.id_member ". "INNER JOIN cms_hst_subscription_res sr ON s.id = sr.id_subscription AND id_res=".$res->TITlllI()." ". "INNER JOIN cms_members m ON m.id = c.id_member ". "INNER JOIN cms_host_traffic t ON t.id_subscription = s.id "; $this->browser->InitSQL($sql,$from, "WHERE t.id_vhost=0 ".$this->_ApplyFilters().$this->TTTlIl1(), "s.id","m.username","username asc", array(I10308=>'m.username', 'http_total'=>'=|http_total', 'ftp_total'=>I10285, I10309=>'=|mail_total', I10292=>'=|total' ));$this->browser->AddSQLJoinedTables($this->cms->Core,'c',array('cms_hst_subscription'=>I10310, 'cms_members'=>'m', 'cms_host_traffic'=>'t')); $aCustom[I10311] += Array( I10308=>array(I10287=>'callback','object'=>&$this,'method'=>'CBRow') );$aCustom[I10288] =I10312; parent::TTTlI11($vData, $aCustom); }else {$vData["subform"] =$this->cms->Gui->get($this->moduleName."_subform", $vData); $vData["form_header"] =$this->words[$this->moduleName.I10289]; }}function CBRow(&$aItem,&$aData) {$aItem["domain"] =$this->cms->stripLine($aItem[I10313], 30); $aItem["ftp_total"] =getBytesAsText($aItem["ftp_total"], $this->words, 2, 2); $aItem[I10290] =getBytesAsText($aItem[I10290], $this->words, 2, 2); $aItem["mail_total"] =getBytesAsText($aItem["mail_total"], $this->words, 2, 2); $aItem[I10314] =getBytesAsText($aItem[I10314], $this->words, 2, 2,$this->words[I10291]); $act =array('view_id'=>$aItem['id']); $aItem['actions'] =$this->cms->Gui->get("srv_host_trafic_list:icon_view", $act); $aItem[I10292] =getBytesAsText($aItem[I10292],$this->words,2,2); }function TTTll1l($cId, $cModule) {parent::TTTll1l($cId, $cModule); $lILLLLl =intval($this->cms->Vars[I10315]); $lILLLLL =intval($this->cms->Vars['udateto']); $cId =intval($cId); $db =&DB_si::admInstance(); $lILLL11 =$this->module->GetProperty("traf_id_res"); if(!$this->TTTTIIl()) {$domain =$this->TTTTIlT(); $sql ="SELECT v.id_subscription as id, bound as traf_quota ". "FROM cms_hst_res_vhost_inst v ". "INNER JOIN cms_hst_subscription_res sr ON sr.id_subscription=v.id_subscription ". "WHERE v.domain='$domain'"; $db->query($sql); $db->next_record(); $cId =$db->Record['id']; if($this->cms->Core->TTlllTI()) {$lILLLLL =time(); $lILLLLl =$lILLLLL -86400; }}else {$sql ="SELECT bound as traf_quota FROM cms_hst_subscription_res WHERE id_subscription = '$cId' AND id_res=$lILLL11"; $db->query($sql); $db->next_record(); }$quota =$db->Record[I10293]; $this->itemData['quota'] =getBytesAsText($db->Record[I10314], $this->words, 2, 2,$this->words[I10291]); $sql ="SELECT  v.domain, ". "DATE_FORMAT(t.date_from,'%Y%m') AS y_m,". "SUM(t.traf_ftp_in) AS ftp_m_in, SUM(t.traf_ftp_out) AS ftp_m_out,". "SUM(t.traf_http_in) AS http_m_in, SUM(t.traf_http_out) AS http_m_out,". "SUM(t.traf_mail_in) AS mail_m_in, SUM(t.traf_mail_out) AS mail_m_out,". "SUM(t.traf_ftp_in)+SUM(t.traf_ftp_out) AS ftp_m_total, ". "SUM(t.traf_http_in)+SUM(t.traf_http_out) AS http_m_total, ". "SUM(t.traf_mail_in)+SUM(t.traf_mail_out) AS mail_m_total ". "FROM cms_hst_res_vhost_inst v ". "INNER JOIN cms_host_traffic t ON t.id_vhost = v.id ". "WHERE v.id_subscription=$cId AND t.date_from>=FROM_UNIXTIME($lILLLLl) AND t.date_to<=FROM_UNIXTIME($lILLLLL) ".(!$this->TTTTIIl()? "AND v.domain='$domain'": I10280). "GROUP BY v.domain, y_m ORDER BY v.id, y_m"; $db->query($sql); $gui =&$this->cms->Gui; $III1LLI =array(); $domain =''; $lILL1II =array(I10316, I10300, 'http_m_in', 'http_m_out', 'mail_m_in', 'mail_m_out'); while($db->next_record()) {if($domain <> $db->Record[I10317]) {$i =0; $domain =$db->Record[I10317]; $III1LLI[$domain] =array('total_in' => 0, I10302 => 0, I10292 => 0, 'rows' => ''); foreach($lILL1II as $type) {$III1LLI[$domain][$type] =0; }}$year =mb_substr($db->Record[I10294],0,4); $month =mb_substr($db->Record[I10294],4); $item['month'] =$this->words[I10318.intval($month)]." $year"; $item['style'] =sprintf("row%d",((++$i)%2)+1); $item[I10295] =getBytesAsText($db->Record["ftp_m_in"], $this->words, 2, 2); $item[I10301] =getBytesAsText($db->Record[I10298], $this->words, 2, 2); $item['http_in'] =getBytesAsText($db->Record[I10296], $this->words, 2, 2); $item[I10319] =getBytesAsText($db->Record["http_m_out"], $this->words, 2, 2); $item['mail_in'] =getBytesAsText($db->Record["mail_m_in"], $this->words, 2, 2); $item[I10297] =getBytesAsText($db->Record["mail_m_out"], $this->words, 2, 2); $lILLLL1 =$db->Record[I10320]+$db->Record[I10296]+$db->Record["mail_m_in"]; $item['total_m_in'] =getBytesAsText($lILLLL1,$this->words, 2, 2); $lILLL1I =$db->Record[I10298]+$db->Record["http_m_out"]+$db->Record["mail_m_out"]; $item[I10321] =getBytesAsText($lILLL1I,$this->words, 2, 2); $lILLL1l =$lILLL1I+$lILLLL1; if($lILLL1l<=$quota) $item['total_m'] =getBytesAsText($lILLL1l,$this->words, 2, 2); else {$tmp =array(I10299=>getBytesAsText($lILLL1l,$this->words, 2, 2)); $item['total_m'] =$gui->get("srv_host_trafic_subform:over_limit",$tmp); }$III1LLI[$domain]['rows'] .= $gui->get("srv_host_trafic_subform:traf_details_row",$item); $lILL1Il =0; foreach($lILL1II as $type) {$III1LLI[$domain][$type] += $db->Record[$type]; if($lILL1Il++ %2) {$III1LLI[$domain]['total_in'] += $db->Record[$type]; }else {$III1LLI[$domain][I10302] += $db->Record[$type]; }$III1LLI[$domain][I10292] += $db->Record[$type]; }}foreach($III1LLI as $domain => $lILL1IL) {$this->itemData[I10292] += $lILL1IL[I10292]; $aTotal =array( I10295=>getBytesAsText($lILL1IL[I10316],$this->words,2,2), I10301=>getBytesAsText($lILL1IL[I10300],$this->words,2,2), 'http_in'=>getBytesAsText($lILL1IL['http_m_in'],$this->words,2,2), I10319=>getBytesAsText($lILL1IL['http_m_out'],$this->words,2,2), I10322=>getBytesAsText($lILL1IL['mail_m_in'],$this->words,2,2), I10297=>getBytesAsText($lILL1IL['mail_m_out'],$this->words,2,2), 'total_in'=>getBytesAsText($lILL1IL['total_in'],$this->words,2,2), I10302=>getBytesAsText($lILL1IL[I10302],$this->words,2,2), I10292=>getBytesAsText($lILL1IL[I10292],$this->words,2,2) );$aRows =array(I10323=>$lILL1IL['rows'], I10317 => $domain, 'traf_totals'=>$gui->get("srv_host_trafic_subform:traf_totals",$aTotal)); $this->itemData['traf_details'] .= $gui->get("srv_host_trafic_subform:traf_details",$aRows); }$this->itemData[I10292] =getBytesAsText($this->itemData[I10292],$this->words,2,2); if(CMS_ModulesOptions::TTlTllT($db,$IIIIl11, '', 'last_traffic_gain')) $this->itemData[I10303] =date($this->cms->DFMT["php_dtime"], $IIIIl11[I10299]); else $this->itemData[I10303] =$this->words['unknown']; }function TIlTTTl($userId,$from,$to) {trigger_error('Method must be corrected', E_USER_ERROR); $sql ="SELECT ". "SUM(traf_mail_in)+SUM(traf_mail_out)+". "SUM(traf_http_in)+SUM(traf_http_out)+". "SUM(traf_ftp_in)+SUM(traf_ftp_out) AS traffic,id_user ". "FROM cms_host_traffic ". "WHERE id_user=$userId AND date_from>=FROM_UNIXTIME($from) AND date_to<FROM_UNIXTIME($to) ". "GROUP BY id_user"; $db =&DB_si::admInstance(); $db->query($sql); $db->next_record(); return $db->Record['traffic']; }}}?>