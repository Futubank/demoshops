<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       7283 xkqwrlqwrprpplklwyriyginrwpnkrksximltugymlwswrzstpuqxsstmgtnlznkqgxspnir
 */ ?><?php foreach(array(10535=>"JZnP|SZtZ",10536=>'wjzddqd|gzTo',10537=>'rQDHurWQD|rHCD',10538=>"DuYDWrMGtMHnD|MnfH",10539=>'WJMQntD',10540=>'r`MS|rQDQJJQr',10541=>'rQD',10542=>'rQDQJJQr|fMQJS',10543=>'MS') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleHstCommonInfo extends ModuleHst {function ModuleHstCommonInfo(&$cms, &$db, &$cModule) {parent::ModuleHst($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ='', $IIll1Ll ='', $aOptions =Array()) {$IIIIL11[I10535] =false; $IIIIL11["filter_client_table"] ='c'; if($this->TTTTII1()) {$IIIIL11["reseller_field"] ="c.id_reseller"; }$aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); require_once $GLOBALS[I10536] .'CMS_Member.php'; require_once $GLOBALS[I10536] .'Client.php'; }function _InitAdmin() {parent::_InitAdmin(); }function TTTlI1I(&$vData) {$vars =array( 'IS_ADMIN' => intval($this->TTTTIIl()), 'IS_USER' => intval($this->TTTTlTI()), );$this->cms->Gui->addGlobalVars($vars); $lIL1LlI =$this->TIlTIIl($this->TIlTITl()); $lIL1Lll =$this->TIlTIIl($this->TIlTIT1()); $lIL1LlL =$this->TIlTIIl($this->TIlTIIT()); $lIL1Ll1[I10537] =''; if (count($lIL1LlL)) {foreach ($lIL1LlL as $aRes) {$lIL1Ll1[I10537] .= $this->cms->Gui->get($this->moduleName."_subform:resource_row", $aRes); }}$vData["clients_info"] =$this->cms->Gui->get($this->moduleName."_subform:clients_info", $lIL1LlI); $vData[I10538] =$this->cms->Gui->get($this->moduleName."_subform:subscriptions_info", $lIL1Lll); $vData["resources_info"] =$this->cms->Gui->get($this->moduleName."_subform:resources_info", $lIL1Ll1); parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL("1 as qwe", "from cms_hst_clients", " WHERE 1 "); parent::TTTlI11($vData, $aCustom); }function TIlTITl() {$sql ="select sum(if(c.is_reseller & c.is_active, 1, 0)) as active_resellers, sum(c.is_reseller) as resellers, sum(c.is_active) as active_clients, count(id) as clients from cms_hst_clients c where 1 ".$this->_ApplyFilters(); $res =$this->db->select($sql); $aRes =$res->nextRecord(); $aRes['active_clients'] -= $aRes['active_resellers']; $aRes[I10539] -= $aRes['resellers']; return $aRes; }function TIlTIT1() {$aRes =Array ('active_subscriptions' => 0, 'subscriptions' => 0); $sql ="select s.active_state from cms_hst_subscription s left join cms_hst_clients c on c.id_member=s.id_member where 1 ".$this->_ApplyFilters(); $res =$this->db->select($sql); $aRes =$res->nextRecord(); return $aRes; }function TIlTIIT() {$aRes =$this->TIlTIII(); if(count($aRes)) {$lIL1LLI =$this->options['filter_client_table']; $lIL1LLl =$this->options['reseller_field']; $this->options['filter_client_table'] ='r'; $this->options['reseller_field'] =I10540; $sql ="select id_res, sum(r.active_state = 'active') as active, count(*) as res from cms_hst_res_inst r where 1 ".$this->_ApplyFilters()." group by r.id_res "; $res =$this->db->select($sql); while ($aRow =$res->nextRecord()) {$aRes[$aRow['id_res']]['cnt'] =$aRow[I10541]; $aRes[$aRow['id_res']]['active_cnt'] =$aRow['active']; }$this->options['filter_client_table'] =$lIL1LLI; $this->options[I10542] =$lIL1LLl; }return $aRes; }function TIlTIII() {$aRes =Array ();$sql ="select id, name from cms_hst_res where 1"; $res =$this->db->select($sql); while ($aRow =$res->nextRecord()) {$aRes[$aRow['id']]['name'] =$aRow['name']; $aRes[$aRow[I10543]]['cnt'] =0; $aRes[$aRow[I10543]]['active_cnt'] =0; }return $aRes; }function TIlTIIl($lIL1LLL) {if(is_array($lIL1LLL) && count($lIL1LLL)) {$keys =array_keys($lIL1LLL); foreach ($keys as $key) {if(is_array($lIL1LLL[$key])) {$lIL1LLL[$key] =$this->TIlTIIl($lIL1LLL[$key]); }else {if((string)intval($lIL1LLL[$key]) == (string)$lIL1LLL[$key]) {$lIL1LLL[$key] =FormatNumber($lIL1LLL[$key], 0, 0); }}}}return $lIL1LLL; }}?>