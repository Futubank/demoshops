<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       8310 xkqwnngimkgngnlnmytrzmtqzzzzwkrsuqppggwrnxwnnsinnumzmzwkmwkptuwqstlgpnir
 */ ?><?php foreach(array(10651=>"SQfZuJt|GrQfMx",10652=>"dqwURmTb%?ZttQIGt?tH?HGQn?IHSuJQ?YB?nHn+ZSIMn!?SHIZMn=",10653=>'MS',10654=>'WID|ODt|GKP|rQD',10655=>"r`MS=G`MS|rQD",10656=>'jqFT',10657=>"MS?SQDW",10658=>"DMAQ",10659=>"ZWtMHn",10660=>"",10661=>"Hff",10662=>"SQJ|MS",10663=>"WZJJYZWK",10664=>'G',10665=>"JQP|YJuQ",10666=>"ZSS",10667=>"FRhi?",10668=>"'?",10669=>"Hn+Hff",10670=>'WID|ODt|rQD|SQG',10671=>"DuYtBGQ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleHstRes extends ModuleHst {function ModuleHstRes(&$cms, &$db, &$cModule) {parent::ModuleHst($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11 =array(); $IIIIL11[I10651] ="r"; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {if($this->TTTTlTI() || $this->TTTTII1()) {trigger_error("Access violation.", E_USER_ERROR); }parent::_InitAdmin(); }function &TTTlI1I(&$aData) {if ($this->TTTTlTI()){ trigger_error(I10652.$this->TTTTIlT(),E_USER_WARNING); die(); }if($this->itemData['id']) {$sql ="SELECT id_res_master FROM cms_hst_res_dep WHERE id_res_slave='".$this->itemData[I10653]."'"; $this->db->query($sql); if ($this->db->num_rows()) {while ($this->db->next_record()) {$aRes[] =$this->db->Record['id_res_master']; }$aData["added_dep_resources"] =implode(';', $aRes); }}parent::TTTlI1I($aData); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL("r.id, r.name, r.unit, r.type, r.subtype, r.is_deleteable, count(distinct p.id_res) as pkg_res, count(distinct d.id_res_slave) as slave_res ", Array( 'tables'=>Array('r' => 'cms_hst_res', 'p'=>I10654, 'd'=>'cms_hst_res_dep'), 'joins'=>Array("r|p"=>I10655, "p|d"=>"r.id=d.id_res_master"), 'joins_types'=>Array('r|p'=>I10656, 'p|d'=>I10656) ),"WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), "r.id", "name", I10657 );$aCustom["fields"] += Array( "name"=>Array("action"=>"stripline", I10658=>120), "unit"=>Array("action"=>"stripline", I10658=>10), "type"=>Array(I10659=>"stripline", I10658=>64), "action_edit"=>Array(I10659=>"flagicon", "value"=>I10660, "id"=>"edit_id", "on"=>$this->moduleName."_list:edit",I10661=>I10660), "is_deleteable"=>Array(I10659=>"flagicon", "value"=>1, "id"=>I10662, "on"=>$this->moduleName."_list:del",I10661=>$this->moduleName."_list:icon_none"), "format_row_data"=>Array(I10659=>I10663, "object"=>&$this, "method"=>'_FormatRowData'), );$this->browser->AddSQLJoinedTables($this->cms->Core, 'r', array(I10664=>I10654)); $aCustom["applied_id"] ="id"; $aCustom["legend"] =Array("leg_yellow", I10665, "leg_edit", "leg_del"); $aCustom["form_data"]["buttons"] =Array(I10666, "apply", "cancel", "save"); parent::TTTlI11($vData, $aCustom); }function TTTll11($cId, $cModule) {parent::TTTll11($cId, $cModule); $lIL11II =$this->TIlTIll(); $this->TIlTI1T($this->db->lastInsertId(), $lIL11II); }function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $sql ="SELECT * ". I10667 .$this->module->GetTableName() ." " .mb_substr($this->options[I10651], 0, 1) ." ". "WHERE " .$this->options[I10651] ."id='".$cId.I10668.$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; $this->itemData["res_included"] =($this->itemData["res_included"] == 1) ?"checked": I10660; }}function TTTl1lI($cId, $cModule) {parent::TTTl1lI($cId, $cModule); if ($cId) {$this->TIlTIl1($cId); $lIL11II =$this->TIlTIll(); $this->TIlTI1T($cId, $lIL11II); }}function _ActionDel($cId, $cModule) {$sql ="SELECT count(*) as cnt FROM cms_hst_pkg_res WHERE id_res = '$cId'"; if($this->db->getValue($sql) >0) {$this->SetLastError(3, "Deleting failed"); $this->cms->AddStatusMsg("status_del_fail_package_exists", "red"); }else {parent::_ActionDel($cId, $cModule); $this->TIlTIl1($cId); }}function TTT1IlI($aSql =Array(), $cId =0) {$name =mb_substr($this->cms->VarsPost["name"], 0, 255); $unit =mb_substr($this->cms->VarsPost["unit"], 0, 32); $lIL11Il =Array ("normal", I10669); $subtype =$this->cms->VarsPost["subtype"]; if (!in_array($subtype, $lIL11Il)) {$subtype =$lIL11Il[0]; }if(($name != I10660)) {$aSql =Array( "name"=>$name, "unit"=>$unit, "subtype" => $subtype );}$aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function TIlTIll($lIL11II =Array()) {$lIL11IL =$this->cms->VarsPost["added_dep_resources"]; if($lIL11IL != '') {$lIL11II =explode(';', $lIL11IL); }return $lIL11II; }function TIlTIl1($cId) {$sql="DELETE FROM cms_hst_res_dep WHERE id_res_slave='$cId'"; $this->db->query($sql); }function TIlTI1T($cId, $lIL11II) {if($cId && is_array($lIL11II) && count($lIL11II)) {$aRows =Array(); foreach ($lIL11II as $lIL11I1) {$aRows[] =Array ("id_res_master"=>$lIL11I1, "id_res_slave"=>$cId );}if (count($aRows)) {foreach ($aRows as $aRow) {$sql =$this->db->GenInsertSQL(I10670, $aRow); $this->db->query($sql); }}}}function _FormatRowData(&$vItem, &$vData) {$vItem["pkg_res"] =FormatNumber($vItem["pkg_res"], 0, 0); $vItem["slave_res"] =FormatNumber($vItem["slave_res"], 0, 0); $vItem[I10671] =$this->words[$vItem[I10671]]; }}?>