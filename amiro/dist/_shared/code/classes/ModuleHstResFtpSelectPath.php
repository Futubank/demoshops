<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       8187 xkqwpmsxpwplqxmyukmzgygnzmyngkiuyxizytxmkwxknqunwsxkxigwyiqzlrtyysylpnir
 */ ?><?php foreach(array(10862=>"ZJJHCQS|ZWtMHnD",10863=>"SQDt|fMQJS|MS",10864=>"OMSSQn",10865=>"MS|rQD|MnDt",10866=>'MS',10867=>"OHIQSMr",10868=>"ZWtMHn",10869=>"Hn",10870=>"YrHCDQr|GHDMtMHn",10871=>'',10872=>"'?",10873=>'HD|uDQr',10874=>'PQt',10875=>"rQS",10876=>"WZnnHt|PQt|IHSuJQ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleHstResFtpSelectPath extends ModuleHst {function ModuleHstResFtpSelectPath(&$cms, &$db, &$cModule) {parent::ModuleHst($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11 =array(); $IIIIL11[I10862] =array ("select"); $IIIIL11["lang_data"] =false; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {parent::_InitAdmin(); }function TTTlIII() {parent::TTTlIII(); $this->filter->AddField("dest_field_id", "hidden", stripslashes(unhtmlentities($this->cms->Vars[I10863]))); $this->filter->AddField("id_vhost", "hidden", stripslashes(unhtmlentities($this->cms->Vars["id_vhost"]))); $this->filter->AddField("id_res_inst", I10864, stripslashes(unhtmlentities($this->cms->Vars["id_res_inst"]))); $this->filter->AddField("current_path", I10864, stripslashes(unhtmlentities($this->cms->Vars["current_path"]))); }function &TTTlI1I(&$aData) {$aData['dest_field_id'] =$this->filter->GetFieldValue(I10863); parent::TTTlI1I($aData); }function TTTlI11(&$vData, &$aCustom) {$lI1ILLl =intval($this->filter->GetFieldValue(I10865)); $IIlIIL1 =intval($this->filter->GetFieldValue("id_vhost")); $lI1IL1I =$this->filter->GetFieldValue('dest_field_id'); $aPaths =$this->TIlTl11($IIlIIL1); if (count($aPaths)) {foreach ($aPaths as $aPath) {if ($aPath['homedir'] == $this->filter->GetFieldValue('current_path')) {$this->appliedId =$aPath[I10866]; }}}$aCustom["legend"] =Array("leg_blue", "select"); $aCustom["fields"] =Array(I10867 => Array("action"=>"stripline", "size"=>255), "action_select" => array (I10868 => "flagicon", "value" => 1, "id"=>"sel_id", I10869 => $this->moduleName ."_list:select_icon", "off" => $this->moduleName ."_list:select_icon" ));require_once $GLOBALS['CLASSES_PATH'] .'CMS_IteratorArray.php'; $IILIIL1 =$this->db; $this->db =new CMS_IteratorArray($this->module); $this->db->SetArray($aPaths); $aCustom += Array( "legend" => "", "applied_id" => -1, "last_edited_id" => -1, I10870 => 0, "browser_page_size" => sizeof($aPaths), );$this->browser->InitSQL(I10867, "FROM cms_hst_res_ftp_inst ", "WHERE 1"); parent::TTTlI11($vData, $aCustom); $this->db =$IILIIL1; }function _ApplyFilters($prefix ='', $bodyType =I10871, $IIlLLl1 =true) {$res =""; $res .= parent::_ApplyFilters($prefix =I10871, $bodyType =I10871, $IIlLLl1 =true); $res .= " AND m.lang='".$this->langData."' AND s.lang='".$this->langData."' AND t.lang='".$this->langData.I10872; return $res; }function TIlTl11($lI1ILl1) {$aRes =Array(); if($lI1ILl1) {$mModule =$this->cms->Core->GetModule('hst_res_ftp_inst'); if(is_object($mModule)) {$mModule->InitEngine($this->cms, $this->db); $mModule->Engine->Init(); $lI1Illl =$mModule->Engine->TIlITIl($lI1ILl1, 'vhost'); if(is_array($lI1Illl) && count($lI1Illl)) {$lI1IL1l =$mModule->Engine->TIlT1Il($lI1Illl['id_subscription']); if(is_array($lI1IL1l)) {$aArgs =Array('old_os_user'=>$lI1IL1l[I10873], 'domain'=>$lI1Illl['domain'], 'path'=>'/'); $res =$mModule->Engine->TIlT1I1(false); $res->TITllll($lI1IL1l[I10866]); $batch =$res->TITll1I(I10874, $aArgs, $lI1ILLl); if($batch !== false) {if($batch[0]->TITllT1() == 0 && is_array($batch[0]->TITllII()) && count($batch[0]->TITllII())) {$id =1; foreach($batch[0]->TITllII() as $homedir) {if($homedir != '.' && $homedir != '..') {$aRes[] =Array(I10866 => $id, 'homedir' => "/$homedir/"); $id++; }}}else {$this->cms->AddStatusMsg("get_dir_list_fail", I10875, $this->words['returned_code'].$batch[0]->TITllT1().". "); $this->SetLastError(201, "Wrong hosting response"); $res =false; }}else {$this->cms->AddStatusMsg("get_dir_list_fail", I10875, $this->words['wrong_hosting_response']); $this->SetLastError(201, "Wrong hosting response"); $res =false; }}else {$this->cms->AddStatusMsg("cannot_build_command_arguments", I10875, $this->words['status_get_subsrc_data_fail']); }}else {$this->cms->AddStatusMsg("cannot_build_command_arguments", I10875, $this->words['status_get_inst_fail']); }}else {$this->cms->AddStatusMsg(I10876, I10875); }}else {$this->cms->AddStatusMsg("cannot_build_command_arguments", I10875, $this->words['status_wrong_vhost_id']); }return $aRes; }}?>