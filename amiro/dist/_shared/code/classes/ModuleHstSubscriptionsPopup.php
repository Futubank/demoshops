<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       6349 xkqwxxlltrwqmqmiglyqswppwgzxkrwspnkpiqpwzytqrpszwiusziigqmmlnlxkingtpnir
 */ ?><?php foreach(array(11211=>"SQfZuJt|GrQfMx",11212=>"MS|tZrMff",11213=>"OMSSQn",11214=>"MS|DuYD",11215=>"DG`MS|DuYDWrMGtMHn",11216=>"fJt|nZIQ",11217=>'',11218=>'tG',11219=>"G`MS=tG`MS|GKP",11220=>'jqFT',11221=>"",11222=>"DMAQ",11223=>"IQtOHS",11224=>"ZGGJMQS|MS",11225=>"YuttHnD",11226=>"DQtuG|fQQ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleHstSubscriptionsPopup extends ModuleHst {function ModuleHstSubscriptionsPopup(&$cms, &$db, &$cModule) {parent::ModuleHst($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11 =array(); $IIIIL11[I11211] ="t"; $aOptions += $IIIIL11; $this->module->SetTableName('cms_hst_tariff'); parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function TTTlIII() {parent::TTTlIII(); if(isset($this->cms->VarsGet["id_tariff"])) {$lI1LllI =explode(":", $this->cms->VarsGet[I11212]); $lI1lL11 =intval($lI1LllI[0]); $lI1Llll =stripslashes(unhtmlentities($this->cms->VarsGet["added_pkgs"])); }else {$lI1lL11 =stripslashes(unhtmlentities($this->cms->Vars["flt_id_tariff"])); $lI1Llll =stripslashes(unhtmlentities($this->cms->Vars["flt_packages_bank"])); }$this->filter->AddField("flt_id_tariff", I11213, $lI1lL11, "", "=", "t.id"); $this->filter->AddField("flt_packages_bank", I11213, $lI1Llll); if(isset($this->cms->VarsGet[I11212])) {$lI1I11l =intval($this->cms->VarsGet[I11214]); }else {$lI1I11l =intval(stripslashes(unhtmlentities($this->cms->Vars["flt_id_subscription"]))); }if($lI1I11l) {$this->filter->AddField("flt_id_subscription", I11213, $lI1I11l, "", "=", I11215); }$this->filter->AddField("flt_id_tariff", I11213, $lI1lL11, "", "=", "t.id"); $this->filter->AddField(I11216, "text", stripslashes(unhtmlentities($this->cms->Vars[I11216])), "", " like ", "p.name"); }function &TTTlI1I(&$aData) {if(isset($this->cms->VarsGet[I11212])) {$aData['get_packages_bank_from_parent'] ="GetPackagesBankFromParent();"; }$lI1LllL =Array(); $aData['fill_pkg_rows'] =""; if($this->filter->GetFieldValue("flt_packages_bank") != I11217) {$aData['fill_pkg_rows'] ="FillRowsFromPackagesBank()"; }parent::TTTlI1I($aData); }function TTTlI11(&$vData, &$aCustom) {$mode =$this->cms->VarsGet["mode"]; if($this->filter->issetField('flt_id_subscription')) {$this->filter->DisableFieldSql('flt_id_subscription'); }$this->browser->InitSQL("tp.id, p.name as pkg_name, p.setup_fee, sp.cnt, tp.price, tp.public, tp.included ", Array( 'tables'=>Array('t' => 'cms_hst_tariff', I11218 => 'cms_hst_tariff_pkg', 'p'=>'cms_hst_pkg', 'sp' => 'cms_hst_subscription_pkg'), 'joins'=>Array("t|tp"=>"t.id=tp.id_tariff", "tp|p"=>I11219, "p|sp"=>"(sp.id_subscription='". ($this->filter->issetField('flt_id_subscription') ?$this->filter->GetFieldValue('flt_id_subscription') :0)."' AND sp.id_pkg=tp.id)"), 'joins_types'=>Array('t|tp'=>'LEFT', 'tp|p'=>I11220, 'p|sp'=>I11220) ),"WHERE tp.public ".$this->_ApplyFilters().$this->TTTlIl1(), "tp.id", "", I11221 );$aCustom["fields"] += Array( "pkg_name"=>Array("action"=>"stripline", I11222=>120), "format_prices"=>Array("action"=>"callback", "object"=>&$this, I11223=>'_FormatPrices'), );$this->browser->AddSQLJoinedTables($this->cms->Core, I11218, array(I11218=>'cms_hst_tariff_pkg', 'p'=>'cms_hst_pkg')); $aCustom[I11224] ="tp.id"; $aCustom['list_data']['currency_postfix'] =$this->TTTTlT1(); $aCustom["form_data"][I11225] =Array("add", "apply", "cancel", "save"); parent::TTTlI11($vData, $aCustom); }function _ApplyFilters($prefix =I11217, $bodyType =I11217, $IIlLLl1 =true) {if(!empty($this->options['filter_client_table']) && $this->TTTTlTI()){ $this->options['filter_client_table'] =I11217; }$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function _FormatPrices(&$vItem, &$vData) {$vItem["price"] =FormatNumber($vItem["price"], 0, 0); $vItem["setup_fee"] =FormatNumber($vItem[I11226], 0, 0); }}?>