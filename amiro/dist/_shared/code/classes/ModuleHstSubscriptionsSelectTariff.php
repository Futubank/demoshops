<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       11079 xkqwtzyzxxirtrnwtksmqixlkxxprliqnzlrguixkwggtnwmglmnyztuwmlykkwtwmmgpnir
 */ ?><?php foreach(array(11227=>"SQfZuJt|GrQfMx",11228=>'fJt|SZtQQnS|frHI',11229=>'fJt|tZrMff',11230=>"MS|DuYDWrMGtMHn",11231=>"fJt|nZIQ",11232=>"",11233=>'WID|ODt|tZrMff',11234=>"ZWtMHn",11235=>"HYLQWt",11236=>"vZJuQ",11237=>"Hff",11238=>'WurrQnWB|GHDtfMx',11239=>"WZnWQJ",11240=>'MS',11241=>"GQrMHSD",11242=>'SQDW',11243=>"WZn|DQJQWt",11244=>"WHIIQntD",11245=>'rQD',11246=>'fZMJQS|MS',11247=>'unMt',11248=>"{",11249=>'nZIQ',11250=>'uDQS|rQDHurWQ') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleHstSubscriptionsSelectTariff extends ModuleHstSubscriptions {public $aPeriods; public $IIlIIl1; public $lI1Lll1; function ModuleHstSubscriptionsSelectTariff(&$cms, &$db, &$cModule) {$this->aPeriods =false; $this->IIlIIl1 =0; $this->lI1Lll1 =Array(); parent::ModuleHstSubscriptions($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11 =array(); $IIIIL11[I11227] ="t"; $aOptions += $IIIIL11; $this->module->SetTableName('cms_hst_tariff'); parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function TTTlIII() {parent::TTTlIII(); if($this->filter->issetField('flt_id')) {$this->filter->TITI1l1('flt_id'); }if($this->filter->issetField(I11228)) {$this->filter->TITI1l1(I11228); }if($this->filter->issetField('flt_dateend_to')) {$this->filter->TITI1l1('flt_dateend_to'); }if($this->filter->issetField('flt_clientname')) {$this->filter->TITI1l1('flt_clientname'); }if($this->filter->issetField(I11229)) {$this->filter->TITI1l1(I11229); }if($this->filter->issetField('flt_os_user')) {$this->filter->TITI1l1('flt_os_user'); }if($this->filter->issetField('flt_reseller')) {$this->filter->TITI1l1('flt_reseller'); }$this->filter->AddField(I11230, "hidden", intval($this->cms->Vars[I11230]), "", "", ""); $this->filter->AddField(I11231, "text", stripslashes(unhtmlentities($this->cms->Vars[I11231])), "", " like ", "t.name"); }function TTTlITT($IIIL11l, $cId, $cModule =I11232) {}function &TTTlI1I(&$aData) {parent::TTTlI1I($aData); }function TTTlI11(&$vData, &$aCustom) {$this->IIlIIl1 =intval($this->cms->VarsGet['id_subscription']); if($this->IIlIIl1) {$this->lI1Lll1 =$this->TIlI1Tl($this->IIlIIl1); }$this->browser->InitSQL("t.id, t.name, t.comments", Array( 'tables'=>Array('t' => I11233), ),"WHERE t.archive=0 ".$this->_ApplyFilters().$this->TTTlIl1(), I11232, "t.id", I11232 );$aCustom["fields"] += Array( "pkg_name"=>Array(I11234=>"stripline", "size"=>120), "periods"=>Array(I11234=>"callback", I11235=>&$this, "method"=>'_PrepareRowSubdata'), "action_select" => Array (I11234 => "flagicon", I11236 => 1, "id" => "sel_id", "on" => $this->moduleName ."_list:select_icon", I11237 => $this->moduleName ."_list:select_icon"), );$aCustom["applied_id"] ="tp.id"; $aCustom['list_data'][I11238] =$this->TTTTlT1(); $aCustom["form_data"]["buttons"] =Array("add", "apply", I11239, "save"); ModuleHst::TTTlI11($vData, $aCustom); }function _ApplyFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {if(!empty($this->options['filter_client_table']) && $this->TTTTlTI()){ $this->options['filter_client_table'] =''; }$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function _PrepareRowSubdata(&$vItem, &$vData) {if (!is_array($this->aPeriods)) {$this->TIllTIl(); }$select =''; if (count($this->aPeriods)) {$id =intval($vItem['id']); $select .= "<select class=field style='width: 60px;' name='period_select_$id' id='period_select_$id'>"; if (is_array($this->aPeriods[$id]) && count ($this->aPeriods[$id])) {foreach ($this->aPeriods[$id] as $lI1LlLI) {$select .= "<option value='".$lI1LlLI[I11240]."'>".$lI1LlLI['period']."</option>"; }}$select .= "</select>"; }$vItem[I11241] =$select; $vItem["can_select"] =1; $desc =''; $lI1Lll1 =$this->lI1Lll1; if(count($lI1Lll1)) {$lI1l11L =$this->TIlI1T1($id, $this->IIlIIl1); $lI1lL1I =$this->TIllTI1($lI1Lll1, $lI1l11L, 'available'); if ($lI1lL1I['res'] == false) {$desc .= $lI1lL1I[I11242]; $vItem["can_select"] =0; foreach ($lI1lL1I['failed_id'] as $lI1LlLl) {unset($lI1Lll1[$lI1LlLl]); }}$lI1lL1I =$this->TIllTI1($lI1Lll1, $lI1l11L, 'max'); if ($lI1lL1I['res'] == false) {$desc .= $lI1lL1I[I11242]; $vItem[I11243] =0; foreach ($lI1lL1I['failed_id'] as $lI1LlLl) {unset($lI1Lll1[$lI1LlLl]); }}$lI1lL1I =$this->TIllTI1($lI1Lll1, $lI1l11L, 'can_buy'); if ($lI1lL1I['res'] == false) {$desc .= $lI1lL1I[I11242]; $vItem[I11243] =0; }}$vItem["comments"] =$desc.$vItem[I11244]; }function TIllTIl() {$this->aPeriods =Array(); $sql ="SELECT tp.id, tp.id_tariff, tp.period FROM cms_hst_tariff t LEFT JOIN cms_hst_tariff_period tp ON tp.id_tariff=t.id "; $sql .= "WHERE t.archive=0 ".$this->_ApplyFilters().$this->TTTlIl1()." ORDER BY t.id, tp.id"; $res =&$this->db->select($sql); while($res->nextRecord()){ $this->aPeriods[intval($res->Record['id_tariff'])][] =$res->Record; }}function TIllTI1($lI1Lll1, $lI1l11L, $lI1LlLL) {$aRes =Array (I11245 => true, I11242 => '', 'failed_id' => Array()); if (is_array($lI1l11L) && count($lI1l11L) && is_array($lI1Lll1) && count($lI1Lll1)) {foreach ($lI1Lll1 as $key => $lI1LlL1) {if(($lI1LlLL == 'available' || $lI1LlLL == 'can_buy') && $lI1LlL1 >1) {$lI1LlL1 =1; $lI1l11L[$key][$lI1LlLL] =intval($lI1l11L[$key][$lI1LlLL]); }if($lI1LlL1 >$lI1l11L[$key][$lI1LlLL] && isset($lI1l11L[$key][$lI1LlLL])) {$aRes[I11245] =false; $aRes[I11246][] =$key; switch ($lI1LlLL) {case 'max': $aRes[I11242] .= $this->words['used_resource']." '".$this->aResources[$key]['name']."' ($lI1LlL1 ".$this->aResources[$key][I11247].") "; $aRes[I11242] .= $this->words['exceed_maximum']." (".$lI1l11L[$key][$lI1LlLL]." ".$this->aResources[$key][I11247].I11248; $aRes[I11242] .= "<br>\n"; break; case 'available': $aRes[I11242] .= $this->words['used_resource']." '".$this->aResources[$key][I11249]."' ($lI1LlL1 ".$this->aResources[$key][I11247].") "; $aRes[I11242] .= $this->words['not_available_in_tariff']; $aRes[I11242] .= "<br>\n"; break; case 'can_buy': $aRes[I11242] .= $this->words[I11250]." '".$this->aResources[$key][I11249]."' ($lI1LlL1 ".$this->aResources[$key][I11247].") "; $aRes[I11242] .= $this->words['not_available_to_buy_in_tariff']; $aRes[I11242] .= "<br>\n"; break; default :break; }}}}return $aRes; }}?>