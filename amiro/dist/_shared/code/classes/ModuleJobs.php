<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       37954 xkqwtyrspywuxyxuylrxingkgzluksrnkktwnqnigwygrptgqmkwxnzzlzskxuqrsnsxpnir
 */ ?><?php foreach(array(10567=>"LHYD|WZt",10568=>"PrHuG|HGQrZtMHnD",10569=>"PQn|KQBCHrSD",10570=>"L",10571=>"YHSB|MtQIs",10572=>"fJt|LHY|WZt|MS",10573=>"?JMKQ?",10574=>'',10575=>"QxGMrQ|GQrMHS",10576=>"SY",10577=>'WID|LHYD',10578=>"",10579=>'L',10580=>"fJZPMWHn",10581=>"|JMDt%GuYJMW|Hn",10582=>"PQt|CHrS",10583=>"QxGQrMQnWQ",10584=>"CHrSD",10585=>"QSMt|MS",10586=>"ZWtMHn",10587=>"|JMDt%SQJ",10588=>"YuttHnD",10589=>"GuYJMDOQS",10590=>"JQP|SQJ",10591=>"tHG|JMnK",10592=>"QSZtQ",10593=>"DtZtuD",10594=>"ZPQ|tMJJ",10595=>"DZJZrB",10596=>"DQx|",10597=>"DQx",10598=>"ZnB",10599=>"DWOQSuJQ",10600=>"MS",10601=>'WJHDQS',10602=>"'{?zd?QSZtQ!?",10603=>"ZrWOMvQ",10604=>"DQJQWtQS",10605=>"rQEuMrQIQntD1",10606=>"GuYJMW",10607=>"fSZtQ",10608=>"WZt|MS",10609=>"SZtQ|QxGMrQ",10610=>"LHYrQEuMrQIQntD1",10611=>"DuYMtQID|WHJD",10612=>"YHSB|MtQID",10613=>'YHSB|urPQnt|WZtD',10614=>"YHSB|WZtD",10615=>'Qxt|rDD',10616=>"SQGZrtIQnt",10617=>"coqRq?L`MS='",10618=>'YHSB|urPQnt|MtQID',10619=>"'{?zd?QSZtQ",10620=>"COQrQ",10621=>"HYLQWt",10622=>"MtQI|rHC",10623=>"nZIQ",10624=>'ZSS',10625=>'frHnt',10626=>"MtQI",10627=>"?L`urPQnt?sqdw!?L`",10628=>"?jmimT?",10629=>"||MS|WZt||",10630=>"nZIQ|fMQJS|nZIQ",10631=>"|pQtgMWturQDwy",10632=>"DuYMtQI",10633=>"oDGJMttQr",10634=>"DIZJJ",10635=>"nH|WZtD",10636=>"DMIGJQ|DQt|fMQJSD",10637=>"JMDt|SZtZ",10638=>'WZtD|nuI',10639=>"'!'",10640=>"DQJQWt",10641=>"'{?ZD?fSZtQ?",10642=>'L`urPQnt?sqdw',10643=>'wjzddqd|gzTo',10644=>"fMQJSD",10645=>"GrQvwZtmS",10646=>"|pQtdIZJJsQtZMJDwy",10647=>"SZtQ",10648=>"MS|WZt",10649=>"frHnt|JMnK",10650=>"WZt|SQtZMJ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleJobs extends CMS_ActModule {public $IlIllI1; public $I1LIIl1; public $I1LIILI; public $I1LIILl; public $I1LIILL; public $II1lllI; public $I1LII1I; function ModuleJobs(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); $this->I1LII1I =$this->cms->Core->IsInstalled("jobs_cat") && $this->module->IssetAndTrueOption("use_categories"); if ($this->I1LII1I) {$this->IlIllI1 =new CMS_CategoriesFunctions($this->cms, $this, I10567, "_categories_items_list.tpl", "jobs_cat_items.tpl"); }else {$this->IlIllI1 =new CMS_CategoriesFunctionsStub($this->cms, $this, I10567); }}function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11[I10568] =Array("publish_on", "publish_off", "del", "gen_sublink", I10569, "index_details", "no_index_details", "move_position"); $IIIIL11["default_prefix"] =I10570; $IIIIL11["use_id_page"] =true; $IIIIL11["use_options_form"] =true; $IIIIL11["name_field_name"] ="name"; $IIIIL11["announce_field_name"] ="duty"; $IIIIL11["description_field_name"] ="requirements1"; $IIIIL11["hide_empty_simple"] =Array(I10571); $IIIIL11["use_positions"] =true; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); $this->IlIllI1->_Init(); $this->IlIllI1->TTIT1IT("_ApplyCatFilters"); }function _InitAdmin() {parent::_InitAdmin(); }function TTTlITT($IIIL11l, $cId, $cModule ="") {parent::TTTlITT($IIIL11l, $cId, $cModule); }function GetHtml(&$aCustom) {return parent::GetHtml($aCustom); }function TTTlIII() {parent::TTTlIII(); if($this->IlIllI1->TTTlIII("flt_job_cat_id")) {$this->filter->MoveField(I10572, _MOVE_START); }$this->filter->AddField("flt_jname", "text", stripslashes(unhtmlentities($this->cms->Vars["flt_jname"])), "", I10573, "j.name"); $this->filter->MoveField("flt_jname", _MOVE_START); }function _ApplyCatFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function _ApplyFilters($prefix =I10574, $bodyType =I10574, $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); $vData["fdate"] =date($this->cms->DFMT["php"]); $vData["edate"] =date("d.m.Y", strtotime($this->module->GetOption(I10575))); $vData['form_width'] ='100%'; }function TTTlI1l() {$res =false; if(parent::TTTlI1l()) {$res =$this->IlIllI1->TTTlI1l(); }return $res; }function TTTlI11(&$vData, &$aCustom) {$aCatSql =Array(); $aCatSql["join_to_alias"] =I10570; $this->IlIllI1->TTIT1lT("item_list", $aCatSql); $this->browser->InitSQL("j.id, j.public, j.name, j.status, j.sex, j.age_from, j.age_till, j.experience, j.schedule, j.salary, j.duty, j.requirements1, j.requirements2, ". "DATE_FORMAT(j.date,'".$this->cms->DFMT["db"]."') AS fdate, ". "DATE_FORMAT(j.date_expire,'".$this->cms->DFMT[I10576]."') AS edate ".$aCatSql["select"], Array('tables'=>Array('j'=>I10577) +$aCatSql['tables'], 'joins'=>$aCatSql['joins']), "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), I10578, "name", "j.id desc", $aCatSql["order_replace"] );if(!empty($aCatSql['tables'])) {$this->browser->AddSQLJoinedTables($this->cms->Core, I10579, $aCatSql['tables']); }$aCustom["fields"] += Array( "public"=>Array("action"=>I10580, "value"=>1, "id"=>"pub_id", "on"=>$this->moduleName.I10581,"off"=>$this->moduleName."_list:public_off"), "status"=>Array("action"=>I10582, "words"=>&$this->words), "sex"=>Array("action"=>I10582, "words"=>&$this->words), I10583=>Array("action"=>I10582, "words"=>&$this->words), "schedule"=>Array("action"=>I10582, I10584=>&$this->words), "action_edit"=>Array("action"=>I10580, "value"=>I10578, "id"=>I10585, "on"=>$this->moduleName."_list:edit","off"=>I10578), "action_del"=>Array(I10586=>I10580, "value"=>I10578, "id"=>"del_id", "on"=>$this->moduleName.I10587,"off"=>I10578), );$aCustom["applied_id"] ="j.id"; $aCustom["form_data"][I10588] =Array("add", "apply", "cancel", "save"); $this->IlIllI1->TTTlI11($vData, $aCustom); parent::TTTlI11($vData, $aCustom); }function TTT11Tl(&$IILILII) {$IILILII[] =I10589; $IILILII[] ="notpublished"; $IILILII[] ="leg_yellow"; $IILILII[] ="leg_blue"; $IILILII[] ="leg_edit"; $IILILII[] =I10590; parent::TTT11Tl($IILILII); }function TTT1lTl($IIl1II1, &$record, &$vData, &$aData) {parent::TTT1lTl($IIl1II1, $record, $vData, $aData); switch($IIl1II1) {case I10571: $vData["item_link"] =$this->cms->Gui->get($this->moduleName."_list:itemD_item_link", $vData); $this->IlIllI1->TTT1lTl($IIl1II1, $record, $vData, $aData); $vData["top_link"] =$this->cms->TTITI1l("itemD", I10591, $vData); $vData["date"] =$this->cms->TTITI1l("itemD", "date", $record["fdate"]); if ($record[I10592] != "00.00.00") {$vData[I10592] =$this->cms->TTITI1l("itemD", I10592, $record[I10592]); }else {$vData[I10592] =I10578; $record[I10592] =I10578; }$vData["status"] =$this->words[$record["status"]]; $vData[I10593] =$this->cms->TTITI1l("itemD", I10593, $vData[I10593]); if ($vData["age_from"] == "0") {$vData["age_from"] =I10578; }if ($vData[I10594] == "0") {$vData[I10594] =I10578; }if (!empty($vData["salary"])) {$vData["salary"] =$this->cms->TTITI1l("itemD", I10595, $record[I10595]); }if ($vData["sex"] == "any") {$vData["sex"] =I10578; }else {$vData["sex"] =$this->words[I10596.$record["sex"]]; $vData["sex"] =$this->cms->TTITI1l("itemD", "sex", $vData[I10597]); }if ($vData[I10583] == "no") {$vData[I10583] =I10578; }else {$vData[I10583] =$this->words["exp_".$record[I10583]]; $vData[I10583] =$this->cms->TTITI1l("itemD", I10583, $vData[I10583]); }if ($vData["schedule"] == I10598) {$vData["schedule"] =I10578; }else {$vData["schedule"] =$this->words["schedule_".$record["schedule"]]; $vData[I10599] =$this->cms->TTITI1l("itemD", I10599, $vData[I10599]); }if ($this->cms->Core->IsInstalled("jobs_history")) {$tmpMod =&$this->cms->Core->GetModule("jobs_history"); if ($tmpMod->IsPresentInPMandPublic()) {$tData["resume_post_link"] =$tmpMod->GetFrontLink(); $tData[I10600] =$vData[I10600]; $vData["resume_post_link"] =$this->cms->TTITI1l("itemD", "resume_post_link", $tData); if($record['status'] == I10601){ unset($vData["resume_post_link"]); }}}break; }}function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $sql ="SELECT j.*, DATE_FORMAT(j.date,'".$this->cms->DFMT[I10576]."') AS fdate, ". "DATE_FORMAT(j.date_expire,'".$this->cms->DFMT[I10576].I10602 ."IF(j.public > 0, 'checked', '') AS public ". "FROM cms_jobs AS j ". "WHERE j.id='".$cId."'".$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; unset($this->itemData[I10603]); $this->itemData["job_status_".$this->db->Record[I10593]] ="selected"; $this->itemData[I10596.$this->db->Record[I10597]] ="selected"; $this->itemData["exp_".$this->db->Record[I10583]] =I10604; $this->itemData["schedule_".str_replace("-", I10578, $this->db->Record[I10599])] =I10604; $this->itemData["duty"] =$this->cms->htmlchars($this->itemData["duty"]); $this->itemData[I10605] =$this->cms->htmlchars($this->itemData[I10605]); $this->itemData["requirements2"] =$this->cms->htmlchars($this->itemData["requirements2"]); }}function _ActionDel($cId, $cModule) {$sql ="SELECT public, id_cat FROM cms_jobs WHERE id='".$cId."'"; $this->db->query($sql); if($this->db->next_record()){ $this->IlIllI1->TTIT1ll($cId, $cModule, $this->db->Record[I10606], $this->db->Record["id_cat"]); parent::_ActionDel($cId, $cModule); $err =$this->GetLastError(); if(empty($err["errno"])) {$this->IlIllI1->_ActionDel($cId, $cModule); }}}function TTTll11($cId, $cModule) {parent::TTTll11($cId, $cModule); if(empty($this->errno) && $this->appliedId >0) {$this->IlIllI1->TTTll11($cId, $cModule); }}function TTTl1lI($cId, $cModule) {parent::TTTl1lI($cId, $cModule); if(empty($this->errno)) {$this->IlIllI1->TTTl1lI($cId, $cModule); }}function _ActionPublish($cId, $cModule) {$this->IlIllI1->TTIT1ll($cId, $cModule); parent::_ActionPublish($cId, $cModule); $this->IlIllI1->_ActionPublish($cId, $cModule); }function TTT1Tl1($cType, $cModule, $condition =I10574) {$res =$this->IlIllI1->TTT1Tl1($cType, $cModule); if(!$res) {parent::TTT1Tl1($cType, $cModule, $condition); }}function TTT1IlI($aSql =Array(), $cId =0) {$name =$this->cms->VarsPost["name"]; if (!empty($this->cms->VarsPost["fdate"])) {$udate =DateTools::getCorrectUDate($this->cms->VarsPost[I10607], $this->cms->DFMT["conf"]); $udate =DateTools::toMysqlDate($udate); }else {$udate =I10578; }if (!empty($this->cms->VarsPost[I10592])) {$edate =DateTools::getCorrectUDate($this->cms->VarsPost[I10592], $this->cms->DFMT["conf"]); $edate =DateTools::toMysqlDate($edate); }else {$edate =I10578; }$department =I10578; if ($this->cms->Core->IsInstalled("jobs_history")) {$sql ="SELECT cms_jobs_cat.name FROM cms_jobs_cat WHERE cms_jobs_cat.id = '".intval($this->cms->VarsPost[I10608])."'"; $this->db->query($sql); if ($this->db->next_record()) {$department =$this->db->Record["name"]; }}if(!empty($name)) {$aSql =Array( "name"=>$name, "date"=>$udate, I10609=>$edate, I10593=>$this->cms->VarsPost[I10593], I10597=>$this->cms->VarsPost[I10597], "age_from"=>$this->cms->VarsPost["age_from"], I10594=>$this->cms->VarsPost[I10594], I10583=>$this->cms->VarsPost[I10583], I10599=>$this->cms->VarsPost[I10599], I10595=>$this->cms->VarsPost[I10595], I10606=>$this->cms->VarsPost[I10606], "duty"=>$this->cms->VarsPost["jobduty"], I10605=>$this->cms->VarsPost[I10610], "requirements2"=>$this->cms->VarsPost["jobrequirements2"], );}$this->IlIllI1->TTT1IlI($aSql, $cId); $aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function TTTlTI1() {parent::TTTlTI1(); $this->I1LIIl1 =$this->module->GetOption("show_subitems"); $this->I1LIILl =$this->module->GetOption("subitems_splitter_period"); $this->I1LIILL =$this->module->GetOption(I10611); $this->cms->SetsTemplate =$this->moduleName."_list"; }function TTTllTI(&$aCustom) {$flag =true; $I1LII1L =false; $cat =$this->IlIllI1->TTTllTI($aCustom); if($cat != -1) {if($this->id >0) {$this->SetBodyType(I10571); $flag =false; $I1LII1L =true; }else {if($cat === 0) {$this->SetBodyType('body_urgent_cats'); $this->SetBodyType("body_cats"); $this->bodyType ='body_cats'; $flag =false; }else {if($this->id != -1) {$this->SetBodyType(I10612); $this->SetBodyType('body_urgent_items'); }else {$this->SetBodyType(I10571); $flag =false; $I1LII1L =true; }}}if($cat !== false) {if($flag && $this->module->GetOption("multicat")) {$this->SetBodyType('body_urgent_cats'); $this->SetBodyType("body_cats"); if ($this->bodyType == I10613) {$this->bodyType ='body_cats'; }}if($I1LII1L && $this->module->GetOption("multicat_in_body_details")) {$this->SetBodyType(I10613); $this->SetBodyType("body_cats"); if ($this->bodyType == I10613) {$this->bodyType ='body_cats'; }}}}parent::TTTllTI($aCustom); }function TTTlllT(&$vData) {parent::TTTlllT($vData); }function TTTll1T(&$vData, &$aCustom) {$aDefault =Array(); foreach($this->IIllIL1 as $IIlL1L1 => $tmp) {$this->lIlLL11 =false; $IIlL1Ll =$this->TTITTT1($aCustom, $IIlL1L1, false); switch($IIlL1L1) {case I10614: case I10613: $IIlL1Ll["page_item_type"] =$IIlL1L1; $IIlL1Ll['show_urgent_elements'] =$this->cms->Core->getModOption('jobs_cat', 'show_urgent_elements'); if (isset($this->ext[I10615])) {$I1LII11 =$this->ext[I10615]->IL1LI11; $this->ext[I10615]->IL1LI11 =false; }if ($this->cms->Core->IsInstalled("jobs_history")) {$tmpMod =&$this->cms->Core->GetModule("jobs_history"); if ($tmpMod->IsPresentInPMandPublic()) {$vData["request_link"] =$tmpMod->GetFrontLink(); $vData["new_request_link"] =$this->cms->Gui->get($this->moduleName."_list:new_request_link", $vData); }}$this->IlIllI1->TTTll1T($vData, $IIlL1Ll); break; case I10571: $aDefault["page_item_type"] =I10571; $IIlL1Ll += $aDefault; $IIlL1Ll["simple_set_fields"] =Array("name", "duty", I10616, "age_from", I10594, I10595, I10605, "requirements2"); $this->IlIllI1->TTTll1T($vData, $IIlL1Ll); $aCatSql =Array(); $this->IlIllI1->TTIT1lT("item_details", $aCatSql); $sql ="SELECT j.*, ". "DATE_FORMAT(j.date, '".$this->cms->DFMT[I10576]."') AS fdate, ". "DATE_FORMAT(j.date_expire, '".$this->cms->DFMT[I10576]."') AS edate ". "FROM cms_jobs AS j ". I10617.$this->id."'".$aCatSql["where"].$this->_ApplyFilters(); $this->db->query($sql); $IIlL1Ll["item"] ="item_detail"; break; case I10612: case I10618: $aDefault["page_item_type"] =$IIlL1L1; $aDefault ["simple_set_fields"] =Array("name", I10605); $IIlL1Ll += $aDefault; $this->TTTllll($vData, $IIlL1Ll); $aCatSql =Array(); $this->IlIllI1->TTIT1lT("item_list", $aCatSql); $this->browser->InitSQL("j.id, j.id_cat, j.public, j.name, j.status, j.department, j.sublink, j.duty, j.requirements1, j.requirements2, j.salary,". "DATE_FORMAT(j.date, '".$this->cms->DFMT[I10576]."') AS fdate, ". "j.modified_date as m_date, j.date as c_date, j.name as jobs_name, ". "DATE_FORMAT(j.date_expire, '".$this->cms->DFMT[I10576].I10619.$aCatSql["select"], " FROM cms_jobs AS j ".$aCatSql["join"], "WHERE 1 ".$aCatSql[I10620].$this->_ApplyFilters(I10574, $IIlL1L1 == I10618 ?$IIlL1L1 :I10574).$this->TTTlIl1(), I10578, $this->browser->TI1TTlT() );$this->browser->AddSQLJoinedTables($this->cms->Core, I10579, $aCatSql["tables"]); $IIlL1Ll["fields"]["details"] =Array(I10586=>"callback", I10621=>&$this, "method"=>"_GetItemCB"); $IIlL1Ll["row_set"] =($IIlL1L1 == I10618 ?'urgent_' :I10574) .I10622; $this->lIlLL11 =true; if(!$this->IlIllI1->TTTll1T($vData, $IIlL1Ll)) {$IIlL1Ll["page_item_type"] ="body_empty"; }break; }$this->lIlLL11 =false; parent::TTTll1T($vData, $IIlL1Ll); if (isset($I1LII11)) {$this->ext[I10615]->IL1LI11 =$I1LII11; unset($I1LII11); }}}function TTT1ITI($cId, $cModule) {$this->cms->VarsPost['status'] ="opened"; $this->cms->VarsPost[I10623] =$this->cms->VarsPost["position"]; $this->cms->VarsPost[I10610] =$this->cms->VarsPost["requirements"]; $this->cms->VarsPost[I10607] =date($this->cms->DFMT["php"]); $this->cms->VarsPost[I10592] =date("d.m.Y", strtotime($this->module->GetOption(I10575))); $this->action =I10624; $this->cms->PushFrontSettings($this->db, $this->langData); require_once $GLOBALS['CLASSES_PATH'] .'Admin.php'; $adm =new Admin($this->cms->Core); $adm->constructorPostActions(); $adm->InitFromObject($this->cms, $this->module); $cms =clone($this->cms); $this->cms =&$adm; $this->cms->Messages =$cms->Messages; $this->cms->Messages['status_add'] =$cms->Messages['status_add_after_moderation']; $this->cms->SuppressStatusErrors =true; $this->realSide =I10625; $this->_InitAdmin(); $this->TTTll11(0, $cModule); $I1LlLII =$adm->SysStatusMsgs; $I1LlLIl =$adm->StatusMsgs; $this->cms =&$cms; $this->cms->PopFrontSettings($this->db, $this->langData); }function _GetDetailsLinkCB(&$aItem, &$aData) {if(!empty($aItem["body"])) {$aItem["details_link"] =1; }}function TIITIll(&$aItem, &$aData, $setPrefix =I10578) {$aItem["date"] =$aItem[I10607]; $aItem["date"] =$this->cms->TTITI1l(I10626, "date", $aItem); $aItem[I10623] =$this->cms->TTITI1l(I10626, I10623, $aItem); if($aItem["body_notempty"]) {$aItem["more"] =$this->cms->TTITI1l(I10626, "more", $aItem); }}function _GetItemCB(&$aItem, &$aData) {$this->TIITIll($aItem, $aData); }function TIITIl1(&$IIL1lLI, $IIl1II1 =I10574) {$this->lIlLL11 =false; $II11L1L =I10627.$this->module->GetOption("front_subitem_sort_col")." ".$this->module->GetOption("front_subitem_sort_dim"); $fields ="SELECT j.id, j.id_cat, j.name, j.sublink, ". " DATE_FORMAT(j.date, '".$this->cms->DFMT[I10576]."') AS fdate, j.urgent "; $fields .= " FROM cms_jobs AS j WHERE "; $this->_forceHideFutureItems =true; if($this->I1LIIl1 >0) {$sql =$fields." j.id_cat='__id_cat__'".$this->_ApplyFilters(I10574, $IIl1II1, false)." ORDER BY ".$II11L1L.I10628.$this->I1LIIl1; }else {$sql =$fields." j.id_cat IN('".implode("','", $IIL1lLI)."')".$this->_ApplyFilters(I10574, $IIl1II1, false)." ORDER BY j.id_cat ASC, ".$II11L1L; }unset($this->_forceHideFutureItems); $this->I1LIILI =$this->IlIllI1->TTIITTI($sql, $IIL1lLI, I10629); $this->lIlLL11 =true; }function _DrawSubItemsCB(&$aItem, &$aData) {$I1LIlIl =$this->I1LIILI[$aItem[I10600]]; $aItem["item_list"] =I10578; if(is_array($I1LIlIl)) {$k =0; $numRows =sizeof($I1LIlIl); $vData["simple_prefix"] ="subitem_"; $I1LIlIL =$this->options["name_field_name"]; $this->options[I10630] =I10623; foreach($I1LIlIl as $index=>$aSubItem) {$k++; $aTmp["active_item_type"] =I10612; $aTmp[I10608] =$aItem[I10600]; $aTmp["cat_sublink"] =$aItem["sublink"]; $aTmp["date"] =$aItem[I10607]; $this->_GetNavDataCB($aSubItem, $aTmp); $aSubItem += $this->IIllllL; $IIlLIIL =Array(I10586=>I10631, "data"=> $_data =array(&$aSubItem, &$vData)); $this->TTT1lI1($IIlLIIL, array('ext_images')); $this->TIITIll($aSubItem, $aData, "subitem_"); $aItem["item_list"] .= $this->cms->TTITI1l(I10632, "row", $aSubItem); if ($k >0 && $k != $numRows) {if ((($k %$this->I1LIILL) == 0)) {$aItem["item_list"] .= $this->cms->TTITI1l(I10632, "Vsplitter", $aItem); }elseif ($k >1) {$aItem["item_list"] .= $this->cms->TTITI1l(I10632, I10633, $aItem); }if ($this->I1LIILl && $k%$this->I1LIILl == 0) {$aItem["item_list"] .= $this->cms->TTITI1l(I10632, "nSplitter", I10578); }}}$this->options[I10630] =$I1LIlIL; $aItem["item_list"] =$this->cms->TTITI1l(I10632, "list", $aItem); }}function TTTlIT1(&$aCustom, $cType =I10634, $IIlLI11 =I10578, $IIlLlII ="_small") {$this->IlIllI1->TTTlITl($aCustom, $cType, $IIlLI11, $IIlLlII, true); $html =parent::TTTlIT1($aCustom, $cType, $IIlLI11, $IIlLlII); $this->IlIllI1->TTTlITl($aCustom, $cType, $IIlLI11, $IIlLlII, false); return $html; }function TTTll1I(&$vRes, &$aCustom, $cType, $IIlLlII) {$I1LIlI1 =$this->module->GetOption("small_number_items"); $I1LIllI =$this->module->GetOption("small_category_ids"); $I1LIlll =$this->module->GetOption("small_number_categories"); $mode =I10635; if( $this->cms->Core->IsInstalled($this->IlIllI1->catModuleName) && $this->module->issetAndTrueOption('use_categories') ){$mode ="cats_ids"; $I1LIllL =is_array($I1LIllI); if(!$I1LIllL || ($I1LIllL && sizeof($I1LIllI) == 0)) {if(empty($I1LIllI)) {if(empty($I1LIlll)) {$mode =I10635; }else {$mode ="cats_num"; }}else {$I1LIllI =Array($I1LIllI); }}}$I1LIll1 =" "; if(!empty($I1LIlI1)) {$I1LIll1 =I10628.$I1LIlI1; }$aDefault =Array(); $aDefault[I10636] =Array(I10623, "duty"); $aCustom += $aDefault; $aDefault["list_data"]["splitter_prefix"] ="small_"; $aCustom[I10637] += $aDefault[I10637]; $I1LIlLI =" j.".$this->module->GetOption("small_items_sort_col")." ".$this->module->GetOption("small_items_sort_dim"); $aCatIds =Array(); if ($this->I1LII1I && ($mode == I10638 || $mode == 'cats_ids')) {$I1LIlLl =in_array('at_spec_block', $this->IlIllI1->IILI1LI->GetAOption('show_urgent_elements')); $this->TTITTTI('push'); $sql ="SELECT c.id AS cat_id, c.sublink AS cat_sublink, c.name AS cat_name FROM cms_jobs_cat AS c WHERE 1".$this->_ApplyCatFilters('c', I10574, !$I1LIlLl); $I1LIlLL =" ORDER BY " .($I1LIlLl ?'c.urgent DESC, ' :I10574) ."c.".$this->module->GetOption("small_categories_sort_col")." ".$this->module->GetOption("small_categories_sort_dim"); if($mode == "cats_num") {$sql .= $I1LIlLL.I10628.$I1LIlll; }else {$sql .= " AND id IN('".implode(I10639, $I1LIllI)."')".$I1LIlLL; }$this->TTITTTI('pop'); $this->db->query($sql); while ($this->db->next_record()) {$aCatIds[] =$this->db->Record[I10608]; $this->II1lllI["aCats"][$this->db->Record[I10608]] =$this->db->Record; }}$I1LIlL1 =in_array('at_spec_block', $this->module->GetAOption('show_urgent_elements')); if($mode == I10635) {$aCatSql =Array(); $this->IlIllI1->TTIT1lT('small_list', $aCatSql); }$IILL1ll =$this->options["use_id_page"]; $this->options["use_id_page"] =false; $this->_forceHideFutureItems =true; switch($mode) {case I10635: $this->options['use_id_page'] =$IILL1ll; $lIL1L11 =empty($aCatSql[I10640]) ?"''" :'c.name'; $this->browser->InitSQL("j.*, " .$lIL1L11 ." as department, date_format(j.date,'".$this->cms->DFMT[I10576].I10641.$aCatSql[I10640], "FROM cms_jobs AS j ".$aCatSql["join"], "WHERE 1 ".$this->_ApplyFilters(I10574, I10574, !$I1LIlL1).$aCatSql[I10620], I10578, $I1LIlLI );$this->browser->SetForceRules(I10578, $I1LIll1); $this->browser->AddSQLJoinedTables($this->cms->Core, I10579, $aCatSql["tables"]); if ($I1LIlL1) {$this->browser->TI1TII1(array (I10642)); }break; case "cats_num": case "cats_ids": $aItems =Array(); if(sizeof($aCatIds) >0) {$ILLILlL ="SELECT j.id, j.id_page, j.name, j.duty, c.name as department, j.sublink, j.salary, date_format(j.date,'".$this->cms->DFMT[I10576].I10641; if ($I1LIlL1) {$I1LIlLI =' c.urgent DESC, ' .$I1LIlLI; }foreach($aCatIds as $k => $catId) {$sql =$ILLILlL.", c.id AS id_cat, c.sublink AS cat_sublink FROM cms_jobs AS j LEFT JOIN cms_jobs_cat c ON c.id=j.id_cat WHERE id_cat=".$catId." ".$this->_ApplyFilters(I10574, I10574, !$I1LIlL1)." ORDER by ".$I1LIlLI.$I1LIll1; $this->db->query($sql); while($this->db->next_record()) {$aItems[] =$this->db->Record +$this->II1lllI["aCats"][$this->db->Record["id_cat"]]; }}}require_once $GLOBALS[I10643] .'CMS_IteratorArray.php'; $I1LIl1I =$this->db; $this->db =new CMS_IteratorArray($this->module); $this->db->SetArray($aItems); $this->browser->InitSQL(I10600, "FROM cms_jobs ", "WHERE 1 " );$this->browser->SetForceRules(I10578, " "); $aCustom[I10644] += Array("cat_details" => Array(I10586=>"callback", I10621=>&$this, "method"=>"_GetSmallCatDetailsCB")); $this->II1lllI[I10645] =-1; break; }unset($this->_forceHideFutureItems); $this->options["use_id_page"] =$IILL1ll; $aCustom[I10644] += Array("details" => Array(I10586=>"callback", I10621=>&$this, "method"=>I10646)); parent::TTTll1I($vRes, $aCustom, $cType, $IIlLlII); if(isset($I1LIl1I)) {$this->db =$I1LIl1I; }}function _GetSmallDetailsCB(&$aItem, &$aData) {$aItem["front_link"] =$aData["front_link"]; if($this->II1lllI[I10616] != $aItem[I10616]) {$this->II1lllI[I10616] =$aItem[I10616]; $aItem[I10616] =$this->cms->TTITI1l(I10634, I10616, $aItem); }else {$aItem[I10616] =I10578; }$aItem["date"] =$aItem[I10607]; $aItem["date"] =$this->cms->TTITI1l(I10634, I10647, $aItem); $aItem[I10623] =$this->cms->TTITI1l(I10634, I10623, $aItem); $aItem["duty"] =$this->cms->TTITI1l(I10634, "duty", $aItem); $aItem["more"] =$this->cms->TTITI1l(I10634, "more", $aItem); }function _GetSmallCatDetailsCB(&$aItem, &$aData) {if($this->II1lllI[I10645] != $aItem[I10648]) {$this->II1lllI[I10645] =$aItem[I10648]; $tmp =Array("active_item_type"=>I10614); $tmp2 =Array(I10600=>$aItem[I10648], "sublink"=>$aItem["cat_sublink"]); $this->_GetNavDataCB($tmp2, $tmp); $aItem["front_link"] =$aData[I10649]; $aItem["cat_nav_data"] =$tmp2["nav_data"]; $aItem["cat_detail"] =$this->cms->TTITI1l(I10634, "cat_detail", $aItem); }else {$aItem[I10650] =I10578; }}function TTT11IT($IILILIL) {$navData =parent::TTT11IT($IILILIL); $navData += $this->IlIllI1->TTT11IT($IILILIL); return $navData; }function correctStopArgNames($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I ="getallvalues"){ return $this->IlIllI1->correctStopArgNames($cData, $IIL1lL1, $res, $aData, $IIL1l1I); }function TTT1II1(&$db, &$aParams) {$aVars =parent::TTT1II1($db, $aParams) +$this->IlIllI1->TTT1II1($db, $aParams); return $aVars; }function TTT1TTI(&$IIl1ll1, $prefix) {if ($this->I1LII1I) {$IIl1ll1['select'] .= ", id_cat"; }}function TTT1TTl(&$record) {if ($this->I1LII1I) {$this->IlIllI1->catId =$record['id_cat']; }}}?>