<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       18596 xkqwlpxtwpszlrrlmzgkuptrstxktiwyrnkpllurxpkznwyzywsniwppwxsmglkxntxppnir
 */ ?><?php foreach(array(12155=>"",12156=>"MnDtZJJ",12157=>"unMnDtZJJ",12158=>'SZtQfrHI',12159=>'fJt|',12160=>'',12161=>'SY',12162=>"'^\r\n",12163=>"MS!?nZIQ!?SMDZYJQS|JZnPuZPQD!?MD|MnDtZJJQS",12164=>"fMQJSD",12165=>"IQtOHS",12166=>"DMAQ",12167=>"MD|MnDtZJJQS",12168=>"GuY|MS",12169=>"|JMDt%MD|MnDtZJJQS|Hn",12170=>"|JMDt%MD|MnDtZJJQS|Hff",12171=>'WZJJYZWK',12172=>"ZWtMHn",12173=>"Hn",12174=>"|JMDt%MWHnD|QSMt|MnDtZJJ",12175=>"ZWtMHn|MnDtZJJ",12176=>"MS",12177=>"MnDtZJJ|MS",12178=>"|JMDt%MnDtZJJ",12179=>"ZWtMHn|unMnDtZJJ",12180=>"unMnDtZJJ|MS",12181=>"|JMDt%unMnDtZJJ",12182=>"Hff",12183=>"JQP|BQJJHC",12184=>"JQP|MnDtZJJQS",12185=>"JQP|nHtMnDtZJJQS",12186=>"JQP|MnDtZJJ",12187=>"JQP|unMnDtZJJ",12188=>'SMDGJZB|tHHJtMG',12189=>'nZIQ',12190=>'DQJQWtQS',12191=>'SrMvQr|tMtJQ',12192=>'MD|MnDtZJJQS',12193=>'ZWtMHn|MnDtZJJ',12194=>'ZWtMHn|unMnDtZJJ',12195=>'ZWtMHn|QSMt',12196=>'"',12197=>'[',12198=>'DtZtuD|SQJQtQS',12199=>'IHSMfMQS|SZtQ',12200=>'JMDt',12201=>'SrMvQr`tGJ',12202=>'uGSZtQ?WID|GZB|SrMvQrD?DQt?MD|MnDtZJJQS=1?COQrQ?MS="',12203=>'DtZtuD|MnDtZJJQS',12204=>'DtZtuD|ZJrQZSB|MnDtZJJQS',12205=>'uGSZtQ?WID|GZB|SrMvQrD?DQt?MD|MnDtZJJQS=0?COQrQ?MS="',12206=>'DtZtuD|unMnDtZJJQS',12207=>'DtZtuD|ZJrQZSB|nHt|MnDtZJJQS',12208=>'~',12209=>'ZutOHr',12210=>'fQQ|GQrWQnt',12211=>'DQttMnPD',12212=>"fQQ|GQrWQnt",12213=>'MS',12214=>'QnW|DHrt',12215=>'JMIMt',12216=>'fQQ|Wurr',12217=>'vZJuQ',12218=>"coqRq?.MD|MnDtZJJQS.?ZnS?.nZIQ.?,=?'SQIH'",12219=>'MtQID|tBGQ',12220=>"rQIHvQ|SMDZYJQS",12221=>"ZGGJB",12222=>'~SrMvQr`JnP',12223=>'DOHC|SrMvQr|MnfH',12224=>"|JMDt%MnfH",12225=>'MnDtZJJ',12226=>'WHnfMPurZtMHn',12227=>'SQDWrMGtMHn') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModulePayDrivers extends CMS_ActModule {public $llIlLL1; public $llIlL1I; protected $llIlL1l =array(); function ModulePayDrivers(&$cms, &$db, &$cModule) {$this->llIlLL1 =$GLOBALS['LOCAL_FILES_PATH'] .'eshop/pay_drivers/'; $this->llIlL1I =$GLOBALS['LOCAL_FILES_REL_PATH'] .'eshop/pay_drivers/'; parent::CMS_ActModule($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11['lang_data'] =false; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function TTTlITT($IIIL11l, $cId, $cModule =I12155) {if(!sizeof($this->cms->VarsGet) && !sizeof($this->cms->VarsPost)) {$IIIL11l ="check"; }switch($IIIL11l) {case "check": $this->TIll1II($cId, $cModule); $this->redirect =false; break; case I12156: $this->TIll1Il($cId, $cModule); $this->redirect =false; break; case I12157: $this->TIll1I1($cId, $cModule); $this->redirect =false; break; default: if('rsrtme' == $IIIL11l){ $this->redirect =FALSE; }parent::TTTlITT($IIIL11l, $cId, $cModule); break; }}function _InitAdmin(){ parent::_InitAdmin(); if($this->filter->issetField('datefrom')){ $this->filter->TITI1l1(I12158); }if($this->filter->issetField('dateto')){ $this->filter->TITI1l1('dateto'); }$this->filter->IL11l1L =array('limit'); foreach(array('name') as $field){ $llIlL1L =I12159 .$field; $value =isset($this->cms->Vars[$llIlL1L]) ?stripslashes(unhtmlentities($this->cms->Vars[$llIlL1L])) :''; $this->filter->AddField($llIlL1L, 'text', $value, '', ' like ', $field); $this->filter->MoveField($llIlL1L, _MOVE_START); if(I12160 === $value){ $this->filter->DisableFieldSQL($llIlL1L); }}}function TTTlI11(&$vData, &$aCustom){ $aCustom['list_data']['driverDescriptionsJS'] =I12160; $this->llIlL1l =array(); $sql ="SELECT `name` " ."FROM `cms_pay_drivers`"; $oCol =AMI::getSingleton(I12161)->fetchCol($sql); foreach($oCol as $name){ $description =$this->TIll1lT($name); if($description){ $this->llIlL1l[$name] =TRUE; $aCustom['list_data']['driverDescriptionsJS'] .= "driverDescriptions['" .AMI_Lib_String::jParse($name) ."'] = '" .AMI_Lib_String::jParse($description) .I12162; }}$this->browser->InitSQL( I12163, "FROM cms_pay_drivers ", "WHERE `name` != 'demo' " .$this->_ApplyFilters() .$this->TTTlIl1(), I12155, "position", "`id` ASC" );$aCustom[I12164] += Array( "id"=>Array("action"=>"callback", "object"=>&$this, I12165=>"_GetItemDataCB"), "name"=>Array("action"=>"stripline", I12166=>64), I12167=>Array("action"=>"flagicon", "value"=>1, "id"=>I12168, "on"=>$this->moduleName.I12169,"off"=>$this->moduleName.I12170), 'driver_description' => array( 'action' => I12171, 'object' => $this, 'method' => 'cbGetDriverDescription' ),"action_edit"=>Array(I12172=>"flagicon", "value"=>I12155, "id"=>"edit_id", I12173=>$this->moduleName."_list:edit","off"=>$this->moduleName.I12174), I12175=>Array(I12172=>"flagicon", "value"=>I12155, I12176=>I12177, I12173=>$this->moduleName.I12178,"off"=>$this->moduleName."_list:icon_none"), I12179=>Array(I12172=>"flagicon", "value"=>I12155, I12176=>I12180, I12173=>$this->moduleName.I12181,I12182=>$this->moduleName."_list:icon_none"), );$aCustom["applied_id"] =I12176; $aCustom["legend"] =Array("leg_blue", I12183, I12184, I12185, "leg_is_copied_on", "leg_edit", I12186, I12187); $vData += $this->itemData; if(empty($this->itemData['id'])){ $aCustom['list_data'][I12188] =TRUE; }else{ $this->cms->Gui->addBlock("pay_drivers_subform", "templates/pay_drivers_details.tpl"); $vData["fee_currencies"] =I12155; $sql ='select code from cms_es_currency'; $rs =$this->db->select($sql); while($aRecord =$rs->nextRecord()){ $aTmp =array( I12189 => $aRecord['code'], 'selected' => $this->itemData['fee_curr'] == $aRecord['code'] ?I12190 :I12160 );$vData["fee_currencies"] .= $this->cms->Gui->get($this->moduleName."_subform:currency_row", $aTmp); }}parent::TTTlI11($vData, $aCustom); }function _GetItemDataCB(&$aItem, &$aData) {$langFile =$this->llIlLL1 .$aItem[I12189] .'/' .'driver.lng'; if(is_file($langFile)){ $aLang =$this->cms->Gui->parseLangFile($langFile); if(isset($aLang[I12191])){ $aItem['header'] =$aLang[I12191]; }if(isset($aLang['driver_author'])){ $aItem['author'] =$aLang['driver_author']; }}if($aItem[I12192]) {$aItem[I12193] =1; }else{ $aItem[I12194] =1; $aItem[I12195] =1; }}function TTTllTT(&$vData) {if(!empty($this->itemData)) {$vData["form_header"] =$this->words['configuring'].' "'.$this->itemData['header'].I12196; }parent::TTTllTT($vData); }function TIll1II($cId, $cModule) {$llIlL11 =array(); $sql ='select id, name from cms_pay_drivers'; $this->db->query($sql); while($this->db->nextRecord()){ $llIlL11[$this->db->Record[I12189]] =$this->db->Record['id']; }require_once($GLOBALS["FUNC_INCLUDES_PATH"]."func_file_system.php"); $llIl1II =getDirFileList($this->llIlLL1, I12197, false, true); $llIl1Il =sizeof($llIl1II); for($i =0; $i <$llIl1Il; $i++){ if(isset($llIlL11[$llIl1II[$i]])){ unset($llIlL11[$llIl1II[$i]]); unset($llIl1II[$i]); continue; }if(!is_file($this->llIlLL1 .$llIl1II[$i] .'/driver.php')){ unset($llIl1II[$i]); }}if(sizeof($llIlL11) >0){ $llIl1IL =implode(',', $llIlL11); $sql ="DELETE FROM cms_pay_drivers WHERE id IN (".$llIl1IL.")"; $this->db->execute($sql); $deleted =$this->db->affected_rows(); if($deleted) {$this->cms->AddStatusMsg(I12198, I12160, I12160, I12160, array('cnt' => strval($deleted))); }}if(sizeof($llIl1II) >0){ foreach($llIl1II as $driver){ $aSql =array( I12192 => '0', I12189 => addslashes($driver), 'disabled_languages' => I12160, 'settings' => addslashes(serialize(array())), I12199 => '|=DATE()', );$sql =$this->db->GenInsertSQL('cms_pay_drivers', $aSql); $this->db->execute($sql); }$this->cms->AddStatusMsg('status_added', I12160, I12160, I12160, array('cnt' => sizeof($llIl1II), I12200 => implode(', ', $llIl1II))); }}function TIll1Il($cId, $cModule) {$sql ="SELECT name FROM cms_pay_drivers WHERE id='$cId' and is_installed=0"; $rec =$this->db->getRecord($sql); if(!empty($rec)) {if( is_file($this->llIlLL1 .$rec[I12189] .'/' .'driver.php') && is_file($this->llIlLL1 .$rec[I12189] .'/' .I12201) && is_file($this->llIlLL1 .$rec[I12189] .'/' .'driver.lng') ){$sql =I12202 .$cId .I12196; $this->db->query($sql); $this->cms->AddStatusMsg(I12203); }else {$this->cms->AddStatusMsg('status_no_driver', 'red', I12160, I12160); }}else {$this->cms->AddStatusMsg(I12204); }}function TIll1I1($cId, $cModule) {$sql ="SELECT name FROM cms_pay_drivers WHERE id='$cId' and is_installed=1"; $rec =$this->db->getRecord($sql); if(!empty($rec)) {$sql =I12205 .$cId .I12196; $this->db->query($sql); $this->cms->AddStatusMsg(I12206); }else {$this->cms->AddStatusMsg(I12207); }}function TTTl1Tl($cId, $cModule) {$sql ="SELECT * FROM cms_pay_drivers WHERE id='$cId'"; $rec =$this->db->getRecord($sql); if(!empty($rec)) {$langFile =$this->llIlLL1 .$rec[I12189] .I12208 .'driver.lng'; $llIl1I1 =$this->llIlLL1 .$rec[I12189] .I12208 .I12201; if(is_file($langFile) && is_file($llIl1I1)){ $this->cms->Gui->addBlock("pay_driver", $this->llIlL1I .$rec[I12189] .I12208 .I12201); $aLang =$this->cms->Gui->parseLangFile($langFile); if(isset($aLang[I12191])){ $aItem['header'] =$aLang[I12191]; }if(isset($aLang['driver_author'])){ $this->itemData[I12209] =$aLang['driver_author']; }$modId =$rec[I12189]; $this->itemData['id'] =$cId; $this->itemData[I12189] =$modId; $this->itemData['header'] =$aLang[I12191]; $this->itemData['fee_percent'] =htmlspecialchars($rec[I12210]); $this->itemData['fee_const'] =htmlspecialchars($rec['fee_const']); $this->itemData['fee_curr'] =$rec['fee_curr']; $llIl1lI =@unserialize($rec[I12211]); if(!is_array($llIl1lI)){ $llIl1lI =array(); }$llIl1lI =array_map('htmlspecialchars', $llIl1lI); $this->itemData['driver_form'] =$this->cms->Gui->get('pay_driver:settings_form', $llIl1lI, I12160, $aLang); $this->itemData['driver_description'] =$this->TIll1lT($modId); }}}function TTT1IlI($aSql =Array(), $cId =0) {$aSql[I12210] =addslashes(unhtmlentities($this->cms->VarsPost[I12212])); $aSql['fee_const'] =addslashes(unhtmlentities($this->cms->VarsPost["fee_const"])); $aSql['fee_curr'] =addslashes(unhtmlentities($this->cms->VarsPost["fee_curr"])); $aSettings =$this->cms->VarsPost; $llIl1ll =array(I12213, 'action', 'action_original', '_form_data', 'sort', I12214, 'sdim', 'enc_sdim', 'offset', 'enc_offset', I12215, 'enc_limit', 'flt_name', 'enc_flt_name', I12210, 'fee_const', I12216, 'check'); foreach($llIl1ll as $item){ unset($aSettings[$item]); }foreach($aSettings as &$value){ $value =stripslashes(unhtmlentities($value)); }$aSql[I12211] =addslashes(serialize($aSettings)); $aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function ruleGetAllowedDriversCB($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I ="getallvalues"){ switch($IIL1l1I){ case "getcaption": if($cData[I12189] == 'allowed_drivers'){ $llIl1lL =$this->llIlLL1 .$cData[I12217] .'/driver.lng'; if(is_file($llIl1lL)){ $Ill1ILI =$this->cms->Gui->parseLangFile($llIl1lL); return $Ill1ILI[I12191]; }}break; case "getallvalues": $llIl1l1 =array(); $sql ="SELECT `name` " ."FROM `cms_pay_drivers` " .I12218; $this->db->query($sql); while($this->db->next_record()){ $llIl1l1[] =$this->db->Record[I12189]; }$res =array( I12219 => RLT_ENUM_MULTI_STRING, "items_values" => $llIl1l1, "default_value" => array('stub', 'print'), I12220 => array(0, 1), "adding_allow" => 0 );break; case "getvalue": $res =$cData["value"]; break; case "correctvalue": $res =array(); break; case I12221: break; }return true; }function ruleGetAllowedDriversListCB($cData, $IIL1lL1, &$res, &$aData, $IIL1l1I ='getallvalues'){ switch($IIL1l1I) {case 'getallvalues': $res =array(); $sql ="SELECT `name` " ."FROM `cms_pay_drivers` " .I12218; $this->db->query($sql); while($this->db->next_record()){ $llIl1lL =$this->llIlLL1 .$this->db->Record[I12189] .I12222; if(is_file($llIl1lL)){ $Ill1ILI =$this->cms->Gui->parseLangFile($llIl1lL); $caption =$Ill1ILI[I12191]; }else{ continue; }$res[] =array (I12189 => $this->db->Record[I12189], 'caption' => $caption, I12190 => $this->db->Record[I12189] != $cData[I12217] ?I12160 :I12190 );}break; case 'correctvalue': $res =$cData[I12217]; break; case 'getvalue': $res =$cData[I12217]; break; }return true; }public function cbGetDriverDescription(&$aItem, &$aData){ $aItem['show_driver_info'] =isset($this->llIlL1l[$aItem[I12189]]); if($aItem[I12223]){ $aItem['name_js'] =AMI_Lib_String::jParse($aItem[I12189]); $aItem['header_js'] =AMI_Lib_String::jParse($aItem['header']); $aItem['info'] =$this->cms->Gui->getAbs($this->moduleName .I12224, $aItem); }}protected function TIll1lT($name){ static $llIl1LI; if(!is_array($llIl1LI)){ $path =AMI_Registry::get('path/hyper_local') .'declaration/pseudo.php'; $llIl1LI =file_exists($path) ?require($path) :array(); }foreach($llIl1LI as $aRecord){ if( FALSE !== mb_strpos($aRecord['pkgInfo'][I12213], $name) || FALSE !== mb_strpos($aRecord['pkgInfo'][I12225][0][I12226], $name) ){return isset($aRecord['pkgInfo']['information'][$this->cms->lang]) ?$aRecord['pkgInfo']['information'][$this->cms->lang][I12227] :$aRecord['pkgInfo']['information']['en'][I12227]; }}return NULL; }}