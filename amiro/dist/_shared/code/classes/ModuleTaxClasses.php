<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       15318 xkqwzsrtnlilpglmrymlytpuzmuzgznlnwrkmtygqrqxqzrlmpiyitwulzuyixxstwmypnir
 */ ?><?php foreach(array(13030=>'qDOHGzSIMn`GOG',13031=>"JZnP|SZtZ",13032=>"ZSS",13033=>"PrHuG|HGQrZtMHnD",13034=>"SZtQfrHI",13035=>"tQxt",13036=>"fJt|tZx|WJZDD|WHSQ",13037=>"nZIQ",13038=>"tZx|tBGQ",13039=>"coqRq?1?",13040=>'ZWtMHnD',13041=>'|wrQZtQzWtMHnD',13042=>'MD',13043=>"IQtOHS",13044=>"JQP|rQS",13045=>"fHrI|SZtZ",13046=>"GHGuG",13047=>"ZWtMHnD",13048=>"DMIGJQ",13049=>"YHSB|MtQID",13050=>"coqRq?MS='",13051=>"",13052=>"WOZrPQ",13053=>"tZx|WJZDD|WHSQ",13054=>"QSMt",13055=>"SMDGJZB%nHnQ^",13056=>"MS|tZx|WJZDD",13057=>"'",13058=>".",13059=>"HrSQr",13060=>'WOQWKQS',13061=>"tZx|WJZDD|tBGQ",13062=>'DQJQWtQS',13063=>"tZxQD|IHSuJQ|ZSSHn",13064=>"|DuYfHrI%tZxQD|IHSuJQ|ZSSHn",13065=>'MS|tZx|WJZDD',13066=>'nHn|tZxZYJQ',13067=>'tZx|WJZDD|tBGQ',13068=>"ZdEJ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleTaxClasses extends ModuleTaxes {public $oEshop; public $popup; function ModuleTaxClasses(&$cms, &$db, &$cModule) {parent::ModuleTaxes($cms, $db, $cModule); if ($this->cms->Core->Side == "admin") {require_once $GLOBALS['CLASSES_PATH'] .I13030; $this->oEshop =new EshopAdmin($this->cms, $this->words); $this->oEshop->init($this->moduleName); }else {CreateEshop($cms); $this->oEshop =&$cms->Eshop; }$this->cms->Gui->AddGlobalVars(array("TAX_SYSTEM" => $this->lllI1Ll)); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11 =array( "stop_use_sublinks" => false, I13031 => true, "check_public" => false, "use_modified_date" => false, "use_positions" => false, "allowed_actions" => array(I13032, "edit", "apply", "save", "del"), I13033 => array("del") );$aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {$this->popup =isset($this->cms->Vars["popup"]) ?intval($this->cms->Vars["popup"]) :0; parent::_InitAdmin(); }function TTTlITT($IIIL11l, $cId, $cModule ="") {parent::TTTlITT($IIIL11l, $cId, $cModule); }function GetHtml(&$aCustom) {return parent::GetHtml($aCustom); }function TTlTll1() {parent::TTlTll1(); }function TTTlIII() {parent::TTTlIII(); $this->filter->TITI1l1(I13034); $this->filter->TITI1l1("dateto"); $this->filter->AddField("popup", "hidden", $this->popup); $this->filter->AddField("flt_tax_class_code", I13035, stripslashes(unhtmlentities($this->cms->Vars["flt_tax_class_code"])), "", " like ", "tax_class_code"); $this->filter->MoveField(I13036,_MOVE_START); $this->filter->AddField("flt_name", I13035, stripslashes(unhtmlentities($this->cms->Vars["flt_name"])), "", " like ", I13037); $this->filter->MoveField("flt_name",_MOVE_START); }function _ApplyFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {$res =parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); return $res; }function &TTTlI1T(&$aCustom) {return parent::TTTlI1T($aCustom); }function TTTlI1I(&$vData) {parent::TTTlI1I($vData); $vData["type_options"] =$this->TIl1I11(I13038, "option_row", $this->lllI1LI, count($this->itemData) ?$this->itemData[I13038] :$this->cms->Vars[I13038], true); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL("id, is_default, name, tax_rate, tax_type, tax_class_code, tax_apply_type ", "FROM " .$this->module->GetTableName() ." m ", I13039.$this->_ApplyFilters().$this->TTTlIl1(), "", "is_default", "is_default asc" );$aCustom["fields"] += Array( I13040=>Array('action'=>'callback', 'object'=>&$this, 'method'=>I13041), 'is_default'=>Array('action'=>'flagicon', 'value'=>1, I13042=>'spec_act2_id', 'on'=>$this->moduleName.'_list:spec3_active_on','off'=>$this->moduleName.'_list:spec3_active_off'), 'type' => array ("action" => "callback", "object" => &$this, I13043 => "_getTaxTypeCB"), );$aCustom["applied_id"] ="id"; $aCustom["legend"] =Array(I13044, "leg_yellow", "leg_blue", "leg_edit", "leg_del"); $aCustom[I13045]["buttons"] =Array(I13032, "apply", "cancel", "save"); $vData[I13046] =$this->popup; parent::TTTlI11($vData, $aCustom); }function _CreateActions(&$aItem, &$aData) {$aItem["edit_id"] =$aItem["del_id"] =$aItem['id']; if ($aItem["is_default"] == 1) {$aItem[I13047] =$this->cms->Gui->get($this->moduleName.'_list:icons_edit_deloff', $aItem); $aItem[I13047] .= $this->cms->Gui->get($this->moduleName.'_list:icon_none', $aItem); }else {$aItem[I13047] =$this->cms->Gui->get($this->moduleName.'_list:icons_edit_del', $aItem); }if ($aItem["row_index"] == 1) {$style =$this->browser->style[I13048]; if ($aData["_num_rows"]%2) $style =$this->browser->style["even"]; $aData["style"] =$style; }}function &TTTllTl(&$aCustom) {return parent::TTTllTl($aCustom); }function TTTllTI(&$aCustom) {if($this->id >0) {$this->SetBodyType("body_itemD"); }elseif($this->id != -1) {$this->SetBodyType(I13049); $this->SetBodyType('body_urgent_items'); }parent::TTTllTI($aCustom); }function TTTlllT(&$vData) {parent::TTTlllT($vData); }function TTTll1T(&$vData, &$aCustom) {$aDefault =Array(); foreach($this->IIllIL1 as $IIlL1L1 => $tmp) {parent::TTTll1T($vData, $IIlL1Ll); }}function TTTll11($cId, $cModule) {parent::TTTll11($cId, $cModule); }function TTTl1Tl($cId, $cModule) {parent::TTTl1Tl($cId, $cModule); $sql ="SELECT * ". "FROM " .$this->module->GetTableName() ." ". I13050.$cId."'".$this->_ApplyFilters(); $this->db->query($sql); if($this->db->next_record()) {$this->itemData =$this->db->Record; $this->itemData["is_default"] =($this->itemData["is_default"] == 1) ?"checked": I13051; if ($this->itemData["tax_apply_type"] == 'detach') {$this->itemData["detach"] ="selected"; }else {$this->itemData[I13052] ="selected"; }}}function TTTl1T1($cId, $cModule) {parent::TTTl1T1($cId, $cModule); }function _ActionDel($cId, $cModule) {parent::_ActionDel($cId, $cModule); }function TTTl1I1(&$aGroupIds, $cModule) {$index =array_search($this->lllI1lL, $aGroupIds); if ($index !== false) {unset($aGroupIds[$index]); }parent::TTTl1I1($aGroupIds, $cModule); }function TTTl1lI($cId, $cModule) {parent::TTTl1lI($cId, $cModule); }function TTT1IlI($aSql =Array(), $cId =0) {$name =$this->cms->VarsPost[I13037]; $tax_class_code =$this->cms->VarsPost["tax_class_code"]; $tax_rate =floatval($this->cms->VarsPost["tax_rate"]); $tax_type =$this->cms->VarsPost[I13038]; $tax_apply_type =$this->cms->VarsPost["tax_apply_type"]; if ($name != I13051) {$aSql =Array( I13037 => $name, I13053 => $tax_class_code, "tax_rate" => $tax_rate, I13038 => $tax_type, "tax_apply_type" => $tax_apply_type );}$aSql =parent::TTT1IlI($aSql, $cId); return $aSql; }function _GetDetailsLinkCB(&$aItem, &$aData) {if(!empty($aItem["body"])) {$aItem["details_link"] =1; }}function TTT1lTl($IILIIl1, &$IILIILI, &$vData, &$IILIILl) {parent::TTT1lTl($IILIIl1, $IILIILI, $vData, $IILIILl); }function TIl1I1I($obj, $action, &$vData, $aItemData =array()) {$I1LLLlL =array(); if ($action == I13054 && $aItemData["tax_class_type"] != 'non_taxable') {}else {$I1LLLlL['tax_show_style'] =$vData['tax_show_style'] =I13055; }$mModule =&$this->cms->Core->GetModule($this->oEshop->ownerName ."_tax_classes"); $vData["tax_classes_link"] =$I1LLLlL["tax_classes_link"] =$mModule->GetAdminLink(); $lllI1I1 =isset($aItemData["id_tax_class"]) ?$aItemData[I13056] :($action == I13054 && isset($this->cms->Vars[I13056]) ?$this->cms->Vars[I13056] :0); $sql ="SELECT `id`, `name` " ."FROM `" .$this->oEshop->dbTablePrefix ."_tax_classes` " ."WHERE `id` = '" .$lllI1I1 .I13057; if ($lllI1I1 >0 && $this->db->query($sql) && $this->db->next_record()) {$I1LLLlL[I13056] =$lllI1I1 =$this->db->Record["id"]; }else {$I1LLLlL[I13056] =$aItemData[I13056] =$lllI1I1 =0; }$I1LLLll =array( "select" => "`id`, `name`", "from" => I13058 .$this->oEshop->dbTablePrefix ."_tax_classes`", "where" => "`lang` = '" .$this->langData ."' ", I13059 => I13058 .I13037 .I13058 );if ($lllI1I1 >0) {$I1LLLll["selectedCondition"] ="`id` = " .$lllI1I1; }$aCustom =array( "ctrl_field_name" => I13056, "ctrl_field_value" => $lllI1I1, "ctrl_field_name_select" => "id_tax_class_select", "tpl_list_postfix" => "list_ctrl_tax_classes_list" );$I1LLLlL["tax_classes_ctrl"] =$obj->TIIIT1I("show_tax_classes_in_admin", $I1LLLll, $aCustom +$I1LLLlL); if ($action == I13054 && (isset($aItemData["tax_class_type"]) && $aItemData["tax_class_type"] == 'taxable_excl')) {$vData['tax_excl_selected'] =I13060; }else {$I1LLLlL['tax_class_selected'] =I13060; }if ($obj->I1LLlIl) {$I1LLLlL["tax_class_radio"] =$this->cms->Gui->get($obj->moduleName."_subform:tax_class_radio", $I1LLLlL); $vData["TAX_EXCLUSIVE"] =$this->cms->Gui->get($obj->moduleName."_subform:TAX_EXCLUSIVE", $vData); }if ($obj->I1LLlIL) {$vData["tax_save_options"] =$this->cms->Gui->get($obj->moduleName."_subform:tax_save_options", $vData); }$vData["TAX_CLASS"] =$this->cms->Gui->get($obj->moduleName."_subform:TAX_CLASS", $I1LLLlL); if ($action == I13054) {if ($aItemData[I13061] == 'non_taxable') {$vData["tax_class_type_non_taxable"] ='selected'; }else {$vData["tax_class_type_taxable"] =I13062; }$vData["CHOOSE_TAX_CLASS_TYPE"] =$this->cms->Gui->get($obj->moduleName."_subform:CHOOSE_TAX_CLASS_TYPE", $vData); }else {$vData["tax_class_type_non_taxable"] =I13062; $vData["CHOOSE_TAX_CLASS_TYPE"] =$this->cms->Gui->get($obj->moduleName."_subform:CHOOSE_TAX_CLASS_TYPE", $vData); }$vData[I13063] =$this->cms->Gui->get($obj->moduleName.I13064, $vData); }function TIl1I1l($action, $ILLIIII, $aSql =array(), $cId =0) {$res["aSql"] =$aSql; $id_tax_class =0; if (isset($ILLIIII['id_tax_class']) && intval($ILLIIII['id_tax_class'])) {$id_tax_class =intval($ILLIIII['id_tax_class']); }elseif (isset($ILLIIII['id_tax_class_select']) && intval($ILLIIII['id_tax_class_select'])) {$id_tax_class =intval($ILLIIII['id_tax_class_select']); }if(!empty($ILLIIII['tax_class_type'])){ $res["aSql"][I13065] =0; if ($ILLIIII['tax_class_type'] == 'non_taxable') {$res["aSql"]['tax_class_type'] =I13066; }else {if ((!isset($ILLIIII['taxable_type']) || $ILLIIII['taxable_type'] == 'taxable_class') && $id_tax_class) {$res["aSql"][I13067] ='taxable_class'; $res["aSql"][I13065] =$id_tax_class; }elseif ($ILLIIII['taxable_type'] == 'taxable_excl') {$res[I13068][I13067] ='taxable_excl'; }else {$res[I13068][I13067] ='taxable'; }}}return $res; }}