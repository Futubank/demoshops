<?php /**
 * @author     Alexey Maximov <maximov@amiro.ru> 
 * @version    1.0. Last changes: 23/07/2008 by Alexey Maximov 
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @size       20975 xkqwwximnmsiingqpknlnlpksnuxnisqggpmkyxqxpsstqtsqknkyrqizgnmqzsnmqktpnir
 */ ?><?php foreach(array(13108=>"PrHuG|HGQrZtMHnD",13109=>"nZIQ|fMQJS|nZIQ",13110=>"fJt|IHSuJQ",13111=>"GJ|IHSuJQD",13112=>'?%%?',13113=>'SZtQfrHI',13114=>'fJt|IHSuJQ',13115=>'nQCD',13116=>"IHSuJQ",13117=>'WHnf|StMIQ',13118=>"GJ|QnPMnQ|GZrZID",13119=>"WHnfMP|MD|QIGtB",13120=>"FRhi?WID|",13121=>"?I?jqFT?lhmN?WID|trZnDJZtHr?t?hN?}I`MS?=?t`MS|MnnQr?zNs?t`IHSuJQ|nZIQ?=?'",13122=>"I`SZtQ?SQDW",13123=>'t',13124=>"vZJuQ",13125=>"Hff",13126=>"DMAQ",13127=>"I`MS",13128=>"fHrI|SZtZ",13129=>'YHSB|urPQnt|MtQID',13130=>'jl',13131=>"uDQr=",13132=>"",13133=>"rQS",13134=>"RhhT|gzTo|ccc",13135=>"DuYJMnK",13136=>"nZv|SZtZ",13137=>'ZnnHunWQ',13138=>'fMQJSD',13139=>'YHSB',13140=>"DMPnZturQ",13141=>'uGSZtQ|GZPQ',13142=>"]",13143=>"GHDttH=LHurnZJ]",13144=>"I~S~b",13145=>"o%M",13146=>"WuDtHI|tMIQ=0]",13147=>'uGSZtQ|ZWt',13148=>"uDQr=]",13149=>'SZtQ|tD',13150=>"DuYLQWt=",13151=>'',13152=>"DtZtuD|PrG|GuYJMDO",13153=>'LZvZDWrMGt',13154=>"OrQf='",13155=>"DrW='") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleTranslator extends CMS_ActModule {public $llI1l1L; public $I1LlLlI; public $lllI1L1; function TIl1lTl(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$this->lllI1L1 =false; $IIIIL11[I13108] =Array("publish_on", "publish_backdated_on"); $IIIIL11["use_id_page"] =true; $IIIIL11["use_options_form"] =true; $IIIIL11[I13109] ="header"; $IIIIL11["description_field_name"] ="body"; $aOptions += $IIIIL11; if (!empty($this->cms->VarsPost[I13110])) {$this->llI1l1L =$this->cms->VarsPost[I13110]; }elseif (!empty($this->cms->VarsGet[I13110])) {$this->llI1l1L =$this->cms->VarsGet[I13110]; }else {$this->llI1l1L ='news'; }parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin() {parent::_InitAdmin(); $this->I1LlLlI =array(); $this->I1LlLI1 =$this->module->GetProperty(I13111); foreach ($this->I1LlLI1 as $index => $name) {if ($this->cms->Core->IsInstalled($name)) {$aCaption =array(); $tmpMod =&$this->cms->Core->GetModule($name); $aCaption[] =$this->cms->GetModHeader($tmpMod); $this->I1LlLlI[$name] =implode(I13112, $aCaption); }else {unset($this->I1LlLI1[$index]); }}}function TTTlITT($IIIL11l, $cId, $cModule ="") {if ($IIIL11l == 'grp_publish_backdated_on') {$this->lllI1L1 =true; $IIIL11l ='grp_publish_on'; $aGroupIds =$this->TTTlT11($this->cms->Vars["_grp_ids"]); $this->TTTl1l1($aGroupIds, $cModule); }else {parent::TTTlITT($IIIL11l, $cId, $cModule); }}function GetHtml(&$aCustom) {return parent::GetHtml($aCustom); }function TTlTll1() {parent::TTlTll1(); }function TTTlIII() {parent::TTTlIII(); $this->filter->UpdateFieldDBName(I13113, 'm.date'); $this->filter->UpdateFieldDBName('dateto', 'm.date'); $aModules =array(); foreach ($this->I1LlLlI as $name => $caption) {$aModules =$this->filter->TITI1TT($aModules, array($caption => $name), 45, false); }$this->filter->AddField(I13114, 'select', $this->llI1l1L, I13115, '=', I13116, $aModules); $this->filter->MoveField(I13110,_MOVE_START); $this->filter->DisableFieldSQL(I13114); }function _ApplyFilters($prefix ='', $bodyType ='', $IIlLLl1 =true) {return parent::_ApplyFilters($prefix, $bodyType, $IIlLLl1); }function &TTTlI1T(&$aCustom) {return parent::TTTlI1T($aCustom); }function TTTlI1I(&$vData) {$udate =DateTools::getCorrectUDate($this->itemData['date'], $this->cms->DFMT[I13117]); $vData['ftime'] =date($this->cms->DFMT['php_time'], $udate); parent::TTTlI1I($vData); }function TTTlI11(&$vData, &$aCustom) {$vData["config_is_empty"] ="0"; $aEngineParams =$this->module->GetProperty(I13118); if(!$aEngineParams['LJ']['login'] || !$aEngineParams['LJ']['password']){ $vData[I13119] ="1"; }$this->browser->InitSQL( "m.id, m.header, m.announce, m.date, date_format(m.date,'".$this->cms->DFMT["db"]."') as fdate, IF(t.id>0,1,0) AS published, t.id_outer ", I13120 .$this->llI1l1L .I13121.$this->llI1l1L."') ", "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), "", "date", I13122, array("published" => "t.id") );$this->browser->AddSQLJoinedTables($this->cms->Core, 'm', array("cms_translator" => I13123)); $aCustom["fields"] += Array( "published"=>Array("action"=>"flagicon", I13124=>1, "id"=>"pub_id", "on"=>$this->moduleName."_list:published_on",I13125=>$this->moduleName."_list:published_off"), "header"=>Array("action"=>"stripline", I13126=>25), "announce"=>Array("action"=>"stripline", I13126=>250) );$aCustom["applied_id"] =I13127; $aCustom["legend"] =Array("published", "notpublished", "leg_red"); $aCustom[I13128]["buttons"] =Array("add"); parent::TTTlI11($vData, $aCustom); }function TTTllTI(&$aCustom) {if($this->id >0) {$this->SetBodyType("body_itemD"); }elseif($this->id != -1) {$this->SetBodyType("body_items"); $this->SetBodyType(I13129); }parent::TTTllTI($aCustom); }function TTTll11($cId, $cModule) {parent::TTTll11($cId, $cModule); }function TTTl1T1($cId, $cModule) {parent::TTTl1T1($cId, $cModule); }function _ActionDel($cId, $cModule) {parent::_ActionDel($cId, $cModule); }function TTTl1lI($cId, $cModule) {parent::TTTl1lI($cId, $cModule); }function TTTl1l1(&$aGroupIds, $cModule) {global $lang_data; $lllI11I ='UTF-8'; $aEngineParams =$this->module->GetProperty(I13118); $lllI11l =false; $IIl1lIl =0; $sql ="SELECT m.*, UNIX_TIMESTAMP(m.date) AS date_ts, DATE_FORMAT(m.date, '%c') AS date_month, DATE_FORMAT(m.date, '%e') AS date_day, DATE_FORMAT(m.date, '%Y') AS date_year, DATE_FORMAT(m.date, '%H') AS date_hour, DATE_FORMAT(m.date, '%i') AS date_min, t.id AS trans_id, t.id_outer FROM cms_".$this->llI1l1L.I13121.$this->llI1l1L."') WHERE m.id IN (".implode(',', $aGroupIds).") ORDER BY m.date ASC"; $this->db->query($sql); $tmpMod =&$this->cms->Core->GetModule($this->llI1l1L); require_once $GLOBALS['CLASSES_PATH'] .'CMS_HTTPRequest.php'; $lllI11L =new CMS_HTTPRequest(); while ($this->db->next_record()) {set_time_limit(29); print ' '; $lllI111 =$this->db->Record["id"]; $llllIII =$this->db->Record[$aEngineParams[I13130]['fields']['subject']]; if(!$lllI11l){ $llllIIl =$lllI11L->httpRequest($aEngineParams[I13130]['login_page'], true, true); if(preg_match("/\<input.+name\=\'user\'.+id\=\'user\'.+\/\>/i", $llllIIl, $matches)){ $postFields =I13131.$aEngineParams[I13130]['login']."&". "password=".$aEngineParams[I13130]['password'].I13132; $lllI11L->httpRequest($aEngineParams[I13130]['login_act'], true, true, $postFields); $llllIIL =$lllI11L->httpRequest('http://www.livejournal.com/', true, true); if(preg_match("/http\:.*?livejournal\.com\/logout\.bml/", $llllIIL)){ $lllI11l =true; }else{ $this->cms->AddStatusMsg("status_err_login", I13133, I13132, I13132, array()); $this->IIllIll =0; $this->aGroupIds =array(); unset($this->cms->VarsGet["_grp_ids"]); $this->appliedId =I13132; return; }}}if ($lllI11l) {$llllII1 =$this->db->Record; $llllII1['www_root'] =$GLOBALS["ROOT_PATH_WWW"]; $llllII1['front_link'] =$GLOBALS[I13134].$tmpMod->GetFrontLink(); $this->cms->InitNavSettings($this->llI1l1L); $aNavData =array(); $vItem =array(); $vItem += $this->cms->ApplyNav($aNavData); unset($vItem["nav_data"]); $aNavData["id"] =$this->db->Record["id"]; $aNavData["id_sublink"] =$this->db->Record[I13135]; $vItem += $this->cms->ApplyNav($aNavData); if ($tmpMod->GetFrontLink()) {$llllII1['item_link'] =$GLOBALS[I13134].$tmpMod->GetFrontLink().$vItem["nav_data"]; }else {$llllII1['item_link'] =trim($GLOBALS[I13134], "/").$vItem[I13136]; }$llllII1['item_link'] =trim($llllII1['item_link'], "?"); $llllII1['announce'] =preg_replace("/<a\s*.*href\s*\=\s*[\"\']javascript[^>]+>.*?<\/a>/is", I13132, $this->db->Record['announce']); $llllII1['announce'] =preg_replace_callback("/href\s*\=\s*[\"\']([^\"\']+)[\"\']/is", array(&$this, '_fixLinks'), $llllII1[I13137]); $llllII1[I13137] =preg_replace_callback("/src\s*\=\s*[\"\']([^\"\']+)[\"\']/is", array(&$this, '_fixImages'), $llllII1[I13137]); $llllII1['body'] =preg_replace("/<a\s*.*href\s*\=\s*[\"\']javascript[^>]+>.*?<\/a>/is", I13132, $this->db->Record[$aEngineParams[I13130][I13138]['event']]); $llllII1['body'] =preg_replace_callback("/href\s*\=\s*[\"\']([^\"\']+)[\"\']/is", array(&$this, '_fixLinks'), $llllII1[I13139]); $llllII1[I13139] =preg_replace_callback("/src\s*\=\s*[\"\']([^\"\']+)[\"\']/is", array(&$this, '_fixImages'), $llllII1[I13139]); $llllII1['lj_cut_text'] =$aEngineParams[I13130]['lj_cut_text']; $this->cms->Gui->addBlock(I13140, '_local/_admin/templates/translator_sign.tpl'); $llllIlI =$this->cms->Gui->getAbs("signature:body", $llllII1); if (intval($this->db->Record["trans_id"]) && mb_strlen($this->db->Record["id_outer"])) {$llllIll =$aEngineParams[I13130][I13141]. "?journal=".urlencode($aEngineParams[I13130]['login']). "&itemid=".$this->db->Record["id_outer"]; $llllIlL =$lllI11L->httpRequest($llllIll, true, true); if(preg_match('/name\=\"lj_form_auth\"\s*value=\"([^\"]+)\"/i', $llllIlL, $llllIl1)){ $llllILI =$llllIl1[1]; $postFields ="lj_form_auth=".urlencode($llllILI)."&". "itemid=".$this->db->Record["id_outer"].I13142. "mode=edit".I13142. "edited=1".I13142. "rte_on=1&". "postas=remote&". I13143. "altcommunity=&". "user=&". "password=&". "date=".urlencode(($this->lllI1L1 ?date(I13144, $this->db->Record['date_ts']) :date(I13144))).I13142. "time=".urlencode(($this->lllI1L1 ?date("H:i", $this->db->Record['date_ts']) :date(I13145))).I13142. "date_diff=1&". "date_format=".urlencode('%M/%D/%Y').'&'. I13146. "subject=".urlencode($llllIII).I13142. "body=".urlencode($llllIlI).I13142. "prop_picture_keyword=&". "prop_taglist=&". "prop_current_moodid=&". "prop_current_mood=&". "prop_current_music=&". "prop_current_location=&". "prop_adult_content=default&". "comment_settings=default&". "prop_opt_screening=&". "security=public&". "prop_opt_backdated=".($this->lllI1L1 ?1 :0).I13142. "action%3Asave=1"; $llllILl =$lllI11L->httpRequest($aEngineParams[I13130][I13147], true, true, $postFields); $IIl1lIl += 1; $sql ="UPDATE cms_translator SET date_update = NOW() WHERE id = '".intval($this->db->Record["trans_id"])."'"; $this->db->execute($sql); }}else {$llllILL =$lllI11L->httpRequest($aEngineParams[I13130]['post_page'], true, true); if(preg_match('/name\=\"lj_form_auth\"\s*value=\"([^\"]+)\"/i', $llllILL, $llllIl1)){ $llllILI =$llllIl1[1]; $postFields ="lj_form_auth=".urlencode($llllILI).I13142. "rte_on=1&". "postas=remote&". I13143. "altcommunity=&". I13148. "password=&". "date=".urlencode(($this->lllI1L1 ?date(I13144, $this->db->Record['date_ts']) :date(I13144))).I13142. "time=".urlencode(($this->lllI1L1 ?date(I13145, $this->db->Record[I13149]) :date(I13145))).I13142. "date_diff=1&". "date_format=".urlencode('%M/%D/%Y').'&'. I13146. I13150.urlencode($llllIII).I13142. "body=".urlencode($llllIlI).I13142. "prop_picture_keyword=&". "prop_taglist=&". "prop_current_moodid=&". "prop_current_mood=&". "prop_current_music=&". "prop_current_location=&". "prop_adult_content=default&". "comment_settings=default&". "prop_opt_screening=&". "security=public&". "prop_opt_backdated=".($this->lllI1L1 ?1 :0).I13142. "action%3Aupdate=1"; $llllILl =$lllI11L->httpRequest($aEngineParams[I13130]['post_act'], true, true, $postFields); $llllIL1 =I13151; $llllI1I =mb_strpos($llllILl, 'name="itemid"'); if($llllI1I !== false){ $llllIL1 =mb_substr($llllILl, $llllI1I ,100); $llllIL1 =str_replace('\\', I13151, $llllIL1); }if(preg_match('/itemid\"\s*value=\"([^\"]+)\"/is', $llllIL1, $matches)){ $llllI1l =intval($matches[1]); $sql ="INSERT INTO cms_translator (id_inner, id_outer, date, module_name) VALUES ('$lllI111', '$llllI1l', NOW(), '".$this->llI1l1L."')"; $this->db->execute($sql); $IIl1lIl += 1; }}}}usleep(500000); }if ($lllI11L) {$lllI11L->TTI1ITl(); }$this->IIllIll =$IIl1lIl; $this->cms->AddStatusMsg(I13152, "blue", I13132, I13132, Array("num_items" => $IIl1lIl.I13132)); $this->aGroupIds =Array(); unset($this->cms->VarsGet["_grp_ids"]); $this->appliedId =I13132; }function _fixLinks($matches) {if ((mb_substr($matches[1], 0, 7) != 'http://') && (mb_substr(mb_strtolower($matches[1]), 0, 10) != I13153)) {if (mb_substr($matches[1], 0, 1) != '/') {$llllI1L =$GLOBALS[I13134]; }else {$llllI1L =trim($GLOBALS[I13134], "/"); }return "href='".$llllI1L.$matches[1]."'"; }else {return I13154.$matches[1]."'"; }}function _fixImages($matches) {if ((mb_substr($matches[1], 0, 7) != 'http://') && (mb_substr(mb_strtolower($matches[1]), 0, 10) != I13153)) {if (mb_substr($matches[1], 0, 1) != '/') {$llllI1L =$GLOBALS[I13134]; }else {$llllI1L =trim($GLOBALS[I13134], "/"); }return I13155.$llllI1L.$matches[1]."'"; }else {return I13155.$matches[1]."'"; }}}?>