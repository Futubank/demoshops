<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    core 
 * @version    $Id$ 
 * @size       5981 xkqwprlnsrplipyxkzgwllmlinpuggxlysugityymsnznkpzkwtsrtkqgwgryxsxytxipnir
 */ ?><?php foreach(array(13156=>'JZnP|SZtZ',13157=>'fJt|Qxt|IHSuJQ',13158=>"SZtQ",13159=>'YJHP',13160=>"fHruI",13161=>"PuQDtYHHK",13162=>"fQQSYZWK",13163=>"Qxt|IHSuJQ",13164=>"",13165=>'|vZJMSZtQiHSuJQmnDtZJJZtMHn',13166=>"nH",13167=>"MnvZJMS|WZGtWOZ",13168=>"rQZDHn",13169=>"'{?.fSZtQ.!?.Qxt|IHSuJQ.!?mNqT|NThz}MG{?.MG.!?.vMS.!?.MD|PQnQrZtQS.!?.DQDDMHn.!?.tCMDt.!?.rQZDHn.?",13170=>".SZtQ.",13171=>"WZJJYZWK",13172=>"MD|PQnQrZtQS",13173=>'BQD',13174=>"ZJJ") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class ModuleTwistPrevention extends CMS_ActModule {public $_filter; function ModuleTwistPrevention(&$cms, &$db, &$cModule) {parent::CMS_ActModule($cms, $db, $cModule); }function _Init($IIll1l1 =Array(), $IIll1LI ="", $IIll1Ll ="", $aOptions =Array()) {$IIIIL11[I13156] =false; $aOptions += $IIIIL11; parent::_Init($IIll1l1, $IIll1LI, $IIll1Ll, $aOptions); }function _InitAdmin(){ parent::_InitAdmin(); $this->_filter =array(); foreach(array(I13157, 'flt_twist', 'flt_is_generated', 'flt_reason') as $field){ $this->_filter[$field] =isset($this->cms->Vars[$field]) ?$this->cms->Vars[$field] :null; }}function TTTlIII() {parent::TTTlIII(); $this->filter->UpdateFieldDBName("datefrom", I13158); $this->filter->UpdateFieldDBName("dateto", I13158); $aData =array ("news" => "news", 'blog' => I13159, "articles" => "articles", "photoalbum" => "photoalbum", I13160 => I13160, "faq" => "faq", "votes" => "votes", I13161 => I13161, "members" => "members", "subscribe" => "subscribe", I13162 => I13162, "adv_advertisers" => "adv_advertisers", "jobs_employer" => "jobs_employer" );$this->TIII1lI(I13163, $aData, 50, I13164, I13165); $aData =array ("yes" => 1, "no" => 0 );$this->TIII1lI("twist", $aData, 50, I13164); $aData =array ("yes" => 1, I13166 => 0 );$this->TIII1lI("is_generated", $aData, 50, I13164); $aData =array ("no_cookies" => "no_cookies", "invalid_captcha" => I13167, "too_frequently" => "too_frequently", "no_javascript" => "no_javascript" );$this->TIII1lI(I13168, $aData, 50, I13164); }function TTTlI11(&$vData, &$aCustom) {$this->browser->InitSQL( "`id`, date_format(date,'".$this->cms->DFMT["db_dtime"].I13169, "FROM `cms_twist_prevention`", "WHERE 1 ".$this->_ApplyFilters().$this->TTTlIl1(), I13164, I13170, "`date` desc" );$aCustom["fields"] += Array ("fdate"=>Array("action"=>I13171, "object"=>&$this, "method"=>"_RowCB") );parent::TTTlI11($vData, $aCustom); }function _RowCB(&$vItem, &$vData) {if (isset($this->words[$vItem[I13163]])) {$vItem[I13163] =$this->words[$vItem[I13163]]; }$vItem["is_generated"] =$this->words[$vItem[I13172] ?'yes' :'no']; $vItem["twist"] =$this->words[$vItem["twist"] ?I13173 :'no']; $vItem[I13168] =isset($this->words[$vItem[I13168]]) ?$this->words[$vItem[I13168]] :''; }function TIII1lI($fieldName, $aData, $lIIIIll, $default =null, $methodName ='') {$IILLLL1 ="flt_" .$fieldName; $aSelect =array ();if (!is_null($default)) {$aSelect =$this->filter->TITI1TT($aSelect, Array($this->cms->Words[I13174] => $default)); }foreach ($aData as $word => $value) {if ($methodName != '' && !$this->$methodName($value)) {continue; }$aSelect =$this->filter->TITI1TT( $aSelect, array ($this->words[$word] => $value), $lIIIIll );}$this->filter->AddField( $IILLLL1, "select", $this->_filter[$IILLLL1], I13164, "=", $fieldName, $aSelect );$this->filter->MoveField($IILLLL1, _MOVE_PREV); if (!is_null($default) && $this->_filter[$IILLLL1] == $default) {$this->filter->DisableFieldSQL($IILLLL1); }}function _validateModuleInstallation($value) {return $this->cms->Core->IsInstalled($value); }}