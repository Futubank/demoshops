<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       46664 xkqwplkyyyrtyznrpquigltqlzlxntynggsmwxyxlmtptrktmktqklirluxlrzklygxzpnir
 */ ?><?php foreach(array(14304=>"|QIGtB",14305=>"",14306=>"PQtzJJwOMJSD",14307=>"PQtzJJgZrQntDwy",14308=>"PQtgZtOwy",14309=>"!",14310=>"`",14311=>"QnZYJQ",14312=>"MnSQx",14313=>"?zNs?",14314=>"JQvQJ",14315=>"|WOMJSDzrrZB",14316=>"GMS",14317=>"'!'",14318=>"ZffQWtQS|rHCD",14319=>"MS?mN}",14320=>"MtQI|nZIQ",14321=>"PQtNHSQ",14322=>"'",14323=>"PQtzJJwOMJSDFJt",14324=>"MD|JQZf",14325=>"|PQtmSDjMDtwy",14326=>"PQtzJJgZrQntD",14327=>"MS",14328=>"GZtO",14329=>"PQtgZtO",14330=>"sqjqTq?FRhi?",14331=>"]nYDG^",14332=>"~#Y@",14333=>"MS!?",14334=>"?FRhi?",14335=>"LHMn",14336=>"HrSQr|YB",14337=>"?hRsqR?yb?") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class TreeModel {public $cms; public $db; public $ll1lLI1; public $ll1lLlI; public $ll1lLll; public $ll1lLlL; public $ll1lLl1; public $ll1lLLI; public $ll1lLLl; public $ll1lLLL; public $ll1lLL1; public $ll1lL1I; public $ll1lL1l; public $ll1lL1L; public $ll1lL11; public $ll1l1II; public $ll1l1Il; public $ll1l1IL; public $ll1l1I1; public $ll1l1lI; public $ll1l1ll; public $ll1l1lL; public $ll1l1l1; public $ll1l1LI; public $ll1l1Ll; public $ll1l1LL; public $ll1l1L1; public $ll1l11I; public $ll1l11l; public $ll1l11L; public $ll1l111; public $ll1LIII; public $ll1LIIl; public $ll1LIIL; public $ILlL1ll; public $ILlL1lL; public $ll1LII1; public $ll1LIlI; public $ll1LIll; public $ll1LIlL; public $ll1LIl1; public $ll1LILI; public $ll1LILl; public $ll1LILL; public $ll1LIL1; function TreeModel(&$cms){ $this->db =new DB_si; $this->cms =&$cms; $this->ll1lLI1 =""; $this->ll1lLlI =""; $this->ll1lLll =0; $this->ll1lLlL =0; $this->ll1lLl1 =Array(I14304=>""); $this->ll1lLLI =""; $this->ll1l1LL =""; $this->ll1l11I =""; $this->ll1l11l =I14305; $this->ll1l11L =I14305; $this->ll1l111 =I14305; $this->ll1l1L1 =I14305; $this->ll1LIII =I14305; $this->ll1LIIl =I14305; $this->ll1lLLl =Array(); $this->ll1lLLL =I14305; $this->ll1lL1L =Array(); $this->ll1lL11 =false; $this->ll1l1II =false; $this->ll1l1Il =false; $this->ll1l1IL =false; $this->ll1l1I1 =true; $this->ll1l1lI =true; $this->ll1l1ll =true; $this->ll1l1l1 =true; $this->ll1l1LI =true; $this->ll1l1Ll =false; $this->ll1lLL1 =I14305; $this->ll1lL1I =I14305; $this->ll1lL1l =I14305; $this->ll1LIIL =I14305; $this->ILlL1ll =&$this; $this->ILlL1lL =Array( "getChildsFlt"=>"getChildsFltCB", "getAllChildsFlt"=>"getAllChildsFltCB", I14306=>"getAllChildsCB", "getParent"=>"getParentCB", "getAllParents"=>I14307, "getNode"=>"getNodeCB", "searchNode"=>"searchNodeCB", "createChildsArrayFlt"=>"createChildsArrayFltCB", "buildTreeOnChildsArray"=>"buildTreeOnChildsArrayCB", "getPath"=>I14308, "filterChildBranch" => "_getAllChildrenCB" );$this->ll1LIll =I14305; $this->ll1LIlL =Array(); $this->ll1LIl1 =I14305; $this->ll1LIL1 =Array(); }function TI11ITl($tableName, $ll1lLlI) {$this->ll1lLI1 =$tableName; $this->ll1lLlI =$ll1lLlI; }function TI11IT1($ll1lLll, $ll1lLlL =0) {$this->ll1lLll =$ll1lLll; $this->ll1lLlL =$ll1lLlL; }function TI11IIT($ll1LI1I, $fields) {if($fields != I14305 && $ll1LI1I !=I14305) {$this->ll1lLl1[$ll1LI1I] =",".$fields; }}function TI11III($ll1LI1I, $fields) {if($fields != I14305 && $ll1LI1I !=I14305) {if(empty($this->ll1lLl1[$ll1LI1I])) $this->ll1lLl1[$ll1LI1I] =",".$fields; else $this->ll1lLl1[$ll1LI1I] .= I14309.$fields; }}function setCallbackObject(&$object) {if(is_object($object)) {$this->ILlL1ll =&$object; }}function setCallbackMethod($ILl1llL, $ILl1ll1) {if($ILl1llL != I14305 && $ILl1ll1 != I14305) {$this->ILlL1lL[$ILl1llL] =$ILl1ll1; }}function addJoinedTable($tableAlias, $ll1LI1l, $IIl1LLl =I14305, $ll1LI1L =I14305, $ll1LI11 =I14305) {if($ll1LI1l != I14305 && $tableAlias != I14305) {$this->ll1lL1L[$tableAlias] =Array( "join" => $ll1LI1l, "where" => $IIl1LLl, "group_by" => $ll1LI1L, "order_by" => $ll1LI11 );$this->TlTTTTl(); $this->ll1l1Ll =true; }}function TI11IIl($tableAlias) {if($tableAlias != I14305 && isset($this->ll1lL1L[$tableAlias])) {$this->TlTTTTl(); $this->ll1l1Ll =true; unset($this->ll1lL1L[$tableAlias]); }}function TI11II1() {if(!$this->ll1l1IL) {$this->ll1l1IL =true; $this->ll1l1Ll =true; $this->TlTTTTl(); }}function TI11IlT() {if($this->ll1l1IL) {$this->ll1l1IL =false; $this->ll1l1Ll =true; $this->TlTTTTl(); }}function setMainTableAlias($prefix) {if(!empty($prefix)) {$this->ll1LIIL =$prefix.I14310; }}function addFilter($name, $value, $enable =true) {if($name != I14305 && $value != I14305) {$this->ll1lLLl[$name] =Array("val"=>$value, "enable"=>$enable); $this->ll1l1I1 =$enable; }}function TI11IlI($name, $value, $enable =true) {if($name != I14305 && $value != I14305) {$this->ll1lLLl =Array("val"=>$value, "enable"=>$enable) +$this->ll1lLLl; $this->ll1l1I1 =$enable; }}function TI11Ill($name) {if(isset($this->ll1lLLl[$name]) && !$this->ll1lLLl[$name][I14311]) {$this->ll1l1I1 =true; $this->ll1lLLl[$name][I14311] =true; }}function TI11Il1($name) {if(isset($this->ll1lLLl[$name]) && $this->ll1lLLl[$name][I14311]) {$this->ll1l1I1 =true; $this->ll1lLLl[$name][I14311] =false; }}function TI11I1T($name) {$res =false; if(isset($this->ll1lLLl[$name])) {$res =$this->ll1lLLl[$name][I14311]; }return $res; }function TI11I1I($name) {if(isset($this->ll1lLLl[$name])) {$this->ll1l1I1 =$this->ll1lLLl[$name][I14311]; unset($this->ll1lLLl[$name]); }}function TI11I1l($name) {return isset($this->ll1lLLl[$name]); }function TI11I11() {if(!$this->ll1lL11) {$this->ll1lL11 =true; $this->ll1l1lI =true; $this->ll1l1LI =true; }}function TI11lTT() {if($this->ll1lL11) {$this->ll1lL11 =false; $this->ll1l1lI =true; $this->ll1l1LI =true; }}function sqlOrderEnable() {if(!$this->ll1l1II) {$this->ll1l1II =true; $this->ll1l1ll =true; $this->ll1l1LI =true; }}function sqlOrderDisable() {if($this->ll1l1II) {$this->ll1l1II =false; $this->ll1l1ll =true; $this->ll1l1LI =true; }}function TI11lTI() {if(!$this->ll1l1Il) {$this->ll1l1Il =true; $this->ll1l1l1 =true; $this->ll1l1LI =true; }}function TI11lTl() {if($this->ll1l1Il) {$this->ll1l1Il =false; $this->ll1l1l1 =true; $this->ll1l1LI =true; }}function TI11lT1() {$this->TI11I11(); $this->sqlOrderEnable(); $this->TI11lTI(); }function TI11lIT() {$this->TI11lTT(); $this->sqlOrderDisable(); $this->TI11lTl(); }function initResult($value) {$this->ll1LIll =$value; }function getNode($ILI11LI, $ll1LI1I =I14304) {$res =false; $Il11L1l =false; if($ILI11LI >0) {$this->ll1LILL =$this->ll1LIll; if($this->TI111T1($ILI11LI, $ll1LI1I)) {$this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }}return $res; }function searchNode($ll1LI1I =I14304) {$res =false; $Il11L1l =false; $this->ll1LILL =$this->ll1LIll; if($this->TI111IT($ll1LI1I)) {$this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }return $res; }function getChildsFlt($ILI11LI, $ll1LI1I =I14304) {$res =false; if($ILI11LI >0) {$this->TlTTTII(); $this->ll1LILL =$this->ll1LIll; if($this->TI111II($ILI11LI, $ll1LI1I)) {$this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }}return $res; }function getAllChildsFlt($ll1LlII, $ll1LI1I =I14304) {$res =false; if($ll1LlII >= 0) {$this->TlTTTII(); $this->ll1LILL =$this->ll1LIll; if($this->TI111Il($ll1LlII, $ll1LI1I)) {$this->ll1LIll =$this->ll1LILL; $res =$this->ll1LIll; }$this->ll1LILL =I14305; }return $res; }function getAllChilds($ll1LlII, $ll1LI1I =I14304) {$res =false; if($ll1LlII >= 0) {$this->ll1LILL =$this->ll1LIll; if($this->TI111Il($ll1LlII, $ll1LI1I, "_execSelectSimpleQuery", I14306)) {$this->ll1LIll =$this->ll1LILL; $res =$this->ll1LIll; }$this->ll1LILL =I14305; }return $res; }function TI11lII($ll1LlII) {$res =false; if($ll1LlII >= 0) {$res =$this->TI11llT($ll1LlII); $this->ll1LIll =$res; }return $res; }function getParent($ILI11LI, $ll1LI1I =I14304) {$res =false; if($ILI11LI >0) {$this->ll1LILL =$this->ll1LIll; if($this->TI111lT($ILI11LI, $ll1LI1I)) {$this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }}return $res; }function getAllParents($ILI11LI, $ll1LI1I =I14304) {$res =false; if($ILI11LI >0) {$this->ll1LILL =$this->ll1LIll; if($this->TI111ll($ILI11LI, $ll1LI1I)) {$this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }}return $res; }function TI11lIl($ILI11LI, $ll1LlIl =false) {$res =false; if($ILI11LI >0) {$this->ll1LILL =$this->ll1LIll; $res =$this->TI111lI($ILI11LI, $ll1LlIl); if($res) {$this->ll1LIll =$res; }}return $res; }function createChildsArrayFlt($ll1LI1I =I14304) {$res =false; $this->TlTTTTT($this->ll1lLlI." asc"); $this->TlTTTII(); $this->_execSelectQuery($this->db, $ll1LI1I); $Il11L1l["num_rows"] =$this->db->num_rows(); $Il11L1l["index"] =0; $parentId =-1; $this->ll1LIlL =Array(); $II11L1l =Array(); $index =0; $Il11L1l =Array(); if($this->db->num_rows() >0) {while($this->db->next_record()) {$index++; if($parentId != $this->db->Record[$this->ll1lLlI]) {$this->ll1LIlL[$parentId.I14305] =$II11L1l; $II11L1l =Array(); $parentId =$this->db->Record[$this->ll1lLlI]; }$Il11L1l[I14312] =$index; $this->ILlL1ll->{$this->ILlL1lL["createChildsArrayFlt"]}($II11L1l, $this->db->Record, $Il11L1l); $oldParentId =$this->db->Record[$this->ll1lLlI]; }$this->ll1LIlL[$oldParentId.I14305] =$II11L1l; $res =true; }unset($this->ll1LIlL[-1]); $this->TlTTTTT(I14305); return $res; }function TI11lI1($ll1LlII =0, $ll1LI1I =I14304) {$this->ll1LILL =$this->ll1LIll; $res =$this->TI11llI($ll1LlII, $ll1LI1I); $this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $this->TlTTTTT(I14305); return $res; }function TI11llT($ll1LlII) {$this->TI111TI("filterChildBranch", "_getIdsListCB", $this); $this->ll1LILL =I14305; if($this->TI11llI($ll1LlII, I14304, true)) {$res =mb_substr($this->ll1LILL, 1); }$this->ll1LILL =I14305; $this->TI111Tl("filterChildBranch"); return $res; }function TI11llI($ll1LlII, $ll1LI1I, $ll1LlIL =false) {$res =false; $this->ll1LIlL =Array(); $this->ll1lLL1 =I14313.$this->ll1LIIL.$this->ll1lLlI." IN('".$ll1LlII."')"; $this->ll1LILI =I14313.$this->ll1LIIL.$this->ll1lLlI." IN('%s')"; $this->TlTTTTT($this->ll1lLlI." asc"); $this->TlTTTII($ll1LlIL); $this->_execSelectQuery($this->db, $ll1LI1I); $numRows =$this->db->numRows(); if($this->db->numRows() >0) {$this->ll1LIl1 =$ll1LI1I; $this->__getAllChildrenH(); unset($this->ll1LIlL[-1]); $res =true; }$this->ll1lLL1 =I14305; return $res; }function __getAllChildrenH($level =0) {$parentId =-1; $II11L1l =Array(); $aIds =Array(); $Il11L1l =Array(); $index =0; $level++; while($this->db->nextRecord()) {$Il11L1l[I14314] =$level; $Il11L1l[I14312] =$index; $Il11L1l["parent_ids"] =$aIds; if($this->ILlL1ll->{$this->ILlL1lL["filterChildBranch"]}($this->ll1LILL, $this->db->Record, $Il11L1l)) {$aIds[] =$this->db->Record["id"]; }if($parentId != $this->db->Record[$this->ll1lLlI]) {$this->ll1LIlL[$parentId.I14305] =$II11L1l; $II11L1l =Array(); $parentId =$this->db->Record[$this->ll1lLlI]; }$ll1LlI1 =$this->db->Record[$this->ll1lLlI]; $II11L1l[] =$this->db->Record; $index++; }$this->ll1LIlL[$ll1LlI1.I14305] =$II11L1l; if(sizeof($aIds) >0) {$this->ll1lLL1 =sprintf($this->ll1LILI, implode("','", $aIds)); $this->_execSelectQuery($this->db, $this->ll1LIl1); if($this->db->numRows() >0) {@set_time_limit(20); $this->__getAllChildrenH($level); }}}function _getAllChildrenCB(&$res, &$record, &$Il11L1l) {return true; }function TI11lll(&$db) {$this->ll1LIlL =Array(); while($db->next_record()) {$this->ll1LIL1[I14315]["pid"][$db->Record[$this->ll1lLlI]][$db->Record["id"]] =$db->Record; $this->ll1LIL1[I14315]["id"][$db->Record["id"]] =$db->Record[$this->ll1lLlI]; }$this->TT1TIIT(); }function TT1TIIT() {if(is_array($this->ll1LIL1[I14315][I14316]) && sizeof($this->ll1LIL1[I14315][I14316]) >0) {foreach($this->ll1LIL1[I14315][I14316] as $pid=>$childs) {if(!isset($this->ll1LIL1[I14315]["id"][$pid])) {if(is_array($childs)) {foreach($childs as $child) {$this->ll1LIlL[$pid][] =$child; unset($this->ll1LIL1[I14315]["id"][$child["id"]]); }}unset($this->ll1LIL1[I14315][I14316][$pid]); }}$this->TT1TIIT(); }}function buildTreeOnChildsArray($parentId =I14305) {$res =false; if(sizeof($this->ll1LIlL) >0) {$this->ll1LILL =$this->ll1LIll; $this->ll1LILl =0; if($parentId == I14305) {$parentId =$this->ll1lLlL; }$this->TI111l1($this->ll1LILL, $parentId); $this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }return $res; }function getPath($ILI11LI, $ll1LI1I, $ll1LllI, $maxLen, $ll1Llll, $ll1LllL, $ll1Lll1, $I1LLLLl) {$res =false; if($ILI11LI >0) {$this->ll1LILL =$this->ll1LIll; if($this->TI1111T($ILI11LI, $ll1LI1I, $ll1LllI, $maxLen, $ll1Llll, $ll1LllL, $ll1Lll1, $I1LLLLl)) {$this->ll1LIll =$this->ll1LILL; $this->ll1LILL =I14305; $res =$this->ll1LIll; }}return $res; }function TI11ll1($ILI11LI) {if($ILI11LI >0) {$this->TI1111l($ILI11LI); }}function TI11l1T($ILI11LI, $aSql) {$res =false; if(is_array($ILI11LI) || $ILI11LI >0) {$this->TlTTTIT(); if(is_array($ILI11LI)) {$ll1LlLI ="'".implode(I14317, $ILI11LI)."'"; $this->TI111TT($this->db, $aSql, $ll1LlLI); }else {$this->ll1lLL1 =I14313.$this->ll1LIIL."id='".$ILI11LI."'"; $this->TI11111($this->db, $aSql); $this->ll1lLL1 =I14305; }$res =$this->db->affected_rows(); }return $res; }function TI11l1I($ILI11LI, $aSql, $ll1LlLl ="affected_rows", $ll1LlIl =true) {$res =0; $I11IL1L =0; if($ILI11LI >0) {$ll1LlLI =$this->TI11llT($ILI11LI); if($ll1LlIl){ if($ll1LlLI != I14305) {$ll1LlLI .= I14309; }$ll1LlLI .= $ILI11LI; }if(!empty($ll1LlLI)) $I11IL1L =$this->TI111TT($this->db, $aSql, $ll1LlLI); }switch($ll1LlLl){ case I14318: $res =$I11IL1L; break; case "nodes_id": $res =$I11IL1L; break; case "all": $res =Array("affected" => $I11IL1L, "ids" => $ll1LlLI); break; }return $res; }function TI11l1l($ILI11LI, $aSql) {$I11IL1L =0; if($ILI11LI >0) {$ll1LlLI =$this->TI11llT($ILI11LI); if($ll1LlLI != I14305) {$I11IL1L =$this->TI111TT($this->db, $aSql, $ll1LlLI); }}return $I11IL1L; }function TI11l11($ILI11LI, $aSql, $ll1LlIl =false) {$I11IL1L =0; if($ILI11LI >0 && is_array($aSql) && sizeof($aSql) >0) {$ll1LlLI =$this->TI111lI($ILI11LI, $ll1LlIl); if($ll1LlLI != I14305) {$I11IL1L =$this->TI111TT($this->db, $aSql, $ll1LlLI); }}return $ll1LlLI; }function TI111TT(&$db, &$aSql, $ll1LlLI) {$this->ll1lLL1 =I14313.$this->ll1LIIL.I14319.$ll1LlLI.")"; $this->TI11111($db, $aSql); $this->ll1lLL1 =I14305; return $this->db->affected_rows(); }function _getIdsListCB(&$res, &$record, &$Il11L1l) {$res .= I14309.$record["id"]; return true; }function _getPathCB(&$res, &$record, &$Il11L1l) {$res["path"][$record["id"]] =$record[$res[I14320]]; $res["record"][$record["id"]] =$record; return true; }function _searchNodeCB(&$res, &$record, &$Il11L1l) {$res[] =$record; return true; }function TI111TI($IILlLLI, $methodName, &$llLlI1I) {$this->ll1LIlI =$this->ILlL1lL[$IILlLLI]; $this->ll1LII1 =&$this->ILlL1ll; $this->ILlL1ll =&$llLlI1I; $this->ILlL1lL[$IILlLLI] =$methodName; }function TI111Tl($IILlLLI) {$this->ILlL1lL[$IILlLLI] =$this->ll1LIlI; $this->ILlL1ll =&$this->ll1LII1; }function TI111T1($ILI11LI, $ll1LI1I) {$res =false; $Il11L1l =false; $this->TlTTTIT(); $this->ll1lLL1 =I14313.$this->ll1LIIL."id='".$ILI11LI."'"; $this->_execSelectSimpleQuery($this->db, $ll1LI1I); if($this->db->next_record()) {$this->ILlL1ll->{$this->ILlL1lL[I14321]}($this->ll1LILL, $this->db->Record, $Il11L1l); $res =true; }$this->ll1lLL1 =I14305; return $res; }function TI111IT($ll1LI1I) {$res =false; $Il11L1l =false; $this->TlTTTIT(); $this->ll1lLL1 =I14305; $this->_execSelectSimpleQuery($this->db, $ll1LI1I); $Il11L1l["num_rows"] =$this->db->num_rows(); $Il11L1l[I14312] =0; if($Il11L1l["num_rows"] >0) {while($this->db->next_record()) {$Il11L1l[I14312]++; if(!$this->ILlL1ll->{$this->ILlL1lL["searchNode"]}($this->ll1LILL, $this->db->Record, $Il11L1l)) {break; }}$res =true; }return $res; }function TI111II($ILI11LI) {$res =false; $this->ll1lLL1 =I14313.$this->ll1LIIL.$this->ll1lLlI."='".$ILI11LI.I14322; $this->_execSelectQuery($this->db); $Il11L1l["num_rows"] =$this->db->num_rows(); $Il11L1l[I14312] =0; if($Il11L1l["num_rows"] >0) {while($this->db->next_record()) {$Il11L1l[I14312]++; if(!$this->ILlL1ll->{$this->ILlL1lL["getChildsFlt"]}($this->ll1LILL, $this->db->Record, $Il11L1l)) {break; }}$res =true; }$this->ll1lLL1 =I14305; return $res; }function TI111Il($ll1LlII, $ll1LI1I, $ll1LlLL ="_execSelectQuery", $ll1LlL1 =I14323) {$res =false; $this->ll1LILI =I14313.$this->ll1LIIL.$this->ll1lLlI."=%d"; $this->ll1lLL1 =sprintf($this->ll1LILI, $ll1LlII); $this->{$ll1LlLL}($this->db, $ll1LI1I); $numRows =$this->db->num_rows(); if($numRows >0) {$this->ll1LIl1 =$ll1LI1I; $this->ll1LILl =0; $this->TI111I1($this->db, $numRows, $this->ll1LILL, $ll1LlLL, $ll1LlL1); $res =true; }$this->ll1lLL1 =I14305; return $res; }function TI111I1(&$ll1Ll1I, $numRows, &$res, $ll1LlLL, $ll1LlL1, $level =0) {$db =new DB_si; while($ll1Ll1I->next_record()) {$this->ll1LILl++; $this->ll1lLL1 =sprintf($this->ll1LILI, $ll1Ll1I->Record["id"]); $this->{$ll1LlLL}($db, $this->ll1LIl1); $ll1Ll1l =$db->num_rows(); $Il11L1l["num_rows"] =$ll1Ll1l; $Il11L1l[I14312] =$this->ll1LILl; $Il11L1l[I14314] =$level; $Il11L1l["is_leaf"] =empty($ll1Ll1l); if(!$this->ILlL1ll->{$this->ILlL1lL[$ll1LlL1]}($res, $ll1Ll1I->Record, $Il11L1l)) {break; }if(!$Il11L1l[I14324]) {$this->TI111I1($db, $ll1Ll1l, $res, $ll1LlLL, $ll1LlL1, $level +1); }}}function TI111lT($ILI11LI, $ll1LI1I) {$res =false; $Il11L1l =false; $this->TlTTTIT(); $this->ll1lLL1 =I14313.$this->ll1LIIL."id='".$ILI11LI.I14322; $this->_execSelectSimpleQuery($this->db, $ll1LI1I); if($this->db->next_record()) {$this->ll1lLL1 =I14313.$this->ll1LIIL."id='".$this->db->Record[$this->ll1lLlI].I14322; $this->_execSelectSimpleQuery($this->db, $ll1LI1I); if($this->db->next_record()) {$this->ILlL1ll->{$this->ILlL1lL["getParent"]}($this->ll1LILL, $this->db->Record, $Il11L1l); $res =true; }}$this->ll1lLL1 =I14305; return $res; }function TI111lI($ILI11LI, $ll1LlIl =false) {$this->TlTTTIT(); $this->TI111TI("getAllParents", I14325, $this); $this->ll1LILL =I14305; if($this->TI111ll($ILI11LI, I14304, $ll1LlIl)) {$res =mb_substr($this->ll1LILL, 1); }$this->ll1LILL =I14305; $this->TI111Tl("getAllParents"); return $res; }function TI111ll($ILI11LI, $ll1LI1I, $ll1LlIl =false) {$res =false; $this->TlTTTIT(); $ll1Ll1L =true; if($ll1LlIl) {$ll1Ll11 =$ILI11LI; }else {$this->ll1lLL1 =I14313.$this->ll1LIIL."id='".$ILI11LI.I14322; $this->_execSelectSimpleQuery($this->db, $ll1LI1I); $ll1Ll1L =$this->db->next_record(); if($ll1Ll1L) {$ll1Ll11 =$this->db->Record[$this->ll1lLlI]; }}if($ll1Ll1L) {$this->ll1LILI =I14313.$this->ll1LIIL."id=%d"; $Il11L1l[I14314] =1; do {$this->ll1lLL1 =sprintf($this->ll1LILI, $ll1Ll11); $this->_execSelectSimpleQuery($this->db, $ll1LI1I); if($this->db->next_record()) {$ll1Ll11 =$this->db->Record[$this->ll1lLlI]; $Il11L1l[I14314]++; $Il11L1l["is_root"] =($ll1Ll11 == $this->ll1lLll); if(!$this->ILlL1ll->{$this->ILlL1lL[I14326]}($this->ll1LILL, $this->db->Record, $Il11L1l)) {break; }}else {break; }}while($ll1Ll11 != $this->ll1lLlL); $this->ll1lLL1 =I14305; $res =true; }return $res; }function TI111l1(&$res, $parentId=0, $level =0){ if(isset($this->ll1LIlL[$parentId]) && is_array($this->ll1LIlL[$parentId])){ $II11L1l =$this->ll1LIlL[$parentId]; $num =sizeof($II11L1l); $Il11L1l =array(); for($index=0; $index <$num; $index++) {$this->ll1LILl++; $Il11L1l =array ('level' => $level, 'index' => $this->ll1LILl, 'parentId' => $parentId );$child =&$II11L1l[$index]; $Il1Ll1l =$this->ILlL1ll->{$this->ILlL1lL["buildTreeOnChildsArray"]}($res, $child, $Il11L1l); if($child[I14327] != $parentId && $Il1Ll1l){ $this->TI111l1($res, $child[I14327], $level +1); }}}}function TI1111T($ILI11LI, $ll1LI1I, $ll1LllI, $maxLen, $ll1Llll, $ll1LllL, $ll1Lll1, $I1LLLLl) {$res =false; $this->TI111TI(I14326, "_getPathCB", $this); $ll1LLII =$this->ll1LILL; $this->ll1LILL =Array(I14320=>$ll1LllI); $this->TI111ll($ILI11LI, $ll1LI1I, true); $this->TI111Tl(I14326); if(is_array($this->ll1LILL["path"]) && sizeof($this->ll1LILL["path"]) >0) {$ll1LLIl =$this->TI1111I($this->ll1LILL["path"], $maxLen, $ll1Llll, $ll1LllL, $ll1Lll1, $I1LLLLl); $ll1LLIL =sizeof($ll1LLIl); $ll1LLI1 =array_keys($ll1LLIl); if($ll1LLIL >0) {$res =true; $Il11L1l =Array(); $ll1LLlI =$this->ll1LILL[I14328]; $aRecords =$this->ll1LILL["record"]; unset($this->ll1LILL); $this->ll1LILL =$ll1LLII; for($i=$ll1LLIL-1;$i>=0;$i--) {$tmpId =$ll1LLI1[$i]; $Il11L1l[I14312] =$i; $Il11L1l["skip_item"] =($tmpId == 0); $Il11L1l["is_current"] =($tmpId == $ILI11LI); $Il11L1l["record"] =$aRecords[$tmpId]; if(!$this->ILlL1ll->{$this->ILlL1lL[I14329]}($this->ll1LILL, $tmpId, $ll1LLlI[$tmpId], $ll1LLIl[$tmpId], $Il11L1l)) {break; }}}}return $res; }function TI1111I($arr, $maxLen, $ll1Llll, $ll1LllL, $ll1Lll1, $I1LLLLl) {$res =Array(); $ll1LLll =0; $num =sizeof($arr); $ll1LLlL =$this->cms->Core->GetOption("strip_strings_by_words"); $this->cms->Core->SetOption("strip_strings_by_words", false); foreach($arr as $key => $value) {$arr[$key] =$this->cms->stripLine($value, $ll1Llll, true); $ll1LLll += mb_strlen($arr[$key]); if($ll1LLll >= $maxLen) {break; }}if($ll1LLll <$maxLen || ($ll1LllL +$ll1Lll1) >= $num) {$res =$arr; }else {$keys =array_keys($arr); for($i=0;$i<$ll1LllL;$i++) {$res[$keys[$i]] =$this->cms->stripLine($arr[$keys[$i]], $ll1Llll); }$res["0"] =$I1LLLLl; for($i=$num-$ll1Lll1;$i<$num;$i++) {$res[$keys[$i]] =$this->cms->stripLine($arr[$keys[$i]], $ll1Llll); }}$this->cms->Core->SetOption("strip_strings_by_words", $ll1LLlL); return $res; }function TI1111l($ILI11LI) {if($this->TI11llT($ILI11LI)) {$this->ll1LILL .= $this->ll1LILL.I14309.$ILI11LI; }else {$this->ll1LILL .= $ILI11LI; }$sql =I14330.$this->ll1lLI1." WHERE id IN(".$this->ll1LILL.")"; $this->db->query($sql); $this->ll1LILL =I14305; }function getChildsFltCB(&$res, &$record, &$Il11L1l) {return true; }function getAllChildsFltCB(&$res, &$record, &$Il11L1l) {$res .= "<option value=\"".$record[I14327]."\">".str_repeat(I14331, $Il11L1l[I14314]).$record["name"]."\n"; return true; }function getAllChildsCB(&$res, &$record, &$Il11L1l) {return true; }function getParentCB(&$res, &$record, &$Il11L1l) {return true; }function getAllParentsCB(&$res, &$record, &$Il11L1l) {$name =$record["name"]; if($Il11L1l["is_root"]) {$name ="<font color=\"red\">".$name."</font>"; }if($Il11L1l[I14314] >1) {$res1 ="/<a href=\"pop=".$record[I14327]."\">".$name."</a>"; }else {$res1 =I14332.$record["name"]."</b>"; }$res =$res1.$res; return true; }function getNodeCB(&$res, &$record, &$Il11L1l) {$res =$record; return true; }function searchNodeCB(&$res, &$record, &$Il11L1l) {$res =$record; return true; }function createChildsArrayFltCB(&$II11L1l, &$record, &$Il11L1l) {$II11L1l[] =Array(I14327=>$record[I14327]); }function buildTreeOnChildsArrayCB(&$res, &$child, &$Il11L1l) {}function getPathCB(&$res, $itemId, $itemName, $stripItemName, &$Il11L1l) {return true; }function _execSelectQuery(&$db, $ll1LI1I ='_empty') {$sql ="SELECT ".$this->ll1LIIL.I14333.$this->ll1LIIL.$this->ll1lLlI.$this->ll1lLl1[$ll1LI1I]." FROM ".$this->ll1lLI1." ".$this->ll1l11L." WHERE 1 ".$this->ll1lLL1.$this->l11IlLl.$this->ll1l111.$this->ll1lLLI; $db->query($sql); }function _execSelectSimpleQuery(&$db, $ll1LI1I) {$sql ="SELECT ".$this->ll1LIIL.I14333.$this->ll1LIIL.$this->ll1lLlI.$this->ll1lLl1[$ll1LI1I].I14334.$this->ll1lLI1." ".$this->ll1l11L." WHERE 1 ".$this->ll1lLL1.$this->l11IlLl.$this->ll1l111; $db->query($sql); }function TI11111(&$db, &$aSql) {$sql =$db->genUpdateSql($this->ll1lLI1, $aSql, " WHERE 1".$this->ll1lLL1.$this->l11IlLl); $db->query($sql); }function TlTTTTT($ll1LLl1) {$this->ll1lL1I =$ll1LLl1; $this->ll1l1ll =true; $this->ll1l1LI =true; }function TlTTTTI($ll1LLl1) {$this->ll1lL1l =$ll1LLl1; $this->ll1l1ll =true; $this->ll1l1LI =true; }function TlTTTTl() {$this->ll1l1ll =true; $this->ll1l1lL =true; $this->ll1l1LI =true; }function TlTTTT1() {if($this->ll1l1Ll) {$this->ll1l11L =I14305; $this->ll1l111 =I14305; $this->ll1LIII =I14305; $this->ll1LIIl =I14305; if($this->ll1l1IL) {if(sizeof($this->ll1lL1L) >0) {foreach($this->ll1lL1L as $alias => $ll1LLLI) {$this->ll1l11L .= " ".$ll1LLLI[I14335]; $this->ll1l111 .= (empty($ll1LLLI["where"])) ?I14305 :" AND".$ll1LLLI["where"]; $this->ll1LIII .= (empty($ll1LLLI["order_by"])) ?I14305 :I14309.$ll1LLLI[I14336]; $this->ll1LIIl .= (empty($ll1LLLI["group_by"])) ?I14305 :I14309.$ll1LLLI["group_by"]; }if(!empty($this->ll1LIII)) {$this->ll1LIII =mb_substr($this->ll1LIII, 1); }if(!empty($this->ll1LIIl)) {$this->ll1LIIl =mb_substr($this->ll1LIIl, 1); }}}$this->ll1l1Ll =false; }}function TlTTTIT() {$this->TlTTTT1(); if($this->ll1l1I1) {$this->l11IlLl =I14305; if(sizeof($this->ll1lLLl) >0) {foreach($this->ll1lLLl as $name=>$data) {if($data[I14311]) {$this->l11IlLl .= I14313.$data["val"]; }}}$this->ll1l1I1 =false; }}function TlTTTII($ll1LlIL =false) {$this->TlTTTIT(); $this->TlTTTT1(); if($this->ll1l1LI) {if(!$ll1LlIL && $this->ll1lL11 && $this->ll1l1lI && isset($this->cms->Filter) && is_object($this->cms->Filter)) {$this->ll1l1LL =$this->cms->Filter->GetFilterSql(); $this->ll1l1lI =false; }if($this->ll1l1lL) {$this->ll1l1L1 =$this->ll1LIIl; if(!empty($this->ll1l1L1)) {$this->ll1l1L1 =" GROUP BY ".$this->ll1l1L1; }}if($this->ll1l1ll) {$this->ll1l11I =$this->ll1lL1I; if(!$ll1LlIL && $this->ll1l1II) {if(!empty($this->ll1l11I)) {$this->ll1l11I .= I14309; }if($this->ll1lL1l != I14305) {$this->ll1l11I .= $this->ll1lL1l.I14309; }$this->ll1l11I .= $this->cms->Pager->TI1TTlT(); }if(!empty($this->ll1l11I)) {$this->ll1l11I =I14337.$this->ll1l11I; }$this->ll1l1ll =false; }if(!$ll1LlIL && $this->ll1l1Il && $this->ll1l1l1) {$this->ll1l11l =" ".$this->cms->Pager->TI1TTlI(); $this->ll1l1l1 =false; }$this->ll1lLLI =$this->ll1l1LL.$this->ll1l1L1.$this->ll1l11I.$this->ll1l11l; $this->ll1l1LI =false; }}}