<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       17719 xkqwnuittpuxwnnlumgpzrltmgzurkxlylxwlsknuqggmksuinwkiuysuiyqllkgmyigpnir
 */ ?><?php foreach(array(14661=>"rQturn",14662=>"QrrnH",14663=>"WZnWQJ",14664=>"QrrHr",14665=>"YuttHn",14666=>"RUR",14667=>"rQturn|urJ",14668=>"GrHWQDD|urJ",14669=>"HrSQr",14670=>"YuttHn|nZIQ",14671=>"OMSSQnD",14672=>"SQDWrMGtMHn",14673=>"Uds",14674=>"WZnWQJ|urJ",14675=>'fZMJ',14676=>"dohghRsqRNUiyqR=",14677=>"]gzddchRs=",14678=>"]oqzsqR1=0",14679=>"ZutOHrMAQS",14680=>"Mn?GrHWQDD",14681=>'HK') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} if(!class_exists("BILL_driver_assist", false)){ class BILL_driver_assist extends BILL_driver_base {function getPayButton(array &$vRes, array $cData, $ll11ILL =false){ $res =true; $data =Array("return_url" => $cData[I14661]); if(is_array($cData)){ $data =array_merge($data, $cData); }$vRes["error"] ="Success"; $vRes["errno"] =0; if(empty($data["process_url"])){ $vRes[I14662] =1; $vRes["error"] ="process_url is missed"; $res =false; }else if(empty($data[I14661])){ $vRes[I14662] =2; $vRes["error"] ="return url is missed"; $res =false; }else if(empty($data[I14663])){ $vRes[I14662] =3; $vRes["error"] ="cancel url is missed"; $res =false; }else if(empty($data["merchant_id"])){ $vRes[I14662] =4; $vRes["error"] ="merchant shop ID is missed"; $res =false; }else if(empty($data["order"])){ $vRes[I14662] =5; $vRes["error"] ="order is missed"; $res =false; }else if(empty($data["description"])){ $vRes[I14662] =6; $vRes[I14664] ="description is missed"; $res =false; }else if(empty($data["amount"])){ $vRes[I14662] =7; $vRes[I14664] ="amount is missed"; $res =false; }else if(empty($data["button_name"]) && empty($data[I14665])){ $vRes[I14662] =8; $vRes[I14664] ="button is missed"; $res =false; }if($data["currency"] != "USD" && $data["currency"] != I14666 && $data["currency"] != "EUR") $data["currency"] ="USD"; foreach(Array(I14667, "cancel_url", "description", "button_name") as $fldName) $data[$fldName] =htmlspecialchars($data[$fldName]); $ll11IL1 =$data; if(isset($ll11IL1["process_url"])) unset($ll11IL1[I14668]); if(isset($ll11IL1[I14667])) unset($ll11IL1[I14667]); if(isset($ll11IL1["cancel_url"])) unset($ll11IL1["cancel_url"]); if(isset($ll11IL1["merchant_shop"])) unset($ll11IL1["merchant_shop"]); if(isset($ll11IL1[I14669])) unset($ll11IL1[I14669]); if(isset($ll11IL1["description"])) unset($ll11IL1["description"]); if(isset($ll11IL1["amount"])) unset($ll11IL1["amount"]); if(isset($ll11IL1[I14670])) unset($ll11IL1[I14670]); if(isset($ll11IL1["currency"])) unset($ll11IL1["currency"]); if(isset($ll11IL1["x_action"])) unset($ll11IL1["x_action"]); if(isset($ll11IL1[I14665])) unset($ll11IL1[I14665]); foreach($ll11IL1 as $key => $value) $data[I14671] .= "<input type=\"hidden\" name=\"$key\" value=\"$value\">\r\n"; $data[I14665] =trim($data[I14665]); if(!empty($data[I14665])) {$data["_button_html"] =1; }if(!$res) {$data["disabled"] ="disabled"; }return parent::getPayButton($vRes, $data, $ll11ILL); }function getPayButtonParams(array $cData, array &$vRes){ $data =$cData; $vRes[I14664] ="Success"; $vRes[I14662] =0; if(empty($data[I14661])){ $vRes[I14662] =1; $vRes[I14664] ="return url is missed"; return false; }else if(empty($data[I14663])){ $vRes[I14662] =2; $vRes[I14664] ="cancel url is missed"; return false; }else if(empty($data["merchant_id"])){ $vRes[I14662] =3; $vRes[I14664] ="merchant shop ID is missed"; return false; }else if(empty($data[I14669])){ $vRes[I14662] =4; $vRes[I14664] ="order is missed"; return false; }else if(empty($data[I14672])){ $vRes[I14662] =5; $vRes[I14664] ="description is missed"; return false; }else if(empty($data["amount"])){ $vRes[I14662] =6; $vRes[I14664] ="amount is missed"; return false; }if($data["currency"] != I14673 && $data["currency"] != I14666 && $data["currency"] != "EUR") $data["currency"] =I14673; foreach(Array(I14667, I14674, I14672) as $fldName) $data[$fldName] =htmlspecialchars($data[$fldName]); if($this->ILLLllI >0){ $data["is_test_mode"] ="1"; }else{ $data["is_test_mode"] ="0"; }return parent::getPayButtonParams($data, $vRes); }function payProcess(array $cGet, array $cPost, array &$vRes, array $ll11I1I, array $aOrderData){ $status =I14675; if(!@is_array($cGet)) $cGet =Array(); if(!@is_array($cPost)) $cPost =Array(); $params =array_merge($cGet, $cPost); if(!empty($params['status'])) $status =$params['status']; $ll11I1l =$params['Order_IDP']; if(!empty($ll11I1l)){ $cURL ="https://secure.assist.ru/results/results.cfm"; $ll1II11 =I14676.$ll11I1l. "&SHOP_ID=".$ll11I1I["merchant_id"]. "&LOGIN=".$ll11I1I["login"]. I14677.$ll11I1I["pass_phrase"]. "&SUCCESS=1". "&ZIPFLAG=0". "&HEADER=0". I14678. "&DELIMITER=;". "&S_FIELDS=BILLNUMBER;STATUS;RESPONSE_CODE;RECOMMENDATION;MESSAGE"; $ll11I1L =false; $ll11I11 =false; $ll11lII =false; $ll11lIl =false; $csv =$this->TlTTI11($cURL, $ll1II11); if(!empty($csv)){ $ll11lIL =explode("\r\n", $csv); for($i =0; $i <count($ll11lIL); $i++){ if(!empty($ll11lIL[$i])){ $ll11lI1 =explode(";", $ll11lIL[$i]); if(count($ll11lI1) >0){ $ll11llI =mb_strtolower(trim($ll11lI1[1])); if( $ll11llI == I14679 || $ll11llI == "authorization delayed" || $ll11llI == "captured" || $ll11llI == "not refunded" || $ll11llI == "not reversaled" || $ll11llI == I14680) $ll11I1L =true; else if($ll11llI == "refunded") $ll11I11 =true; else if($ll11llI == "reversaled") $ll11lII =true; else if($ll11llI == "not authorized" || $ll11llI == "not captured") $ll11lIl =true; }}}if($ll11I1L && !$ll11I11 && !$ll11lII && !$ll11lIl) $status =I14681; else $vRes[I14664] ="Transaction status is wrong. Response: ".$csv; }else $vRes[I14664] ="Wrong response received"; }else $vRes[I14664] ="Order ID cannot be empty"; return ($status == I14681); }function payCallback(array $cGet, array $cPost, array &$vRes, array $additionalParams, array $aOrderData){ return false; }function TlTTI11($cURL, $ll1II11){ $response =""; @set_time_limit(120); ob_start(); $ll11lll =curl_init ($cURL); curl_setopt($ll11lll, CURLOPT_HEADER, 0); curl_setopt($ll11lll, CURLOPT_TIMEOUT, 60); curl_setopt($ll11lll, CURLOPT_POST, 1); curl_setopt($ll11lll, CURLOPT_POSTFIELDS, $ll1II11); curl_setopt($ll11lll, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($ll11lll, CURLOPT_SSL_VERIFYHOST, 0); if(!curl_exec($ll11lll)){ curl_close($ll11lll); ob_end_clean(); ob_end_flush(); return false; }curl_close($ll11lll); $response =ob_get_contents(); ob_end_clean(); ob_end_flush(); return $response; }}}?>
