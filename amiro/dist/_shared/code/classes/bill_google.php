<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @package    Driver_PaymentSystem 
 * @version    $Id$ 
 * @since      5.8.6 
 * @size       9042 xkqwszxsrmskyuziyrwmuqsyzkiqlyprkxruxqgmnigtrqnmgkstmxkrrqxyrxpssgwzpnir
 */ ?><?php foreach(array(14803=>"QrrHr",14804=>"rQturn?MD?IMDDQS",14805=>"QrrnH",14806=>"YuttHn",14807=>"rQturn",14808=>"MtQI|nuIYQr",14809=>"YuttHn|nZIQ",14810=>"OMSSQnD",14811=>"SQDWrMGtMHn",14812=>'DtZtuD',14813=>'gog|zUTo|UdqR',14814=>'oTTg|zUTohRmazTmhN',14815=>'zutOHrMAZtMHn') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} class BILL_driver_google extends BILL_driver_base{ public function getPayButton(array &$aRes, array $aData, $bAutoRedirect =false){ $bRes =true; $aTemplateData =Array("return" => $this->ll11LIl->parameters["DEFAULT_RETURN_ADDRESS"]); if(is_array($aData)){ $aTemplateData =array_merge($aTemplateData, $aData); }$aRes[I14803] ="Success"; $aRes["errno"] =0; if(empty($aTemplateData["return"])){ $aRes["errno"] =1; $aRes[I14803] =I14804; $bRes =false; }else if(empty($aTemplateData["item_name"])){ $aRes["errno"] =2; $aRes[I14803] ="item_name is missed"; $bRes =false; }else if(empty($aTemplateData["item_number"])){ $aRes[I14805] =3; $aRes[I14803] ="item_number is missed"; $bRes =false; }else if(empty($aTemplateData["amount"])){ $aRes[I14805] =4; $aRes[I14803] ="amount is missed"; $bRes =false; }else if(empty($aTemplateData["button_name"]) && empty($aTemplateData[I14806])){ $aRes[I14805] =5; $aRes[I14803] ="button_name is missed"; $bRes =false; }$aHiddenData =$aTemplateData; if(isset($aHiddenData["business_email"])){ unset($aHiddenData["business_email"]); }if(isset($aHiddenData["return"])){ unset($aHiddenData[I14807]); }if(isset($aHiddenData["cancel"])){ unset($aHiddenData["cancel"]); }if(isset($aHiddenData["item_name"])){ unset($aHiddenData["item_name"]); }if(isset($aHiddenData[I14808])){ unset($aHiddenData[I14808]); }if(isset($aHiddenData["amount"])){ unset($aHiddenData["amount"]); }if(isset($aHiddenData["rm"])){ unset($aHiddenData["rm"]); }if(isset($aHiddenData[I14809])){ unset($aHiddenData[I14809]); }if(isset($aHiddenData[I14806])){ unset($aHiddenData[I14806]); }if(isset($aHiddenData["process_url"])){ unset($aHiddenData["process_url"]); }if(isset($aHiddenData["custom"])){ unset($aHiddenData["custom"]); }if(isset($aHiddenData[I14809])){ unset($aHiddenData[I14809]); }foreach($aHiddenData as $key => $value){ $aTemplateData[I14810] .= "<input type=\"hidden\" name=\"$key\" value=\"$value\">\r\n"; }$aTemplateData[I14806] =trim($aTemplateData[I14806]); if(!empty($aTemplateData[I14806])) {$aTemplateData["_button_html"] =1; }if(!$bRes) {$aTemplateData["disabled"] ="disabled"; }return parent::getPayButton($aRes, $aTemplateData, $bAutoRedirect); }public function getPayButtonParams(array $aData, array &$aRes){ $aTemplateData =$aData; $aRes[I14803] ="Success"; $aRes[I14805] =0; if(empty($aTemplateData[I14807])){ $aRes[I14805] =1; $aRes[I14803] ="return url is missed"; return false; }else if(empty($aTemplateData["merchant_id"])){ $aRes[I14805] =2; $aRes[I14803] ="merchant purse is missed"; return false; }else if(empty($aTemplateData["amount"])){ $aRes[I14805] =3; $aRes[I14803] ="amount is missed"; return false; }else if(empty($aTemplateData[I14811])){ $aRes[I14805] =4; $aRes[I14803] ="description is missed"; return false; }foreach(Array("return_url", I14811, I14809) as $fldName){ if(isset($aTemplateData[$fldName])){ $aTemplateData[$fldName] =htmlspecialchars($aTemplateData[$fldName]); }}$aHiddenData =$aTemplateData; unset($aHiddenData[I14807]); foreach($aHiddenData as $key => $value){ $aTemplateData[I14810] .= "<input type=\"hidden\" name=\"$key\" value=\"$value\">\r\n"; }return parent::getPayButtonParams($aTemplateData, $aRes); }public function payProcess(array $aGet, array $aPost, array &$aRes, array $aCheckData, array $aOrderData){ $status ='fail'; if(!empty($aGet['status'])){ $status =$aGet[I14812]; }if(!empty($aPost[I14812])){ $status =$aPost[I14812]; }return($status == 'ok'); }public function payCallback(array $aGet, array $aPost, array &$aRes, array $aCheckData, array $aOrderData){ $aRes[I14803] =""; $returnVal =0; if(isset($_SERVER['PHP_AUTH_USER']) && isset($_SERVER['PHP_AUTH_PW'])){ $lLIIlLl =$_SERVER[I14813]; $lLIIlLL =$_SERVER['PHP_AUTH_PW']; }else if(isset($_SERVER['HTTP_AUTHORIZATION'])){ list($lLIIlLl, $lLIIlLL) =explode(':', base64_decode(mb_substr($_SERVER['HTTP_AUTHORIZATION'], mb_strpos($_SERVER[I14814], " ") +1))); }else if(isset($_SERVER['Authorization'])){ list($lLIIlLl, $lLIIlLL) =explode(':', base64_decode(mb_substr($_SERVER['Authorization'], mb_strpos($_SERVER[I14815], " ") +1))); }else{ return $returnVal; }if($aCheckData['merchant_id'] != $lLIIlLl || $aCheckData['merchant_key'] != $lLIIlLL){ return $returnVal; }if($aPost['type'] == 'new-order-notification'){ $returnVal =1; }else{ $returnVal =-1; }return $returnVal; }}