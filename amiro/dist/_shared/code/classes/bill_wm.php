<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       17986 xkqwkyrxxknyxungpgpmzuwksrmyxwgkyxuyxrnrkzryztumspiursnwuuzrxkxlkurxpnir
 */ ?><?php foreach(array(14976=>'Uds',14977=>'Q',14978=>'~}0[${~',14979=>"duWWQDD",14980=>"QrrHr",14981=>"IQrWOZnt|MS",14982=>"ZIHunt?MD?IMDDQS",14983=>"YuttHn",14984=>"SQDWrMGtMHn",14985=>"rQturn",14986=>"ZIHunt",14987=>"OMSSQnD",14988=>"GZBCOQrQ",14989=>"1",14990=>"QrrnH",14991=>"YuttHn|nZIQ",14992=>"MD|tQDt|IHSQ",14993=>"SQDWrMGtMHn|YZDQ64",14994=>"jim|dbd|TRzNd|Nh",14995=>"TqdT",14996=>"jim|dbd|mNVd|Nh",14997=>"jim|ozdo",14998=>'~*0+9Z+Az+a&)32(~',14999=>"cims",15000=>"tQDt",15001=>"GWM|SQDW",15002=>'HK',15003=>"jim|gzbiqNT|Nh") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} if(!class_exists("BILL_driver_wm", false)){ class BILL_driver_wm extends BILL_driver_base {public $lLIILl1; function getCurrencies($options =array (),$ll11LLI ='') {$currencies =parent::getCurrencies($options, $ll11LLI); $map =array (I14976 => 'z', 'RUR' => 'r', 'EUR' => I14977); foreach ($map as $currency => $postfix) {if ($ll11LLI == $currency && !empty($options['merchant_id' .$postfix])) {if (($index =array_search($currency, $currencies)) !== false) {unset($currencies[$index]); }array_unshift($currencies, $currency); $this->lLIILl1 =$options['merchant_id' .$postfix]; break; }}return $currencies; }function TlTT1I1(&$lLIILll){ $lLIILll =number_format($lLIILll, 2, ".", ""); $lLIILll =preg_replace(I14978, '', $lLIILll); if(mb_strlen($lLIILll) >0){ if($lLIILll[mb_strlen($lLIILll)-1] == ".") $lLIILll =mb_substr($lLIILll, 0, mb_strlen($lLIILll)-1); }else $lLIILll ="0"; }function getPayButton(array &$vRes, array $cData, $ll11ILL =false){ $res =true; $data =$cData; $vRes["error"] =I14979; $vRes["errno"] =0; if (!empty($this->lLIILl1)) {$data["merchant_id"] =$this->lLIILl1; }if(empty($data["process_url"])){ $vRes["errno"] =1; $vRes[I14980] ="process_url is missed"; $res =false; }else if(empty($data["return"])){ $vRes["errno"] =2; $vRes[I14980] ="return url is missed"; $res =false; }else if(empty($data[I14981])){ $vRes["errno"] =3; $vRes[I14980] ="merchant purse is missed"; $res =false; }else if(empty($data["amount"])){ $vRes["errno"] =4; $vRes[I14980] =I14982; $res =false; }else if(empty($data["description"])){ $vRes["errno"] =5; $vRes[I14980] ="description is missed"; $res =false; }else if(empty($data["button_name"]) && empty($data[I14983])){ $vRes["errno"] =6; $vRes[I14980] ="button is missed"; $res =false; }$this->TlTT1I1($data["amount"]); foreach(Array("return", I14984, "button_name") as $fldName) $data[$fldName] =htmlspecialchars($data[$fldName]); $ll11IL1 =$data; if(isset($ll11IL1["process_url"])) unset($ll11IL1["process_url"]); if(isset($ll11IL1["return"])) unset($ll11IL1[I14985]); if(isset($ll11IL1["callback"])) unset($ll11IL1["callback"]); if(isset($ll11IL1["cancel"])) unset($ll11IL1["cancel"]); if(isset($ll11IL1[I14981])) unset($ll11IL1[I14981]); if(isset($ll11IL1[I14986])) unset($ll11IL1[I14986]); if(isset($ll11IL1[I14984])) unset($ll11IL1[I14984]); if(isset($ll11IL1["order"])) unset($ll11IL1["order"]); if(isset($ll11IL1["button_name"])) unset($ll11IL1["button_name"]); if(isset($ll11IL1[I14983])) unset($ll11IL1[I14983]); foreach($ll11IL1 as $key => $value) $data[I14987] .= "<input type=\"hidden\" name=\"$key\" value=\"$value\">\r\n"; $data[I14983] =trim($data[I14983]); if(!empty($data[I14983])) {$data["_button_html"] =1; }if(!$res) {$data["disabled"] ="disabled"; }return parent::getPayButton($vRes, $data, $ll11ILL); }function getPayButtonParams(array $cData, array &$vRes){ $data =$cData; $vRes[I14980] =I14979; $vRes["errno"] =0; if (!empty($this->lLIILl1)) {$data[I14981] =$this->lLIILl1; }if($data[I14988] != "1" && $data[I14988] != "2"){ $vRes["errno"] =1; $vRes[I14980] ="payment method is missed"; return false; }if($data[I14988] == I14989){ if(empty($data[I14985])){ $vRes["errno"] =2; $vRes[I14980] ="return url is missed"; return false; }else if(empty($data[I14986])){ $vRes["errno"] =3; $vRes[I14980] =I14982; return false; }else if(empty($data[I14981])){ $vRes["errno"] =4; $vRes[I14980] ="merchant purse is missed"; return false; }}else{ if(empty($data[I14985])){ $vRes["errno"] =5; $vRes[I14980] ="return url is missed"; return false; }else if(empty($data[I14981])){ $vRes["errno"] =6; $vRes[I14980] ="merchant purse is missed"; return false; }else if(empty($data[I14986])){ $vRes[I14990] =7; $vRes[I14980] =I14982; return false; }else if(empty($data[I14984])){ $vRes[I14990] =8; $vRes[I14980] ="description is missed"; return false; }}$this->TlTT1I1($data[I14986]); foreach(Array("return_url", "callback_url", "cancel_url", I14984, I14991) as $fldName) if(isset($data[$fldName])) $data[$fldName] =htmlspecialchars($data[$fldName]); $ll11IL1 =$data; unset($ll11IL1[I14985]); unset($ll11IL1["cancel"]); unset($ll11IL1["callback"]); foreach($ll11IL1 as $key => $value) $data[I14987] .= "<input type=\"hidden\" name=\"$key\" value=\"$value\">\r\n"; if($this->ILLLllI >0){ $data["test_mode"] ="0"; $data[I14992] ="test"; }else{ $data["test_mode"] =""; $data[I14992] =""; }$data[I14993] =base64_encode($data[I14984]); return parent::getPayButtonParams($data, $vRes); }function payProcess(array $cGet, array $cPost, array &$vRes, array $ll11I1I, array $aOrderData){ $status ='fail'; if(!@is_array($cGet)) $cGet =Array(); if(!@is_array($cPost)) $cPost =Array(); $params =array_merge($cGet, $cPost); if(!empty($params['status'])) $status =$params['status']; return ($status == 'ok'); }function payCallback(array $cGet, array $cPost, array &$vRes, array $ll11I1I, array $aOrderData){ $status =isset($cPost[I14994]) ?'fail' :'inner'; if(!@is_array($cGet)) $cGet =Array(); if(!@is_array($cPost)) $cPost =Array(); $params =array_merge($cGet, $cPost); if(isset($params["LMI_HASH"])){ if($params["LMI_PREREQUEST"]==1) {$vRes[I14980] =I14995; }$sign =md5($params["LMI_PAYEE_PURSE"]. $params["LMI_PAYMENT_AMOUNT"]. $params["LMI_PAYMENT_NO"]. $params["LMI_MODE"]. $params[I14996]. $params[I14994]. $params["LMI_SYS_TRANS_DATE"]. $ll11I1I["pass_phrase"]. $params["LMI_PAYER_PURSE"]. $params["LMI_PAYER_WM"]); if(!strcasecmp($params[I14997], $sign)) $status ='ok'; else $vRes[I14980] ="Hashes do not match"; }elseif(isset($params["pci_marker"]) && !empty($params["pci_marker"])){ if(!preg_match(I14998, $ll11I1I["cb_pass"])) $ll11I1I["cb_pass"] =md5($ll11I1I["cb_pass"]); $lLIILLI =mb_strtoupper(md5($params["pci_wmtid"].$params[I14999]. mb_strtoupper(md5(mb_strtoupper($ll11I1I["script_full_url"].$params["pci_pursedest"].$params["pci_amount"].$params["pci_desc"].($this->ILLLllI >0 ?I15000 :"")))). $params["pci_pursesrc"].$params["pci_pursedest"].$params["pci_amount"].$params[I15001].$params["pci_datecrt"].($this->ILLLllI >0 ?I15000 :""). mb_strtoupper($ll11I1I["cb_pass"]))); if(!strcasecmp($lLIILLI, $params["pci_marker"])) $status =I15002; else $vRes[I14980] ="MD5 sign and calculated sign are not the same"; }else{ $vRes[I14980] ="Neighter MD5 sign nor Hash not found"; }return ($status == 'inner' ?-1 :($status == I15002 ?1 :0)); }function getProcessOrder(array $cGet, array $cPost, array &$vRes, array $additionalParams){ $orderId =0; if(!empty($cGet["LMI_PAYMENT_NO"])) $orderId =$cGet[I15003]; if(!empty($cPost[I15003])) $orderId =$cPost[I15003]; return intval($orderId); }}}?>