<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       14921 xkqwzrppqxktkslnlgtwqtyxpnmwsxzrrnwnpxxrkwussurqsqrklxglrurlgmnxsuwtpnir
 */ ?><?php foreach(array(15004=>"ymjj|SrMvQr|BZnSQx",15005=>"QrrnH",15006=>"QrrHr",15007=>"DOHG|QrrHr|MnfH",15008=>"rQturn",15009=>"ZIHunt",15010=>"SQDWrMGtMHn",15011=>"DW|MS",15012=>"YuttHn",15013=>"DOHG|MS",15014=>"HrSQr|MS",15015=>'DOHG|fZMJ|urJ',15016=>'rQDGHnDQ',15017=>'DtZtuD',15018=>"\n",15019=>'MnvHMWQmS',15020=>'ZWtMHn',15021=>'WuDtHIQrNuIYQr',15022=>'DOHG|GZDDCHrS',15023=>'HK',15024=>'0',15025=>'"?MnvHMWQmS="') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} require_once $GLOBALS['FUNC_INCLUDES_PATH'] .'func_eshop.php'; if(!class_exists(I15004, false)){ class BILL_driver_yandex extends BILL_driver_base {private $lLIILLl; function TlTT1Il(&$lLIILll){ $lLIILll =number_format($lLIILll, 2, ".", ""); }function getPayButton(array &$vRes, array $cData, $ll11ILL =false){ $res =true; $data =$cData; $vRes["error"] ="Success"; $vRes[I15005] =0; if(empty($data["shop_id"])){ $vRes[I15005] =1; $vRes["error"] ="shop_id is missed"; $res =false; }else if(empty($data["sc_id"])){ $vRes[I15005] =2; $vRes[I15006] ="sc_id is missed"; $res =false; }else if(empty($data["amount"])){ $vRes[I15005] =4; $vRes[I15006] ="amount is missed"; $res =false; }else if(empty($data["description"])){ $vRes[I15005] =5; $vRes[I15006] ="description is missed"; $res =false; }else if(empty($data["button_name"]) && empty($data["button"])){ $vRes[I15005] =6; $vRes[I15006] ="button is missed"; $res =false; }$this->TlTT1Il($data["amount"]); foreach(Array(I15007, "description", "button_name") as $fldName) $data[$fldName] =htmlspecialchars($data[$fldName]); $ll11IL1 =$data; if(isset($ll11IL1["process_url"])) unset($ll11IL1["process_url"]); if(isset($ll11IL1[I15008])) unset($ll11IL1[I15008]); if(isset($ll11IL1["callback"])) unset($ll11IL1["callback"]); if(isset($ll11IL1["cancel"])) unset($ll11IL1["cancel"]); if(isset($ll11IL1[I15009])) unset($ll11IL1[I15009]); if(isset($ll11IL1["order"])) unset($ll11IL1["order"]); if(isset($ll11IL1["button_name"])) unset($ll11IL1["button_name"]); if(isset($ll11IL1[I15010])) unset($ll11IL1[I15010]); if(isset($ll11IL1["button"])) unset($ll11IL1["button"]); if(isset($ll11IL1["shop_id"])) unset($ll11IL1["shop_id"]); if(isset($ll11IL1[I15011])) unset($ll11IL1[I15011]); if(isset($ll11IL1["shop_password"])) unset($ll11IL1["shop_password"]); if(isset($ll11IL1[I15007])) unset($ll11IL1[I15007]); foreach($ll11IL1 as $key => $value){ $data["hiddens"] .= "<input type=\"hidden\" name=\"$key\" value=\"$value\">\r\n"; }$data["button"] =trim($data[I15012]); if(!empty($data[I15012])) {$data["_button_html"] =1; }if(!$res) {$data["disabled"] ="disabled"; }return parent::getPayButton($vRes, $data, $ll11ILL); }function getPayButtonParams(array $cData, array &$vRes){ $data =$cData; $vRes[I15006] ="Success"; $vRes[I15005] =0; if(empty($data[I15013])){ $vRes[I15005] =1; $vRes[I15006] ="shop_id is missed"; $res =false; }else if(empty($data[I15011])){ $vRes[I15005] =2; $vRes[I15006] ="sc_id is missed"; $res =false; }else if(empty($data[I15009])){ $vRes[I15005] =4; $vRes[I15006] ="amount is missed"; return false; }else if(empty($data[I15010])){ $vRes[I15005] =5; $vRes[I15006] ="description is missed"; return false; }else if(empty($data[I15014])){ $vRes[I15005] =6; $vRes[I15006] ="order id is missed"; return false; }$data['shop_success_url'] =urlencode($GLOBALS["ROOT_PATH_WWW"].'pages.php?action=process&status=ok'); $data[I15015] =urlencode($GLOBALS["ROOT_PATH_WWW"].'pages.php?action=process&status=fail'); $this->TlTT1Il($data[I15009]); return parent::getPayButtonParams($data, $vRes); }function TlTT1lT(&$aResult){ $aResult['status'] ='fail'; $aResult[I15016] =''; if($_POST['action'] == 'checkOrder'){ if($this->TlTT1lI()){ $lLIILLL ='0'; $aResult[I15017] ='ok'; }else{ $lLIILLL ='1'; $aResult[I15017] ='fail'; }$response ='<?xml version="1.0" encoding="UTF-8"?>'.I15018; $response .= '<checkOrderResponse performedDatetime="'.date("c").'" code="'.$lLIILLL.'" invoiceId="'.$_POST[I15019].'" shopId="'.$_POST['shopId'].'"/>'; $aResult[I15016] =$response; }}function TlTT1lI(){ $status ='fail'; $lLIILL1 =array(I15020, 'orderSumAmount', 'orderSumCurrencyPaycash', 'orderSumBankPaycash', 'shopId', I15019, I15021); $data =''; foreach($lLIILL1 as $field){ if(!empty($_POST[$field])){ $data .= ';'.$_POST[$field]; }}$lLIILII =TlTll1I($GLOBALS['db'], 'yandex'); if(!empty($lLIILII[I15022])){ $data .= ';'.$lLIILII[I15022]; }$data =strtoupper(md5(trim($data, ';'))); if(!empty($_POST['md5']) && ($data === strtoupper($_POST['md5']))){ $status =I15023; }return ($status == I15023); }function onPaymentConfirmed($orderId){ while(ob_get_level()){ ob_end_clean(); }header('Status: 200 OK'); header('HTTP/1.0 200 OK'); echo $this->lLIILLl; die; }function payProcess(array $cGet, array $cPost, array &$vRes, array $ll11I1I, array $aOrderData){ $this->clearCartOnPayProcess =true; $status ='fail'; if(!@is_array($cGet)) $cGet =Array(); if(!@is_array($cPost)) $cPost =Array(); $params =array_merge($cGet, $cPost); if(!empty($params[I15017])) $status =$params[I15017]; return ($status == I15023); }function payCallback(array $cGet, array $cPost, array &$vRes, array $ll11I1I, array $aOrderData){ $status ='fail'; if(!@is_array($cGet)) $cGet =Array(); if(!@is_array($cPost)) $cPost =Array(); $params =array_merge($cGet, $cPost); if($this->TlTT1lI()){ $status =I15023; $lLIILLL =I15024; }else{ $lLIILLL ='1'; }$this->lLIILLl ='<?xml version="1.0" encoding="UTF-8"?><paymentAvisoResponse performedDatetime ="'.date("c").'" code="'.$lLIILLL.I15025.$params[I15019].'" shopId="'.$params['shopId'].'"/>'; return ($status == I15023); }}}