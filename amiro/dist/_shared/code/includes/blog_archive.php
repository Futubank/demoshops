<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       29450 xkqwtzqultuniliqnwzkuztxqmpqxnglsywkriwuxxztynyyzpswznzmxwkznmiirxnqpnir
 */ ?><?php foreach(array(18033=>'wid|qxtiHSuJQ`GOG',18034=>"WJZDD",18035=>"YJHP|ZrWOMvQ%%pQtqxtQnDMHn%?WJZDD|nZIQ?MD?nHt?DGQWMfMQS?fHr?IHSuJQ?",18036=>"c",18037=>"nuI",18038=>"SZtQ|BQZr",18039=>"SZB",18040=>"DIZJJ",18041=>'|ZrWOMvQ',18042=>"ZrWOMvQ|DMAQ",18043=>"DOHC|HnJB|ZrWOMvQS",18044=>"WZtHffDQt",18045=>'|ZrWOMvQ`tGJ',18046=>"MS",18047=>"fHruI|Qxt",18048=>"urJgZrZID",18049=>"?",18050=>"OQZSQr",18051=>"fHruI",18052=>"tS|ZJMPn",18053=>"]WZtHffDQt=",18054=>'ZWtMHn',18055=>'fHruI|ZSS',18056=>"%fHruI|JMnK",18057=>"]HffDQt=",18058=>"WHunt|rQGJMQD",18059=>"%MtQI",18060=>'1',18061=>"SZtQ|frHI",18062=>"BQZr",18063=>"I",18064=>"|YQPMn|SZtQ",18065=>"%",18066=>"'?zNs?SZtQ#='",18067=>"GZPQr",18068=>"'{?zd?fSZtQ?",18069=>'',18070=>"urJ|GZrZID",18071=>"fSZtQ",18072=>"YHSB",18073=>"%MtQI|rHC",18074=>"%YHSB|MtQID",18075=>"'?zNs?SZtQ@='",18076=>"IHn",18077=>"IHntO",18078=>"S",18079=>"+1?SZBD",18080=>"b",18081=>"?FRhi?",18082=>"'?",18083=>'CQQK',18084=>"|WHunt|",18085=>"+",18086=>" WZtHffDQt=*dTzRT&") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} if (!function_exists("GetExtension")) {function &GetExtension($IIlLIIl) {global $frn; require_once $GLOBALS['CLASSES_PATH'] .I18033; $ext =null; $IILII1L =&$frn->Core->GetModule($IIlLIIl); if (is_object($IILII1L) && $IILII1L->IssetProperty(I18034)) {$aClasses =$IILII1L->TTlTTTI(I18034); foreach($aClasses as $class) {require_once $GLOBALS['CLASSES_PATH'] .$class .'.php'; }$ext =new $class(); }else {trigger_error(I18035 .$IIlLIIl, E_USER_WARNING); }return $ext; }}$lLlIIlL =Array(0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31); function TlTlTTl($num) {$num =intval($num); if($num <10) {$num ="0".$num; }return $num; }function TlTlTT1($month, $year) {global $lLlIIlL; if($month != 2) {$day =$lLlIIlL[$month]; }else {$day =28; while(checkdate($month, $day+1, $year)) {$day ++; }}return $day; }function TlTlTIT(&$day, &$month, &$year) {$weekDay =date("w", mktime(0, 0, 1, $month, $day, $year)); if($weekDay >0) {$day += (7 -$weekDay); }$I1l1l11 =TlTlTT1($month, $year); if($day >$I1l1l11) {$day -= $I1l1l11; if($month >11) {$month =1; $year++; }else {$month++; }}}function TlTlTII($year) {$num =date(I18036, mktime(0, 0, 1, 1, 1, $year +1)); $day =31; while($num <50) {$num =date(I18036, mktime(0, 0, 1, 12, $day, $year)); $day--; }return $num; }function TlTlTIl($value, &$month, &$year) {if($month -$value <1) {$year--; $month =12 -$value +$month; }else {$month -= $value; }}function TlTlTI1() {}function TlTlTlT(&$db, $lLlIIl1) {$aCounters =Array(); switch($lLlIIl1) {case "day"; while($db->next_record()) {$aCounters[$db->Record["date_year"]][$db->Record["date_month"]][$db->Record["date_day"]] =$db->Record[I18037]; }break; case "month"; while($db->next_record()) {$aCounters[$db->Record["date_year"]][$db->Record["date_month"]] =$db->Record[I18037]; }break; case "year"; while($db->next_record()) {$aCounters[$db->Record[I18038]] =$db->Record[I18037]; }break; case "week"; while($db->next_record()) {$aCounters[$db->Record[I18038]][$db->Record["date_week"]] =$db->Record[I18037]; }break; }return $aCounters; }function TlTlTlI($lLlIIl1, &$aCounters, &$ILllLLL, $lLlIILI) {$res =0; $year =$ILllLLL["year"]; $month =intval($ILllLLL["month"]); $day =$ILllLLL[I18039]; switch($lLlIIl1) {case I18039; $I1l1l11 =TlTlTT1($month, $year); for($i=0;$i<$lLlIILI;$i++) {if(($day +$i) >$I1l1l11) {$day =1 -$i; if($month >11) {$month =1; $I1l1l11 =31; $year++; }else {$month++; $I1l1l11 =TlTlTT1($month, $year); }}$res += intval($aCounters[$year][$month][($day +$i)]); }break; case "month"; for($i=0;$i<$lLlIILI;$i++) {if($month +$i >12) {$month -= 12; $year++; }$res += intval($aCounters[$year][$month +$i]); }break; case "year"; for($i=0;$i<$lLlIILI;$i++) {$res += intval($aCounters[$year +$i]); }break; case "week"; global $db; $week =$ILllLLL["week"]; $lLlIILl =TlTlTII($year); $lLlIILL =date(I18036, mktime(0, 0, 1, 1, 1, $year +1)); $lLlIIL1 =date(I18036, mktime(0, 0, 1, 12, 31, $year)); $i =0; $lLlII1I =$week +$i; if($lLlII1I >$lLlIILl) {$week =1 -$i; $year++; $lLlIILl =TlTlTII($year); $lLlIILL =date(I18036, mktime(0, 0, 1, 1, 1, $year +1)); }if($lLlII1I == $lLlIILl) {$lLlII1l =$lLlII1I; }elseif($lLlII1I == 1) {if($ILllLLL[I18039] <10) {$lLlII1l =1; }else {if($lLlIIL1 == 1 && $lLlIILL == 1) {$lLlII1l =$lLlIILl +1; $lLlII1L =1; }elseif($lLlIIL1 >1 && $lLlIILL == 1) {$lLlII1l =1; }elseif($lLlIIL1 == 1) {$lLlII1l =$lLlIILl +1; $lLlII1L =0; }elseif($lLlIILL >1) {}}}else {$lLlII1l =$lLlII1I; }$res += intval($aCounters[$year][$lLlII1l]); if(isset($lLlII1L)) {$res += intval($aCounters[$year+1][$lLlII1L]); }break; }return $res; }$lLI111I =0; if(isset($mode)&&$mode==I18040){ $lLI111I =1; }if(!$lLI111I){ require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .'init.php'; }$lLlII11 =""; $moduleName ='blog'; $lLlIlII =$moduleName .I18041; $mModule =&$frn->Core->GetModule($moduleName); $lLlIlIl =&$frn->Core->GetModule($lLlIlII); $lLlIlIL =$lLlIlIl->GetOption("show_forum_count_replies"); $lLlIlI1 =false; $lLlIllI =(in_array("ext_discussion", $lLlIlIl->GetOption("extensions")) && $frn->Core->IsInstalled("ext_discussion")); $lLlIlll =$lLlIlIl->GetOption(I18042); $archivePeriod =$lLlIlIl->GetOption("archive_period"); $lLlIllL =$lLlIlIl->GetOption("archive_page_size"); $lLlIll1 =$lLlIlIl->GetOption('show_count_news'); $lLlIlLI =""; if($lLlIlIl->GetOption(I18043)) {$lLlIlLI =" AND archive=1"; }if(isset($frn->Vars["id"])) $frn->Vars["id"] =intval($frn->Vars["id"]); $catoffset =0; if(isset($frn->Vars[I18044])) $catoffset =intval($frn->Vars[I18044]); $frn->Gui->addBlock($moduleName, 'templates/' .$moduleName .'_archive.tpl'); if ($lLlIllI) {$frn->Gui->addBlock($lLlIlII .'_list', 'templates/' .$moduleName .I18045); $vItemData =$I1LLLlL =$IILIILl =array ();$lLlIlIl->moduleName =$lLlIlII; $IIlLIIl ="ext_discussion"; if ($frn->Core->IsInstalled($IIlLIIl)) {$extension =&GetExtension($IIlLIIl); if (is_object($extension)) {$mModule->InitEngine($frn, $db); $extension->Init($frn, $lLlIlIl, $mModule->Engine); $extension->mod->module =&$lLlIlIl; $extension->mod->langData =$lang_data; $extension->mod->db =&$db; }else {$extension =false; trigger_error("CMS_ActModule::Init: class_name is not specified for module $IIlLIIl", E_USER_WARNING); }}if ($lLlIllI =is_object($extension)) {$extension->TTIllTl(0, $vItemData, $I1LLLlL, $IILIILl); $extension->TTIll1I(0, $vItemData, $I1LLLlL, $IILIILl, false); }}if(isset($frn->Vars["id"]) && $frn->Vars["id"] >0) {if($lLlIllI && isset($frn->Vars["forum_ext"])) {$urlParams =Array( I18046=>$frn->Vars[I18046], "offset"=>$frn->Vars["offset"], I18044=>$catoffset, "date_from"=>$frn->Vars["date_from"], I18047=>1); $lLlIlLl =Array( "name"=>"forum", "extentionName"=>$moduleName, "extId"=>$frn->Vars[I18046], I18048=>$urlParams); }$sql ="SELECT *, DATE_FORMAT(date,'".$frn->DFMT["db"]."') AS fdate ". "FROM " .$mModule->GetTableName() .I18049 ."WHERE public=1 AND lang='$lang_data' and id='".$frn->Vars[I18046]."'"; if($record =$db->getRecord($sql)) {$lLlIlLL["date"] =$record["fdate"]; $lLlIlLL["header"] =$record[I18050]; $lLlIlLL["announce"] =$frn->Gui->MYnl2br($record["announce"]); if(!(!$lLlIlIl->GetOption("show_body_when_forum") && $lLlIlLl["name"] == I18051)) {$lLlIlLL["body"] =$frn->Gui->getAbs($moduleName .":body_content", Array("body" => $frn->Gui->MYnl2br($record["body"]))); }$lLlIlLL[I18052] ="justify"; $lLlIlLL["url_params"] ="offset=".$frn->Vars["offset"].I18053.$catoffset."&date_from=".$frn->Vars["date_from"]; if($lLlIllI && is_object($extension)) {$none =array ('skip_item_restoration' => 1); $extension->TITT1I1($moduleName); $extension->mod->id =$frn->Vars['id']; if ($frn->Vars[I18054] == 'forum_add') {$extension->mod->action ='forum_add'; $extension->ILL1II1->IIL1llI ='header'; }$extension->TTIl1IT($frn->Vars['id'], $lLlIlLL, $none, $none); if ($frn->Vars[I18054] == I18055) {$extension->ILL1IIL->Engine =false; $extension->TITT1I1($moduleName); }$aNavData =Array(); $aNavData[I18046] =$record[I18046]; $aNavData["id_sublink"] =$record["sublink"]; $aNavData =$frn->ApplyNav($aNavData); if($frn->Vars[I18047] == "") {$lLlIlLL["forum_link"] =$frn->Gui->getAbs($moduleName .I18056, Array("forum_href" => $lLlIlIl->GetFrontLink(), "url_params" => "&date_from=".$frn->Vars["date_from"].I18053.$catoffset.I18057.$frn->Vars["offset"]."&forum_ext=1") +$aNavData); if($lLlIlIL || $lLlIlI1) {if($lLlIlIL) {$lLlIlL1 =$extension->TITT1Il($moduleName, $frn->Vars[I18046]); $lLlIlLL["count_replies"] =$frn->Gui->getAbs($moduleName .":forum_count_replies", Array(I18058 => intval($lLlIlL1[$frn->Vars[I18046]]["all"]))); }}}$lLlIlLL["forum_extention"] =$frn->Gui->get($moduleName .":forum_extention", $lLlIl1I); $lLlIlLL += $aNavData; $extension->TTIl1T1($cId, $lLlIlLL, $lLlIlLL, $none); }EventApplyVars($frn, "body_itemD", $lLlIlLL); $lLlIl1l[$moduleName] =$frn->Gui->get($moduleName .I18059,$lLlIlLL); $IIl1IL1 =unserialize($record['sm_data']); $ModuleHtml["headers"] =$frn->TITlTl1($ModuleHtml["headers"], $IIl1IL1); if($record["details_noindex"] == I18060 || !$GLOBALS['IIlLIlL']){ $frn->Gui->setRobotsMeta(false); }$HtmlBody .= $frn->Gui->get($moduleName, $lLlIl1l); }else {$HtmlBody .= $frn->Gui->getAbs("common:page_not_found", ""); }}elseif(isset($frn->Vars["date_from"])) {$dateFrom =$frn->Vars[I18061]; $lLlIl1L =explode("-", $dateFrom); for($i =0; $i <3; $i++){ $dateFrom[$i] =isset($dateFrom[$i]) ?(int)$dateFrom[$i] :0; }$lLlIl11 =mktime(0, 0, 0, $lLlIl1L[1], $lLlIl1L[2], $lLlIl1L[0]); $lLlIILI =intval($archivePeriod); if(mb_strpos($archivePeriod, "month") !== false) {$lLlIl1L[1] += $lLlIILI; $lLlILII ="month"; }elseif(mb_strpos($archivePeriod, "year") !== false) {$lLlIl1L[0] += $lLlIILI; $lLlILII =I18062; }elseif(mb_strpos($archivePeriod, I18039) !== false) {$lLlIl1L[2] += $lLlIILI; $lLlILII =I18039; }elseif(mb_strpos($archivePeriod, "week") !== false) {$lLlIl1L[2] += 7*$lLlIILI; $lLlILII ="week"; }$lI1l1l1 =mktime(23, 59, 59, $lLlIl1L[1], $lLlIl1L[2], $lLlIl1L[0]) -86400; $aData[I18039] =date("d", $lLlIl11); $aData["month"] =date(I18063, $lLlIl11); $aData[I18062] =date("Y", $lLlIl11); $aData["week"] =date(I18036, $lLlIl11); $listItems["begin_date"] =$frn->Gui->get($moduleName .":".$lLlILII.I18064, $aData); $aData[I18039] =date("d", $lI1l1l1); $aData["month"] =date(I18063, $lI1l1l1); $aData[I18062] =date("Y", $lI1l1l1); $listItems["end_date"] =$frn->Gui->get($moduleName .I18065.$lLlILII."_end_date", $aData); $listItems["date_period"] =$frn->Gui->get($moduleName .":date_period_".$lLlILII, $listItems); $lLlILIl =($lLlIllI && $lLlIlIl->GetOption("show_forum_link_in_list")); $filter ="public=1 AND lang='$lang_data' AND date>='".DateTools::toMysqlDate($lLlIl11).I18066.DateTools::toMysqlDate($lI1l1l1)."'".$lLlIlLI; $sql ="SELECT id, date from " .$mModule->GetTableName() ." WHERE $filter"; $db->query($sql); $frn->Pager->MaxCount =$db->num_rows(); $frn->Pager->TI1TT1I(); $lll1lII =$frn->Pager->GetPager(); $pager =$frn->Pager->GetPagerHtml( $lll1lII, $frn->ActiveScript."?date_from=".$dateFrom.I18053.$catoffset."&offset=[START]"); $listItems[I18044] =$catoffset; if($frn->Pager->MaxCount){ $listItems[I18067] =$pager; $urlParams =I18053.$catoffset."&date_from=".$dateFrom.I18057.$frn->Vars["offset"]; $sql ="SELECT *, DATE_FORMAT(date,'".$frn->DFMT["db"].I18068. "FROM " .$mModule->GetTableName() .I18049. "WHERE $filter ORDER BY ".$frn->Pager->TI1TTlT().", id asc  ".$frn->Pager->TI1TTlI(); $db->query($sql); if ($lLlILIl && is_object($extension)) {$lLlILIL =Array(); while($db->next_record()) {$lLlILIL[] =$db->Record[I18046]; }$db->seek(); $lLlILI1 =implode(",", $lLlILIL); if ($lLlIlIL) {$lLlIlL1 =$extension->TITT1Il($moduleName, $lLlILI1); }}$listItems['list_items'] =I18069; while($db->next_record()) {$lLlIlLL =Array(); $aNavData =Array(); $aNavData[I18046] =$db->Record[I18046]; $aNavData["id_sublink"] =$db->Record["sublink"]; $aNavData =$frn->ApplyNav($aNavData); if($lLlILIl) {if($lLlIlIL) {$lLlIlLL[I18058] =$lLlIlL1[$db->Record[I18046]]["all"]; }$lLlIlLL["forum_href"] =$lLlIlIl->GetFrontLink(); $lLlIlLL[I18070] =$urlParams."&forum_ext=1"; $lLlIlLL["forum_link_list"] =$frn->Gui->getAbs($moduleName .":forum_link_list", $lLlIlLL +$aNavData); }$lLlIlLL["date"] =$db->Record[I18071]; $lLlIlLL[I18050] =$db->Record[I18050]; $lLlIlLL["announce"] =nl2br($db->Record["announce"]); $lLlIlLL["details"] =""; if(!empty($db->Record[I18072])) $lLlIlLL["details"] =$frn->Gui->getAbs($moduleName .":details",Array(I18070=>$urlParams) +$aNavData); EventApplyVars($frn, "body_item", $lLlIlLL); $listItems["list_items"] .= $frn->Gui->get($moduleName .I18073, $lLlIlLL); }$listItems["body_list_items"] =$frn->Gui->get($moduleName .":list_items", $listItems); }else{ $listItems["body_list_items"] =$frn->Gui->get($moduleName .":empty_list_items", $listItems); }$lLlIl1l[$moduleName] =$frn->Gui->get($moduleName .I18074,$listItems); $lLlIl1l["offset"] =$frn->Vars["offset"]; $HtmlBody .= $frn->Gui->get($moduleName, $lLlIl1l); }else {$curTime =time(); $lI1l1l1 =strtotime($lLlIlll); $sql ="SELECT UNIX_TIMESTAMP(date) as first_date FROM " .$mModule->GetTableName() ." WHERE lang='".$lang.I18075.DateTools::toMysqlDate($lI1l1l1)."' ORDER BY date ASC LIMIT 1"; $db->query($sql); if($db->next_record() >0) {$lI1l1l1 =$db->Record["first_date"]; $lLlIILI =intval($archivePeriod); if($lLlIILI == 0) {$lLlIILI =1; }$curDate =getDate($curTime); $year =$curDate[I18062]; $I1l11LI =getDate($lI1l1l1); $lLlIlIl->InitPager($frn->Pager); $frn->Pager->InitPager($catoffset, $lLlIllL); $index =0; if(mb_strpos($archivePeriod, "month") !== false) {$lLlIIl1 ="month"; $day =28; $month =$curDate[I18076]; $lI1l1l1 =mktime(0, 0, 0, $I1l11LI[I18076], 0, $I1l11LI[I18062]); $curTime =$lI1l1l1 +1; $lLlILlI =0; while($curTime >$lI1l1l1) {$day =TlTlTT1($month, $year); $III1l1L[$index][I18039] =$day; $III1l1L[$index]["month"] =$month; $III1l1L[$index][I18062] =$year; if($lLlIILI >1) {TlTlTIl($lLlIILI -1, $month, $year); }$curTime =mktime(0, 0, 0, $month, 1, $year); if($curTime <$lI1l1l1) {$lLlILll[$index][I18039] ="01"; $lLlILll[$index]["month"] =$I1l11LI[I18076]; $lLlILll[$index][I18062] =$I1l11LI[I18062]; }else {$lLlILll[$index][I18039] ="01"; $lLlILll[$index][I18077] =$month; $lLlILll[$index][I18062] =$year; TlTlTIl(1, $month, $year); $curTime =mktime(0, 0, 0, $month, 1, $year); }$index++; }}elseif(mb_strpos($archivePeriod, I18062) !== false) {$lLlIIl1 =I18062; $lI1l1l1 =mktime(0, 0, 0, 0, 0, $I1l11LI[I18062]); $curTime =$lI1l1l1 +1; while($curTime >$lI1l1l1) {$III1l1L[$index][I18039] ="31"; $III1l1L[$index][I18077] ="12"; $III1l1L[$index][I18062] =$year; if($lLlIILI >1) {$year -= ($lLlIILI -1); }$lLlILll[$index][I18039] ="01"; $lLlILll[$index][I18077] ="01"; $lLlILll[$index][I18062] =$year; $year--; $curTime =mktime(0, 0, 0, 1, 1, $year); $index++; }}elseif(mb_strpos($archivePeriod, I18039) !== false) {$lLlIIl1 =I18039; $lLlILlL =$lLlIILI -1; while($curTime >$lI1l1l1) {$III1l1L[$index][I18039] =date(I18078, $curTime); $III1l1L[$index][I18077] =date(I18063, $curTime); $III1l1L[$index][I18062] =date("Y", $curTime); if($lLlILlL >0) {$curTime =strtotime("-".$lLlILlL." days", $curTime); }$lLlILll[$index][I18039] =date(I18078, $curTime); $lLlILll[$index][I18077] =date(I18063, $curTime); $lLlILll[$index][I18062] =date("Y", $curTime); $curTime =strtotime(I18079, $curTime); $index++; }}elseif(mb_strpos($archivePeriod, "week") !== false) {$lLlIIl1 ="week"; TlTlTIT($curDate["mday"], $curDate[I18076], $curDate[I18062]); $curTime =mktime(0, 0, 1, $curDate[I18076], $curDate["mday"], $curDate[I18062]); $lLlILl1 =0; while($curTime >$lI1l1l1) {$III1l1L[$index][I18039] =date(I18078, $curTime); $III1l1L[$index][I18077] =date(I18063, $curTime); $III1l1L[$index][I18062] =date(I18080, $curTime); $lLlILLI =date(I18036, $curTime -43200); $III1l1L[$index]["week"] =$lLlILLI; $curTime =strtotime("-1 week", $curTime); $lLlILLl =strtotime("+1 day", $curTime); $lLlILll[$index][I18039] =date(I18078, $lLlILLl); $lLlILll[$index][I18077] =date(I18063, $lLlILLl); $lLlILll[$index][I18062] =date(I18080, $lLlILLl); $lLlILll[$index]["week"] =$lLlILLI; $index++; }}}$lLlILII =$lLlIIl1; $frn->Pager->MaxCount =sizeof($lLlILll); $frn->Pager->TI1TT1I(); $lLlILLL =Array(); $lLlILLL[I18044] =$catoffset; $lLlILL1 =$frn->Pager->TI1TTll()-1; $endPos =min(sizeof($lLlILll), $frn->Pager->TI1TTl1()); if($lLlIll1) {$lLlIL1I =DateTools::toMysqlDate(mktime(0, 0, 0, $lLlILll[$endPos -1][I18077], $lLlILll[$endPos -1][I18039], $lLlILll[$endPos -1][I18062])); $I1l11LI =DateTools::toMysqlDate(mktime(23, 59, 59, $III1l1L[$lLlILL1][I18077], $III1l1L[$lLlILL1][I18039], $III1l1L[$lLlILL1][I18062])); switch($lLlIIl1) {case I18039; $lLlIL1l ="GROUP BY MONTH(date), YEAR(date), DAYOFMONTH(date)"; $lLlIL1L =", DAYOFMONTH(date) AS date_day, MONTH(date) AS date_month, YEAR(date) AS date_year"; break; case I18077; $lLlIL1l ="GROUP BY MONTH(date), YEAR(date)"; $lLlIL1L =", MONTH(date) AS date_month, YEAR(date) AS date_year"; break; case I18062; $lLlIL1l ="GROUP BY YEAR(date)"; $lLlIL1L =", YEAR(date) AS date_year"; break; case "week"; $lLlIL1l ="GROUP BY WEEK(date, 1), YEAR(date)"; $lLlIL1L =", WEEK(date, 1) AS date_week, YEAR(date) AS date_year"; break; }$sql ="SELECT COUNT(*) AS num".$lLlIL1L.I18081 .$mModule->GetTableName() ." WHERE lang='".$lang_data."'".$lLlIlLI." AND public=1 AND date BETWEEN '".$lLlIL1I."' AND '".$I1l11LI.I18082.$lLlIL1l." ORDER BY date DESC"; $db->query($sql); $aCounters =TlTlTlT($db, $lLlIIl1); }$IIlL1l1 ="_link"; $lLlILLL['list_dates'] =I18069; for($i=$lLlILL1;$i<$endPos;$i++) {$aData['week'] =isset($lLlILll[$i][I18083]) ?$lLlILll[$i][I18083] :I18069; $aData[I18039] =TlTlTTl($III1l1L[$i][I18039]); $aData[I18077] =TlTlTTl($III1l1L[$i][I18077]); $aData[I18062] =$III1l1L[$i][I18062]; $lLlILLL["end_date"] =$frn->Gui->get($moduleName .I18065.$lLlILII."_end_date", $aData); $aData[I18039] =TlTlTTl($lLlILll[$i][I18039]); $aData[I18077] =TlTlTTl($lLlILll[$i][I18077]); $aData[I18062] =$lLlILll[$i][I18062]; if($lLlIll1) {$counter =TlTlTlI($lLlIIl1, $aCounters, $lLlILll[$i], $lLlIILI); $aData["count_" .$moduleName] =$counter; $lLlILLL["count_" .$moduleName] =$frn->Gui->get($moduleName .I18065.$lLlILII.I18084 .$moduleName, $aData); if($counter >0) {$IIlL1l1 ="_link"; }else {$IIlL1l1 =""; }}$lLlILLL["begin_date"] =$frn->Gui->get($moduleName .I18065.$lLlILII.I18064, $aData); $lLlILLL[I18061] =$lLlILll[$i][I18062]."-".$lLlILll[$i][I18077].I18085.$lLlILll[$i][I18039]; EventApplyVars($frn, "body_".$lLlILII."_dates", $lLlILLL); $lLlILLL["list_dates"] .= $frn->Gui->get($moduleName .":list_dates_".$lLlILII.$IIlL1l1, $lLlILLL); }$lll1lII =$frn->Pager->GetPager(); $pager =$frn->Pager->GetPagerHtml($lll1lII, $frn->ActiveScript.I18086); $lLlILLL[I18067] =$pager; $lLlILLL[$moduleName] =$frn->Gui->get($moduleName .":body_dates", $lLlILLL); $HtmlBody .= $frn->Gui->get($moduleName, $lLlILLL); }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; 