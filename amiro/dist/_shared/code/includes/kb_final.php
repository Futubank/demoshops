<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       3700 xkqwippqgirtlizlskixnsmwixmnsgqnxiipgsqgxgyttzxiniystulugmkirsxtskkspnir
 */ ?><?php foreach(array(18883=>"QDOHG|fMnZJ",18884=>'wjzddqd|gzTo',18885=>"YMJJMnP",18886=>'DBDMnfH',18887=>'ZJJHCQS|SrMvQrD',18888=>'_',18889=>"!?gZBIQnt|tBGQ=",18890=>"|GZDD|GOrZDQ",18891=>"QrrHr",18892=>"rQLQWtQS",18893=>"tMtJQ",18894=>'WHntQnt+tBGQ') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} unset($_POST["action"]); unset($_GET["action"]); $ActiveModule =I18883; $eshop =1; require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .'init.php'; require_once $GLOBALS['CLASSES_PATH'] .'billing.php'; require_once $GLOBALS[I18884] .$GLOBALS['lLIll1I']['BASE_DRIVER'] .'.php'; require_once $GLOBALS[I18884] .'EshopOrder.php'; $oEshop =&$frn->Eshop; $oOrder =new EshopOrder(); $oOrder->aCurrency =&$oEshop->aCurrency; $lLlLLI1 =&$frn->Core->GetModule(I18885); $driverName =$lLlLLI1->GetOption("driver"); $mEshopOrder =&$frn->Core->GetModule($oEshop->ownerName."_order"); $order_id =intval($frn->Vars['item_number']); $sql ="SELECT sysinfo FROM ".$oEshop->dbTablePrefix."_orders WHERE id='$order_id'"; $db->query($sql); $db->next_record(); $aSysInfo =unserialize($db->Record[I18886]); if(!empty($aSysInfo['driver']) && !empty($aSysInfo['person_type']) && !empty($aSysInfo['payment_type']) && mb_strpos('|'.$mEshopOrder->TTlITIl(I18887, $aSysInfo['person_type'].'_'.$aSysInfo['payment_type']).'|', I18888.$aSysInfo['driver'].I18888) !== false) {$driverName =$aSysInfo['driver']; TlTll1l($frn, $lLlLLI1, $lLlLLlI, $driverName, $lang_data, $oEshop->dbTablePrefix); }else {trigger_error("Eshop Callback: Inavalid data. Order=$order_id, ". ", Person_type=".$aSysInfo['person_type'].I18889.$aSysInfo['payment_type']. ", Driver=".$aSysInfo['driver'], E_USER_ERROR); }$url =getCurrentURL(); $aCheckData =Array( "pass_phrase" => $lLlLLI1->TTlITIl($driverName.I18890), "cb_pass" => $lLlLLI1->TTlITIl($driverName."_cb_pass"), "script_full_url" => $url, "lang_data" => $lang_data );$lLlL1lL =$lLlLLlI->payCallback($frn->VarsGet, $frn->VarsPost, $vRes, $aCheckData); if($lLlL1lL) {if($vRes[I18891] == "TEST") {}else {trigger_error("confirmed", E_USER_WARNING); $lLlL1lL =$oOrder->updateStatus($frn, $order_id, 'auto', 'confirmed'); }}else {trigger_error(I18892, E_USER_WARNING); $oOrder->updateStatus($frn, $order_id, 'auto', 'rejected'); }$lLl1Il1 =$cms->Core->GetModOption("pages", "site_title"); $html[I18893] =$lLl1Il1[$lang]; $html["base"] =$cms->Gui->getTag("base"); $html["order_id"] =$order_id; $html['meta'] =$cms->Gui->getMeta(I18894); $frn->Gui->addBlock(I18883,"templates/eshop_final.tpl"); $Content =$frn->Gui->get(I18883, $html); $conn->Sign($Content); echo $Content; $conn->Out(); die; ?>