<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       29488 xkqwtzxrnlrtnylgzwinmmsgiiinnizmgnumizixsqpiqptsgyqikxnsrngwnilxqsuppnir
 */ ?><?php foreach(array(18990=>'wid|qxtiHSuJQ`GOG',18991=>"WJZDD",18992=>"nQCD|ZrWOMvQ%%pQtqxtQnDMHn%?WJZDD|nZIQ?MD?nHt?DGQWMfMQS?fHr?IHSuJQ?",18993=>"c",18994=>"nuI",18995=>"SZtQ|BQZr",18996=>"SZB",18997=>"DIZJJ",18998=>'|ZrWOMvQ',18999=>"ZrWOMvQ|DMAQ",19000=>"DOHC|HnJB|ZrWOMvQS",19001=>"WZtHffDQt",19002=>'|ZrWOMvQ`tGJ',19003=>"MS",19004=>"fHruI|Qxt",19005=>"urJgZrZID",19006=>"?",19007=>"OQZSQr",19008=>"fHruI",19009=>"tS|ZJMPn",19010=>"]WZtHffDQt=",19011=>'ZWtMHn',19012=>'fHruI|ZSS',19013=>"%fHruI|JMnK",19014=>"]HffDQt=",19015=>"WHunt|rQGJMQD",19016=>"%MtQI",19017=>'1',19018=>"SZtQ|frHI",19019=>"BQZr",19020=>"I",19021=>"|YQPMn|SZtQ",19022=>"%",19023=>"'?zNs?SZtQ#='",19024=>"GZPQr",19025=>"'{?zd?fSZtQ?",19026=>'',19027=>"urJ|GZrZID",19028=>"fSZtQ",19029=>"YHSB",19030=>"%MtQI|rHC",19031=>"%YHSB|MtQID",19032=>"'?zNs?SZtQ@='",19033=>"IHn",19034=>"IHntO",19035=>"S",19036=>"+1?SZBD",19037=>"b",19038=>"?FRhi?",19039=>"'?",19040=>'CQQK',19041=>"|WHunt|",19042=>"+",19043=>" WZtHffDQt=*dTzRT&") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} if (!function_exists("GetExtension")) {function &GetExtension($IIlLIIl) {global $frn; require_once $GLOBALS['CLASSES_PATH'] .I18990; $ext =null; $IILII1L =&$frn->Core->GetModule($IIlLIIl); if (is_object($IILII1L) && $IILII1L->IssetProperty(I18991)) {$aClasses =$IILII1L->TTlTTTI(I18991); foreach($aClasses as $class) {require_once $GLOBALS['CLASSES_PATH'] .$class .'.php'; }$ext =new $class(); }else {trigger_error(I18992 .$IIlLIIl, E_USER_WARNING); }return $ext; }}$lLlIIlL =Array(0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31); function TlTlTTl($num) {$num =intval($num); if($num <10) {$num ="0".$num; }return $num; }function TlTlTT1($month, $year) {global $lLlIIlL; if($month != 2) {$day =$lLlIIlL[$month]; }else {$day =28; while(checkdate($month, $day+1, $year)) {$day ++; }}return $day; }function TlTlTIT(&$day, &$month, &$year) {$weekDay =date("w", mktime(0, 0, 1, $month, $day, $year)); if($weekDay >0) {$day += (7 -$weekDay); }$I1l1l11 =TlTlTT1($month, $year); if($day >$I1l1l11) {$day -= $I1l1l11; if($month >11) {$month =1; $year++; }else {$month++; }}}function TlTlTII($year) {$num =date(I18993, mktime(0, 0, 1, 1, 1, $year +1)); $day =31; while($num <50) {$num =date(I18993, mktime(0, 0, 1, 12, $day, $year)); $day--; }return $num; }function TlTlTIl($value, &$month, &$year) {if($month -$value <1) {$year--; $month =12 -$value +$month; }else {$month -= $value; }}function TlTlTI1() {}function TlTlTlT(&$db, $lLlIIl1) {$aCounters =Array(); switch($lLlIIl1) {case "day"; while($db->next_record()) {$aCounters[$db->Record["date_year"]][$db->Record["date_month"]][$db->Record["date_day"]] =$db->Record[I18994]; }break; case "month"; while($db->next_record()) {$aCounters[$db->Record["date_year"]][$db->Record["date_month"]] =$db->Record[I18994]; }break; case "year"; while($db->next_record()) {$aCounters[$db->Record[I18995]] =$db->Record[I18994]; }break; case "week"; while($db->next_record()) {$aCounters[$db->Record[I18995]][$db->Record["date_week"]] =$db->Record[I18994]; }break; }return $aCounters; }function TlTlTlI($lLlIIl1, &$aCounters, &$ILllLLL, $lLlIILI) {$res =0; $year =$ILllLLL["year"]; $month =intval($ILllLLL["month"]); $day =$ILllLLL[I18996]; switch($lLlIIl1) {case I18996; $I1l1l11 =TlTlTT1($month, $year); for($i=0;$i<$lLlIILI;$i++) {if(($day +$i) >$I1l1l11) {$day =1 -$i; if($month >11) {$month =1; $I1l1l11 =31; $year++; }else {$month++; $I1l1l11 =TlTlTT1($month, $year); }}$res += intval($aCounters[$year][$month][($day +$i)]); }break; case "month"; for($i=0;$i<$lLlIILI;$i++) {if($month +$i >12) {$month -= 12; $year++; }$res += intval($aCounters[$year][$month +$i]); }break; case "year"; for($i=0;$i<$lLlIILI;$i++) {$res += intval($aCounters[$year +$i]); }break; case "week"; global $db; $week =$ILllLLL["week"]; $lLlIILl =TlTlTII($year); $lLlIILL =date(I18993, mktime(0, 0, 1, 1, 1, $year +1)); $lLlIIL1 =date(I18993, mktime(0, 0, 1, 12, 31, $year)); $i =0; $lLlII1I =$week +$i; if($lLlII1I >$lLlIILl) {$week =1 -$i; $year++; $lLlIILl =TlTlTII($year); $lLlIILL =date(I18993, mktime(0, 0, 1, 1, 1, $year +1)); }if($lLlII1I == $lLlIILl) {$lLlII1l =$lLlII1I; }elseif($lLlII1I == 1) {if($ILllLLL[I18996] <10) {$lLlII1l =1; }else {if($lLlIIL1 == 1 && $lLlIILL == 1) {$lLlII1l =$lLlIILl +1; $lLlII1L =1; }elseif($lLlIIL1 >1 && $lLlIILL == 1) {$lLlII1l =1; }elseif($lLlIIL1 == 1) {$lLlII1l =$lLlIILl +1; $lLlII1L =0; }elseif($lLlIILL >1) {}}}else {$lLlII1l =$lLlII1I; }$res += intval($aCounters[$year][$lLlII1l]); if(isset($lLlII1L)) {$res += intval($aCounters[$year+1][$lLlII1L]); }break; }return $res; }$lLI111I =0; if(isset($mode)&&$mode==I18997){ $lLI111I =1; }if(!$lLI111I){ require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .'init.php'; }$lLlII11 =""; $moduleName ='news'; $lLlIlII =$moduleName .I18998; $mModule =&$frn->Core->GetModule($moduleName); $lLlIlIl =&$frn->Core->GetModule($lLlIlII); $lLlIlIL =$lLlIlIl->GetOption("show_forum_count_replies"); $lLlIlI1 =false; $lLlIllI =(in_array("ext_discussion", $lLlIlIl->GetOption("extensions")) && $frn->Core->IsInstalled("ext_discussion")); $lLlIlll =$lLlIlIl->GetOption(I18999); $archivePeriod =$lLlIlIl->GetOption("archive_period"); $lLlIllL =$lLlIlIl->GetOption("archive_page_size"); $lLlIll1 =$lLlIlIl->GetOption('show_count_news'); $lLlIlLI =""; if($lLlIlIl->GetOption(I19000)) {$lLlIlLI =" AND archive=1"; }if(isset($frn->Vars["id"])) $frn->Vars["id"] =intval($frn->Vars["id"]); $catoffset =0; if(isset($frn->Vars[I19001])) $catoffset =intval($frn->Vars[I19001]); $frn->Gui->addBlock($moduleName, 'templates/' .$moduleName .'_archive.tpl'); if ($lLlIllI) {$frn->Gui->addBlock($lLlIlII .'_list', 'templates/' .$moduleName .I19002); $vItemData =$I1LLLlL =$IILIILl =array ();$lLlIlIl->moduleName =$lLlIlII; $IIlLIIl ="ext_discussion"; if ($frn->Core->IsInstalled($IIlLIIl)) {$extension =&GetExtension($IIlLIIl); if (is_object($extension)) {$mModule->InitEngine($frn, $db); $extension->Init($frn, $lLlIlIl, $mModule->Engine); $extension->mod->module =&$lLlIlIl; $extension->mod->langData =$lang_data; $extension->mod->db =&$db; }else {$extension =false; trigger_error("CMS_ActModule::Init: class_name is not specified for module $IIlLIIl", E_USER_WARNING); }}if ($lLlIllI =isset($extension) && is_object($extension)) {$extension->TTIllTl(0, $vItemData, $I1LLLlL, $IILIILl); $extension->TTIll1I(0, $vItemData, $I1LLLlL, $IILIILl, false); }}if(isset($frn->Vars["id"]) && $frn->Vars["id"] >0) {if($lLlIllI && isset($frn->Vars["forum_ext"])) {$urlParams =Array( I19003=>$frn->Vars[I19003], "offset"=>$frn->Vars["offset"], I19001=>$catoffset, "date_from"=>$frn->Vars["date_from"], I19004=>1); $lLlIlLl =Array( "name"=>"forum", "extentionName"=>$moduleName, "extId"=>$frn->Vars[I19003], I19005=>$urlParams); }$sql ="SELECT *, DATE_FORMAT(date,'".$frn->DFMT["db"]."') AS fdate ". "FROM " .$mModule->GetTableName() .I19006 ."WHERE public=1 AND lang='$lang_data' and id='".$frn->Vars[I19003]."'"; if($record =$db->getRecord($sql)) {$lLlIlLL["date"] =$record["fdate"]; $lLlIlLL["header"] =$record[I19007]; $lLlIlLL["announce"] =$frn->Gui->MYnl2br($record["announce"]); if(!(!$lLlIlIl->GetOption("show_body_when_forum") && $lLlIlLl["name"] == I19008)) {$lLlIlLL["body"] =$frn->Gui->getAbs($moduleName .":body_content", Array("body" => $frn->Gui->MYnl2br($record["body"]))); }$lLlIlLL[I19009] ="justify"; $lLlIlLL["url_params"] ="offset=".$frn->Vars["offset"].I19010.$catoffset."&date_from=".$frn->Vars["date_from"]; if($lLlIllI && is_object($extension)) {$none =array ('skip_item_restoration' => 1); $extension->TITT1I1($moduleName); $extension->mod->id =$frn->Vars['id']; if ($frn->Vars[I19011] == 'forum_add') {$extension->mod->action ='forum_add'; $extension->ILL1II1->IIL1llI ='header'; }$extension->TTIl1IT($frn->Vars['id'], $lLlIlLL, $none, $none); if ($frn->Vars[I19011] == I19012) {$extension->ILL1IIL->Engine =false; $extension->TITT1I1($moduleName); }$aNavData =Array(); $aNavData[I19003] =$record[I19003]; $aNavData["id_sublink"] =$record["sublink"]; $aNavData =$frn->ApplyNav($aNavData); if($frn->Vars[I19004] == "") {$lLlIlLL["forum_link"] =$frn->Gui->getAbs($moduleName .I19013, Array("forum_href" => $lLlIlIl->GetFrontLink(), "url_params" => "&date_from=".$frn->Vars["date_from"].I19010.$catoffset.I19014.$frn->Vars["offset"]."&forum_ext=1") +$aNavData); if($lLlIlIL || $lLlIlI1) {if($lLlIlIL) {$lLlIlL1 =$extension->TITT1Il($moduleName, $frn->Vars[I19003]); $lLlIlLL["count_replies"] =$frn->Gui->getAbs($moduleName .":forum_count_replies", Array(I19015 => intval($lLlIlL1[$frn->Vars[I19003]]["all"]))); }}}$lLlIlLL["forum_extention"] =$frn->Gui->get($moduleName .":forum_extention", $lLlIl1I); $lLlIlLL += $aNavData; $extension->TTIl1T1($cId, $lLlIlLL, $lLlIlLL, $none); }EventApplyVars($frn, "body_itemD", $lLlIlLL); $lLlIl1l[$moduleName] =$frn->Gui->get($moduleName .I19016,$lLlIlLL); $IIl1IL1 =unserialize($record['sm_data']); $ModuleHtml["headers"] =$frn->TITlTl1($ModuleHtml["headers"], $IIl1IL1); if($record["details_noindex"] == I19017 || !$GLOBALS['IIlLIlL']){ $frn->Gui->setRobotsMeta(false); }$HtmlBody .= $frn->Gui->get($moduleName, $lLlIl1l); }else {$HtmlBody .= $frn->Gui->getAbs("common:page_not_found", ""); }}elseif(isset($frn->Vars["date_from"])) {$dateFrom =$frn->Vars[I19018]; $lLlIl1L =explode("-", $dateFrom); for($i =0; $i <3; $i++){ $dateFrom[$i] =isset($dateFrom[$i]) ?(int)$dateFrom[$i] :0; }$lLlIl11 =mktime(0, 0, 0, (int)$lLlIl1L[1], (int)$lLlIl1L[2], (int)$lLlIl1L[0]); $lLlIILI =intval($archivePeriod); if(mb_strpos($archivePeriod, "month") !== false) {$lLlIl1L[1] += $lLlIILI; $lLlILII ="month"; }elseif(mb_strpos($archivePeriod, "year") !== false) {$lLlIl1L[0] += $lLlIILI; $lLlILII =I19019; }elseif(mb_strpos($archivePeriod, I18996) !== false) {$lLlIl1L[2] += $lLlIILI; $lLlILII =I18996; }elseif(mb_strpos($archivePeriod, "week") !== false) {$lLlIl1L[2] += 7*$lLlIILI; $lLlILII ="week"; }$lI1l1l1 =mktime(23, 59, 59, $lLlIl1L[1], $lLlIl1L[2], $lLlIl1L[0]) -86400; $aData[I18996] =date("d", $lLlIl11); $aData["month"] =date(I19020, $lLlIl11); $aData[I19019] =date("Y", $lLlIl11); $aData["week"] =date(I18993, $lLlIl11); $listItems["begin_date"] =$frn->Gui->get($moduleName .":".$lLlILII.I19021, $aData); $aData[I18996] =date("d", $lI1l1l1); $aData["month"] =date(I19020, $lI1l1l1); $aData[I19019] =date("Y", $lI1l1l1); $listItems["end_date"] =$frn->Gui->get($moduleName .I19022.$lLlILII."_end_date", $aData); $listItems["date_period"] =$frn->Gui->get($moduleName .":date_period_".$lLlILII, $listItems); $lLlILIl =($lLlIllI && $lLlIlIl->GetOption("show_forum_link_in_list")); $filter ="public=1 AND lang='$lang_data' AND date>='".DateTools::toMysqlDate($lLlIl11).I19023.DateTools::toMysqlDate($lI1l1l1)."'".$lLlIlLI; $sql ="SELECT id, date from " .$mModule->GetTableName() ." WHERE $filter"; $db->query($sql); $frn->Pager->MaxCount =$db->num_rows(); $frn->Pager->TI1TT1I(); $lll1lII =$frn->Pager->GetPager(); $pager =$frn->Pager->GetPagerHtml( $lll1lII, $frn->ActiveScript."?date_from=".$dateFrom.I19010.$catoffset."&offset=[START]"); $listItems[I19001] =$catoffset; if($frn->Pager->MaxCount){ $listItems[I19024] =$pager; $urlParams =I19010.$catoffset."&date_from=".$dateFrom.I19014.$frn->Vars["offset"]; $sql ="SELECT *, DATE_FORMAT(date,'".$frn->DFMT["db"].I19025. "FROM " .$mModule->GetTableName() .I19006. "WHERE $filter ORDER BY ".$frn->Pager->TI1TTlT().", id asc  ".$frn->Pager->TI1TTlI(); $db->query($sql); if ($lLlILIl && is_object($extension)) {$lLlILIL =Array(); while($db->next_record()) {$lLlILIL[] =$db->Record[I19003]; }$db->seek(); $lLlILI1 =implode(",", $lLlILIL); if ($lLlIlIL) {$lLlIlL1 =$extension->TITT1Il($moduleName, $lLlILI1); }}$listItems['list_items'] =I19026; while($db->next_record()) {$lLlIlLL =Array(); $aNavData =Array(); $aNavData[I19003] =$db->Record[I19003]; $aNavData["id_sublink"] =$db->Record["sublink"]; $aNavData =$frn->ApplyNav($aNavData); if($lLlILIl) {if($lLlIlIL) {$lLlIlLL[I19015] =$lLlIlL1[$db->Record[I19003]]["all"]; }$lLlIlLL["forum_href"] =$lLlIlIl->GetFrontLink(); $lLlIlLL[I19027] =$urlParams."&forum_ext=1"; $lLlIlLL["forum_link_list"] =$frn->Gui->getAbs($moduleName .":forum_link_list", $lLlIlLL +$aNavData); }$lLlIlLL["date"] =$db->Record[I19028]; $lLlIlLL[I19007] =$db->Record[I19007]; $lLlIlLL["announce"] =nl2br($db->Record["announce"]); $lLlIlLL["details"] =""; if(!empty($db->Record[I19029])) $lLlIlLL["details"] =$frn->Gui->getAbs($moduleName .":details",Array(I19027=>$urlParams) +$aNavData); EventApplyVars($frn, "body_item", $lLlIlLL); $listItems["list_items"] .= $frn->Gui->get($moduleName .I19030, $lLlIlLL); }$listItems["body_list_items"] =$frn->Gui->get($moduleName .":list_items", $listItems); }else{ $listItems["body_list_items"] =$frn->Gui->get($moduleName .":empty_list_items", $listItems); }$lLlIl1l[$moduleName] =$frn->Gui->get($moduleName .I19031,$listItems); $lLlIl1l["offset"] =$frn->Vars["offset"]; $HtmlBody .= $frn->Gui->get($moduleName, $lLlIl1l); }else {$curTime =time(); $lI1l1l1 =strtotime($lLlIlll); $sql ="SELECT UNIX_TIMESTAMP(date) as first_date FROM " .$mModule->GetTableName() ." WHERE lang='".$lang.I19032.DateTools::toMysqlDate($lI1l1l1)."' ORDER BY date ASC LIMIT 1"; $db->query($sql); if($db->next_record() >0) {$lI1l1l1 =$db->Record["first_date"]; $lLlIILI =intval($archivePeriod); if($lLlIILI == 0) {$lLlIILI =1; }$curDate =getDate($curTime); $year =$curDate[I19019]; $I1l11LI =getDate($lI1l1l1); $lLlIlIl->InitPager($frn->Pager); $frn->Pager->InitPager($catoffset, $lLlIllL); $index =0; if(mb_strpos($archivePeriod, "month") !== false) {$lLlIIl1 ="month"; $day =28; $month =$curDate[I19033]; $lI1l1l1 =mktime(0, 0, 0, $I1l11LI[I19033], 0, $I1l11LI[I19019]); $curTime =$lI1l1l1 +1; $lLlILlI =0; while($curTime >$lI1l1l1) {$day =TlTlTT1($month, $year); $III1l1L[$index][I18996] =$day; $III1l1L[$index]["month"] =$month; $III1l1L[$index][I19019] =$year; if($lLlIILI >1) {TlTlTIl($lLlIILI -1, $month, $year); }$curTime =mktime(0, 0, 0, $month, 1, $year); if($curTime <$lI1l1l1) {$lLlILll[$index][I18996] ="01"; $lLlILll[$index]["month"] =$I1l11LI[I19033]; $lLlILll[$index][I19019] =$I1l11LI[I19019]; }else {$lLlILll[$index][I18996] ="01"; $lLlILll[$index][I19034] =$month; $lLlILll[$index][I19019] =$year; TlTlTIl(1, $month, $year); $curTime =mktime(0, 0, 0, $month, 1, $year); }$index++; }}elseif(mb_strpos($archivePeriod, I19019) !== false) {$lLlIIl1 =I19019; $lI1l1l1 =mktime(0, 0, 0, 0, 0, $I1l11LI[I19019]); $curTime =$lI1l1l1 +1; while($curTime >$lI1l1l1) {$III1l1L[$index][I18996] ="31"; $III1l1L[$index][I19034] ="12"; $III1l1L[$index][I19019] =$year; if($lLlIILI >1) {$year -= ($lLlIILI -1); }$lLlILll[$index][I18996] ="01"; $lLlILll[$index][I19034] ="01"; $lLlILll[$index][I19019] =$year; $year--; $curTime =mktime(0, 0, 0, 1, 1, $year); $index++; }}elseif(mb_strpos($archivePeriod, I18996) !== false) {$lLlIIl1 =I18996; $lLlILlL =$lLlIILI -1; while($curTime >$lI1l1l1) {$III1l1L[$index][I18996] =date(I19035, $curTime); $III1l1L[$index][I19034] =date(I19020, $curTime); $III1l1L[$index][I19019] =date("Y", $curTime); if($lLlILlL >0) {$curTime =strtotime("-".$lLlILlL." days", $curTime); }$lLlILll[$index][I18996] =date(I19035, $curTime); $lLlILll[$index][I19034] =date(I19020, $curTime); $lLlILll[$index][I19019] =date("Y", $curTime); $curTime =strtotime(I19036, $curTime); $index++; }}elseif(mb_strpos($archivePeriod, "week") !== false) {$lLlIIl1 ="week"; TlTlTIT($curDate["mday"], $curDate[I19033], $curDate[I19019]); $curTime =mktime(0, 0, 1, $curDate[I19033], $curDate["mday"], $curDate[I19019]); $lLlILl1 =0; while($curTime >$lI1l1l1) {$III1l1L[$index][I18996] =date(I19035, $curTime); $III1l1L[$index][I19034] =date(I19020, $curTime); $III1l1L[$index][I19019] =date(I19037, $curTime); $lLlILLI =date(I18993, $curTime -43200); $III1l1L[$index]["week"] =$lLlILLI; $curTime =strtotime("-1 week", $curTime); $lLlILLl =strtotime("+1 day", $curTime); $lLlILll[$index][I18996] =date(I19035, $lLlILLl); $lLlILll[$index][I19034] =date(I19020, $lLlILLl); $lLlILll[$index][I19019] =date(I19037, $lLlILLl); $lLlILll[$index]["week"] =$lLlILLI; $index++; }}}$lLlILII =$lLlIIl1; $frn->Pager->MaxCount =sizeof($lLlILll); $frn->Pager->TI1TT1I(); $lLlILLL =Array(); $lLlILLL[I19001] =$catoffset; $lLlILL1 =$frn->Pager->TI1TTll()-1; $endPos =min(sizeof($lLlILll), $frn->Pager->TI1TTl1()); if($lLlIll1) {$lLlIL1I =DateTools::toMysqlDate(mktime(0, 0, 0, $lLlILll[$endPos -1][I19034], $lLlILll[$endPos -1][I18996], $lLlILll[$endPos -1][I19019])); $I1l11LI =DateTools::toMysqlDate(mktime(23, 59, 59, $III1l1L[$lLlILL1][I19034], $III1l1L[$lLlILL1][I18996], $III1l1L[$lLlILL1][I19019])); switch($lLlIIl1) {case I18996; $lLlIL1l ="GROUP BY MONTH(date), YEAR(date), DAYOFMONTH(date)"; $lLlIL1L =", DAYOFMONTH(date) AS date_day, MONTH(date) AS date_month, YEAR(date) AS date_year"; break; case I19034; $lLlIL1l ="GROUP BY MONTH(date), YEAR(date)"; $lLlIL1L =", MONTH(date) AS date_month, YEAR(date) AS date_year"; break; case I19019; $lLlIL1l ="GROUP BY YEAR(date)"; $lLlIL1L =", YEAR(date) AS date_year"; break; case "week"; $lLlIL1l ="GROUP BY WEEK(date, 1), YEAR(date)"; $lLlIL1L =", WEEK(date, 1) AS date_week, YEAR(date) AS date_year"; break; }$sql ="SELECT COUNT(*) AS num".$lLlIL1L.I19038 .$mModule->GetTableName() ." WHERE lang='".$lang_data."'".$lLlIlLI." AND public=1 AND date BETWEEN '".$lLlIL1I."' AND '".$I1l11LI.I19039.$lLlIL1l." ORDER BY date DESC"; $db->query($sql); $aCounters =TlTlTlT($db, $lLlIIl1); }$IIlL1l1 ="_link"; $lLlILLL['list_dates'] =I19026; for($i=$lLlILL1;$i<$endPos;$i++) {$aData['week'] =isset($lLlILll[$i][I19040]) ?$lLlILll[$i][I19040] :I19026; $aData[I18996] =TlTlTTl($III1l1L[$i][I18996]); $aData[I19034] =TlTlTTl($III1l1L[$i][I19034]); $aData[I19019] =$III1l1L[$i][I19019]; $lLlILLL["end_date"] =$frn->Gui->get($moduleName .I19022.$lLlILII."_end_date", $aData); $aData[I18996] =TlTlTTl($lLlILll[$i][I18996]); $aData[I19034] =TlTlTTl($lLlILll[$i][I19034]); $aData[I19019] =$lLlILll[$i][I19019]; if($lLlIll1) {$counter =TlTlTlI($lLlIIl1, $aCounters, $lLlILll[$i], $lLlIILI); $aData["count_" .$moduleName] =$counter; $lLlILLL["count_" .$moduleName] =$frn->Gui->get($moduleName .I19022.$lLlILII.I19041 .$moduleName, $aData); if($counter >0) {$IIlL1l1 ="_link"; }else {$IIlL1l1 =""; }}$lLlILLL["begin_date"] =$frn->Gui->get($moduleName .I19022.$lLlILII.I19021, $aData); $lLlILLL[I19018] =$lLlILll[$i][I19019]."-".$lLlILll[$i][I19034].I19042.$lLlILll[$i][I18996]; EventApplyVars($frn, "body_".$lLlILII."_dates", $lLlILLL); $lLlILLL["list_dates"] .= $frn->Gui->get($moduleName .":list_dates_".$lLlILII.$IIlL1l1, $lLlILLL); }$lll1lII =$frn->Pager->GetPager(); $pager =$frn->Pager->GetPagerHtml($lll1lII, $frn->ActiveScript.I19043); $lLlILLL[I19024] =$pager; $lLlILLL[$moduleName] =$frn->Gui->get($moduleName .":body_dates", $lLlILLL); $HtmlBody .= $frn->Gui->get($moduleName, $lLlILLL); }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; 