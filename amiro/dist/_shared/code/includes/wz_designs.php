<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       36885 xkqwugitlpzlykplwxsspusqxmkkqpiyqklguguzglwlwzrwwnszpggglqywsumpswulpnir
 */ ?><?php foreach(array(19228=>"",19229=>"JZB|JZnP",19230=>"|YJZnK",19231=>"DIZJJ",19232=>"CA|SQDMPnD",19233=>"MS",19234=>"tBGQ|WHJD",19235=>"CMAZrS",19236=>"DIZJJ|rHCD",19237=>"'?",19238=>"'?zNs?",19239=>"fHJSQr|GZtO",19240=>"WOQWKQS",19241=>"`LGP",19242=>"WZt|MS",19243=>"WnZIQ",19244=>"ZWtMvQ|DGQW|YJHWKD",19245=>'wjzddqd|gzTo',19246=>"WOQWK|fHrI",19247=>"SHIZMn|IZxJQn",19248=>"fWSHWK|WOQWKQS",19249=>"SQDMPn|nuI",19250=>"rQDQJJQr|MS",19251=>"SQfZuJt|GZWKQt",19252=>'_',19253=>'jhNp',19254=>"CMAZrS%",19255=>'CQYnZIQ',19256=>"SHIZMn|WOQWKQS",19257=>"truQ",19258=>'IHSuJQ',19259=>"fZWtMHn",19260=>"DJZDOQD",19261=>"ZPrQQIQnt|fHrI",19262=>"QxG|GQrMHS",19263=>'hk',19264=>"WHIGZnB|urJ",19265=>"uDQrnZIQ",19266=>"QIZMJ",19267=>"WMtB",19268=>"fHrSQr|tBGQ",19269=>"QxGMrQ|SZtQ",19270=>"IZMJ",19271=>"JZDtnZIQ",19272=>"IZMJ%HrSQr|DuYLQWt",19273=>"IZMJ%fHHtQr",19274=>"OtIJ",19275=>"wrQZtQ?uDQr",19276=>"&```",19277=>"`tGJ",19278=>"iZMJQr`GOG",19279=>"MnDtZJJQS|JZnPD",19280=>"'?hRsqR?yb?",19281=>"CJZnP",19282=>"JMnK",19283=>"YHSB",19284=>"GuYJMW=1?",19285=>"?ZnS?CJ`MS='",19286=>"OtIJ|DHurWQ",19287=>"CMAZrS%JZBHutD",19288=>'IQIYQr|fHrI',19289=>"uDQr|fHrI",19290=>"SHIZMn|nZIQ",19291=>"CMAZrS%SHIZMn|rHC",19292=>"GZWKQtD",19293=>"DMtQIZG|MtQID",19294=>"tBGQ|nZIQ",19295=>"tBGQ|MtQID",19296=>"nuI",19297=>"GrQvuDQrnZIQ",19298=>"nuIMIZPQ|IHSQ",19299=>"IuJtMWZt",19300=>"nZIQ",19301=>"WZt|JMDt",19302=>"WZtQPHrMQD|fHrI",19303=>"?zNs?}?",19304=>"GZPQr",19305=>"coqRq?CJ`JZnP='",19306=>"|tOIY|",19307=>"WJZBHutD",19308=>'fHJSQr|GZtO',19309=>"MtQID") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!defined('AMI_ENVIRONMENT')){header('HTTP/1.0 403 Forbidden');die('Forbidden, invalid URL! '.__FILE__.' at '.__LINE__);} function TlTlIIT(&$frn,$keys) {foreach($keys as $key) $frn->AddStatusMsg($key,'red'); }function TlTlIII($cId, $lLL1LIl =true, $lLL1LIL=""){ global $frn; $res =I19228; $db2 =new DB_si; $sql ="SELECT lang, count(*) as c ". "FROM cms_wz_design_layouts ". "WHERE id_design='$cId' ". "GROUP BY lang"; $db2->query($sql); if($db2->num_rows()>1){ while($db2->next_record()){ $lLL1LI1 =array("id"=>$cId, I19229=>$db2->Record["lang"], "lay_count"=>$db2->Record["c"]); $lLL1LI1["target"] =$lLL1LIl?I19230:"_self"; $active =($db2->Record["lang"]==$lLL1LIL)?"_active":I19228; $res.= $frn->Gui->get("wizard:lang_layouts_row".$active, $lLL1LI1); }}return $res; }$lLI111I =0; if(isset($mode)&&$mode==I19231){ $lLI111I =1; }if(!$lLI111I){ require_once $GLOBALS['DEFAULT_INCLUDES_PATH'] .'init.php'; }require_once $GLOBALS['CLASSES_PATH'] .'Layouts.php'; $III1LII =&$frn->Core->GetModule(I19232); $lLL1LlI =0; $lLIL1IL =@parse_url($ROOT_PATH_WWW); $builder_domain =str_replace("www.", I19228, $lLIL1IL["host"]); $sql ="SELECT id FROM cms_host_users WHERE domain_orig='".$builder_domain."'"; $db->query($sql); if ($db->next_record()){ $lLL1LlI =intval($db->Record[I19233]); }if(!isset($frn->VarsPost['requester']) && $III1LII->GetOption("require_login")){ $mMembers =&$frn->Core->GetModule("members"); $frn->Member->requireLogin($ROOT_PATH_WWW.$mMembers->GetFrontLink(), $ROOT_PATH_WWW.$III1LII->GetFrontLink()); $userID =$frn->Member->getUserInfo(I19233); $sql ="SELECT id FROM cms_host_users WHERE id_member='".$userID ."' AND id_reseller=id"; $db->query($sql); if ($db->next_record()){ $lLL1LlI =intval($db->Record[I19233]); }}$Layout =new Layouts($frn, $lLI1Il1); $lLL1Lll =&$frn->Core->GetModule("wz_design_cat"); $lLL1LlL =&$frn->Core->GetModule("wz_design_layouts"); $cols =$III1LII->GetOption("cols"); $rows =$III1LII->GetOption("rows"); $lLL1Ll1 =$III1LII->GetOption(I19234); $lLL1LLI =$III1LII->GetOption("sitemap_cols"); $lLL1LLl =$III1LII->GetOption("lay_cols"); $frn->InitMessages($frn->Gui->ParseLangFile("templates/lang/_wz_msgs.lng")); $aWords =$frn->Gui->ParseLangFile("templates/lang/_wz_items.lng"); $frn->SetsTemplate =I19235; $lLlLlLI =array(); $lLL1LLL =false; $lLL1LL1 =$lLI1ILI; $catid =0; if(isset($frn->VarsGet["catid"])) $catid =intval($frn->VarsGet["catid"]); $lLL1L1I =$rows*$cols; $frn->Pager->PageSize =$lLL1L1I; $frn->Gui->addBlock(I19235,"templates/wizard.tpl"); $vData =Array(); $lLL1L1l =Array(); if($lLI111I){ $frn->Core->Cache->Disable(); $lLL1L1L =I19228; $cols =$III1LII->GetOption("small_cols"); $rows =$III1LII->GetOption(I19236); $cat_id =$III1LII->GetOption("small_cat_id"); $lLL1L11 =($III1LII->GetOption("small_sort")=="rand")?1:0; $III1LII->TTlITI1("_small"); $III1LII->PushPager($frn->Pager); $lLL11II =$ROOT_PATH_WWW.$III1LII->GetFrontLink(); $filter ="wd.public=1 AND wd.lang='$lang_data' and filename='".$Layout->I1lI1ll.I19237; if($cat_id>0) $filter .= " AND (id_cat='$cat_id' OR id_cat LIKE '%;$cat_id;%') "; $vData["pager"] =$pager; $lLL11Il =$frn->Pager->TI1TTlT().", wd.id asc "; if($lLL1L11){ $lLL11Il ="RAND()"; }$sql ="SELECT wd.id as id, wd.lang as wlang, header, filename, folder_path, clayouts, author, ". "wc.id as cid, wc.name as cname, wc.body as cbody ". "FROM cms_wz_designs as wd ". "left join cms_wz_design_layouts as wl on wl.id_design=wd.id ". "left join cms_wz_design_cat as wc on (wc.id=wd.id_cat OR wd.id_cat LIKE CONCAT('%;',wc.id,';%'))  ". "WHERE wl.lang='".$lang_data.I19238.$filter." GROUP BY wd.id ORDER BY ".$lLL11Il." ".$frn->Pager->TI1TTlI(); $db->query($sql); $db2 =new DB_si; $i =$row =$col =0; if($db->num_rows()){ while($db->next_record()) {$vItem =Array(); $vItem["wz_link"] =$lLL11II; $vItem["lang_layouts"] =TlTlIII($db->Record[I19233]); $lLIlLII =$lLL1LL1.$db->Record[I19239]."/"; $lLL11IL ="_thmb_".$db->Record["wlang"]; $vItem[I19233] =$db->Record[I19233]; if($vItem[I19233]==$lLL11I1){ $vItem["checked"] =I19240; }$vItem["name"] =$db->Record["header"]; $vItem["image"] =$lLIlLII.$db->Record["filename"].$lLL11IL.I19241; $vItem["clayouts"] =$db->Record["clayouts"]; $vItem["author"] =$db->Record["author"]; $vItem[I19242] =($cat_id==0 && $III1LII->GetOption("multicat"))?$db->Record["cid"]:I19228; $vItem["cat_name"] =($cat_id==0 && $III1LII->GetOption("multicat"))?$db->Record[I19243]:I19228; $vItem["cat_body"] =($cat_id==0 && $III1LII->GetOption("multicat"))?$db->Record["cbody"]:I19228; if($i && (($col %$cols) == 0) ){$vData["body"].= $frn->Gui->getAbs("wizard:small_item_Vsplitter"); $row++; $col =1; }else{ $col++; if($i){ $vData["body"].= $frn->Gui->getAbs("wizard:small_item_Hsplitter"); }}EventApplyVars($frn, "items_list", $vItem); $vData["body"] .= $frn->Gui->get("wizard:small_item_row", $vItem); $i++; }$lLL1L1L =$frn->Gui->get("wizard:small_items_list", $vData); }else{ $vData["body"] .= $frn->Gui->getAbs("wizard:small_items_list_empty"); $lLL1L1L =$frn->Gui->get("wizard:small_items_list", $vData); }if($III1LII->issetProperty(I19244)){ $frn->SetSpecialBlock($III1LII->GetProperty(I19244), $lLL1L1L); }elseif($III1LII->issetProperty("spec_blocks")){ $frn->SetSpecialBlock($III1LII->GetProperty("spec_blocks"), $lLL1L1L); }$III1LII->PopPager($frn->Pager); $III1LII->TTlITlT(); }else {$frn->Core->Cache->Disable(); require_once $GLOBALS['CLASSES_PATH'] .'CMS_Member.php'; require_once $GLOBALS[I19245] .'Subscriber.php'; require_once $GLOBALS[I19245] .'Builder.php'; $frn->Vars[I19233] =intval($frn->Vars[I19233]); $oMember =new Subscriber($none); $oMember->setUsed("state", false, false); $oMember->setUsed('username', false); $oMember->setObligatory('password|firstname|lastname|email', true); $oMember->setObligatory('username|address1|zip', false); $I1lLIl1 =$oMember->getScripts($frn, I19228, array("check_address1"=>0, "check_zip"=>0)); $lLlLlLI["check_member_script"] =$I1lLIl1[I19246]; $lLlLlLI["submit_button"] =$frn->Gui->getAbs("wizard:submit_button"); $lLlLlLI["offset"] =$frn->Vars["offset"]; $lLL11lI =$III1LII->GetOption(I19247) -2; $lLL11ll =Array( I19247=>$III1LII->GetOption(I19247), "domain_maxlen_tmp"=>$lLL11lI );$lLlLlLI += $lLL11ll; $I1lLIlI =array(); $lLL11I1 =0; $III1L11 =I19228; $I1lLIlI["options_form"] =array("ft2_checked"=>I19240, "fpm_checked"=>I19240, I19248=>I19240); $I1lLIlI["agreement_form"] =I19228; $I1lLIlI["user_form"] =Array(); $cat_id =0; if($III1LII->GetOption("multicat") && isset($frn->VarsGet[I19242])){ $cat_id =intval($frn->VarsGet[I19242]); }$lLL11lL =I19228; if (isset($frn->VarsGet["design_num"])) {$lLL11lL =$frn->VarsGet[I19249]; }if(isset($frn->VarsPost['requester']) && $frn->VarsPost['requester']=='proxy'){ $builder =new RemoteBuilder($III1LII,$db,$frn); if(empty($frn->VarsPost["reseller_id"])){ $frn->VarsPost[I19250] =$lLL1LlI; }$res =$builder->TTTII1l($frn->VarsPost); ob_end_clean(); echo serialize($res); exit; }function TlTlIIl(&$vars) {global $III1LII; if(!$III1LII->GetOption('proxy_mode_enabled')) return 'localhost'; $III11II =$III1LII->GetOption("packets"); $IlLILIL =!in_array($vars["forder_type"], $III11II) ?$III1LII->GetOption(I19251) :$vars["forder_type"]; $lLL11l1 =$III1LII->GetAOption('proxy_policy'); if(!is_array($lLL11l1) || !isset($lLL11l1[$IlLILIL])) {trigger_error("Package type '$IlLILIL' not found in proxy_policy option. Building on localhost",E_USER_WARNING); return 'localhost'; }$lLL11l1 =$lLL11l1[$IlLILIL]; if(!is_array($lLL11l1)) {trigger_error("Broken proxy_policy for package type '$IlLILIL'. Building on localhost",E_USER_WARNING); return 'localhost'; }$lLL11LI =array(); $p =0; foreach($lLL11l1 as $str) {$a =explode(I19252,$str); $w =intval($a[0]); if(sizeof($a)!=2 || $w<0 || $w>100) {trigger_error("Broken proxy_policy entry '$str' for package type '$IlLILIL'. Ignored",E_USER_WARNING); continue; }if(!$w) continue; $p += $w; $lLL11LI[$p] =$a[1]; }if(!$p) {trigger_error("Remote builder weight sum is zero for package type '$IlLILIL'. Building on localhost",E_USER_WARNING); return 'localhost'; }if($p!=100) {$k =100/$p; $lLL11Ll =array(); foreach($lLL11LI as $p=>$url) {$i =round($p*$k); if($i>100) $i =100; $lLL11Ll[$i] =$url; }$lLL11LI =$lLL11Ll; }$r =rand(0,100); foreach($lLL11LI as $p=>$url) if($r<=$p) return $url; trigger_error("Cannot find remote builder URL for package type '$IlLILIL' (rand=$r). Building on localhost",E_USER_WARNING); return 'localhost'; }$lLL11LL =false; $lLL11L1 =true; if($frn->VarsPost["faction"] == "create") {$conn->SetBenchType(I19253); $lLL11LL =true; $frn->VarsGet =array_merge($frn->VarsGet, $frn->VarsPost); $url =TlTlIIl($frn->VarsGet); if(empty($frn->VarsGet[I19250])){ $frn->VarsGet[I19250] =$lLL1LlI; }if($url=='localhost'){ $builder =new Builder($III1LII,$db,$frn); }else{ $builder =new ProxyBuilder($III1LII,$db,$frn,$url); $frn->VarsGet[I19250] =$III1LII->GetOption('proxy_reseller_id'); }$lLL111I =$builder->TTTII1l($frn->VarsGet); }else {$builder =new Builder($III1LII,$db,$frn); if(!empty($frn->VarsGet["webname"])) {$lLL111I =$builder->TTTII1I($frn->VarsGet); }else {$lLL111I =$builder->TTTII1T(); }$lLL11L1 =$builder->TTTIIIT(); }if(!empty($lLL111I->msg['fatal'])) {$HtmlBody =$frn->Gui->getAbs(I19254.$lLL111I->msg['fatal'],array()); require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; exit; }if(!empty($lLL111I->domain)) {$I1lLIlI["user_form"][I19255] =$lLL111I->subdomain; if(!empty($lLL111I->msg['domain'])) {$lLL1L1l["status"] =str_replace("_domain_", $lLL111I->domain, $aWords["domain_name_used"]); $lLlLlLI[I19256] ="false"; }else {$lLL1L1l["status"] =str_replace("_domain_", $lLL111I->domain, $aWords["domain_name_free"]); $lLlLlLI[I19256] =I19257; }}if (isset($frn->VarsGet["fdesign_id"])) {$lLL11I1 =intval($frn->VarsGet["fdesign_id"]); }if ($lLL11I1) {$sql ="SELECT header FROM cms_wz_designs WHERE id = '$lLL11I1' LIMIT 1"; $db->query($sql); if ($db->next_record()) {$III1L11 =$db->Record["header"]; }}if(sizeof($lLL111I->msg[I19258])) TlTlIIT($frn,$lLL111I->msg[I19258]); if($lLL11LL && $lLL111I->errtype!='backend' || $frn->VarsGet[I19259]=="check_name") {$conn->SetBenchType(I19253); $I1lLIlI["user_form"] =$frn->VarsGet; $I1lLIlI["user_form"] =removeSpecial($I1lLIlI["user_form"], I19260); if(isset($frn->VarsGet["force_id"]) && $frn->VarsGet["force_id"]>0) {$lLL11I1 =$frn->VarsGet["force_id"]; $lLL1LLL =true; }$I1lLIlI["agreement_form"] =(isset($frn->VarsGet[I19261]) && $frn->VarsGet[I19261]=="1")?I19240:I19228; }if($lLL11LL && $lLL111I->errtype!=I19258) {$I1lLIlI =$frn->VarsPost; $I1lLIlI['username'] =$lLL111I->username; $I1lLIlI["admin_link"] =$lLL111I->admPathWWW."index.php"; $I1lLIlI[I19255] =$lLL111I->domain; $lLL111l =$III1LII->GetOption(I19262); $expire_date =date($frn->DFMT["php"], strtotime($lLL111l[stripslashes($frn->VarsPost["forder_type"])])); $III1LlI =array( "daemon_status" => $lLL111I->errtype=='none' ?I19263 :$lLL111I->msg['backend'], "company_name" => $frn->Core->GetOption("company_name"), "company_url" => $frn->Core->GetOption(I19264), "company_email" => $frn->Core->GetOption("company_email"), "user_ip" => getenv("REMOTE_ADDR"), I19265 => stripslashes($I1lLIlI['username']), "password" => stripslashes($frn->VarsPost["password"]), "email" => stripslashes($frn->VarsPost[I19266]), "firstname" => stripslashes($frn->VarsPost["firstname"]), "lastname" => stripslashes($frn->VarsPost["lastname"]), I19267 => stripslashes($frn->VarsPost[I19267]), "sitemap" => stripslashes($frn->VarsPost["sitemap"]), "sitemap_name" => $lLL111I->sitemapDescr, "webname" => $lLL111I->domain, I19268 => stripslashes($frn->VarsPost[I19268]), "front_link" => "http://$lLL111I->domain/", "admin_link" => "http://".$lLL111I->domain."/".$lLI1III, I19269 => $expire_date, "help" => stripslashes($frn->VarsPost["help"]), "referrer" => stripslashes($frn->VarsPost["referrer"]) );$sql ="select header from cms_wz_designs where id='".$frn->VarsGet["fdesign_id"]."'"; $db->query($sql); if($db->next_record()){ $III1LlI["design_name"] =stripslashes($db->Record["header"]); }$frn->Gui->addBlock(I19270,"templates/letters/_wz_letters_" .$lang_data .".tpl"); $recipientName =$frn->VarsPost["firstname"]." ".$frn->VarsPost[I19271]; $lLL111L =$III1LlI[I19268]; $aEvent =array( 'aSiteInfo' => $III1LlI, 'error' => $lLL111I->errtype );AMI_Event::fire('builder_on_site_creation', $aEvent, AMI_Event::MOD_ANY); switch($lLL111I->errtype){ case "none": $III1LlL =$frn->Gui->getAbs(I19272, Array("webname"=>$lLL111I->domain)); $mbody =$frn->Gui->get("mail:header", $III1LlI); $mbody .= $frn->Gui->get("mail:order_body", $III1LlI); $mbody .= $frn->Gui->get("mail:order_".$lLL111L, $III1LlI); $mbody .= $frn->Gui->get(I19273, $III1LlI); require_once($GLOBALS["CLASSES_PATH"]."Mailer.php"); $oMail =new Mailer(); $oMail->RecipientAddress =stripslashes($frn->VarsPost[I19266]); $oMail->RecipientName =$recipientName; $oMail->SenderAddress =$frn->Core->GetOption("company_robot_email"); $oMail->SenderName =$frn->Core->GetOption("company_name"); $oMail->Subject =$III1LlL; $oMail->Body =$mbody; $oMail->BodyFormat =I19274; $oMail->Prepare(); $mailSent =1; if(!$oMail->Send()){ $mailSent =0; trigger_error("WZ_BUILDER: sending email failed to [$recipientName]...", E_USER_WARNING); }$lLL1111 =array("VarsGet"=>$frn->VarsPost, "MailData"=>$III1LlI, "MailSent"=>$mailSent); $frn->TTITIl1($III1LII->GetName(), "Build site request ".$lLL111I->domain, 0, I19275, $lLL1111); $lIL1ILl =$III1LII->GetOption("wizard_user_email"); if(!empty($lIL1ILl)) {$oMail->RecipientAddress =$lIL1ILl; if(!$oMail->Send()){ trigger_error("WZ_BUILDER: sending email failed to [".$oMail->RecipientAddress."]...", E_USER_WARNING); }}$III1LlI["user_email_body"] =$oMail->Body; $III1LlL =$frn->Gui->getAbs("mail:admin_order_subject", Array("webname"=>$lLL111I->domain)); $mbody =$frn->Gui->get("mail:admin_order_body", $III1LlI); $oMail->RecipientAddress =$III1LII->GetOption("wizard_email"); $oMail->Subject =$III1LlL; $oMail->Body =$mbody; $oMail->Prepare(); if(!$oMail->Send()){ trigger_error("WZ_BUILDER: sending email failed to [".$oMail->RecipientAddress.I19276, E_USER_WARNING); }if($III1LII->GetOption("wizard_email_cc") != $III1LII->GetOption("wizard_email")) {$oMail->RecipientAddress =$III1LII->GetOption("wizard_email_cc"); if(isset($oMail->RecipientAddress) && $oMail->RecipientAddress!='' && !$oMail->Send()){ trigger_error("WZ_BUILDER: sending email failed to [".$oMail->RecipientAddress.I19276, E_USER_WARNING); }}$I1lLIlI["pref_username"] =$I1lLIlI['username']; $HtmlBody =$frn->Gui->get("wizard:user_created", $I1lLIlI); break; default: $frn->Gui->addBlock(I19270,"templates/letters/_wz_letters_" .$lang_data .I19277); $III1LlL =$frn->Gui->getAbs("mail:admin_error_subject", Array("webname"=>$lLL111I->domain)); $mbody =$frn->Gui->get("mail:admin_order_body", $III1LlI); require_once($GLOBALS["CLASSES_PATH"].I19278); $oMail =new Mailer(); $oMail->RecipientAddress =$III1LII->GetOption("wizard_email"); $oMail->SenderAddress =$frn->Core->GetOption("company_robot_email"); $oMail->SenderName =$frn->Core->GetOption("company_name"); $oMail->Subject =$III1LlL; $oMail->Body =$mbody; $oMail->BodyFormat =I19274; $oMail->Prepare(); if(!$oMail->Send()){ trigger_error("WZ_BUILDER: sending email failed to [".$oMail->RecipientAddress.I19276, E_USER_WARNING); }$HtmlBody =$frn->Gui->get("wizard:user_not_created", $I1lLIlI); break; }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; exit; }switch ($frn->VarsGet[I19259]) {case "show_layouts": $frn->Core->Cache->Enable(); $lLL1LlL->InitPager($frn->Pager); $lL1IIII =$lang_data; if(isset($frn->VarsGet[I19229]) && in_array($frn->VarsGet[I19229], $frn->Core->GetAOption(I19279))){ $lL1IIII =$frn->VarsGet[I19229]; $frn->setLang($lL1IIII); }$filter .= "public=1 AND wd.lang='$lang_data' AND wl.lang='$lL1IIII'"; $vData["pager"] =$pager; $sql ="SELECT wl.id as id, wl.lang as wlang, header, name, filename, folder_path ". "FROM cms_wz_designs as wd ". "left join cms_wz_design_layouts as wl on wl.id_design=wd.id ". "WHERE ".$filter." and wd.id='".$frn->Vars[I19233].I19280.$frn->Pager->TI1TTlT().", wd.id asc ".$frn->Pager->TI1TTlI(); $db->query($sql); $lLlLlLI["lang_layouts"] =TlTlIII($frn->Vars[I19233], false, $lL1IIII); $i =$row =$col =0; if($db->num_rows()){ while($db->next_record()) {$vItem =Array(); $lLIlLII =$lLL1LL1.$db->Record[I19239]."/"; $lLL11IL ="_".$db->Record[I19281]; $vItem[I19233] =$db->Record[I19233]; $vItem["name"] =$db->Record["name"]; $vItem["image"] =$lLIlLII.$db->Record["filename"].$lLL11IL.I19241; $vItem[I19282] =$lLIlLII.$db->Record["filename"].$lLL11IL.".html"; if($i && (($col %$lLL1LLl) == 0) ){$vData["body"].= $frn->Gui->getAbs("wizard:lay_Vsplitter"); $row++; $col =1; }else{ $col++; if($i){ $vData[I19283].= $frn->Gui->getAbs("wizard:lay_Hsplitter"); }}EventApplyVars($frn, "layouts_list", $vItem); $vData[I19283] .= $frn->Gui->get("wizard:layout_row", $vItem); $i++; }$lLlLlLI[I19283] =$frn->Gui->get("wizard:layouts_page", $vData); }else{ $lLlLlLI[I19283] =$frn->Gui->get("wizard:layouts_page_empty", $vData); trigger_error("DESIGN NOT FOUND id=[".$frn->Vars[I19233]."]", E_USER_WARNING); }$HtmlBody =$frn->Gui->get("wizard:layouts", $lLlLlLI); break; case "show_page": $frn->Core->Cache->Enable(); $filter .= I19284; $sql ="SELECT wd.clayouts as clayouts, wd.folder_path, wl.* ". "FROM cms_wz_designs as wd ". "left join cms_wz_design_layouts as wl on wl.id_design=wd.id ". "WHERE ".$filter.I19285.$frn->Vars[I19233].I19237; $db->query($sql); if($db->next_record()){ $lL1IIIl ="\n<base href=\"".$lLI1ILI.$db->Record[I19239]."/\">\n"; $Content =preg_replace("/<\\/title>/i", "</title>".$lL1IIIl, $db->Record[I19286], 1); $conn->TT1I1lI($III1LII->GetOption("html_protecting"), $Content); echo $Content; $conn->Out(); die; }else{ $lLlLlLI[I19283] =$frn->Gui->get("wizard:layouts_page_empty", $vData); trigger_error("DESIGN NOT FOUND id=[".$frn->Vars[I19233]."]", E_USER_WARNING); }$HtmlBody =$frn->Gui->get(I19287, $lLlLlLI); break; default: $I1lLIlI["user_form"] =$frn->VarsGet; $I1lLIlI["user_form"] =removeSpecial($I1lLIlI["user_form"], I19260); $lLlLlLI[I19259] ="create"; $lL1IIIL =Array(); $lL1IIIL[I19288] =$oMember->GetForm($frn, $db, $I1lLIlI["user_form"] +$lLL11ll); $lLL1L1l[I19255] =$I1lLIlI["user_form"]["webname"]; $lL1IIIL['company_text'] =$I1lLIlI[I19289]["company_text"]; $lL1IIIL += $lLL11ll; $lL1IIIL["domain_rows"] =I19228; $III11LI =$III1LII->GetAOption("domain"); $III1LLI =array(); foreach($III11LI as $domain=>$opt) if(mb_strpos($opt,'hidden')===false) array_push($III1LLI,$domain); foreach($III1LLI as $domain) {$lLL1L1l[I19290] =$domain; if($frn->VarsGet[I19290] == $domain){ $lLL1L1l["selected"] ="selected"; }else{ $lLL1L1l["selected"] =I19228; }$lLL1L1l["domain_rows"] .= $frn->Gui->getAbs(I19291, $lLL1L1l); }$lLlLlLI["domain_form"] =$frn->Gui->get("wizard:domain_form", $lLL1L1l); $lLlLlLI[I19289] =$frn->Gui->get("wizard:user_form", $lL1IIIL); $III11lI =$frn->VarsGet["sitemap"]; $III11II =$III1LII->GetOption(I19292); $lL1III1 =!in_array($frn->VarsGet[I19268], $III11II) ?$III1LII->GetOption(I19251) :$frn->VarsGet[I19268]; $III11II =$III1LII->GetOption(I19292); $lL1IIlI =Array(); foreach($III11II as $lL1IIll){ $lL1IIlI[$lL1IIll] =$aWords["name_type_".$lL1IIll]; }$lL1IIlL =I19228; $I1lLIlI =Array(); $III11IL =Array(); $lL1IIl1 =0; foreach ($lL1IIlI as $lL1IIll=>$type_name){ $I1lLIlI["sitemap_items"] =I19228; $lL1IILI =0; $sql ="SELECT sys_name, is_default, name, type, description FROM cms_wz_sitemaps ". "WHERE type='".$lL1IIll."' ORDER BY position"; $db->query($sql); while($db->next_record()){ $III11IL[$db->Record["sys_name"]] =$db->Record["name"]; if ($db->Record["is_default"]){ $III11I1 =$db->Record["sys_name"]; }if ($lL1IILI >0){ if ($lL1IILI %$lLL1LLI == 0){ $I1lLIlI[I19293] .= $frn->Gui->getAbs("wizard:options_form_sitemap_Vsplitter"); }else{ $I1lLIlI[I19293] .= $frn->Gui->getAbs("wizard:options_form_sitemap_Hsplitter"); }}$lL1IILl =Array(); $lL1IILl =$db->Record; $lL1IILl[I19268] =$lL1IIll; $I1lLIlI[I19293] .= $frn->Gui->get("wizard:options_form_sitemap_item", $lL1IILl); if($III11lI==$lL1IILl["sys_name"]){ $lL1III1 =$lL1IIll; }$lL1IILI++; }$I1lLIlI[I19294] =$lL1IIlI[$lL1IIll]; if ($lL1IIl1 >0){ if ($lL1IIl1 %$lLL1Ll1 == 0){ $I1lLIlI["type_items"] .= $frn->Gui->getAbs("wizard:options_form_type_Vsplitter"); }else{ $I1lLIlI["type_items"] .= $frn->Gui->getAbs("wizard:options_form_type_Hsplitter"); }}if ($lL1IILI >0){ $I1lLIlI[I19295] .= $frn->Gui->get("wizard:options_form_type_item", $I1lLIlI); $lL1IIl1++; }}$lLlLlLI["options_form"] =$frn->Gui->get("wizard:options_form", $I1lLIlI); $lL1IILL =array(); if(isset($frn->VarsGet[I19261]) && ($frn->VarsGet[I19261]=="1")){ $lL1IILL[I19261] =I19240; }$lLlLlLI[I19261] =$frn->Gui->get("wizard:agreement_form", $lL1IILL); $lLlLlLI["custom_fields"] =I19228; for ($i=0;$i<$III1LII->GetOption("custom_fields_num");$i++) $lLlLlLI["custom_fields"] .= $frn->Gui->getAbs("wizard:custom_field", I19296,$i); $lLlLlLI["fdesign_id"] =$lLL11I1; $lLlLlLI["sitemap"] =$III11lI; $lLlLlLI[I19268] =$lL1III1; $lLlLlLI["help"] =stripslashes($frn->VarsGet["help"]); $lLlLlLI[I19297] =stripslashes($frn->VarsGet[I19297]); $sid =md5(rand(1000, getrandmax()) +time()); $lL1IIL1 =array("width"=>64, "height"=>32); $lL1IIL1["image_link"] =$ROOT_PATH_WWW."show_numimage.php?sid=".$sid; if ($frn->Core->GetOption(I19298) != 0){ $lL1IIL1["alt"] =$frn->Core->GetOption(I19298); }$lLlLlLI["image_form"] =$frn->Gui->get("wizard:image_form", $lL1IIL1); $lLlLlLI["sid"] =$sid; if($III1LII->GetOption(I19299)){ $lL1II1I =I19228; $lLL1Lll->InitPager($frn->Pager); $sql ="SELECT id FROM cms_wz_sitemaps WHERE sys_name='$III11lI'"; $db->query($sql); $lL1II1l =0; if ($db->next_record()){ $lL1II1l =$db->Record[I19233]; }if ($lL1II1l >0){ $sql ="SELECT id, name FROM cms_wz_design_cat WHERE ids_sitemaps like '%;".$lL1II1l.";%' AND lang='$lang_data' ORDER BY ".$frn->Pager->TI1TTlT().", id asc"; }else{ $sql ="SELECT id, name FROM cms_wz_design_cat WHERE lang='$lang_data' ORDER BY ".$frn->Pager->TI1TTlT().", id asc"; }$db->query($sql); $lL1II1L =false; $catIds =array(); $lL1II11 =0; if($db->num_rows()){ $vData =array(); while($db->next_record()){ $vItem =array(); $vItem[I19233] =$db->Record[I19233]; $catIds[] =$vItem[I19233]; if($vItem[I19233]==$cat_id) $lL1II1L =true; $vItem["caption"] =$db->Record[I19300]; $vItem["selected"] =($vItem[I19233]==$cat_id)?"selected":I19228; $vData["cat_list"] .= $frn->Gui->get("wizard:cat_row", $vItem); $lL1II11 ++; }if($cat_id!=0 && !$lL1II1L) $cat_id =0; if ($lL1II11 >1){ $vData[I19301] =$frn->Gui->getAbs("wizard:cat_row_all", "selected", ($cat_id==0)?"selected":I19228).$vData[I19301]; }$lL1II1I =$frn->Gui->get("wizard:categories_list", $vData); }$lLlLlLI[I19242] =$cat_id; }$vData =Array(); $vData[I19302] =$lL1II1I; $III1LII->InitPager($frn->Pager); $frn->Pager->InitPager($frn->Vars["offset"], $rows*$cols); if ($III1L11!=I19228) {$vData["selected_design"] =$frn->Gui->getAbs("wizard:selected_design", I19300, $III1L11); }if ($lLL11lL) {$vData[I19249] =$lLL11lL; }$filter .= "wd.public=1 AND wd.lang='$lang_data' and filename='".$Layout->I1lI1ll.I19237; if($cat_id >0){ $filter .= " AND (id_cat='$cat_id' OR id_cat LIKE '%;$cat_id;%') "; }else{ $lL1IlII =I19228; foreach ($catIds as $lL1IlIl) {if ($lL1IlII) $lL1IlII .= " OR "; $lL1IlII .= " (id_cat='$lL1IlIl' OR id_cat LIKE '%;$lL1IlIl;%') "; }if ($lL1IlII) $filter .= I19303.$lL1IlII." )"; }if ($lLL11lL) {$filter .= " AND (header LIKE '".mysql_real_escape_string($lLL11lL)."%') "; }$sql ="SELECT wd.id from cms_wz_designs as wd ". "left join cms_wz_design_layouts as wl on wl.id_design=wd.id ". "WHERE wl.lang='".$lang_data.I19238.$filter." GROUP BY wd.id ORDER BY ".$frn->Pager->TI1TTlT().", wd.id asc "; $db->query($sql); $frn->Pager->MaxCount =$db->num_rows(); if($lLL1LLL){ $frn->Pager->Position =$frn->Pager->TI1TT1l($db, I19233, $lLL11I1); }$frn->Pager->TI1TT1I(); $lll1lII =$frn->Pager->GetPager(); $pager =$frn->Pager->GetPagerHtml( $lll1lII, "javascript:des_go_page('[START]')"); if($frn->Pager->MaxCount){ $vData[I19304] =$pager; $sql ="SELECT wd.id as id, wd.lang as wlang, header, filename, folder_path, clayouts, author, wc.name as cname, wc.id as cid ". "FROM cms_wz_designs as wd ". "left join cms_wz_design_layouts as wl on wl.id_design=wd.id ". "left join cms_wz_design_cat as wc on (wc.id=wd.id_cat OR wd.id_cat LIKE CONCAT('%;',wc.id,';%')) ". I19305.$lang_data.I19238.$filter." GROUP BY wd.id ORDER BY ".$frn->Pager->TI1TTlT().", wd.id asc ".$frn->Pager->TI1TTlI(); $db->query($sql); $db2 =new DB_si; $i =$row =$col =0; while($db->next_record()) {$vItem =Array(); $vItem["lang_layouts"] =TlTlIII($db->Record[I19233]); $lLIlLII =$lLL1LL1.$db->Record[I19239]."/"; $lLL11IL =I19306.$db->Record[I19281]; $vItem[I19233] =$db->Record[I19233]; if($vItem[I19233]==$lLL11I1){ $vItem[I19240] =I19240; }$vItem[I19300] =$db->Record["header"]; $vItem["image"] =$lLIlLII.$db->Record["filename"].$lLL11IL.I19241; $vItem["clayouts"] =$db->Record[I19307]; $vItem["author"] =$db->Record["author"]; $vItem[I19242] =($cat_id==0 && $III1LII->GetOption(I19299))?$db->Record["cid"]:I19228; $vItem["cat_name"] =($cat_id==0 && $III1LII->GetOption(I19299))?$db->Record[I19243]:I19228; $vItem[I19308] =$db->Record[I19308]; if($i && (($col %$cols) == 0) ){$vData[I19283].= $frn->Gui->getAbs("wizard:item_Vsplitter"); $row++; $col =1; }else{ $col++; if($i){ $vData[I19283].= $frn->Gui->getAbs("wizard:item_Hsplitter"); }}EventApplyVars($frn, "items_list", $vItem); $vData[I19283] .= $frn->Gui->get("wizard:item_row", $vItem); $i++; }$lLlLlLI[I19309] =$frn->Gui->get("wizard:items_list", $vData); }else{ $vData[I19283] .= $frn->Gui->getAbs("wizard:items_list_empty"); $lLlLlLI[I19309] =$frn->Gui->get("wizard:items_list", $vData); }if (!$lLL11L1) {$lLlLlLI["submit_button"] =$frn->Gui->getAbs("wizard:builder_disabled"); }$HtmlBody =$frn->Gui->get(I19235, $lLlLlLI); break; }require $GLOBALS['DEFAULT_INCLUDES_PATH'] .'done.php'; }$lLI111I =0; 