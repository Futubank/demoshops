<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       5426 xkqwrkzuqnwkyusxpxlwywzitktmugtzyksymitpgwnymigiktrzylqtignnzypgkirppnir
 */ ?><?php foreach(array(19573=>'ZJJHCQS',19574=>'',19575=>'rMS',19576=>'!',19577=>'fHrYMSSQn',19578=>'ZvMS',19579=>"'{",19580=>"OHDt") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} function TlTllTI(&$Core) {global $bench_time, $lLI1ILL; $res =Array(I19573=>'0','forbidden'=>''); $lL1lI1I =''; $country =I19574; $ip =getenv("REMOTE_ADDR"); $db =new DB_si; require_once $GLOBALS['CLASSES_PATH'] .'GeoIP.php'; $gi =TITlT1l($lLI1ILL,GEOIP_STANDARD); $country =mb_strtolower(TITlIIT($gi, $ip)); if(empty($country)) {$country ='invalid'; }$sql ="SELECT a.id, min(r.id) as rid FROM cms_ip_area a ". "LEFT JOIN cms_ip_area_rule ar ON a.id=ar.id_area ". "LEFT JOIN cms_ip_rule r ON r.id=ar.id_rule ". "WHERE r.country='".addslashes($country)."' and r.country<>'' or ". "(r.country='' and ip = mask&".sprintf('%u',ip2long($ip)).") ". "GROUP by a.id"; $db->query($sql); while($db->next_record()) {$lL1lI1I .= ','.$db->Record[I19575]; }$lL1lI1I =mb_substr($lL1lI1I, 1); if(!empty($lL1lI1I)) {$sql ="SELECT a.id, r.sign FROM cms_ip_area a ". "LEFT JOIN cms_ip_area_rule ar ON a.id=ar.id_area ". "LEFT JOIN cms_ip_rule r ON r.id=ar.id_rule ". "WHERE r.id in ($lL1lI1I)"; $db->query($sql); while($db->next_record()) {if($db->Record['sign']==1) $res[I19573] .= I19576.$db->Record['id']; else $res['forbidden'] .= ',-'.$db->Record['id']; }$res[I19577] =mb_substr($res[I19577], 1); }return $res; }function Click(&$db, &$lL1lI1l) {$ip =sprintf("%u", ip2long(getenv('REMOTE_ADDR'))); $url =getCurrentURL(); if(preg_match("/^https?:\\/\\/(.*)$/", getenv("HTTP_REFERER"), $match)) {$referer =$match[1]; }if(empty($lL1lI1l[I19578])) {$vid =md5(getenv('REMOTE_ADDR').':'.rand(0, 1000000).':'.microtime()).md5(rand(0, 1000000)); SetLocalCookie(I19578, $vid, time()+315360000); }else {$vid =$lL1lI1l[I19578]; }$sql ="INSERT INTO cms_aff_hits_tmp (date, ip, url, referer, vid) ". "VALUES (NOW(), '$ip', '$url', '$referer', '".addslashes($vid).I19579; $db->query($sql); }function TlTllTl() {$adm =&$GLOBALS['adm']; $lL1lI1L =I19574; if($adm->Core->HostMode() &HOSTMODE_SHARED) {$adb =&DB_si::admInstance(); $oSess =admSession(); $domain =$oSess->TlIT11I(); $vMod =&$adm->Core->GetModule("srv_host_domains"); if(is_object($vMod) && $vMod->IsInstalled()) {$sql ="SELECT `alias_domain` FROM `cms_host_users` WHERE `domain_orig` = '{$domain}'"; $I1LLILl =$adb->getValue($sql); if($I1LLILl==I19574) $I1LLILl=='_add_'; $lL1lI1L =$vMod->GetAdminLink(); }}else {$a =parse_url($GLOBALS['ROOT_PATH_WWW']); $domain =mb_strtolower($a[I19580]); $domain =preg_replace('/^www\./i',I19574,$domain); }if(!isset($I1LLILl)) {if(isset($GLOBALS['ROOT_PATH_WWW_ALIAS'])) {$a =parse_url($GLOBALS['ROOT_PATH_WWW_ALIAS']); $I1LLILl =mb_strtolower($a[I19580]); $I1LLILl =preg_replace('/^www\./i',I19574,$I1LLILl); }else $I1LLILl =I19574; }if($I1LLILl==$domain) $I1LLILl =I19574; return array($domain,$I1LLILl,$lL1lI1L); }?>