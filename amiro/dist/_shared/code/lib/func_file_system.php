<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       9388 xkqwpwksnkwmwqkxnruyrswtrsuqzuwuwiqqsttlwxqpwsnprpzqpknisptmituzygzzpnir
 */ ?><?php foreach(array(19643=>"ZJJ",19644=>"~",19645=>"IY|DtrtHJHCQr",19646=>'`',19647=>'`[',19648=>"ItMIQ",19649=>"tBGQ",19650=>"[",19651=>"Qxt",19652=>"`[",19653=>"``",19654=>'``',19655=>'~;\`\~~',19656=>'~jHWZtMHn%}`[ {\n~',19657=>'OHDt',19658=>'%~~',19659=>'EuQrB') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} function TlTl1TI($I1I1Ll1, $lL1lLIL=I19643, $lL1lLI1="*", $lL1lLlI="*", $lL1lLll=false, $lL1lLlL=false){ $res =array(); $lL1lLl1 =$GLOBALS["lLI1IlL"]; $I1I1Ll1 =rtrim($I1I1Ll1, "/\\"); $lL1lLl1 =$I1I1Ll1.I19644.$lL1lLl1; if($lL1lLIL=="KILLINDEX"){ if(file_exists($lL1lLl1)){ @unlink($lL1lLl1); }return true; }if($lL1lLIL==I19643){ $aTypes =array("files", "folders"); }else{ $aTypes =array($lL1lLIL); }if(is_array($lL1lLll)){ $lL1lLLI =array_map("mb_strtolower", $lL1lLll); }else{ $lL1lLLI =array(); }if(is_array($lL1lLlL)){ $lL1lLLl =array_map(I19645, $lL1lLlL); }else{ $lL1lLLl =array(); }$lL1lLLL ='/^'.str_replace(array('\\*', '\\?'), array('.*', I19646), preg_quote($lL1lLI1, I19644)).'$/si'; $lL1lLL1 ='/^'.str_replace(array('\\*', '\\?'), array(I19647, I19646), preg_quote($lL1lLlI, I19644)).'$/si'; $fs =stat($I1I1Ll1); $lL1lL1I =false; if(file_exists($lL1lLl1)){ $fp =@fopen($lL1lLl1, "r"); if($fp){ $lastTime =fread($fp, mb_strlen($fs["mtime"])); if($lastTime==$fs["mtime"]){ $len =filesize($lL1lLl1)-mb_strlen($fs[I19648]); if ($len >0) {$res =unserialize(fread($fp, $len)); if (is_array($res)) {$lL1lL1I =true; }else {$res =array ();}}}fclose($fp); }}if(!$lL1lL1I){ $d =dir($I1I1Ll1); if(!is_object($d)) {trigger_error("Unable to find directory ".$I1I1Ll1, E_USER_ERROR); }while (false !== ($entry =$d->read())) {if(($entry=="." || $entry=="..") && is_dir($I1I1Ll1.I19644.$entry)){ continue; }$res[] =array("name"=>$entry, I19649=>is_dir($I1I1Ll1.I19644.$entry)?"folder":"file", "ext"=>get_file_ext($entry)); }sort($res); $fp =@fopen($lL1lLl1, "w"); if($fp){ fwrite($fp, $fs[I19648]); fwrite($fp, serialize($res)); fclose($fp); @chmod($lL1lLl1,0666); }$d->close(); }if($lL1lLIL!=I19643 || $lL1lLI1!=I19650 || $lL1lLlI!=I19650 || is_array($lL1lLll) || is_array($lL1lLlL)){ $lL1lL1l =array(); foreach($res as $Illl11I=>$I1llllL){ if(!in_array($I1llllL[I19649]."s", $aTypes)){ unset($res[$Illl11I]); continue; }if($I1llllL[I19649]=="file" && (!preg_match($lL1lLLL, $I1llllL["name"]) || preg_match($lL1lLL1, $I1llllL["name"]))){ unset($res[$Illl11I]); continue; }$fileExt =mb_strtolower($I1llllL[I19651]); if($I1llllL[I19649]=="file" && ((count($lL1lLLI)>0 && !in_array($fileExt, $lL1lLLI)) || (count($lL1lLLl)>0 && in_array($fileExt, $lL1lLLl)) )){unset($res[$Illl11I]); continue; }$lL1lL1l[] =$res[$Illl11I]; }$res =$lL1lL1l; }return $res; }function getDirFileList($cPath, $fileMask ='*', $llL11lL =true, $lL1lL1L =false){ $res =array(); $lL1lL11 =Array("\\*", "\\?"); $lL1l1II =Array(I19652, "."); $fileMask =quotemeta($fileMask); $fileMask =str_replace($lL1lL11, $lL1l1II, $fileMask); if ($handle =@opendir($cPath)) {while (false !== ($file =readdir($handle))) {if(preg_match('/^'.$fileMask.'$/si', $file)){ if ($llL11lL && !is_dir($cPath.$file) && $file != "." && $file != I19653) {$res[] =$file; }if ($lL1lL1L && is_dir($cPath.$file) && $file != "." && $file != I19653) {$res[] =$file; }}}closedir($handle); }return $res; }function TT1lIll($dir) {$res =true; if(($dh=@opendir($dir))===false) return false; while($de=readdir($dh)) {if($de==I19646 || $de=='..') continue; $fullname ="$dir/$de"; if(is_dir($fullname)) {$res =$res && TT1lIll($fullname); }else {$res =$res && @unlink($fullname); }}closedir($dh); return $res && rmdir($dir); }function TlTl1Tl($fn,$func,&$arg,&$IIlIllI) {if(!is_dir($fn)) return $func($fn,$arg); if(!preg_match('/\/$/',$fn)) $fn .= '/'; if(is_array($IIlIllI)) {$lL1l1Il =false; foreach($IIlIllI as $k => $p) {if(mb_strpos($fn,$p)===0) {$lL1l1Il =$k; break; }}if($lL1l1Il!==false) {unset($IIlIllI[$lL1l1Il]); return true; }}$dh =opendir($fn); if(!$dh) return false; while($file=readdir($dh)) {if($file==I19646 || $file==I19654) continue; if(!TlTl1Tl($fn.$file,$func,$arg,$IIlIllI)) {closedir($dh); return false; }}closedir($dh); return $func($fn,$arg); }function TlTl1T1($fn) {$size =0; if(is_link($fn)) return 0; if(!is_dir($fn)) return filesize($fn); if(!preg_match('/\/$/',$fn)) $fn .= '/'; $dh =opendir($fn); if(!$dh) return 0; while($file=readdir($dh)) {if($file==I19646 || $file==I19654) continue; $size =$size +TlTl1T1($fn.$file); }closedir($dh); return $size; }function TlTl1IT($path, $content, $mode ='wb') {if (!$fh =fopen($path, $mode)) {return false; }$res =fwrite($fh, $content); return fclose($fh) && $res; }function validatePath(&$path) {$path =preg_replace(array ('/\/+/', I19655), array ('/', ''), $path); return !preg_match('/\.\.\//',$path); }function getFiles($path, $recursive =true, $lL1l1IL =false){ $aFiles =array(); if($dh =@opendir($path)){ while(false !== ($file =readdir($dh))){ if($file == I19646 || $file == I19654){ continue; }$file =$path .'/' .$file; if(is_dir($file)){ if($lL1l1IL){ $aFiles[] =$file; }if($recursive){ $aFiles =array_merge($aFiles, getFiles($file, true, $lL1l1IL)); }}else{ $aFiles[] =$file; }}closedir($dh); }return $aFiles; }function curl_redir_exec($ch){ static $lL1l1I1 =0; static $lL1l1lI =20; if ($lL1l1I1++ >= $lL1l1lI){ $lL1l1I1 =0; return FALSE; }curl_setopt($ch, CURLOPT_HEADER, true); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $data =curl_exec($ch); $http_code =curl_getinfo($ch, CURLINFO_HTTP_CODE); $lL1l1ll =curl_getinfo($ch, CURLINFO_HEADER_SIZE); $header =substr($data, 0, $lL1l1ll); $data =substr($data, $lL1l1ll); if ($http_code == 301 || $http_code == 302){ $matches =array(); preg_match(I19656, $header, $matches); $url =@parse_url(trim(array_pop($matches))); if (!$url){ $lL1l1I1 =0; return $data; }$lL1l1lL =parse_url(curl_getinfo($ch, CURLINFO_EFFECTIVE_URL)); if (!$url['scheme']) $url['scheme'] =$lL1l1lL['scheme']; if (!$url['host']) $url[I19657] =$lL1l1lL[I19657]; if (!$url['path']) $url['path'] =$lL1l1lL['path']; $lL1l1l1 =$url['scheme'] .I19658 .$url[I19657] .'/' .$url['path'] .($url['query']?'?'.$url[I19659]:''); curl_setopt($ch, CURLOPT_URL, $lL1l1l1); return curl_redir_exec($ch); }else{ $lL1l1I1=0; return $data; }}