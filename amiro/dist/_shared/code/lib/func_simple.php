<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       22083 xkqwwyymrkuusltywqxxkngzgkuwspyszznqpmltzltzwtnpzlzmzpqkngpwnzmlzmuqpnir
 */ ?><?php foreach(array(19688=>'CCC`',19689=>'%~~',19690=>'GZtO',19691=>'frZPIQnt',19692=>'%',19693=>"|O",19694=>'OHDt',19695=>"~",19696=>" ",19697=>"EuQrB",19698=>"",19699=>"YHtO",19700=>'',19701=>'MS|DMtQ',19702=>'vMS',19703=>'DOZrQS',19704=>'fHrWQ|CCC',19705=>"=",19706=>"\n",19707=>'_',19708=>"MnDtZnWQ",19709=>'|||DGQWMZJ|ZIG|||',19710=>'WZtHffDQt',19711=>'=',19712=>'WZWOQ',19713=>']ZIG^',19714=>'OrQf=',19715=>'#DGQWMZJ|z',19716=>"wHrQ",19717=>'RQtrB+zftQr%?',19718=>"RqeUqdT|URm",19719=>"'",19720=>'zim|RQ',19721=>'nvMrHnIQnt~dQDD',19722=>'rJQn',19723=>'ZIM|QfQ',19724=>'MS',19725=>'nZIQ',19726=>'tHHJYZr`WDD') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} function TlT1TIl($domain) {$domain =mb_strtolower($domain); if(mb_substr($domain,0,4)==I19688) $domain =mb_substr($domain,4); $p =mb_strpos($domain,':'); if($p!==false) $domain =mb_substr($domain,0,$p); return $domain; }function TlT1TI1($comp) {$url =isset($comp['scheme']) ?$comp['scheme'] :'http'; $url .= I19689; $url .= mb_strtolower($comp['host']); if(isset($comp['port'])) $url .= ':'.$comp['port']; if(!isset($comp[I19690])) return $url.'/'; $url .= $comp[I19690]; if(isset($comp['query'])) $url .= '?'.$comp['query']; if(isset($comp[I19691])) $url .= '#'.$comp[I19691]; return $url; }function TlT1TlT($lL1LI11, $mode =''){ $root =$GLOBALS['ROOT_PATH_WWW']; $lL1LlII =getenv('HTTP_HOST'); $p =mb_strpos($lL1LlII, I19692); if($p !== FALSE){ $lL1LlII =mb_substr($lL1LlII,0,$p); }$domain =TlT1TIl($lL1LlII); $IIlILI1 =parse_url($root); $lL1LlIl =TlT1TIl($IIlILI1['host']); $lL1LlIL =$lL1LlIl != $domain; if($lL1LlIL){ if($lL1LI11 and !(isset($GLOBALS["_SIDE"]) and $GLOBALS["_SIDE"]=="admin" and isset($GLOBALS[I19693]["mode"]) and $GLOBALS[I19693]["mode"]=="shared")){ return $GLOBALS['ROOT_PATH_WWW_ALIAS']; }$IIlILI1 =parse_url($GLOBALS['ROOT_PATH_WWW_ALIAS']); $lL1LlIl =TlT1TIl($IIlILI1['host']); if($lL1LlIl != $domain){ return $root; }}elseif($lL1LI11){ return $root; }if($mode === 'force_config'){ $lL1LlI1 =parse_url($GLOBALS[$lL1LlIL ?'ROOT_PATH_WWW_ALIAS' :'ROOT_PATH_WWW']); $lL1LlII =$lL1LlI1[I19694]; }$IIlILI1[I19694] =mb_strtolower($lL1LlII); $GLOBALS['ROOT_PATH_WWW'] =TlT1TI1($IIlILI1); if(function_exists("getCurrentURL")){ getCurrentURL(TRUE); }return $GLOBALS['ROOT_PATH_WWW']; }function TTlTlll($IILLlll, $lL1LllI, $IllLL1l ='*') {$res =false; if(mb_strpos($lL1LllI, $IllLL1l) !== false) {$mask =preg_quote($lL1LllI, I19695); $mask ='/'.str_replace(preg_quote($IllLL1l, I19695), '.*',$mask).'/'; $res =preg_match($mask, $IILLlll, $m); }else {$res =($IILLlll == $lL1LllI); }return $res; }function TlT1TlI($cUrl){ $res =array(); $res["full"] =$cUrl; $lL1Llll =mb_strpos($cUrl, I19696); if($lL1Llll===false){ $res["url"] =$cUrl; $res["query"] =""; }else{ $res["url"] =mb_substr($cUrl, 0, $lL1Llll); $res[I19697] =mb_substr($cUrl, $lL1Llll+1); }return $res; }function TlT1Tll(){ return empty($_SERVER['REQUEST_URI']) ?mb_strpos($_SERVER["QUERY_STRING"], '://www.') !== FALSE :mb_strpos($_SERVER['HTTP_HOST'], I19688) === 0; }function getLangFromUrl($cUrl, $cRootUrl){ $res =I19698; if(preg_match(I19695.preg_quote($cRootUrl,'/')."([a-zA-Z]{2,3})(\/|$)/", $cUrl, $matches)) {$res =$matches[1]; }return $res; }function TT1TlIl(&$lL1LllL, &$ILIILLl, $type) {$ILIIL1I =Array(); $ILIll1L =Array(); $res =Array(); foreach($ILIILLl as $ILILllL) {if(is_array($lL1LllL)) {foreach($lL1LllL as $specName) {if(mb_strpos($specName, $ILILllL) !== false) {if(isset($ILIIL1I[$ILILllL]) && is_array($ILIIL1I[$ILILllL])) {$ILIIL1I[$ILILllL][] =$specName; }else {$ILIIL1I[$ILILllL] =Array($specName); }$ILIll1L[$specName] =$ILILllL; }}}}switch($type) {case "types": $res =$ILIIL1I; break; case "names": $res =$ILIll1L; break; case I19699: $res =Array("types" => $ILIIL1I, "names" => $ILIll1L); break; }return $res; }function SetLocalCookie($name, $value, $expire, $lLILILL ='', $lL1Lll1 =false, $lL1LlLI =false, $lL1LlLl =false) {global $ROOT_PATH_WWW, $ILlII1l, $cms, $cookieData, $CONNECT_OPTIONS, $_SIDE; $isAdmin =is_object($cms) && $cms->Core->Side == 'admin'; if($lLILILL == I19700){ $lLILILL =($isAdmin || $_SIDE == 'admin') ?$ILlII1l :$ROOT_PATH_WWW; }$lLILIL1 =parse_url($lLILILL); $path =$lLILIL1[I19690]; $domain =empty($lLILIL1[I19694]) || mb_strpos($lLILIL1[I19694], '.') === false ?I19700 :$lLILIL1[I19694]; $domain =preg_replace('/^(www\.)/i', I19700, $domain); $lL1LlLL =false; if(is_object($cms)){ $lL1LlLL =$cms->Core->GetOption('safe_cookies'); }$lL1LlL1 =false; $lL1Ll1I =array( I19701, 'host_session_', 'user_lang', 'hst_domain', 'hst_username', I19702 );foreach($lL1Ll1I as $cookieName){ if(strpos($name, $cookieName) === 0){ $lL1LlL1 =true; break; }}if($isAdmin && $lL1LlLL){ AMI::getSingleton('env/cookie')->set($name, $value, $expire, $path); if($lL1Lll1){ smartSetCookie($lL1LlLI, $name, $value, $expire, $path, $domain, $lL1LlL1); }}else{ if( !empty($domain) && (($isAdmin && (isset($GLOBALS['_h']) ?$GLOBALS['_h']['mode'] != I19703 :TRUE)) || !$isAdmin) && isset($CONNECT_OPTIONS['www_prefix_mode']) && ($CONNECT_OPTIONS['www_prefix_mode'] == 'strict' || $CONNECT_OPTIONS['www_prefix_mode'] == I19704 )&& mb_strpos($ROOT_PATH_WWW, '//www.') !== false ){$domain =I19688 .$domain; }if(defined('AMI_BUILDER_DOMAIN') && $domain === AMI_BUILDER_DOMAIN){ $domain =I19700; }smartSetCookie($lL1LlLI, $name, $value, $expire, $path, $domain, $lL1LlL1); }}function smartSetCookie($raw, $name, $value, $expire, $path, $domain, $lL1LlL1 =false){ static $cookies =array('common' => array(), 'raw' => array()); $name =str_replace(array(I19705, ",", ";", "\t", "\r", I19706, "\013", "\014"), I19700, $name); $source =$raw ?'raw' :'common'; $lL1Ll1l =!isset($cookies[$source][$name]); if($lL1Ll1l || !in_array($value .I19707 .$expire .I19707 .$path .I19707 .$domain, $cookies[$source][$name])){ if($lL1Ll1l){ $cookies[$source][$name] =array(); }$cookies[$source][$name][] =$value .I19707 .$expire .I19707 .$path .I19707 .$domain; if($raw){ setrawcookie($name, $value, $expire, $path, $domain, false, $lL1LlL1); }else{ setcookie($name, $value, $expire, $path, $domain, false, $lL1LlL1); }}}function TlT1Tl1(&$IILLlll, $replace =I19700){ if(mb_strpos($IILLlll, '<') !== false) {$s =preg_replace('/<\!\-\-.*?(\-\->|$)/s', I19700, $IILLlll); $s =preg_replace('/<.*?>/', $replace, $s); }else {$s =&$IILLlll; }return $s; }function TlT1T1T($db) {$value =I19698; if(CMS_ModulesOptions::TTlTllT($db, $res, "core", I19708)) {$res =$res["value"]; $value =($res %10 >0) ?"inst".($res %10).I19695 :I19698; }define(str_rot13(strrev("ugncohf_fryvs")), $value); }function _fmtHrefLink($link1, $lL1Ll1L){ $link =!empty($link1) ?$link1 :$lL1Ll1L; if(preg_match('/^\s*javascript\:/i', $link)){ return $link; }else if(preg_match('/^(.*?)\?(.*?)(?:#(.*?))?$/s', trim($link), $lL1Ll11)){ $lL1LLII =$lL1Ll11[1]; if(preg_match('/^https?:\/\/(?:www\.)?(.*?)(?:\/|$)/i', $lL1LLII, $lL1LLIl) && preg_match('/https?:\/\/(?:www\.)?(.*?)(?:\/|$)/i', $GLOBALS['ROOT_PATH_WWW'], $lL1LLIL)){ if(strtolower($lL1LLIl[1]) != strtolower($lL1LLIL[1])){ return $link; }}$lL1LLI1 =str_replace('&amp;', I19709, $lL1Ll11[2]); $lL1LLlI =isset($lL1Ll11[3]) ?'#' .$lL1Ll11[3] :I19700; $aVars =array(); $lL1LLll =(mb_strpos($lL1LLI1, 'flt_force_values=1') !== false); error_reporting(E_ALL &~E_STRICT &~E_NOTICE); if(preg_match_all('/(([^&]*?)=([^&]*?)|[^&]*?)(?:&|$)/s', $lL1LLI1, $lL1LLlL, PREG_SET_ORDER)){ $lL1LLl1 =sizeof($lL1LLlL); $lL1LLLI =0; for($i =0; $i <$lL1LLl1; $i++){ if(($lL1LLlL[$i][2] == 'offset' || $lL1LLlL[$i][2] == I19710) && $lL1LLlL[$i][3] == '0'){ if(isset($aVars[$lL1LLlL[$i][2]])){ unset($aVars[$lL1LLlL[$i][2]]); }continue; }if($lL1LLll || !empty($lL1LLlL[$i][3])){ $aVars[$lL1LLlL[$i][2] .(mb_strpos($lL1LLlL[$i][2], '[]') !== false ?++$lL1LLLI :I19700)] =$lL1LLlL[$i][2] .'=' .$lL1LLlL[$i][3]; }else if(empty($lL1LLlL[$i][3]) && isset($lL1LLlL[$i][2]) && mb_strpos($lL1LLlL[$i][2], '[]') !== false){ $aVars[$lL1LLlL[$i][2] .(++$lL1LLLI)] =$lL1LLlL[$i][2] .I19711; }else if(!isset($lL1LLlL[$i][2]) && !empty($lL1LLlL[$i][1])){ $aVars[$lL1LLlL[$i][1]] =$lL1LLlL[$i][1]; }else if(isset($aVars[$lL1LLlL[$i][2]])){ unset($aVars[$lL1LLlL[$i][2]]); }}if(sizeof($aVars) == 1 && isset($aVars['action']) && $aVars['action'] == 'action=rsrtme'){ $aVars =array(); }else{ if(sizeof($aVars) >0){ if(isset($aVars['_print_version']) && isset($aVars[I19712]) && $aVars[I19712] == 'cache=force'){ unset($aVars[I19712]); }}sort($aVars); }}error_reporting(CMS_ERROR_REPORTING); $lL1LLII =preg_replace('/([^:])\/{2,}/', '\\1/', $lL1LLII); return $lL1LLII .(sizeof($aVars) >0 ?'?' .str_replace(I19709, I19713, implode('&', $aVars)) :I19700) .$lL1LLlI; }else{ return preg_replace('/([^:])\/{2,}/', '\\1/', $link); }}function _ccl_cb($matches){ return '<a'.$matches[1].I19714.$matches[2].I19700._fmtHrefLink($matches[3],$matches[4]).I19700.$matches[2].I19700.$matches[5].'>'; }function _ccl_scripts_enc_cb($matches){ return str_replace(array('<a', '<A'), array('<special_a', I19715), $matches[1]); }function _ccl_scripts_dec_cb($matches){ return str_replace(array('<special_a', I19715), array('<a', '<A'), $matches[1]); }function TlT1T1I(&$content) {$content =preg_replace_callback('/(<script.*?<\/script)/si', '_ccl_scripts_enc_cb', $content); $content =preg_replace_callback('/<a([^>]+?)href\s*?=(?:(?:(\'|")([^>]*?)\\2)|(?:([^ >]*)))([^>]*?)>/si', '_ccl_cb', $content); $content =preg_replace_callback('/(<script.*?<\/script)/si', '_ccl_scripts_dec_cb', $content); if(is_object($GLOBALS[I19716]) && $GLOBALS[I19716]->IsInstalled("adv_places")){ TlTlI11($content, true, false); }}function TlT1T1l(){ global $oSession, $Core; $res =0; if($oSession->IsSessionStarted()){ $res =(int)($oSession->memberId >0); if($res){ $aUser =$oSession->GetVar('user'); if(isset($aUser['ami_gm'])){ $res =$aUser['ami_gm']; }}}if(function_exists('customGetUserGroupMask')){ $aParams =array(); $res =customGetUserGroupMask($res, $aParams); }return $res; }function display503Header($timeout) {global $conn; if (is_object($conn)) {$conn->Headers =array ();$conn->DelHeader('HTTP/1.x 404 Not Found'); $conn->AddHeader($GLOBALS["SERVER_PROTOCOL"].' 503 Service Temporarily Unavailable', true); $conn->AddHeader('Status: 503 Service Temporarily Unavailable', true); $conn->AddHeader(I19717 .$timeout, true); $conn->SetSkip200Status(true); $conn->OutHeaders(); }else {header($GLOBALS["SERVER_PROTOCOL"].' 503 Service Temporarily Unavailable'); header('Status: 503 Service Temporarily Unavailable'); header(I19717 .$timeout); }}if(!function_exists('getCurrentURL')){ function getCurrentURL($force =false) {static $res =false; if($res===false || $force) {$res =(isset($_SERVER[I19718])) ?preg_replace('/^\//', I19700 ,addslashes(getenv(I19718))) :preg_replace('/^.*?https?:\/\/.+?\//', I19700, $_SERVER["QUERY_STRING"]); if(mb_strpos($res, '"') !== false || mb_strpos($res, I19719) !== false){ $res =urlencode($res); }$prefix =preg_replace('/^.*?(https?:\/\/.+?\/).*/', '$1', $GLOBALS['ROOT_PATH_WWW']); $res =$prefix.$res; }return $res; }}function TlT1T11(CMS_Session $oSession){ static $run =TRUE; global $frn, $editMode, $db, $Core; if(!AMI::issetAndTrueOption('core', 'allow_edit_at_front')){ return; }if($run){ $aUser =$oSession->GetVar('user'); $lLLLIII =$oSession->GetVar('hash'); $lLlLI11 ='si' .'d'; call_user_func( array(I19720 .'gistry', 'se' .'t'), 'AMI/E' .I19721 .'ion/ahash', call_user_func( 'str_ro' .'t13', call_user_func('mb_st' .I19722, $lLLLIII) .$lLLLIII .$oSession->{$lLlLI11} ));unset($lLLLIII, $lLlLI11); if(isset($_REQUEST['ami_efe']) && $aUser['ami_efa']){ require_once $GLOBALS['FUNC_INCLUDES_PATH'] .'function.php'; $aUser[I19723] =(bool)$_REQUEST[I19723]; $oSession->SetVar(I19723, $aUser[I19723]); $oSession->addJsSessionCookie(I19723, $aUser[I19723]); }$editMode =(bool)$oSession->GetVar(I19723); $lL1LLLl =FALSE === mb_strpos($_SERVER['REQUEST_URI'], 'ami_mod_view_type=') && ($editMode || (bool)$aUser['ami_efa']); AMI_Registry::set('ami/editMode/displayToolbar', $lL1LLLl); AMI_Registry::set('ami/editMode/enabled', $editMode); if($editMode){ $oDB =new DB_si; $sql ="SELECT `id` FROM `cms_host_users` WHERE `id_member` = " .(int)$aUser['id'] ." AND `sys_user` = 1"; $oDB->query($sql); if(!$oDB->nextRecord()){ DB_si::globalAttr('multi_user', TRUE); if(isset($db)){ $db->ILlllll =FALSE; }if(isset($frn) && !$frn->Core->GetUserId()){ $frn->Core->TTlIlIl((int)$aUser[I19724]); }}}if(isset($frn) && (int)$aUser[I19724]){ $frn->Gui->addStyle('skin.css'); }if(isset($frn) && $lL1LLLl){ $frn->Gui->addMeta('name', 'viewport', 'width=device-width, initial-scale=1.0, maximum-scale=1.0'); $frn->Gui->addMeta(I19725, 'apple-mobile-web-app-capable', 'yes'); $frn->Gui->addMeta(I19725, 'mobile-web-app-capable', 'yes'); $frn->Gui->addStyle(I19726); $run =FALSE; }}}