var amiSkinController={service:"ami_skin_tools",isToolbarLoaded:!1,isModuleLoaded:!1,isModuleVisible:!1,isActionInProgress:!1,isMobile:!1,isTouch:!1,mode:"",toolbar:!1,module:!1,oToolbar:!1,oSubmenu:!1,submenuElement:"NOBR",needCheck:!1,init:function(){this.modId="undefined"!==typeof authData?authData.modId:"";this.isTouch=this.isTouchDevice();this.isModuleLoaded||(this.initModule(),this.initPostMessageListener(),this.initFont());return this},initFont:function(){var a=document.getElementsByTagName("head")[0],
b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href","//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css");a.insertBefore(b,a.firstChild)},setEntityId:function(a,b){this.id=a;this.isCat="undefined"!==typeof b&&b},initToolbar:function(){if(!this.isToolbarLoaded){this.toolbar=window.document.getElementById("ami-toolbar").contentWindow;this.oToolbar=new amiToolbar(window,this.toolbar,this.module);var a="undefined"!==
typeof amiSession&&amiSession.get("ami_efe")?"on":"off";this.gaSendEvent("toolbar-loaded","edit-mode-"+a);(this.isAndroidBrowser()||0<=navigator.userAgent.indexOf("Opera")&&0<=navigator.userAgent.indexOf("Mini"))&&this.showAndroidBrowserWarning();mobileFixBar.init();this.isToolbarLoaded=!0}},initModule:function(){$("body").prepend('<div id="ami-edit-mode-page-loader"></div><div style="display: none;" id="ami-edit-block"><div id="ami-toolbar__area"></div></div><div id="ami-toolbar__status-message"></div><div id="ami-toolbar__multi-items"></div>');
$("#ami-toolbar__area").append('<iframe id="ami-toolbar__area-edit" frameborder="0" width="100%" height="100%" src="about:blank"></iframe>');amiSkinController.moduleReset();$("#ami-toolbar__area-edit").load(function(){amiSkinController.module=window.document.getElementById("ami-toolbar__area-edit").contentWindow;amiSkinController.moduleLoaded();amiSkinController.stopSpinner();amiSkinController.needCheck&&(amiSkinController.needCheck=!1,setTimeout(function(){try{!amiSkinController.module||amiSkinController.module.oActiveModule||
amiSkinController.module.editorBaseHref||(amiSkinController.showMessage(amiSkinController.toolbar.aLocale.request_error,!0),amiSkinController.isActionInProgress=!1)}catch(a){}},1E3))})},getURL:function(a){var b=window.frontBaseHref+"ami_strict.php?";switch(a){case "empty":b=b+"ami_svc="+amiSkinController.service+"&action=empty&ami_env=fast&ami_resp_mode=HTML&ami_browser_cache=1";break;case "form":b=b+"ami_svc="+amiSkinController.service+"&action=edit&ami_resp_mode=HTML&ami_env=fast";break;case "toggle_edit_mode":b=
b+"ami_svc="+amiSkinController.service+"&action=toggle_edit_mode&ami_env=fast";break;case "logout":b=b+"ami_svc="+amiSkinController.service+"&action=logout&ami_env=full";break;case "modules":b=b+"ami_svc="+amiSkinController.service+"&action=modules_list&ami_env=full&rv="+window.authData.rv;break;case "base":b=b+"ami_locale="+AMI_SessionData.locale}"base"!==a&&(b=b+"&ami_locale="+AMI_SessionData.locale);return b},moduleReset:function(){amiSkinController.needCheck=!1;AMI.$("#ami-toolbar__area-edit").attr("src",
amiSkinController.getURL("empty")+"&modId="+amiSkinController.modId);amiSkinController.mode="none"},moduleLoaded:function(){this.isModuleLoaded=!0;"undefined"===typeof this.closeHandlersAdded&&($("#ami-edit-block").click(function(){amiSkinController.closeModule()}),$(document).keydown(function(a){65===a.which&&a.altKey&&amiSkinController.userMenu();27===a.which&&amiSkinController.closeModule()}),this.closeHandlersAdded=!0);var a=!0;"settings"===this.mode&&(a=!1);a&&$(this.module.document).keydown(function(a){27===
a.which&&amiSkinController.closeModule()});this.isActionInProgress=!1;this.stopSpinner();this.isToolbarLoaded&&this.oToolbar.update()},closeModule:function(a){amiSkinController.isModuleVisible&&("undefined"===typeof a&&"settings"!==this.mode&&"undefined"!==typeof amiSkinController.module.modCloseFunction?(amiSkinController.module.modCloseFunction(),0<AMI.$(".eshop-order-history-list").length&&AMI.$(".eshop-order-history-list tr").removeAttr("class")):amiSkinController.openModule());!amiSkinController.isModuleVisible&&
this.oToolbar&&(this.isActionInProgress=!1,this.oToolbar.setMode("toolbar"),this.oToolbar.update())},reload:function(){try{if("undefined"!==typeof this.module.confirmChanges&&!this.module.confirmChanges())return}catch(a){}window.location.reload()},editModeOnOff:function(a){if(!this.toolbar)return!1;if(a||"undefined"===typeof this.module.confirmChanges||this.module.confirmChanges()){var b=amiSkinController.getURL("toggle_edit_mode")+"&ami_efe="+(a?"1":"0");a?$(this.toolbar.document.getElementById("ami-edit-mode-swith")).removeClass("ami-edit-mode-swith-off").addClass("fa-spin"):
$(this.toolbar.document.getElementById("ami-edit-mode-swith")).addClass("ami-edit-mode-swith-off fa-spin");$.ajax({url:b}).done(function(){window.location.reload()})}},editModeOn:function(){amiSkinController.gaSendEvent("toolbar-click","edit-mode-on");setTimeout(function(){amiSkinController.editModeOnOff(!0)},200)},editModeOff:function(){amiSkinController.gaSendEvent("toolbar-click","edit-mode-off");setTimeout(function(){amiSkinController.editModeOnOff(!1)},200)},resetForm:function(){try{AMI.$("#ami-toolbar__area-edit").contents().find("html").fadeOut(),
setTimeout(function(){AMI.$("#ami-toolbar__area-edit").contents().find("html").html("")},300)}catch(a){}},shakeForm:function(){$("#ami-toolbar__area-edit").addClass("shake");$("#ami-toolbar__area-edit").addClass("shake-constant");setTimeout(function(){$("#ami-toolbar__area-edit").removeClass("shake");$("#ami-toolbar__area-edit").removeClass("shake-constant")},500)},selectModule:function(){if(!this.toolbar)return!1;"undefined"===typeof window.authData&&alert(this.toolbar.aLocale.warning_edit_mode_off);
var a=$('<div id="option-loader">');if(this.oSubmenu&&"setup"===this.oSubmenu.getMode())this.oSubmenu&&this.oSubmenu.toggle();else{this.oSubmenu=new amiSkinSubmenu("setup");this.oSubmenu.addTitle(this.toolbar.aLocale.select_current_module);this.oSubmenu.addBlock("modules");if("undefined"!==typeof aEditableModules&&aEditableModules.length){for(var b=0;b<aEditableModules.length&&!(20<b);b++){var d=aEditableModules[b],c="ami-conf-"+d.conf;this.oSubmenu.addItem("modules",d.caption,{onClick:function(c){return function(){amiSkinController.gaSendEvent("submenu-modules",
"click","module");setTimeout(function(){document.location.href=frontBaseHref+c.link},300)}}(d),"class":c})}AMI.$(".ami-conf-eshop").prepend('<i class="fa fa-shopping-cart"></i> ');AMI.$(".ami-conf-orders").prepend('<i class="fa fa-bar-chart-o"></i> ');AMI.$(".ami-conf-feedback").prepend('<i class="fa fa-envelope-o"></i> ');AMI.$(".ami-conf-news").prepend('<i class="fa fa-newspaper-o"></i> ');AMI.$(".ami-conf-blog").prepend('<i class="fa fa-users"></i> ');AMI.$(".ami-conf-articles").prepend('<i class="fa fa-newspaper-o"></i> ');
AMI.$(".ami-conf-photoalbum").prepend('<i class="fa fa-picture-o"></i> ')}else this.oSubmenu.addItem("modules",this.toolbar.aLocale.no_elements,{onClick:function(){}});this.oSubmenu.addTitle(this.toolbar.aLocale.select_option,"amiControlPanelTitle");this.oSubmenu.addBlock("options");this.oSubmenu.addItem("options",a,{noHover:!0,id:"amiro_modules_select"});$("#amiro_modules_select").click(function(c){c.stopPropagation()});window.authData.adminAllowed?"undefined"===typeof window.aAllModData?$.getJSON(amiSkinController.getURL("modules"),
{},function(c){window.aAllModData=c.data.aAllModData;amiSkinController.initModulesSelect()}):amiSkinController.initModulesSelect():AMI.$("#amiro_modules_select, .amiControlPanelTitle").hide();amiSkinController.oSubmenu.left(0);this.toolbar.$("li").removeClass("submenu__item-btn-selected");this.oSubmenu.open()}},initPostMessageListener:function(){window.addEventListener?window.addEventListener("message",amiSkinController.postMessageListener,!1):window.attachEvent("onmessage",amiSkinController.postMessageListener)},
postMessageListener:function(a){switch(a.data.split("|")[0]){case "openModule":amiSkinController.openModule("show");break;case "closeModule":amiSkinController.closeModule();break;case "closeSubmenu":amiSkinController.closeSubmenu();break;case "formChanged":amiSkinController.setFormChanged(!0);break;case "formUnchanged":amiSkinController.setFormChanged(!1);break;case "fixMobileBar":amiSkinController.isMobile&&mobileFixBar.reSize()}},setFormChanged:function(a){a?(this.toolbar.$(".save-btn, .back-btn").addClass("has-changes"),
this.toolbar.$(".back-btn .bar-title").html(this.toolbar.aLocale.caption_cancel)):(this.toolbar.$(".save-btn, .back-btn").removeClass("has-changes"),this.toolbar.$(".back-btn .bar-title").html(this.toolbar.aLocale.caption_cancel_nc))},initModulesSelect:function(){var a=this.toolbar,b=a.aLocale.modules_select_start_type,a={title:"",notFound:a.aLocale.modules_select_not_found,selected:window.active_module,button:"",onInit:function(c){},onListOpen:function(c,a){var b=AMI.$("[data-ami-select-item-value="+
window.active_module+"]");b.length&&(a.scrollTop(a.scrollTop()+b.position().top),b.find("SPAN").css("font-weight","bold"))},onAddItem:function(c,a,b,e,d,n){b=b.replace(/\<b\>/ig,"").replace(/\<\/b\>/ig,"");n.attr("data-ami-select-item-full",b);c.getOpt("selected","")===e&&AMI.$("#"+c.name+"-viewed").text(b);0===e.indexOf("plugin")&&n.addClass("disabled");n.html('<span style="vertical-align:middle">'+n.html()+"</span>");for(var h in window.aAllModData)if(window.aAllModData[h].caption===a){for(var p in window.aAllModData[h].items)if(p===
e)for(var q in c.highlighted)a=new RegExp("("+q+")","ig"),a.test(p)&&n.html(n.html()+" ["+p.replace(a,"<b>$1</b>")+"]");break}},onSelect:function(c,a,b,e){for(var d in window.aAllModData)for(var n in window.aAllModData[d].items)if(n===b){amiSkinController.gaSendEvent("submenu-modules-click","modules-selectbox");window.open(window.authData.url+"auth_by_hash.php?domain="+window.authData.domain+"&sid="+window.authData.sid+"&url="+encodeURIComponent(window.aAllModData[d].items[n].link));return}},onEmptySearch:function(c){return!0},
onSearch:function(c,a,b,e,d){return e.length?!1:(c.highlighted={"Fake String That Never Be Found":!0},!0)},onAfterInit:function(c){AMI.$("#"+c.name+"-resultrow input").attr("placeholder",b);"start"!==window.module_name&&AMI.$("#"+c.name+"-resultrow input").val("");""!==AMI.$("#"+c.name+"-viewed").text()&&(AMI.$("#"+c.name+"-viewed").show(),AMI.$("#"+c.name+"-resultrow input").hide())}},d=AMI.$.extend(!0,{},window.aAllModData),c;for(c in d)for(var e in d[c].items)"undefined"!==typeof d[c].items[e].link&&
d[c].items[e].link.length||delete d[c].items[e];window.oModulesSelectBox=new amiSelectBox("amiro_modules_select_header",d,a);window.oModulesSelectBox.init("amiro_modules_select")},userMenu:function(){if("usermenu"==this.oToolbar.getMode())return this.closeModule(),!1;this.toolbar.$("#username").html(amiSession.get("firstname_cookie")+" "+amiSession.get("lastname_cookie")+" ("+amiSession.get("username_cookie")+")");this.gaSendEvent("toolbar-click","usermenu");this.oToolbar.setMode("usermenu");this.oToolbar.update()},
getCatModId:function(a){switch(a){case "eshop_item":a="eshop_cat";break;case "pages":a="pages";break;default:0>a.indexOf("_cat")&&(a+="_cat")}return a},openForm:function(a,b){if(!this.toolbar||this.isActionInProgress)return!1;this.closeSubmenu();b="undefined"!==typeof b?b:{};var d="undefined"!==typeof b.isCat&&b.isCat,d="undefined"!==typeof b.modId?b.modId:d?this.getCatModId(this.modId):this.modId,c="add"!==a?parseInt("undefined"!==typeof b.id?b.id:0):0,e="pages"===d?c?c:window.active_module_page_id:
0;if(0!==e&&authData.isVirtual&&"add"!==a)d=this.toolbar.aLocale.virtual_page_warn,d=d.replace(/_mod_name_/g,authData.moduleHeader),d=d.replace(/_parent_name_/g,authData.parentHeader),d=d.replace(/_parent_link_/g,authData.parentLink),this.showMessage(d,"not-close");else{if(this.isModuleVisible&&a===this.mode){var l=this.module.oActiveModule,g=parseInt(l.itemId);if(d===l.modId&&g===c)return}if(!this.isModuleVisible||"settings"===this.mode||"undefined"===typeof this.module.confirmChanges||this.module.confirmChanges()){this.isActionInProgress=
!0;"settings"!==this.mode&&this.resetForm();"settings"!==a&&(this.needCheck=!0);this.mode=a;this.oToolbar.setMode(a);AMI.$("#ami-toolbar").contents().find("li").removeClass("item-btn-selected");AMI.$("#ami-toolbar").contents().find("."+this.mode+"-btn").addClass("item-btn-selected");this.startSpinner();var m="settings"===a?window.authData.url+"auth_by_hash.php?domain="+window.authData.domain+"&sid="+window.authData.sid+"&url="+encodeURIComponent("srv_options.php?flt_mode=simple&flt_owner="+active_module_owner+
"&flt_module="+active_module+"&frn_skin_popup=1"):amiSkinController.getURL("form")+"&modId="+d+"&id="+c+(0===e?"":"&pageId="+e+"&id_mod="+active_module)+("seo"===a?"#seo":"");setTimeout(function(){AMI.$("#ami-toolbar__area-edit").attr("src",m)},500)}}},itemListConrolIcons:function(){amiSkinController.rowMarkersToIcons();0<$(".ami-item-list-icons").length&&0<$('span[class*="_item-row"], span[class*="_item-cat-row"], span[class*="_browse-item-row"], span.eshop-item-small').length&&($(document).keydown(function(a){27===
a.which&&$("#ami-item__delete-item .popupClose").length&&$("#ami-item__delete-item .popupClose").click()}),$(".ami-item-list-icons").addClass("ami-item-list-icons-default"),$(".ami-item-list-icons").next().addClass("ami-item-list-icons-block-default"),$(".ami-item-list-icons-block-default").wrap('<span class="'+$(".ami-item-list-icons-block-default:eq(0)").attr("class")+'"></span>'),$(".ami-item-list-icons-block-default").find(".ami-item-list-icons-block-default").removeAttr("class").addClass("ami-item-list-icons-block__area"),
amiSkinController.addListIconsEvents())},rowMarkersToIcons:function(){try{$(":not(iframe)").contents().filter(function(){return 8==this.nodeType}).each(function(a,b){if(0===b.nodeValue.indexOf("AMI_ROW_EDITABLE:")){var d=b.nodeValue.substring(17);try{var c=JSON.parse(d),e=b.nextElementSibling;e||(e=b.parentNode);e&&$(e).prepend(amiSkinController.createFloatingRowIcons(c))}catch(l){}}})}catch(a){}},createFloatingRowIcons:function(a){var b=$("<DIV>");b.addClass("ami-item-list-icons");b.addClass("ami-item-list-icons-td");
b.prop("id","ami-item-list-icons-"+a.id);b.attr("data-header",a.header);b.attr("data-id",a.id);b.attr("data-is-cat",a.isCat);var d=$("<SPAN>");d.addClass("ami-item-list-icons__row");var c=$("<A>");c.addClass("ami-item-list-icons__row-edit");var e=$("<IMG>");e.prop("src",frontBaseHref+"_shared/code/web/skins/ami_touch/images/list_edit.png");c.append(e);c.click(function(){amiSkinController.editElement(a.id,a.isCat)});var e=$("<A>"),l=$("<IMG>");l.prop("src",frontBaseHref+"_shared/code/web/skins/ami_touch/images/list_delete.png");
e.append(l);e.addClass("ami-item-list-icons__row-delete");e.click(function(){amiSkinController.deleteElement(a.id,a.isCat)});d.append(c);d.append(e);b.append(d);return b},addListIconsEvents:function(a){"undefined"===typeof a&&(a=!1);if(!this.listButtonsEventsAdded||a)$(".ami-item-list-icons").next().hover(function(){$(this).addClass("ami-item-list-block__hover");$(this).prev().addClass("ami-item-list-icons__row-hover")},function(){$(this).removeClass("ami-item-list-block__hover");$(this).prev().removeClass("ami-item-list-icons__row-hover")}),
$(".ami-item-list-icons__row").hover(function(){$(this).parent().next().addClass("ami-item-list-block__hover");$(this).parent().addClass("ami-item-list-icons__row-hover")},function(){$(this).parent().next().removeClass("ami-item-list-block__hover");$(this).parent().removeClass("ami-item-list-icons__row-hover")}),AMI.$(".ami-item-list-icons[data-is-cat=false]").each(function(){var a=function(a){return function(c){c.preventDefault();c=AMI.$(a).attr("data-id");amiSkinController.openForm("edit",{id:c,
isCat:!1});amiSkinController.gaSendEvent("list-icons-click","edit-item");AMI.$(this).parent().addClass("selected-order")}}(this);"TD"===this.tagName&&amiSkinController.isTouch&&(AMI.$(this).parent().find("td:not(.ami-item-list-icons)").click(a),AMI.$(this).find(".ami-item-list-icons__row-edit").hide());AMI.$(this).find(".ami-item-list-icons__row-edit").click(a)}),AMI.$(".ami-item-list-icons[data-is-cat=true]").each(function(){var a=function(a){return function(){amiSkinController.openForm("edit",{id:AMI.$(a).attr("data-id"),
isCat:!0});amiSkinController.gaSendEvent("list-icons-click","edit-category")}}(this);AMI.$(this).find(".ami-item-list-icons__row-edit").click(a)}),this.listButtonsEventsAdded=!0},needActionSubmenu:function(){var a=["news","articles","blog","gallery"];return"pages"!==authData.modId||0<=a.indexOf(active_module)},showActionSubmenu:function(a){if(window.authData.moduleAllowed||window.authData.pagesAllowed)if(this.oSubmenu&&this.oSubmenu.getMode()===a)this.oSubmenu&&this.oSubmenu.toggle();else{this.oSubmenu&&
this.oSubmenu.destroy();this.oSubmenu=new amiSkinSubmenu(a);var b="eshop_order"!==active_module,d="eshop_order"!==active_module,c=this.toolbar.aLocale,e=["news","articles","blog","gallery"];if("add"===a)this.oSubmenu.addBlock("list"),window.authData.moduleAllowed&&(0<=e.indexOf(active_module)&&this.oSubmenu.addItem("list",c.caption_select_item,{onClick:function(){amiSkinController.gaSendEvent("submenu-add-click","add-50-item");amiSkinController.showMessage(amiSkinController.toolbar.aLocale.old_module_warn,
"not-close")}}),b&&"pages"!==authData.modId&&((!active_module_has_categories||active_module_category_id&&active_module_has_categories)&&this.oSubmenu.addItem("list",c.caption_select_item,{onClick:function(){amiSkinController.gaSendEvent("submenu-add-click","add-item");amiSkinController.openForm(a,{isCat:!1})}}),active_module_has_categories&&this.oSubmenu.addItem("list",c.caption_select_category,{onClick:function(){amiSkinController.gaSendEvent("submenu-add-click","add-category");amiSkinController.openForm(a,
{isCat:!0})}}))),window.authData.pagesAllowed&&this.oSubmenu.addItem("list",c.caption_select_page,{onClick:function(){amiSkinController.gaSendEvent("submenu-add-click","add-page");amiSkinController.openForm(a,{modId:"pages"})}});else{if(window.authData.moduleAllowed&&(0<=e.indexOf(active_module)&&(this.oSubmenu.addBlock("list"),this.oSubmenu.addItem("list",c.caption_select_item,{onClick:function(){amiSkinController.gaSendEvent("submenu-add-click","add-50-item");amiSkinController.showMessage(amiSkinController.toolbar.aLocale.old_module_warn,
"not-close")}})),"pages"!==authData.modId)){var b="seo"!==a||d,l=!1,d="undefined"!==typeof active_module_item_header&&parseInt(active_module_element_id);(0<AMI.$(".ami-item-list-icons[data-is-cat=false]").length||d)&&b&&(this.oSubmenu.addTitle(this.toolbar.aLocale["edit"===a?"caption_select_item":"caption_select_for_item"]),this.oSubmenu.addBlock("list"),"undefined"!==typeof active_module_item_header&&parseInt(active_module_element_id)&&active_module_item_header?(amiSkinController.oSubmenu.addItem("list",
active_module_item_header,{onClick:function(){amiSkinController.openForm(a,{id:active_module_element_id,isCat:!1});amiSkinController.gaSendEvent("submenu-"+a+"-click",a+"-item")}}),l=!0):AMI.$(".ami-item-list-icons[data-is-cat=false]").each(function(c){19<c||(c=function(c){return function(){var b=AMI.$(c).attr("data-id");amiSkinController.openForm(a,{id:b,isCat:!1});amiSkinController.gaSendEvent("submenu-"+a+"click",a+"-item")}}(this),amiSkinController.oSubmenu.addItem("list",AMI.$(this).attr("data-header"),
{onClick:c}),l=!0)}));if(b&&active_module_has_categories){d="edit"===a?"caption_select_category":"caption_select_for_category";b=0<AMI.$(".ami-item-list-icons[data-is-cat=true]").length;if("undefined"!==typeof active_module_category_header&&active_module_category_header||b)this.oSubmenu.addTitle(this.toolbar.aLocale[d]),this.oSubmenu.addBlock("list-cat");var g="";"undefined"!==typeof active_module_category_header&&(d=active_module_category_header,b&&(d="[ "+active_module_category_header+" ]"),amiSkinController.oSubmenu.addItem("list-cat",
d,{onClick:function(){amiSkinController.openForm(a,{id:active_module_category_id,isCat:!0});amiSkinController.gaSendEvent("submenu-"+a+"-click",a+"-category")}}),g="&nbsp;&bull;&nbsp;&nbsp;",l=!0);b&&AMI.$(".ami-item-list-icons[data-is-cat=true]").each(function(c){19<c||(c=function(c){return function(){amiSkinController.openForm(a,{id:AMI.$(c).attr("data-id"),isCat:!0});amiSkinController.gaSendEvent("submenu-"+a+"-click",a+"-category")}}(this),amiSkinController.oSubmenu.addItem("list-cat",g+AMI.$(this).attr("data-header"),
{onClick:c}),l=!0)})}l||window.authData.pagesAllowed||(amiSkinController.showMessage(this.toolbar.aLocale.nothing_edit_warn),this.oSubmenu.onClose(),this.oSubmenu.destroy(),this.oToolbar.setMode("toolbar"),this.oToolbar.update())}window.authData.pagesAllowed&&(this.oSubmenu.addTitle(this.toolbar.aLocale["edit"===a?"caption_select_page":"caption_select_for_page"]),this.oSubmenu.addBlock("list-page"),amiSkinController.oSubmenu.addItem("list-page",active_module_page_header,{onClick:function(){amiSkinController.openForm(a,
{modId:"pages",id:active_module_page_id});amiSkinController.gaSendEvent("submenu-"+a+"-click",a+"-page")}}))}this.oSubmenu.onShow=function(){var c=amiSkinController.toolbar,b=amiSkinController.oSubmenu,e=c.aLocale;c.$("."+a+"-btn").addClass("submenu__item-btn-selected");c.$("."+a+"-btn .list-title").html(e["caption_"+a+"_submenu"]);b.left(c.$(".submenu__item-btn-selected").offset().left)};this.oSubmenu.onClose=function(){var c=amiSkinController.toolbar,b=c.aLocale;c.$("li").removeClass("submenu__item-btn-selected");
c.$("."+a+"-btn .list-title").html(b["caption_"+a])};this.oSubmenu.open()}else this.oSubmenu&&this.oSubmenu.destroy()},actionWithSubmenu:function(a){this.needActionSubmenu()?this.showActionSubmenu(a):this.openForm(a)},editElement:function(a,b){this.openForm("edit",{id:a,isCat:b})},deleteElement:function(a,b){if(!this.toolbar)return!1;var d=this.toolbar,c=d.aLocale.list_confirm_deletion,e=d.aLocale.list_confirm_yes,d=d.aLocale.list_confirm_no;amiSkinController.gaSendEvent("list-icons-click","delete-"+
b?"category":"item");this.isMobile?confirm(c)&&this.del(a,b):AMI.UI.Popup('<div class="ami-item__delete">'+c+'</div><div class="ami-item-menu__delete-btn"><input type="button" onclick="amiSkinController.del('+a+", "+(b?"true":"false")+'); closePopup();" class="btn btn-delete" value="'+e+'"><input onclick=\'closePopup();\' type="button" class="btn btn-cancell" value="'+d+'">',{id:"ami-item__delete-item",width:"262"})},del:function(a,b){var d=amiSkinController.module,c=d.oActiveModule.modId;b&&0>c.indexOf("_cat")&&
(c="eshop_item"===c?"eshop_cat":c+"_cat",d.oActiveModule.modId=c);var e={mod_action:"list_delete",id:a,mod_action_id:a,_amits:window._amits,_amitsh:window._amitsh};"eshop_cat"===c&&(e.type="del");d.oListRequest.get(e,function(c){return function(a){amiSkinController.showMessage(a.status_msgs[0].message);"status_del"===a.status_msgs[0].key&&(amiSkinController.showRefresh(),amiAdminFormPage.showHideOk(),$("td#ami-item-list-icons-"+c).parent().remove(),$("#ami-item-list-icons-"+c).next().remove(),$("#ami-item-list-icons-"+
c).remove(),mobileFixBar.reSizeIcons())}}(a))},edit:function(){this.needActionSubmenu()?this.showActionSubmenu("edit"):this.openForm("edit",{id:active_module_element_id})},seo:function(){this.needActionSubmenu()?this.showActionSubmenu("seo"):this.openForm("seo",{id:active_module_element_id})},add:function(){this.needActionSubmenu()?this.showActionSubmenu("add"):this.openForm("add")},settings:function(){this.openForm("settings")},startSpinner:function(){if(!this.toolbar)return!1;this.isModuleVisible||
$("#ami-edit-mode-page-loader").fadeIn();this.oToolbar.startSpin()},stopSpinner:function(){if(!this.toolbar)return!1;$("#ami-edit-mode-page-loader").hide();this.oToolbar.stopSpin()},showRefresh:function(){amiSkinController.oToolbar.showRefresh()},openModule:function(a){var b=AMI.$("#ami-toolbar__area-edit");amiAdminFormPage.showHideOk("stop");"0px"===b.css("right")&&"show"!==a?("toolbar"!==a&&AMI.$("#ami-toolbar").contents().find("."+this.mode+"-item-btn").removeClass("item-btn-selected"),b.animate({right:-2E3},
500),AMI.$("#ami-edit-block").nextAll().removeClass("ami__site-hide"),setTimeout(function(){AMI.$("#ami-edit-block").hide()},500),this.isModuleVisible=mobileFixBar.flameLoaded=!1,this.isMobile&&setTimeout(function(){mobileFixBar.reSize()},10)):"edit-mode-off"!==a&&(AMI.$("#ami-edit-block").nextAll().addClass("ami__site-hide"),AMI.$("#ami-edit-block").show(),AMI.$("#ami-toolbar").contents().find("."+this.mode+"-item-btn").addClass("item-btn-selected"),b.animate({right:0},500),this.isModuleVisible=
!0,$("#ami-edit-block").css("height",$(window).height()-$("#ami-toolbar").height()),this.isMobile&&mobileFixBar.reSize())},mobileHomeBtn:function(){var a;if(0<=navigator.userAgent.indexOf("Android"))a="mobile_home_btn_android";else if(0<=navigator.userAgent.indexOf("Apple")&&0<=navigator.userAgent.indexOf("Mobile"))a="mobile_home_btn_ios";else return!1;AMI.$("#ami-toolbar-block").after('        <div id="edp-popup-info__home" class="edp-popup-info">            <div class="edp-popup-info__title">'+
this.toolbar.aLocale.mobile_home_btn+'</div>            <div class="edp-popup-info__text">'+this.toolbar.aLocale[a]+'</div>            <div class="edp-popup-info__site-link"><a href="'+location.origin+'/#ami-login">'+location.origin+"/#ami-login</a></div>            <div class=\"edp-popup-info__cancell\">                <button onclick=\"AMI.$('#edp-popup-info__home').animate({top: '-'+AMI.$('#edp-popup-info__home').height()})\">"+this.toolbar.aLocale.warning_is_android_done+"</button>            </div>        </div>");
AMI.$("#edp-popup-info__home").css("top","-"+AMI.$("#edp-popup-info__home").height()+"px").fadeIn().animate({top:AMI.$("#ami-toolbar-block").height()})},adjustModuleHeight:function(a){a=$("#ami-toolbar__area-edit");a.height(a.contents().find("body").height())},getDeviceClass:function(){return this.toolbar.getComputedStyle(this.toolbar.$("#device-class")[0],":before").content},isTouchDevice:function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)},isAndroidBrowser:function(){var a=navigator.userAgent,b=-1<a.indexOf("Android")&&-1<a.indexOf("Mozilla/5.0")&&-1<a.indexOf("AppleWebKit"),d=new RegExp(/AppleWebKit\/([\d.]+)/),a=null===d.exec(a)?null:parseFloat(d.exec(a)[1]);return b&&null!==a&&537>a},showAndroidBrowserWarning:function(){null===localStorage.getItem("isAndroidBrowser")&&(AMI.$("#ami-toolbar-block").after('            <div id="is-android-browser">                <div class="is-android-browser__title">'+
this.toolbar.aLocale.warning_is_android+'</div>                <div class="is-android-browser__text">'+this.toolbar.aLocale.warning_is_android_download+':</div>                <div class="is-android-browser__type">                    <span class="is-android-browser__types is-android-browser__type-chrome"><a target="_blank" href="http://www.google.com/chrome">Chrome</a></span>                    <span class="is-android-browser__types is-android-browser__type-firefox"><a target="_blank" href="http://www.mozilla-europe.org">Firefox</a></span>                    <span class="is-android-browser__types is-android-browser__type-opera"><a target="_blank" href="http://opera.com">Opera</a></span>                </div>                <div class="is-android-browser__cancell">                    <button onclick="AMI.$(\'#is-android-browser\').animate({top: \'-\'+AMI.$(\'#is-android-browser\').height()})">'+
this.toolbar.aLocale.warning_is_android_done+"</button>                </div>            </div>"),AMI.$("#is-android-browser").css("top","-"+AMI.$("#is-android-browser").height()+"px").fadeIn().animate({top:AMI.$("#ami-toolbar-block").height()}),localStorage.setItem("isAndroidBrowser","1"))},showMessage:function(a,b){$("#ami-toolbar__status-message").html('<div class="ami-toolbar__status-message-text">'+a+"</div>");$("#ami-toolbar__status-message").css("top",-$("#ami-toolbar__status-message").height());
$("#ami-toolbar__status-message").animate({top:$("#ami-toolbar").height()},1500).attr("data-show","on");b?$("#ami-toolbar__status-message .ami-toolbar__status-message-text").append("<div class=\"ami-toolbar__status-message-link\"><a onclick=\"$('#ami-toolbar__status-message').animate({top: -$('#ami-toolbar__status-message').height()}, 1500).attr('data-show', 'off'); return false;\" href=\"#\">"+this.toolbar.aLocale.close_message+"</a></div>"):setTimeout(function(){$("#ami-toolbar__status-message").animate({top:-$("#ami-toolbar__status-message").height()},
1500).attr("data-show","off")},6E3)},closeSubmenu:function(){this.oSubmenu&&this.oSubmenu.close()},gaSendEvent:function(){}};
mobileFixBar={windowCurrentWidth:window.innerWidth,windowCurrentHeight:window.innerHeight,flameLoaded:!1,reload:!1,screenWidth:320,init:function(){if(990>screen.width||!0===/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){var a="mobile";amiSkinController.isMobile=!0;$("#ami-toolbar").contents().find("html").animate({opacity:1})}else a="desctop",amiSkinController.isMobile=!1,$("#ami-toolbar").contents().find("html").animate({opacity:1}),this.reSizeIcons();"mobile"===a&&(mobileFixBar.reSize(),
$("#ami-toolbar").contents().find("body").addClass("mobile-fix-bar"),setInterval(function(){mobileFixBar.screenWidth===screen.width&&mobileFixBar.windowCurrentWidth===window.innerWidth||mobileFixBar.reSize();if(window.innerHeight!==mobileFixBar.windowCurrentHeight){var a=$("#ami-toolbar__area-edit").contents();mobileFixBar.windowCurrentHeight=window.innerHeight;0===a.find("input:focus, textarea:focus").length?amiAdminFormPage.hidePanelMobile(a,!1):amiAdminFormPage.hidePanelMobile(a,!0)}},500))},mobileOrientation:function(){return window.innerWidth>
window.innerHeight?"horizontal":"vertical"},reSize:function(){var a=$("#ami-toolbar__area-edit").contents(),b=$("#ami-toolbar");this.screenWidth=document.body.clientWidth;this.windowCurrentWidth=window.innerWidth;this.setSize(b,this.windowCurrentWidth,a)},setSize:function(a,b,d){$("body").css("padding-top",Math.floor(50/this.screenWidth*b));$("#ami-toolbar-block").css("height",Math.floor(50/this.screenWidth*b));$("#ami-toolbar__status-message").css({"font-size":Math.floor(8*Math.floor(50/this.screenWidth*
b)/24),padding:Math.floor(Math.floor(50/this.screenWidth*b))/10*2});"on"===$("#ami-toolbar__status-message").attr("data-show")&&$("#ami-toolbar__status-message").css({top:Math.floor(50/this.screenWidth*b)});this.flameLoaded=!0;$("#multi-items__scroll img").css("height",Math.floor(20/this.screenWidth*b));$(".ami-toolbar__multi-items__item").css({"padding-top":Math.floor(Math.floor(50/this.screenWidth*b))/10*2,"padding-bottom":Math.floor(Math.floor(50/this.screenWidth*b))/10*2,"font-size":Math.floor(.3*
Math.floor(50/this.screenWidth*b))});a.contents().find(".edit-mode-item-btn span").css({width:Math.floor(54/this.screenWidth*b),height:Math.floor(56/this.screenWidth*b)/2});a.contents().find(".edit-mode-item-btn label").css({top:Math.floor(40/this.screenWidth*b)/4});a.contents().find("img").css("height",Math.floor(50/this.screenWidth*b));$(".ami-item-list-icons__row img").css({width:Math.floor(20/this.screenWidth*b)});a.contents().find("i").css("font-size",Math.floor(8*Math.floor(50/this.screenWidth*
b)/20));$("#amiro_modules_select_header-resultrow input, #amiro_modules_select_header-resultrow div, #amiro_modules_select_header-list div, #amiro_modules_select_header-list span").css("font-size",Math.floor(8*Math.floor(40/this.screenWidth*b)/20));a.contents().find(".edit-mode-item-btn span div").css("font-size",Math.floor(8*Math.floor(30/this.screenWidth*b)/20));a.contents().find("#edit_mode_on font").css({"font-size":Math.floor(8*Math.floor(50/this.screenWidth*b)/30),top:Math.floor(50/this.screenWidth*
b)/2/4});d="none"===a.contents().find("#refreshBtn").css("display")?"#username-btn i":"#refreshBtn i";a.contents().find("a").css({width:Math.floor(36/this.screenWidth*b),height:Math.floor(50/this.screenWidth*b),"padding-top":Math.round(50/this.screenWidth*b/2-a.contents().find(d).height()/2.4)});$("#ami-edit-block").css({height:$(window).height()-$("#ami-toolbar-block").height(),top:$(window).height()-($(window).height()-$("#ami-toolbar-block").height())});this.reSizeIcons()},reSizeIcons:function(){$(".ami-item-list-icons-default").each(function(){var a=
$(this);a.next()&&a.next().position()&&(a.css("top",a.next().position().top-a.outerHeight()+10),a.css("left",a.next().position().left+a.next().outerWidth()-a.outerWidth()-10));a.css("display","block")})}};
var amiAdminFormPage={init:function(){var a=$("#ami-toolbar__area-edit").contents(),b=this;setTimeout(function(){a.find(".text-input, .textarea-input").each(function(){""===$(this).val()?$(this).next("i").css("display","none"):$(this).next("i").css("display","block")})},500);a.find(".text-input, .textarea-input").keyup(function(){b.showInputClear(a,$(this))});amiSkinController.isMobile&&a.find("input, textarea").focus(function(){b.hidePanelMobile(a,!0)}).blur(function(){b.hidePanelMobile(a,!1)})},
showInputClear:function(a,b){0===$(b).val().length?$(b).next("i").css("display","none"):$(b).next("i").css("display","block")},hidePanelMobile:function(a,b){"horizontal"===mobileFixBar.position&&990>=screen.width&&300>$(window).height()&&b?($("#ami-edit-block").addClass("ami-edit-block__top"),$("#ami-toolbar-block").addClass("ami-toolbar-block__hide")):($("#ami-edit-block").removeClass("ami-edit-block__top"),$("#ami-toolbar-block").removeClass("ami-toolbar-block__hide"))},showHideOk:function(a){try{var b=
$("#ami-toolbar__area-edit").contents();"undefined"!==typeof a?(b.find("#saveActionButton").removeClass("animation-pulse"),b.find("#data-modified").css("display","none").removeClass("animation-pulse")):(b.find("#saveActionButton"),"none"===b.find("#data-modified").css("display")&&b.find("#data-modified").fadeIn(1E3).animate({opacity:"0.3"},600).animate({opacity:"1"},600))}catch(d){}}};
$(window).resize(function(){$("#ami-edit-block").css("height",$(window).height()-$("#ami-toolbar").height());setTimeout(function(){mobileFixBar.reSizeIcons()},300)});$(window).load(function(){amiSkinController.itemListConrolIcons();setTimeout(function(){mobileFixBar.reSizeIcons()},300)});
var amiSkinSubmenu=function(a){this.el="<"+amiSkinController.submenuElement+">";var b=$("#ami-toolbar__multi-items"),d,c="ami-toolbar__multi-items__"+a+"-mode",e=!1;this.getMode=function(){return a};this.left=function(c){d.parent().css("left",c+"px")};this.newEl=function(){var c=$(this.el);c.addClass("nobr-block");return c};this.create=function(){b.empty();d=this.newEl();d.attr("id","multi-items__block");d.addClass(c);b.append(d);submenuArea=this.newEl();submenuArea.attr("id","multi-items__block-area");
submenuArea.addClass("multi-items__block-area");d.append(submenuArea)};this.addTitle=function(c,a){var b=this.newEl();b.addClass("ami-toolbar__multi-items__item-title");"undefined"!==typeof a&&b.addClass(a);b.html(c);submenuArea.append(b)};this.addBlock=function(c,a){var b=this.newEl();b.attr("id","multi-items__block__"+c);b.addClass("multi-items__item-title__block");"undefined"!==typeof a&&b.html(a);submenuArea.append(b)};this.getBlock=function(c){return $("#multi-items__block__"+c)};this.add=function(c,
a){this.getBlock(c).append(a)};this.addItem=function(c,a,b){var e=this.newEl();e.addClass("ami-toolbar__multi-items__item");"undefined"!==typeof a&&e.append(a);"undefined"!==typeof b&&("undefined"!==typeof b.onClick&&e.click(b.onClick),"undefined"!==typeof b.noHover&&b.noHover&&(e.removeClass("ami-toolbar__multi-items__item"),e.addClass("ami-toolbar__multi-items__item_no_hover")),"undefined"!==typeof b.id&&e.attr("id",b.id),"undefined"!==typeof b["class"]&&e.addClass(b["class"]));this.getBlock(c).append(e)};
this.open=function(){if(!e){if("function"===typeof this.onShow)this.onShow();b.fadeIn(100).animate({top:$("#ami-toolbar").height()}).addClass("multi-items__show");e=!0;if(0===AMI.$("#multi-items__scroll").length){var c=this.newEl();c.attr("id","multi-items__scroll");c.html('<img src="'+frontBaseHref+'_img/icon-dec.gif" />');AMI.$("#multi-items__block").css("max-height",AMI.$(window).height()-AMI.$("#ami-toolbar-block").height());AMI.$("#ami-toolbar__multi-items").height()<AMI.$("#multi-items__block-area").height()&&
(AMI.$("#ami-toolbar__multi-items").append(c),AMI.$("#multi-items__block").css("max-height",AMI.$(window).height()-AMI.$("#ami-toolbar-block").height()-AMI.$("#multi-items__scroll").height()))}}};this.toggle=function(){e?this.close(!0):this.open()};this.close=function(c){e&&(e=!1,b.animate({top:"-"+b.height()}).removeClass("multi-items__show"),c||b.delay(300),b.fadeOut(),this.destroy())};this.destroy=function(){if("function"===typeof this.onClose)this.onClose()};this.create()},amiSelectBox=function(a,
b,d){this.name=a;this.aData=b;this.container=null;this.highlighted={};this.lastStr="";this.showTooMuch=!1;this.options="undefined"!==typeof d?d:{};this.getOpt=function(c,a){return"undefined"!==typeof this.options[c]?this.options[c]:"undefined"!==typeof a?a:null};this.init=function(c){"undefined"===typeof window.amiAdminSelectInstances&&(window.amiAdminSelectInstances={},window.getAmiAdminSelect=function(c){return"undefined"!==typeof window.amiAdminSelectInstances[c]?window.amiAdminSelectInstances[c]:
null},AMI.$(window).keydown(function(c){var a=!1,b;for(b in window.amiAdminSelectInstances)if(AMI.$("#"+b+"-list:visible").length){a=window.amiAdminSelectInstances[b];break}if(!1!==a){a=a.getListObject();b=a.find(".ami-select__selected");13===c.keyCode&&(b.length&&b.click(),c.preventDefault());if(38===c.keyCode){if(b.length){var e=b.prevAll(".ami-select__item").first();e.length||(e=b.parent().prev().find(".ami-select__item").last());e.length&&(e.mouseover(),0>e.position().top&&a.scrollTop(a.scrollTop()+
e.position().top))}else a.find(".ami-select__item").first().addClass("ami-select__selected"),a.scrollTop(0);c.preventDefault()}40===c.keyCode&&(b.length?(e=b.nextAll(".ami-select__item").first(),e.length||(e=b.parent().next().find(".ami-select__item").first()),e.length&&(e.mouseover(),e.position().top>a.height()-e.height()&&a.scrollTop(a.scrollTop()+e.height()+10))):(a.find(".ami-select__item").first().addClass("ami-select__selected"),a.scrollTop(0)),c.preventDefault())}}));window.amiAdminSelectInstances[this.name]=
this;var a=AMI.$("#"+c);this.container=a;if(a.length)return a.empty(),c=this.getOpt("onInit",!1),"function"===typeof c&&c(this),this.renderInputRow(a),this.getOpt("renderDataOnStart",!0)&&this.renderData(),this.initEvents(),AMI.$("#amiro_modules_select_header-list").css("height",AMI.$("#multi-items__block-area").height()-AMI.$("#multi-items__block__options").height()-10),!0;this.log("Container element ID #"+c+" not found!");return!1};this.renderInputRow=function(c){var a=AMI.$("<DIV>");a.attr("id",
this.name+"-container");a.addClass("ami-select__container");a.css("width",Math.round((parseInt(AMI.$("#filter-box").width())-100)/2)+"px");var b=AMI.$("<DIV>");b.addClass("ami-select__inner");b.addClass("ami-select__resultrow");var d=AMI.$("<DIV>");d.attr("id",this.name+"-resultrow");d.addClass("ami-select-resultrow");var m=AMI.$("<DIV>");m.attr("id",this.name+"-rolloverbutton");m.addClass("ami-select-rolloverbutton");m.attr("align","right");var f=AMI.$("<INPUT>");f.attr("type","text");f.val(this.getOpt("title",
""));f.focus(function(c){return function(){this.value===c.getOpt("title","")&&(this.value="")}}(this));f.blur(function(c){return function(){""===this.value&&(this.value=c.getOpt("title",""))}}(this));var k=AMI.$("<DIV>");k.attr("id",this.name+"-viewed");k.addClass("ami-select-viewed");d.append(f);d.append(k);b.append(d);b.append(m);a.append(b);c.append(a);a=AMI.$("<DIV>");a.attr("id",this.name+"-list");a.addClass("ami-select__inner");a.addClass("ami-select__list");a.css("z-index","100");b=AMI.$("<DIV>");
b.addClass("ami-select__close");b.attr("id",this.name+"-close");b.click(function(c){return function(a){c.closeList(a,!0)}}(this));a.append(b);c.append(a);a=AMI.$("<DIV>");a.attr("id",this.name+"-tooMuchMaches");a.addClass("ami-select__msgOverflow");c.append(a)};this.tooMuch=function(c,a,b){var d=AMI.$("#"+this.name+"-tooMuchMaches");(this.showTooMuch=c)&&parseInt(a)<parseInt(b)?(d.css("top",this.getListObject().position().top+this.getListObject().height()+4),d.html(this.getOpt("tooMuch","Not all mathes shown").replace("__count__",
a).replace("__total__",b)),d.show()):(d.html(""),d.hide())};this.getListObject=function(){return AMI.$("#"+this.name+"-list")};this.getContainer=function(){return AMI.$("#"+this.name+"-container")};this.renderData=function(){for(var c in this.aData)if(this.addGroup(this.aData[c].caption),"object"===typeof this.aData[c])for(var a in this.aData[c].items)this.addItem(this.aData[c].caption,this.aData[c].items[a].caption,a)};this.isGroupExists=function(c){return 0<this.getGroup(c).length};this.getGroup=
function(c){return this.getListObject().children('DIV[data-ami-select-group="'+c+'"]')};this.getGroups=function(){return AMI.$("#"+this.name+"-list > .ami-select__group")};this.addGroup=function(c){c=this.clearName(c);if(this.isGroupExists(c))return this.getGroup(c);var a=AMI.$("<DIV>");a.addClass("ami-select__group");a.attr("data-ami-select-group",c);var b=AMI.$("<DIV>");b.addClass("ami-select__grouptitle");for(var d in this.highlighted)c=c.replace(new RegExp("("+d+")","ig"),"<b>$1</b>");b.html(c);
a.append(b);this.getListObject().append(a);a.on("click","div",function(a){return function(){if(AMI.$(this).hasClass("ami-select__item")&&(AMI.$("#"+a.name+"-resultrow input, #"+a.name+"-list").hide(),a.tooMuch(!1),AMI.$("#"+a.name+"-viewed, #"+a.name+"-rolloverbutton").show(),AMI.$("#"+a.name+"-viewed").text(AMI.$(this).attr("data-ami-select-item-full")),"undefined"!==typeof a.options.onSelect))a.options.onSelect(a,AMI.$(this).attr("data-ami-select-item-full"),AMI.$(this).attr("data-ami-select-item-value"),
AMI.$(this))}}(this));return a};this.clearName=function(a){if("undefined"===typeof a)return"";a=a.replace(/&quot;/ig,'"');a=a.replace(/&laquo;/ig,"");a=a.replace(/&raquo;/ig,"");a=a.replace(/\\'/ig,"'");return a=a.replace(/\\\//ig,"/")};this.addItem=function(a,b,d,g){b=this.clearName(b);var m=this.addGroup(a);m.children("HR").remove();var f=AMI.$("<DIV>");f.addClass("ami-select__item");f.attr("data-ami-select-item-value",d);var k=m.attr("data-ami-select-group")+": "+b;f.attr("data-ami-select-item-full",
k);"undefined"===typeof g&&this.getOpt("selected","")===d&&(AMI.$("#"+this.name+"-viewed").text(k),AMI.$("#"+this.name+"-resultrow input").val(k));for(var n in this.highlighted)b=b.replace(new RegExp("("+n+")","ig"),"<b>$1</b>");f.html(b);g=this.getOpt("onAddItem",!1);"function"===typeof g&&g(this,a,b,d,m,f);m.append(f);m.append(AMI.$("<HR>"))};this.searchItems=function(a,b){for(var d=!1,g=0;g<b.length;g++)if(""!==b[g]){var m=a.toLowerCase(),f=b[g];0<=m.indexOf(f)&&(d=!0,this.highlighted[f]=1)}return d};
this.initEvents=function(){AMI.$(window).resize(function(a){return function(b){a.getContainer().css("width",Math.round((parseInt(AMI.$("#filter-box").width())-100)/2)+"px")}}(this));this.getContainer().on("click","#"+this.name+"-rolloverbutton",function(a){return function(){var b=a.getOpt("onButtonClick",!1),d=!1;"function"===typeof b&&(d=b(a));d||(a.getListObject().css("display","inline-block"),b=a.getOpt("onListOpen",!1),"function"===typeof b&&b(a,a.getListObject()),AMI.$("#"+a.name+"-viewed, #"+
a.name+"-rolloverbutton").hide(),AMI.$("#"+a.name+"-resultrow input").show().focus(),a.ifInputNullShowList(),a.showTooMuch&&a.tooMuch(!0))}}(this));this.getContainer().on("click","#"+this.name+"-viewed, #"+this.name+"-resultrow > input",function(a){return function(){var b=a.getOpt("onListClick",!1),d=!1;"function"===typeof b&&(d=b(a));d||(a.getListObject().css("display","inline-block"),b=a.getOpt("onListOpen",!1),"function"===typeof b&&b(a,a.getListObject()),AMI.$("#"+a.name+"-viewed, #"+a.name+"-rolloverbutton").hide(),
AMI.$("#"+a.name+"-resultrow input").val(""),"undefined"!==typeof a.lastStr&&AMI.$("#"+a.name+"-resultrow input").val(a.lastStr),AMI.$("#"+a.name+"-resultrow input").show().focus().select(),a.ifInputNullShowList(),a.showTooMuch&&a.tooMuch(!0))}}(this));this.getListObject().scroll(function(a){return function(){var b=a.getListObject().scrollTop();AMI.$("#"+a.name+"-close").css("top",b+"px")}}(this));AMI.$(document).mouseup(function(a){return function(b){a.closeList(b)}}(this));AMI.$(document).keyup(function(a){return function(b){27===
b.keyCode&&a.closeList(b)}}(this));this.getListObject().on("mouseover",".ami-select__item",function(a){return function(){AMI.$(".ami-select__item").removeClass("ami-select__selected");AMI.$(this).addClass("ami-select__selected")}}(this));AMI.$("#"+this.name+"-resultrow input").keyup(function(a){return function(b){27===b.keyCode&&AMI.$(this).val("");38!==b.keyCode&&40!==b.keyCode&&a.delay(function(b){return function(){var d=[],e=AMI.$("#"+b.name+"-resultrow input").val().replace(/\:/g,""),e=e.replace(/\s+/g,
" ").replace(/^\s/,"").replace(/\s$/,"");if(e.length){AMI.$("#"+a.name+"-viewed, #"+a.name+"-rolloverbutton").hide();a.getListObject().css("display","inline-block");f=b.getOpt("onListOpen",!1);"function"===typeof f&&f(b,b.getListObject());e=e.replace("\\","\\\\").toLowerCase();if(b.lastStr===e)return;b.highlighted={};b.lastStr=e;d=e.split(" ")}else{b.highlighted={};b.lastStr="";var f=b.getOpt("onEmptySearch",!1),k=!1;"function"===typeof f&&(k=f(b));if(!k)return}f=b.getOpt("onBeforeHighlight",!1);
"function"===typeof f&&f(b);b.getListObject().empty();k=AMI.$("<DIV>");k.addClass("ami-select__close");k.attr("id",b.name+"-close");k.click(function(a){return function(b){a.closeList(b,!0)}}(b));b.getListObject().append(k);var k={},n=0,h=!1,p=0,q;for(q in b.aData)for(var r in b.aData[q].items){for(var t=0;t<d.length;t++)""!==d[t]&&(b.highlighted[d[t]]=0);t=!1;f=b.getOpt("onSearch",!1);"function"===typeof f&&(t=f(b,q,r,e,d));var f=b.searchItems(b.aData[q].caption,d),x=b.searchItems(r,d),y=b.searchItems(b.aData[q].items[r].caption,
d),u=!0,v;for(v in b.highlighted)if(!b.highlighted[v]){u=!1;break}if(u&&(t||f||x||y)&&(p++,!h&&("undefined"===typeof k[q]&&(k[q]={}),k[q][r]=b.aData[q].items[r],b.addItem(b.aData[q].caption,k[q][r].caption,r,!0),n++,n===b.getOpt("maxCount",1E3)))){h=!0;break}}b.getListObject().find("P").remove();b.tooMuch(h,b.getOpt("maxCount",1E3),p);n||b.getListObject().append("<p>"+b.getOpt("notFound","Found nothing")+"</p>")}}(a),300)}}(this))};this.ifInputNullShowList=function(){""===AMI.$("#"+this.name+"-resultrow > input").val()&&
this.getGroups().show()};this.closeList=function(a,b){var d=this.getListObject();if(b||"undefined"!==typeof a.target&&0===d.has(a.target).length&&d.attr("id")!==AMI.$(a.target).attr("id"))this.tooMuch(!1),d.hide(),AMI.$("#"+this.name+"-rolloverbutton").show(),""!==AMI.$("#"+this.name+"-viewed").text()&&(AMI.$("#"+this.name+"-viewed").show(),AMI.$("#"+this.name+"-resultrow input").hide())};this.timer=0;this.delay=function(a,b){clearTimeout(this.timer);this.timer=setTimeout(a,b)};this.log=function(a,
b){this.getOpt("debug",!1)&&console.log(a)}},amiToolbar=function(a,b,d){function c(a){return m(k.document).find(a)}function e(){var a=f.amiSkinController.getURL("logout");m.get(a,function(){f.location.hash="ami-login";f.location.reload()})}function l(){"settings"!==p?(n.clickFromToolbar=!0,m(n.document).find("#saveActionButton").click()):n.postMessage("save",f.authData.url.match(/^(.*?)\/_/)[1])}function g(a,b,d){"undefined"===typeof d.mode&&(d.mode=b);d["class"]="undefined"===typeof d["class"]?b+
"-btn":b+"-btn "+d["class"];"undefined"===typeof d.iconId&&(d.iconId=b+"-icon");"undefined"===typeof d.iconClass&&"undefined"!==typeof q[b]&&(d.iconClass=q[b]);if("undefined"===typeof d.text){var e="caption_"+b;"undefined"!==typeof h[e]&&(d.text=h[e])}"undefined"!==typeof d.text&&"undefined"===typeof d.activeText&&(e="caption_"+b+"_active",d.activeText="undefined"!==typeof h[e]?h[e].replace("_action_",d.text):d.text);e=m("<LI>");"undefined"!==typeof d["class"]&&e.addClass(d["class"]);"undefined"!==
typeof d.id&&e.prop("id",d.id);"undefined"!==typeof d.title?e.prop("title",d.title):"undefined"!==typeof d.text&&e.prop("title",d.text);var g=m("<A>");"undefined"!==typeof d.href?g.prop("href",d.href):g.prop("href","#");"undefined"!==typeof d.hrefId&&g.prop("id",d.hrefId);"undefined"!==typeof d.target&&g.prop("target",d.target);"undefined"!==typeof d.linkId&&g.prop("id",d.linkId);"undefined"!==typeof d.onclick&&g.click(function(){f.amiSkinController.isActionInProgress||(f.amiSkinController.gaSendEvent("toolbar-click",
b),"undefined"!==typeof b&&"save"!==b&&(c(".save-btn").find(".bar-title").html(h.caption_save),"add"===b&&c(".save-btn").find(".bar-title").html(h.caption_add),p=b),d.onclick())});var k=m("<I>");k.addClass("fa");"undefined"!==typeof d.iconClass&&k.addClass(d.iconClass);"undefined"!==typeof d.iconId&&k.prop("id",d.iconId);var n=m("<SPAN>");n.addClass("bar-title-block");"undefined"!==typeof d.labelClass&&k.addClass(d.iconClass);var l=m("<SPAN>");l.addClass("bar-title");l.addClass("list-title");if("admin"===
b){var w=m("<SPAN>");w.addClass("admin-after-icon");"undefined"!==typeof d.text&&(l.html(d.text),l.append(w))}else"undefined"!==typeof d.text&&l.html(d.text);n.append(l);l=m("<SPAN>");l.addClass("bar-title");l.addClass("active-title");"undefined"!==typeof d.activeText?l.html(d.activeText):"undefined"!==typeof d.text&&l.html(d.text);n.append(l);g.append(k);g.append(n);e.append(g);c("#"+a).append(e)}var m=jQuery,f=a,k=b,n=d,h=b.aLocale,p="toolbar",q={back:"fa-chevron-left",edit:"fa-pencil",add:"fa-plus-circle",
seo:"fa-google",save:"fa-check",settings:"fa-cog",admin:"fa-desktop",logout:"fa-sign-out"};this.startSpin=function(){"toolbar"!==p&&(c("#"+p+"-icon").addClass("fa-spin"),c("."+p+"-btn").addClass("item-btn-selected"))};this.stopSpin=function(){c(".fa-spin").removeClass("fa-spin")};this.showRefresh=function(){c("#refreshBtn").show();f.amiSkinController.isMobile&&c("#username-btn").hide();c(".refreshBtn-label").addClass("animation-pulse");c(".btn-primary").addClass("animation-pulse")};this.getMode=function(){return p};
this.setMode=function(a){p=a;this.update()};this.update=function(){c("#menu-buttons").removeClass("toolbar-mode");c("#menu-buttons").parent().addClass("toolbar-mode__edit");c("header").removeClass("toolbar-mode__edit-user");switch(p){case "toolbar":c("#username").html(f.amiSession.get("username_cookie"));c("#menu-buttons").parent().removeClass("toolbar-mode__edit");c("#menu-buttons").parent().addClass("toolbar-mode");c("#menu-buttons li").removeClass("item-btn-selected");c("#menu-buttons li").show();
c(".back-btn, .save-btn, .logout-btn").hide();break;case "edit":case "add":case "seo":c("#menu-buttons li").hide();c(".back-btn, .save-btn, .admin-btn").show();c("."+p+"-btn").show();var a="page",b=amiSkinController.modId;try{b="undefined"!==typeof n.oActiveModule?n.oActiveModule.modId:authData.modId}catch(d){}"pages"!==b&&(a="item",0<b.indexOf("_cat")&&(a="category"));a="entity_"+a+"_wide";"undefined"!==typeof h[a]&&(a=h[a].replace("_action_",h["caption_"+p+"_active"]),c(".item-btn-selected .active-title").html(a));
break;case "settings":c("#menu-buttons li").hide();c(".back-btn, .save-btn, .settings-btn").show();break;case "usermenu":c("#menu-buttons li").hide(),c("header").removeClass("toolbar-mode__edit"),c("header").addClass("toolbar-mode__edit-user"),c(".back-btn, .logout-btn").show()}};this.updateSaveButton=function(){c(".save-btn").find(".bar-title").html(h.caption_save);m(n.document).find("#saveActionButton").val(h.caption_save)};f.amiSkinController.needReload&&(this.showRefresh(),f.amiAdminFormPage.showHideOk());
f.amiSkinController.isTouch&&(c("#edit-black-bar").addClass("touch"),c(".disabled-li").removeClass("disabled-li"));"undefined"!==typeof f.amiSession&&f.amiSession.get("ami_efe")&&"undefined"!==typeof f.authData?(c("#menu-buttons").append('<li onclick="parent.amiSkinController.selectModule(); return false;" class="amiro-item-btn"><img src="'+f.frontBaseHref+'_shared/code/web/skins/ami_touch/images/logo_amiro.png" /></li>'),f.authData.moduleAllowed||f.authData.pagesAllowed?(g("menu-buttons","back",
{onclick:function(){f.amiSkinController.closeModule();p="toolbar"}}),g("menu-buttons","edit",{onclick:function(){f.amiSkinController.edit()}}),g("menu-buttons","add",{onclick:function(){f.amiSkinController.add()}}),g("menu-buttons","seo",{onclick:function(){f.amiSkinController.seo()}})):(g("menu-buttons","edit",{"class":"disabled-li",onclick:function(){f.amiSkinController.showMessage(h.no_rights_edit_warn)}}),g("menu-buttons","add",{"class":"disabled-li",onclick:function(){f.amiSkinController.showMessage(h.no_rights_add_warn)}}),
g("menu-buttons","seo",{"class":"disabled-li",linkId:"seo-bar",onclick:function(){f.amiSkinController.showMessage(h.no_rights_edit_warn)}})),g("menu-buttons","logout",{onclick:e}),f.authData.adminAllowed?g("menu-buttons","settings",{title:h.caption_settings_hint,linkId:"option-bar",onclick:function(){f.amiSkinController.settings()}}):g("menu-buttons","settings",{title:h.caption_settings_hint,"class":"disabled-li",onclick:function(){f.amiSkinController.showMessage(h.no_rights_admin_warn)}}),g("menu-buttons",
"save",{onclick:l}),f.authData.adminAllowed?(g("menu-buttons","admin",{title:h.caption_admin_hint,href:f.authData.url+f.authData.admin,hrefId:"ami-admin-panel",target:"_blank"}),c("#ami-admin-panel").click(function(){f.amiSkinController.gaSendEvent("toolbar-click","control-panel")})):g("menu-buttons","admin",{title:h.caption_admin_hint,"class":"disabled-li",onclick:function(){f.amiSkinController.showMessage(h.no_rights_admin_warn)}}),c("#menu-buttons").append('<li class="edit-mode-item-btn" title="'+
h.caption_edit_mode_hint+'"><label class="switch switch-primary"><input onclick="parent.amiSkinController.editModeOff();" checked="" type="checkbox" /><span><div id="ami-edit-mode-swith" class="fa fa-pencil ami-edit-mode-switch"></div></span><font class="bar-title bar-title-block">'+h.caption_disable_edit_mode+"</font></label></li>"),this.update(),setTimeout(function(){c("#edit_mode_on").fadeOut(1E3,function(){c("#edit_mode_on").fadeIn(1E3)})},2E3),m(k.document).keydown(function(a){65===a.which&&
a.altKey&&f.amiSkinController.userMenu()})):(g("menu-buttons","back",{onclick:function(){f.amiSkinController.closeModule();p="toolbar"},"class":"hidden-by-default"}),g("menu-buttons","logout",{onclick:e,"class":"hidden-by-default"}),c("#username").html(f.amiSession.get("username_cookie")),c("#menu-buttons").append('<li onclick="return false;" class="amiro-item-btn amiro-item-btn__off"><img src="'+f.frontBaseHref+'_shared/code/web/skins/ami_touch/images/logo_amiro.png" /></li><li id="edit_mode_on" class="edit-mode-item-btn" title="'+
h.caption_edit_mode_hint+'"><label onclick="parent.amiSkinController.editModeOn();" class="switch switch-primary"><input type="checkbox" /><span><div id="ami-edit-mode-swith" class="fa fa-pencil ami-edit-mode-switch ami-edit-mode-switch-off"></div></span><font class="bar-title bar-title-block">'+h.caption_enable_edit_mode+"</font></label></li>"),setTimeout(function(){f.mobileFixBar.init()},500))};AMI.$(function(){AMI.$(document).click(function(){amiSkinController.closeSubmenu()})});

