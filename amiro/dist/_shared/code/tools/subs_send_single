#!/usr/bin/perl

use FindBin;
use lib $FindBin::Bin.'/lib/perl';
use Error qw(:try);
use Exceptions;
use SI::CMS::SubsSender;
use SI::Logger;
use SI::Utils;

my $docroot = $FindBin::Bin.'/../../../';
my $logfile = $docroot.'_admin/_logs/sender.log';
my $pidfile = $docroot.'_admin/_logs/sender.pid';

my $pidFD;
my $logger = SI::Logger->new($logfile,LL_ERROR);
try {
    $pidFD = lockPidFile($pidfile);
    my $sm = SI::CMS::SubsSender->new($docroot,$logger);
    $sm->sendQueued();
    unlink($pidfile);
} catch ErrException with {
    my $e = shift;
    $logger->logException($e);
    throw $e;
};



