<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       7116 xkqwpzylkypqypugysmxluskpkrkkmnutwluizpmyupgkwzgzlrktuprixxrxtssmrktpnir
 */ ?><?php foreach(array(26=>'IHSQ',27=>'DQrvMWQ',28=>'fZDt',29=>'ZWtMHn',30=>'oTTg~1`1',31=>'Qxt|rZtMnP',32=>'PQt|WHunt',33=>'rZC|IHSQ',34=>'uDQrD~rZtMnP',35=>'QDOHG|WZrt',36=>'QSMt|Mn|GJZWQ',37=>'IHSuJQ',38=>'ZIM|fuJJ',39=>'IHS|ZWtMHn',40=>'zim|zjjhc|jhwzj|ihsUjqd',41=>'|JHWZJ~IHSuJQD~WHSQ~',42=>"'?nHt?MnDtZJJQS,",43=>'rQDGHnDQ',44=>'SMDGZtWORZCzWtMHn') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(!isset($AMI_ENV_SETTINGS) || !is_array($AMI_ENV_SETTINGS)){ $AMI_ENV_SETTINGS =array(); }$AMI_ENV_SETTINGS[I26] ='full'; $AMI_ENV_SETTINGS['skip_disable_user_scripts'] =TRUE; if(!empty($_REQUEST['service'])){ $l1L1Ill =$_REQUEST['service']; switch($_REQUEST[I27]){ case 'ami_webservice': $AMI_ENV_SETTINGS[I26] =isset($_REQUEST['fullEnv']) && (intval($_REQUEST['fullEnv']) === 1) ?'full' :I28; $l1L1IlL =false; if(!isset($_REQUEST['action'])){ $l1L1IlL =true; }else{ if(($_REQUEST['action'] === 'sys.auth') && !isset($_REQUEST['apiKey'])){ $l1L1IlL =true; }elseif(($_REQUEST[I29] !== 'sys.auth') && !isset($_REQUEST['appToken'])){ $l1L1IlL =true; }}if($l1L1IlL){ header((getenv('SERVER_PROTOCOL') ?getenv('SERVER_PROTOCOL') :I30) .' 400 Bad Request'); header('Status: 400 Bad Request'); header('Retry-After: 3600'); die; }$AMI_ENV_SETTINGS['disable_cache'] =true; $AMI_ENV_SETTINGS['check_service_presence'] =true; break; case 'ami_seopult': $AMI_ENV_SETTINGS[I26] ='full'; $AMI_ENV_SETTINGS['disable_cache'] =true; $AMI_ENV_SETTINGS['check_service_presence'] =true; break; case I31: $AMI_ENV_SETTINGS[I26] ='full'; $AMI_ENV_SETTINGS['disable_cache'] =true; $AMI_ENV_SETTINGS['check_service_presence'] =true; break; case 'private_messages': $AMI_ENV_SETTINGS[I26] =I28; if(!empty($_REQUEST[I29]) && ($_REQUEST[I29] == I32 || $_REQUEST[I29] == 'get_local_sites_messages')){ $AMI_ENV_SETTINGS['raw_mode'] =true; }break; case 'private_message_notifier': $AMI_ENV_SETTINGS['disable_cache'] =true; $AMI_ENV_SETTINGS[I33] =TRUE; break; case 'yandex_fast_order': $AMI_ENV_SETTINGS[I26] =I28; if(!empty($_REQUEST[I29]) && ($_REQUEST[I29] == 'get_address')){ $AMI_ENV_SETTINGS[I33] =true; }break; case 'rate_user': $AMI_ENV_SETTINGS['disable_cache'] =true; $l1L1Ill =I34; break; case 'forum': $AMI_ENV_SETTINGS[I26] =I28; $AMI_ENV_SETTINGS[I33] =true; break; case 'eshop_order': case 'eshop_cart': $AMI_ENV_SETTINGS[I33] =true; $AMI_ENV_SETTINGS['disable_cache'] =true; if(($_REQUEST[I27] == I35) && !empty($_REQUEST[I29]) && ($_REQUEST[I29] == 'get_items')){ $AMI_ENV_SETTINGS[I26] =I28; }break; case 'tx_rollback': $AMI_ENV_SETTINGS =array( 'skip_disable_user_scripts' => TRUE, 'disable_declares' => TRUE );break; case I36: case 'ext_image': $AMI_ENV_LIMITS =array('includes' => 150); break; }}elseif(!empty($_REQUEST['mod_id']) && !empty($_REQUEST['mod_action'])){ $l1L1Ill =I37; if(empty($_REQUEST[I38])){ $AMI_ENV_SETTINGS[I26] =I28; }else{ $AMI_ENV_LIMITS =array('includes' => 150); $AMI_ENV_SETTINGS['disable_cache'] =true; }}else{ header((getenv('SERVER_PROTOCOL') ?getenv('SERVER_PROTOCOL') :I30) .' 503 Service Temporarily Unavailable'); header('Status: 503 Service Temporarily Unavailable'); header('Retry-After: 3600'); die; }if(!empty($_REQUEST['mod_action']) && 'form_edit' == $_REQUEST[I39]){ $AMI_ENV_LIMITS =array('includes' => 150); }require 'ami_env.php'; if( empty($GLOBALS['sys']['disable_user_scripts']) || defined(I40) ){AMI_Service::addAutoloadPath($ROOT_PATH .I41); }if(!empty($AMI_ENV_SETTINGS['check_service_presence']) && !AMI_ModDeclarator::getInstance()->isRegistered($l1L1Ill)){ $message ="Requested service '" .$l1L1Ill .I42; trigger_error($message, E_USER_WARNING); die($message); }if(!AMI::validateModId($l1L1Ill) && !AMI::isResource($l1L1Ill .'/service')){ $message ="Unknown service '" .$l1L1Ill ."' requested!"; trigger_error($message); if(AMI::isResource(I43)){ $oResponse =AMI::getSingleton(I43); $oResponse->start(); $oResponse->HTTP->addHeader('501 Not Implemented'); $oResponse->HTTP->addHeader('Status: 501 Not Implemented'); $oResponse->write($message); $oResponse->send(); }else{ header((getenv('SERVER_PROTOCOL') ?getenv('SERVER_PROTOCOL') :I30) .' 501 Not Implemented'); header('Status: 501 Not Implemented'); die($message); }}$l1L1Il1 =AMI::getResource($l1L1Ill .'/service'); if(empty($AMI_ENV_SETTINGS[I33])){ $oRequest =AMI::getSingleton('env/request'); $oResponse =AMI::getSingleton(I43); $oResponse->sleep(100000); $oResponse->start(); call_user_func_array(array($l1L1Il1, 'dispatchAction'), array($oRequest, $oResponse)); $oResponse->send(); }else{ call_user_func(array($l1L1Il1, I44)); }