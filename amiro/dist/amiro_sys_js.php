<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       15334 xkqwpqnmuyxkrlsgnxknuizxtyztluwsqimixrrzgyrnmsuizlzmnlmrlxnyrlrguzinpnir
 */ ?><?php foreach(array(79=>'ZIMrH|DBD|LD`GOG',80=>'IQI|uDZPQ',81=>'Qrr',82=>'RqihTq|zssR',83=>"?[~\r\n",84=>'fMJtQr',85=>'LD~DKMn|MnMt`LD',86=>'LD~DtZtD`LD',87=>'GrMvZtQ|IQDDZPQD',88=>"\r\n",89=>'|DOZrQS~WHSQ~LD~',90=>'',91=>'qXTRz|dimjqd',92=>'TqXT',93=>'DIMJQD|GZtO',94=>'CMnK',95=>'%s',96=>"`PMf'!?'",97=>'SJZnP',98=>'uJ',99=>'<<QxtrZ|DIMJQD<<',100=>"'!'",101=>'WHJHrD',102=>'DIMJQD|WHGBrMPOt',103=>'funW',104=>"LD~MnMt|YQfHrQ`LD",105=>'go',106=>'LD`G',107=>'zim`iHSuJQ`LD',108=>'zim`iHSuJQwHIGHnQnt`LD',109=>'zim`iHSuJQwHIGHnQntFMJtQr`LD',110=>'zim`iHSuJQwHIGHnQntjMDt`LD',111=>'zim`iHSuJQwHIGHnQntFHrI`LD',112=>'SQtQWtyrHCDQr`LD',113=>'Z',114=>'MrH|DB',115=>'ZIM`DtrMnP`LD',116=>'ZIM`uM`DJMSQr`LD',117=>'ZIM`uM`tHHJtMG`LD',118=>'ZIM`uM`ZJQrt`LD',119=>'ZIM`fMnZJ`LD',120=>"dqjqwT?.WHntQnt.?FRhi?.WID|IHSuJQD|tQIGJZtQD|JZnPD.?coqRq?.GZtO.?=?'tQIGJZtQD~JZnP~'?zNs?.nZIQ.?=?'WJMQnt`JnP'",121=>"WHntQnt",122=>'"',123=>"\n") as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if(I79 !== basename(__FILE__)){ die('Data corrupted'); }$AMI_ENV_SETTINGS =array( 'mode' => 'fast', 'skip_disable_user_scripts' => TRUE );$AMI_ENV_LIMITS =array( I80 => 5 *1024 *1024, 'peak_mem_usage' => 5 *1024 *1024 );require 'ami_env.php'; AMI_Service::hideDebug(); $l1L1I1L =AMI::getOption('common_settings', 'debug_ips'); $l1L1I11 =isset($sys[I81]['debug_ips']) && isset($sys[I81]['debug_ips'][$_SERVER['REMOTE_ADDR']]) && (mb_strpos($sys[I81]['debug_ips'][$_SERVER[I82]], 'disable_js_css_cache') !== false); $l1L1lII =isset($l1L1I1L[$_SERVER[I82]]) && (mb_strpos($l1L1I1L[$_SERVER[I82]], 'disable_js_css_cache') !== false); $l1L1lIl =$l1L1I11 || $l1L1lII; function TlIII1I(){ echo "/*\r\n" ." * ATTENTION! This file is automatically created from several JavaScript files.\r\n" ." * Find file path and name in the comments in the beginning of the each code block\r\n" ." */\r\n\r\n"; }function TlIII1l($fileName, $l1II1LI){ echo "\r\n/*\r\n" ." * FILE START: $fileName\r\n" ." */\r\n\r\n"; echo $l1II1LI; echo "\r\n\r\n/*\r\n" ." * FILE END: $fileName\r\n" .I83; }$l1L1llL =array( 'system' => '_shared/code/js/front_system.js', 'editor' => '_shared/code/js/front_editor.js', I84 => '_shared/code/js/front_filter.js', 'skin' => array( AMI_Skin::getPath('js/skin.js'), AMI_Skin::getPath('js/skin_init_before.js'), AMI_Skin::getPath(I85) ),'common' => '_js/common.js', );if(defined('AMIRO_HOST') && AMIRO_HOST){ $l1L1llL['skin'][] =AMI_Skin::getPath(I86); }header('Content-Type: application/x-javascript'); header('Cache-Control: max-age=2592000'); $oFileCache =AMI::getResource('env/file_cache'); $oFileCache->init(); if(!$l1L1lIl && !$oFileCache->isExpired()){ die($oFileCache->get()); }ob_start(); TlIII1I(); if($_GET['script'] == I87){ $aScripts =array( 'private_messages.js', );foreach($aScripts as $script){ if(is_file($HOST_PATH .'_shared/code/js/' .$script)){ TlIII1l('_shared/code/js/' .$script, file_get_contents($HOST_PATH .'_shared/code/js/' .$script)); }echo I88; }$oFileCache->store(ob_get_clean()); die($oFileCache->get()); }elseif($_GET['script'] == 'user_rating'){ $aScripts =array( 'user_rating.js', );foreach($aScripts as $script){ TlIII1l('_shared/code/js/' .$script, file_get_contents($HOST_PATH .I89 .$script)); echo I88; }$oFileCache->store(ob_get_clean()); die($oFileCache->get()); }elseif($_GET['script'] == 'editor'){ if(is_file($l1L1llL['editor'])){ $fileContent =file_get_contents($l1L1llL['editor']); }else{ $fileContent =I90; }$fileData =array( 'fonts' => array(), 'max_text_size' => 7, 'colors' => array(), 'BASE_SMILES' => array(), I91 => array(), 'smiles_path' => I90, 'smiles_copyright' => I90 );$l1L1ll1 ='_local/config_editor.php'; if(is_file($l1L1ll1) && filesize($l1L1ll1)){ $configData =parse_ini_file($l1L1ll1, true); $fileData['max_text_size'] =max(1, intval($configData[I92]['max_text_size'])); foreach(array('fonts', 'colors') as $dataType){ foreach(explode(',', $configData[I92][$dataType]) as $l1L1lLI){ $l1L1lLI =trim($l1L1lLI); if(mb_strlen($l1L1lLI) >0){ $fileData[$dataType][] =$l1L1lLI; }}}$fileData[I93] ='base'; if(is_file('_mod_files/smiles/current.dat')){ $fileConfig =trim(file_get_contents('_mod_files/smiles/current.dat')); if(!empty($fileConfig) && is_dir('_mod_files/smiles/' .$fileConfig)){ $fileData[I93] =$fileConfig; }}$specSmiles =array(I94 => ';)', 'smile' => ':)', 'laugh' => I95, 'frown' => ':('); foreach(array('BASE_SMILES', I91) as $dataType){ foreach($configData[$dataType] as $smileName => $smileValue){ $smileName =trim($smileName); $smileValue =trim($smileValue); if(strncmp($smileName, $fileData[I93], mb_strlen($fileData[I93])) == 0){ $smileName =mb_substr($smileName, mb_strlen($fileData[I93]) +1); $fileData[$dataType][] ="new Array('" .addslashes($smileName) .I96 .addslashes($smileValue) ."', '" .(isset($specSmiles[$smileName]) ?$specSmiles[$smileName] :":" .addslashes($smileName) .":") ."')"; }}}if(mb_strlen($_GET[I97]) == 2){ $l1I1lLI =$fileData[I93] .'_' .$_GET[I97]; if(!empty($configData['SMILES_COPYRIGHTS'][$l1I1lLI])){ $fileData['smiles_copyright'] =addslashes($configData['SMILES_COPYRIGHTS'][$l1I1lLI]); }}}$l1L1lLl =isset($_GET[I98]) ?(int) $_GET[I98] :0; $fileContent =str_replace( array( '##fonts##', '##max_text_size##', '##colors##', '##base_smiles##', I99, '##smiles_path##', '##smiles_copyright##', '##url_max_length##' ),array( "'" .implode(I100, $fileData['fonts']) ."'", $fileData['max_text_size'], "'" .implode(I100, $fileData[I101]) ."'", implode(",", $fileData['BASE_SMILES']), implode(",", $fileData[I91]), $fileData[I93], $fileData[I102], $l1L1lLl ),$fileContent );TlIII1l($l1L1llL['editor'], $fileContent); }elseif($_GET['script'] == 'imgclear'){ $l1L1lLL =strrev(str_rot13($_GET['hash'])); $signIdNum =mb_substr($l1L1lLL, 6, 4) .mb_substr($l1L1lLL, 24, 4); $signFuncName =I103 .mt_rand(1000, 9999); echo <<<EOD
function csf111(){this.csfI11=function(a){var c=[0,0,0];if(aParts=a.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/i)){c[0]=aParts[1];c[1]=aParts[2];c[2]=aParts[3]}else{if(aParts=a.match(/#([a-f0-9]{3,6})/i)){a=aParts[1];if(a.length==3){var d=""+a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2);a=d}if(a.length==6){var b=parseInt(a,16);c[0]=b>>16&255;c[1]=b>>8&255;c[2]=b&255}}}return c};this.csf1I1=function(b){var a=0;b[0]=b[0]/255;b[1]=b[1]/255;b[2]=b[2]/255;if(b.length==3){for(i=0;i<3;i++){b[i]=b[i]<=0.03928?b[i]/12.92:Math.pow((b[i]+0.055)/1.055,2.4)}a=0.2126*b[0]+0.7152*b[1]+0.0722*b[2]}return a};this.csfII1=function(d,a){var c="";if(window.getComputedStyle){var e=window.getComputedStyle(d,a);c=e.getPropertyValue(a)}else{if(d.currentStyle){var b;while((b=a.indexOf("-"))!=-1){a=a.substr(0,b)+a.substr(b+1,1).toUpperCase()+a.substr(b+2)}if(d.currentStyle[a]){c=d.currentStyle[a]}}}return c};this.csfIII=function(){var k=document.swapNode!=undefined?true:false;var q=document.getElementById("sign$signIdNum");var l="#fff";var c="#000";if(q!=null){q=document.body.appendChild(q);q.style.zIndex=1000;var w=q.getElementsByTagName("A");if(w.length>0){var o=w[0];var y=this.csfII1(o,"font-size");var u=y.match(/^([0-9\.]+) *(em|pt|px|\%)$/i);if(u!=null&&u.length==3){u[1]=parseFloat(u[1]);u[2]=u[2].toLowerCase();if(u[2]=="em"&&u[1]<0.8||u[2]=="pt"&&u[1]<7||u[2]=="px"&&u[1]<8||u[2]=="%"&&u[1]<80){o.style.fontSize="12px"}}var j=true;var v=true;var h=true;do{if(j){if(o.tagName){if(o.offsetWidth<100||o.offsetHeight<8){if(this.csfII1(o,"display")=="none"){if(o.tagName=="TABLE"){if(o.id&&o.id=="sign"){o.id="sign"+Math.floor(Math.random()*1000)}o.style.display=k?"block":"table"}else{if(o.tagName=="TR"){o.style.display=k?"block":"table-row"}else{if(o.tagName=="TD"){o.style.display=k?"block":"table-cell"}else{o.style.display="block"}}}}if(this.csfII1(o,"visibility")=="hidden"){o.style.visibility="visible"}var r=this.csfII1(o,"width");var e=parseInt(r);if(r!="auto"&&e!=isNaN&&(r.indexOf("%")>0&&e<20||e<100)){o.style.width="auto"}var p=this.csfII1(o,"height");var x=parseInt(p);if(p!="auto"&&x!=isNaN&&(p.indexOf("%")>0&&x<5||x<8)){o.style.height="auto"}}var n=this.csfII1(o,"position");if(n!="static"){o.style.position="static"}var f=this.csfII1(o,"background-image");if(f!="none"){o.style.backgroundImage="none"}}if(o==q){j=false}}if(v){var d=this.csfII1(o,"background-color");if(d.match(/^(rgb\(|#)/i)){l=d;v=false}}if(h){var m=this.csfII1(o,"color");if(m.match(/^(rgb\(|#)/i)){c=m;h=false}}if(o.tagName&&o.tagName=="BODY"){break}}while(o=o.parentNode);q.style.backgroundColor=l;var b=this.csfI11(l);var a=[parseInt(b[0]),parseInt(b[1]),parseInt(b[2])];var t=this.csf1I1(b);var s=this.csf1I1(this.csfI11(c));var g=(Math.max(t,s)+0.05)/(Math.min(t,s)+0.05);if(g<2.5){for(i=0;i<3;i++){a[i]=a[i]-125<0?a[i]+125:a[i]-125}for(i=0;i<w.length;i++){w[i].style.color="rgb("+a[0]+","+a[1]+","+a[2]+")"}}}}}}var $signFuncName=new csf111();setTimeout(function(a){return function(){a.csfIII()}}($signFuncName),500);
EOD;
}elseif($_GET['script'] == 'skin'){ $l1LLIIl =array( AMI_Skin::getPath("js/plugins.js"), AMI_Skin::getPath("js/app.js"), AMI_Skin::getPath(I104), AMI_Skin::getPath("js/init.js") );$l1L1lL1 ='_SER' .'VE' .'R'; if(basename($GLOBALS[$l1L1lL1][I105 .'P_SELF']) !== ('a' .'mir' .'o_sys_' .I106 .'hp')){ $l1LLIIl =array_slice($l1LLIIl, 0, 4); }foreach($l1LLIIl as $path){ if($path && is_file($HOST_PATH .$path)){ TlIII1l($path, file_get_contents($HOST_PATH .$path)); }}$oFileCache->store(ob_get_clean()); die($oFileCache->get()); }elseif($_GET['script'] == '60'){ $l1LLIIl =array( 'AMI.Page.js', I107, I108, I109, I110, I111, I112, );$l1L1lL1 ='_SER' .'VE' .'R'; if(basename($GLOBALS[$l1L1lL1][I105 .'P_SELF']) !== (I113 .'mir' .'o_sys_' .I106 .'hp')){ $l1LLIIl =array_slice($l1LLIIl, 0, 4); }foreach($l1LLIIl as $l1LLIIL){ if(is_file($HOST_PATH .'_shared/code/js/60/' .$l1LLIIL)){ TlIII1l('_shared/code/js/60/' .$l1LLIIL, file_get_contents($HOST_PATH .'_shared/code/js/60/' .$l1LLIIL)); }}$oFileCache->store(ob_get_clean()); die($oFileCache->get()); }else{ $aScripts =explode('|', $_GET['script']); if(('am' .I114 .'s_js.php') !== basename(__FILE__)){ $aScripts =array($aScripts[0]); }foreach($aScripts as $script){ if($script == 'api'){ $l1LLIIl =array( 'ami.js', 'ami.browser.js', 'ami.browser.cookie.js', 'ami.browser.event.js', 'ami.browser.dom.js', 'ami.message.js', 'ami.template.js', I115, 'ami.httprequest.js', 'ami.cookie.js', 'ami.ui.js', 'ami.ui.list.js', I116, 'ami.ui.mediabox.js', 'ami.ui.overimage.js', 'ami.ui.suggestion.js', 'ami.ui.multiselect.js', I117, 'ami.ui.showblock.js', 'ami.ui.effects.js', 'ami.ui.dnd.js', 'ami.ui.popups.js', I118, 'ami.form.filter.js', 'ami.browser.event.domready.js', 'ami.eshop.properties.js', 'ami.ui.scroller.js', I119 );foreach($l1LLIIl as $l1LLIIL){ if(is_file($HOST_PATH .I89 .$l1LLIIL)){ TlIII1l(I89 .$l1LLIIL, file_get_contents($HOST_PATH .I89 .$l1LLIIL)); }}}elseif(!empty($script) && isset($l1L1llL[$script])){ if(is_array($l1L1llL[$script])){ foreach($l1L1llL[$script] as $l1L1l1I){ if($l1L1l1I && is_file($HOST_PATH .$l1L1l1I)){ TlIII1l($l1L1l1I, file_get_contents($HOST_PATH .$l1L1l1I)); }}}else{ if(is_file($HOST_PATH .$l1L1llL[$script])){ TlIII1l($l1L1llL[$script], file_get_contents($HOST_PATH .$l1L1llL[$script])); }}}}}$TEMPLATES_PATH =$ROOT_PATH .'templates/'; if(defined('TEMPLATES_FROM_DISK')){ $l1L1l1l =file_get_contents($GLOBALS['ROOT_PATH'] .'templates/lang/client.lng'); }else{ $sql =I120; $l1L1l1L =mysql_query($sql, $db->_dbLink); if($aData =mysql_fetch_array($l1L1l1L, MYSQL_ASSOC)){ $l1L1l1l =$aData[I121]; }}if(!empty($l1L1l1l)){ $l1L1l1l =preg_replace('/##--.*?--##/s', I90, $l1L1l1l); $aLocalData =array(); $l1L1l11 ='%ru'; $aData =mb_split("%%", $l1L1l1l); for($i =1, $l1L1LII =count($aData); $i <$l1L1LII; $i += 2){ if(mb_strpos($aData[$i], $l1L1l11) === (mb_strlen($aData[$i]) -3)){ $aLocalData[] =mb_substr($aData[$i], 0, mb_strlen($aData[$i]) -3) .' : "' .str_replace( array(I122, "\r", "\n"), array('\\"', I90, "\\" .I123), trim($aData[$i +1]) ).I122; }}if(sizeof($aLocalData) >0){ echo 'AMI.Template.Locale.merge({' .implode(', ', $aLocalData) .'});'; }}$oFileCache->store(ob_get_clean()); die($oFileCache->get()); 