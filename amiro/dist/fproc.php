<?php /**
 * @copyright  2000-2016 Amiro.CMS. All rights reserved. 
 * @version    $Id$ 
 * @size       2339 xkqwmultyypqpgwysmitlqxyxispstwuixwyqlrkznlzgmgwytyrikgxguzkplpktkuupnir
 */ ?><?php foreach(array(235=>'tMS',236=>'wZWOQdMIGJQj1`GOG',237=>'-?15?IMnutQ') as $i1=>$i2){$i3=strrev("rtrts");define("I".$i1,$i3($i2,'abcdeghijklmopqswyz ~`!@#%^&*()_-+|{}[];:<>,./?ABCDEGHIJKLMOPQSWYZ','ZYWSQPOMLKJIHGEDCBA?/.,><:;][}{|+-_)(*&^%#@!`~ zywsqpomlkjihgedcba'));} if (empty($_GET[I235]) || ($threadId =intval($_GET[I235])) <0) {die; }$SKIP_CONST =true; require 'cm_ini.php'; if(!(@mysql_connect(DB_Host, DB_User, DB_Password, FALSE, $GLOBALS['CONFIG_INI']['dbaccess']['DB_ClientFlags'])) || !@mysql_select_db(DB_Database)){ die; }$l11IllL =10000; if (rand(0, $l11IllL) <$l11IllL *0.001) {$sql ="DELETE LOW_PRIORITY FROM `cms_forum_views` WHERE `date` < DATE_SUB(NOW(), INTERVAL 1 MONTH)"; @mysql_query($sql); }$ip =$_SERVER['REMOTE_ADDR']; $sql ="SELECT 1 FROM `cms_forum_views` WHERE `ip` = INET_ATON('{$ip}') AND `id_thread` = {$threadId} AND `date` >= DATE_SUB(NOW(), INTERVAL 1 MONTH)"; if ($rs =@mysql_query($sql)) {if (@mysql_num_rows($rs) <1) {$sql ="UPDATE `cms_forum` SET `views` = `views` + 1 WHERE `id` = {$threadId}"; @mysql_query($sql); if (mysql_affected_rows() >0) {$sql ="INSERT DELAYED INTO `cms_forum_views` VALUES (INET_ATON('{$ip}'), {$threadId}, NOW())"; @mysql_query($sql); $CLASSES_PATH =$HOST_PATH .'_shared/code/classes/'; require_once $CLASSES_PATH .'DBConnection.php'; require_once $CLASSES_PATH .'Core.php'; require_once $CLASSES_PATH .I236; require_once $CLASSES_PATH .'CacheLite.php'; require_once $CLASSES_PATH .'Cache.php'; $Core =new CMS_Core('front'); $Cache =new CMS_Cache($Core); $Cache->db =new DB_si(); $Cache->Core =&$Core; $Cache->SetForceExpireTime('forum', I237); $Cache->ClearCacheNow(); }}}