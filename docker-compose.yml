version: '3'
services:
  nginx:
    build: ./nginx
    restart: always
    ports:
      - "80:80"
    depends_on:
      - phpfpm
      - django
      - wordpress
      - amiro
    volumes:
      - /private/var/lib/docker-volumes/var-www-wordpress:/var/www/wordpress/
      - /private/var/lib/docker-volumes/var-www-amiro:/var/www/amiro/
  mysql:
    build: ./mysql
    restart: always
  phpfpm:
    build: ./phpfpm
    restart: always
    depends_on:
      - mysql
    volumes:
      - /private/var/lib/docker-volumes/var-www-wordpress:/var/www/wordpress/
      - /private/var/lib/docker-volumes/var-www-amiro:/var/www/amiro/
  django:
    build: ./django
    restart: always
    command: /opt/myshop/manage.py runserver 0.0.0.0:8001
    volumes:
      - ./django/myshop/:/opt/myshop
    depends_on:
      - mysql
  wordpress:
    build: ./wordpress
    restart: "no"
    volumes:
      - /private/var/lib/docker-volumes/var-www-wordpress:/var/www/wordpress/
  amiro:
    build: ./amiro
    restart: "no"
    volumes:
      - /private/var/lib/docker-volumes/var-www-amiro:/var/www/amiro/
